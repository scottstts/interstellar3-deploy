(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();var Zb={exports:{}},Af={};var fN;function NF(){if(fN)return Af;fN=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,s,i){var a=null;if(i!==void 0&&(a=""+i),s.key!==void 0&&(a=""+s.key),"key"in s){i={};for(var c in s)c!=="key"&&(i[c]=s[c])}else i=s;return s=i.ref,{$$typeof:r,type:n,key:a,ref:s!==void 0?s:null,props:i}}return Af.Fragment=t,Af.jsx=e,Af.jsxs=e,Af}var pN;function RF(){return pN||(pN=1,Zb.exports=NF()),Zb.exports}var Se=RF(),Qb={exports:{}},Nf={},Jb={exports:{}},tS={};var mN;function EF(){return mN||(mN=1,(function(r){function t(F,Y){var tt=F.length;F.push(Y);t:for(;0<tt;){var lt=tt-1>>>1,Tt=F[lt];if(0<s(Tt,Y))F[lt]=Y,F[tt]=Tt,tt=lt;else break t}}function e(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var Y=F[0],tt=F.pop();if(tt!==Y){F[0]=tt;t:for(var lt=0,Tt=F.length,O=Tt>>>1;lt<O;){var et=2*(lt+1)-1,z=F[et],W=et+1,yt=F[W];if(0>s(z,tt))W<Tt&&0>s(yt,z)?(F[lt]=yt,F[W]=tt,lt=W):(F[lt]=z,F[et]=tt,lt=et);else if(W<Tt&&0>s(yt,tt))F[lt]=yt,F[W]=tt,lt=W;else break t}}return Y}function s(F,Y){var tt=F.sortIndex-Y.sortIndex;return tt!==0?tt:F.id-Y.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;r.unstable_now=function(){return i.now()}}else{var a=Date,c=a.now();r.unstable_now=function(){return a.now()-c}}var u=[],d=[],f=1,p=null,g=3,y=!1,x=!1,S=!1,T=!1,M=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;function A(F){for(var Y=e(d);Y!==null;){if(Y.callback===null)n(d);else if(Y.startTime<=F)n(d),Y.sortIndex=Y.expirationTime,t(u,Y);else break;Y=e(d)}}function R(F){if(S=!1,A(F),!x)if(e(u)!==null)x=!0,L||(L=!0,q());else{var Y=e(d);Y!==null&&mt(R,Y.startTime-F)}}var L=!1,D=-1,U=5,B=-1;function P(){return T?!0:!(r.unstable_now()-B<U)}function J(){if(T=!1,L){var F=r.unstable_now();B=F;var Y=!0;try{t:{x=!1,S&&(S=!1,N(D),D=-1),y=!0;var tt=g;try{e:{for(A(F),p=e(u);p!==null&&!(p.expirationTime>F&&P());){var lt=p.callback;if(typeof lt=="function"){p.callback=null,g=p.priorityLevel;var Tt=lt(p.expirationTime<=F);if(F=r.unstable_now(),typeof Tt=="function"){p.callback=Tt,A(F),Y=!0;break e}p===e(u)&&n(u),A(F)}else n(u);p=e(u)}if(p!==null)Y=!0;else{var O=e(d);O!==null&&mt(R,O.startTime-F),Y=!1}}break t}finally{p=null,g=tt,y=!1}Y=void 0}}finally{Y?q():L=!1}}}var q;if(typeof v=="function")q=function(){v(J)};else if(typeof MessageChannel<"u"){var ft=new MessageChannel,Mt=ft.port2;ft.port1.onmessage=J,q=function(){Mt.postMessage(null)}}else q=function(){M(J,0)};function mt(F,Y){D=M(function(){F(r.unstable_now())},Y)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(F){F.callback=null},r.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<F?Math.floor(1e3/F):5},r.unstable_getCurrentPriorityLevel=function(){return g},r.unstable_next=function(F){switch(g){case 1:case 2:case 3:var Y=3;break;default:Y=g}var tt=g;g=Y;try{return F()}finally{g=tt}},r.unstable_requestPaint=function(){T=!0},r.unstable_runWithPriority=function(F,Y){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var tt=g;g=F;try{return Y()}finally{g=tt}},r.unstable_scheduleCallback=function(F,Y,tt){var lt=r.unstable_now();switch(typeof tt=="object"&&tt!==null?(tt=tt.delay,tt=typeof tt=="number"&&0<tt?lt+tt:lt):tt=lt,F){case 1:var Tt=-1;break;case 2:Tt=250;break;case 5:Tt=1073741823;break;case 4:Tt=1e4;break;default:Tt=5e3}return Tt=tt+Tt,F={id:f++,callback:Y,priorityLevel:F,startTime:tt,expirationTime:Tt,sortIndex:-1},tt>lt?(F.sortIndex=tt,t(d,F),e(u)===null&&F===e(d)&&(S?(N(D),D=-1):S=!0,mt(R,tt-lt))):(F.sortIndex=Tt,t(u,F),x||y||(x=!0,L||(L=!0,q()))),F},r.unstable_shouldYield=P,r.unstable_wrapCallback=function(F){var Y=g;return function(){var tt=g;g=Y;try{return F.apply(this,arguments)}finally{g=tt}}}})(tS)),tS}var gN;function CF(){return gN||(gN=1,Jb.exports=EF()),Jb.exports}var eS={exports:{}},Me={};var yN;function DF(){if(yN)return Me;yN=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),a=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),g=Symbol.iterator;function y(O){return O===null||typeof O!="object"?null:(O=g&&O[g]||O["@@iterator"],typeof O=="function"?O:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,T={};function M(O,et,z){this.props=O,this.context=et,this.refs=T,this.updater=z||x}M.prototype.isReactComponent={},M.prototype.setState=function(O,et){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,et,"setState")},M.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function N(){}N.prototype=M.prototype;function v(O,et,z){this.props=O,this.context=et,this.refs=T,this.updater=z||x}var A=v.prototype=new N;A.constructor=v,S(A,M.prototype),A.isPureReactComponent=!0;var R=Array.isArray;function L(){}var D={H:null,A:null,T:null,S:null},U=Object.prototype.hasOwnProperty;function B(O,et,z){var W=z.ref;return{$$typeof:r,type:O,key:et,ref:W!==void 0?W:null,props:z}}function P(O,et){return B(O.type,et,O.props)}function J(O){return typeof O=="object"&&O!==null&&O.$$typeof===r}function q(O){var et={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(z){return et[z]})}var ft=/\/+/g;function Mt(O,et){return typeof O=="object"&&O!==null&&O.key!=null?q(""+O.key):et.toString(36)}function mt(O){switch(O.status){case"fulfilled":return O.value;case"rejected":throw O.reason;default:switch(typeof O.status=="string"?O.then(L,L):(O.status="pending",O.then(function(et){O.status==="pending"&&(O.status="fulfilled",O.value=et)},function(et){O.status==="pending"&&(O.status="rejected",O.reason=et)})),O.status){case"fulfilled":return O.value;case"rejected":throw O.reason}}throw O}function F(O,et,z,W,yt){var K=typeof O;(K==="undefined"||K==="boolean")&&(O=null);var Z=!1;if(O===null)Z=!0;else switch(K){case"bigint":case"string":case"number":Z=!0;break;case"object":switch(O.$$typeof){case r:case t:Z=!0;break;case f:return Z=O._init,F(Z(O._payload),et,z,W,yt)}}if(Z)return yt=yt(O),Z=W===""?"."+Mt(O,0):W,R(yt)?(z="",Z!=null&&(z=Z.replace(ft,"$&/")+"/"),F(yt,et,z,"",function(ct){return ct})):yt!=null&&(J(yt)&&(yt=P(yt,z+(yt.key==null||O&&O.key===yt.key?"":(""+yt.key).replace(ft,"$&/")+"/")+Z)),et.push(yt)),1;Z=0;var H=W===""?".":W+":";if(R(O))for(var j=0;j<O.length;j++)W=O[j],K=H+Mt(W,j),Z+=F(W,et,z,K,yt);else if(j=y(O),typeof j=="function")for(O=j.call(O),j=0;!(W=O.next()).done;)W=W.value,K=H+Mt(W,j++),Z+=F(W,et,z,K,yt);else if(K==="object"){if(typeof O.then=="function")return F(mt(O),et,z,W,yt);throw et=String(O),Error("Objects are not valid as a React child (found: "+(et==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":et)+"). If you meant to render a collection of children, use an array instead.")}return Z}function Y(O,et,z){if(O==null)return O;var W=[],yt=0;return F(O,W,"","",function(K){return et.call(z,K,yt++)}),W}function tt(O){if(O._status===-1){var et=O._result;et=et(),et.then(function(z){(O._status===0||O._status===-1)&&(O._status=1,O._result=z)},function(z){(O._status===0||O._status===-1)&&(O._status=2,O._result=z)}),O._status===-1&&(O._status=0,O._result=et)}if(O._status===1)return O._result.default;throw O._result}var lt=typeof reportError=="function"?reportError:function(O){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var et=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof O=="object"&&O!==null&&typeof O.message=="string"?String(O.message):String(O),error:O});if(!window.dispatchEvent(et))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",O);return}console.error(O)},Tt={map:Y,forEach:function(O,et,z){Y(O,function(){et.apply(this,arguments)},z)},count:function(O){var et=0;return Y(O,function(){et++}),et},toArray:function(O){return Y(O,function(et){return et})||[]},only:function(O){if(!J(O))throw Error("React.Children.only expected to receive a single React element child.");return O}};return Me.Activity=p,Me.Children=Tt,Me.Component=M,Me.Fragment=e,Me.Profiler=s,Me.PureComponent=v,Me.StrictMode=n,Me.Suspense=u,Me.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,Me.__COMPILER_RUNTIME={__proto__:null,c:function(O){return D.H.useMemoCache(O)}},Me.cache=function(O){return function(){return O.apply(null,arguments)}},Me.cacheSignal=function(){return null},Me.cloneElement=function(O,et,z){if(O==null)throw Error("The argument must be a React element, but you passed "+O+".");var W=S({},O.props),yt=O.key;if(et!=null)for(K in et.key!==void 0&&(yt=""+et.key),et)!U.call(et,K)||K==="key"||K==="__self"||K==="__source"||K==="ref"&&et.ref===void 0||(W[K]=et[K]);var K=arguments.length-2;if(K===1)W.children=z;else if(1<K){for(var Z=Array(K),H=0;H<K;H++)Z[H]=arguments[H+2];W.children=Z}return B(O.type,yt,W)},Me.createContext=function(O){return O={$$typeof:a,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null},O.Provider=O,O.Consumer={$$typeof:i,_context:O},O},Me.createElement=function(O,et,z){var W,yt={},K=null;if(et!=null)for(W in et.key!==void 0&&(K=""+et.key),et)U.call(et,W)&&W!=="key"&&W!=="__self"&&W!=="__source"&&(yt[W]=et[W]);var Z=arguments.length-2;if(Z===1)yt.children=z;else if(1<Z){for(var H=Array(Z),j=0;j<Z;j++)H[j]=arguments[j+2];yt.children=H}if(O&&O.defaultProps)for(W in Z=O.defaultProps,Z)yt[W]===void 0&&(yt[W]=Z[W]);return B(O,K,yt)},Me.createRef=function(){return{current:null}},Me.forwardRef=function(O){return{$$typeof:c,render:O}},Me.isValidElement=J,Me.lazy=function(O){return{$$typeof:f,_payload:{_status:-1,_result:O},_init:tt}},Me.memo=function(O,et){return{$$typeof:d,type:O,compare:et===void 0?null:et}},Me.startTransition=function(O){var et=D.T,z={};D.T=z;try{var W=O(),yt=D.S;yt!==null&&yt(z,W),typeof W=="object"&&W!==null&&typeof W.then=="function"&&W.then(L,lt)}catch(K){lt(K)}finally{et!==null&&z.types!==null&&(et.types=z.types),D.T=et}},Me.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},Me.use=function(O){return D.H.use(O)},Me.useActionState=function(O,et,z){return D.H.useActionState(O,et,z)},Me.useCallback=function(O,et){return D.H.useCallback(O,et)},Me.useContext=function(O){return D.H.useContext(O)},Me.useDebugValue=function(){},Me.useDeferredValue=function(O,et){return D.H.useDeferredValue(O,et)},Me.useEffect=function(O,et){return D.H.useEffect(O,et)},Me.useEffectEvent=function(O){return D.H.useEffectEvent(O)},Me.useId=function(){return D.H.useId()},Me.useImperativeHandle=function(O,et,z){return D.H.useImperativeHandle(O,et,z)},Me.useInsertionEffect=function(O,et){return D.H.useInsertionEffect(O,et)},Me.useLayoutEffect=function(O,et){return D.H.useLayoutEffect(O,et)},Me.useMemo=function(O,et){return D.H.useMemo(O,et)},Me.useOptimistic=function(O,et){return D.H.useOptimistic(O,et)},Me.useReducer=function(O,et,z){return D.H.useReducer(O,et,z)},Me.useRef=function(O){return D.H.useRef(O)},Me.useState=function(O){return D.H.useState(O)},Me.useSyncExternalStore=function(O,et,z){return D.H.useSyncExternalStore(O,et,z)},Me.useTransition=function(){return D.H.useTransition()},Me.version="19.2.4",Me}var xN;function Tw(){return xN||(xN=1,eS.exports=DF()),eS.exports}var nS={exports:{}},li={};var bN;function BF(){if(bN)return li;bN=1;var r=Tw();function t(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)d+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},s=Symbol.for("react.portal");function i(u,d,f){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:p==null?null:""+p,children:u,containerInfo:d,implementation:f}}var a=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(u,d){if(u==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return li.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,li.createPortal=function(u,d){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(t(299));return i(u,d,null,f)},li.flushSync=function(u){var d=a.T,f=n.p;try{if(a.T=null,n.p=2,u)return u()}finally{a.T=d,n.p=f,n.d.f()}},li.preconnect=function(u,d){typeof u=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,n.d.C(u,d))},li.prefetchDNS=function(u){typeof u=="string"&&n.d.D(u)},li.preinit=function(u,d){if(typeof u=="string"&&d&&typeof d.as=="string"){var f=d.as,p=c(f,d.crossOrigin),g=typeof d.integrity=="string"?d.integrity:void 0,y=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;f==="style"?n.d.S(u,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:p,integrity:g,fetchPriority:y}):f==="script"&&n.d.X(u,{crossOrigin:p,integrity:g,fetchPriority:y,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},li.preinitModule=function(u,d){if(typeof u=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var f=c(d.as,d.crossOrigin);n.d.M(u,{crossOrigin:f,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&n.d.M(u)},li.preload=function(u,d){if(typeof u=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var f=d.as,p=c(f,d.crossOrigin);n.d.L(u,f,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},li.preloadModule=function(u,d){if(typeof u=="string")if(d){var f=c(d.as,d.crossOrigin);n.d.m(u,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:f,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else n.d.m(u)},li.requestFormReset=function(u){n.d.r(u)},li.unstable_batchedUpdates=function(u,d){return u(d)},li.useFormState=function(u,d,f){return a.H.useFormState(u,d,f)},li.useFormStatus=function(){return a.H.useHostTransitionStatus()},li.version="19.2.4",li}var SN;function LF(){if(SN)return nS.exports;SN=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),nS.exports=BF(),nS.exports}var wN;function OF(){if(wN)return Nf;wN=1;var r=CF(),t=Tw(),e=LF();function n(o){var l="https://react.dev/errors/"+o;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)l+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+o+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function i(o){var l=o,h=o;if(o.alternate)for(;l.return;)l=l.return;else{o=l;do l=o,(l.flags&4098)!==0&&(h=l.return),o=l.return;while(o)}return l.tag===3?h:null}function a(o){if(o.tag===13){var l=o.memoizedState;if(l===null&&(o=o.alternate,o!==null&&(l=o.memoizedState)),l!==null)return l.dehydrated}return null}function c(o){if(o.tag===31){var l=o.memoizedState;if(l===null&&(o=o.alternate,o!==null&&(l=o.memoizedState)),l!==null)return l.dehydrated}return null}function u(o){if(i(o)!==o)throw Error(n(188))}function d(o){var l=o.alternate;if(!l){if(l=i(o),l===null)throw Error(n(188));return l!==o?null:o}for(var h=o,m=l;;){var b=h.return;if(b===null)break;var w=b.alternate;if(w===null){if(m=b.return,m!==null){h=m;continue}break}if(b.child===w.child){for(w=b.child;w;){if(w===h)return u(b),o;if(w===m)return u(b),l;w=w.sibling}throw Error(n(188))}if(h.return!==m.return)h=b,m=w;else{for(var E=!1,I=b.child;I;){if(I===h){E=!0,h=b,m=w;break}if(I===m){E=!0,m=b,h=w;break}I=I.sibling}if(!E){for(I=w.child;I;){if(I===h){E=!0,h=w,m=b;break}if(I===m){E=!0,m=w,h=b;break}I=I.sibling}if(!E)throw Error(n(189))}}if(h.alternate!==m)throw Error(n(190))}if(h.tag!==3)throw Error(n(188));return h.stateNode.current===h?o:l}function f(o){var l=o.tag;if(l===5||l===26||l===27||l===6)return o;for(o=o.child;o!==null;){if(l=f(o),l!==null)return l;o=o.sibling}return null}var p=Object.assign,g=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),N=Symbol.for("react.consumer"),v=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),J=Symbol.iterator;function q(o){return o===null||typeof o!="object"?null:(o=J&&o[J]||o["@@iterator"],typeof o=="function"?o:null)}var ft=Symbol.for("react.client.reference");function Mt(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===ft?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case S:return"Fragment";case M:return"Profiler";case T:return"StrictMode";case R:return"Suspense";case L:return"SuspenseList";case B:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case x:return"Portal";case v:return o.displayName||"Context";case N:return(o._context.displayName||"Context")+".Consumer";case A:var l=o.render;return o=o.displayName,o||(o=l.displayName||l.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case D:return l=o.displayName||null,l!==null?l:Mt(o.type)||"Memo";case U:l=o._payload,o=o._init;try{return Mt(o(l))}catch{}}return null}var mt=Array.isArray,F=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Y=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,tt={pending:!1,data:null,method:null,action:null},lt=[],Tt=-1;function O(o){return{current:o}}function et(o){0>Tt||(o.current=lt[Tt],lt[Tt]=null,Tt--)}function z(o,l){Tt++,lt[Tt]=o.current,o.current=l}var W=O(null),yt=O(null),K=O(null),Z=O(null);function H(o,l){switch(z(K,l),z(yt,o),z(W,null),l.nodeType){case 9:case 11:o=(o=l.documentElement)&&(o=o.namespaceURI)?UA(o):0;break;default:if(o=l.tagName,l=l.namespaceURI)l=UA(l),o=PA(l,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}et(W),z(W,o)}function j(){et(W),et(yt),et(K)}function ct(o){o.memoizedState!==null&&z(Z,o);var l=W.current,h=PA(l,o.type);l!==h&&(z(yt,o),z(W,h))}function xt(o){yt.current===o&&(et(W),et(yt)),Z.current===o&&(et(Z),Tf._currentValue=tt)}var at,ut;function $(o){if(at===void 0)try{throw Error()}catch(h){var l=h.stack.trim().match(/\n( *(at )?)/);at=l&&l[1]||"",ut=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+at+o+ut}var nt=!1;function ht(o,l){if(!o||nt)return"";nt=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(l){var It=function(){throw Error()};if(Object.defineProperty(It.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(It,[])}catch(Ct){var Et=Ct}Reflect.construct(o,[],It)}else{try{It.call()}catch(Ct){Et=Ct}o.call(It.prototype)}}else{try{throw Error()}catch(Ct){Et=Ct}(It=o())&&typeof It.catch=="function"&&It.catch(function(){})}}catch(Ct){if(Ct&&Et&&typeof Ct.stack=="string")return[Ct.stack,Et.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=m.DetermineComponentFrameRoot(),E=w[0],I=w[1];if(E&&I){var it=E.split(`
`),Nt=I.split(`
`);for(b=m=0;m<it.length&&!it[m].includes("DetermineComponentFrameRoot");)m++;for(;b<Nt.length&&!Nt[b].includes("DetermineComponentFrameRoot");)b++;if(m===it.length||b===Nt.length)for(m=it.length-1,b=Nt.length-1;1<=m&&0<=b&&it[m]!==Nt[b];)b--;for(;1<=m&&0<=b;m--,b--)if(it[m]!==Nt[b]){if(m!==1||b!==1)do if(m--,b--,0>b||it[m]!==Nt[b]){var Ot=`
`+it[m].replace(" at new "," at ");return o.displayName&&Ot.includes("<anonymous>")&&(Ot=Ot.replace("<anonymous>",o.displayName)),Ot}while(1<=m&&0<=b);break}}}finally{nt=!1,Error.prepareStackTrace=h}return(h=o?o.displayName||o.name:"")?$(h):""}function dt(o,l){switch(o.tag){case 26:case 27:case 5:return $(o.type);case 16:return $("Lazy");case 13:return o.child!==l&&l!==null?$("Suspense Fallback"):$("Suspense");case 19:return $("SuspenseList");case 0:case 15:return ht(o.type,!1);case 11:return ht(o.type.render,!1);case 1:return ht(o.type,!0);case 31:return $("Activity");default:return""}}function pt(o){try{var l="",h=null;do l+=dt(o,h),h=o,o=o.return;while(o);return l}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var Rt=Object.prototype.hasOwnProperty,Ft=r.unstable_scheduleCallback,Gt=r.unstable_cancelCallback,ae=r.unstable_shouldYield,Kt=r.unstable_requestPaint,jt=r.unstable_now,ce=r.unstable_getCurrentPriorityLevel,ee=r.unstable_ImmediatePriority,Re=r.unstable_UserBlockingPriority,je=r.unstable_NormalPriority,pn=r.unstable_LowPriority,os=r.unstable_IdlePriority,jn=r.log,Yn=r.unstable_setDisableYieldValue,we=null,Ye=null;function Dn(o){if(typeof jn=="function"&&Yn(o),Ye&&typeof Ye.setStrictMode=="function")try{Ye.setStrictMode(we,o)}catch{}}var Ge=Math.clz32?Math.clz32:_e,as=Math.log,Te=Math.LN2;function _e(o){return o>>>=0,o===0?32:31-(as(o)/Te|0)|0}var Kn=256,ls=262144,Bn=4194304;function Ee(o){var l=o&42;if(l!==0)return l;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return o&261888;case 262144:case 524288:case 1048576:case 2097152:return o&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function ke(o,l,h){var m=o.pendingLanes;if(m===0)return 0;var b=0,w=o.suspendedLanes,E=o.pingedLanes;o=o.warmLanes;var I=m&134217727;return I!==0?(m=I&~w,m!==0?b=Ee(m):(E&=I,E!==0?b=Ee(E):h||(h=I&~o,h!==0&&(b=Ee(h))))):(I=m&~w,I!==0?b=Ee(I):E!==0?b=Ee(E):h||(h=m&~o,h!==0&&(b=Ee(h)))),b===0?0:l!==0&&l!==b&&(l&w)===0&&(w=b&-b,h=l&-l,w>=h||w===32&&(h&4194048)!==0)?l:b}function $e(o,l){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&l)===0}function js(o,l){switch(o){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oo(){var o=Bn;return Bn<<=1,(Bn&62914560)===0&&(Bn=4194304),o}function Rr(o){for(var l=[],h=0;31>h;h++)l.push(o);return l}function Ui(o,l){o.pendingLanes|=l,l!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function Do(o,l,h,m,b,w){var E=o.pendingLanes;o.pendingLanes=h,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=h,o.entangledLanes&=h,o.errorRecoveryDisabledLanes&=h,o.shellSuspendCounter=0;var I=o.entanglements,it=o.expirationTimes,Nt=o.hiddenUpdates;for(h=E&~h;0<h;){var Ot=31-Ge(h),It=1<<Ot;I[Ot]=0,it[Ot]=-1;var Et=Nt[Ot];if(Et!==null)for(Nt[Ot]=null,Ot=0;Ot<Et.length;Ot++){var Ct=Et[Ot];Ct!==null&&(Ct.lane&=-536870913)}h&=~It}m!==0&&ao(o,m,0),w!==0&&b===0&&o.tag!==0&&(o.suspendedLanes|=w&~(E&~l))}function ao(o,l,h){o.pendingLanes|=l,o.suspendedLanes&=~l;var m=31-Ge(l);o.entangledLanes|=l,o.entanglements[m]=o.entanglements[m]|1073741824|h&261930}function Pd(o,l){var h=o.entangledLanes|=l;for(o=o.entanglements;h;){var m=31-Ge(h),b=1<<m;b&l|o[m]&l&&(o[m]|=l),h&=~b}}function Ys(o,l){var h=l&-l;return h=(h&42)!==0?1:_i(h),(h&(o.suspendedLanes|l))!==0?0:h}function _i(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function ba(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function lo(){var o=Y.p;return o!==0?o:(o=window.event,o===void 0?32:oN(o.type))}function gl(o,l){var h=Y.p;try{return Y.p=o,l()}finally{Y.p=h}}var Pi=Math.random().toString(36).slice(2),Zn="__reactFiber$"+Pi,Ts="__reactProps$"+Pi,Mi="__reactContainer$"+Pi,Er="__reactEvents$"+Pi,Bo="__reactListeners$"+Pi,Hc="__reactHandles$"+Pi,yl="__reactResources$"+Pi,co="__reactMarker$"+Pi;function Sa(o){delete o[Zn],delete o[Ts],delete o[Er],delete o[Bo],delete o[Hc]}function Cr(o){var l=o[Zn];if(l)return l;for(var h=o.parentNode;h;){if(l=h[Mi]||h[Zn]){if(h=l.alternate,l.child!==null||h!==null&&h.child!==null)for(o=WA(o);o!==null;){if(h=o[Zn])return h;o=WA(o)}return l}o=h,h=o.parentNode}return null}function Dr(o){if(o=o[Zn]||o[Mi]){var l=o.tag;if(l===5||l===6||l===13||l===31||l===26||l===27||l===3)return o}return null}function uo(o){var l=o.tag;if(l===5||l===26||l===27||l===6)return o.stateNode;throw Error(n(33))}function vi(o){var l=o[yl];return l||(l=o[yl]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function vn(o){o[co]=!0}var zi=new Set,Ks={};function ar(o,l){Vs(o,l),Vs(o+"Capture",l)}function Vs(o,l){for(Ks[o]=l,o=0;o<l.length;o++)zi.add(l[o])}var Wc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),xl={},N_={};function bL(o){return Rt.call(N_,o)?!0:Rt.call(xl,o)?!1:Wc.test(o)?N_[o]=!0:(xl[o]=!0,!1)}function s0(o,l,h){if(bL(l))if(h===null)o.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":o.removeAttribute(l);return;case"boolean":var m=l.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){o.removeAttribute(l);return}}o.setAttribute(l,""+h)}}function i0(o,l,h){if(h===null)o.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(l);return}o.setAttribute(l,""+h)}}function wa(o,l,h,m){if(m===null)o.removeAttribute(h);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(h);return}o.setAttributeNS(l,h,""+m)}}function Br(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function R_(o){var l=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function SL(o,l,h){var m=Object.getOwnPropertyDescriptor(o.constructor.prototype,l);if(!o.hasOwnProperty(l)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var b=m.get,w=m.set;return Object.defineProperty(o,l,{configurable:!0,get:function(){return b.call(this)},set:function(E){h=""+E,w.call(this,E)}}),Object.defineProperty(o,l,{enumerable:m.enumerable}),{getValue:function(){return h},setValue:function(E){h=""+E},stopTracking:function(){o._valueTracker=null,delete o[l]}}}}function Wx(o){if(!o._valueTracker){var l=R_(o)?"checked":"value";o._valueTracker=SL(o,l,""+o[l])}}function E_(o){if(!o)return!1;var l=o._valueTracker;if(!l)return!0;var h=l.getValue(),m="";return o&&(m=R_(o)?o.checked?"true":"false":o.value),o=m,o!==h?(l.setValue(o),!0):!1}function r0(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var wL=/[\n"\\]/g;function Lr(o){return o.replace(wL,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function qx(o,l,h,m,b,w,E,I){o.name="",E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?o.type=E:o.removeAttribute("type"),l!=null?E==="number"?(l===0&&o.value===""||o.value!=l)&&(o.value=""+Br(l)):o.value!==""+Br(l)&&(o.value=""+Br(l)):E!=="submit"&&E!=="reset"||o.removeAttribute("value"),l!=null?$x(o,E,Br(l)):h!=null?$x(o,E,Br(h)):m!=null&&o.removeAttribute("value"),b==null&&w!=null&&(o.defaultChecked=!!w),b!=null&&(o.checked=b&&typeof b!="function"&&typeof b!="symbol"),I!=null&&typeof I!="function"&&typeof I!="symbol"&&typeof I!="boolean"?o.name=""+Br(I):o.removeAttribute("name")}function C_(o,l,h,m,b,w,E,I){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(o.type=w),l!=null||h!=null){if(!(w!=="submit"&&w!=="reset"||l!=null)){Wx(o);return}h=h!=null?""+Br(h):"",l=l!=null?""+Br(l):h,I||l===o.value||(o.value=l),o.defaultValue=l}m=m??b,m=typeof m!="function"&&typeof m!="symbol"&&!!m,o.checked=I?o.checked:!!m,o.defaultChecked=!!m,E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(o.name=E),Wx(o)}function $x(o,l,h){l==="number"&&r0(o.ownerDocument)===o||o.defaultValue===""+h||(o.defaultValue=""+h)}function Ku(o,l,h,m){if(o=o.options,l){l={};for(var b=0;b<h.length;b++)l["$"+h[b]]=!0;for(h=0;h<o.length;h++)b=l.hasOwnProperty("$"+o[h].value),o[h].selected!==b&&(o[h].selected=b),b&&m&&(o[h].defaultSelected=!0)}else{for(h=""+Br(h),l=null,b=0;b<o.length;b++){if(o[b].value===h){o[b].selected=!0,m&&(o[b].defaultSelected=!0);return}l!==null||o[b].disabled||(l=o[b])}l!==null&&(l.selected=!0)}}function D_(o,l,h){if(l!=null&&(l=""+Br(l),l!==o.value&&(o.value=l),h==null)){o.defaultValue!==l&&(o.defaultValue=l);return}o.defaultValue=h!=null?""+Br(h):""}function B_(o,l,h,m){if(l==null){if(m!=null){if(h!=null)throw Error(n(92));if(mt(m)){if(1<m.length)throw Error(n(93));m=m[0]}h=m}h==null&&(h=""),l=h}h=Br(l),o.defaultValue=h,m=o.textContent,m===h&&m!==""&&m!==null&&(o.value=m),Wx(o)}function Zu(o,l){if(l){var h=o.firstChild;if(h&&h===o.lastChild&&h.nodeType===3){h.nodeValue=l;return}}o.textContent=l}var TL=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function L_(o,l,h){var m=l.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?m?o.setProperty(l,""):l==="float"?o.cssFloat="":o[l]="":m?o.setProperty(l,h):typeof h!="number"||h===0||TL.has(l)?l==="float"?o.cssFloat=h:o[l]=(""+h).trim():o[l]=h+"px"}function O_(o,l,h){if(l!=null&&typeof l!="object")throw Error(n(62));if(o=o.style,h!=null){for(var m in h)!h.hasOwnProperty(m)||l!=null&&l.hasOwnProperty(m)||(m.indexOf("--")===0?o.setProperty(m,""):m==="float"?o.cssFloat="":o[m]="");for(var b in l)m=l[b],l.hasOwnProperty(b)&&h[b]!==m&&L_(o,b,m)}else for(var w in l)l.hasOwnProperty(w)&&L_(o,w,l[w])}function Xx(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _L=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ML=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function o0(o){return ML.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}function Ta(){}var jx=null;function Yx(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Qu=null,Ju=null;function F_(o){var l=Dr(o);if(l&&(o=l.stateNode)){var h=o[Ts]||null;t:switch(o=l.stateNode,l.type){case"input":if(qx(o,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),l=h.name,h.type==="radio"&&l!=null){for(h=o;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+Lr(""+l)+'"][type="radio"]'),l=0;l<h.length;l++){var m=h[l];if(m!==o&&m.form===o.form){var b=m[Ts]||null;if(!b)throw Error(n(90));qx(m,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(l=0;l<h.length;l++)m=h[l],m.form===o.form&&E_(m)}break t;case"textarea":D_(o,h.value,h.defaultValue);break t;case"select":l=h.value,l!=null&&Ku(o,!!h.multiple,l,!1)}}}var Kx=!1;function U_(o,l,h){if(Kx)return o(l,h);Kx=!0;try{var m=o(l);return m}finally{if(Kx=!1,(Qu!==null||Ju!==null)&&(X0(),Qu&&(l=Qu,o=Ju,Ju=Qu=null,F_(l),o)))for(l=0;l<o.length;l++)F_(o[l])}}function zd(o,l){var h=o.stateNode;if(h===null)return null;var m=h[Ts]||null;if(m===null)return null;h=m[l];t:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(o=o.type,m=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!m;break t;default:o=!1}if(o)return null;if(h&&typeof h!="function")throw Error(n(231,l,typeof h));return h}var _a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Zx=!1;if(_a)try{var Id={};Object.defineProperty(Id,"passive",{get:function(){Zx=!0}}),window.addEventListener("test",Id,Id),window.removeEventListener("test",Id,Id)}catch{Zx=!1}var bl=null,Qx=null,a0=null;function P_(){if(a0)return a0;var o,l=Qx,h=l.length,m,b="value"in bl?bl.value:bl.textContent,w=b.length;for(o=0;o<h&&l[o]===b[o];o++);var E=h-o;for(m=1;m<=E&&l[h-m]===b[w-m];m++);return a0=b.slice(o,1<m?1-m:void 0)}function l0(o){var l=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&l===13&&(o=13)):o=l,o===10&&(o=13),32<=o||o===13?o:0}function c0(){return!0}function z_(){return!1}function Ii(o){function l(h,m,b,w,E){this._reactName=h,this._targetInst=b,this.type=m,this.nativeEvent=w,this.target=E,this.currentTarget=null;for(var I in o)o.hasOwnProperty(I)&&(h=o[I],this[I]=h?h(w):w[I]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?c0:z_,this.isPropagationStopped=z_,this}return p(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=c0)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=c0)},persist:function(){},isPersistent:c0}),l}var qc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},u0=Ii(qc),Vd=p({},qc,{view:0,detail:0}),vL=Ii(Vd),Jx,t1,Gd,h0=p({},Vd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:n1,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Gd&&(Gd&&o.type==="mousemove"?(Jx=o.screenX-Gd.screenX,t1=o.screenY-Gd.screenY):t1=Jx=0,Gd=o),Jx)},movementY:function(o){return"movementY"in o?o.movementY:t1}}),I_=Ii(h0),AL=p({},h0,{dataTransfer:0}),NL=Ii(AL),RL=p({},Vd,{relatedTarget:0}),e1=Ii(RL),EL=p({},qc,{animationName:0,elapsedTime:0,pseudoElement:0}),CL=Ii(EL),DL=p({},qc,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),BL=Ii(DL),LL=p({},qc,{data:0}),V_=Ii(LL),OL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},FL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},UL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function PL(o){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(o):(o=UL[o])?!!l[o]:!1}function n1(){return PL}var zL=p({},Vd,{key:function(o){if(o.key){var l=OL[o.key]||o.key;if(l!=="Unidentified")return l}return o.type==="keypress"?(o=l0(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?FL[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:n1,charCode:function(o){return o.type==="keypress"?l0(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?l0(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),IL=Ii(zL),VL=p({},h0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),G_=Ii(VL),GL=p({},Vd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:n1}),kL=Ii(GL),HL=p({},qc,{propertyName:0,elapsedTime:0,pseudoElement:0}),WL=Ii(HL),qL=p({},h0,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),$L=Ii(qL),XL=p({},qc,{newState:0,oldState:0}),jL=Ii(XL),YL=[9,13,27,32],s1=_a&&"CompositionEvent"in window,kd=null;_a&&"documentMode"in document&&(kd=document.documentMode);var KL=_a&&"TextEvent"in window&&!kd,k_=_a&&(!s1||kd&&8<kd&&11>=kd),H_=" ",W_=!1;function q_(o,l){switch(o){case"keyup":return YL.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $_(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var th=!1;function ZL(o,l){switch(o){case"compositionend":return $_(l);case"keypress":return l.which!==32?null:(W_=!0,H_);case"textInput":return o=l.data,o===H_&&W_?null:o;default:return null}}function QL(o,l){if(th)return o==="compositionend"||!s1&&q_(o,l)?(o=P_(),a0=Qx=bl=null,th=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return k_&&l.locale!=="ko"?null:l.data;default:return null}}var JL={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function X_(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l==="input"?!!JL[o.type]:l==="textarea"}function j_(o,l,h,m){Qu?Ju?Ju.push(m):Ju=[m]:Qu=m,l=tm(l,"onChange"),0<l.length&&(h=new u0("onChange","change",null,h,m),o.push({event:h,listeners:l}))}var Hd=null,Wd=null;function tO(o){CA(o,0)}function d0(o){var l=uo(o);if(E_(l))return o}function Y_(o,l){if(o==="change")return l}var K_=!1;if(_a){var i1;if(_a){var r1="oninput"in document;if(!r1){var Z_=document.createElement("div");Z_.setAttribute("oninput","return;"),r1=typeof Z_.oninput=="function"}i1=r1}else i1=!1;K_=i1&&(!document.documentMode||9<document.documentMode)}function Q_(){Hd&&(Hd.detachEvent("onpropertychange",J_),Wd=Hd=null)}function J_(o){if(o.propertyName==="value"&&d0(Wd)){var l=[];j_(l,Wd,o,Yx(o)),U_(tO,l)}}function eO(o,l,h){o==="focusin"?(Q_(),Hd=l,Wd=h,Hd.attachEvent("onpropertychange",J_)):o==="focusout"&&Q_()}function nO(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return d0(Wd)}function sO(o,l){if(o==="click")return d0(l)}function iO(o,l){if(o==="input"||o==="change")return d0(l)}function rO(o,l){return o===l&&(o!==0||1/o===1/l)||o!==o&&l!==l}var lr=typeof Object.is=="function"?Object.is:rO;function qd(o,l){if(lr(o,l))return!0;if(typeof o!="object"||o===null||typeof l!="object"||l===null)return!1;var h=Object.keys(o),m=Object.keys(l);if(h.length!==m.length)return!1;for(m=0;m<h.length;m++){var b=h[m];if(!Rt.call(l,b)||!lr(o[b],l[b]))return!1}return!0}function tM(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function eM(o,l){var h=tM(o);o=0;for(var m;h;){if(h.nodeType===3){if(m=o+h.textContent.length,o<=l&&m>=l)return{node:h,offset:l-o};o=m}t:{for(;h;){if(h.nextSibling){h=h.nextSibling;break t}h=h.parentNode}h=void 0}h=tM(h)}}function nM(o,l){return o&&l?o===l?!0:o&&o.nodeType===3?!1:l&&l.nodeType===3?nM(o,l.parentNode):"contains"in o?o.contains(l):o.compareDocumentPosition?!!(o.compareDocumentPosition(l)&16):!1:!1}function sM(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var l=r0(o.document);l instanceof o.HTMLIFrameElement;){try{var h=typeof l.contentWindow.location.href=="string"}catch{h=!1}if(h)o=l.contentWindow;else break;l=r0(o.document)}return l}function o1(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l&&(l==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||l==="textarea"||o.contentEditable==="true")}var oO=_a&&"documentMode"in document&&11>=document.documentMode,eh=null,a1=null,$d=null,l1=!1;function iM(o,l,h){var m=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;l1||eh==null||eh!==r0(m)||(m=eh,"selectionStart"in m&&o1(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),$d&&qd($d,m)||($d=m,m=tm(a1,"onSelect"),0<m.length&&(l=new u0("onSelect","select",null,l,h),o.push({event:l,listeners:m}),l.target=eh)))}function $c(o,l){var h={};return h[o.toLowerCase()]=l.toLowerCase(),h["Webkit"+o]="webkit"+l,h["Moz"+o]="moz"+l,h}var nh={animationend:$c("Animation","AnimationEnd"),animationiteration:$c("Animation","AnimationIteration"),animationstart:$c("Animation","AnimationStart"),transitionrun:$c("Transition","TransitionRun"),transitionstart:$c("Transition","TransitionStart"),transitioncancel:$c("Transition","TransitionCancel"),transitionend:$c("Transition","TransitionEnd")},c1={},rM={};_a&&(rM=document.createElement("div").style,"AnimationEvent"in window||(delete nh.animationend.animation,delete nh.animationiteration.animation,delete nh.animationstart.animation),"TransitionEvent"in window||delete nh.transitionend.transition);function Xc(o){if(c1[o])return c1[o];if(!nh[o])return o;var l=nh[o],h;for(h in l)if(l.hasOwnProperty(h)&&h in rM)return c1[o]=l[h];return o}var oM=Xc("animationend"),aM=Xc("animationiteration"),lM=Xc("animationstart"),aO=Xc("transitionrun"),lO=Xc("transitionstart"),cO=Xc("transitioncancel"),cM=Xc("transitionend"),uM=new Map,u1="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");u1.push("scrollEnd");function ho(o,l){uM.set(o,l),ar(l,[o])}var f0=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)},Or=[],sh=0,h1=0;function p0(){for(var o=sh,l=h1=sh=0;l<o;){var h=Or[l];Or[l++]=null;var m=Or[l];Or[l++]=null;var b=Or[l];Or[l++]=null;var w=Or[l];if(Or[l++]=null,m!==null&&b!==null){var E=m.pending;E===null?b.next=b:(b.next=E.next,E.next=b),m.pending=b}w!==0&&hM(h,b,w)}}function m0(o,l,h,m){Or[sh++]=o,Or[sh++]=l,Or[sh++]=h,Or[sh++]=m,h1|=m,o.lanes|=m,o=o.alternate,o!==null&&(o.lanes|=m)}function d1(o,l,h,m){return m0(o,l,h,m),g0(o)}function jc(o,l){return m0(o,null,null,l),g0(o)}function hM(o,l,h){o.lanes|=h;var m=o.alternate;m!==null&&(m.lanes|=h);for(var b=!1,w=o.return;w!==null;)w.childLanes|=h,m=w.alternate,m!==null&&(m.childLanes|=h),w.tag===22&&(o=w.stateNode,o===null||o._visibility&1||(b=!0)),o=w,w=w.return;return o.tag===3?(w=o.stateNode,b&&l!==null&&(b=31-Ge(h),o=w.hiddenUpdates,m=o[b],m===null?o[b]=[l]:m.push(l),l.lane=h|536870912),w):null}function g0(o){if(50<mf)throw mf=0,wb=null,Error(n(185));for(var l=o.return;l!==null;)o=l,l=o.return;return o.tag===3?o.stateNode:null}var ih={};function uO(o,l,h,m){this.tag=o,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cr(o,l,h,m){return new uO(o,l,h,m)}function f1(o){return o=o.prototype,!(!o||!o.isReactComponent)}function Ma(o,l){var h=o.alternate;return h===null?(h=cr(o.tag,l,o.key,o.mode),h.elementType=o.elementType,h.type=o.type,h.stateNode=o.stateNode,h.alternate=o,o.alternate=h):(h.pendingProps=l,h.type=o.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=o.flags&65011712,h.childLanes=o.childLanes,h.lanes=o.lanes,h.child=o.child,h.memoizedProps=o.memoizedProps,h.memoizedState=o.memoizedState,h.updateQueue=o.updateQueue,l=o.dependencies,h.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},h.sibling=o.sibling,h.index=o.index,h.ref=o.ref,h.refCleanup=o.refCleanup,h}function dM(o,l){o.flags&=65011714;var h=o.alternate;return h===null?(o.childLanes=0,o.lanes=l,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=h.childLanes,o.lanes=h.lanes,o.child=h.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=h.memoizedProps,o.memoizedState=h.memoizedState,o.updateQueue=h.updateQueue,o.type=h.type,l=h.dependencies,o.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),o}function y0(o,l,h,m,b,w){var E=0;if(m=o,typeof o=="function")f1(o)&&(E=1);else if(typeof o=="string")E=mF(o,h,W.current)?26:o==="html"||o==="head"||o==="body"?27:5;else t:switch(o){case B:return o=cr(31,h,l,b),o.elementType=B,o.lanes=w,o;case S:return Yc(h.children,b,w,l);case T:E=8,b|=24;break;case M:return o=cr(12,h,l,b|2),o.elementType=M,o.lanes=w,o;case R:return o=cr(13,h,l,b),o.elementType=R,o.lanes=w,o;case L:return o=cr(19,h,l,b),o.elementType=L,o.lanes=w,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case v:E=10;break t;case N:E=9;break t;case A:E=11;break t;case D:E=14;break t;case U:E=16,m=null;break t}E=29,h=Error(n(130,o===null?"null":typeof o,"")),m=null}return l=cr(E,h,l,b),l.elementType=o,l.type=m,l.lanes=w,l}function Yc(o,l,h,m){return o=cr(7,o,m,l),o.lanes=h,o}function p1(o,l,h){return o=cr(6,o,null,l),o.lanes=h,o}function fM(o){var l=cr(18,null,null,0);return l.stateNode=o,l}function m1(o,l,h){return l=cr(4,o.children!==null?o.children:[],o.key,l),l.lanes=h,l.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},l}var pM=new WeakMap;function Fr(o,l){if(typeof o=="object"&&o!==null){var h=pM.get(o);return h!==void 0?h:(l={value:o,source:l,stack:pt(l)},pM.set(o,l),l)}return{value:o,source:l,stack:pt(l)}}var rh=[],oh=0,x0=null,Xd=0,Ur=[],Pr=0,Sl=null,Lo=1,Oo="";function va(o,l){rh[oh++]=Xd,rh[oh++]=x0,x0=o,Xd=l}function mM(o,l,h){Ur[Pr++]=Lo,Ur[Pr++]=Oo,Ur[Pr++]=Sl,Sl=o;var m=Lo;o=Oo;var b=32-Ge(m)-1;m&=~(1<<b),h+=1;var w=32-Ge(l)+b;if(30<w){var E=b-b%5;w=(m&(1<<E)-1).toString(32),m>>=E,b-=E,Lo=1<<32-Ge(l)+b|h<<b|m,Oo=w+o}else Lo=1<<w|h<<b|m,Oo=o}function g1(o){o.return!==null&&(va(o,1),mM(o,1,0))}function y1(o){for(;o===x0;)x0=rh[--oh],rh[oh]=null,Xd=rh[--oh],rh[oh]=null;for(;o===Sl;)Sl=Ur[--Pr],Ur[Pr]=null,Oo=Ur[--Pr],Ur[Pr]=null,Lo=Ur[--Pr],Ur[Pr]=null}function gM(o,l){Ur[Pr++]=Lo,Ur[Pr++]=Oo,Ur[Pr++]=Sl,Lo=l.id,Oo=l.overflow,Sl=o}var Zs=null,Un=null,He=!1,wl=null,zr=!1,x1=Error(n(519));function Tl(o){var l=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw jd(Fr(l,o)),x1}function yM(o){var l=o.stateNode,h=o.type,m=o.memoizedProps;switch(l[Zn]=o,l[Ts]=m,h){case"dialog":Ue("cancel",l),Ue("close",l);break;case"iframe":case"object":case"embed":Ue("load",l);break;case"video":case"audio":for(h=0;h<yf.length;h++)Ue(yf[h],l);break;case"source":Ue("error",l);break;case"img":case"image":case"link":Ue("error",l),Ue("load",l);break;case"details":Ue("toggle",l);break;case"input":Ue("invalid",l),C_(l,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":Ue("invalid",l);break;case"textarea":Ue("invalid",l),B_(l,m.value,m.defaultValue,m.children)}h=m.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||l.textContent===""+h||m.suppressHydrationWarning===!0||OA(l.textContent,h)?(m.popover!=null&&(Ue("beforetoggle",l),Ue("toggle",l)),m.onScroll!=null&&Ue("scroll",l),m.onScrollEnd!=null&&Ue("scrollend",l),m.onClick!=null&&(l.onclick=Ta),l=!0):l=!1,l||Tl(o,!0)}function xM(o){for(Zs=o.return;Zs;)switch(Zs.tag){case 5:case 31:case 13:zr=!1;return;case 27:case 3:zr=!0;return;default:Zs=Zs.return}}function ah(o){if(o!==Zs)return!1;if(!He)return xM(o),He=!0,!1;var l=o.tag,h;if((h=l!==3&&l!==27)&&((h=l===5)&&(h=o.type,h=!(h!=="form"&&h!=="button")||Ub(o.type,o.memoizedProps)),h=!h),h&&Un&&Tl(o),xM(o),l===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));Un=HA(o)}else if(l===31){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));Un=HA(o)}else l===27?(l=Un,Ul(o.type)?(o=Gb,Gb=null,Un=o):Un=l):Un=Zs?Vr(o.stateNode.nextSibling):null;return!0}function Kc(){Un=Zs=null,He=!1}function b1(){var o=wl;return o!==null&&(Hi===null?Hi=o:Hi.push.apply(Hi,o),wl=null),o}function jd(o){wl===null?wl=[o]:wl.push(o)}var S1=O(null),Zc=null,Aa=null;function _l(o,l,h){z(S1,l._currentValue),l._currentValue=h}function Na(o){o._currentValue=S1.current,et(S1)}function w1(o,l,h){for(;o!==null;){var m=o.alternate;if((o.childLanes&l)!==l?(o.childLanes|=l,m!==null&&(m.childLanes|=l)):m!==null&&(m.childLanes&l)!==l&&(m.childLanes|=l),o===h)break;o=o.return}}function T1(o,l,h,m){var b=o.child;for(b!==null&&(b.return=o);b!==null;){var w=b.dependencies;if(w!==null){var E=b.child;w=w.firstContext;t:for(;w!==null;){var I=w;w=b;for(var it=0;it<l.length;it++)if(I.context===l[it]){w.lanes|=h,I=w.alternate,I!==null&&(I.lanes|=h),w1(w.return,h,o),m||(E=null);break t}w=I.next}}else if(b.tag===18){if(E=b.return,E===null)throw Error(n(341));E.lanes|=h,w=E.alternate,w!==null&&(w.lanes|=h),w1(E,h,o),E=null}else E=b.child;if(E!==null)E.return=b;else for(E=b;E!==null;){if(E===o){E=null;break}if(b=E.sibling,b!==null){b.return=E.return,E=b;break}E=E.return}b=E}}function lh(o,l,h,m){o=null;for(var b=l,w=!1;b!==null;){if(!w){if((b.flags&524288)!==0)w=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var E=b.alternate;if(E===null)throw Error(n(387));if(E=E.memoizedProps,E!==null){var I=b.type;lr(b.pendingProps.value,E.value)||(o!==null?o.push(I):o=[I])}}else if(b===Z.current){if(E=b.alternate,E===null)throw Error(n(387));E.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(o!==null?o.push(Tf):o=[Tf])}b=b.return}o!==null&&T1(l,o,h,m),l.flags|=262144}function b0(o){for(o=o.firstContext;o!==null;){if(!lr(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Qc(o){Zc=o,Aa=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function Qs(o){return bM(Zc,o)}function S0(o,l){return Zc===null&&Qc(o),bM(o,l)}function bM(o,l){var h=l._currentValue;if(l={context:l,memoizedValue:h,next:null},Aa===null){if(o===null)throw Error(n(308));Aa=l,o.dependencies={lanes:0,firstContext:l},o.flags|=524288}else Aa=Aa.next=l;return h}var hO=typeof AbortController<"u"?AbortController:function(){var o=[],l=this.signal={aborted:!1,addEventListener:function(h,m){o.push(m)}};this.abort=function(){l.aborted=!0,o.forEach(function(h){return h()})}},dO=r.unstable_scheduleCallback,fO=r.unstable_NormalPriority,_s={$$typeof:v,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function _1(){return{controller:new hO,data:new Map,refCount:0}}function Yd(o){o.refCount--,o.refCount===0&&dO(fO,function(){o.controller.abort()})}var Kd=null,M1=0,ch=0,uh=null;function pO(o,l){if(Kd===null){var h=Kd=[];M1=0,ch=Nb(),uh={status:"pending",value:void 0,then:function(m){h.push(m)}}}return M1++,l.then(SM,SM),l}function SM(){if(--M1===0&&Kd!==null){uh!==null&&(uh.status="fulfilled");var o=Kd;Kd=null,ch=0,uh=null;for(var l=0;l<o.length;l++)(0,o[l])()}}function mO(o,l){var h=[],m={status:"pending",value:null,reason:null,then:function(b){h.push(b)}};return o.then(function(){m.status="fulfilled",m.value=l;for(var b=0;b<h.length;b++)(0,h[b])(l)},function(b){for(m.status="rejected",m.reason=b,b=0;b<h.length;b++)(0,h[b])(void 0)}),m}var wM=F.S;F.S=function(o,l){iA=jt(),typeof l=="object"&&l!==null&&typeof l.then=="function"&&pO(o,l),wM!==null&&wM(o,l)};var Jc=O(null);function v1(){var o=Jc.current;return o!==null?o:An.pooledCache}function w0(o,l){l===null?z(Jc,Jc.current):z(Jc,l.pool)}function TM(){var o=v1();return o===null?null:{parent:_s._currentValue,pool:o}}var hh=Error(n(460)),A1=Error(n(474)),T0=Error(n(542)),_0={then:function(){}};function _M(o){return o=o.status,o==="fulfilled"||o==="rejected"}function MM(o,l,h){switch(h=o[h],h===void 0?o.push(l):h!==l&&(l.then(Ta,Ta),l=h),l.status){case"fulfilled":return l.value;case"rejected":throw o=l.reason,AM(o),o;default:if(typeof l.status=="string")l.then(Ta,Ta);else{if(o=An,o!==null&&100<o.shellSuspendCounter)throw Error(n(482));o=l,o.status="pending",o.then(function(m){if(l.status==="pending"){var b=l;b.status="fulfilled",b.value=m}},function(m){if(l.status==="pending"){var b=l;b.status="rejected",b.reason=m}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw o=l.reason,AM(o),o}throw eu=l,hh}}function tu(o){try{var l=o._init;return l(o._payload)}catch(h){throw h!==null&&typeof h=="object"&&typeof h.then=="function"?(eu=h,hh):h}}var eu=null;function vM(){if(eu===null)throw Error(n(459));var o=eu;return eu=null,o}function AM(o){if(o===hh||o===T0)throw Error(n(483))}var dh=null,Zd=0;function M0(o){var l=Zd;return Zd+=1,dh===null&&(dh=[]),MM(dh,o,l)}function Qd(o,l){l=l.props.ref,o.ref=l!==void 0?l:null}function v0(o,l){throw l.$$typeof===g?Error(n(525)):(o=Object.prototype.toString.call(l),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":o)))}function NM(o){function l(wt,gt){if(o){var At=wt.deletions;At===null?(wt.deletions=[gt],wt.flags|=16):At.push(gt)}}function h(wt,gt){if(!o)return null;for(;gt!==null;)l(wt,gt),gt=gt.sibling;return null}function m(wt){for(var gt=new Map;wt!==null;)wt.key!==null?gt.set(wt.key,wt):gt.set(wt.index,wt),wt=wt.sibling;return gt}function b(wt,gt){return wt=Ma(wt,gt),wt.index=0,wt.sibling=null,wt}function w(wt,gt,At){return wt.index=At,o?(At=wt.alternate,At!==null?(At=At.index,At<gt?(wt.flags|=67108866,gt):At):(wt.flags|=67108866,gt)):(wt.flags|=1048576,gt)}function E(wt){return o&&wt.alternate===null&&(wt.flags|=67108866),wt}function I(wt,gt,At,Pt){return gt===null||gt.tag!==6?(gt=p1(At,wt.mode,Pt),gt.return=wt,gt):(gt=b(gt,At),gt.return=wt,gt)}function it(wt,gt,At,Pt){var ue=At.type;return ue===S?Ot(wt,gt,At.props.children,Pt,At.key):gt!==null&&(gt.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===U&&tu(ue)===gt.type)?(gt=b(gt,At.props),Qd(gt,At),gt.return=wt,gt):(gt=y0(At.type,At.key,At.props,null,wt.mode,Pt),Qd(gt,At),gt.return=wt,gt)}function Nt(wt,gt,At,Pt){return gt===null||gt.tag!==4||gt.stateNode.containerInfo!==At.containerInfo||gt.stateNode.implementation!==At.implementation?(gt=m1(At,wt.mode,Pt),gt.return=wt,gt):(gt=b(gt,At.children||[]),gt.return=wt,gt)}function Ot(wt,gt,At,Pt,ue){return gt===null||gt.tag!==7?(gt=Yc(At,wt.mode,Pt,ue),gt.return=wt,gt):(gt=b(gt,At),gt.return=wt,gt)}function It(wt,gt,At){if(typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint")return gt=p1(""+gt,wt.mode,At),gt.return=wt,gt;if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case y:return At=y0(gt.type,gt.key,gt.props,null,wt.mode,At),Qd(At,gt),At.return=wt,At;case x:return gt=m1(gt,wt.mode,At),gt.return=wt,gt;case U:return gt=tu(gt),It(wt,gt,At)}if(mt(gt)||q(gt))return gt=Yc(gt,wt.mode,At,null),gt.return=wt,gt;if(typeof gt.then=="function")return It(wt,M0(gt),At);if(gt.$$typeof===v)return It(wt,S0(wt,gt),At);v0(wt,gt)}return null}function Et(wt,gt,At,Pt){var ue=gt!==null?gt.key:null;if(typeof At=="string"&&At!==""||typeof At=="number"||typeof At=="bigint")return ue!==null?null:I(wt,gt,""+At,Pt);if(typeof At=="object"&&At!==null){switch(At.$$typeof){case y:return At.key===ue?it(wt,gt,At,Pt):null;case x:return At.key===ue?Nt(wt,gt,At,Pt):null;case U:return At=tu(At),Et(wt,gt,At,Pt)}if(mt(At)||q(At))return ue!==null?null:Ot(wt,gt,At,Pt,null);if(typeof At.then=="function")return Et(wt,gt,M0(At),Pt);if(At.$$typeof===v)return Et(wt,gt,S0(wt,At),Pt);v0(wt,At)}return null}function Ct(wt,gt,At,Pt,ue){if(typeof Pt=="string"&&Pt!==""||typeof Pt=="number"||typeof Pt=="bigint")return wt=wt.get(At)||null,I(gt,wt,""+Pt,ue);if(typeof Pt=="object"&&Pt!==null){switch(Pt.$$typeof){case y:return wt=wt.get(Pt.key===null?At:Pt.key)||null,it(gt,wt,Pt,ue);case x:return wt=wt.get(Pt.key===null?At:Pt.key)||null,Nt(gt,wt,Pt,ue);case U:return Pt=tu(Pt),Ct(wt,gt,At,Pt,ue)}if(mt(Pt)||q(Pt))return wt=wt.get(At)||null,Ot(gt,wt,Pt,ue,null);if(typeof Pt.then=="function")return Ct(wt,gt,At,M0(Pt),ue);if(Pt.$$typeof===v)return Ct(wt,gt,At,S0(gt,Pt),ue);v0(gt,Pt)}return null}function se(wt,gt,At,Pt){for(var ue=null,tn=null,oe=gt,Ce=gt=0,Ie=null;oe!==null&&Ce<At.length;Ce++){oe.index>Ce?(Ie=oe,oe=null):Ie=oe.sibling;var en=Et(wt,oe,At[Ce],Pt);if(en===null){oe===null&&(oe=Ie);break}o&&oe&&en.alternate===null&&l(wt,oe),gt=w(en,gt,Ce),tn===null?ue=en:tn.sibling=en,tn=en,oe=Ie}if(Ce===At.length)return h(wt,oe),He&&va(wt,Ce),ue;if(oe===null){for(;Ce<At.length;Ce++)oe=It(wt,At[Ce],Pt),oe!==null&&(gt=w(oe,gt,Ce),tn===null?ue=oe:tn.sibling=oe,tn=oe);return He&&va(wt,Ce),ue}for(oe=m(oe);Ce<At.length;Ce++)Ie=Ct(oe,wt,Ce,At[Ce],Pt),Ie!==null&&(o&&Ie.alternate!==null&&oe.delete(Ie.key===null?Ce:Ie.key),gt=w(Ie,gt,Ce),tn===null?ue=Ie:tn.sibling=Ie,tn=Ie);return o&&oe.forEach(function(Gl){return l(wt,Gl)}),He&&va(wt,Ce),ue}function pe(wt,gt,At,Pt){if(At==null)throw Error(n(151));for(var ue=null,tn=null,oe=gt,Ce=gt=0,Ie=null,en=At.next();oe!==null&&!en.done;Ce++,en=At.next()){oe.index>Ce?(Ie=oe,oe=null):Ie=oe.sibling;var Gl=Et(wt,oe,en.value,Pt);if(Gl===null){oe===null&&(oe=Ie);break}o&&oe&&Gl.alternate===null&&l(wt,oe),gt=w(Gl,gt,Ce),tn===null?ue=Gl:tn.sibling=Gl,tn=Gl,oe=Ie}if(en.done)return h(wt,oe),He&&va(wt,Ce),ue;if(oe===null){for(;!en.done;Ce++,en=At.next())en=It(wt,en.value,Pt),en!==null&&(gt=w(en,gt,Ce),tn===null?ue=en:tn.sibling=en,tn=en);return He&&va(wt,Ce),ue}for(oe=m(oe);!en.done;Ce++,en=At.next())en=Ct(oe,wt,Ce,en.value,Pt),en!==null&&(o&&en.alternate!==null&&oe.delete(en.key===null?Ce:en.key),gt=w(en,gt,Ce),tn===null?ue=en:tn.sibling=en,tn=en);return o&&oe.forEach(function(AF){return l(wt,AF)}),He&&va(wt,Ce),ue}function Tn(wt,gt,At,Pt){if(typeof At=="object"&&At!==null&&At.type===S&&At.key===null&&(At=At.props.children),typeof At=="object"&&At!==null){switch(At.$$typeof){case y:t:{for(var ue=At.key;gt!==null;){if(gt.key===ue){if(ue=At.type,ue===S){if(gt.tag===7){h(wt,gt.sibling),Pt=b(gt,At.props.children),Pt.return=wt,wt=Pt;break t}}else if(gt.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===U&&tu(ue)===gt.type){h(wt,gt.sibling),Pt=b(gt,At.props),Qd(Pt,At),Pt.return=wt,wt=Pt;break t}h(wt,gt);break}else l(wt,gt);gt=gt.sibling}At.type===S?(Pt=Yc(At.props.children,wt.mode,Pt,At.key),Pt.return=wt,wt=Pt):(Pt=y0(At.type,At.key,At.props,null,wt.mode,Pt),Qd(Pt,At),Pt.return=wt,wt=Pt)}return E(wt);case x:t:{for(ue=At.key;gt!==null;){if(gt.key===ue)if(gt.tag===4&&gt.stateNode.containerInfo===At.containerInfo&&gt.stateNode.implementation===At.implementation){h(wt,gt.sibling),Pt=b(gt,At.children||[]),Pt.return=wt,wt=Pt;break t}else{h(wt,gt);break}else l(wt,gt);gt=gt.sibling}Pt=m1(At,wt.mode,Pt),Pt.return=wt,wt=Pt}return E(wt);case U:return At=tu(At),Tn(wt,gt,At,Pt)}if(mt(At))return se(wt,gt,At,Pt);if(q(At)){if(ue=q(At),typeof ue!="function")throw Error(n(150));return At=ue.call(At),pe(wt,gt,At,Pt)}if(typeof At.then=="function")return Tn(wt,gt,M0(At),Pt);if(At.$$typeof===v)return Tn(wt,gt,S0(wt,At),Pt);v0(wt,At)}return typeof At=="string"&&At!==""||typeof At=="number"||typeof At=="bigint"?(At=""+At,gt!==null&&gt.tag===6?(h(wt,gt.sibling),Pt=b(gt,At),Pt.return=wt,wt=Pt):(h(wt,gt),Pt=p1(At,wt.mode,Pt),Pt.return=wt,wt=Pt),E(wt)):h(wt,gt)}return function(wt,gt,At,Pt){try{Zd=0;var ue=Tn(wt,gt,At,Pt);return dh=null,ue}catch(oe){if(oe===hh||oe===T0)throw oe;var tn=cr(29,oe,null,wt.mode);return tn.lanes=Pt,tn.return=wt,tn}}}var nu=NM(!0),RM=NM(!1),Ml=!1;function N1(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function R1(o,l){o=o.updateQueue,l.updateQueue===o&&(l.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function vl(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function Al(o,l,h){var m=o.updateQueue;if(m===null)return null;if(m=m.shared,(sn&2)!==0){var b=m.pending;return b===null?l.next=l:(l.next=b.next,b.next=l),m.pending=l,l=g0(o),hM(o,null,h),l}return m0(o,m,l,h),g0(o)}function Jd(o,l,h){if(l=l.updateQueue,l!==null&&(l=l.shared,(h&4194048)!==0)){var m=l.lanes;m&=o.pendingLanes,h|=m,l.lanes=h,Pd(o,h)}}function E1(o,l){var h=o.updateQueue,m=o.alternate;if(m!==null&&(m=m.updateQueue,h===m)){var b=null,w=null;if(h=h.firstBaseUpdate,h!==null){do{var E={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};w===null?b=w=E:w=w.next=E,h=h.next}while(h!==null);w===null?b=w=l:w=w.next=l}else b=w=l;h={baseState:m.baseState,firstBaseUpdate:b,lastBaseUpdate:w,shared:m.shared,callbacks:m.callbacks},o.updateQueue=h;return}o=h.lastBaseUpdate,o===null?h.firstBaseUpdate=l:o.next=l,h.lastBaseUpdate=l}var C1=!1;function tf(){if(C1){var o=uh;if(o!==null)throw o}}function ef(o,l,h,m){C1=!1;var b=o.updateQueue;Ml=!1;var w=b.firstBaseUpdate,E=b.lastBaseUpdate,I=b.shared.pending;if(I!==null){b.shared.pending=null;var it=I,Nt=it.next;it.next=null,E===null?w=Nt:E.next=Nt,E=it;var Ot=o.alternate;Ot!==null&&(Ot=Ot.updateQueue,I=Ot.lastBaseUpdate,I!==E&&(I===null?Ot.firstBaseUpdate=Nt:I.next=Nt,Ot.lastBaseUpdate=it))}if(w!==null){var It=b.baseState;E=0,Ot=Nt=it=null,I=w;do{var Et=I.lane&-536870913,Ct=Et!==I.lane;if(Ct?(ze&Et)===Et:(m&Et)===Et){Et!==0&&Et===ch&&(C1=!0),Ot!==null&&(Ot=Ot.next={lane:0,tag:I.tag,payload:I.payload,callback:null,next:null});t:{var se=o,pe=I;Et=l;var Tn=h;switch(pe.tag){case 1:if(se=pe.payload,typeof se=="function"){It=se.call(Tn,It,Et);break t}It=se;break t;case 3:se.flags=se.flags&-65537|128;case 0:if(se=pe.payload,Et=typeof se=="function"?se.call(Tn,It,Et):se,Et==null)break t;It=p({},It,Et);break t;case 2:Ml=!0}}Et=I.callback,Et!==null&&(o.flags|=64,Ct&&(o.flags|=8192),Ct=b.callbacks,Ct===null?b.callbacks=[Et]:Ct.push(Et))}else Ct={lane:Et,tag:I.tag,payload:I.payload,callback:I.callback,next:null},Ot===null?(Nt=Ot=Ct,it=It):Ot=Ot.next=Ct,E|=Et;if(I=I.next,I===null){if(I=b.shared.pending,I===null)break;Ct=I,I=Ct.next,Ct.next=null,b.lastBaseUpdate=Ct,b.shared.pending=null}}while(!0);Ot===null&&(it=It),b.baseState=it,b.firstBaseUpdate=Nt,b.lastBaseUpdate=Ot,w===null&&(b.shared.lanes=0),Dl|=E,o.lanes=E,o.memoizedState=It}}function EM(o,l){if(typeof o!="function")throw Error(n(191,o));o.call(l)}function CM(o,l){var h=o.callbacks;if(h!==null)for(o.callbacks=null,o=0;o<h.length;o++)EM(h[o],l)}var fh=O(null),A0=O(0);function DM(o,l){o=Ua,z(A0,o),z(fh,l),Ua=o|l.baseLanes}function D1(){z(A0,Ua),z(fh,fh.current)}function B1(){Ua=A0.current,et(fh),et(A0)}var ur=O(null),Ir=null;function Nl(o){var l=o.alternate;z(ms,ms.current&1),z(ur,o),Ir===null&&(l===null||fh.current!==null||l.memoizedState!==null)&&(Ir=o)}function L1(o){z(ms,ms.current),z(ur,o),Ir===null&&(Ir=o)}function BM(o){o.tag===22?(z(ms,ms.current),z(ur,o),Ir===null&&(Ir=o)):Rl()}function Rl(){z(ms,ms.current),z(ur,ur.current)}function hr(o){et(ur),Ir===o&&(Ir=null),et(ms)}var ms=O(0);function N0(o){for(var l=o;l!==null;){if(l.tag===13){var h=l.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||Ib(h)||Vb(h)))return l}else if(l.tag===19&&(l.memoizedProps.revealOrder==="forwards"||l.memoizedProps.revealOrder==="backwards"||l.memoizedProps.revealOrder==="unstable_legacy-backwards"||l.memoizedProps.revealOrder==="together")){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var Ra=0,Ae=null,Sn=null,Ms=null,R0=!1,ph=!1,su=!1,E0=0,nf=0,mh=null,gO=0;function cs(){throw Error(n(321))}function O1(o,l){if(l===null)return!1;for(var h=0;h<l.length&&h<o.length;h++)if(!lr(o[h],l[h]))return!1;return!0}function F1(o,l,h,m,b,w){return Ra=w,Ae=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,F.H=o===null||o.memoizedState===null?mv:K1,su=!1,w=h(m,b),su=!1,ph&&(w=OM(l,h,m,b)),LM(o),w}function LM(o){F.H=of;var l=Sn!==null&&Sn.next!==null;if(Ra=0,Ms=Sn=Ae=null,R0=!1,nf=0,mh=null,l)throw Error(n(300));o===null||vs||(o=o.dependencies,o!==null&&b0(o)&&(vs=!0))}function OM(o,l,h,m){Ae=o;var b=0;do{if(ph&&(mh=null),nf=0,ph=!1,25<=b)throw Error(n(301));if(b+=1,Ms=Sn=null,o.updateQueue!=null){var w=o.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}F.H=gv,w=l(h,m)}while(ph);return w}function yO(){var o=F.H,l=o.useState()[0];return l=typeof l.then=="function"?sf(l):l,o=o.useState()[0],(Sn!==null?Sn.memoizedState:null)!==o&&(Ae.flags|=1024),l}function U1(){var o=E0!==0;return E0=0,o}function P1(o,l,h){l.updateQueue=o.updateQueue,l.flags&=-2053,o.lanes&=~h}function z1(o){if(R0){for(o=o.memoizedState;o!==null;){var l=o.queue;l!==null&&(l.pending=null),o=o.next}R0=!1}Ra=0,Ms=Sn=Ae=null,ph=!1,nf=E0=0,mh=null}function Ai(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ms===null?Ae.memoizedState=Ms=o:Ms=Ms.next=o,Ms}function gs(){if(Sn===null){var o=Ae.alternate;o=o!==null?o.memoizedState:null}else o=Sn.next;var l=Ms===null?Ae.memoizedState:Ms.next;if(l!==null)Ms=l,Sn=o;else{if(o===null)throw Ae.alternate===null?Error(n(467)):Error(n(310));Sn=o,o={memoizedState:Sn.memoizedState,baseState:Sn.baseState,baseQueue:Sn.baseQueue,queue:Sn.queue,next:null},Ms===null?Ae.memoizedState=Ms=o:Ms=Ms.next=o}return Ms}function C0(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function sf(o){var l=nf;return nf+=1,mh===null&&(mh=[]),o=MM(mh,o,l),l=Ae,(Ms===null?l.memoizedState:Ms.next)===null&&(l=l.alternate,F.H=l===null||l.memoizedState===null?mv:K1),o}function D0(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return sf(o);if(o.$$typeof===v)return Qs(o)}throw Error(n(438,String(o)))}function I1(o){var l=null,h=Ae.updateQueue;if(h!==null&&(l=h.memoCache),l==null){var m=Ae.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(l={data:m.data.map(function(b){return b.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),h===null&&(h=C0(),Ae.updateQueue=h),h.memoCache=l,h=l.data[l.index],h===void 0)for(h=l.data[l.index]=Array(o),m=0;m<o;m++)h[m]=P;return l.index++,h}function Ea(o,l){return typeof l=="function"?l(o):l}function B0(o){var l=gs();return V1(l,Sn,o)}function V1(o,l,h){var m=o.queue;if(m===null)throw Error(n(311));m.lastRenderedReducer=h;var b=o.baseQueue,w=m.pending;if(w!==null){if(b!==null){var E=b.next;b.next=w.next,w.next=E}l.baseQueue=b=w,m.pending=null}if(w=o.baseState,b===null)o.memoizedState=w;else{l=b.next;var I=E=null,it=null,Nt=l,Ot=!1;do{var It=Nt.lane&-536870913;if(It!==Nt.lane?(ze&It)===It:(Ra&It)===It){var Et=Nt.revertLane;if(Et===0)it!==null&&(it=it.next={lane:0,revertLane:0,gesture:null,action:Nt.action,hasEagerState:Nt.hasEagerState,eagerState:Nt.eagerState,next:null}),It===ch&&(Ot=!0);else if((Ra&Et)===Et){Nt=Nt.next,Et===ch&&(Ot=!0);continue}else It={lane:0,revertLane:Nt.revertLane,gesture:null,action:Nt.action,hasEagerState:Nt.hasEagerState,eagerState:Nt.eagerState,next:null},it===null?(I=it=It,E=w):it=it.next=It,Ae.lanes|=Et,Dl|=Et;It=Nt.action,su&&h(w,It),w=Nt.hasEagerState?Nt.eagerState:h(w,It)}else Et={lane:It,revertLane:Nt.revertLane,gesture:Nt.gesture,action:Nt.action,hasEagerState:Nt.hasEagerState,eagerState:Nt.eagerState,next:null},it===null?(I=it=Et,E=w):it=it.next=Et,Ae.lanes|=It,Dl|=It;Nt=Nt.next}while(Nt!==null&&Nt!==l);if(it===null?E=w:it.next=I,!lr(w,o.memoizedState)&&(vs=!0,Ot&&(h=uh,h!==null)))throw h;o.memoizedState=w,o.baseState=E,o.baseQueue=it,m.lastRenderedState=w}return b===null&&(m.lanes=0),[o.memoizedState,m.dispatch]}function G1(o){var l=gs(),h=l.queue;if(h===null)throw Error(n(311));h.lastRenderedReducer=o;var m=h.dispatch,b=h.pending,w=l.memoizedState;if(b!==null){h.pending=null;var E=b=b.next;do w=o(w,E.action),E=E.next;while(E!==b);lr(w,l.memoizedState)||(vs=!0),l.memoizedState=w,l.baseQueue===null&&(l.baseState=w),h.lastRenderedState=w}return[w,m]}function FM(o,l,h){var m=Ae,b=gs(),w=He;if(w){if(h===void 0)throw Error(n(407));h=h()}else h=l();var E=!lr((Sn||b).memoizedState,h);if(E&&(b.memoizedState=h,vs=!0),b=b.queue,W1(zM.bind(null,m,b,o),[o]),b.getSnapshot!==l||E||Ms!==null&&Ms.memoizedState.tag&1){if(m.flags|=2048,gh(9,{destroy:void 0},PM.bind(null,m,b,h,l),null),An===null)throw Error(n(349));w||(Ra&127)!==0||UM(m,l,h)}return h}function UM(o,l,h){o.flags|=16384,o={getSnapshot:l,value:h},l=Ae.updateQueue,l===null?(l=C0(),Ae.updateQueue=l,l.stores=[o]):(h=l.stores,h===null?l.stores=[o]:h.push(o))}function PM(o,l,h,m){l.value=h,l.getSnapshot=m,IM(l)&&VM(o)}function zM(o,l,h){return h(function(){IM(l)&&VM(o)})}function IM(o){var l=o.getSnapshot;o=o.value;try{var h=l();return!lr(o,h)}catch{return!0}}function VM(o){var l=jc(o,2);l!==null&&Wi(l,o,2)}function k1(o){var l=Ai();if(typeof o=="function"){var h=o;if(o=h(),su){Dn(!0);try{h()}finally{Dn(!1)}}}return l.memoizedState=l.baseState=o,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:o},l}function GM(o,l,h,m){return o.baseState=h,V1(o,Sn,typeof m=="function"?m:Ea)}function xO(o,l,h,m,b){if(F0(o))throw Error(n(485));if(o=l.action,o!==null){var w={payload:b,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(E){w.listeners.push(E)}};F.T!==null?h(!0):w.isTransition=!1,m(w),h=l.pending,h===null?(w.next=l.pending=w,kM(l,w)):(w.next=h.next,l.pending=h.next=w)}}function kM(o,l){var h=l.action,m=l.payload,b=o.state;if(l.isTransition){var w=F.T,E={};F.T=E;try{var I=h(b,m),it=F.S;it!==null&&it(E,I),HM(o,l,I)}catch(Nt){H1(o,l,Nt)}finally{w!==null&&E.types!==null&&(w.types=E.types),F.T=w}}else try{w=h(b,m),HM(o,l,w)}catch(Nt){H1(o,l,Nt)}}function HM(o,l,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(m){WM(o,l,m)},function(m){return H1(o,l,m)}):WM(o,l,h)}function WM(o,l,h){l.status="fulfilled",l.value=h,qM(l),o.state=h,l=o.pending,l!==null&&(h=l.next,h===l?o.pending=null:(h=h.next,l.next=h,kM(o,h)))}function H1(o,l,h){var m=o.pending;if(o.pending=null,m!==null){m=m.next;do l.status="rejected",l.reason=h,qM(l),l=l.next;while(l!==m)}o.action=null}function qM(o){o=o.listeners;for(var l=0;l<o.length;l++)(0,o[l])()}function $M(o,l){return l}function XM(o,l){if(He){var h=An.formState;if(h!==null){t:{var m=Ae;if(He){if(Un){e:{for(var b=Un,w=zr;b.nodeType!==8;){if(!w){b=null;break e}if(b=Vr(b.nextSibling),b===null){b=null;break e}}w=b.data,b=w==="F!"||w==="F"?b:null}if(b){Un=Vr(b.nextSibling),m=b.data==="F!";break t}}Tl(m)}m=!1}m&&(l=h[0])}}return h=Ai(),h.memoizedState=h.baseState=l,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$M,lastRenderedState:l},h.queue=m,h=dv.bind(null,Ae,m),m.dispatch=h,m=k1(!1),w=Y1.bind(null,Ae,!1,m.queue),m=Ai(),b={state:l,dispatch:null,action:o,pending:null},m.queue=b,h=xO.bind(null,Ae,b,w,h),b.dispatch=h,m.memoizedState=o,[l,h,!1]}function jM(o){var l=gs();return YM(l,Sn,o)}function YM(o,l,h){if(l=V1(o,l,$M)[0],o=B0(Ea)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var m=sf(l)}catch(E){throw E===hh?T0:E}else m=l;l=gs();var b=l.queue,w=b.dispatch;return h!==l.memoizedState&&(Ae.flags|=2048,gh(9,{destroy:void 0},bO.bind(null,b,h),null)),[m,w,o]}function bO(o,l){o.action=l}function KM(o){var l=gs(),h=Sn;if(h!==null)return YM(l,h,o);gs(),l=l.memoizedState,h=gs();var m=h.queue.dispatch;return h.memoizedState=o,[l,m,!1]}function gh(o,l,h,m){return o={tag:o,create:h,deps:m,inst:l,next:null},l=Ae.updateQueue,l===null&&(l=C0(),Ae.updateQueue=l),h=l.lastEffect,h===null?l.lastEffect=o.next=o:(m=h.next,h.next=o,o.next=m,l.lastEffect=o),o}function ZM(){return gs().memoizedState}function L0(o,l,h,m){var b=Ai();Ae.flags|=o,b.memoizedState=gh(1|l,{destroy:void 0},h,m===void 0?null:m)}function O0(o,l,h,m){var b=gs();m=m===void 0?null:m;var w=b.memoizedState.inst;Sn!==null&&m!==null&&O1(m,Sn.memoizedState.deps)?b.memoizedState=gh(l,w,h,m):(Ae.flags|=o,b.memoizedState=gh(1|l,w,h,m))}function QM(o,l){L0(8390656,8,o,l)}function W1(o,l){O0(2048,8,o,l)}function SO(o){Ae.flags|=4;var l=Ae.updateQueue;if(l===null)l=C0(),Ae.updateQueue=l,l.events=[o];else{var h=l.events;h===null?l.events=[o]:h.push(o)}}function JM(o){var l=gs().memoizedState;return SO({ref:l,nextImpl:o}),function(){if((sn&2)!==0)throw Error(n(440));return l.impl.apply(void 0,arguments)}}function tv(o,l){return O0(4,2,o,l)}function ev(o,l){return O0(4,4,o,l)}function nv(o,l){if(typeof l=="function"){o=o();var h=l(o);return function(){typeof h=="function"?h():l(null)}}if(l!=null)return o=o(),l.current=o,function(){l.current=null}}function sv(o,l,h){h=h!=null?h.concat([o]):null,O0(4,4,nv.bind(null,l,o),h)}function q1(){}function iv(o,l){var h=gs();l=l===void 0?null:l;var m=h.memoizedState;return l!==null&&O1(l,m[1])?m[0]:(h.memoizedState=[o,l],o)}function rv(o,l){var h=gs();l=l===void 0?null:l;var m=h.memoizedState;if(l!==null&&O1(l,m[1]))return m[0];if(m=o(),su){Dn(!0);try{o()}finally{Dn(!1)}}return h.memoizedState=[m,l],m}function $1(o,l,h){return h===void 0||(Ra&1073741824)!==0&&(ze&261930)===0?o.memoizedState=l:(o.memoizedState=h,o=oA(),Ae.lanes|=o,Dl|=o,h)}function ov(o,l,h,m){return lr(h,l)?h:fh.current!==null?(o=$1(o,h,m),lr(o,l)||(vs=!0),o):(Ra&42)===0||(Ra&1073741824)!==0&&(ze&261930)===0?(vs=!0,o.memoizedState=h):(o=oA(),Ae.lanes|=o,Dl|=o,l)}function av(o,l,h,m,b){var w=Y.p;Y.p=w!==0&&8>w?w:8;var E=F.T,I={};F.T=I,Y1(o,!1,l,h);try{var it=b(),Nt=F.S;if(Nt!==null&&Nt(I,it),it!==null&&typeof it=="object"&&typeof it.then=="function"){var Ot=mO(it,m);rf(o,l,Ot,pr(o))}else rf(o,l,m,pr(o))}catch(It){rf(o,l,{then:function(){},status:"rejected",reason:It},pr())}finally{Y.p=w,E!==null&&I.types!==null&&(E.types=I.types),F.T=E}}function wO(){}function X1(o,l,h,m){if(o.tag!==5)throw Error(n(476));var b=lv(o).queue;av(o,b,l,tt,h===null?wO:function(){return cv(o),h(m)})}function lv(o){var l=o.memoizedState;if(l!==null)return l;l={memoizedState:tt,baseState:tt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:tt},next:null};var h={};return l.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ea,lastRenderedState:h},next:null},o.memoizedState=l,o=o.alternate,o!==null&&(o.memoizedState=l),l}function cv(o){var l=lv(o);l.next===null&&(l=o.alternate.memoizedState),rf(o,l.next.queue,{},pr())}function j1(){return Qs(Tf)}function uv(){return gs().memoizedState}function hv(){return gs().memoizedState}function TO(o){for(var l=o.return;l!==null;){switch(l.tag){case 24:case 3:var h=pr();o=vl(h);var m=Al(l,o,h);m!==null&&(Wi(m,l,h),Jd(m,l,h)),l={cache:_1()},o.payload=l;return}l=l.return}}function _O(o,l,h){var m=pr();h={lane:m,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},F0(o)?fv(l,h):(h=d1(o,l,h,m),h!==null&&(Wi(h,o,m),pv(h,l,m)))}function dv(o,l,h){var m=pr();rf(o,l,h,m)}function rf(o,l,h,m){var b={lane:m,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null};if(F0(o))fv(l,b);else{var w=o.alternate;if(o.lanes===0&&(w===null||w.lanes===0)&&(w=l.lastRenderedReducer,w!==null))try{var E=l.lastRenderedState,I=w(E,h);if(b.hasEagerState=!0,b.eagerState=I,lr(I,E))return m0(o,l,b,0),An===null&&p0(),!1}catch{}if(h=d1(o,l,b,m),h!==null)return Wi(h,o,m),pv(h,l,m),!0}return!1}function Y1(o,l,h,m){if(m={lane:2,revertLane:Nb(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},F0(o)){if(l)throw Error(n(479))}else l=d1(o,h,m,2),l!==null&&Wi(l,o,2)}function F0(o){var l=o.alternate;return o===Ae||l!==null&&l===Ae}function fv(o,l){ph=R0=!0;var h=o.pending;h===null?l.next=l:(l.next=h.next,h.next=l),o.pending=l}function pv(o,l,h){if((h&4194048)!==0){var m=l.lanes;m&=o.pendingLanes,h|=m,l.lanes=h,Pd(o,h)}}var of={readContext:Qs,use:D0,useCallback:cs,useContext:cs,useEffect:cs,useImperativeHandle:cs,useLayoutEffect:cs,useInsertionEffect:cs,useMemo:cs,useReducer:cs,useRef:cs,useState:cs,useDebugValue:cs,useDeferredValue:cs,useTransition:cs,useSyncExternalStore:cs,useId:cs,useHostTransitionStatus:cs,useFormState:cs,useActionState:cs,useOptimistic:cs,useMemoCache:cs,useCacheRefresh:cs};of.useEffectEvent=cs;var mv={readContext:Qs,use:D0,useCallback:function(o,l){return Ai().memoizedState=[o,l===void 0?null:l],o},useContext:Qs,useEffect:QM,useImperativeHandle:function(o,l,h){h=h!=null?h.concat([o]):null,L0(4194308,4,nv.bind(null,l,o),h)},useLayoutEffect:function(o,l){return L0(4194308,4,o,l)},useInsertionEffect:function(o,l){L0(4,2,o,l)},useMemo:function(o,l){var h=Ai();l=l===void 0?null:l;var m=o();if(su){Dn(!0);try{o()}finally{Dn(!1)}}return h.memoizedState=[m,l],m},useReducer:function(o,l,h){var m=Ai();if(h!==void 0){var b=h(l);if(su){Dn(!0);try{h(l)}finally{Dn(!1)}}}else b=l;return m.memoizedState=m.baseState=b,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:b},m.queue=o,o=o.dispatch=_O.bind(null,Ae,o),[m.memoizedState,o]},useRef:function(o){var l=Ai();return o={current:o},l.memoizedState=o},useState:function(o){o=k1(o);var l=o.queue,h=dv.bind(null,Ae,l);return l.dispatch=h,[o.memoizedState,h]},useDebugValue:q1,useDeferredValue:function(o,l){var h=Ai();return $1(h,o,l)},useTransition:function(){var o=k1(!1);return o=av.bind(null,Ae,o.queue,!0,!1),Ai().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,l,h){var m=Ae,b=Ai();if(He){if(h===void 0)throw Error(n(407));h=h()}else{if(h=l(),An===null)throw Error(n(349));(ze&127)!==0||UM(m,l,h)}b.memoizedState=h;var w={value:h,getSnapshot:l};return b.queue=w,QM(zM.bind(null,m,w,o),[o]),m.flags|=2048,gh(9,{destroy:void 0},PM.bind(null,m,w,h,l),null),h},useId:function(){var o=Ai(),l=An.identifierPrefix;if(He){var h=Oo,m=Lo;h=(m&~(1<<32-Ge(m)-1)).toString(32)+h,l="_"+l+"R_"+h,h=E0++,0<h&&(l+="H"+h.toString(32)),l+="_"}else h=gO++,l="_"+l+"r_"+h.toString(32)+"_";return o.memoizedState=l},useHostTransitionStatus:j1,useFormState:XM,useActionState:XM,useOptimistic:function(o){var l=Ai();l.memoizedState=l.baseState=o;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=h,l=Y1.bind(null,Ae,!0,h),h.dispatch=l,[o,l]},useMemoCache:I1,useCacheRefresh:function(){return Ai().memoizedState=TO.bind(null,Ae)},useEffectEvent:function(o){var l=Ai(),h={impl:o};return l.memoizedState=h,function(){if((sn&2)!==0)throw Error(n(440));return h.impl.apply(void 0,arguments)}}},K1={readContext:Qs,use:D0,useCallback:iv,useContext:Qs,useEffect:W1,useImperativeHandle:sv,useInsertionEffect:tv,useLayoutEffect:ev,useMemo:rv,useReducer:B0,useRef:ZM,useState:function(){return B0(Ea)},useDebugValue:q1,useDeferredValue:function(o,l){var h=gs();return ov(h,Sn.memoizedState,o,l)},useTransition:function(){var o=B0(Ea)[0],l=gs().memoizedState;return[typeof o=="boolean"?o:sf(o),l]},useSyncExternalStore:FM,useId:uv,useHostTransitionStatus:j1,useFormState:jM,useActionState:jM,useOptimistic:function(o,l){var h=gs();return GM(h,Sn,o,l)},useMemoCache:I1,useCacheRefresh:hv};K1.useEffectEvent=JM;var gv={readContext:Qs,use:D0,useCallback:iv,useContext:Qs,useEffect:W1,useImperativeHandle:sv,useInsertionEffect:tv,useLayoutEffect:ev,useMemo:rv,useReducer:G1,useRef:ZM,useState:function(){return G1(Ea)},useDebugValue:q1,useDeferredValue:function(o,l){var h=gs();return Sn===null?$1(h,o,l):ov(h,Sn.memoizedState,o,l)},useTransition:function(){var o=G1(Ea)[0],l=gs().memoizedState;return[typeof o=="boolean"?o:sf(o),l]},useSyncExternalStore:FM,useId:uv,useHostTransitionStatus:j1,useFormState:KM,useActionState:KM,useOptimistic:function(o,l){var h=gs();return Sn!==null?GM(h,Sn,o,l):(h.baseState=o,[o,h.queue.dispatch])},useMemoCache:I1,useCacheRefresh:hv};gv.useEffectEvent=JM;function Z1(o,l,h,m){l=o.memoizedState,h=h(m,l),h=h==null?l:p({},l,h),o.memoizedState=h,o.lanes===0&&(o.updateQueue.baseState=h)}var Q1={enqueueSetState:function(o,l,h){o=o._reactInternals;var m=pr(),b=vl(m);b.payload=l,h!=null&&(b.callback=h),l=Al(o,b,m),l!==null&&(Wi(l,o,m),Jd(l,o,m))},enqueueReplaceState:function(o,l,h){o=o._reactInternals;var m=pr(),b=vl(m);b.tag=1,b.payload=l,h!=null&&(b.callback=h),l=Al(o,b,m),l!==null&&(Wi(l,o,m),Jd(l,o,m))},enqueueForceUpdate:function(o,l){o=o._reactInternals;var h=pr(),m=vl(h);m.tag=2,l!=null&&(m.callback=l),l=Al(o,m,h),l!==null&&(Wi(l,o,h),Jd(l,o,h))}};function yv(o,l,h,m,b,w,E){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(m,w,E):l.prototype&&l.prototype.isPureReactComponent?!qd(h,m)||!qd(b,w):!0}function xv(o,l,h,m){o=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(h,m),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(h,m),l.state!==o&&Q1.enqueueReplaceState(l,l.state,null)}function iu(o,l){var h=l;if("ref"in l){h={};for(var m in l)m!=="ref"&&(h[m]=l[m])}if(o=o.defaultProps){h===l&&(h=p({},h));for(var b in o)h[b]===void 0&&(h[b]=o[b])}return h}function bv(o){f0(o)}function Sv(o){console.error(o)}function wv(o){f0(o)}function U0(o,l){try{var h=o.onUncaughtError;h(l.value,{componentStack:l.stack})}catch(m){setTimeout(function(){throw m})}}function Tv(o,l,h){try{var m=o.onCaughtError;m(h.value,{componentStack:h.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function J1(o,l,h){return h=vl(h),h.tag=3,h.payload={element:null},h.callback=function(){U0(o,l)},h}function _v(o){return o=vl(o),o.tag=3,o}function Mv(o,l,h,m){var b=h.type.getDerivedStateFromError;if(typeof b=="function"){var w=m.value;o.payload=function(){return b(w)},o.callback=function(){Tv(l,h,m)}}var E=h.stateNode;E!==null&&typeof E.componentDidCatch=="function"&&(o.callback=function(){Tv(l,h,m),typeof b!="function"&&(Bl===null?Bl=new Set([this]):Bl.add(this));var I=m.stack;this.componentDidCatch(m.value,{componentStack:I!==null?I:""})})}function MO(o,l,h,m,b){if(h.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(l=h.alternate,l!==null&&lh(l,h,b,!0),h=ur.current,h!==null){switch(h.tag){case 31:case 13:return Ir===null?j0():h.alternate===null&&us===0&&(us=3),h.flags&=-257,h.flags|=65536,h.lanes=b,m===_0?h.flags|=16384:(l=h.updateQueue,l===null?h.updateQueue=new Set([m]):l.add(m),Mb(o,m,b)),!1;case 22:return h.flags|=65536,m===_0?h.flags|=16384:(l=h.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([m])},h.updateQueue=l):(h=l.retryQueue,h===null?l.retryQueue=new Set([m]):h.add(m)),Mb(o,m,b)),!1}throw Error(n(435,h.tag))}return Mb(o,m,b),j0(),!1}if(He)return l=ur.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=b,m!==x1&&(o=Error(n(422),{cause:m}),jd(Fr(o,h)))):(m!==x1&&(l=Error(n(423),{cause:m}),jd(Fr(l,h))),o=o.current.alternate,o.flags|=65536,b&=-b,o.lanes|=b,m=Fr(m,h),b=J1(o.stateNode,m,b),E1(o,b),us!==4&&(us=2)),!1;var w=Error(n(520),{cause:m});if(w=Fr(w,h),pf===null?pf=[w]:pf.push(w),us!==4&&(us=2),l===null)return!0;m=Fr(m,h),h=l;do{switch(h.tag){case 3:return h.flags|=65536,o=b&-b,h.lanes|=o,o=J1(h.stateNode,m,o),E1(h,o),!1;case 1:if(l=h.type,w=h.stateNode,(h.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Bl===null||!Bl.has(w))))return h.flags|=65536,b&=-b,h.lanes|=b,b=_v(b),Mv(b,o,h,m),E1(h,b),!1}h=h.return}while(h!==null);return!1}var tb=Error(n(461)),vs=!1;function Js(o,l,h,m){l.child=o===null?RM(l,null,h,m):nu(l,o.child,h,m)}function vv(o,l,h,m,b){h=h.render;var w=l.ref;if("ref"in m){var E={};for(var I in m)I!=="ref"&&(E[I]=m[I])}else E=m;return Qc(l),m=F1(o,l,h,E,w,b),I=U1(),o!==null&&!vs?(P1(o,l,b),Ca(o,l,b)):(He&&I&&g1(l),l.flags|=1,Js(o,l,m,b),l.child)}function Av(o,l,h,m,b){if(o===null){var w=h.type;return typeof w=="function"&&!f1(w)&&w.defaultProps===void 0&&h.compare===null?(l.tag=15,l.type=w,Nv(o,l,w,m,b)):(o=y0(h.type,null,m,l,l.mode,b),o.ref=l.ref,o.return=l,l.child=o)}if(w=o.child,!lb(o,b)){var E=w.memoizedProps;if(h=h.compare,h=h!==null?h:qd,h(E,m)&&o.ref===l.ref)return Ca(o,l,b)}return l.flags|=1,o=Ma(w,m),o.ref=l.ref,o.return=l,l.child=o}function Nv(o,l,h,m,b){if(o!==null){var w=o.memoizedProps;if(qd(w,m)&&o.ref===l.ref)if(vs=!1,l.pendingProps=m=w,lb(o,b))(o.flags&131072)!==0&&(vs=!0);else return l.lanes=o.lanes,Ca(o,l,b)}return eb(o,l,h,m,b)}function Rv(o,l,h,m){var b=m.children,w=o!==null?o.memoizedState:null;if(o===null&&l.stateNode===null&&(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((l.flags&128)!==0){if(w=w!==null?w.baseLanes|h:h,o!==null){for(m=l.child=o.child,b=0;m!==null;)b=b|m.lanes|m.childLanes,m=m.sibling;m=b&~w}else m=0,l.child=null;return Ev(o,l,w,h,m)}if((h&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},o!==null&&w0(l,w!==null?w.cachePool:null),w!==null?DM(l,w):D1(),BM(l);else return m=l.lanes=536870912,Ev(o,l,w!==null?w.baseLanes|h:h,h,m)}else w!==null?(w0(l,w.cachePool),DM(l,w),Rl(),l.memoizedState=null):(o!==null&&w0(l,null),D1(),Rl());return Js(o,l,b,h),l.child}function af(o,l){return o!==null&&o.tag===22||l.stateNode!==null||(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.sibling}function Ev(o,l,h,m,b){var w=v1();return w=w===null?null:{parent:_s._currentValue,pool:w},l.memoizedState={baseLanes:h,cachePool:w},o!==null&&w0(l,null),D1(),BM(l),o!==null&&lh(o,l,m,!0),l.childLanes=b,null}function P0(o,l){return l=I0({mode:l.mode,children:l.children},o.mode),l.ref=o.ref,o.child=l,l.return=o,l}function Cv(o,l,h){return nu(l,o.child,null,h),o=P0(l,l.pendingProps),o.flags|=2,hr(l),l.memoizedState=null,o}function vO(o,l,h){var m=l.pendingProps,b=(l.flags&128)!==0;if(l.flags&=-129,o===null){if(He){if(m.mode==="hidden")return o=P0(l,m),l.lanes=536870912,af(null,o);if(L1(l),(o=Un)?(o=kA(o,zr),o=o!==null&&o.data==="&"?o:null,o!==null&&(l.memoizedState={dehydrated:o,treeContext:Sl!==null?{id:Lo,overflow:Oo}:null,retryLane:536870912,hydrationErrors:null},h=fM(o),h.return=l,l.child=h,Zs=l,Un=null)):o=null,o===null)throw Tl(l);return l.lanes=536870912,null}return P0(l,m)}var w=o.memoizedState;if(w!==null){var E=w.dehydrated;if(L1(l),b)if(l.flags&256)l.flags&=-257,l=Cv(o,l,h);else if(l.memoizedState!==null)l.child=o.child,l.flags|=128,l=null;else throw Error(n(558));else if(vs||lh(o,l,h,!1),b=(h&o.childLanes)!==0,vs||b){if(m=An,m!==null&&(E=Ys(m,h),E!==0&&E!==w.retryLane))throw w.retryLane=E,jc(o,E),Wi(m,o,E),tb;j0(),l=Cv(o,l,h)}else o=w.treeContext,Un=Vr(E.nextSibling),Zs=l,He=!0,wl=null,zr=!1,o!==null&&gM(l,o),l=P0(l,m),l.flags|=4096;return l}return o=Ma(o.child,{mode:m.mode,children:m.children}),o.ref=l.ref,l.child=o,o.return=l,o}function z0(o,l){var h=l.ref;if(h===null)o!==null&&o.ref!==null&&(l.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(n(284));(o===null||o.ref!==h)&&(l.flags|=4194816)}}function eb(o,l,h,m,b){return Qc(l),h=F1(o,l,h,m,void 0,b),m=U1(),o!==null&&!vs?(P1(o,l,b),Ca(o,l,b)):(He&&m&&g1(l),l.flags|=1,Js(o,l,h,b),l.child)}function Dv(o,l,h,m,b,w){return Qc(l),l.updateQueue=null,h=OM(l,m,h,b),LM(o),m=U1(),o!==null&&!vs?(P1(o,l,w),Ca(o,l,w)):(He&&m&&g1(l),l.flags|=1,Js(o,l,h,w),l.child)}function Bv(o,l,h,m,b){if(Qc(l),l.stateNode===null){var w=ih,E=h.contextType;typeof E=="object"&&E!==null&&(w=Qs(E)),w=new h(m,w),l.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=Q1,l.stateNode=w,w._reactInternals=l,w=l.stateNode,w.props=m,w.state=l.memoizedState,w.refs={},N1(l),E=h.contextType,w.context=typeof E=="object"&&E!==null?Qs(E):ih,w.state=l.memoizedState,E=h.getDerivedStateFromProps,typeof E=="function"&&(Z1(l,h,E,m),w.state=l.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(E=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),E!==w.state&&Q1.enqueueReplaceState(w,w.state,null),ef(l,m,w,b),tf(),w.state=l.memoizedState),typeof w.componentDidMount=="function"&&(l.flags|=4194308),m=!0}else if(o===null){w=l.stateNode;var I=l.memoizedProps,it=iu(h,I);w.props=it;var Nt=w.context,Ot=h.contextType;E=ih,typeof Ot=="object"&&Ot!==null&&(E=Qs(Ot));var It=h.getDerivedStateFromProps;Ot=typeof It=="function"||typeof w.getSnapshotBeforeUpdate=="function",I=l.pendingProps!==I,Ot||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(I||Nt!==E)&&xv(l,w,m,E),Ml=!1;var Et=l.memoizedState;w.state=Et,ef(l,m,w,b),tf(),Nt=l.memoizedState,I||Et!==Nt||Ml?(typeof It=="function"&&(Z1(l,h,It,m),Nt=l.memoizedState),(it=Ml||yv(l,h,it,m,Et,Nt,E))?(Ot||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(l.flags|=4194308)):(typeof w.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=m,l.memoizedState=Nt),w.props=m,w.state=Nt,w.context=E,m=it):(typeof w.componentDidMount=="function"&&(l.flags|=4194308),m=!1)}else{w=l.stateNode,R1(o,l),E=l.memoizedProps,Ot=iu(h,E),w.props=Ot,It=l.pendingProps,Et=w.context,Nt=h.contextType,it=ih,typeof Nt=="object"&&Nt!==null&&(it=Qs(Nt)),I=h.getDerivedStateFromProps,(Nt=typeof I=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(E!==It||Et!==it)&&xv(l,w,m,it),Ml=!1,Et=l.memoizedState,w.state=Et,ef(l,m,w,b),tf();var Ct=l.memoizedState;E!==It||Et!==Ct||Ml||o!==null&&o.dependencies!==null&&b0(o.dependencies)?(typeof I=="function"&&(Z1(l,h,I,m),Ct=l.memoizedState),(Ot=Ml||yv(l,h,Ot,m,Et,Ct,it)||o!==null&&o.dependencies!==null&&b0(o.dependencies))?(Nt||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(m,Ct,it),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(m,Ct,it)),typeof w.componentDidUpdate=="function"&&(l.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof w.componentDidUpdate!="function"||E===o.memoizedProps&&Et===o.memoizedState||(l.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||E===o.memoizedProps&&Et===o.memoizedState||(l.flags|=1024),l.memoizedProps=m,l.memoizedState=Ct),w.props=m,w.state=Ct,w.context=it,m=Ot):(typeof w.componentDidUpdate!="function"||E===o.memoizedProps&&Et===o.memoizedState||(l.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||E===o.memoizedProps&&Et===o.memoizedState||(l.flags|=1024),m=!1)}return w=m,z0(o,l),m=(l.flags&128)!==0,w||m?(w=l.stateNode,h=m&&typeof h.getDerivedStateFromError!="function"?null:w.render(),l.flags|=1,o!==null&&m?(l.child=nu(l,o.child,null,b),l.child=nu(l,null,h,b)):Js(o,l,h,b),l.memoizedState=w.state,o=l.child):o=Ca(o,l,b),o}function Lv(o,l,h,m){return Kc(),l.flags|=256,Js(o,l,h,m),l.child}var nb={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function sb(o){return{baseLanes:o,cachePool:TM()}}function ib(o,l,h){return o=o!==null?o.childLanes&~h:0,l&&(o|=fr),o}function Ov(o,l,h){var m=l.pendingProps,b=!1,w=(l.flags&128)!==0,E;if((E=w)||(E=o!==null&&o.memoizedState===null?!1:(ms.current&2)!==0),E&&(b=!0,l.flags&=-129),E=(l.flags&32)!==0,l.flags&=-33,o===null){if(He){if(b?Nl(l):Rl(),(o=Un)?(o=kA(o,zr),o=o!==null&&o.data!=="&"?o:null,o!==null&&(l.memoizedState={dehydrated:o,treeContext:Sl!==null?{id:Lo,overflow:Oo}:null,retryLane:536870912,hydrationErrors:null},h=fM(o),h.return=l,l.child=h,Zs=l,Un=null)):o=null,o===null)throw Tl(l);return Vb(o)?l.lanes=32:l.lanes=536870912,null}var I=m.children;return m=m.fallback,b?(Rl(),b=l.mode,I=I0({mode:"hidden",children:I},b),m=Yc(m,b,h,null),I.return=l,m.return=l,I.sibling=m,l.child=I,m=l.child,m.memoizedState=sb(h),m.childLanes=ib(o,E,h),l.memoizedState=nb,af(null,m)):(Nl(l),rb(l,I))}var it=o.memoizedState;if(it!==null&&(I=it.dehydrated,I!==null)){if(w)l.flags&256?(Nl(l),l.flags&=-257,l=ob(o,l,h)):l.memoizedState!==null?(Rl(),l.child=o.child,l.flags|=128,l=null):(Rl(),I=m.fallback,b=l.mode,m=I0({mode:"visible",children:m.children},b),I=Yc(I,b,h,null),I.flags|=2,m.return=l,I.return=l,m.sibling=I,l.child=m,nu(l,o.child,null,h),m=l.child,m.memoizedState=sb(h),m.childLanes=ib(o,E,h),l.memoizedState=nb,l=af(null,m));else if(Nl(l),Vb(I)){if(E=I.nextSibling&&I.nextSibling.dataset,E)var Nt=E.dgst;E=Nt,m=Error(n(419)),m.stack="",m.digest=E,jd({value:m,source:null,stack:null}),l=ob(o,l,h)}else if(vs||lh(o,l,h,!1),E=(h&o.childLanes)!==0,vs||E){if(E=An,E!==null&&(m=Ys(E,h),m!==0&&m!==it.retryLane))throw it.retryLane=m,jc(o,m),Wi(E,o,m),tb;Ib(I)||j0(),l=ob(o,l,h)}else Ib(I)?(l.flags|=192,l.child=o.child,l=null):(o=it.treeContext,Un=Vr(I.nextSibling),Zs=l,He=!0,wl=null,zr=!1,o!==null&&gM(l,o),l=rb(l,m.children),l.flags|=4096);return l}return b?(Rl(),I=m.fallback,b=l.mode,it=o.child,Nt=it.sibling,m=Ma(it,{mode:"hidden",children:m.children}),m.subtreeFlags=it.subtreeFlags&65011712,Nt!==null?I=Ma(Nt,I):(I=Yc(I,b,h,null),I.flags|=2),I.return=l,m.return=l,m.sibling=I,l.child=m,af(null,m),m=l.child,I=o.child.memoizedState,I===null?I=sb(h):(b=I.cachePool,b!==null?(it=_s._currentValue,b=b.parent!==it?{parent:it,pool:it}:b):b=TM(),I={baseLanes:I.baseLanes|h,cachePool:b}),m.memoizedState=I,m.childLanes=ib(o,E,h),l.memoizedState=nb,af(o.child,m)):(Nl(l),h=o.child,o=h.sibling,h=Ma(h,{mode:"visible",children:m.children}),h.return=l,h.sibling=null,o!==null&&(E=l.deletions,E===null?(l.deletions=[o],l.flags|=16):E.push(o)),l.child=h,l.memoizedState=null,h)}function rb(o,l){return l=I0({mode:"visible",children:l},o.mode),l.return=o,o.child=l}function I0(o,l){return o=cr(22,o,null,l),o.lanes=0,o}function ob(o,l,h){return nu(l,o.child,null,h),o=rb(l,l.pendingProps.children),o.flags|=2,l.memoizedState=null,o}function Fv(o,l,h){o.lanes|=l;var m=o.alternate;m!==null&&(m.lanes|=l),w1(o.return,l,h)}function ab(o,l,h,m,b,w){var E=o.memoizedState;E===null?o.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:m,tail:h,tailMode:b,treeForkCount:w}:(E.isBackwards=l,E.rendering=null,E.renderingStartTime=0,E.last=m,E.tail=h,E.tailMode=b,E.treeForkCount=w)}function Uv(o,l,h){var m=l.pendingProps,b=m.revealOrder,w=m.tail;m=m.children;var E=ms.current,I=(E&2)!==0;if(I?(E=E&1|2,l.flags|=128):E&=1,z(ms,E),Js(o,l,m,h),m=He?Xd:0,!I&&o!==null&&(o.flags&128)!==0)t:for(o=l.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&Fv(o,h,l);else if(o.tag===19)Fv(o,h,l);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===l)break t;for(;o.sibling===null;){if(o.return===null||o.return===l)break t;o=o.return}o.sibling.return=o.return,o=o.sibling}switch(b){case"forwards":for(h=l.child,b=null;h!==null;)o=h.alternate,o!==null&&N0(o)===null&&(b=h),h=h.sibling;h=b,h===null?(b=l.child,l.child=null):(b=h.sibling,h.sibling=null),ab(l,!1,b,h,w,m);break;case"backwards":case"unstable_legacy-backwards":for(h=null,b=l.child,l.child=null;b!==null;){if(o=b.alternate,o!==null&&N0(o)===null){l.child=b;break}o=b.sibling,b.sibling=h,h=b,b=o}ab(l,!0,h,null,w,m);break;case"together":ab(l,!1,null,null,void 0,m);break;default:l.memoizedState=null}return l.child}function Ca(o,l,h){if(o!==null&&(l.dependencies=o.dependencies),Dl|=l.lanes,(h&l.childLanes)===0)if(o!==null){if(lh(o,l,h,!1),(h&l.childLanes)===0)return null}else return null;if(o!==null&&l.child!==o.child)throw Error(n(153));if(l.child!==null){for(o=l.child,h=Ma(o,o.pendingProps),l.child=h,h.return=l;o.sibling!==null;)o=o.sibling,h=h.sibling=Ma(o,o.pendingProps),h.return=l;h.sibling=null}return l.child}function lb(o,l){return(o.lanes&l)!==0?!0:(o=o.dependencies,!!(o!==null&&b0(o)))}function AO(o,l,h){switch(l.tag){case 3:H(l,l.stateNode.containerInfo),_l(l,_s,o.memoizedState.cache),Kc();break;case 27:case 5:ct(l);break;case 4:H(l,l.stateNode.containerInfo);break;case 10:_l(l,l.type,l.memoizedProps.value);break;case 31:if(l.memoizedState!==null)return l.flags|=128,L1(l),null;break;case 13:var m=l.memoizedState;if(m!==null)return m.dehydrated!==null?(Nl(l),l.flags|=128,null):(h&l.child.childLanes)!==0?Ov(o,l,h):(Nl(l),o=Ca(o,l,h),o!==null?o.sibling:null);Nl(l);break;case 19:var b=(o.flags&128)!==0;if(m=(h&l.childLanes)!==0,m||(lh(o,l,h,!1),m=(h&l.childLanes)!==0),b){if(m)return Uv(o,l,h);l.flags|=128}if(b=l.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),z(ms,ms.current),m)break;return null;case 22:return l.lanes=0,Rv(o,l,h,l.pendingProps);case 24:_l(l,_s,o.memoizedState.cache)}return Ca(o,l,h)}function Pv(o,l,h){if(o!==null)if(o.memoizedProps!==l.pendingProps)vs=!0;else{if(!lb(o,h)&&(l.flags&128)===0)return vs=!1,AO(o,l,h);vs=(o.flags&131072)!==0}else vs=!1,He&&(l.flags&1048576)!==0&&mM(l,Xd,l.index);switch(l.lanes=0,l.tag){case 16:t:{var m=l.pendingProps;if(o=tu(l.elementType),l.type=o,typeof o=="function")f1(o)?(m=iu(o,m),l.tag=1,l=Bv(null,l,o,m,h)):(l.tag=0,l=eb(null,l,o,m,h));else{if(o!=null){var b=o.$$typeof;if(b===A){l.tag=11,l=vv(null,l,o,m,h);break t}else if(b===D){l.tag=14,l=Av(null,l,o,m,h);break t}}throw l=Mt(o)||o,Error(n(306,l,""))}}return l;case 0:return eb(o,l,l.type,l.pendingProps,h);case 1:return m=l.type,b=iu(m,l.pendingProps),Bv(o,l,m,b,h);case 3:t:{if(H(l,l.stateNode.containerInfo),o===null)throw Error(n(387));m=l.pendingProps;var w=l.memoizedState;b=w.element,R1(o,l),ef(l,m,null,h);var E=l.memoizedState;if(m=E.cache,_l(l,_s,m),m!==w.cache&&T1(l,[_s],h,!0),tf(),m=E.element,w.isDehydrated)if(w={element:m,isDehydrated:!1,cache:E.cache},l.updateQueue.baseState=w,l.memoizedState=w,l.flags&256){l=Lv(o,l,m,h);break t}else if(m!==b){b=Fr(Error(n(424)),l),jd(b),l=Lv(o,l,m,h);break t}else for(o=l.stateNode.containerInfo,o.nodeType===9?o=o.body:o=o.nodeName==="HTML"?o.ownerDocument.body:o,Un=Vr(o.firstChild),Zs=l,He=!0,wl=null,zr=!0,h=RM(l,null,m,h),l.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Kc(),m===b){l=Ca(o,l,h);break t}Js(o,l,m,h)}l=l.child}return l;case 26:return z0(o,l),o===null?(h=jA(l.type,null,l.pendingProps,null))?l.memoizedState=h:He||(h=l.type,o=l.pendingProps,m=em(K.current).createElement(h),m[Zn]=l,m[Ts]=o,ti(m,h,o),vn(m),l.stateNode=m):l.memoizedState=jA(l.type,o.memoizedProps,l.pendingProps,o.memoizedState),null;case 27:return ct(l),o===null&&He&&(m=l.stateNode=qA(l.type,l.pendingProps,K.current),Zs=l,zr=!0,b=Un,Ul(l.type)?(Gb=b,Un=Vr(m.firstChild)):Un=b),Js(o,l,l.pendingProps.children,h),z0(o,l),o===null&&(l.flags|=4194304),l.child;case 5:return o===null&&He&&((b=m=Un)&&(m=nF(m,l.type,l.pendingProps,zr),m!==null?(l.stateNode=m,Zs=l,Un=Vr(m.firstChild),zr=!1,b=!0):b=!1),b||Tl(l)),ct(l),b=l.type,w=l.pendingProps,E=o!==null?o.memoizedProps:null,m=w.children,Ub(b,w)?m=null:E!==null&&Ub(b,E)&&(l.flags|=32),l.memoizedState!==null&&(b=F1(o,l,yO,null,null,h),Tf._currentValue=b),z0(o,l),Js(o,l,m,h),l.child;case 6:return o===null&&He&&((o=h=Un)&&(h=sF(h,l.pendingProps,zr),h!==null?(l.stateNode=h,Zs=l,Un=null,o=!0):o=!1),o||Tl(l)),null;case 13:return Ov(o,l,h);case 4:return H(l,l.stateNode.containerInfo),m=l.pendingProps,o===null?l.child=nu(l,null,m,h):Js(o,l,m,h),l.child;case 11:return vv(o,l,l.type,l.pendingProps,h);case 7:return Js(o,l,l.pendingProps,h),l.child;case 8:return Js(o,l,l.pendingProps.children,h),l.child;case 12:return Js(o,l,l.pendingProps.children,h),l.child;case 10:return m=l.pendingProps,_l(l,l.type,m.value),Js(o,l,m.children,h),l.child;case 9:return b=l.type._context,m=l.pendingProps.children,Qc(l),b=Qs(b),m=m(b),l.flags|=1,Js(o,l,m,h),l.child;case 14:return Av(o,l,l.type,l.pendingProps,h);case 15:return Nv(o,l,l.type,l.pendingProps,h);case 19:return Uv(o,l,h);case 31:return vO(o,l,h);case 22:return Rv(o,l,h,l.pendingProps);case 24:return Qc(l),m=Qs(_s),o===null?(b=v1(),b===null&&(b=An,w=_1(),b.pooledCache=w,w.refCount++,w!==null&&(b.pooledCacheLanes|=h),b=w),l.memoizedState={parent:m,cache:b},N1(l),_l(l,_s,b)):((o.lanes&h)!==0&&(R1(o,l),ef(l,null,null,h),tf()),b=o.memoizedState,w=l.memoizedState,b.parent!==m?(b={parent:m,cache:m},l.memoizedState=b,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=b),_l(l,_s,m)):(m=w.cache,_l(l,_s,m),m!==b.cache&&T1(l,[_s],h,!0))),Js(o,l,l.pendingProps.children,h),l.child;case 29:throw l.pendingProps}throw Error(n(156,l.tag))}function Da(o){o.flags|=4}function cb(o,l,h,m,b){if((l=(o.mode&32)!==0)&&(l=!1),l){if(o.flags|=16777216,(b&335544128)===b)if(o.stateNode.complete)o.flags|=8192;else if(uA())o.flags|=8192;else throw eu=_0,A1}else o.flags&=-16777217}function zv(o,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!JA(l))if(uA())o.flags|=8192;else throw eu=_0,A1}function V0(o,l){l!==null&&(o.flags|=4),o.flags&16384&&(l=o.tag!==22?oo():536870912,o.lanes|=l,Sh|=l)}function lf(o,l){if(!He)switch(o.tailMode){case"hidden":l=o.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?o.tail=null:h.sibling=null;break;case"collapsed":h=o.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?l||o.tail===null?o.tail=null:o.tail.sibling=null:m.sibling=null}}function Pn(o){var l=o.alternate!==null&&o.alternate.child===o.child,h=0,m=0;if(l)for(var b=o.child;b!==null;)h|=b.lanes|b.childLanes,m|=b.subtreeFlags&65011712,m|=b.flags&65011712,b.return=o,b=b.sibling;else for(b=o.child;b!==null;)h|=b.lanes|b.childLanes,m|=b.subtreeFlags,m|=b.flags,b.return=o,b=b.sibling;return o.subtreeFlags|=m,o.childLanes=h,l}function NO(o,l,h){var m=l.pendingProps;switch(y1(l),l.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Pn(l),null;case 1:return Pn(l),null;case 3:return h=l.stateNode,m=null,o!==null&&(m=o.memoizedState.cache),l.memoizedState.cache!==m&&(l.flags|=2048),Na(_s),j(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(ah(l)?Da(l):o===null||o.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,b1())),Pn(l),null;case 26:var b=l.type,w=l.memoizedState;return o===null?(Da(l),w!==null?(Pn(l),zv(l,w)):(Pn(l),cb(l,b,null,m,h))):w?w!==o.memoizedState?(Da(l),Pn(l),zv(l,w)):(Pn(l),l.flags&=-16777217):(o=o.memoizedProps,o!==m&&Da(l),Pn(l),cb(l,b,o,m,h)),null;case 27:if(xt(l),h=K.current,b=l.type,o!==null&&l.stateNode!=null)o.memoizedProps!==m&&Da(l);else{if(!m){if(l.stateNode===null)throw Error(n(166));return Pn(l),null}o=W.current,ah(l)?yM(l):(o=qA(b,m,h),l.stateNode=o,Da(l))}return Pn(l),null;case 5:if(xt(l),b=l.type,o!==null&&l.stateNode!=null)o.memoizedProps!==m&&Da(l);else{if(!m){if(l.stateNode===null)throw Error(n(166));return Pn(l),null}if(w=W.current,ah(l))yM(l);else{var E=em(K.current);switch(w){case 1:w=E.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:w=E.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":w=E.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":w=E.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":w=E.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof m.is=="string"?E.createElement("select",{is:m.is}):E.createElement("select"),m.multiple?w.multiple=!0:m.size&&(w.size=m.size);break;default:w=typeof m.is=="string"?E.createElement(b,{is:m.is}):E.createElement(b)}}w[Zn]=l,w[Ts]=m;t:for(E=l.child;E!==null;){if(E.tag===5||E.tag===6)w.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===l)break t;for(;E.sibling===null;){if(E.return===null||E.return===l)break t;E=E.return}E.sibling.return=E.return,E=E.sibling}l.stateNode=w;t:switch(ti(w,b,m),b){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break t;case"img":m=!0;break t;default:m=!1}m&&Da(l)}}return Pn(l),cb(l,l.type,o===null?null:o.memoizedProps,l.pendingProps,h),null;case 6:if(o&&l.stateNode!=null)o.memoizedProps!==m&&Da(l);else{if(typeof m!="string"&&l.stateNode===null)throw Error(n(166));if(o=K.current,ah(l)){if(o=l.stateNode,h=l.memoizedProps,m=null,b=Zs,b!==null)switch(b.tag){case 27:case 5:m=b.memoizedProps}o[Zn]=l,o=!!(o.nodeValue===h||m!==null&&m.suppressHydrationWarning===!0||OA(o.nodeValue,h)),o||Tl(l,!0)}else o=em(o).createTextNode(m),o[Zn]=l,l.stateNode=o}return Pn(l),null;case 31:if(h=l.memoizedState,o===null||o.memoizedState!==null){if(m=ah(l),h!==null){if(o===null){if(!m)throw Error(n(318));if(o=l.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(557));o[Zn]=l}else Kc(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Pn(l),o=!1}else h=b1(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=h),o=!0;if(!o)return l.flags&256?(hr(l),l):(hr(l),null);if((l.flags&128)!==0)throw Error(n(558))}return Pn(l),null;case 13:if(m=l.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(b=ah(l),m!==null&&m.dehydrated!==null){if(o===null){if(!b)throw Error(n(318));if(b=l.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(n(317));b[Zn]=l}else Kc(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Pn(l),b=!1}else b=b1(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=b),b=!0;if(!b)return l.flags&256?(hr(l),l):(hr(l),null)}return hr(l),(l.flags&128)!==0?(l.lanes=h,l):(h=m!==null,o=o!==null&&o.memoizedState!==null,h&&(m=l.child,b=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(b=m.alternate.memoizedState.cachePool.pool),w=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(w=m.memoizedState.cachePool.pool),w!==b&&(m.flags|=2048)),h!==o&&h&&(l.child.flags|=8192),V0(l,l.updateQueue),Pn(l),null);case 4:return j(),o===null&&Db(l.stateNode.containerInfo),Pn(l),null;case 10:return Na(l.type),Pn(l),null;case 19:if(et(ms),m=l.memoizedState,m===null)return Pn(l),null;if(b=(l.flags&128)!==0,w=m.rendering,w===null)if(b)lf(m,!1);else{if(us!==0||o!==null&&(o.flags&128)!==0)for(o=l.child;o!==null;){if(w=N0(o),w!==null){for(l.flags|=128,lf(m,!1),o=w.updateQueue,l.updateQueue=o,V0(l,o),l.subtreeFlags=0,o=h,h=l.child;h!==null;)dM(h,o),h=h.sibling;return z(ms,ms.current&1|2),He&&va(l,m.treeForkCount),l.child}o=o.sibling}m.tail!==null&&jt()>q0&&(l.flags|=128,b=!0,lf(m,!1),l.lanes=4194304)}else{if(!b)if(o=N0(w),o!==null){if(l.flags|=128,b=!0,o=o.updateQueue,l.updateQueue=o,V0(l,o),lf(m,!0),m.tail===null&&m.tailMode==="hidden"&&!w.alternate&&!He)return Pn(l),null}else 2*jt()-m.renderingStartTime>q0&&h!==536870912&&(l.flags|=128,b=!0,lf(m,!1),l.lanes=4194304);m.isBackwards?(w.sibling=l.child,l.child=w):(o=m.last,o!==null?o.sibling=w:l.child=w,m.last=w)}return m.tail!==null?(o=m.tail,m.rendering=o,m.tail=o.sibling,m.renderingStartTime=jt(),o.sibling=null,h=ms.current,z(ms,b?h&1|2:h&1),He&&va(l,m.treeForkCount),o):(Pn(l),null);case 22:case 23:return hr(l),B1(),m=l.memoizedState!==null,o!==null?o.memoizedState!==null!==m&&(l.flags|=8192):m&&(l.flags|=8192),m?(h&536870912)!==0&&(l.flags&128)===0&&(Pn(l),l.subtreeFlags&6&&(l.flags|=8192)):Pn(l),h=l.updateQueue,h!==null&&V0(l,h.retryQueue),h=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),m=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(m=l.memoizedState.cachePool.pool),m!==h&&(l.flags|=2048),o!==null&&et(Jc),null;case 24:return h=null,o!==null&&(h=o.memoizedState.cache),l.memoizedState.cache!==h&&(l.flags|=2048),Na(_s),Pn(l),null;case 25:return null;case 30:return null}throw Error(n(156,l.tag))}function RO(o,l){switch(y1(l),l.tag){case 1:return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 3:return Na(_s),j(),o=l.flags,(o&65536)!==0&&(o&128)===0?(l.flags=o&-65537|128,l):null;case 26:case 27:case 5:return xt(l),null;case 31:if(l.memoizedState!==null){if(hr(l),l.alternate===null)throw Error(n(340));Kc()}return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 13:if(hr(l),o=l.memoizedState,o!==null&&o.dehydrated!==null){if(l.alternate===null)throw Error(n(340));Kc()}return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 19:return et(ms),null;case 4:return j(),null;case 10:return Na(l.type),null;case 22:case 23:return hr(l),B1(),o!==null&&et(Jc),o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 24:return Na(_s),null;case 25:return null;default:return null}}function Iv(o,l){switch(y1(l),l.tag){case 3:Na(_s),j();break;case 26:case 27:case 5:xt(l);break;case 4:j();break;case 31:l.memoizedState!==null&&hr(l);break;case 13:hr(l);break;case 19:et(ms);break;case 10:Na(l.type);break;case 22:case 23:hr(l),B1(),o!==null&&et(Jc);break;case 24:Na(_s)}}function cf(o,l){try{var h=l.updateQueue,m=h!==null?h.lastEffect:null;if(m!==null){var b=m.next;h=b;do{if((h.tag&o)===o){m=void 0;var w=h.create,E=h.inst;m=w(),E.destroy=m}h=h.next}while(h!==b)}}catch(I){gn(l,l.return,I)}}function El(o,l,h){try{var m=l.updateQueue,b=m!==null?m.lastEffect:null;if(b!==null){var w=b.next;m=w;do{if((m.tag&o)===o){var E=m.inst,I=E.destroy;if(I!==void 0){E.destroy=void 0,b=l;var it=h,Nt=I;try{Nt()}catch(Ot){gn(b,it,Ot)}}}m=m.next}while(m!==w)}}catch(Ot){gn(l,l.return,Ot)}}function Vv(o){var l=o.updateQueue;if(l!==null){var h=o.stateNode;try{CM(l,h)}catch(m){gn(o,o.return,m)}}}function Gv(o,l,h){h.props=iu(o.type,o.memoizedProps),h.state=o.memoizedState;try{h.componentWillUnmount()}catch(m){gn(o,l,m)}}function uf(o,l){try{var h=o.ref;if(h!==null){switch(o.tag){case 26:case 27:case 5:var m=o.stateNode;break;case 30:m=o.stateNode;break;default:m=o.stateNode}typeof h=="function"?o.refCleanup=h(m):h.current=m}}catch(b){gn(o,l,b)}}function Fo(o,l){var h=o.ref,m=o.refCleanup;if(h!==null)if(typeof m=="function")try{m()}catch(b){gn(o,l,b)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(b){gn(o,l,b)}else h.current=null}function kv(o){var l=o.type,h=o.memoizedProps,m=o.stateNode;try{t:switch(l){case"button":case"input":case"select":case"textarea":h.autoFocus&&m.focus();break t;case"img":h.src?m.src=h.src:h.srcSet&&(m.srcset=h.srcSet)}}catch(b){gn(o,o.return,b)}}function ub(o,l,h){try{var m=o.stateNode;KO(m,o.type,h,l),m[Ts]=l}catch(b){gn(o,o.return,b)}}function Hv(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&Ul(o.type)||o.tag===4}function hb(o){t:for(;;){for(;o.sibling===null;){if(o.return===null||Hv(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&Ul(o.type)||o.flags&2||o.child===null||o.tag===4)continue t;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function db(o,l,h){var m=o.tag;if(m===5||m===6)o=o.stateNode,l?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(o,l):(l=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,l.appendChild(o),h=h._reactRootContainer,h!=null||l.onclick!==null||(l.onclick=Ta));else if(m!==4&&(m===27&&Ul(o.type)&&(h=o.stateNode,l=null),o=o.child,o!==null))for(db(o,l,h),o=o.sibling;o!==null;)db(o,l,h),o=o.sibling}function G0(o,l,h){var m=o.tag;if(m===5||m===6)o=o.stateNode,l?h.insertBefore(o,l):h.appendChild(o);else if(m!==4&&(m===27&&Ul(o.type)&&(h=o.stateNode),o=o.child,o!==null))for(G0(o,l,h),o=o.sibling;o!==null;)G0(o,l,h),o=o.sibling}function Wv(o){var l=o.stateNode,h=o.memoizedProps;try{for(var m=o.type,b=l.attributes;b.length;)l.removeAttributeNode(b[0]);ti(l,m,h),l[Zn]=o,l[Ts]=h}catch(w){gn(o,o.return,w)}}var Ba=!1,As=!1,fb=!1,qv=typeof WeakSet=="function"?WeakSet:Set,Gs=null;function EO(o,l){if(o=o.containerInfo,Ob=lm,o=sM(o),o1(o)){if("selectionStart"in o)var h={start:o.selectionStart,end:o.selectionEnd};else t:{h=(h=o.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&m.rangeCount!==0){h=m.anchorNode;var b=m.anchorOffset,w=m.focusNode;m=m.focusOffset;try{h.nodeType,w.nodeType}catch{h=null;break t}var E=0,I=-1,it=-1,Nt=0,Ot=0,It=o,Et=null;e:for(;;){for(var Ct;It!==h||b!==0&&It.nodeType!==3||(I=E+b),It!==w||m!==0&&It.nodeType!==3||(it=E+m),It.nodeType===3&&(E+=It.nodeValue.length),(Ct=It.firstChild)!==null;)Et=It,It=Ct;for(;;){if(It===o)break e;if(Et===h&&++Nt===b&&(I=E),Et===w&&++Ot===m&&(it=E),(Ct=It.nextSibling)!==null)break;It=Et,Et=It.parentNode}It=Ct}h=I===-1||it===-1?null:{start:I,end:it}}else h=null}h=h||{start:0,end:0}}else h=null;for(Fb={focusedElem:o,selectionRange:h},lm=!1,Gs=l;Gs!==null;)if(l=Gs,o=l.child,(l.subtreeFlags&1028)!==0&&o!==null)o.return=l,Gs=o;else for(;Gs!==null;){switch(l=Gs,w=l.alternate,o=l.flags,l.tag){case 0:if((o&4)!==0&&(o=l.updateQueue,o=o!==null?o.events:null,o!==null))for(h=0;h<o.length;h++)b=o[h],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((o&1024)!==0&&w!==null){o=void 0,h=l,b=w.memoizedProps,w=w.memoizedState,m=h.stateNode;try{var se=iu(h.type,b);o=m.getSnapshotBeforeUpdate(se,w),m.__reactInternalSnapshotBeforeUpdate=o}catch(pe){gn(h,h.return,pe)}}break;case 3:if((o&1024)!==0){if(o=l.stateNode.containerInfo,h=o.nodeType,h===9)zb(o);else if(h===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":zb(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(n(163))}if(o=l.sibling,o!==null){o.return=l.return,Gs=o;break}Gs=l.return}}function $v(o,l,h){var m=h.flags;switch(h.tag){case 0:case 11:case 15:Oa(o,h),m&4&&cf(5,h);break;case 1:if(Oa(o,h),m&4)if(o=h.stateNode,l===null)try{o.componentDidMount()}catch(E){gn(h,h.return,E)}else{var b=iu(h.type,l.memoizedProps);l=l.memoizedState;try{o.componentDidUpdate(b,l,o.__reactInternalSnapshotBeforeUpdate)}catch(E){gn(h,h.return,E)}}m&64&&Vv(h),m&512&&uf(h,h.return);break;case 3:if(Oa(o,h),m&64&&(o=h.updateQueue,o!==null)){if(l=null,h.child!==null)switch(h.child.tag){case 27:case 5:l=h.child.stateNode;break;case 1:l=h.child.stateNode}try{CM(o,l)}catch(E){gn(h,h.return,E)}}break;case 27:l===null&&m&4&&Wv(h);case 26:case 5:Oa(o,h),l===null&&m&4&&kv(h),m&512&&uf(h,h.return);break;case 12:Oa(o,h);break;case 31:Oa(o,h),m&4&&Yv(o,h);break;case 13:Oa(o,h),m&4&&Kv(o,h),m&64&&(o=h.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(h=zO.bind(null,h),iF(o,h))));break;case 22:if(m=h.memoizedState!==null||Ba,!m){l=l!==null&&l.memoizedState!==null||As,b=Ba;var w=As;Ba=m,(As=l)&&!w?Fa(o,h,(h.subtreeFlags&8772)!==0):Oa(o,h),Ba=b,As=w}break;case 30:break;default:Oa(o,h)}}function Xv(o){var l=o.alternate;l!==null&&(o.alternate=null,Xv(l)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(l=o.stateNode,l!==null&&Sa(l)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var Gn=null,Vi=!1;function La(o,l,h){for(h=h.child;h!==null;)jv(o,l,h),h=h.sibling}function jv(o,l,h){if(Ye&&typeof Ye.onCommitFiberUnmount=="function")try{Ye.onCommitFiberUnmount(we,h)}catch{}switch(h.tag){case 26:As||Fo(h,l),La(o,l,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:As||Fo(h,l);var m=Gn,b=Vi;Ul(h.type)&&(Gn=h.stateNode,Vi=!1),La(o,l,h),bf(h.stateNode),Gn=m,Vi=b;break;case 5:As||Fo(h,l);case 6:if(m=Gn,b=Vi,Gn=null,La(o,l,h),Gn=m,Vi=b,Gn!==null)if(Vi)try{(Gn.nodeType===9?Gn.body:Gn.nodeName==="HTML"?Gn.ownerDocument.body:Gn).removeChild(h.stateNode)}catch(w){gn(h,l,w)}else try{Gn.removeChild(h.stateNode)}catch(w){gn(h,l,w)}break;case 18:Gn!==null&&(Vi?(o=Gn,VA(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,h.stateNode),Rh(o)):VA(Gn,h.stateNode));break;case 4:m=Gn,b=Vi,Gn=h.stateNode.containerInfo,Vi=!0,La(o,l,h),Gn=m,Vi=b;break;case 0:case 11:case 14:case 15:El(2,h,l),As||El(4,h,l),La(o,l,h);break;case 1:As||(Fo(h,l),m=h.stateNode,typeof m.componentWillUnmount=="function"&&Gv(h,l,m)),La(o,l,h);break;case 21:La(o,l,h);break;case 22:As=(m=As)||h.memoizedState!==null,La(o,l,h),As=m;break;default:La(o,l,h)}}function Yv(o,l){if(l.memoizedState===null&&(o=l.alternate,o!==null&&(o=o.memoizedState,o!==null))){o=o.dehydrated;try{Rh(o)}catch(h){gn(l,l.return,h)}}}function Kv(o,l){if(l.memoizedState===null&&(o=l.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{Rh(o)}catch(h){gn(l,l.return,h)}}function CO(o){switch(o.tag){case 31:case 13:case 19:var l=o.stateNode;return l===null&&(l=o.stateNode=new qv),l;case 22:return o=o.stateNode,l=o._retryCache,l===null&&(l=o._retryCache=new qv),l;default:throw Error(n(435,o.tag))}}function k0(o,l){var h=CO(o);l.forEach(function(m){if(!h.has(m)){h.add(m);var b=IO.bind(null,o,m);m.then(b,b)}})}function Gi(o,l){var h=l.deletions;if(h!==null)for(var m=0;m<h.length;m++){var b=h[m],w=o,E=l,I=E;t:for(;I!==null;){switch(I.tag){case 27:if(Ul(I.type)){Gn=I.stateNode,Vi=!1;break t}break;case 5:Gn=I.stateNode,Vi=!1;break t;case 3:case 4:Gn=I.stateNode.containerInfo,Vi=!0;break t}I=I.return}if(Gn===null)throw Error(n(160));jv(w,E,b),Gn=null,Vi=!1,w=b.alternate,w!==null&&(w.return=null),b.return=null}if(l.subtreeFlags&13886)for(l=l.child;l!==null;)Zv(l,o),l=l.sibling}var fo=null;function Zv(o,l){var h=o.alternate,m=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Gi(l,o),ki(o),m&4&&(El(3,o,o.return),cf(3,o),El(5,o,o.return));break;case 1:Gi(l,o),ki(o),m&512&&(As||h===null||Fo(h,h.return)),m&64&&Ba&&(o=o.updateQueue,o!==null&&(m=o.callbacks,m!==null&&(h=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=h===null?m:h.concat(m))));break;case 26:var b=fo;if(Gi(l,o),ki(o),m&512&&(As||h===null||Fo(h,h.return)),m&4){var w=h!==null?h.memoizedState:null;if(m=o.memoizedState,h===null)if(m===null)if(o.stateNode===null){t:{m=o.type,h=o.memoizedProps,b=b.ownerDocument||b;e:switch(m){case"title":w=b.getElementsByTagName("title")[0],(!w||w[co]||w[Zn]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=b.createElement(m),b.head.insertBefore(w,b.querySelector("head > title"))),ti(w,m,h),w[Zn]=o,vn(w),m=w;break t;case"link":var E=ZA("link","href",b).get(m+(h.href||""));if(E){for(var I=0;I<E.length;I++)if(w=E[I],w.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&w.getAttribute("rel")===(h.rel==null?null:h.rel)&&w.getAttribute("title")===(h.title==null?null:h.title)&&w.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){E.splice(I,1);break e}}w=b.createElement(m),ti(w,m,h),b.head.appendChild(w);break;case"meta":if(E=ZA("meta","content",b).get(m+(h.content||""))){for(I=0;I<E.length;I++)if(w=E[I],w.getAttribute("content")===(h.content==null?null:""+h.content)&&w.getAttribute("name")===(h.name==null?null:h.name)&&w.getAttribute("property")===(h.property==null?null:h.property)&&w.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&w.getAttribute("charset")===(h.charSet==null?null:h.charSet)){E.splice(I,1);break e}}w=b.createElement(m),ti(w,m,h),b.head.appendChild(w);break;default:throw Error(n(468,m))}w[Zn]=o,vn(w),m=w}o.stateNode=m}else QA(b,o.type,o.stateNode);else o.stateNode=KA(b,m,o.memoizedProps);else w!==m?(w===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):w.count--,m===null?QA(b,o.type,o.stateNode):KA(b,m,o.memoizedProps)):m===null&&o.stateNode!==null&&ub(o,o.memoizedProps,h.memoizedProps)}break;case 27:Gi(l,o),ki(o),m&512&&(As||h===null||Fo(h,h.return)),h!==null&&m&4&&ub(o,o.memoizedProps,h.memoizedProps);break;case 5:if(Gi(l,o),ki(o),m&512&&(As||h===null||Fo(h,h.return)),o.flags&32){b=o.stateNode;try{Zu(b,"")}catch(se){gn(o,o.return,se)}}m&4&&o.stateNode!=null&&(b=o.memoizedProps,ub(o,b,h!==null?h.memoizedProps:b)),m&1024&&(fb=!0);break;case 6:if(Gi(l,o),ki(o),m&4){if(o.stateNode===null)throw Error(n(162));m=o.memoizedProps,h=o.stateNode;try{h.nodeValue=m}catch(se){gn(o,o.return,se)}}break;case 3:if(im=null,b=fo,fo=nm(l.containerInfo),Gi(l,o),fo=b,ki(o),m&4&&h!==null&&h.memoizedState.isDehydrated)try{Rh(l.containerInfo)}catch(se){gn(o,o.return,se)}fb&&(fb=!1,Qv(o));break;case 4:m=fo,fo=nm(o.stateNode.containerInfo),Gi(l,o),ki(o),fo=m;break;case 12:Gi(l,o),ki(o);break;case 31:Gi(l,o),ki(o),m&4&&(m=o.updateQueue,m!==null&&(o.updateQueue=null,k0(o,m)));break;case 13:Gi(l,o),ki(o),o.child.flags&8192&&o.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(W0=jt()),m&4&&(m=o.updateQueue,m!==null&&(o.updateQueue=null,k0(o,m)));break;case 22:b=o.memoizedState!==null;var it=h!==null&&h.memoizedState!==null,Nt=Ba,Ot=As;if(Ba=Nt||b,As=Ot||it,Gi(l,o),As=Ot,Ba=Nt,ki(o),m&8192)t:for(l=o.stateNode,l._visibility=b?l._visibility&-2:l._visibility|1,b&&(h===null||it||Ba||As||ru(o)),h=null,l=o;;){if(l.tag===5||l.tag===26){if(h===null){it=h=l;try{if(w=it.stateNode,b)E=w.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none";else{I=it.stateNode;var It=it.memoizedProps.style,Et=It!=null&&It.hasOwnProperty("display")?It.display:null;I.style.display=Et==null||typeof Et=="boolean"?"":(""+Et).trim()}}catch(se){gn(it,it.return,se)}}}else if(l.tag===6){if(h===null){it=l;try{it.stateNode.nodeValue=b?"":it.memoizedProps}catch(se){gn(it,it.return,se)}}}else if(l.tag===18){if(h===null){it=l;try{var Ct=it.stateNode;b?GA(Ct,!0):GA(it.stateNode,!1)}catch(se){gn(it,it.return,se)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===o)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break t;for(;l.sibling===null;){if(l.return===null||l.return===o)break t;h===l&&(h=null),l=l.return}h===l&&(h=null),l.sibling.return=l.return,l=l.sibling}m&4&&(m=o.updateQueue,m!==null&&(h=m.retryQueue,h!==null&&(m.retryQueue=null,k0(o,h))));break;case 19:Gi(l,o),ki(o),m&4&&(m=o.updateQueue,m!==null&&(o.updateQueue=null,k0(o,m)));break;case 30:break;case 21:break;default:Gi(l,o),ki(o)}}function ki(o){var l=o.flags;if(l&2){try{for(var h,m=o.return;m!==null;){if(Hv(m)){h=m;break}m=m.return}if(h==null)throw Error(n(160));switch(h.tag){case 27:var b=h.stateNode,w=hb(o);G0(o,w,b);break;case 5:var E=h.stateNode;h.flags&32&&(Zu(E,""),h.flags&=-33);var I=hb(o);G0(o,I,E);break;case 3:case 4:var it=h.stateNode.containerInfo,Nt=hb(o);db(o,Nt,it);break;default:throw Error(n(161))}}catch(Ot){gn(o,o.return,Ot)}o.flags&=-3}l&4096&&(o.flags&=-4097)}function Qv(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var l=o;Qv(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),o=o.sibling}}function Oa(o,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)$v(o,l.alternate,l),l=l.sibling}function ru(o){for(o=o.child;o!==null;){var l=o;switch(l.tag){case 0:case 11:case 14:case 15:El(4,l,l.return),ru(l);break;case 1:Fo(l,l.return);var h=l.stateNode;typeof h.componentWillUnmount=="function"&&Gv(l,l.return,h),ru(l);break;case 27:bf(l.stateNode);case 26:case 5:Fo(l,l.return),ru(l);break;case 22:l.memoizedState===null&&ru(l);break;case 30:ru(l);break;default:ru(l)}o=o.sibling}}function Fa(o,l,h){for(h=h&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var m=l.alternate,b=o,w=l,E=w.flags;switch(w.tag){case 0:case 11:case 15:Fa(b,w,h),cf(4,w);break;case 1:if(Fa(b,w,h),m=w,b=m.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Nt){gn(m,m.return,Nt)}if(m=w,b=m.updateQueue,b!==null){var I=m.stateNode;try{var it=b.shared.hiddenCallbacks;if(it!==null)for(b.shared.hiddenCallbacks=null,b=0;b<it.length;b++)EM(it[b],I)}catch(Nt){gn(m,m.return,Nt)}}h&&E&64&&Vv(w),uf(w,w.return);break;case 27:Wv(w);case 26:case 5:Fa(b,w,h),h&&m===null&&E&4&&kv(w),uf(w,w.return);break;case 12:Fa(b,w,h);break;case 31:Fa(b,w,h),h&&E&4&&Yv(b,w);break;case 13:Fa(b,w,h),h&&E&4&&Kv(b,w);break;case 22:w.memoizedState===null&&Fa(b,w,h),uf(w,w.return);break;case 30:break;default:Fa(b,w,h)}l=l.sibling}}function pb(o,l){var h=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),o=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(o=l.memoizedState.cachePool.pool),o!==h&&(o!=null&&o.refCount++,h!=null&&Yd(h))}function mb(o,l){o=null,l.alternate!==null&&(o=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==o&&(l.refCount++,o!=null&&Yd(o))}function po(o,l,h,m){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)Jv(o,l,h,m),l=l.sibling}function Jv(o,l,h,m){var b=l.flags;switch(l.tag){case 0:case 11:case 15:po(o,l,h,m),b&2048&&cf(9,l);break;case 1:po(o,l,h,m);break;case 3:po(o,l,h,m),b&2048&&(o=null,l.alternate!==null&&(o=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==o&&(l.refCount++,o!=null&&Yd(o)));break;case 12:if(b&2048){po(o,l,h,m),o=l.stateNode;try{var w=l.memoizedProps,E=w.id,I=w.onPostCommit;typeof I=="function"&&I(E,l.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(it){gn(l,l.return,it)}}else po(o,l,h,m);break;case 31:po(o,l,h,m);break;case 13:po(o,l,h,m);break;case 23:break;case 22:w=l.stateNode,E=l.alternate,l.memoizedState!==null?w._visibility&2?po(o,l,h,m):hf(o,l):w._visibility&2?po(o,l,h,m):(w._visibility|=2,yh(o,l,h,m,(l.subtreeFlags&10256)!==0||!1)),b&2048&&pb(E,l);break;case 24:po(o,l,h,m),b&2048&&mb(l.alternate,l);break;default:po(o,l,h,m)}}function yh(o,l,h,m,b){for(b=b&&((l.subtreeFlags&10256)!==0||!1),l=l.child;l!==null;){var w=o,E=l,I=h,it=m,Nt=E.flags;switch(E.tag){case 0:case 11:case 15:yh(w,E,I,it,b),cf(8,E);break;case 23:break;case 22:var Ot=E.stateNode;E.memoizedState!==null?Ot._visibility&2?yh(w,E,I,it,b):hf(w,E):(Ot._visibility|=2,yh(w,E,I,it,b)),b&&Nt&2048&&pb(E.alternate,E);break;case 24:yh(w,E,I,it,b),b&&Nt&2048&&mb(E.alternate,E);break;default:yh(w,E,I,it,b)}l=l.sibling}}function hf(o,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var h=o,m=l,b=m.flags;switch(m.tag){case 22:hf(h,m),b&2048&&pb(m.alternate,m);break;case 24:hf(h,m),b&2048&&mb(m.alternate,m);break;default:hf(h,m)}l=l.sibling}}var df=8192;function xh(o,l,h){if(o.subtreeFlags&df)for(o=o.child;o!==null;)tA(o,l,h),o=o.sibling}function tA(o,l,h){switch(o.tag){case 26:xh(o,l,h),o.flags&df&&o.memoizedState!==null&&gF(h,fo,o.memoizedState,o.memoizedProps);break;case 5:xh(o,l,h);break;case 3:case 4:var m=fo;fo=nm(o.stateNode.containerInfo),xh(o,l,h),fo=m;break;case 22:o.memoizedState===null&&(m=o.alternate,m!==null&&m.memoizedState!==null?(m=df,df=16777216,xh(o,l,h),df=m):xh(o,l,h));break;default:xh(o,l,h)}}function eA(o){var l=o.alternate;if(l!==null&&(o=l.child,o!==null)){l.child=null;do l=o.sibling,o.sibling=null,o=l;while(o!==null)}}function ff(o){var l=o.deletions;if((o.flags&16)!==0){if(l!==null)for(var h=0;h<l.length;h++){var m=l[h];Gs=m,sA(m,o)}eA(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)nA(o),o=o.sibling}function nA(o){switch(o.tag){case 0:case 11:case 15:ff(o),o.flags&2048&&El(9,o,o.return);break;case 3:ff(o);break;case 12:ff(o);break;case 22:var l=o.stateNode;o.memoizedState!==null&&l._visibility&2&&(o.return===null||o.return.tag!==13)?(l._visibility&=-3,H0(o)):ff(o);break;default:ff(o)}}function H0(o){var l=o.deletions;if((o.flags&16)!==0){if(l!==null)for(var h=0;h<l.length;h++){var m=l[h];Gs=m,sA(m,o)}eA(o)}for(o=o.child;o!==null;){switch(l=o,l.tag){case 0:case 11:case 15:El(8,l,l.return),H0(l);break;case 22:h=l.stateNode,h._visibility&2&&(h._visibility&=-3,H0(l));break;default:H0(l)}o=o.sibling}}function sA(o,l){for(;Gs!==null;){var h=Gs;switch(h.tag){case 0:case 11:case 15:El(8,h,l);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var m=h.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Yd(h.memoizedState.cache)}if(m=h.child,m!==null)m.return=h,Gs=m;else t:for(h=o;Gs!==null;){m=Gs;var b=m.sibling,w=m.return;if(Xv(m),m===h){Gs=null;break t}if(b!==null){b.return=w,Gs=b;break t}Gs=w}}}var DO={getCacheForType:function(o){var l=Qs(_s),h=l.data.get(o);return h===void 0&&(h=o(),l.data.set(o,h)),h},cacheSignal:function(){return Qs(_s).controller.signal}},BO=typeof WeakMap=="function"?WeakMap:Map,sn=0,An=null,Fe=null,ze=0,mn=0,dr=null,Cl=!1,bh=!1,gb=!1,Ua=0,us=0,Dl=0,ou=0,yb=0,fr=0,Sh=0,pf=null,Hi=null,xb=!1,W0=0,iA=0,q0=1/0,$0=null,Bl=null,Bs=0,Ll=null,wh=null,Pa=0,bb=0,Sb=null,rA=null,mf=0,wb=null;function pr(){return(sn&2)!==0&&ze!==0?ze&-ze:F.T!==null?Nb():lo()}function oA(){if(fr===0)if((ze&536870912)===0||He){var o=ls;ls<<=1,(ls&3932160)===0&&(ls=262144),fr=o}else fr=536870912;return o=ur.current,o!==null&&(o.flags|=32),fr}function Wi(o,l,h){(o===An&&(mn===2||mn===9)||o.cancelPendingCommit!==null)&&(Th(o,0),Ol(o,ze,fr,!1)),Ui(o,h),((sn&2)===0||o!==An)&&(o===An&&((sn&2)===0&&(ou|=h),us===4&&Ol(o,ze,fr,!1)),Uo(o))}function aA(o,l,h){if((sn&6)!==0)throw Error(n(327));var m=!h&&(l&127)===0&&(l&o.expiredLanes)===0||$e(o,l),b=m?FO(o,l):_b(o,l,!0),w=m;do{if(b===0){bh&&!m&&Ol(o,l,0,!1);break}else{if(h=o.current.alternate,w&&!LO(h)){b=_b(o,l,!1),w=!1;continue}if(b===2){if(w=l,o.errorRecoveryDisabledLanes&w)var E=0;else E=o.pendingLanes&-536870913,E=E!==0?E:E&536870912?536870912:0;if(E!==0){l=E;t:{var I=o;b=pf;var it=I.current.memoizedState.isDehydrated;if(it&&(Th(I,E).flags|=256),E=_b(I,E,!1),E!==2){if(gb&&!it){I.errorRecoveryDisabledLanes|=w,ou|=w,b=4;break t}w=Hi,Hi=b,w!==null&&(Hi===null?Hi=w:Hi.push.apply(Hi,w))}b=E}if(w=!1,b!==2)continue}}if(b===1){Th(o,0),Ol(o,l,0,!0);break}t:{switch(m=o,w=b,w){case 0:case 1:throw Error(n(345));case 4:if((l&4194048)!==l)break;case 6:Ol(m,l,fr,!Cl);break t;case 2:Hi=null;break;case 3:case 5:break;default:throw Error(n(329))}if((l&62914560)===l&&(b=W0+300-jt(),10<b)){if(Ol(m,l,fr,!Cl),ke(m,0,!0)!==0)break t;Pa=l,m.timeoutHandle=zA(lA.bind(null,m,h,Hi,$0,xb,l,fr,ou,Sh,Cl,w,"Throttled",-0,0),b);break t}lA(m,h,Hi,$0,xb,l,fr,ou,Sh,Cl,w,null,-0,0)}}break}while(!0);Uo(o)}function lA(o,l,h,m,b,w,E,I,it,Nt,Ot,It,Et,Ct){if(o.timeoutHandle=-1,It=l.subtreeFlags,It&8192||(It&16785408)===16785408){It={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ta},tA(l,w,It);var se=(w&62914560)===w?W0-jt():(w&4194048)===w?iA-jt():0;if(se=yF(It,se),se!==null){Pa=w,o.cancelPendingCommit=se(gA.bind(null,o,l,w,h,m,b,E,I,it,Ot,It,null,Et,Ct)),Ol(o,w,E,!Nt);return}}gA(o,l,w,h,m,b,E,I,it)}function LO(o){for(var l=o;;){var h=l.tag;if((h===0||h===11||h===15)&&l.flags&16384&&(h=l.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var m=0;m<h.length;m++){var b=h[m],w=b.getSnapshot;b=b.value;try{if(!lr(w(),b))return!1}catch{return!1}}if(h=l.child,l.subtreeFlags&16384&&h!==null)h.return=l,l=h;else{if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Ol(o,l,h,m){l&=~yb,l&=~ou,o.suspendedLanes|=l,o.pingedLanes&=~l,m&&(o.warmLanes|=l),m=o.expirationTimes;for(var b=l;0<b;){var w=31-Ge(b),E=1<<w;m[w]=-1,b&=~E}h!==0&&ao(o,h,l)}function X0(){return(sn&6)===0?(gf(0),!1):!0}function Tb(){if(Fe!==null){if(mn===0)var o=Fe.return;else o=Fe,Aa=Zc=null,z1(o),dh=null,Zd=0,o=Fe;for(;o!==null;)Iv(o.alternate,o),o=o.return;Fe=null}}function Th(o,l){var h=o.timeoutHandle;h!==-1&&(o.timeoutHandle=-1,JO(h)),h=o.cancelPendingCommit,h!==null&&(o.cancelPendingCommit=null,h()),Pa=0,Tb(),An=o,Fe=h=Ma(o.current,null),ze=l,mn=0,dr=null,Cl=!1,bh=$e(o,l),gb=!1,Sh=fr=yb=ou=Dl=us=0,Hi=pf=null,xb=!1,(l&8)!==0&&(l|=l&32);var m=o.entangledLanes;if(m!==0)for(o=o.entanglements,m&=l;0<m;){var b=31-Ge(m),w=1<<b;l|=o[b],m&=~w}return Ua=l,p0(),h}function cA(o,l){Ae=null,F.H=of,l===hh||l===T0?(l=vM(),mn=3):l===A1?(l=vM(),mn=4):mn=l===tb?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,dr=l,Fe===null&&(us=1,U0(o,Fr(l,o.current)))}function uA(){var o=ur.current;return o===null?!0:(ze&4194048)===ze?Ir===null:(ze&62914560)===ze||(ze&536870912)!==0?o===Ir:!1}function hA(){var o=F.H;return F.H=of,o===null?of:o}function dA(){var o=F.A;return F.A=DO,o}function j0(){us=4,Cl||(ze&4194048)!==ze&&ur.current!==null||(bh=!0),(Dl&134217727)===0&&(ou&134217727)===0||An===null||Ol(An,ze,fr,!1)}function _b(o,l,h){var m=sn;sn|=2;var b=hA(),w=dA();(An!==o||ze!==l)&&($0=null,Th(o,l)),l=!1;var E=us;t:do try{if(mn!==0&&Fe!==null){var I=Fe,it=dr;switch(mn){case 8:Tb(),E=6;break t;case 3:case 2:case 9:case 6:ur.current===null&&(l=!0);var Nt=mn;if(mn=0,dr=null,_h(o,I,it,Nt),h&&bh){E=0;break t}break;default:Nt=mn,mn=0,dr=null,_h(o,I,it,Nt)}}OO(),E=us;break}catch(Ot){cA(o,Ot)}while(!0);return l&&o.shellSuspendCounter++,Aa=Zc=null,sn=m,F.H=b,F.A=w,Fe===null&&(An=null,ze=0,p0()),E}function OO(){for(;Fe!==null;)fA(Fe)}function FO(o,l){var h=sn;sn|=2;var m=hA(),b=dA();An!==o||ze!==l?($0=null,q0=jt()+500,Th(o,l)):bh=$e(o,l);t:do try{if(mn!==0&&Fe!==null){l=Fe;var w=dr;e:switch(mn){case 1:mn=0,dr=null,_h(o,l,w,1);break;case 2:case 9:if(_M(w)){mn=0,dr=null,pA(l);break}l=function(){mn!==2&&mn!==9||An!==o||(mn=7),Uo(o)},w.then(l,l);break t;case 3:mn=7;break t;case 4:mn=5;break t;case 7:_M(w)?(mn=0,dr=null,pA(l)):(mn=0,dr=null,_h(o,l,w,7));break;case 5:var E=null;switch(Fe.tag){case 26:E=Fe.memoizedState;case 5:case 27:var I=Fe;if(E?JA(E):I.stateNode.complete){mn=0,dr=null;var it=I.sibling;if(it!==null)Fe=it;else{var Nt=I.return;Nt!==null?(Fe=Nt,Y0(Nt)):Fe=null}break e}}mn=0,dr=null,_h(o,l,w,5);break;case 6:mn=0,dr=null,_h(o,l,w,6);break;case 8:Tb(),us=6;break t;default:throw Error(n(462))}}UO();break}catch(Ot){cA(o,Ot)}while(!0);return Aa=Zc=null,F.H=m,F.A=b,sn=h,Fe!==null?0:(An=null,ze=0,p0(),us)}function UO(){for(;Fe!==null&&!ae();)fA(Fe)}function fA(o){var l=Pv(o.alternate,o,Ua);o.memoizedProps=o.pendingProps,l===null?Y0(o):Fe=l}function pA(o){var l=o,h=l.alternate;switch(l.tag){case 15:case 0:l=Dv(h,l,l.pendingProps,l.type,void 0,ze);break;case 11:l=Dv(h,l,l.pendingProps,l.type.render,l.ref,ze);break;case 5:z1(l);default:Iv(h,l),l=Fe=dM(l,Ua),l=Pv(h,l,Ua)}o.memoizedProps=o.pendingProps,l===null?Y0(o):Fe=l}function _h(o,l,h,m){Aa=Zc=null,z1(l),dh=null,Zd=0;var b=l.return;try{if(MO(o,b,l,h,ze)){us=1,U0(o,Fr(h,o.current)),Fe=null;return}}catch(w){if(b!==null)throw Fe=b,w;us=1,U0(o,Fr(h,o.current)),Fe=null;return}l.flags&32768?(He||m===1?o=!0:bh||(ze&536870912)!==0?o=!1:(Cl=o=!0,(m===2||m===9||m===3||m===6)&&(m=ur.current,m!==null&&m.tag===13&&(m.flags|=16384))),mA(l,o)):Y0(l)}function Y0(o){var l=o;do{if((l.flags&32768)!==0){mA(l,Cl);return}o=l.return;var h=NO(l.alternate,l,Ua);if(h!==null){Fe=h;return}if(l=l.sibling,l!==null){Fe=l;return}Fe=l=o}while(l!==null);us===0&&(us=5)}function mA(o,l){do{var h=RO(o.alternate,o);if(h!==null){h.flags&=32767,Fe=h;return}if(h=o.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!l&&(o=o.sibling,o!==null)){Fe=o;return}Fe=o=h}while(o!==null);us=6,Fe=null}function gA(o,l,h,m,b,w,E,I,it){o.cancelPendingCommit=null;do K0();while(Bs!==0);if((sn&6)!==0)throw Error(n(327));if(l!==null){if(l===o.current)throw Error(n(177));if(w=l.lanes|l.childLanes,w|=h1,Do(o,h,w,E,I,it),o===An&&(Fe=An=null,ze=0),wh=l,Ll=o,Pa=h,bb=w,Sb=b,rA=m,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,VO(je,function(){return wA(),null})):(o.callbackNode=null,o.callbackPriority=0),m=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||m){m=F.T,F.T=null,b=Y.p,Y.p=2,E=sn,sn|=4;try{EO(o,l,h)}finally{sn=E,Y.p=b,F.T=m}}Bs=1,yA(),xA(),bA()}}function yA(){if(Bs===1){Bs=0;var o=Ll,l=wh,h=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||h){h=F.T,F.T=null;var m=Y.p;Y.p=2;var b=sn;sn|=4;try{Zv(l,o);var w=Fb,E=sM(o.containerInfo),I=w.focusedElem,it=w.selectionRange;if(E!==I&&I&&I.ownerDocument&&nM(I.ownerDocument.documentElement,I)){if(it!==null&&o1(I)){var Nt=it.start,Ot=it.end;if(Ot===void 0&&(Ot=Nt),"selectionStart"in I)I.selectionStart=Nt,I.selectionEnd=Math.min(Ot,I.value.length);else{var It=I.ownerDocument||document,Et=It&&It.defaultView||window;if(Et.getSelection){var Ct=Et.getSelection(),se=I.textContent.length,pe=Math.min(it.start,se),Tn=it.end===void 0?pe:Math.min(it.end,se);!Ct.extend&&pe>Tn&&(E=Tn,Tn=pe,pe=E);var wt=eM(I,pe),gt=eM(I,Tn);if(wt&&gt&&(Ct.rangeCount!==1||Ct.anchorNode!==wt.node||Ct.anchorOffset!==wt.offset||Ct.focusNode!==gt.node||Ct.focusOffset!==gt.offset)){var At=It.createRange();At.setStart(wt.node,wt.offset),Ct.removeAllRanges(),pe>Tn?(Ct.addRange(At),Ct.extend(gt.node,gt.offset)):(At.setEnd(gt.node,gt.offset),Ct.addRange(At))}}}}for(It=[],Ct=I;Ct=Ct.parentNode;)Ct.nodeType===1&&It.push({element:Ct,left:Ct.scrollLeft,top:Ct.scrollTop});for(typeof I.focus=="function"&&I.focus(),I=0;I<It.length;I++){var Pt=It[I];Pt.element.scrollLeft=Pt.left,Pt.element.scrollTop=Pt.top}}lm=!!Ob,Fb=Ob=null}finally{sn=b,Y.p=m,F.T=h}}o.current=l,Bs=2}}function xA(){if(Bs===2){Bs=0;var o=Ll,l=wh,h=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||h){h=F.T,F.T=null;var m=Y.p;Y.p=2;var b=sn;sn|=4;try{$v(o,l.alternate,l)}finally{sn=b,Y.p=m,F.T=h}}Bs=3}}function bA(){if(Bs===4||Bs===3){Bs=0,Kt();var o=Ll,l=wh,h=Pa,m=rA;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Bs=5:(Bs=0,wh=Ll=null,SA(o,o.pendingLanes));var b=o.pendingLanes;if(b===0&&(Bl=null),ba(h),l=l.stateNode,Ye&&typeof Ye.onCommitFiberRoot=="function")try{Ye.onCommitFiberRoot(we,l,void 0,(l.current.flags&128)===128)}catch{}if(m!==null){l=F.T,b=Y.p,Y.p=2,F.T=null;try{for(var w=o.onRecoverableError,E=0;E<m.length;E++){var I=m[E];w(I.value,{componentStack:I.stack})}}finally{F.T=l,Y.p=b}}(Pa&3)!==0&&K0(),Uo(o),b=o.pendingLanes,(h&261930)!==0&&(b&42)!==0?o===wb?mf++:(mf=0,wb=o):mf=0,gf(0)}}function SA(o,l){(o.pooledCacheLanes&=l)===0&&(l=o.pooledCache,l!=null&&(o.pooledCache=null,Yd(l)))}function K0(){return yA(),xA(),bA(),wA()}function wA(){if(Bs!==5)return!1;var o=Ll,l=bb;bb=0;var h=ba(Pa),m=F.T,b=Y.p;try{Y.p=32>h?32:h,F.T=null,h=Sb,Sb=null;var w=Ll,E=Pa;if(Bs=0,wh=Ll=null,Pa=0,(sn&6)!==0)throw Error(n(331));var I=sn;if(sn|=4,nA(w.current),Jv(w,w.current,E,h),sn=I,gf(0,!1),Ye&&typeof Ye.onPostCommitFiberRoot=="function")try{Ye.onPostCommitFiberRoot(we,w)}catch{}return!0}finally{Y.p=b,F.T=m,SA(o,l)}}function TA(o,l,h){l=Fr(h,l),l=J1(o.stateNode,l,2),o=Al(o,l,2),o!==null&&(Ui(o,2),Uo(o))}function gn(o,l,h){if(o.tag===3)TA(o,o,h);else for(;l!==null;){if(l.tag===3){TA(l,o,h);break}else if(l.tag===1){var m=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Bl===null||!Bl.has(m))){o=Fr(h,o),h=_v(2),m=Al(l,h,2),m!==null&&(Mv(h,m,l,o),Ui(m,2),Uo(m));break}}l=l.return}}function Mb(o,l,h){var m=o.pingCache;if(m===null){m=o.pingCache=new BO;var b=new Set;m.set(l,b)}else b=m.get(l),b===void 0&&(b=new Set,m.set(l,b));b.has(h)||(gb=!0,b.add(h),o=PO.bind(null,o,l,h),l.then(o,o))}function PO(o,l,h){var m=o.pingCache;m!==null&&m.delete(l),o.pingedLanes|=o.suspendedLanes&h,o.warmLanes&=~h,An===o&&(ze&h)===h&&(us===4||us===3&&(ze&62914560)===ze&&300>jt()-W0?(sn&2)===0&&Th(o,0):yb|=h,Sh===ze&&(Sh=0)),Uo(o)}function _A(o,l){l===0&&(l=oo()),o=jc(o,l),o!==null&&(Ui(o,l),Uo(o))}function zO(o){var l=o.memoizedState,h=0;l!==null&&(h=l.retryLane),_A(o,h)}function IO(o,l){var h=0;switch(o.tag){case 31:case 13:var m=o.stateNode,b=o.memoizedState;b!==null&&(h=b.retryLane);break;case 19:m=o.stateNode;break;case 22:m=o.stateNode._retryCache;break;default:throw Error(n(314))}m!==null&&m.delete(l),_A(o,h)}function VO(o,l){return Ft(o,l)}var Z0=null,Mh=null,vb=!1,Q0=!1,Ab=!1,Fl=0;function Uo(o){o!==Mh&&o.next===null&&(Mh===null?Z0=Mh=o:Mh=Mh.next=o),Q0=!0,vb||(vb=!0,kO())}function gf(o,l){if(!Ab&&Q0){Ab=!0;do for(var h=!1,m=Z0;m!==null;){if(o!==0){var b=m.pendingLanes;if(b===0)var w=0;else{var E=m.suspendedLanes,I=m.pingedLanes;w=(1<<31-Ge(42|o)+1)-1,w&=b&~(E&~I),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(h=!0,NA(m,w))}else w=ze,w=ke(m,m===An?w:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(w&3)===0||$e(m,w)||(h=!0,NA(m,w));m=m.next}while(h);Ab=!1}}function GO(){MA()}function MA(){Q0=vb=!1;var o=0;Fl!==0&&QO()&&(o=Fl);for(var l=jt(),h=null,m=Z0;m!==null;){var b=m.next,w=vA(m,l);w===0?(m.next=null,h===null?Z0=b:h.next=b,b===null&&(Mh=h)):(h=m,(o!==0||(w&3)!==0)&&(Q0=!0)),m=b}Bs!==0&&Bs!==5||gf(o),Fl!==0&&(Fl=0)}function vA(o,l){for(var h=o.suspendedLanes,m=o.pingedLanes,b=o.expirationTimes,w=o.pendingLanes&-62914561;0<w;){var E=31-Ge(w),I=1<<E,it=b[E];it===-1?((I&h)===0||(I&m)!==0)&&(b[E]=js(I,l)):it<=l&&(o.expiredLanes|=I),w&=~I}if(l=An,h=ze,h=ke(o,o===l?h:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),m=o.callbackNode,h===0||o===l&&(mn===2||mn===9)||o.cancelPendingCommit!==null)return m!==null&&m!==null&&Gt(m),o.callbackNode=null,o.callbackPriority=0;if((h&3)===0||$e(o,h)){if(l=h&-h,l===o.callbackPriority)return l;switch(m!==null&&Gt(m),ba(h)){case 2:case 8:h=Re;break;case 32:h=je;break;case 268435456:h=os;break;default:h=je}return m=AA.bind(null,o),h=Ft(h,m),o.callbackPriority=l,o.callbackNode=h,l}return m!==null&&m!==null&&Gt(m),o.callbackPriority=2,o.callbackNode=null,2}function AA(o,l){if(Bs!==0&&Bs!==5)return o.callbackNode=null,o.callbackPriority=0,null;var h=o.callbackNode;if(K0()&&o.callbackNode!==h)return null;var m=ze;return m=ke(o,o===An?m:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),m===0?null:(aA(o,m,l),vA(o,jt()),o.callbackNode!=null&&o.callbackNode===h?AA.bind(null,o):null)}function NA(o,l){if(K0())return null;aA(o,l,!0)}function kO(){tF(function(){(sn&6)!==0?Ft(ee,GO):MA()})}function Nb(){if(Fl===0){var o=ch;o===0&&(o=Kn,Kn<<=1,(Kn&261888)===0&&(Kn=256)),Fl=o}return Fl}function RA(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:o0(""+o)}function EA(o,l){var h=l.ownerDocument.createElement("input");return h.name=l.name,h.value=l.value,o.id&&h.setAttribute("form",o.id),l.parentNode.insertBefore(h,l),o=new FormData(o),h.parentNode.removeChild(h),o}function HO(o,l,h,m,b){if(l==="submit"&&h&&h.stateNode===b){var w=RA((b[Ts]||null).action),E=m.submitter;E&&(l=(l=E[Ts]||null)?RA(l.formAction):E.getAttribute("formAction"),l!==null&&(w=l,E=null));var I=new u0("action","action",null,m,b);o.push({event:I,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(Fl!==0){var it=E?EA(b,E):new FormData(b);X1(h,{pending:!0,data:it,method:b.method,action:w},null,it)}}else typeof w=="function"&&(I.preventDefault(),it=E?EA(b,E):new FormData(b),X1(h,{pending:!0,data:it,method:b.method,action:w},w,it))},currentTarget:b}]})}}for(var Rb=0;Rb<u1.length;Rb++){var Eb=u1[Rb],WO=Eb.toLowerCase(),qO=Eb[0].toUpperCase()+Eb.slice(1);ho(WO,"on"+qO)}ho(oM,"onAnimationEnd"),ho(aM,"onAnimationIteration"),ho(lM,"onAnimationStart"),ho("dblclick","onDoubleClick"),ho("focusin","onFocus"),ho("focusout","onBlur"),ho(aO,"onTransitionRun"),ho(lO,"onTransitionStart"),ho(cO,"onTransitionCancel"),ho(cM,"onTransitionEnd"),Vs("onMouseEnter",["mouseout","mouseover"]),Vs("onMouseLeave",["mouseout","mouseover"]),Vs("onPointerEnter",["pointerout","pointerover"]),Vs("onPointerLeave",["pointerout","pointerover"]),ar("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ar("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ar("onBeforeInput",["compositionend","keypress","textInput","paste"]),ar("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ar("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ar("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$O=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(yf));function CA(o,l){l=(l&4)!==0;for(var h=0;h<o.length;h++){var m=o[h],b=m.event;m=m.listeners;t:{var w=void 0;if(l)for(var E=m.length-1;0<=E;E--){var I=m[E],it=I.instance,Nt=I.currentTarget;if(I=I.listener,it!==w&&b.isPropagationStopped())break t;w=I,b.currentTarget=Nt;try{w(b)}catch(Ot){f0(Ot)}b.currentTarget=null,w=it}else for(E=0;E<m.length;E++){if(I=m[E],it=I.instance,Nt=I.currentTarget,I=I.listener,it!==w&&b.isPropagationStopped())break t;w=I,b.currentTarget=Nt;try{w(b)}catch(Ot){f0(Ot)}b.currentTarget=null,w=it}}}}function Ue(o,l){var h=l[Er];h===void 0&&(h=l[Er]=new Set);var m=o+"__bubble";h.has(m)||(DA(l,o,2,!1),h.add(m))}function Cb(o,l,h){var m=0;l&&(m|=4),DA(h,o,m,l)}var J0="_reactListening"+Math.random().toString(36).slice(2);function Db(o){if(!o[J0]){o[J0]=!0,zi.forEach(function(h){h!=="selectionchange"&&($O.has(h)||Cb(h,!1,o),Cb(h,!0,o))});var l=o.nodeType===9?o:o.ownerDocument;l===null||l[J0]||(l[J0]=!0,Cb("selectionchange",!1,l))}}function DA(o,l,h,m){switch(oN(l)){case 2:var b=SF;break;case 8:b=wF;break;default:b=$b}h=b.bind(null,l,h,o),b=void 0,!Zx||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(b=!0),m?b!==void 0?o.addEventListener(l,h,{capture:!0,passive:b}):o.addEventListener(l,h,!0):b!==void 0?o.addEventListener(l,h,{passive:b}):o.addEventListener(l,h,!1)}function Bb(o,l,h,m,b){var w=m;if((l&1)===0&&(l&2)===0&&m!==null)t:for(;;){if(m===null)return;var E=m.tag;if(E===3||E===4){var I=m.stateNode.containerInfo;if(I===b)break;if(E===4)for(E=m.return;E!==null;){var it=E.tag;if((it===3||it===4)&&E.stateNode.containerInfo===b)return;E=E.return}for(;I!==null;){if(E=Cr(I),E===null)return;if(it=E.tag,it===5||it===6||it===26||it===27){m=w=E;continue t}I=I.parentNode}}m=m.return}U_(function(){var Nt=w,Ot=Yx(h),It=[];t:{var Et=uM.get(o);if(Et!==void 0){var Ct=u0,se=o;switch(o){case"keypress":if(l0(h)===0)break t;case"keydown":case"keyup":Ct=IL;break;case"focusin":se="focus",Ct=e1;break;case"focusout":se="blur",Ct=e1;break;case"beforeblur":case"afterblur":Ct=e1;break;case"click":if(h.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ct=I_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ct=NL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ct=kL;break;case oM:case aM:case lM:Ct=CL;break;case cM:Ct=WL;break;case"scroll":case"scrollend":Ct=vL;break;case"wheel":Ct=$L;break;case"copy":case"cut":case"paste":Ct=BL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ct=G_;break;case"toggle":case"beforetoggle":Ct=jL}var pe=(l&4)!==0,Tn=!pe&&(o==="scroll"||o==="scrollend"),wt=pe?Et!==null?Et+"Capture":null:Et;pe=[];for(var gt=Nt,At;gt!==null;){var Pt=gt;if(At=Pt.stateNode,Pt=Pt.tag,Pt!==5&&Pt!==26&&Pt!==27||At===null||wt===null||(Pt=zd(gt,wt),Pt!=null&&pe.push(xf(gt,Pt,At))),Tn)break;gt=gt.return}0<pe.length&&(Et=new Ct(Et,se,null,h,Ot),It.push({event:Et,listeners:pe}))}}if((l&7)===0){t:{if(Et=o==="mouseover"||o==="pointerover",Ct=o==="mouseout"||o==="pointerout",Et&&h!==jx&&(se=h.relatedTarget||h.fromElement)&&(Cr(se)||se[Mi]))break t;if((Ct||Et)&&(Et=Ot.window===Ot?Ot:(Et=Ot.ownerDocument)?Et.defaultView||Et.parentWindow:window,Ct?(se=h.relatedTarget||h.toElement,Ct=Nt,se=se?Cr(se):null,se!==null&&(Tn=i(se),pe=se.tag,se!==Tn||pe!==5&&pe!==27&&pe!==6)&&(se=null)):(Ct=null,se=Nt),Ct!==se)){if(pe=I_,Pt="onMouseLeave",wt="onMouseEnter",gt="mouse",(o==="pointerout"||o==="pointerover")&&(pe=G_,Pt="onPointerLeave",wt="onPointerEnter",gt="pointer"),Tn=Ct==null?Et:uo(Ct),At=se==null?Et:uo(se),Et=new pe(Pt,gt+"leave",Ct,h,Ot),Et.target=Tn,Et.relatedTarget=At,Pt=null,Cr(Ot)===Nt&&(pe=new pe(wt,gt+"enter",se,h,Ot),pe.target=At,pe.relatedTarget=Tn,Pt=pe),Tn=Pt,Ct&&se)e:{for(pe=XO,wt=Ct,gt=se,At=0,Pt=wt;Pt;Pt=pe(Pt))At++;Pt=0;for(var ue=gt;ue;ue=pe(ue))Pt++;for(;0<At-Pt;)wt=pe(wt),At--;for(;0<Pt-At;)gt=pe(gt),Pt--;for(;At--;){if(wt===gt||gt!==null&&wt===gt.alternate){pe=wt;break e}wt=pe(wt),gt=pe(gt)}pe=null}else pe=null;Ct!==null&&BA(It,Et,Ct,pe,!1),se!==null&&Tn!==null&&BA(It,Tn,se,pe,!0)}}t:{if(Et=Nt?uo(Nt):window,Ct=Et.nodeName&&Et.nodeName.toLowerCase(),Ct==="select"||Ct==="input"&&Et.type==="file")var tn=Y_;else if(X_(Et))if(K_)tn=iO;else{tn=nO;var oe=eO}else Ct=Et.nodeName,!Ct||Ct.toLowerCase()!=="input"||Et.type!=="checkbox"&&Et.type!=="radio"?Nt&&Xx(Nt.elementType)&&(tn=Y_):tn=sO;if(tn&&(tn=tn(o,Nt))){j_(It,tn,h,Ot);break t}oe&&oe(o,Et,Nt),o==="focusout"&&Nt&&Et.type==="number"&&Nt.memoizedProps.value!=null&&$x(Et,"number",Et.value)}switch(oe=Nt?uo(Nt):window,o){case"focusin":(X_(oe)||oe.contentEditable==="true")&&(eh=oe,a1=Nt,$d=null);break;case"focusout":$d=a1=eh=null;break;case"mousedown":l1=!0;break;case"contextmenu":case"mouseup":case"dragend":l1=!1,iM(It,h,Ot);break;case"selectionchange":if(oO)break;case"keydown":case"keyup":iM(It,h,Ot)}var Ce;if(s1)t:{switch(o){case"compositionstart":var Ie="onCompositionStart";break t;case"compositionend":Ie="onCompositionEnd";break t;case"compositionupdate":Ie="onCompositionUpdate";break t}Ie=void 0}else th?q_(o,h)&&(Ie="onCompositionEnd"):o==="keydown"&&h.keyCode===229&&(Ie="onCompositionStart");Ie&&(k_&&h.locale!=="ko"&&(th||Ie!=="onCompositionStart"?Ie==="onCompositionEnd"&&th&&(Ce=P_()):(bl=Ot,Qx="value"in bl?bl.value:bl.textContent,th=!0)),oe=tm(Nt,Ie),0<oe.length&&(Ie=new V_(Ie,o,null,h,Ot),It.push({event:Ie,listeners:oe}),Ce?Ie.data=Ce:(Ce=$_(h),Ce!==null&&(Ie.data=Ce)))),(Ce=KL?ZL(o,h):QL(o,h))&&(Ie=tm(Nt,"onBeforeInput"),0<Ie.length&&(oe=new V_("onBeforeInput","beforeinput",null,h,Ot),It.push({event:oe,listeners:Ie}),oe.data=Ce)),HO(It,o,Nt,h,Ot)}CA(It,l)})}function xf(o,l,h){return{instance:o,listener:l,currentTarget:h}}function tm(o,l){for(var h=l+"Capture",m=[];o!==null;){var b=o,w=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||w===null||(b=zd(o,h),b!=null&&m.unshift(xf(o,b,w)),b=zd(o,l),b!=null&&m.push(xf(o,b,w))),o.tag===3)return m;o=o.return}return[]}function XO(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function BA(o,l,h,m,b){for(var w=l._reactName,E=[];h!==null&&h!==m;){var I=h,it=I.alternate,Nt=I.stateNode;if(I=I.tag,it!==null&&it===m)break;I!==5&&I!==26&&I!==27||Nt===null||(it=Nt,b?(Nt=zd(h,w),Nt!=null&&E.unshift(xf(h,Nt,it))):b||(Nt=zd(h,w),Nt!=null&&E.push(xf(h,Nt,it)))),h=h.return}E.length!==0&&o.push({event:l,listeners:E})}var jO=/\r\n?/g,YO=/\u0000|\uFFFD/g;function LA(o){return(typeof o=="string"?o:""+o).replace(jO,`
`).replace(YO,"")}function OA(o,l){return l=LA(l),LA(o)===l}function wn(o,l,h,m,b,w){switch(h){case"children":typeof m=="string"?l==="body"||l==="textarea"&&m===""||Zu(o,m):(typeof m=="number"||typeof m=="bigint")&&l!=="body"&&Zu(o,""+m);break;case"className":i0(o,"class",m);break;case"tabIndex":i0(o,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":i0(o,h,m);break;case"style":O_(o,m,w);break;case"data":if(l!=="object"){i0(o,"data",m);break}case"src":case"href":if(m===""&&(l!=="a"||h!=="href")){o.removeAttribute(h);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){o.removeAttribute(h);break}m=o0(""+m),o.setAttribute(h,m);break;case"action":case"formAction":if(typeof m=="function"){o.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(h==="formAction"?(l!=="input"&&wn(o,l,"name",b.name,b,null),wn(o,l,"formEncType",b.formEncType,b,null),wn(o,l,"formMethod",b.formMethod,b,null),wn(o,l,"formTarget",b.formTarget,b,null)):(wn(o,l,"encType",b.encType,b,null),wn(o,l,"method",b.method,b,null),wn(o,l,"target",b.target,b,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){o.removeAttribute(h);break}m=o0(""+m),o.setAttribute(h,m);break;case"onClick":m!=null&&(o.onclick=Ta);break;case"onScroll":m!=null&&Ue("scroll",o);break;case"onScrollEnd":m!=null&&Ue("scrollend",o);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(h=m.__html,h!=null){if(b.children!=null)throw Error(n(60));o.innerHTML=h}}break;case"multiple":o.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":o.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){o.removeAttribute("xlink:href");break}h=o0(""+m),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?o.setAttribute(h,""+m):o.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?o.setAttribute(h,""):o.removeAttribute(h);break;case"capture":case"download":m===!0?o.setAttribute(h,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?o.setAttribute(h,m):o.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?o.setAttribute(h,m):o.removeAttribute(h);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?o.removeAttribute(h):o.setAttribute(h,m);break;case"popover":Ue("beforetoggle",o),Ue("toggle",o),s0(o,"popover",m);break;case"xlinkActuate":wa(o,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":wa(o,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":wa(o,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":wa(o,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":wa(o,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":wa(o,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":wa(o,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":wa(o,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":wa(o,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":s0(o,"is",m);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=_L.get(h)||h,s0(o,h,m))}}function Lb(o,l,h,m,b,w){switch(h){case"style":O_(o,m,w);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(h=m.__html,h!=null){if(b.children!=null)throw Error(n(60));o.innerHTML=h}}break;case"children":typeof m=="string"?Zu(o,m):(typeof m=="number"||typeof m=="bigint")&&Zu(o,""+m);break;case"onScroll":m!=null&&Ue("scroll",o);break;case"onScrollEnd":m!=null&&Ue("scrollend",o);break;case"onClick":m!=null&&(o.onclick=Ta);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ks.hasOwnProperty(h))t:{if(h[0]==="o"&&h[1]==="n"&&(b=h.endsWith("Capture"),l=h.slice(2,b?h.length-7:void 0),w=o[Ts]||null,w=w!=null?w[h]:null,typeof w=="function"&&o.removeEventListener(l,w,b),typeof m=="function")){typeof w!="function"&&w!==null&&(h in o?o[h]=null:o.hasAttribute(h)&&o.removeAttribute(h)),o.addEventListener(l,m,b);break t}h in o?o[h]=m:m===!0?o.setAttribute(h,""):s0(o,h,m)}}}function ti(o,l,h){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ue("error",o),Ue("load",o);var m=!1,b=!1,w;for(w in h)if(h.hasOwnProperty(w)){var E=h[w];if(E!=null)switch(w){case"src":m=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:wn(o,l,w,E,h,null)}}b&&wn(o,l,"srcSet",h.srcSet,h,null),m&&wn(o,l,"src",h.src,h,null);return;case"input":Ue("invalid",o);var I=w=E=b=null,it=null,Nt=null;for(m in h)if(h.hasOwnProperty(m)){var Ot=h[m];if(Ot!=null)switch(m){case"name":b=Ot;break;case"type":E=Ot;break;case"checked":it=Ot;break;case"defaultChecked":Nt=Ot;break;case"value":w=Ot;break;case"defaultValue":I=Ot;break;case"children":case"dangerouslySetInnerHTML":if(Ot!=null)throw Error(n(137,l));break;default:wn(o,l,m,Ot,h,null)}}C_(o,w,I,it,Nt,E,b,!1);return;case"select":Ue("invalid",o),m=E=w=null;for(b in h)if(h.hasOwnProperty(b)&&(I=h[b],I!=null))switch(b){case"value":w=I;break;case"defaultValue":E=I;break;case"multiple":m=I;default:wn(o,l,b,I,h,null)}l=w,h=E,o.multiple=!!m,l!=null?Ku(o,!!m,l,!1):h!=null&&Ku(o,!!m,h,!0);return;case"textarea":Ue("invalid",o),w=b=m=null;for(E in h)if(h.hasOwnProperty(E)&&(I=h[E],I!=null))switch(E){case"value":m=I;break;case"defaultValue":b=I;break;case"children":w=I;break;case"dangerouslySetInnerHTML":if(I!=null)throw Error(n(91));break;default:wn(o,l,E,I,h,null)}B_(o,m,b,w);return;case"option":for(it in h)h.hasOwnProperty(it)&&(m=h[it],m!=null)&&(it==="selected"?o.selected=m&&typeof m!="function"&&typeof m!="symbol":wn(o,l,it,m,h,null));return;case"dialog":Ue("beforetoggle",o),Ue("toggle",o),Ue("cancel",o),Ue("close",o);break;case"iframe":case"object":Ue("load",o);break;case"video":case"audio":for(m=0;m<yf.length;m++)Ue(yf[m],o);break;case"image":Ue("error",o),Ue("load",o);break;case"details":Ue("toggle",o);break;case"embed":case"source":case"link":Ue("error",o),Ue("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Nt in h)if(h.hasOwnProperty(Nt)&&(m=h[Nt],m!=null))switch(Nt){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:wn(o,l,Nt,m,h,null)}return;default:if(Xx(l)){for(Ot in h)h.hasOwnProperty(Ot)&&(m=h[Ot],m!==void 0&&Lb(o,l,Ot,m,h,void 0));return}}for(I in h)h.hasOwnProperty(I)&&(m=h[I],m!=null&&wn(o,l,I,m,h,null))}function KO(o,l,h,m){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,w=null,E=null,I=null,it=null,Nt=null,Ot=null;for(Ct in h){var It=h[Ct];if(h.hasOwnProperty(Ct)&&It!=null)switch(Ct){case"checked":break;case"value":break;case"defaultValue":it=It;default:m.hasOwnProperty(Ct)||wn(o,l,Ct,null,m,It)}}for(var Et in m){var Ct=m[Et];if(It=h[Et],m.hasOwnProperty(Et)&&(Ct!=null||It!=null))switch(Et){case"type":w=Ct;break;case"name":b=Ct;break;case"checked":Nt=Ct;break;case"defaultChecked":Ot=Ct;break;case"value":E=Ct;break;case"defaultValue":I=Ct;break;case"children":case"dangerouslySetInnerHTML":if(Ct!=null)throw Error(n(137,l));break;default:Ct!==It&&wn(o,l,Et,Ct,m,It)}}qx(o,E,I,it,Nt,Ot,w,b);return;case"select":Ct=E=I=Et=null;for(w in h)if(it=h[w],h.hasOwnProperty(w)&&it!=null)switch(w){case"value":break;case"multiple":Ct=it;default:m.hasOwnProperty(w)||wn(o,l,w,null,m,it)}for(b in m)if(w=m[b],it=h[b],m.hasOwnProperty(b)&&(w!=null||it!=null))switch(b){case"value":Et=w;break;case"defaultValue":I=w;break;case"multiple":E=w;default:w!==it&&wn(o,l,b,w,m,it)}l=I,h=E,m=Ct,Et!=null?Ku(o,!!h,Et,!1):!!m!=!!h&&(l!=null?Ku(o,!!h,l,!0):Ku(o,!!h,h?[]:"",!1));return;case"textarea":Ct=Et=null;for(I in h)if(b=h[I],h.hasOwnProperty(I)&&b!=null&&!m.hasOwnProperty(I))switch(I){case"value":break;case"children":break;default:wn(o,l,I,null,m,b)}for(E in m)if(b=m[E],w=h[E],m.hasOwnProperty(E)&&(b!=null||w!=null))switch(E){case"value":Et=b;break;case"defaultValue":Ct=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(n(91));break;default:b!==w&&wn(o,l,E,b,m,w)}D_(o,Et,Ct);return;case"option":for(var se in h)Et=h[se],h.hasOwnProperty(se)&&Et!=null&&!m.hasOwnProperty(se)&&(se==="selected"?o.selected=!1:wn(o,l,se,null,m,Et));for(it in m)Et=m[it],Ct=h[it],m.hasOwnProperty(it)&&Et!==Ct&&(Et!=null||Ct!=null)&&(it==="selected"?o.selected=Et&&typeof Et!="function"&&typeof Et!="symbol":wn(o,l,it,Et,m,Ct));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pe in h)Et=h[pe],h.hasOwnProperty(pe)&&Et!=null&&!m.hasOwnProperty(pe)&&wn(o,l,pe,null,m,Et);for(Nt in m)if(Et=m[Nt],Ct=h[Nt],m.hasOwnProperty(Nt)&&Et!==Ct&&(Et!=null||Ct!=null))switch(Nt){case"children":case"dangerouslySetInnerHTML":if(Et!=null)throw Error(n(137,l));break;default:wn(o,l,Nt,Et,m,Ct)}return;default:if(Xx(l)){for(var Tn in h)Et=h[Tn],h.hasOwnProperty(Tn)&&Et!==void 0&&!m.hasOwnProperty(Tn)&&Lb(o,l,Tn,void 0,m,Et);for(Ot in m)Et=m[Ot],Ct=h[Ot],!m.hasOwnProperty(Ot)||Et===Ct||Et===void 0&&Ct===void 0||Lb(o,l,Ot,Et,m,Ct);return}}for(var wt in h)Et=h[wt],h.hasOwnProperty(wt)&&Et!=null&&!m.hasOwnProperty(wt)&&wn(o,l,wt,null,m,Et);for(It in m)Et=m[It],Ct=h[It],!m.hasOwnProperty(It)||Et===Ct||Et==null&&Ct==null||wn(o,l,It,Et,m,Ct)}function FA(o){switch(o){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ZO(){if(typeof performance.getEntriesByType=="function"){for(var o=0,l=0,h=performance.getEntriesByType("resource"),m=0;m<h.length;m++){var b=h[m],w=b.transferSize,E=b.initiatorType,I=b.duration;if(w&&I&&FA(E)){for(E=0,I=b.responseEnd,m+=1;m<h.length;m++){var it=h[m],Nt=it.startTime;if(Nt>I)break;var Ot=it.transferSize,It=it.initiatorType;Ot&&FA(It)&&(it=it.responseEnd,E+=Ot*(it<I?1:(I-Nt)/(it-Nt)))}if(--m,l+=8*(w+E)/(b.duration/1e3),o++,10<o)break}}if(0<o)return l/o/1e6}return navigator.connection&&(o=navigator.connection.downlink,typeof o=="number")?o:5}var Ob=null,Fb=null;function em(o){return o.nodeType===9?o:o.ownerDocument}function UA(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function PA(o,l){if(o===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&l==="foreignObject"?0:o}function Ub(o,l){return o==="textarea"||o==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Pb=null;function QO(){var o=window.event;return o&&o.type==="popstate"?o===Pb?!1:(Pb=o,!0):(Pb=null,!1)}var zA=typeof setTimeout=="function"?setTimeout:void 0,JO=typeof clearTimeout=="function"?clearTimeout:void 0,IA=typeof Promise=="function"?Promise:void 0,tF=typeof queueMicrotask=="function"?queueMicrotask:typeof IA<"u"?function(o){return IA.resolve(null).then(o).catch(eF)}:zA;function eF(o){setTimeout(function(){throw o})}function Ul(o){return o==="head"}function VA(o,l){var h=l,m=0;do{var b=h.nextSibling;if(o.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"||h==="/&"){if(m===0){o.removeChild(b),Rh(l);return}m--}else if(h==="$"||h==="$?"||h==="$~"||h==="$!"||h==="&")m++;else if(h==="html")bf(o.ownerDocument.documentElement);else if(h==="head"){h=o.ownerDocument.head,bf(h);for(var w=h.firstChild;w;){var E=w.nextSibling,I=w.nodeName;w[co]||I==="SCRIPT"||I==="STYLE"||I==="LINK"&&w.rel.toLowerCase()==="stylesheet"||h.removeChild(w),w=E}}else h==="body"&&bf(o.ownerDocument.body);h=b}while(h);Rh(l)}function GA(o,l){var h=o;o=0;do{var m=h.nextSibling;if(h.nodeType===1?l?(h._stashedDisplay=h.style.display,h.style.display="none"):(h.style.display=h._stashedDisplay||"",h.getAttribute("style")===""&&h.removeAttribute("style")):h.nodeType===3&&(l?(h._stashedText=h.nodeValue,h.nodeValue=""):h.nodeValue=h._stashedText||""),m&&m.nodeType===8)if(h=m.data,h==="/$"){if(o===0)break;o--}else h!=="$"&&h!=="$?"&&h!=="$~"&&h!=="$!"||o++;h=m}while(h)}function zb(o){var l=o.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var h=l;switch(l=l.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":zb(h),Sa(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}o.removeChild(h)}}function nF(o,l,h,m){for(;o.nodeType===1;){var b=h;if(o.nodeName.toLowerCase()!==l.toLowerCase()){if(!m&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(m){if(!o[co])switch(l){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(w=o.getAttribute("rel"),w==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(w!==b.rel||o.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||o.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||o.getAttribute("title")!==(b.title==null?null:b.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(w=o.getAttribute("src"),(w!==(b.src==null?null:b.src)||o.getAttribute("type")!==(b.type==null?null:b.type)||o.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&w&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(l==="input"&&o.type==="hidden"){var w=b.name==null?null:""+b.name;if(b.type==="hidden"&&o.getAttribute("name")===w)return o}else return o;if(o=Vr(o.nextSibling),o===null)break}return null}function sF(o,l,h){if(l==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!h||(o=Vr(o.nextSibling),o===null))return null;return o}function kA(o,l){for(;o.nodeType!==8;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!l||(o=Vr(o.nextSibling),o===null))return null;return o}function Ib(o){return o.data==="$?"||o.data==="$~"}function Vb(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState!=="loading"}function iF(o,l){var h=o.ownerDocument;if(o.data==="$~")o._reactRetry=l;else if(o.data!=="$?"||h.readyState!=="loading")l();else{var m=function(){l(),h.removeEventListener("DOMContentLoaded",m)};h.addEventListener("DOMContentLoaded",m),o._reactRetry=m}}function Vr(o){for(;o!=null;o=o.nextSibling){var l=o.nodeType;if(l===1||l===3)break;if(l===8){if(l=o.data,l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"||l==="F!"||l==="F")break;if(l==="/$"||l==="/&")return null}}return o}var Gb=null;function HA(o){o=o.nextSibling;for(var l=0;o;){if(o.nodeType===8){var h=o.data;if(h==="/$"||h==="/&"){if(l===0)return Vr(o.nextSibling);l--}else h!=="$"&&h!=="$!"&&h!=="$?"&&h!=="$~"&&h!=="&"||l++}o=o.nextSibling}return null}function WA(o){o=o.previousSibling;for(var l=0;o;){if(o.nodeType===8){var h=o.data;if(h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"){if(l===0)return o;l--}else h!=="/$"&&h!=="/&"||l++}o=o.previousSibling}return null}function qA(o,l,h){switch(l=em(h),o){case"html":if(o=l.documentElement,!o)throw Error(n(452));return o;case"head":if(o=l.head,!o)throw Error(n(453));return o;case"body":if(o=l.body,!o)throw Error(n(454));return o;default:throw Error(n(451))}}function bf(o){for(var l=o.attributes;l.length;)o.removeAttributeNode(l[0]);Sa(o)}var Gr=new Map,$A=new Set;function nm(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var za=Y.d;Y.d={f:rF,r:oF,D:aF,C:lF,L:cF,m:uF,X:dF,S:hF,M:fF};function rF(){var o=za.f(),l=X0();return o||l}function oF(o){var l=Dr(o);l!==null&&l.tag===5&&l.type==="form"?cv(l):za.r(o)}var vh=typeof document>"u"?null:document;function XA(o,l,h){var m=vh;if(m&&typeof l=="string"&&l){var b=Lr(l);b='link[rel="'+o+'"][href="'+b+'"]',typeof h=="string"&&(b+='[crossorigin="'+h+'"]'),$A.has(b)||($A.add(b),o={rel:o,crossOrigin:h,href:l},m.querySelector(b)===null&&(l=m.createElement("link"),ti(l,"link",o),vn(l),m.head.appendChild(l)))}}function aF(o){za.D(o),XA("dns-prefetch",o,null)}function lF(o,l){za.C(o,l),XA("preconnect",o,l)}function cF(o,l,h){za.L(o,l,h);var m=vh;if(m&&o&&l){var b='link[rel="preload"][as="'+Lr(l)+'"]';l==="image"&&h&&h.imageSrcSet?(b+='[imagesrcset="'+Lr(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(b+='[imagesizes="'+Lr(h.imageSizes)+'"]')):b+='[href="'+Lr(o)+'"]';var w=b;switch(l){case"style":w=Ah(o);break;case"script":w=Nh(o)}Gr.has(w)||(o=p({rel:"preload",href:l==="image"&&h&&h.imageSrcSet?void 0:o,as:l},h),Gr.set(w,o),m.querySelector(b)!==null||l==="style"&&m.querySelector(Sf(w))||l==="script"&&m.querySelector(wf(w))||(l=m.createElement("link"),ti(l,"link",o),vn(l),m.head.appendChild(l)))}}function uF(o,l){za.m(o,l);var h=vh;if(h&&o){var m=l&&typeof l.as=="string"?l.as:"script",b='link[rel="modulepreload"][as="'+Lr(m)+'"][href="'+Lr(o)+'"]',w=b;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=Nh(o)}if(!Gr.has(w)&&(o=p({rel:"modulepreload",href:o},l),Gr.set(w,o),h.querySelector(b)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(wf(w)))return}m=h.createElement("link"),ti(m,"link",o),vn(m),h.head.appendChild(m)}}}function hF(o,l,h){za.S(o,l,h);var m=vh;if(m&&o){var b=vi(m).hoistableStyles,w=Ah(o);l=l||"default";var E=b.get(w);if(!E){var I={loading:0,preload:null};if(E=m.querySelector(Sf(w)))I.loading=5;else{o=p({rel:"stylesheet",href:o,"data-precedence":l},h),(h=Gr.get(w))&&kb(o,h);var it=E=m.createElement("link");vn(it),ti(it,"link",o),it._p=new Promise(function(Nt,Ot){it.onload=Nt,it.onerror=Ot}),it.addEventListener("load",function(){I.loading|=1}),it.addEventListener("error",function(){I.loading|=2}),I.loading|=4,sm(E,l,m)}E={type:"stylesheet",instance:E,count:1,state:I},b.set(w,E)}}}function dF(o,l){za.X(o,l);var h=vh;if(h&&o){var m=vi(h).hoistableScripts,b=Nh(o),w=m.get(b);w||(w=h.querySelector(wf(b)),w||(o=p({src:o,async:!0},l),(l=Gr.get(b))&&Hb(o,l),w=h.createElement("script"),vn(w),ti(w,"link",o),h.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},m.set(b,w))}}function fF(o,l){za.M(o,l);var h=vh;if(h&&o){var m=vi(h).hoistableScripts,b=Nh(o),w=m.get(b);w||(w=h.querySelector(wf(b)),w||(o=p({src:o,async:!0,type:"module"},l),(l=Gr.get(b))&&Hb(o,l),w=h.createElement("script"),vn(w),ti(w,"link",o),h.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},m.set(b,w))}}function jA(o,l,h,m){var b=(b=K.current)?nm(b):null;if(!b)throw Error(n(446));switch(o){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(l=Ah(h.href),h=vi(b).hoistableStyles,m=h.get(l),m||(m={type:"style",instance:null,count:0,state:null},h.set(l,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){o=Ah(h.href);var w=vi(b).hoistableStyles,E=w.get(o);if(E||(b=b.ownerDocument||b,E={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(o,E),(w=b.querySelector(Sf(o)))&&!w._p&&(E.instance=w,E.state.loading=5),Gr.has(o)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},Gr.set(o,h),w||pF(b,o,h,E.state))),l&&m===null)throw Error(n(528,""));return E}if(l&&m!==null)throw Error(n(529,""));return null;case"script":return l=h.async,h=h.src,typeof h=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=Nh(h),h=vi(b).hoistableScripts,m=h.get(l),m||(m={type:"script",instance:null,count:0,state:null},h.set(l,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,o))}}function Ah(o){return'href="'+Lr(o)+'"'}function Sf(o){return'link[rel="stylesheet"]['+o+"]"}function YA(o){return p({},o,{"data-precedence":o.precedence,precedence:null})}function pF(o,l,h,m){o.querySelector('link[rel="preload"][as="style"]['+l+"]")?m.loading=1:(l=o.createElement("link"),m.preload=l,l.addEventListener("load",function(){return m.loading|=1}),l.addEventListener("error",function(){return m.loading|=2}),ti(l,"link",h),vn(l),o.head.appendChild(l))}function Nh(o){return'[src="'+Lr(o)+'"]'}function wf(o){return"script[async]"+o}function KA(o,l,h){if(l.count++,l.instance===null)switch(l.type){case"style":var m=o.querySelector('style[data-href~="'+Lr(h.href)+'"]');if(m)return l.instance=m,vn(m),m;var b=p({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return m=(o.ownerDocument||o).createElement("style"),vn(m),ti(m,"style",b),sm(m,h.precedence,o),l.instance=m;case"stylesheet":b=Ah(h.href);var w=o.querySelector(Sf(b));if(w)return l.state.loading|=4,l.instance=w,vn(w),w;m=YA(h),(b=Gr.get(b))&&kb(m,b),w=(o.ownerDocument||o).createElement("link"),vn(w);var E=w;return E._p=new Promise(function(I,it){E.onload=I,E.onerror=it}),ti(w,"link",m),l.state.loading|=4,sm(w,h.precedence,o),l.instance=w;case"script":return w=Nh(h.src),(b=o.querySelector(wf(w)))?(l.instance=b,vn(b),b):(m=h,(b=Gr.get(w))&&(m=p({},h),Hb(m,b)),o=o.ownerDocument||o,b=o.createElement("script"),vn(b),ti(b,"link",m),o.head.appendChild(b),l.instance=b);case"void":return null;default:throw Error(n(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(m=l.instance,l.state.loading|=4,sm(m,h.precedence,o));return l.instance}function sm(o,l,h){for(var m=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=m.length?m[m.length-1]:null,w=b,E=0;E<m.length;E++){var I=m[E];if(I.dataset.precedence===l)w=I;else if(w!==b)break}w?w.parentNode.insertBefore(o,w.nextSibling):(l=h.nodeType===9?h.head:h,l.insertBefore(o,l.firstChild))}function kb(o,l){o.crossOrigin==null&&(o.crossOrigin=l.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=l.referrerPolicy),o.title==null&&(o.title=l.title)}function Hb(o,l){o.crossOrigin==null&&(o.crossOrigin=l.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=l.referrerPolicy),o.integrity==null&&(o.integrity=l.integrity)}var im=null;function ZA(o,l,h){if(im===null){var m=new Map,b=im=new Map;b.set(h,m)}else b=im,m=b.get(h),m||(m=new Map,b.set(h,m));if(m.has(o))return m;for(m.set(o,null),h=h.getElementsByTagName(o),b=0;b<h.length;b++){var w=h[b];if(!(w[co]||w[Zn]||o==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var E=w.getAttribute(l)||"";E=o+E;var I=m.get(E);I?I.push(w):m.set(E,[w])}}return m}function QA(o,l,h){o=o.ownerDocument||o,o.head.insertBefore(h,l==="title"?o.querySelector("head > title"):null)}function mF(o,l,h){if(h===1||l.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;return l.rel==="stylesheet"?(o=l.disabled,typeof l.precedence=="string"&&o==null):!0;case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function JA(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}function gF(o,l,h,m){if(h.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var b=Ah(m.href),w=l.querySelector(Sf(b));if(w){l=w._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(o.count++,o=rm.bind(o),l.then(o,o)),h.state.loading|=4,h.instance=w,vn(w);return}w=l.ownerDocument||l,m=YA(m),(b=Gr.get(b))&&kb(m,b),w=w.createElement("link"),vn(w);var E=w;E._p=new Promise(function(I,it){E.onload=I,E.onerror=it}),ti(w,"link",m),h.instance=w}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(h,l),(l=h.state.preload)&&(h.state.loading&3)===0&&(o.count++,h=rm.bind(o),l.addEventListener("load",h),l.addEventListener("error",h))}}var Wb=0;function yF(o,l){return o.stylesheets&&o.count===0&&am(o,o.stylesheets),0<o.count||0<o.imgCount?function(h){var m=setTimeout(function(){if(o.stylesheets&&am(o,o.stylesheets),o.unsuspend){var w=o.unsuspend;o.unsuspend=null,w()}},6e4+l);0<o.imgBytes&&Wb===0&&(Wb=62500*ZO());var b=setTimeout(function(){if(o.waitingForImages=!1,o.count===0&&(o.stylesheets&&am(o,o.stylesheets),o.unsuspend)){var w=o.unsuspend;o.unsuspend=null,w()}},(o.imgBytes>Wb?50:800)+l);return o.unsuspend=h,function(){o.unsuspend=null,clearTimeout(m),clearTimeout(b)}}:null}function rm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)am(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var om=null;function am(o,l){o.stylesheets=null,o.unsuspend!==null&&(o.count++,om=new Map,l.forEach(xF,o),om=null,rm.call(o))}function xF(o,l){if(!(l.state.loading&4)){var h=om.get(o);if(h)var m=h.get(null);else{h=new Map,om.set(o,h);for(var b=o.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<b.length;w++){var E=b[w];(E.nodeName==="LINK"||E.getAttribute("media")!=="not all")&&(h.set(E.dataset.precedence,E),m=E)}m&&h.set(null,m)}b=l.instance,E=b.getAttribute("data-precedence"),w=h.get(E)||m,w===m&&h.set(null,b),h.set(E,b),this.count++,m=rm.bind(this),b.addEventListener("load",m),b.addEventListener("error",m),w?w.parentNode.insertBefore(b,w.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(b,o.firstChild)),l.state.loading|=4}}var Tf={$$typeof:v,Provider:null,Consumer:null,_currentValue:tt,_currentValue2:tt,_threadCount:0};function bF(o,l,h,m,b,w,E,I,it){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Rr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Rr(0),this.hiddenUpdates=Rr(null),this.identifierPrefix=m,this.onUncaughtError=b,this.onCaughtError=w,this.onRecoverableError=E,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=it,this.incompleteTransitions=new Map}function tN(o,l,h,m,b,w,E,I,it,Nt,Ot,It){return o=new bF(o,l,h,E,it,Nt,Ot,It,I),l=1,w===!0&&(l|=24),w=cr(3,null,null,l),o.current=w,w.stateNode=o,l=_1(),l.refCount++,o.pooledCache=l,l.refCount++,w.memoizedState={element:m,isDehydrated:h,cache:l},N1(w),o}function eN(o){return o?(o=ih,o):ih}function nN(o,l,h,m,b,w){b=eN(b),m.context===null?m.context=b:m.pendingContext=b,m=vl(l),m.payload={element:h},w=w===void 0?null:w,w!==null&&(m.callback=w),h=Al(o,m,l),h!==null&&(Wi(h,o,l),Jd(h,o,l))}function sN(o,l){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var h=o.retryLane;o.retryLane=h!==0&&h<l?h:l}}function qb(o,l){sN(o,l),(o=o.alternate)&&sN(o,l)}function iN(o){if(o.tag===13||o.tag===31){var l=jc(o,67108864);l!==null&&Wi(l,o,67108864),qb(o,67108864)}}function rN(o){if(o.tag===13||o.tag===31){var l=pr();l=_i(l);var h=jc(o,l);h!==null&&Wi(h,o,l),qb(o,l)}}var lm=!0;function SF(o,l,h,m){var b=F.T;F.T=null;var w=Y.p;try{Y.p=2,$b(o,l,h,m)}finally{Y.p=w,F.T=b}}function wF(o,l,h,m){var b=F.T;F.T=null;var w=Y.p;try{Y.p=8,$b(o,l,h,m)}finally{Y.p=w,F.T=b}}function $b(o,l,h,m){if(lm){var b=Xb(m);if(b===null)Bb(o,l,m,cm,h),aN(o,m);else if(_F(b,o,l,h,m))m.stopPropagation();else if(aN(o,m),l&4&&-1<TF.indexOf(o)){for(;b!==null;){var w=Dr(b);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var E=Ee(w.pendingLanes);if(E!==0){var I=w;for(I.pendingLanes|=2,I.entangledLanes|=2;E;){var it=1<<31-Ge(E);I.entanglements[1]|=it,E&=~it}Uo(w),(sn&6)===0&&(q0=jt()+500,gf(0))}}break;case 31:case 13:I=jc(w,2),I!==null&&Wi(I,w,2),X0(),qb(w,2)}if(w=Xb(m),w===null&&Bb(o,l,m,cm,h),w===b)break;b=w}b!==null&&m.stopPropagation()}else Bb(o,l,m,null,h)}}function Xb(o){return o=Yx(o),jb(o)}var cm=null;function jb(o){if(cm=null,o=Cr(o),o!==null){var l=i(o);if(l===null)o=null;else{var h=l.tag;if(h===13){if(o=a(l),o!==null)return o;o=null}else if(h===31){if(o=c(l),o!==null)return o;o=null}else if(h===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;o=null}else l!==o&&(o=null)}}return cm=o,null}function oN(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ce()){case ee:return 2;case Re:return 8;case je:case pn:return 32;case os:return 268435456;default:return 32}default:return 32}}var Yb=!1,Pl=null,zl=null,Il=null,_f=new Map,Mf=new Map,Vl=[],TF="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function aN(o,l){switch(o){case"focusin":case"focusout":Pl=null;break;case"dragenter":case"dragleave":zl=null;break;case"mouseover":case"mouseout":Il=null;break;case"pointerover":case"pointerout":_f.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mf.delete(l.pointerId)}}function vf(o,l,h,m,b,w){return o===null||o.nativeEvent!==w?(o={blockedOn:l,domEventName:h,eventSystemFlags:m,nativeEvent:w,targetContainers:[b]},l!==null&&(l=Dr(l),l!==null&&iN(l)),o):(o.eventSystemFlags|=m,l=o.targetContainers,b!==null&&l.indexOf(b)===-1&&l.push(b),o)}function _F(o,l,h,m,b){switch(l){case"focusin":return Pl=vf(Pl,o,l,h,m,b),!0;case"dragenter":return zl=vf(zl,o,l,h,m,b),!0;case"mouseover":return Il=vf(Il,o,l,h,m,b),!0;case"pointerover":var w=b.pointerId;return _f.set(w,vf(_f.get(w)||null,o,l,h,m,b)),!0;case"gotpointercapture":return w=b.pointerId,Mf.set(w,vf(Mf.get(w)||null,o,l,h,m,b)),!0}return!1}function lN(o){var l=Cr(o.target);if(l!==null){var h=i(l);if(h!==null){if(l=h.tag,l===13){if(l=a(h),l!==null){o.blockedOn=l,gl(o.priority,function(){rN(h)});return}}else if(l===31){if(l=c(h),l!==null){o.blockedOn=l,gl(o.priority,function(){rN(h)});return}}else if(l===3&&h.stateNode.current.memoizedState.isDehydrated){o.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}o.blockedOn=null}function um(o){if(o.blockedOn!==null)return!1;for(var l=o.targetContainers;0<l.length;){var h=Xb(o.nativeEvent);if(h===null){h=o.nativeEvent;var m=new h.constructor(h.type,h);jx=m,h.target.dispatchEvent(m),jx=null}else return l=Dr(h),l!==null&&iN(l),o.blockedOn=h,!1;l.shift()}return!0}function cN(o,l,h){um(o)&&h.delete(l)}function MF(){Yb=!1,Pl!==null&&um(Pl)&&(Pl=null),zl!==null&&um(zl)&&(zl=null),Il!==null&&um(Il)&&(Il=null),_f.forEach(cN),Mf.forEach(cN)}function hm(o,l){o.blockedOn===l&&(o.blockedOn=null,Yb||(Yb=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,MF)))}var dm=null;function uN(o){dm!==o&&(dm=o,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){dm===o&&(dm=null);for(var l=0;l<o.length;l+=3){var h=o[l],m=o[l+1],b=o[l+2];if(typeof m!="function"){if(jb(m||h)===null)continue;break}var w=Dr(h);w!==null&&(o.splice(l,3),l-=3,X1(w,{pending:!0,data:b,method:h.method,action:m},m,b))}}))}function Rh(o){function l(it){return hm(it,o)}Pl!==null&&hm(Pl,o),zl!==null&&hm(zl,o),Il!==null&&hm(Il,o),_f.forEach(l),Mf.forEach(l);for(var h=0;h<Vl.length;h++){var m=Vl[h];m.blockedOn===o&&(m.blockedOn=null)}for(;0<Vl.length&&(h=Vl[0],h.blockedOn===null);)lN(h),h.blockedOn===null&&Vl.shift();if(h=(o.ownerDocument||o).$$reactFormReplay,h!=null)for(m=0;m<h.length;m+=3){var b=h[m],w=h[m+1],E=b[Ts]||null;if(typeof w=="function")E||uN(h);else if(E){var I=null;if(w&&w.hasAttribute("formAction")){if(b=w,E=w[Ts]||null)I=E.formAction;else if(jb(b)!==null)continue}else I=E.action;typeof I=="function"?h[m+1]=I:(h.splice(m,3),m-=3),uN(h)}}}function hN(){function o(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(E){return b=E})},focusReset:"manual",scroll:"manual"})}function l(){b!==null&&(b(),b=null),m||setTimeout(h,20)}function h(){if(!m&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,b=null;return navigation.addEventListener("navigate",o),navigation.addEventListener("navigatesuccess",l),navigation.addEventListener("navigateerror",l),setTimeout(h,100),function(){m=!0,navigation.removeEventListener("navigate",o),navigation.removeEventListener("navigatesuccess",l),navigation.removeEventListener("navigateerror",l),b!==null&&(b(),b=null)}}}function Kb(o){this._internalRoot=o}fm.prototype.render=Kb.prototype.render=function(o){var l=this._internalRoot;if(l===null)throw Error(n(409));var h=l.current,m=pr();nN(h,m,o,l,null,null)},fm.prototype.unmount=Kb.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var l=o.containerInfo;nN(o.current,2,null,o,null,null),X0(),l[Mi]=null}};function fm(o){this._internalRoot=o}fm.prototype.unstable_scheduleHydration=function(o){if(o){var l=lo();o={blockedOn:null,target:o,priority:l};for(var h=0;h<Vl.length&&l!==0&&l<Vl[h].priority;h++);Vl.splice(h,0,o),h===0&&lN(o)}};var dN=t.version;if(dN!=="19.2.4")throw Error(n(527,dN,"19.2.4"));Y.findDOMNode=function(o){var l=o._reactInternals;if(l===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=d(l),o=o!==null?f(o):null,o=o===null?null:o.stateNode,o};var vF={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var pm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!pm.isDisabled&&pm.supportsFiber)try{we=pm.inject(vF),Ye=pm}catch{}}return Nf.createRoot=function(o,l){if(!s(o))throw Error(n(299));var h=!1,m="",b=bv,w=Sv,E=wv;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(b=l.onUncaughtError),l.onCaughtError!==void 0&&(w=l.onCaughtError),l.onRecoverableError!==void 0&&(E=l.onRecoverableError)),l=tN(o,1,!1,null,null,h,m,null,b,w,E,hN),o[Mi]=l.current,Db(o),new Kb(l)},Nf.hydrateRoot=function(o,l,h){if(!s(o))throw Error(n(299));var m=!1,b="",w=bv,E=Sv,I=wv,it=null;return h!=null&&(h.unstable_strictMode===!0&&(m=!0),h.identifierPrefix!==void 0&&(b=h.identifierPrefix),h.onUncaughtError!==void 0&&(w=h.onUncaughtError),h.onCaughtError!==void 0&&(E=h.onCaughtError),h.onRecoverableError!==void 0&&(I=h.onRecoverableError),h.formState!==void 0&&(it=h.formState)),l=tN(o,1,!0,l,h??null,m,b,it,w,E,I,hN),l.context=eN(null),h=l.current,m=pr(),m=_i(m),b=vl(m),b.callback=null,Al(h,b,m),h=m,l.current.lanes=h,Ui(l,h),Uo(l),o[Mi]=l.current,Db(o),new fm(l)},Nf.version="19.2.4",Nf}var TN;function FF(){if(TN)return Qb.exports;TN=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Qb.exports=OF(),Qb.exports}var UF=FF(),ys=Tw();const Hp="183",PF=0,zF=1,IF=2,VF=0,D3=1,GF=2,up=3,na=0,Ss=1,ss=2,rl=0,mi=1,Tr=2,od=3,ad=4,ud=5,_w=6,Xr=100,B3=101,L3=102,kF=103,HF=104,lc=200,O3=201,F3=202,U3=203,Rp=204,Ep=205,P3=206,z3=207,I3=208,V3=209,G3=210,jg=0,Yg=1,Kg=2,bd=3,Zg=4,Qg=5,Jg=6,ty=7,Qy=0,WF=1,qF=2,Ru=0,$F=1,XF=2,jF=3,Mw=4,YF=6,KF=7,vw=300,Sd=301,ey=302,Jy=303,Aw=304,D2=306,Fn=1e3,Yi=1001,wd=1002,ts=1003,k3=1004,Cp=1005,$s=1006,B2=1007,sa=1008,ZF=1008,xi=1009,hd=1010,dd=1011,Eu=1012,pi=1013,Jn=1014,Di=1015,ii=1016,H3=1017,W3=1018,Tc=1020,Nw=35902,Rw=35899,q3=1021,tx=1022,Ki=1023,Mo=1026,ol=1027,Wp=1028,ex=1029,Qo=1030,nx=1031,QF=1032,sx=1033,hp=33776,dp=33777,fp=33778,pp=33779,L2=35840,O2=35841,F2=35842,U2=35843,ny=36196,sy=37492,iy=37496,ry=37488,oy=37489,Dp=37490,ay=37491,ly=37808,cy=37809,uy=37810,hy=37811,dy=37812,fy=37813,py=37814,my=37815,gy=37816,yy=37817,xy=37818,by=37819,Sy=37820,wy=37821,Ty=36492,JF=36494,tU=36495,_y=36283,My=36284,Bp=36285,vy=36286,al=0,eU=1,Ec="",bn="srgb",Ay="srgb-linear",Ny="linear",ye="srgb",sS="",$3="rg",nU="ga",sU=0,Mu=7680,iU=7681,rU=7682,oU=7683,aU=34055,lU=34056,cU=5386,uU=512,hU=513,dU=514,fU=515,pU=516,mU=517,gU=518,P2=519,X3=512,Ew=513,j3=514,ix=515,Y3=516,K3=517,rx=518,Z3=519,Td=35044,Lp=35048,_r=2e3,Jr=2001,Jo={COMPUTE:"compute",RENDER:"render"},_c={TEXTURE_COMPARE:"depthTextureCompare"};function yU(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}function Ry(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Ey(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function xU(){const r=Ey("canvas");return r.style.display="block",r}const _N={};function z2(...r){const t="THREE."+r.shift();console.log(t,...r)}function Q3(r){const t=r[0];if(typeof t=="string"&&t.startsWith("TSL:")){const e=r[1];e&&e.isStackTrace?r[0]+=" "+e.getLocation():r[1]='Stack trace not available. Enable "THREE.Node.captureStackTrace" to capture stack traces.'}return r}function Wt(...r){r=Q3(r);const t="THREE."+r.shift();{const e=r[0];e&&e.isStackTrace?console.warn(e.getError(t)):console.warn(t,...r)}}function Ht(...r){r=Q3(r);const t="THREE."+r.shift();{const e=r[0];e&&e.isStackTrace?console.error(e.getError(t)):console.error(t,...r)}}function an(...r){const t=r.join(" ");t in _N||(_N[t]=!0,Wt(...r))}const J3={[jg]:Yg,[Kg]:Jg,[Zg]:ty,[bd]:Qg,[Yg]:jg,[Jg]:Kg,[ty]:Zg,[Qg]:bd};class Oc{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){const n=this._listeners;return n===void 0?!1:n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){const n=this._listeners;if(n===void 0)return;const s=n[t];if(s!==void 0){const i=s.indexOf(e);i!==-1&&s.splice(i,1)}}dispatchEvent(t){const e=this._listeners;if(e===void 0)return;const n=e[t.type];if(n!==void 0){t.target=this;const s=n.slice(0);for(let i=0,a=s.length;i<a;i++)s[i].call(this,t);t.target=null}}}const ci=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let MN=1234567;const mp=Math.PI/180,_d=180/Math.PI;function ia(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ci[r&255]+ci[r>>8&255]+ci[r>>16&255]+ci[r>>24&255]+"-"+ci[t&255]+ci[t>>8&255]+"-"+ci[t>>16&15|64]+ci[t>>24&255]+"-"+ci[e&63|128]+ci[e>>8&255]+"-"+ci[e>>16&255]+ci[e>>24&255]+ci[n&255]+ci[n>>8&255]+ci[n>>16&255]+ci[n>>24&255]).toLowerCase()}function De(r,t,e){return Math.max(t,Math.min(e,r))}function Cw(r,t){return(r%t+t)%t}function bU(r,t,e,n,s){return n+(r-t)*(s-n)/(e-t)}function SU(r,t,e){return r!==t?(e-r)/(t-r):0}function gp(r,t,e){return(1-e)*r+e*t}function wU(r,t,e,n){return gp(r,t,1-Math.exp(-e*n))}function TU(r,t=1){return t-Math.abs(Cw(r,t*2)-t)}function _U(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*(3-2*r))}function MU(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*r*(r*(r*6-15)+10))}function vU(r,t){return r+Math.floor(Math.random()*(t-r+1))}function AU(r,t){return r+Math.random()*(t-r)}function NU(r){return r*(.5-Math.random())}function RU(r){r!==void 0&&(MN=r);let t=MN+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function EU(r){return r*mp}function CU(r){return r*_d}function DU(r){return(r&r-1)===0&&r!==0}function BU(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function LU(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function OU(r,t,e,n,s){const i=Math.cos,a=Math.sin,c=i(e/2),u=a(e/2),d=i((t+n)/2),f=a((t+n)/2),p=i((t-n)/2),g=a((t-n)/2),y=i((n-t)/2),x=a((n-t)/2);switch(s){case"XYX":r.set(c*f,u*p,u*g,c*d);break;case"YZY":r.set(u*g,c*f,u*p,c*d);break;case"ZXZ":r.set(u*p,u*g,c*f,c*d);break;case"XZX":r.set(c*f,u*x,u*y,c*d);break;case"YXY":r.set(u*y,c*f,u*x,c*d);break;case"ZYZ":r.set(u*x,u*y,c*f,c*d);break;default:Wt("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Bi(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function Ne(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const St={DEG2RAD:mp,RAD2DEG:_d,generateUUID:ia,clamp:De,euclideanModulo:Cw,mapLinear:bU,inverseLerp:SU,lerp:gp,damp:wU,pingpong:TU,smoothstep:_U,smootherstep:MU,randInt:vU,randFloat:AU,randFloatSpread:NU,seededRandom:RU,degToRad:EU,radToDeg:CU,isPowerOfTwo:DU,ceilPowerOfTwo:BU,floorPowerOfTwo:LU,setQuaternionFromProperEuler:OU,normalize:Ne,denormalize:Bi};class Ut{constructor(t=0,e=0){Ut.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6],this.y=s[1]*e+s[4]*n+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=De(this.x,t.x,e.x),this.y=De(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=De(this.x,t,e),this.y=De(this.y,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(De(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(De(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),s=Math.sin(e),i=this.x-t.x,a=this.y-t.y;return this.x=i*n-a*s+t.x,this.y=i*s+a*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ps{constructor(t=0,e=0,n=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=s}static slerpFlat(t,e,n,s,i,a,c){let u=n[s+0],d=n[s+1],f=n[s+2],p=n[s+3],g=i[a+0],y=i[a+1],x=i[a+2],S=i[a+3];if(p!==S||u!==g||d!==y||f!==x){let T=u*g+d*y+f*x+p*S;T<0&&(g=-g,y=-y,x=-x,S=-S,T=-T);let M=1-c;if(T<.9995){const N=Math.acos(T),v=Math.sin(N);M=Math.sin(M*N)/v,c=Math.sin(c*N)/v,u=u*M+g*c,d=d*M+y*c,f=f*M+x*c,p=p*M+S*c}else{u=u*M+g*c,d=d*M+y*c,f=f*M+x*c,p=p*M+S*c;const N=1/Math.sqrt(u*u+d*d+f*f+p*p);u*=N,d*=N,f*=N,p*=N}}t[e]=u,t[e+1]=d,t[e+2]=f,t[e+3]=p}static multiplyQuaternionsFlat(t,e,n,s,i,a){const c=n[s],u=n[s+1],d=n[s+2],f=n[s+3],p=i[a],g=i[a+1],y=i[a+2],x=i[a+3];return t[e]=c*x+f*p+u*y-d*g,t[e+1]=u*x+f*g+d*p-c*y,t[e+2]=d*x+f*y+c*g-u*p,t[e+3]=f*x-c*p-u*g-d*y,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,s){return this._x=t,this._y=e,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,s=t._y,i=t._z,a=t._order,c=Math.cos,u=Math.sin,d=c(n/2),f=c(s/2),p=c(i/2),g=u(n/2),y=u(s/2),x=u(i/2);switch(a){case"XYZ":this._x=g*f*p+d*y*x,this._y=d*y*p-g*f*x,this._z=d*f*x+g*y*p,this._w=d*f*p-g*y*x;break;case"YXZ":this._x=g*f*p+d*y*x,this._y=d*y*p-g*f*x,this._z=d*f*x-g*y*p,this._w=d*f*p+g*y*x;break;case"ZXY":this._x=g*f*p-d*y*x,this._y=d*y*p+g*f*x,this._z=d*f*x+g*y*p,this._w=d*f*p-g*y*x;break;case"ZYX":this._x=g*f*p-d*y*x,this._y=d*y*p+g*f*x,this._z=d*f*x-g*y*p,this._w=d*f*p+g*y*x;break;case"YZX":this._x=g*f*p+d*y*x,this._y=d*y*p+g*f*x,this._z=d*f*x-g*y*p,this._w=d*f*p-g*y*x;break;case"XZY":this._x=g*f*p-d*y*x,this._y=d*y*p-g*f*x,this._z=d*f*x+g*y*p,this._w=d*f*p+g*y*x;break;default:Wt("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,s=Math.sin(n);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],s=e[4],i=e[8],a=e[1],c=e[5],u=e[9],d=e[2],f=e[6],p=e[10],g=n+c+p;if(g>0){const y=.5/Math.sqrt(g+1);this._w=.25/y,this._x=(f-u)*y,this._y=(i-d)*y,this._z=(a-s)*y}else if(n>c&&n>p){const y=2*Math.sqrt(1+n-c-p);this._w=(f-u)/y,this._x=.25*y,this._y=(s+a)/y,this._z=(i+d)/y}else if(c>p){const y=2*Math.sqrt(1+c-n-p);this._w=(i-d)/y,this._x=(s+a)/y,this._y=.25*y,this._z=(u+f)/y}else{const y=2*Math.sqrt(1+p-n-c);this._w=(a-s)/y,this._x=(i+d)/y,this._y=(u+f)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<1e-8?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(De(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const s=Math.min(1,e/n);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,s=t._y,i=t._z,a=t._w,c=e._x,u=e._y,d=e._z,f=e._w;return this._x=n*f+a*c+s*d-i*u,this._y=s*f+a*u+i*c-n*d,this._z=i*f+a*d+n*u-s*c,this._w=a*f-n*c-s*u-i*d,this._onChangeCallback(),this}slerp(t,e){let n=t._x,s=t._y,i=t._z,a=t._w,c=this.dot(t);c<0&&(n=-n,s=-s,i=-i,a=-a,c=-c);let u=1-e;if(c<.9995){const d=Math.acos(c),f=Math.sin(d);u=Math.sin(u*d)/f,e=Math.sin(e*d)/f,this._x=this._x*u+n*e,this._y=this._y*u+s*e,this._z=this._z*u+i*e,this._w=this._w*u+a*e,this._onChangeCallback()}else this._x=this._x*u+n*e,this._y=this._y*u+s*e,this._z=this._z*u+i*e,this._w=this._w*u+a*e,this.normalize();return this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),s=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(s*Math.sin(t),s*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class V{constructor(t=0,e=0,n=0){V.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(vN.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(vN.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,s=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*s,this.y=i[1]*e+i[4]*n+i[7]*s,this.z=i[2]*e+i[5]*n+i[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,s=this.z,i=t.elements,a=1/(i[3]*e+i[7]*n+i[11]*s+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*s+i[12])*a,this.y=(i[1]*e+i[5]*n+i[9]*s+i[13])*a,this.z=(i[2]*e+i[6]*n+i[10]*s+i[14])*a,this}applyQuaternion(t){const e=this.x,n=this.y,s=this.z,i=t.x,a=t.y,c=t.z,u=t.w,d=2*(a*s-c*n),f=2*(c*e-i*s),p=2*(i*n-a*e);return this.x=e+u*d+a*p-c*f,this.y=n+u*f+c*d-i*p,this.z=s+u*p+i*f-a*d,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,s=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*s,this.y=i[1]*e+i[5]*n+i[9]*s,this.z=i[2]*e+i[6]*n+i[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=De(this.x,t.x,e.x),this.y=De(this.y,t.y,e.y),this.z=De(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=De(this.x,t,e),this.y=De(this.y,t,e),this.z=De(this.z,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(De(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,s=t.y,i=t.z,a=e.x,c=e.y,u=e.z;return this.x=s*u-i*c,this.y=i*a-n*u,this.z=n*c-s*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return iS.copy(this).projectOnVector(t),this.sub(iS)}reflect(t){return this.sub(iS.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(De(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,s=this.z-t.z;return e*e+n*n+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const s=Math.sin(e)*t;return this.x=s*Math.sin(n),this.y=Math.cos(e)*t,this.z=s*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const iS=new V,vN=new Ps;class rr{constructor(t,e,n,s,i,a,c,u,d){rr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,n,s,i,a,c,u,d)}set(t,e,n,s,i,a,c,u,d){const f=this.elements;return f[0]=t,f[1]=s,f[2]=c,f[3]=e,f[4]=i,f[5]=u,f[6]=n,f[7]=a,f[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,s=e.elements,i=this.elements,a=n[0],c=n[3],u=n[6],d=n[1],f=n[4],p=n[7],g=n[2],y=n[5],x=n[8],S=s[0],T=s[3],M=s[6],N=s[1],v=s[4],A=s[7],R=s[2],L=s[5],D=s[8];return i[0]=a*S+c*N+u*R,i[3]=a*T+c*v+u*L,i[6]=a*M+c*A+u*D,i[1]=d*S+f*N+p*R,i[4]=d*T+f*v+p*L,i[7]=d*M+f*A+p*D,i[2]=g*S+y*N+x*R,i[5]=g*T+y*v+x*L,i[8]=g*M+y*A+x*D,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],s=t[2],i=t[3],a=t[4],c=t[5],u=t[6],d=t[7],f=t[8];return e*a*f-e*c*d-n*i*f+n*c*u+s*i*d-s*a*u}invert(){const t=this.elements,e=t[0],n=t[1],s=t[2],i=t[3],a=t[4],c=t[5],u=t[6],d=t[7],f=t[8],p=f*a-c*d,g=c*u-f*i,y=d*i-a*u,x=e*p+n*g+s*y;if(x===0)return this.set(0,0,0,0,0,0,0,0,0);const S=1/x;return t[0]=p*S,t[1]=(s*d-f*n)*S,t[2]=(c*n-s*a)*S,t[3]=g*S,t[4]=(f*e-s*u)*S,t[5]=(s*i-c*e)*S,t[6]=y*S,t[7]=(n*u-d*e)*S,t[8]=(a*e-n*i)*S,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,s,i,a,c){const u=Math.cos(i),d=Math.sin(i);return this.set(n*u,n*d,-n*(u*a+d*c)+a+t,-s*d,s*u,-s*(-d*a+u*c)+c+e,0,0,1),this}scale(t,e){return this.premultiply(rS.makeScale(t,e)),this}rotate(t){return this.premultiply(rS.makeRotation(-t)),this}translate(t,e){return this.premultiply(rS.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let s=0;s<9;s++)if(e[s]!==n[s])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const rS=new rr,AN=new rr().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),NN=new rr().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function FU(){const r={enabled:!0,workingColorSpace:Ay,spaces:{},convert:function(s,i,a){return this.enabled===!1||i===a||!i||!a||(this.spaces[i].transfer===ye&&(s.r=ll(s.r),s.g=ll(s.g),s.b=ll(s.b)),this.spaces[i].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[i].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===ye&&(s.r=fd(s.r),s.g=fd(s.g),s.b=fd(s.b))),s},workingToColorSpace:function(s,i){return this.convert(s,this.workingColorSpace,i)},colorSpaceToWorking:function(s,i){return this.convert(s,i,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===Ec?Ny:this.spaces[s].transfer},getToneMappingMode:function(s){return this.spaces[s].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(s,i=this.workingColorSpace){return s.fromArray(this.spaces[i].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,i,a){return s.copy(this.spaces[i].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,i){return an("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),r.workingToColorSpace(s,i)},toWorkingColorSpace:function(s,i){return an("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),r.colorSpaceToWorking(s,i)}},t=[.64,.33,.3,.6,.15,.06],e=[.2126,.7152,.0722],n=[.3127,.329];return r.define({[Ay]:{primaries:t,whitePoint:n,transfer:Ny,toXYZ:AN,fromXYZ:NN,luminanceCoefficients:e,workingColorSpaceConfig:{unpackColorSpace:bn},outputColorSpaceConfig:{drawingBufferColorSpace:bn}},[bn]:{primaries:t,whitePoint:n,transfer:ye,toXYZ:AN,fromXYZ:NN,luminanceCoefficients:e,outputColorSpaceConfig:{drawingBufferColorSpace:bn}}}),r}const Xe=FU();function ll(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function fd(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let Eh;class UU{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let n;if(t instanceof HTMLCanvasElement)n=t;else{Eh===void 0&&(Eh=Ey("canvas")),Eh.width=t.width,Eh.height=t.height;const s=Eh.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),n=Eh}return n.toDataURL(e)}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Ey("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const s=n.getImageData(0,0,t.width,t.height),i=s.data;for(let a=0;a<i.length;a++)i[a]=ll(i[a]/255)*255;return n.putImageData(s,0,0),e}else if(t.data){const e=t.data.slice(0);for(let n=0;n<e.length;n++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[n]=Math.floor(ll(e[n]/255)*255):e[n]=ll(e[n]);return{data:e,width:t.width,height:t.height}}else return Wt("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let PU=0;class Dw{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:PU++}),this.uuid=ia(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):typeof VideoFrame<"u"&&e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):e!==null?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let i;if(Array.isArray(s)){i=[];for(let a=0,c=s.length;a<c;a++)s[a].isDataTexture?i.push(oS(s[a].image)):i.push(oS(s[a]))}else i=oS(s);n.url=i}return e||(t.images[this.uuid]=n),n}}function oS(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?UU.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(Wt("Texture: Unable to serialize Texture."),{})}let zU=0;const aS=new V;class is extends Oc{constructor(t=is.DEFAULT_IMAGE,e=is.DEFAULT_MAPPING,n=Yi,s=Yi,i=$s,a=sa,c=Ki,u=xi,d=is.DEFAULT_ANISOTROPY,f=Ec){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:zU++}),this.uuid=ia(),this.name="",this.source=new Dw(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=i,this.minFilter=a,this.anisotropy=d,this.format=c,this.internalFormat=null,this.type=u,this.offset=new Ut(0,0),this.repeat=new Ut(1,1),this.center=new Ut(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new rr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=f,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(aS).x}get height(){return this.source.getSize(aS).y}get depth(){return this.source.getSize(aS).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const n=t[e];if(n===void 0){Wt(`Texture.setValues(): parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){Wt(`Texture.setValues(): property '${e}' does not exist.`);continue}s&&n&&s.isVector2&&n.isVector2||s&&n&&s.isVector3&&n.isVector3||s&&n&&s.isMatrix3&&n.isMatrix3?s.copy(n):this[e]=n}}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==vw)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Fn:t.x=t.x-Math.floor(t.x);break;case Yi:t.x=t.x<0?0:1;break;case wd:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Fn:t.y=t.y-Math.floor(t.y);break;case Yi:t.y=t.y<0?0:1;break;case wd:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}is.DEFAULT_IMAGE=null;is.DEFAULT_MAPPING=vw;is.DEFAULT_ANISOTROPY=1;class Ze{constructor(t=0,e=0,n=0,s=1){Ze.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,s){return this.x=t,this.y=e,this.z=n,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,s=this.z,i=this.w,a=t.elements;return this.x=a[0]*e+a[4]*n+a[8]*s+a[12]*i,this.y=a[1]*e+a[5]*n+a[9]*s+a[13]*i,this.z=a[2]*e+a[6]*n+a[10]*s+a[14]*i,this.w=a[3]*e+a[7]*n+a[11]*s+a[15]*i,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,s,i;const u=t.elements,d=u[0],f=u[4],p=u[8],g=u[1],y=u[5],x=u[9],S=u[2],T=u[6],M=u[10];if(Math.abs(f-g)<.01&&Math.abs(p-S)<.01&&Math.abs(x-T)<.01){if(Math.abs(f+g)<.1&&Math.abs(p+S)<.1&&Math.abs(x+T)<.1&&Math.abs(d+y+M-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const v=(d+1)/2,A=(y+1)/2,R=(M+1)/2,L=(f+g)/4,D=(p+S)/4,U=(x+T)/4;return v>A&&v>R?v<.01?(n=0,s=.707106781,i=.707106781):(n=Math.sqrt(v),s=L/n,i=D/n):A>R?A<.01?(n=.707106781,s=0,i=.707106781):(s=Math.sqrt(A),n=L/s,i=U/s):R<.01?(n=.707106781,s=.707106781,i=0):(i=Math.sqrt(R),n=D/i,s=U/i),this.set(n,s,i,e),this}let N=Math.sqrt((T-x)*(T-x)+(p-S)*(p-S)+(g-f)*(g-f));return Math.abs(N)<.001&&(N=1),this.x=(T-x)/N,this.y=(p-S)/N,this.z=(g-f)/N,this.w=Math.acos((d+y+M-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=De(this.x,t.x,e.x),this.y=De(this.y,t.y,e.y),this.z=De(this.z,t.z,e.z),this.w=De(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=De(this.x,t,e),this.y=De(this.y,t,e),this.z=De(this.z,t,e),this.w=De(this.w,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(De(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class fl extends Oc{constructor(t=1,e=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:$s,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=n.depth,this.scissor=new Ze(0,0,t,e),this.scissorTest=!1,this.viewport=new Ze(0,0,t,e),this.textures=[];const s={width:t,height:e,depth:n.depth},i=new is(s),a=n.count;for(let c=0;c<a;c++)this.textures[c]=i.clone(),this.textures[c].isRenderTargetTexture=!0,this.textures[c].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(t={}){const e={minFilter:$s,generateMipmaps:!1,flipY:!1,internalFormat:null};t.mapping!==void 0&&(e.mapping=t.mapping),t.wrapS!==void 0&&(e.wrapS=t.wrapS),t.wrapT!==void 0&&(e.wrapT=t.wrapT),t.wrapR!==void 0&&(e.wrapR=t.wrapR),t.magFilter!==void 0&&(e.magFilter=t.magFilter),t.minFilter!==void 0&&(e.minFilter=t.minFilter),t.format!==void 0&&(e.format=t.format),t.type!==void 0&&(e.type=t.type),t.anisotropy!==void 0&&(e.anisotropy=t.anisotropy),t.colorSpace!==void 0&&(e.colorSpace=t.colorSpace),t.flipY!==void 0&&(e.flipY=t.flipY),t.generateMipmaps!==void 0&&(e.generateMipmaps=t.generateMipmaps),t.internalFormat!==void 0&&(e.internalFormat=t.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(e)}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),t!==null&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let s=0,i=this.textures.length;s<i;s++)this.textures[s].image.width=t,this.textures[s].image.height=e,this.textures[s].image.depth=n,this.textures[s].isData3DTexture!==!0&&(this.textures[s].isArrayTexture=this.textures[s].image.depth>1);this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,n=t.textures.length;e<n;e++){this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;const s=Object.assign({},t.textures[e].image);this.textures[e].source=new Dw(s)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class IU extends is{constructor(t=null,e=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:s},this.magFilter=ts,this.minFilter=ts,this.wrapR=Yi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class ve{constructor(t,e,n,s,i,a,c,u,d,f,p,g,y,x,S,T){ve.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,n,s,i,a,c,u,d,f,p,g,y,x,S,T)}set(t,e,n,s,i,a,c,u,d,f,p,g,y,x,S,T){const M=this.elements;return M[0]=t,M[4]=e,M[8]=n,M[12]=s,M[1]=i,M[5]=a,M[9]=c,M[13]=u,M[2]=d,M[6]=f,M[10]=p,M[14]=g,M[3]=y,M[7]=x,M[11]=S,M[15]=T,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ve().fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return this.determinant()===0?(t.set(1,0,0),e.set(0,1,0),n.set(0,0,1),this):(t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this)}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){if(t.determinant()===0)return this.identity();const e=this.elements,n=t.elements,s=1/Ch.setFromMatrixColumn(t,0).length(),i=1/Ch.setFromMatrixColumn(t,1).length(),a=1/Ch.setFromMatrixColumn(t,2).length();return e[0]=n[0]*s,e[1]=n[1]*s,e[2]=n[2]*s,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,s=t.y,i=t.z,a=Math.cos(n),c=Math.sin(n),u=Math.cos(s),d=Math.sin(s),f=Math.cos(i),p=Math.sin(i);if(t.order==="XYZ"){const g=a*f,y=a*p,x=c*f,S=c*p;e[0]=u*f,e[4]=-u*p,e[8]=d,e[1]=y+x*d,e[5]=g-S*d,e[9]=-c*u,e[2]=S-g*d,e[6]=x+y*d,e[10]=a*u}else if(t.order==="YXZ"){const g=u*f,y=u*p,x=d*f,S=d*p;e[0]=g+S*c,e[4]=x*c-y,e[8]=a*d,e[1]=a*p,e[5]=a*f,e[9]=-c,e[2]=y*c-x,e[6]=S+g*c,e[10]=a*u}else if(t.order==="ZXY"){const g=u*f,y=u*p,x=d*f,S=d*p;e[0]=g-S*c,e[4]=-a*p,e[8]=x+y*c,e[1]=y+x*c,e[5]=a*f,e[9]=S-g*c,e[2]=-a*d,e[6]=c,e[10]=a*u}else if(t.order==="ZYX"){const g=a*f,y=a*p,x=c*f,S=c*p;e[0]=u*f,e[4]=x*d-y,e[8]=g*d+S,e[1]=u*p,e[5]=S*d+g,e[9]=y*d-x,e[2]=-d,e[6]=c*u,e[10]=a*u}else if(t.order==="YZX"){const g=a*u,y=a*d,x=c*u,S=c*d;e[0]=u*f,e[4]=S-g*p,e[8]=x*p+y,e[1]=p,e[5]=a*f,e[9]=-c*f,e[2]=-d*f,e[6]=y*p+x,e[10]=g-S*p}else if(t.order==="XZY"){const g=a*u,y=a*d,x=c*u,S=c*d;e[0]=u*f,e[4]=-p,e[8]=d*f,e[1]=g*p+S,e[5]=a*f,e[9]=y*p-x,e[2]=x*p-y,e[6]=c*f,e[10]=S*p+g}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(VU,t,GU)}lookAt(t,e,n){const s=this.elements;return mr.subVectors(t,e),mr.lengthSq()===0&&(mr.z=1),mr.normalize(),kl.crossVectors(n,mr),kl.lengthSq()===0&&(Math.abs(n.z)===1?mr.x+=1e-4:mr.z+=1e-4,mr.normalize(),kl.crossVectors(n,mr)),kl.normalize(),mm.crossVectors(mr,kl),s[0]=kl.x,s[4]=mm.x,s[8]=mr.x,s[1]=kl.y,s[5]=mm.y,s[9]=mr.y,s[2]=kl.z,s[6]=mm.z,s[10]=mr.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,s=e.elements,i=this.elements,a=n[0],c=n[4],u=n[8],d=n[12],f=n[1],p=n[5],g=n[9],y=n[13],x=n[2],S=n[6],T=n[10],M=n[14],N=n[3],v=n[7],A=n[11],R=n[15],L=s[0],D=s[4],U=s[8],B=s[12],P=s[1],J=s[5],q=s[9],ft=s[13],Mt=s[2],mt=s[6],F=s[10],Y=s[14],tt=s[3],lt=s[7],Tt=s[11],O=s[15];return i[0]=a*L+c*P+u*Mt+d*tt,i[4]=a*D+c*J+u*mt+d*lt,i[8]=a*U+c*q+u*F+d*Tt,i[12]=a*B+c*ft+u*Y+d*O,i[1]=f*L+p*P+g*Mt+y*tt,i[5]=f*D+p*J+g*mt+y*lt,i[9]=f*U+p*q+g*F+y*Tt,i[13]=f*B+p*ft+g*Y+y*O,i[2]=x*L+S*P+T*Mt+M*tt,i[6]=x*D+S*J+T*mt+M*lt,i[10]=x*U+S*q+T*F+M*Tt,i[14]=x*B+S*ft+T*Y+M*O,i[3]=N*L+v*P+A*Mt+R*tt,i[7]=N*D+v*J+A*mt+R*lt,i[11]=N*U+v*q+A*F+R*Tt,i[15]=N*B+v*ft+A*Y+R*O,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],s=t[8],i=t[12],a=t[1],c=t[5],u=t[9],d=t[13],f=t[2],p=t[6],g=t[10],y=t[14],x=t[3],S=t[7],T=t[11],M=t[15],N=u*y-d*g,v=c*y-d*p,A=c*g-u*p,R=a*y-d*f,L=a*g-u*f,D=a*p-c*f;return e*(S*N-T*v+M*A)-n*(x*N-T*R+M*L)+s*(x*v-S*R+M*D)-i*(x*A-S*L+T*D)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],s=t[2],i=t[3],a=t[4],c=t[5],u=t[6],d=t[7],f=t[8],p=t[9],g=t[10],y=t[11],x=t[12],S=t[13],T=t[14],M=t[15],N=e*c-n*a,v=e*u-s*a,A=e*d-i*a,R=n*u-s*c,L=n*d-i*c,D=s*d-i*u,U=f*S-p*x,B=f*T-g*x,P=f*M-y*x,J=p*T-g*S,q=p*M-y*S,ft=g*M-y*T,Mt=N*ft-v*q+A*J+R*P-L*B+D*U;if(Mt===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const mt=1/Mt;return t[0]=(c*ft-u*q+d*J)*mt,t[1]=(s*q-n*ft-i*J)*mt,t[2]=(S*D-T*L+M*R)*mt,t[3]=(g*L-p*D-y*R)*mt,t[4]=(u*P-a*ft-d*B)*mt,t[5]=(e*ft-s*P+i*B)*mt,t[6]=(T*A-x*D-M*v)*mt,t[7]=(f*D-g*A+y*v)*mt,t[8]=(a*q-c*P+d*U)*mt,t[9]=(n*P-e*q-i*U)*mt,t[10]=(x*L-S*A+M*N)*mt,t[11]=(p*A-f*L-y*N)*mt,t[12]=(c*B-a*J-u*U)*mt,t[13]=(e*J-n*B+s*U)*mt,t[14]=(S*v-x*R-T*N)*mt,t[15]=(f*R-p*v+g*N)*mt,this}scale(t){const e=this.elements,n=t.x,s=t.y,i=t.z;return e[0]*=n,e[4]*=s,e[8]*=i,e[1]*=n,e[5]*=s,e[9]*=i,e[2]*=n,e[6]*=s,e[10]*=i,e[3]*=n,e[7]*=s,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,s))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),s=Math.sin(e),i=1-n,a=t.x,c=t.y,u=t.z,d=i*a,f=i*c;return this.set(d*a+n,d*c-s*u,d*u+s*c,0,d*c+s*u,f*c+n,f*u-s*a,0,d*u-s*c,f*u+s*a,i*u*u+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,s,i,a){return this.set(1,n,i,0,t,1,a,0,e,s,1,0,0,0,0,1),this}compose(t,e,n){const s=this.elements,i=e._x,a=e._y,c=e._z,u=e._w,d=i+i,f=a+a,p=c+c,g=i*d,y=i*f,x=i*p,S=a*f,T=a*p,M=c*p,N=u*d,v=u*f,A=u*p,R=n.x,L=n.y,D=n.z;return s[0]=(1-(S+M))*R,s[1]=(y+A)*R,s[2]=(x-v)*R,s[3]=0,s[4]=(y-A)*L,s[5]=(1-(g+M))*L,s[6]=(T+N)*L,s[7]=0,s[8]=(x+v)*D,s[9]=(T-N)*D,s[10]=(1-(g+S))*D,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,n){const s=this.elements;t.x=s[12],t.y=s[13],t.z=s[14];const i=this.determinant();if(i===0)return n.set(1,1,1),e.identity(),this;let a=Ch.set(s[0],s[1],s[2]).length();const c=Ch.set(s[4],s[5],s[6]).length(),u=Ch.set(s[8],s[9],s[10]).length();i<0&&(a=-a),mo.copy(this);const d=1/a,f=1/c,p=1/u;return mo.elements[0]*=d,mo.elements[1]*=d,mo.elements[2]*=d,mo.elements[4]*=f,mo.elements[5]*=f,mo.elements[6]*=f,mo.elements[8]*=p,mo.elements[9]*=p,mo.elements[10]*=p,e.setFromRotationMatrix(mo),n.x=a,n.y=c,n.z=u,this}makePerspective(t,e,n,s,i,a,c=_r,u=!1){const d=this.elements,f=2*i/(e-t),p=2*i/(n-s),g=(e+t)/(e-t),y=(n+s)/(n-s);let x,S;if(u)x=i/(a-i),S=a*i/(a-i);else if(c===_r)x=-(a+i)/(a-i),S=-2*a*i/(a-i);else if(c===Jr)x=-a/(a-i),S=-a*i/(a-i);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+c);return d[0]=f,d[4]=0,d[8]=g,d[12]=0,d[1]=0,d[5]=p,d[9]=y,d[13]=0,d[2]=0,d[6]=0,d[10]=x,d[14]=S,d[3]=0,d[7]=0,d[11]=-1,d[15]=0,this}makeOrthographic(t,e,n,s,i,a,c=_r,u=!1){const d=this.elements,f=2/(e-t),p=2/(n-s),g=-(e+t)/(e-t),y=-(n+s)/(n-s);let x,S;if(u)x=1/(a-i),S=a/(a-i);else if(c===_r)x=-2/(a-i),S=-(a+i)/(a-i);else if(c===Jr)x=-1/(a-i),S=-i/(a-i);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+c);return d[0]=f,d[4]=0,d[8]=0,d[12]=g,d[1]=0,d[5]=p,d[9]=0,d[13]=y,d[2]=0,d[6]=0,d[10]=x,d[14]=S,d[3]=0,d[7]=0,d[11]=0,d[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let s=0;s<16;s++)if(e[s]!==n[s])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Ch=new V,mo=new ve,VU=new V(0,0,0),GU=new V(1,1,1),kl=new V,mm=new V,mr=new V,RN=new ve,EN=new Ps;class tr{constructor(t=0,e=0,n=0,s=tr.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,s=this._order){return this._x=t,this._y=e,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const s=t.elements,i=s[0],a=s[4],c=s[8],u=s[1],d=s[5],f=s[9],p=s[2],g=s[6],y=s[10];switch(e){case"XYZ":this._y=Math.asin(De(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-f,y),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(g,d),this._z=0);break;case"YXZ":this._x=Math.asin(-De(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(c,y),this._z=Math.atan2(u,d)):(this._y=Math.atan2(-p,i),this._z=0);break;case"ZXY":this._x=Math.asin(De(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-p,y),this._z=Math.atan2(-a,d)):(this._y=0,this._z=Math.atan2(u,i));break;case"ZYX":this._y=Math.asin(-De(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(g,y),this._z=Math.atan2(u,i)):(this._x=0,this._z=Math.atan2(-a,d));break;case"YZX":this._z=Math.asin(De(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-f,d),this._y=Math.atan2(-p,i)):(this._x=0,this._y=Math.atan2(c,y));break;case"XZY":this._z=Math.asin(-De(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(g,d),this._y=Math.atan2(c,i)):(this._x=Math.atan2(-f,y),this._y=0);break;default:Wt("Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return RN.makeRotationFromQuaternion(t),this.setFromRotationMatrix(RN,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return EN.setFromEuler(this),this.setFromQuaternion(EN,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}tr.DEFAULT_ORDER="XYZ";class kU{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let HU=0;const CN=new V,Dh=new Ps,Ia=new ve,gm=new V,Rf=new V,WU=new V,qU=new Ps,DN=new V(1,0,0),BN=new V(0,1,0),LN=new V(0,0,1),ON={type:"added"},$U={type:"removed"},Bh={type:"childadded",child:null},lS={type:"childremoved",child:null};class On extends Oc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:HU++}),this.uuid=ia(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=On.DEFAULT_UP.clone();const t=new V,e=new tr,n=new Ps,s=new V(1,1,1);function i(){n.setFromEuler(e,!1)}function a(){e.setFromQuaternion(n,void 0,!1)}e._onChange(i),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new ve},normalMatrix:{value:new rr}}),this.matrix=new ve,this.matrixWorld=new ve,this.matrixAutoUpdate=On.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=On.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new kU,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.static=!1,this.userData={},this.pivot=null}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Dh.setFromAxisAngle(t,e),this.quaternion.multiply(Dh),this}rotateOnWorldAxis(t,e){return Dh.setFromAxisAngle(t,e),this.quaternion.premultiply(Dh),this}rotateX(t){return this.rotateOnAxis(DN,t)}rotateY(t){return this.rotateOnAxis(BN,t)}rotateZ(t){return this.rotateOnAxis(LN,t)}translateOnAxis(t,e){return CN.copy(t).applyQuaternion(this.quaternion),this.position.add(CN.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(DN,t)}translateY(t){return this.translateOnAxis(BN,t)}translateZ(t){return this.translateOnAxis(LN,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Ia.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?gm.copy(t):gm.set(t,e,n);const s=this.parent;this.updateWorldMatrix(!0,!1),Rf.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ia.lookAt(Rf,gm,this.up):Ia.lookAt(gm,Rf,this.up),this.quaternion.setFromRotationMatrix(Ia),s&&(Ia.extractRotation(s.matrixWorld),Dh.setFromRotationMatrix(Ia),this.quaternion.premultiply(Dh.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(Ht("Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(ON),Bh.child=t,this.dispatchEvent(Bh),Bh.child=null):Ht("Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent($U),lS.child=t,this.dispatchEvent(lS),lS.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Ia.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Ia.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ia),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(ON),Bh.child=t,this.dispatchEvent(Bh),Bh.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,s=this.children.length;n<s;n++){const a=this.children[n].getObjectByProperty(t,e);if(a!==void 0)return a}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const s=this.children;for(let i=0,a=s.length;i<a;i++)s[i].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rf,t,WU),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rf,qU,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,s=e.length;n<s;n++)e[n].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let n=0,s=e.length;n<s;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);const t=this.pivot;if(t!==null){const e=t.x,n=t.y,s=t.z,i=this.matrix.elements;i[12]+=e-i[0]*e-i[4]*n-i[8]*s,i[13]+=n-i[1]*e-i[5]*n-i[9]*s,i[14]+=s-i[2]*e-i[6]*n-i[10]*s}this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,s=e.length;n<s;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(t===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const s=this.children;for(let i=0,a=s.length;i<a;i++)s[i].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),this.static!==!1&&(s.static=this.static),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.pivot!==null&&(s.pivot=this.pivot.toArray()),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.morphTargetDictionary!==void 0&&(s.morphTargetDictionary=Object.assign({},this.morphTargetDictionary)),this.morphTargetInfluences!==void 0&&(s.morphTargetInfluences=this.morphTargetInfluences.slice()),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(c=>({...c,boundingBox:c.boundingBox?c.boundingBox.toJSON():void 0,boundingSphere:c.boundingSphere?c.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(c=>({...c})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(t),s.indirectTexture=this._indirectTexture.toJSON(t),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON()));function i(c,u){return c[u.uuid]===void 0&&(c[u.uuid]=u.toJSON(t)),u.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=i(t.geometries,this.geometry);const c=this.geometry.parameters;if(c!==void 0&&c.shapes!==void 0){const u=c.shapes;if(Array.isArray(u))for(let d=0,f=u.length;d<f;d++){const p=u[d];i(t.shapes,p)}else i(t.shapes,u)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(i(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const c=[];for(let u=0,d=this.material.length;u<d;u++)c.push(i(t.materials,this.material[u]));s.material=c}else s.material=i(t.materials,this.material);if(this.children.length>0){s.children=[];for(let c=0;c<this.children.length;c++)s.children.push(this.children[c].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let c=0;c<this.animations.length;c++){const u=this.animations[c];s.animations.push(i(t.animations,u))}}if(e){const c=a(t.geometries),u=a(t.materials),d=a(t.textures),f=a(t.images),p=a(t.shapes),g=a(t.skeletons),y=a(t.animations),x=a(t.nodes);c.length>0&&(n.geometries=c),u.length>0&&(n.materials=u),d.length>0&&(n.textures=d),f.length>0&&(n.images=f),p.length>0&&(n.shapes=p),g.length>0&&(n.skeletons=g),y.length>0&&(n.animations=y),x.length>0&&(n.nodes=x)}return n.object=s,n;function a(c){const u=[];for(const d in c){const f=c[d];delete f.metadata,u.push(f)}return u}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),t.pivot!==null&&(this.pivot=t.pivot.clone()),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.static=t.static,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let n=0;n<t.children.length;n++){const s=t.children[n];this.add(s.clone())}return this}}On.DEFAULT_UP=new V(0,1,0);On.DEFAULT_MATRIX_AUTO_UPDATE=!0;On.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class vt extends On{constructor(){super(),this.isGroup=!0,this.type="Group"}}const XU={type:"move"};class jU{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new vt,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new vt,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new V,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new V),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new vt,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new V,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new V),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,n){let s=null,i=null,a=null;const c=this._targetRay,u=this._grip,d=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(d&&t.hand){a=!0;for(const S of t.hand.values()){const T=e.getJointPose(S,n),M=this._getHandJoint(d,S);T!==null&&(M.matrix.fromArray(T.transform.matrix),M.matrix.decompose(M.position,M.rotation,M.scale),M.matrixWorldNeedsUpdate=!0,M.jointRadius=T.radius),M.visible=T!==null}const f=d.joints["index-finger-tip"],p=d.joints["thumb-tip"],g=f.position.distanceTo(p.position),y=.02,x=.005;d.inputState.pinching&&g>y+x?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!d.inputState.pinching&&g<=y-x&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else u!==null&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),i!==null&&(u.matrix.fromArray(i.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,i.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(i.linearVelocity)):u.hasLinearVelocity=!1,i.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(i.angularVelocity)):u.hasAngularVelocity=!1));c!==null&&(s=e.getPose(t.targetRaySpace,n),s===null&&i!==null&&(s=i),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1,this.dispatchEvent(XU)))}return c!==null&&(c.visible=s!==null),u!==null&&(u.visible=i!==null),d!==null&&(d.visible=a!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){const n=new vt;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}const tC={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Hl={h:0,s:0,l:0},ym={h:0,s:0,l:0};function cS(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*6*(2/3-e):r}class Xt{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(e===void 0&&n===void 0){const s=t;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=bn){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Xe.colorSpaceToWorking(this,e),this}setRGB(t,e,n,s=Xe.workingColorSpace){return this.r=t,this.g=e,this.b=n,Xe.colorSpaceToWorking(this,s),this}setHSL(t,e,n,s=Xe.workingColorSpace){if(t=Cw(t,1),e=De(e,0,1),n=De(n,0,1),e===0)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,a=2*n-i;this.r=cS(a,i,t+1/3),this.g=cS(a,i,t),this.b=cS(a,i,t-1/3)}return Xe.colorSpaceToWorking(this,s),this}setStyle(t,e=bn){function n(i){i!==void 0&&parseFloat(i)<1&&Wt("Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(t)){let i;const a=s[1],c=s[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,e);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,e);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,e);break;default:Wt("Color: Unknown color model "+t)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const i=s[1],a=i.length;if(a===3)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(i,16),e);Wt("Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=bn){const n=tC[t.toLowerCase()];return n!==void 0?this.setHex(n,e):Wt("Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=ll(t.r),this.g=ll(t.g),this.b=ll(t.b),this}copyLinearToSRGB(t){return this.r=fd(t.r),this.g=fd(t.g),this.b=fd(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=bn){return Xe.workingToColorSpace(ui.copy(this),t),Math.round(De(ui.r*255,0,255))*65536+Math.round(De(ui.g*255,0,255))*256+Math.round(De(ui.b*255,0,255))}getHexString(t=bn){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Xe.workingColorSpace){Xe.workingToColorSpace(ui.copy(this),e);const n=ui.r,s=ui.g,i=ui.b,a=Math.max(n,s,i),c=Math.min(n,s,i);let u,d;const f=(c+a)/2;if(c===a)u=0,d=0;else{const p=a-c;switch(d=f<=.5?p/(a+c):p/(2-a-c),a){case n:u=(s-i)/p+(s<i?6:0);break;case s:u=(i-n)/p+2;break;case i:u=(n-s)/p+4;break}u/=6}return t.h=u,t.s=d,t.l=f,t}getRGB(t,e=Xe.workingColorSpace){return Xe.workingToColorSpace(ui.copy(this),e),t.r=ui.r,t.g=ui.g,t.b=ui.b,t}getStyle(t=bn){Xe.workingToColorSpace(ui.copy(this),t);const e=ui.r,n=ui.g,s=ui.b;return t!==bn?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(n*255)},${Math.round(s*255)})`}offsetHSL(t,e,n){return this.getHSL(Hl),this.setHSL(Hl.h+t,Hl.s+e,Hl.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Hl),t.getHSL(ym);const n=gp(Hl.h,ym.h,e),s=gp(Hl.s,ym.s,e),i=gp(Hl.l,ym.l,e);return this.setHSL(n,s,i),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,s=this.b,i=t.elements;return this.r=i[0]*e+i[3]*n+i[6]*s,this.g=i[1]*e+i[4]*n+i[7]*s,this.b=i[2]*e+i[5]*n+i[8]*s,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ui=new Xt;Xt.NAMES=tC;class Hu{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new Xt(t),this.density=e}clone(){return new Hu(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class qp{constructor(t,e=1,n=1e3){this.isFog=!0,this.name="",this.color=new Xt(t),this.near=e,this.far=n}clone(){return new qp(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Bw extends On{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new tr,this.environmentIntensity=1,this.environmentRotation=new tr,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}const go=new V,Va=new V,uS=new V,Ga=new V,Lh=new V,Oh=new V,FN=new V,hS=new V,dS=new V,fS=new V,pS=new Ze,mS=new Ze,gS=new Ze;class To{constructor(t=new V,e=new V,n=new V){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,s){s.subVectors(n,e),go.subVectors(t,e),s.cross(go);const i=s.lengthSq();return i>0?s.multiplyScalar(1/Math.sqrt(i)):s.set(0,0,0)}static getBarycoord(t,e,n,s,i){go.subVectors(s,e),Va.subVectors(n,e),uS.subVectors(t,e);const a=go.dot(go),c=go.dot(Va),u=go.dot(uS),d=Va.dot(Va),f=Va.dot(uS),p=a*d-c*c;if(p===0)return i.set(0,0,0),null;const g=1/p,y=(d*u-c*f)*g,x=(a*f-c*u)*g;return i.set(1-y-x,x,y)}static containsPoint(t,e,n,s){return this.getBarycoord(t,e,n,s,Ga)===null?!1:Ga.x>=0&&Ga.y>=0&&Ga.x+Ga.y<=1}static getInterpolation(t,e,n,s,i,a,c,u){return this.getBarycoord(t,e,n,s,Ga)===null?(u.x=0,u.y=0,"z"in u&&(u.z=0),"w"in u&&(u.w=0),null):(u.setScalar(0),u.addScaledVector(i,Ga.x),u.addScaledVector(a,Ga.y),u.addScaledVector(c,Ga.z),u)}static getInterpolatedAttribute(t,e,n,s,i,a){return pS.setScalar(0),mS.setScalar(0),gS.setScalar(0),pS.fromBufferAttribute(t,e),mS.fromBufferAttribute(t,n),gS.fromBufferAttribute(t,s),a.setScalar(0),a.addScaledVector(pS,i.x),a.addScaledVector(mS,i.y),a.addScaledVector(gS,i.z),a}static isFrontFacing(t,e,n,s){return go.subVectors(n,e),Va.subVectors(t,e),go.cross(Va).dot(s)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,s){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,n,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return go.subVectors(this.c,this.b),Va.subVectors(this.a,this.b),go.cross(Va).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return To.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return To.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,s,i){return To.getInterpolation(t,this.a,this.b,this.c,e,n,s,i)}containsPoint(t){return To.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return To.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,s=this.b,i=this.c;let a,c;Lh.subVectors(s,n),Oh.subVectors(i,n),hS.subVectors(t,n);const u=Lh.dot(hS),d=Oh.dot(hS);if(u<=0&&d<=0)return e.copy(n);dS.subVectors(t,s);const f=Lh.dot(dS),p=Oh.dot(dS);if(f>=0&&p<=f)return e.copy(s);const g=u*p-f*d;if(g<=0&&u>=0&&f<=0)return a=u/(u-f),e.copy(n).addScaledVector(Lh,a);fS.subVectors(t,i);const y=Lh.dot(fS),x=Oh.dot(fS);if(x>=0&&y<=x)return e.copy(i);const S=y*d-u*x;if(S<=0&&d>=0&&x<=0)return c=d/(d-x),e.copy(n).addScaledVector(Oh,c);const T=f*x-y*p;if(T<=0&&p-f>=0&&y-x>=0)return FN.subVectors(i,s),c=(p-f)/(p-f+(y-x)),e.copy(s).addScaledVector(FN,c);const M=1/(T+S+g);return a=S*M,c=g*M,e.copy(n).addScaledVector(Lh,a).addScaledVector(Oh,c)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}class ga{constructor(t=new V(1/0,1/0,1/0),e=new V(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(yo.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(yo.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=yo.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(n!==void 0){const i=n.getAttribute("position");if(e===!0&&i!==void 0&&t.isInstancedMesh!==!0)for(let a=0,c=i.count;a<c;a++)t.isMesh===!0?t.getVertexPosition(a,yo):yo.fromBufferAttribute(i,a),yo.applyMatrix4(t.matrixWorld),this.expandByPoint(yo);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),xm.copy(t.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),xm.copy(n.boundingBox)),xm.applyMatrix4(t.matrixWorld),this.union(xm)}const s=t.children;for(let i=0,a=s.length;i<a;i++)this.expandByObject(s[i],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,yo),yo.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ef),bm.subVectors(this.max,Ef),Fh.subVectors(t.a,Ef),Uh.subVectors(t.b,Ef),Ph.subVectors(t.c,Ef),Wl.subVectors(Uh,Fh),ql.subVectors(Ph,Uh),au.subVectors(Fh,Ph);let e=[0,-Wl.z,Wl.y,0,-ql.z,ql.y,0,-au.z,au.y,Wl.z,0,-Wl.x,ql.z,0,-ql.x,au.z,0,-au.x,-Wl.y,Wl.x,0,-ql.y,ql.x,0,-au.y,au.x,0];return!yS(e,Fh,Uh,Ph,bm)||(e=[1,0,0,0,1,0,0,0,1],!yS(e,Fh,Uh,Ph,bm))?!1:(Sm.crossVectors(Wl,ql),e=[Sm.x,Sm.y,Sm.z],yS(e,Fh,Uh,Ph,bm))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,yo).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(yo).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(ka[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ka[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ka[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ka[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ka[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ka[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ka[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ka[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ka),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}}const ka=[new V,new V,new V,new V,new V,new V,new V,new V],yo=new V,xm=new ga,Fh=new V,Uh=new V,Ph=new V,Wl=new V,ql=new V,au=new V,Ef=new V,bm=new V,Sm=new V,lu=new V;function yS(r,t,e,n,s){for(let i=0,a=r.length-3;i<=a;i+=3){lu.fromArray(r,i);const c=s.x*Math.abs(lu.x)+s.y*Math.abs(lu.y)+s.z*Math.abs(lu.z),u=t.dot(lu),d=e.dot(lu),f=n.dot(lu);if(Math.max(-Math.max(u,d,f),Math.min(u,d,f))>c)return!1}return!0}const Ja=YU();function YU(){const r=new ArrayBuffer(4),t=new Float32Array(r),e=new Uint32Array(r),n=new Uint32Array(512),s=new Uint32Array(512);for(let u=0;u<256;++u){const d=u-127;d<-27?(n[u]=0,n[u|256]=32768,s[u]=24,s[u|256]=24):d<-14?(n[u]=1024>>-d-14,n[u|256]=1024>>-d-14|32768,s[u]=-d-1,s[u|256]=-d-1):d<=15?(n[u]=d+15<<10,n[u|256]=d+15<<10|32768,s[u]=13,s[u|256]=13):d<128?(n[u]=31744,n[u|256]=64512,s[u]=24,s[u|256]=24):(n[u]=31744,n[u|256]=64512,s[u]=13,s[u|256]=13)}const i=new Uint32Array(2048),a=new Uint32Array(64),c=new Uint32Array(64);for(let u=1;u<1024;++u){let d=u<<13,f=0;for(;(d&8388608)===0;)d<<=1,f-=8388608;d&=-8388609,f+=947912704,i[u]=d|f}for(let u=1024;u<2048;++u)i[u]=939524096+(u-1024<<13);for(let u=1;u<31;++u)a[u]=u<<23;a[31]=1199570944,a[32]=2147483648;for(let u=33;u<63;++u)a[u]=2147483648+(u-32<<23);a[63]=3347054592;for(let u=1;u<64;++u)u!==32&&(c[u]=1024);return{floatView:t,uint32View:e,baseTable:n,shiftTable:s,mantissaTable:i,exponentTable:a,offsetTable:c}}function gr(r){Math.abs(r)>65504&&Wt("DataUtils.toHalfFloat(): Value out of range."),r=De(r,-65504,65504),Ja.floatView[0]=r;const t=Ja.uint32View[0],e=t>>23&511;return Ja.baseTable[e]+((t&8388607)>>Ja.shiftTable[e])}function wm(r){const t=r>>10;return Ja.uint32View[0]=Ja.mantissaTable[Ja.offsetTable[t]+(r&1023)]+Ja.exponentTable[t],Ja.floatView[0]}const Ns=new V,Tm=new Ut;let KU=0;class fs{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:KU++}),this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n,this.usage=Td,this.updateRanges=[],this.gpuType=Di,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let s=0,i=this.itemSize;s<i;s++)this.array[t+s]=e.array[n+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,n=this.count;e<n;e++)Tm.fromBufferAttribute(this,e),Tm.applyMatrix3(t),this.setXY(e,Tm.x,Tm.y);else if(this.itemSize===3)for(let e=0,n=this.count;e<n;e++)Ns.fromBufferAttribute(this,e),Ns.applyMatrix3(t),this.setXYZ(e,Ns.x,Ns.y,Ns.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)Ns.fromBufferAttribute(this,e),Ns.applyMatrix4(t),this.setXYZ(e,Ns.x,Ns.y,Ns.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Ns.fromBufferAttribute(this,e),Ns.applyNormalMatrix(t),this.setXYZ(e,Ns.x,Ns.y,Ns.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Ns.fromBufferAttribute(this,e),Ns.transformDirection(t),this.setXYZ(e,Ns.x,Ns.y,Ns.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Bi(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Ne(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Bi(e,this.array)),e}setX(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Bi(e,this.array)),e}setY(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Bi(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Bi(e,this.array)),e}setW(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,s){return t*=this.itemSize,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array),s=Ne(s,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=s,this}setXYZW(t,e,n,s,i){return t*=this.itemSize,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array),s=Ne(s,this.array),i=Ne(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=s,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Td&&(t.usage=this.usage),t}}class eC extends fs{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class nC extends fs{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class sC extends fs{constructor(t,e,n){super(new Uint16Array(t),e,n),this.isFloat16BufferAttribute=!0}getX(t){let e=wm(this.array[t*this.itemSize]);return this.normalized&&(e=Bi(e,this.array)),e}setX(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize]=gr(e),this}getY(t){let e=wm(this.array[t*this.itemSize+1]);return this.normalized&&(e=Bi(e,this.array)),e}setY(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize+1]=gr(e),this}getZ(t){let e=wm(this.array[t*this.itemSize+2]);return this.normalized&&(e=Bi(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize+2]=gr(e),this}getW(t){let e=wm(this.array[t*this.itemSize+3]);return this.normalized&&(e=Bi(e,this.array)),e}setW(t,e){return this.normalized&&(e=Ne(e,this.array)),this.array[t*this.itemSize+3]=gr(e),this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array)),this.array[t+0]=gr(e),this.array[t+1]=gr(n),this}setXYZ(t,e,n,s){return t*=this.itemSize,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array),s=Ne(s,this.array)),this.array[t+0]=gr(e),this.array[t+1]=gr(n),this.array[t+2]=gr(s),this}setXYZW(t,e,n,s,i){return t*=this.itemSize,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array),s=Ne(s,this.array),i=Ne(i,this.array)),this.array[t+0]=gr(e),this.array[t+1]=gr(n),this.array[t+2]=gr(s),this.array[t+3]=gr(i),this}}class ge extends fs{constructor(t,e,n){super(new Float32Array(t),e,n)}}const ZU=new ga,Cf=new V,xS=new V;class Fc{constructor(t=new V,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;e!==void 0?n.copy(e):ZU.setFromPoints(t).getCenter(n);let s=0;for(let i=0,a=t.length;i<a;i++)s=Math.max(s,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Cf.subVectors(t,this.center);const e=Cf.lengthSq();if(e>this.radius*this.radius){const n=Math.sqrt(e),s=(n-this.radius)*.5;this.center.addScaledVector(Cf,s/n),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(xS.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Cf.copy(t.center).add(xS)),this.expandByPoint(Cf.copy(t.center).sub(xS))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}let QU=0;const kr=new ve,bS=new On,zh=new V,yr=new ga,Df=new ga,ks=new V;class Qe extends Oc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:QU++}),this.uuid=ia(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(yU(t)?nC:eC)(t,1):this.index=t,this}setIndirect(t,e=0){return this.indirect=t,this.indirectOffset=e,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const i=new rr().getNormalMatrix(t);n.applyNormalMatrix(i),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return kr.makeRotationFromQuaternion(t),this.applyMatrix4(kr),this}rotateX(t){return kr.makeRotationX(t),this.applyMatrix4(kr),this}rotateY(t){return kr.makeRotationY(t),this.applyMatrix4(kr),this}rotateZ(t){return kr.makeRotationZ(t),this.applyMatrix4(kr),this}translate(t,e,n){return kr.makeTranslation(t,e,n),this.applyMatrix4(kr),this}scale(t,e,n){return kr.makeScale(t,e,n),this.applyMatrix4(kr),this}lookAt(t){return bS.lookAt(t),bS.updateMatrix(),this.applyMatrix4(bS.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(zh).negate(),this.translate(zh.x,zh.y,zh.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const n=[];for(let s=0,i=t.length;s<i;s++){const a=t[s];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new ge(n,3))}else{const n=Math.min(t.length,e.count);for(let s=0;s<n;s++){const i=t[s];e.setXYZ(s,i.x,i.y,i.z||0)}t.length>e.count&&Wt("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ga);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){Ht("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new V(-1/0,-1/0,-1/0),new V(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,s=e.length;n<s;n++){const i=e[n];yr.setFromBufferAttribute(i),this.morphTargetsRelative?(ks.addVectors(this.boundingBox.min,yr.min),this.boundingBox.expandByPoint(ks),ks.addVectors(this.boundingBox.max,yr.max),this.boundingBox.expandByPoint(ks)):(this.boundingBox.expandByPoint(yr.min),this.boundingBox.expandByPoint(yr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Ht('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Fc);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){Ht("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new V,1/0);return}if(t){const n=this.boundingSphere.center;if(yr.setFromBufferAttribute(t),e)for(let i=0,a=e.length;i<a;i++){const c=e[i];Df.setFromBufferAttribute(c),this.morphTargetsRelative?(ks.addVectors(yr.min,Df.min),yr.expandByPoint(ks),ks.addVectors(yr.max,Df.max),yr.expandByPoint(ks)):(yr.expandByPoint(Df.min),yr.expandByPoint(Df.max))}yr.getCenter(n);let s=0;for(let i=0,a=t.count;i<a;i++)ks.fromBufferAttribute(t,i),s=Math.max(s,n.distanceToSquared(ks));if(e)for(let i=0,a=e.length;i<a;i++){const c=e[i],u=this.morphTargetsRelative;for(let d=0,f=c.count;d<f;d++)ks.fromBufferAttribute(c,d),u&&(zh.fromBufferAttribute(t,d),ks.add(zh)),s=Math.max(s,n.distanceToSquared(ks))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&Ht('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){Ht("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.position,s=e.normal,i=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new fs(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),c=[],u=[];for(let U=0;U<n.count;U++)c[U]=new V,u[U]=new V;const d=new V,f=new V,p=new V,g=new Ut,y=new Ut,x=new Ut,S=new V,T=new V;function M(U,B,P){d.fromBufferAttribute(n,U),f.fromBufferAttribute(n,B),p.fromBufferAttribute(n,P),g.fromBufferAttribute(i,U),y.fromBufferAttribute(i,B),x.fromBufferAttribute(i,P),f.sub(d),p.sub(d),y.sub(g),x.sub(g);const J=1/(y.x*x.y-x.x*y.y);isFinite(J)&&(S.copy(f).multiplyScalar(x.y).addScaledVector(p,-y.y).multiplyScalar(J),T.copy(p).multiplyScalar(y.x).addScaledVector(f,-x.x).multiplyScalar(J),c[U].add(S),c[B].add(S),c[P].add(S),u[U].add(T),u[B].add(T),u[P].add(T))}let N=this.groups;N.length===0&&(N=[{start:0,count:t.count}]);for(let U=0,B=N.length;U<B;++U){const P=N[U],J=P.start,q=P.count;for(let ft=J,Mt=J+q;ft<Mt;ft+=3)M(t.getX(ft+0),t.getX(ft+1),t.getX(ft+2))}const v=new V,A=new V,R=new V,L=new V;function D(U){R.fromBufferAttribute(s,U),L.copy(R);const B=c[U];v.copy(B),v.sub(R.multiplyScalar(R.dot(B))).normalize(),A.crossVectors(L,B);const J=A.dot(u[U])<0?-1:1;a.setXYZW(U,v.x,v.y,v.z,J)}for(let U=0,B=N.length;U<B;++U){const P=N[U],J=P.start,q=P.count;for(let ft=J,Mt=J+q;ft<Mt;ft+=3)D(t.getX(ft+0)),D(t.getX(ft+1)),D(t.getX(ft+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new fs(new Float32Array(e.count*3),3),this.setAttribute("normal",n);else for(let g=0,y=n.count;g<y;g++)n.setXYZ(g,0,0,0);const s=new V,i=new V,a=new V,c=new V,u=new V,d=new V,f=new V,p=new V;if(t)for(let g=0,y=t.count;g<y;g+=3){const x=t.getX(g+0),S=t.getX(g+1),T=t.getX(g+2);s.fromBufferAttribute(e,x),i.fromBufferAttribute(e,S),a.fromBufferAttribute(e,T),f.subVectors(a,i),p.subVectors(s,i),f.cross(p),c.fromBufferAttribute(n,x),u.fromBufferAttribute(n,S),d.fromBufferAttribute(n,T),c.add(f),u.add(f),d.add(f),n.setXYZ(x,c.x,c.y,c.z),n.setXYZ(S,u.x,u.y,u.z),n.setXYZ(T,d.x,d.y,d.z)}else for(let g=0,y=e.count;g<y;g+=3)s.fromBufferAttribute(e,g+0),i.fromBufferAttribute(e,g+1),a.fromBufferAttribute(e,g+2),f.subVectors(a,i),p.subVectors(s,i),f.cross(p),n.setXYZ(g+0,f.x,f.y,f.z),n.setXYZ(g+1,f.x,f.y,f.z),n.setXYZ(g+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)ks.fromBufferAttribute(t,e),ks.normalize(),t.setXYZ(e,ks.x,ks.y,ks.z)}toNonIndexed(){function t(c,u){const d=c.array,f=c.itemSize,p=c.normalized,g=new d.constructor(u.length*f);let y=0,x=0;for(let S=0,T=u.length;S<T;S++){c.isInterleavedBufferAttribute?y=u[S]*c.data.stride+c.offset:y=u[S]*f;for(let M=0;M<f;M++)g[x++]=d[y++]}return new fs(g,f,p)}if(this.index===null)return Wt("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Qe,n=this.index.array,s=this.attributes;for(const c in s){const u=s[c],d=t(u,n);e.setAttribute(c,d)}const i=this.morphAttributes;for(const c in i){const u=[],d=i[c];for(let f=0,p=d.length;f<p;f++){const g=d[f],y=t(g,n);u.push(y)}e.morphAttributes[c]=u}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let c=0,u=a.length;c<u;c++){const d=a[c];e.addGroup(d.start,d.count,d.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const u=this.parameters;for(const d in u)u[d]!==void 0&&(t[d]=u[d]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const u in n){const d=n[u];t.data.attributes[u]=d.toJSON(t.data)}const s={};let i=!1;for(const u in this.morphAttributes){const d=this.morphAttributes[u],f=[];for(let p=0,g=d.length;p<g;p++){const y=d[p];f.push(y.toJSON(t.data))}f.length>0&&(s[u]=f,i=!0)}i&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const c=this.boundingSphere;return c!==null&&(t.data.boundingSphere=c.toJSON()),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;n!==null&&this.setIndex(n.clone());const s=t.attributes;for(const d in s){const f=s[d];this.setAttribute(d,f.clone(e))}const i=t.morphAttributes;for(const d in i){const f=[],p=i[d];for(let g=0,y=p.length;g<y;g++)f.push(p[g].clone(e));this.morphAttributes[d]=f}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let d=0,f=a.length;d<f;d++){const p=a[d];this.addGroup(p.start,p.count,p.materialIndex)}const c=t.boundingBox;c!==null&&(this.boundingBox=c.clone());const u=t.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}class iC{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Td,this.updateRanges=[],this.version=0,this.uuid=ia()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let s=0,i=this.stride;s<i;s++)this.array[t+s]=e.array[n+s];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ia()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ia()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ni=new V;class Lw{constructor(t,e,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Ni.fromBufferAttribute(this,e),Ni.applyMatrix4(t),this.setXYZ(e,Ni.x,Ni.y,Ni.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Ni.fromBufferAttribute(this,e),Ni.applyNormalMatrix(t),this.setXYZ(e,Ni.x,Ni.y,Ni.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Ni.fromBufferAttribute(this,e),Ni.transformDirection(t),this.setXYZ(e,Ni.x,Ni.y,Ni.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=Bi(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=Ne(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=Ne(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Ne(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Ne(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Ne(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Bi(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Bi(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Bi(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Bi(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array),s=Ne(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=s,this}setXYZW(t,e,n,s,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Ne(e,this.array),n=Ne(n,this.array),s=Ne(s,this.array),i=Ne(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=s,this.data.array[t+3]=i,this}clone(t){if(t===void 0){z2("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)e.push(this.data.array[s+i])}return new fs(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Lw(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){z2("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)e.push(this.data.array[s+i])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}let JU=0;class Ar extends Oc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:JU++}),this.uuid=ia(),this.name="",this.type="Material",this.blending=mi,this.side=na,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Rp,this.blendDst=Ep,this.blendEquation=Xr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Xt(0,0,0),this.blendAlpha=0,this.depthFunc=bd,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=P2,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Mu,this.stencilZFail=Mu,this.stencilZPass=Mu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const n=t[e];if(n===void 0){Wt(`Material: parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){Wt(`Material: '${e}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[e]=n}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(t).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(t).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==mi&&(n.blending=this.blending),this.side!==na&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==Rp&&(n.blendSrc=this.blendSrc),this.blendDst!==Ep&&(n.blendDst=this.blendDst),this.blendEquation!==Xr&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==bd&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==P2&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Mu&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Mu&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Mu&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.allowOverride===!1&&(n.allowOverride=!1),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(i){const a=[];for(const c in i){const u=i[c];delete u.metadata,a.push(u)}return a}if(e){const i=s(t.textures),a=s(t.images);i.length>0&&(n.textures=i),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(e!==null){const s=e.length;n=new Array(s);for(let i=0;i!==s;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.allowOverride=t.allowOverride,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class t8 extends Ar{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new Xt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Ha=new V,SS=new V,_m=new V,$l=new V,wS=new V,Mm=new V,TS=new V;class rC{constructor(t=new V,e=new V(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Ha)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Ha.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Ha.copy(this.origin).addScaledVector(this.direction,e),Ha.distanceToSquared(t))}distanceSqToSegment(t,e,n,s){SS.copy(t).add(e).multiplyScalar(.5),_m.copy(e).sub(t).normalize(),$l.copy(this.origin).sub(SS);const i=t.distanceTo(e)*.5,a=-this.direction.dot(_m),c=$l.dot(this.direction),u=-$l.dot(_m),d=$l.lengthSq(),f=Math.abs(1-a*a);let p,g,y,x;if(f>0)if(p=a*u-c,g=a*c-u,x=i*f,p>=0)if(g>=-x)if(g<=x){const S=1/f;p*=S,g*=S,y=p*(p+a*g+2*c)+g*(a*p+g+2*u)+d}else g=i,p=Math.max(0,-(a*g+c)),y=-p*p+g*(g+2*u)+d;else g=-i,p=Math.max(0,-(a*g+c)),y=-p*p+g*(g+2*u)+d;else g<=-x?(p=Math.max(0,-(-a*i+c)),g=p>0?-i:Math.min(Math.max(-i,-u),i),y=-p*p+g*(g+2*u)+d):g<=x?(p=0,g=Math.min(Math.max(-i,-u),i),y=g*(g+2*u)+d):(p=Math.max(0,-(a*i+c)),g=p>0?i:Math.min(Math.max(-i,-u),i),y=-p*p+g*(g+2*u)+d);else g=a>0?-i:i,p=Math.max(0,-(a*g+c)),y=-p*p+g*(g+2*u)+d;return n&&n.copy(this.origin).addScaledVector(this.direction,p),s&&s.copy(SS).addScaledVector(_m,g),y}intersectSphere(t,e){Ha.subVectors(t.center,this.origin);const n=Ha.dot(this.direction),s=Ha.dot(Ha)-n*n,i=t.radius*t.radius;if(s>i)return null;const a=Math.sqrt(i-s),c=n-a,u=n+a;return u<0?null:c<0?this.at(u,e):this.at(c,e)}intersectsSphere(t){return t.radius<0?!1:this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return n===null?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,s,i,a,c,u;const d=1/this.direction.x,f=1/this.direction.y,p=1/this.direction.z,g=this.origin;return d>=0?(n=(t.min.x-g.x)*d,s=(t.max.x-g.x)*d):(n=(t.max.x-g.x)*d,s=(t.min.x-g.x)*d),f>=0?(i=(t.min.y-g.y)*f,a=(t.max.y-g.y)*f):(i=(t.max.y-g.y)*f,a=(t.min.y-g.y)*f),n>a||i>s||((i>n||isNaN(n))&&(n=i),(a<s||isNaN(s))&&(s=a),p>=0?(c=(t.min.z-g.z)*p,u=(t.max.z-g.z)*p):(c=(t.max.z-g.z)*p,u=(t.min.z-g.z)*p),n>u||c>s)||((c>n||n!==n)&&(n=c),(u<s||s!==s)&&(s=u),s<0)?null:this.at(n>=0?n:s,e)}intersectsBox(t){return this.intersectBox(t,Ha)!==null}intersectTriangle(t,e,n,s,i){wS.subVectors(e,t),Mm.subVectors(n,t),TS.crossVectors(wS,Mm);let a=this.direction.dot(TS),c;if(a>0){if(s)return null;c=1}else if(a<0)c=-1,a=-a;else return null;$l.subVectors(this.origin,t);const u=c*this.direction.dot(Mm.crossVectors($l,Mm));if(u<0)return null;const d=c*this.direction.dot(wS.cross($l));if(d<0||u+d>a)return null;const f=-c*$l.dot(TS);return f<0?null:this.at(f/a,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class xn extends Ar{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Xt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new tr,this.combine=Qy,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const UN=new ve,cu=new rC,vm=new Fc,PN=new V,Am=new V,Nm=new V,Rm=new V,_S=new V,Em=new V,zN=new V,Cm=new V;class C extends On{constructor(t=new Qe,e=new xn){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const s=e[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,a=s.length;i<a;i++){const c=s[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=i}}}}getVertexPosition(t,e){const n=this.geometry,s=n.attributes.position,i=n.morphAttributes.position,a=n.morphTargetsRelative;e.fromBufferAttribute(s,t);const c=this.morphTargetInfluences;if(i&&c){Em.set(0,0,0);for(let u=0,d=i.length;u<d;u++){const f=c[u],p=i[u];f!==0&&(_S.fromBufferAttribute(p,t),a?Em.addScaledVector(_S,f):Em.addScaledVector(_S.sub(e),f))}e.add(Em)}return e}raycast(t,e){const n=this.geometry,s=this.material,i=this.matrixWorld;s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),vm.copy(n.boundingSphere),vm.applyMatrix4(i),cu.copy(t.ray).recast(t.near),!(vm.containsPoint(cu.origin)===!1&&(cu.intersectSphere(vm,PN)===null||cu.origin.distanceToSquared(PN)>(t.far-t.near)**2))&&(UN.copy(i).invert(),cu.copy(t.ray).applyMatrix4(UN),!(n.boundingBox!==null&&cu.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(t,e,cu)))}_computeIntersections(t,e,n){let s;const i=this.geometry,a=this.material,c=i.index,u=i.attributes.position,d=i.attributes.uv,f=i.attributes.uv1,p=i.attributes.normal,g=i.groups,y=i.drawRange;if(c!==null)if(Array.isArray(a))for(let x=0,S=g.length;x<S;x++){const T=g[x],M=a[T.materialIndex],N=Math.max(T.start,y.start),v=Math.min(c.count,Math.min(T.start+T.count,y.start+y.count));for(let A=N,R=v;A<R;A+=3){const L=c.getX(A),D=c.getX(A+1),U=c.getX(A+2);s=Dm(this,M,t,n,d,f,p,L,D,U),s&&(s.faceIndex=Math.floor(A/3),s.face.materialIndex=T.materialIndex,e.push(s))}}else{const x=Math.max(0,y.start),S=Math.min(c.count,y.start+y.count);for(let T=x,M=S;T<M;T+=3){const N=c.getX(T),v=c.getX(T+1),A=c.getX(T+2);s=Dm(this,a,t,n,d,f,p,N,v,A),s&&(s.faceIndex=Math.floor(T/3),e.push(s))}}else if(u!==void 0)if(Array.isArray(a))for(let x=0,S=g.length;x<S;x++){const T=g[x],M=a[T.materialIndex],N=Math.max(T.start,y.start),v=Math.min(u.count,Math.min(T.start+T.count,y.start+y.count));for(let A=N,R=v;A<R;A+=3){const L=A,D=A+1,U=A+2;s=Dm(this,M,t,n,d,f,p,L,D,U),s&&(s.faceIndex=Math.floor(A/3),s.face.materialIndex=T.materialIndex,e.push(s))}}else{const x=Math.max(0,y.start),S=Math.min(u.count,y.start+y.count);for(let T=x,M=S;T<M;T+=3){const N=T,v=T+1,A=T+2;s=Dm(this,a,t,n,d,f,p,N,v,A),s&&(s.faceIndex=Math.floor(T/3),e.push(s))}}}}function e8(r,t,e,n,s,i,a,c){let u;if(t.side===Ss?u=n.intersectTriangle(a,i,s,!0,c):u=n.intersectTriangle(s,i,a,t.side===na,c),u===null)return null;Cm.copy(c),Cm.applyMatrix4(r.matrixWorld);const d=e.ray.origin.distanceTo(Cm);return d<e.near||d>e.far?null:{distance:d,point:Cm.clone(),object:r}}function Dm(r,t,e,n,s,i,a,c,u,d){r.getVertexPosition(c,Am),r.getVertexPosition(u,Nm),r.getVertexPosition(d,Rm);const f=e8(r,t,e,n,Am,Nm,Rm,zN);if(f){const p=new V;To.getBarycoord(zN,Am,Nm,Rm,p),s&&(f.uv=To.getInterpolatedAttribute(s,c,u,d,p,new Ut)),i&&(f.uv1=To.getInterpolatedAttribute(i,c,u,d,p,new Ut)),a&&(f.normal=To.getInterpolatedAttribute(a,c,u,d,p,new V),f.normal.dot(n.direction)>0&&f.normal.multiplyScalar(-1));const g={a:c,b:u,c:d,normal:new V,materialIndex:0};To.getNormal(Am,Nm,Rm,g.normal),f.face=g,f.barycoord=p}return f}class ox extends is{constructor(t=null,e=1,n=1,s,i,a,c,u,d=ts,f=ts,p,g){super(null,a,c,u,d,f,s,i,p,g),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Mc extends fs{constructor(t,e,n,s=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Ih=new ve,IN=new ve,Bm=[],VN=new ga,n8=new ve,Bf=new C,Lf=new Fc;class yc extends C{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Mc(new Float32Array(n*16),16),this.previousInstanceMatrix=null,this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<n;s++)this.setMatrixAt(s,n8)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new ga),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Ih),VN.copy(t.boundingBox).applyMatrix4(Ih),this.boundingBox.union(VN)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Fc),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Ih),Lf.copy(t.boundingSphere).applyMatrix4(Ih),this.boundingSphere.union(Lf)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.previousInstanceMatrix!==null&&(this.previousInstanceMatrix=t.previousInstanceMatrix.clone()),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,e){const n=e.morphTargetInfluences,s=this.morphTexture.source.data.data,i=n.length+1,a=t*i+1;for(let c=0;c<n.length;c++)n[c]=s[a+c]}raycast(t,e){const n=this.matrixWorld,s=this.count;if(Bf.geometry=this.geometry,Bf.material=this.material,Bf.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Lf.copy(this.boundingSphere),Lf.applyMatrix4(n),t.ray.intersectsSphere(Lf)!==!1))for(let i=0;i<s;i++){this.getMatrixAt(i,Ih),IN.multiplyMatrices(n,Ih),Bf.matrixWorld=IN,Bf.raycast(t,Bm);for(let a=0,c=Bm.length;a<c;a++){const u=Bm[a];u.instanceId=i,u.object=this,e.push(u)}Bm.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new Mc(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,e){const n=e.morphTargetInfluences,s=n.length+1;this.morphTexture===null&&(this.morphTexture=new ox(new Float32Array(s*this.count),s,this.count,Wp,Di));const i=this.morphTexture.source.data.data;let a=0;for(let d=0;d<n.length;d++)a+=n[d];const c=this.geometry.morphTargetsRelative?1:1-a,u=s*t;i[u]=c,i.set(n,u+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const MS=new V,s8=new V,i8=new rr;class cc{constructor(t=new V(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,s){return this.normal.set(t,e,n),this.constant=s,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const s=MS.subVectors(n,e).cross(s8.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(MS),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const i=-(t.start.dot(this.normal)+this.constant)/s;return i<0||i>1?null:e.copy(t.start).addScaledVector(n,i)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||i8.getNormalMatrix(t),s=this.coplanarPoint(MS).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const uu=new Fc,r8=new Ut(.5,.5),Lm=new V;class ax{constructor(t=new cc,e=new cc,n=new cc,s=new cc,i=new cc,a=new cc){this.planes=[t,e,n,s,i,a]}set(t,e,n,s,i,a){const c=this.planes;return c[0].copy(t),c[1].copy(e),c[2].copy(n),c[3].copy(s),c[4].copy(i),c[5].copy(a),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=_r,n=!1){const s=this.planes,i=t.elements,a=i[0],c=i[1],u=i[2],d=i[3],f=i[4],p=i[5],g=i[6],y=i[7],x=i[8],S=i[9],T=i[10],M=i[11],N=i[12],v=i[13],A=i[14],R=i[15];if(s[0].setComponents(d-a,y-f,M-x,R-N).normalize(),s[1].setComponents(d+a,y+f,M+x,R+N).normalize(),s[2].setComponents(d+c,y+p,M+S,R+v).normalize(),s[3].setComponents(d-c,y-p,M-S,R-v).normalize(),n)s[4].setComponents(u,g,T,A).normalize(),s[5].setComponents(d-u,y-g,M-T,R-A).normalize();else if(s[4].setComponents(d-u,y-g,M-T,R-A).normalize(),e===_r)s[5].setComponents(d+u,y+g,M+T,R+A).normalize();else if(e===Jr)s[5].setComponents(u,g,T,A).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),uu.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),uu.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(uu)}intersectsSprite(t){uu.center.set(0,0,0);const e=r8.distanceTo(t.center);return uu.radius=.7071067811865476+e,uu.applyMatrix4(t.matrixWorld),this.intersectsSphere(uu)}intersectsSphere(t){const e=this.planes,n=t.center,s=-t.radius;for(let i=0;i<6;i++)if(e[i].distanceToPoint(n)<s)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const s=e[n];if(Lm.x=s.normal.x>0?t.max.x:t.min.x,Lm.y=s.normal.y>0?t.max.y:t.min.y,Lm.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(Lm)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const Po=new ve,zo=new ax;class Ow{constructor(){this.coordinateSystem=_r}intersectsObject(t,e){if(!e.isArrayCamera||e.cameras.length===0)return!1;for(let n=0;n<e.cameras.length;n++){const s=e.cameras[n];if(Po.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),zo.setFromProjectionMatrix(Po,s.coordinateSystem,s.reversedDepth),zo.intersectsObject(t))return!0}return!1}intersectsSprite(t,e){if(!e||!e.cameras||e.cameras.length===0)return!1;for(let n=0;n<e.cameras.length;n++){const s=e.cameras[n];if(Po.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),zo.setFromProjectionMatrix(Po,s.coordinateSystem,s.reversedDepth),zo.intersectsSprite(t))return!0}return!1}intersectsSphere(t,e){if(!e||!e.cameras||e.cameras.length===0)return!1;for(let n=0;n<e.cameras.length;n++){const s=e.cameras[n];if(Po.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),zo.setFromProjectionMatrix(Po,s.coordinateSystem,s.reversedDepth),zo.intersectsSphere(t))return!0}return!1}intersectsBox(t,e){if(!e||!e.cameras||e.cameras.length===0)return!1;for(let n=0;n<e.cameras.length;n++){const s=e.cameras[n];if(Po.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),zo.setFromProjectionMatrix(Po,s.coordinateSystem,s.reversedDepth),zo.intersectsBox(t))return!0}return!1}containsPoint(t,e){if(!e||!e.cameras||e.cameras.length===0)return!1;for(let n=0;n<e.cameras.length;n++){const s=e.cameras[n];if(Po.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),zo.setFromProjectionMatrix(Po,s.coordinateSystem,s.reversedDepth),zo.containsPoint(t))return!0}return!1}clone(){return new Ow}}class oC extends Ar{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Xt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}class er extends Ar{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new Xt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const GN=new ve,I2=new rC,Om=new Fc,Fm=new V;class to extends On{constructor(t=new Qe,e=new er){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,s=this.matrixWorld,i=t.params.Points.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Om.copy(n.boundingSphere),Om.applyMatrix4(s),Om.radius+=i,t.ray.intersectsSphere(Om)===!1)return;GN.copy(s).invert(),I2.copy(t.ray).applyMatrix4(GN);const c=i/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,d=n.index,p=n.attributes.position;if(d!==null){const g=Math.max(0,a.start),y=Math.min(d.count,a.start+a.count);for(let x=g,S=y;x<S;x++){const T=d.getX(x);Fm.fromBufferAttribute(p,T),kN(Fm,T,u,s,t,e,this)}}else{const g=Math.max(0,a.start),y=Math.min(p.count,a.start+a.count);for(let x=g,S=y;x<S;x++)Fm.fromBufferAttribute(p,x),kN(Fm,x,u,s,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const s=e[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,a=s.length;i<a;i++){const c=s[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=i}}}}}function kN(r,t,e,n,s,i,a){const c=I2.distanceSqToPoint(r);if(c<e){const u=new V;I2.closestPointToPoint(r,u),u.applyMatrix4(n);const d=s.ray.origin.distanceTo(u);if(d<s.near||d>s.far)return;i.push({distance:d,distanceToRay:Math.sqrt(c),point:u,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}class Fw extends is{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=ts,this.minFilter=ts,this.generateMipmaps=!1,this.needsUpdate=!0}}class lx extends is{constructor(t=[],e=Sd,n,s,i,a,c,u,d,f){super(t,e,n,s,i,a,c,u,d,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Ti extends is{constructor(t,e,n,s,i,a,c,u,d){super(t,e,n,s,i,a,c,u,d),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Zr extends is{constructor(t,e,n=Jn,s,i,a,c=ts,u=ts,d,f=Mo,p=1){if(f!==Mo&&f!==ol)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const g={width:t,height:e,depth:p};super(g,s,i,a,c,u,f,n,d),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new Dw(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}class o8 extends Zr{constructor(t,e=Jn,n=Sd,s,i,a=ts,c=ts,u,d=Mo){const f={width:t,height:t,depth:1},p=[f,f,f,f,f,f];super(t,t,e,n,s,i,a,c,u,d),this.image=p,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(t){this.image=t}}class X extends Qe{constructor(t=1,e=1,n=1,s=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:s,heightSegments:i,depthSegments:a};const c=this;s=Math.floor(s),i=Math.floor(i),a=Math.floor(a);const u=[],d=[],f=[],p=[];let g=0,y=0;x("z","y","x",-1,-1,n,e,t,a,i,0),x("z","y","x",1,-1,n,e,-t,a,i,1),x("x","z","y",1,1,t,n,e,s,a,2),x("x","z","y",1,-1,t,n,-e,s,a,3),x("x","y","z",1,-1,t,e,n,s,i,4),x("x","y","z",-1,-1,t,e,-n,s,i,5),this.setIndex(u),this.setAttribute("position",new ge(d,3)),this.setAttribute("normal",new ge(f,3)),this.setAttribute("uv",new ge(p,2));function x(S,T,M,N,v,A,R,L,D,U,B){const P=A/D,J=R/U,q=A/2,ft=R/2,Mt=L/2,mt=D+1,F=U+1;let Y=0,tt=0;const lt=new V;for(let Tt=0;Tt<F;Tt++){const O=Tt*J-ft;for(let et=0;et<mt;et++){const z=et*P-q;lt[S]=z*N,lt[T]=O*v,lt[M]=Mt,d.push(lt.x,lt.y,lt.z),lt[S]=0,lt[T]=0,lt[M]=L>0?1:-1,f.push(lt.x,lt.y,lt.z),p.push(et/D),p.push(1-Tt/U),Y+=1}}for(let Tt=0;Tt<U;Tt++)for(let O=0;O<D;O++){const et=g+O+mt*Tt,z=g+O+mt*(Tt+1),W=g+(O+1)+mt*(Tt+1),yt=g+(O+1)+mt*Tt;u.push(et,z,yt),u.push(z,W,yt),tt+=6}c.addGroup(y,tt,B),y+=tt,g+=Y}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new X(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}class Ou extends Qe{constructor(t=1,e=1,n=4,s=8,i=1){super(),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:n,radialSegments:s,heightSegments:i},e=Math.max(0,e),n=Math.max(1,Math.floor(n)),s=Math.max(3,Math.floor(s)),i=Math.max(1,Math.floor(i));const a=[],c=[],u=[],d=[],f=e/2,p=Math.PI/2*t,g=e,y=2*p+g,x=n*2+i,S=s+1,T=new V,M=new V;for(let N=0;N<=x;N++){let v=0,A=0,R=0,L=0;if(N<=n){const B=N/n,P=B*Math.PI/2;A=-f-t*Math.cos(P),R=t*Math.sin(P),L=-t*Math.cos(P),v=B*p}else if(N<=n+i){const B=(N-n)/i;A=-f+B*e,R=t,L=0,v=p+B*g}else{const B=(N-n-i)/n,P=B*Math.PI/2;A=f+t*Math.sin(P),R=t*Math.cos(P),L=t*Math.sin(P),v=p+g+B*p}const D=Math.max(0,Math.min(1,v/y));let U=0;N===0?U=.5/s:N===x&&(U=-.5/s);for(let B=0;B<=s;B++){const P=B/s,J=P*Math.PI*2,q=Math.sin(J),ft=Math.cos(J);M.x=-R*ft,M.y=A,M.z=R*q,c.push(M.x,M.y,M.z),T.set(-R*ft,L,R*q),T.normalize(),u.push(T.x,T.y,T.z),d.push(P+U,D)}if(N>0){const B=(N-1)*S;for(let P=0;P<s;P++){const J=B+P,q=B+P+1,ft=N*S+P,Mt=N*S+P+1;a.push(J,q,ft),a.push(q,Mt,ft)}}}this.setIndex(a),this.setAttribute("position",new ge(c,3)),this.setAttribute("normal",new ge(u,3)),this.setAttribute("uv",new ge(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ou(t.radius,t.height,t.capSegments,t.radialSegments,t.heightSegments)}}class Wr extends Qe{constructor(t=1,e=32,n=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:s},e=Math.max(3,e);const i=[],a=[],c=[],u=[],d=new V,f=new Ut;a.push(0,0,0),c.push(0,0,1),u.push(.5,.5);for(let p=0,g=3;p<=e;p++,g+=3){const y=n+p/e*s;d.x=t*Math.cos(y),d.y=t*Math.sin(y),a.push(d.x,d.y,d.z),c.push(0,0,1),f.x=(a[g]/t+1)/2,f.y=(a[g+1]/t+1)/2,u.push(f.x,f.y)}for(let p=1;p<=e;p++)i.push(p,p+1,0);this.setIndex(i),this.setAttribute("position",new ge(a,3)),this.setAttribute("normal",new ge(c,3)),this.setAttribute("uv",new ge(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Wr(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class qt extends Qe{constructor(t=1,e=1,n=1,s=32,i=1,a=!1,c=0,u=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:s,heightSegments:i,openEnded:a,thetaStart:c,thetaLength:u};const d=this;s=Math.floor(s),i=Math.floor(i);const f=[],p=[],g=[],y=[];let x=0;const S=[],T=n/2;let M=0;N(),a===!1&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(f),this.setAttribute("position",new ge(p,3)),this.setAttribute("normal",new ge(g,3)),this.setAttribute("uv",new ge(y,2));function N(){const A=new V,R=new V;let L=0;const D=(e-t)/n;for(let U=0;U<=i;U++){const B=[],P=U/i,J=P*(e-t)+t;for(let q=0;q<=s;q++){const ft=q/s,Mt=ft*u+c,mt=Math.sin(Mt),F=Math.cos(Mt);R.x=J*mt,R.y=-P*n+T,R.z=J*F,p.push(R.x,R.y,R.z),A.set(mt,D,F).normalize(),g.push(A.x,A.y,A.z),y.push(ft,1-P),B.push(x++)}S.push(B)}for(let U=0;U<s;U++)for(let B=0;B<i;B++){const P=S[B][U],J=S[B+1][U],q=S[B+1][U+1],ft=S[B][U+1];(t>0||B!==0)&&(f.push(P,J,ft),L+=3),(e>0||B!==i-1)&&(f.push(J,q,ft),L+=3)}d.addGroup(M,L,0),M+=L}function v(A){const R=x,L=new Ut,D=new V;let U=0;const B=A===!0?t:e,P=A===!0?1:-1;for(let q=1;q<=s;q++)p.push(0,T*P,0),g.push(0,P,0),y.push(.5,.5),x++;const J=x;for(let q=0;q<=s;q++){const Mt=q/s*u+c,mt=Math.cos(Mt),F=Math.sin(Mt);D.x=B*F,D.y=T*P,D.z=B*mt,p.push(D.x,D.y,D.z),g.push(0,P,0),L.x=mt*.5+.5,L.y=F*.5*P+.5,y.push(L.x,L.y),x++}for(let q=0;q<s;q++){const ft=R+q,Mt=J+q;A===!0?f.push(Mt,Mt+1,ft):f.push(Mt+1,Mt,ft),U+=3}d.addGroup(M,U,A===!0?1:2),M+=U}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new qt(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class gi extends qt{constructor(t=1,e=1,n=32,s=1,i=!1,a=0,c=Math.PI*2){super(0,t,e,n,s,i,a,c),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:s,openEnded:i,thetaStart:a,thetaLength:c}}static fromJSON(t){return new gi(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Uw extends Qe{constructor(t=[],e=[],n=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:s};const i=[],a=[];c(s),d(n),f(),this.setAttribute("position",new ge(i,3)),this.setAttribute("normal",new ge(i.slice(),3)),this.setAttribute("uv",new ge(a,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function c(N){const v=new V,A=new V,R=new V;for(let L=0;L<e.length;L+=3)y(e[L+0],v),y(e[L+1],A),y(e[L+2],R),u(v,A,R,N)}function u(N,v,A,R){const L=R+1,D=[];for(let U=0;U<=L;U++){D[U]=[];const B=N.clone().lerp(A,U/L),P=v.clone().lerp(A,U/L),J=L-U;for(let q=0;q<=J;q++)q===0&&U===L?D[U][q]=B:D[U][q]=B.clone().lerp(P,q/J)}for(let U=0;U<L;U++)for(let B=0;B<2*(L-U)-1;B++){const P=Math.floor(B/2);B%2===0?(g(D[U][P+1]),g(D[U+1][P]),g(D[U][P])):(g(D[U][P+1]),g(D[U+1][P+1]),g(D[U+1][P]))}}function d(N){const v=new V;for(let A=0;A<i.length;A+=3)v.x=i[A+0],v.y=i[A+1],v.z=i[A+2],v.normalize().multiplyScalar(N),i[A+0]=v.x,i[A+1]=v.y,i[A+2]=v.z}function f(){const N=new V;for(let v=0;v<i.length;v+=3){N.x=i[v+0],N.y=i[v+1],N.z=i[v+2];const A=T(N)/2/Math.PI+.5,R=M(N)/Math.PI+.5;a.push(A,1-R)}x(),p()}function p(){for(let N=0;N<a.length;N+=6){const v=a[N+0],A=a[N+2],R=a[N+4],L=Math.max(v,A,R),D=Math.min(v,A,R);L>.9&&D<.1&&(v<.2&&(a[N+0]+=1),A<.2&&(a[N+2]+=1),R<.2&&(a[N+4]+=1))}}function g(N){i.push(N.x,N.y,N.z)}function y(N,v){const A=N*3;v.x=t[A+0],v.y=t[A+1],v.z=t[A+2]}function x(){const N=new V,v=new V,A=new V,R=new V,L=new Ut,D=new Ut,U=new Ut;for(let B=0,P=0;B<i.length;B+=9,P+=6){N.set(i[B+0],i[B+1],i[B+2]),v.set(i[B+3],i[B+4],i[B+5]),A.set(i[B+6],i[B+7],i[B+8]),L.set(a[P+0],a[P+1]),D.set(a[P+2],a[P+3]),U.set(a[P+4],a[P+5]),R.copy(N).add(v).add(A).divideScalar(3);const J=T(R);S(L,P+0,N,J),S(D,P+2,v,J),S(U,P+4,A,J)}}function S(N,v,A,R){R<0&&N.x===1&&(a[v]=N.x-1),A.x===0&&A.z===0&&(a[v]=R/2/Math.PI+.5)}function T(N){return Math.atan2(N.z,-N.x)}function M(N){return Math.atan2(-N.y,Math.sqrt(N.x*N.x+N.z*N.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Uw(t.vertices,t.indices,t.radius,t.detail)}}class ya{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){Wt("Curve: .getPoint() not implemented.")}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,s=this.getPoint(0),i=0;e.push(0);for(let a=1;a<=t;a++)n=this.getPoint(a/t),i+=n.distanceTo(s),e.push(i),s=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e=null){const n=this.getLengths();let s=0;const i=n.length;let a;e?a=e:a=t*n[i-1];let c=0,u=i-1,d;for(;c<=u;)if(s=Math.floor(c+(u-c)/2),d=n[s]-a,d<0)c=s+1;else if(d>0)u=s-1;else{u=s;break}if(s=u,n[s]===a)return s/(i-1);const f=n[s],g=n[s+1]-f,y=(a-f)/g;return(s+y)/(i-1)}getTangent(t,e){let s=t-1e-4,i=t+1e-4;s<0&&(s=0),i>1&&(i=1);const a=this.getPoint(s),c=this.getPoint(i),u=e||(a.isVector2?new Ut:new V);return u.copy(c).sub(a).normalize(),u}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e=!1){const n=new V,s=[],i=[],a=[],c=new V,u=new ve;for(let y=0;y<=t;y++){const x=y/t;s[y]=this.getTangentAt(x,new V)}i[0]=new V,a[0]=new V;let d=Number.MAX_VALUE;const f=Math.abs(s[0].x),p=Math.abs(s[0].y),g=Math.abs(s[0].z);f<=d&&(d=f,n.set(1,0,0)),p<=d&&(d=p,n.set(0,1,0)),g<=d&&n.set(0,0,1),c.crossVectors(s[0],n).normalize(),i[0].crossVectors(s[0],c),a[0].crossVectors(s[0],i[0]);for(let y=1;y<=t;y++){if(i[y]=i[y-1].clone(),a[y]=a[y-1].clone(),c.crossVectors(s[y-1],s[y]),c.length()>Number.EPSILON){c.normalize();const x=Math.acos(De(s[y-1].dot(s[y]),-1,1));i[y].applyMatrix4(u.makeRotationAxis(c,x))}a[y].crossVectors(s[y],i[y])}if(e===!0){let y=Math.acos(De(i[0].dot(i[t]),-1,1));y/=t,s[0].dot(c.crossVectors(i[0],i[t]))>0&&(y=-y);for(let x=1;x<=t;x++)i[x].applyMatrix4(u.makeRotationAxis(s[x],y*x)),a[x].crossVectors(s[x],i[x])}return{tangents:s,normals:i,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Pw extends ya{constructor(t=0,e=0,n=1,s=1,i=0,a=Math.PI*2,c=!1,u=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=s,this.aStartAngle=i,this.aEndAngle=a,this.aClockwise=c,this.aRotation=u}getPoint(t,e=new Ut){const n=e,s=Math.PI*2;let i=this.aEndAngle-this.aStartAngle;const a=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=s;for(;i>s;)i-=s;i<Number.EPSILON&&(a?i=0:i=s),this.aClockwise===!0&&!a&&(i===s?i=-s:i=i-s);const c=this.aStartAngle+t*i;let u=this.aX+this.xRadius*Math.cos(c),d=this.aY+this.yRadius*Math.sin(c);if(this.aRotation!==0){const f=Math.cos(this.aRotation),p=Math.sin(this.aRotation),g=u-this.aX,y=d-this.aY;u=g*f-y*p+this.aX,d=g*p+y*f+this.aY}return n.set(u,d)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class a8 extends Pw{constructor(t,e,n,s,i,a){super(t,e,n,n,s,i,a),this.isArcCurve=!0,this.type="ArcCurve"}}function zw(){let r=0,t=0,e=0,n=0;function s(i,a,c,u){r=i,t=c,e=-3*i+3*a-2*c-u,n=2*i-2*a+c+u}return{initCatmullRom:function(i,a,c,u,d){s(a,c,d*(c-i),d*(u-a))},initNonuniformCatmullRom:function(i,a,c,u,d,f,p){let g=(a-i)/d-(c-i)/(d+f)+(c-a)/f,y=(c-a)/f-(u-a)/(f+p)+(u-c)/p;g*=f,y*=f,s(a,c,g,y)},calc:function(i){const a=i*i,c=a*i;return r+t*i+e*a+n*c}}}const Um=new V,vS=new zw,AS=new zw,NS=new zw;class aC extends ya{constructor(t=[],e=!1,n="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=s}getPoint(t,e=new V){const n=e,s=this.points,i=s.length,a=(i-(this.closed?0:1))*t;let c=Math.floor(a),u=a-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/i)+1)*i:u===0&&c===i-1&&(c=i-2,u=1);let d,f;this.closed||c>0?d=s[(c-1)%i]:(Um.subVectors(s[0],s[1]).add(s[0]),d=Um);const p=s[c%i],g=s[(c+1)%i];if(this.closed||c+2<i?f=s[(c+2)%i]:(Um.subVectors(s[i-1],s[i-2]).add(s[i-1]),f=Um),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let x=Math.pow(d.distanceToSquared(p),y),S=Math.pow(p.distanceToSquared(g),y),T=Math.pow(g.distanceToSquared(f),y);S<1e-4&&(S=1),x<1e-4&&(x=S),T<1e-4&&(T=S),vS.initNonuniformCatmullRom(d.x,p.x,g.x,f.x,x,S,T),AS.initNonuniformCatmullRom(d.y,p.y,g.y,f.y,x,S,T),NS.initNonuniformCatmullRom(d.z,p.z,g.z,f.z,x,S,T)}else this.curveType==="catmullrom"&&(vS.initCatmullRom(d.x,p.x,g.x,f.x,this.tension),AS.initCatmullRom(d.y,p.y,g.y,f.y,this.tension),NS.initCatmullRom(d.z,p.z,g.z,f.z,this.tension));return n.set(vS.calc(u),AS.calc(u),NS.calc(u)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const s=t.points[e];this.points.push(s.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const s=this.points[e];t.points.push(s.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const s=t.points[e];this.points.push(new V().fromArray(s))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function HN(r,t,e,n,s){const i=(n-t)*.5,a=(s-e)*.5,c=r*r,u=r*c;return(2*e-2*n+i+a)*u+(-3*e+3*n-2*i-a)*c+i*r+e}function l8(r,t){const e=1-r;return e*e*t}function c8(r,t){return 2*(1-r)*r*t}function u8(r,t){return r*r*t}function yp(r,t,e,n){return l8(r,t)+c8(r,e)+u8(r,n)}function h8(r,t){const e=1-r;return e*e*e*t}function d8(r,t){const e=1-r;return 3*e*e*r*t}function f8(r,t){return 3*(1-r)*r*r*t}function p8(r,t){return r*r*r*t}function xp(r,t,e,n,s){return h8(r,t)+d8(r,e)+f8(r,n)+p8(r,s)}class lC extends ya{constructor(t=new Ut,e=new Ut,n=new Ut,s=new Ut){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=s}getPoint(t,e=new Ut){const n=e,s=this.v0,i=this.v1,a=this.v2,c=this.v3;return n.set(xp(t,s.x,i.x,a.x,c.x),xp(t,s.y,i.y,a.y,c.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class m8 extends ya{constructor(t=new V,e=new V,n=new V,s=new V){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=s}getPoint(t,e=new V){const n=e,s=this.v0,i=this.v1,a=this.v2,c=this.v3;return n.set(xp(t,s.x,i.x,a.x,c.x),xp(t,s.y,i.y,a.y,c.y),xp(t,s.z,i.z,a.z,c.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class cC extends ya{constructor(t=new Ut,e=new Ut){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Ut){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Ut){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class g8 extends ya{constructor(t=new V,e=new V){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new V){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new V){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class uC extends ya{constructor(t=new Ut,e=new Ut,n=new Ut){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Ut){const n=e,s=this.v0,i=this.v1,a=this.v2;return n.set(yp(t,s.x,i.x,a.x),yp(t,s.y,i.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class hC extends ya{constructor(t=new V,e=new V,n=new V){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new V){const n=e,s=this.v0,i=this.v1,a=this.v2;return n.set(yp(t,s.x,i.x,a.x),yp(t,s.y,i.y,a.y),yp(t,s.z,i.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class dC extends ya{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Ut){const n=e,s=this.points,i=(s.length-1)*t,a=Math.floor(i),c=i-a,u=s[a===0?a:a-1],d=s[a],f=s[a>s.length-2?s.length-1:a+1],p=s[a>s.length-3?s.length-1:a+2];return n.set(HN(c,u.x,d.x,f.x,p.x),HN(c,u.y,d.y,f.y,p.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const s=t.points[e];this.points.push(s.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const s=this.points[e];t.points.push(s.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const s=t.points[e];this.points.push(new Ut().fromArray(s))}return this}}var Cy=Object.freeze({__proto__:null,ArcCurve:a8,CatmullRomCurve3:aC,CubicBezierCurve:lC,CubicBezierCurve3:m8,EllipseCurve:Pw,LineCurve:cC,LineCurve3:g8,QuadraticBezierCurve:uC,QuadraticBezierCurve3:hC,SplineCurve:dC});class y8 extends ya{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const n=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Cy[n](e,t))}return this}getPoint(t,e){const n=t*this.getLength(),s=this.getCurveLengths();let i=0;for(;i<s.length;){if(s[i]>=n){const a=s[i]-n,c=this.curves[i],u=c.getLength(),d=u===0?0:1-a/u;return c.getPointAt(d,e)}i++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,s=this.curves.length;n<s;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let s=0,i=this.curves;s<i.length;s++){const a=i[s],c=a.isEllipseCurve?t*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,u=a.getPoints(c);for(let d=0;d<u.length;d++){const f=u[d];n&&n.equals(f)||(e.push(f),n=f)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const s=t.curves[e];this.curves.push(s.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const s=this.curves[e];t.curves.push(s.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const s=t.curves[e];this.curves.push(new Cy[s.type]().fromJSON(s))}return this}}class V2 extends y8{constructor(t){super(),this.type="Path",this.currentPoint=new Ut,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new cC(this.currentPoint.clone(),new Ut(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,s){const i=new uC(this.currentPoint.clone(),new Ut(t,e),new Ut(n,s));return this.curves.push(i),this.currentPoint.set(n,s),this}bezierCurveTo(t,e,n,s,i,a){const c=new lC(this.currentPoint.clone(),new Ut(t,e),new Ut(n,s),new Ut(i,a));return this.curves.push(c),this.currentPoint.set(i,a),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new dC(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,s,i,a){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absarc(t+c,e+u,n,s,i,a),this}absarc(t,e,n,s,i,a){return this.absellipse(t,e,n,n,s,i,a),this}ellipse(t,e,n,s,i,a,c,u){const d=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(t+d,e+f,n,s,i,a,c,u),this}absellipse(t,e,n,s,i,a,c,u){const d=new Pw(t,e,n,s,i,a,c,u);if(this.curves.length>0){const p=d.getPoint(0);p.equals(this.currentPoint)||this.lineTo(p.x,p.y)}this.curves.push(d);const f=d.getPoint(1);return this.currentPoint.copy(f),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class ld extends V2{constructor(t){super(t),this.uuid=ia(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,s=this.holes.length;n<s;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const s=t.holes[e];this.holes.push(s.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const s=this.holes[e];t.holes.push(s.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const s=t.holes[e];this.holes.push(new V2().fromJSON(s))}return this}}function x8(r,t,e=2){const n=t&&t.length,s=n?t[0]*e:r.length;let i=fC(r,0,s,e,!0);const a=[];if(!i||i.next===i.prev)return a;let c,u,d;if(n&&(i=_8(r,t,i,e)),r.length>80*e){c=r[0],u=r[1];let f=c,p=u;for(let g=e;g<s;g+=e){const y=r[g],x=r[g+1];y<c&&(c=y),x<u&&(u=x),y>f&&(f=y),x>p&&(p=x)}d=Math.max(f-c,p-u),d=d!==0?32767/d:0}return Op(i,a,e,c,u,d,0),a}function fC(r,t,e,n,s){let i;if(s===O8(r,t,e,n)>0)for(let a=t;a<e;a+=n)i=WN(a/n|0,r[a],r[a+1],i);else for(let a=e-n;a>=t;a-=n)i=WN(a/n|0,r[a],r[a+1],i);return i&&Md(i,i.next)&&(Up(i),i=i.next),i}function Vu(r,t){if(!r)return r;t||(t=r);let e=r,n;do if(n=!1,!e.steiner&&(Md(e,e.next)||es(e.prev,e,e.next)===0)){if(Up(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function Op(r,t,e,n,s,i,a){if(!r)return;!a&&i&&R8(r,n,s,i);let c=r;for(;r.prev!==r.next;){const u=r.prev,d=r.next;if(i?S8(r,n,s,i):b8(r)){t.push(u.i,r.i,d.i),Up(r),r=d.next,c=d.next;continue}if(r=d,r===c){a?a===1?(r=w8(Vu(r),t),Op(r,t,e,n,s,i,2)):a===2&&T8(r,t,e,n,s,i):Op(Vu(r),t,e,n,s,i,1);break}}}function b8(r){const t=r.prev,e=r,n=r.next;if(es(t,e,n)>=0)return!1;const s=t.x,i=e.x,a=n.x,c=t.y,u=e.y,d=n.y,f=Math.min(s,i,a),p=Math.min(c,u,d),g=Math.max(s,i,a),y=Math.max(c,u,d);let x=n.next;for(;x!==t;){if(x.x>=f&&x.x<=g&&x.y>=p&&x.y<=y&&np(s,c,i,u,a,d,x.x,x.y)&&es(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function S8(r,t,e,n){const s=r.prev,i=r,a=r.next;if(es(s,i,a)>=0)return!1;const c=s.x,u=i.x,d=a.x,f=s.y,p=i.y,g=a.y,y=Math.min(c,u,d),x=Math.min(f,p,g),S=Math.max(c,u,d),T=Math.max(f,p,g),M=G2(y,x,t,e,n),N=G2(S,T,t,e,n);let v=r.prevZ,A=r.nextZ;for(;v&&v.z>=M&&A&&A.z<=N;){if(v.x>=y&&v.x<=S&&v.y>=x&&v.y<=T&&v!==s&&v!==a&&np(c,f,u,p,d,g,v.x,v.y)&&es(v.prev,v,v.next)>=0||(v=v.prevZ,A.x>=y&&A.x<=S&&A.y>=x&&A.y<=T&&A!==s&&A!==a&&np(c,f,u,p,d,g,A.x,A.y)&&es(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;v&&v.z>=M;){if(v.x>=y&&v.x<=S&&v.y>=x&&v.y<=T&&v!==s&&v!==a&&np(c,f,u,p,d,g,v.x,v.y)&&es(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;A&&A.z<=N;){if(A.x>=y&&A.x<=S&&A.y>=x&&A.y<=T&&A!==s&&A!==a&&np(c,f,u,p,d,g,A.x,A.y)&&es(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function w8(r,t){let e=r;do{const n=e.prev,s=e.next.next;!Md(n,s)&&mC(n,e,e.next,s)&&Fp(n,s)&&Fp(s,n)&&(t.push(n.i,e.i,s.i),Up(e),Up(e.next),e=r=s),e=e.next}while(e!==r);return Vu(e)}function T8(r,t,e,n,s,i){let a=r;do{let c=a.next.next;for(;c!==a.prev;){if(a.i!==c.i&&D8(a,c)){let u=gC(a,c);a=Vu(a,a.next),u=Vu(u,u.next),Op(a,t,e,n,s,i,0),Op(u,t,e,n,s,i,0);return}c=c.next}a=a.next}while(a!==r)}function _8(r,t,e,n){const s=[];for(let i=0,a=t.length;i<a;i++){const c=t[i]*n,u=i<a-1?t[i+1]*n:r.length,d=fC(r,c,u,n,!1);d===d.next&&(d.steiner=!0),s.push(C8(d))}s.sort(M8);for(let i=0;i<s.length;i++)e=v8(s[i],e);return e}function M8(r,t){let e=r.x-t.x;if(e===0&&(e=r.y-t.y,e===0)){const n=(r.next.y-r.y)/(r.next.x-r.x),s=(t.next.y-t.y)/(t.next.x-t.x);e=n-s}return e}function v8(r,t){const e=A8(r,t);if(!e)return t;const n=gC(e,r);return Vu(n,n.next),Vu(e,e.next)}function A8(r,t){let e=t;const n=r.x,s=r.y;let i=-1/0,a;if(Md(r,e))return e;do{if(Md(r,e.next))return e.next;if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){const p=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(p<=n&&p>i&&(i=p,a=e.x<e.next.x?e:e.next,p===n))return a}e=e.next}while(e!==t);if(!a)return null;const c=a,u=a.x,d=a.y;let f=1/0;e=a;do{if(n>=e.x&&e.x>=u&&n!==e.x&&pC(s<d?n:i,s,u,d,s<d?i:n,s,e.x,e.y)){const p=Math.abs(s-e.y)/(n-e.x);Fp(e,r)&&(p<f||p===f&&(e.x>a.x||e.x===a.x&&N8(a,e)))&&(a=e,f=p)}e=e.next}while(e!==c);return a}function N8(r,t){return es(r.prev,r,t.prev)<0&&es(t.next,r,r.next)<0}function R8(r,t,e,n){let s=r;do s.z===0&&(s.z=G2(s.x,s.y,t,e,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,E8(s)}function E8(r){let t,e=1;do{let n=r,s;r=null;let i=null;for(t=0;n;){t++;let a=n,c=0;for(let d=0;d<e&&(c++,a=a.nextZ,!!a);d++);let u=e;for(;c>0||u>0&&a;)c!==0&&(u===0||!a||n.z<=a.z)?(s=n,n=n.nextZ,c--):(s=a,a=a.nextZ,u--),i?i.nextZ=s:r=s,s.prevZ=i,i=s;n=a}i.nextZ=null,e*=2}while(t>1);return r}function G2(r,t,e,n,s){return r=(r-e)*s|0,t=(t-n)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function C8(r){let t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function pC(r,t,e,n,s,i,a,c){return(s-a)*(t-c)>=(r-a)*(i-c)&&(r-a)*(n-c)>=(e-a)*(t-c)&&(e-a)*(i-c)>=(s-a)*(n-c)}function np(r,t,e,n,s,i,a,c){return!(r===a&&t===c)&&pC(r,t,e,n,s,i,a,c)}function D8(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!B8(r,t)&&(Fp(r,t)&&Fp(t,r)&&L8(r,t)&&(es(r.prev,r,t.prev)||es(r,t.prev,t))||Md(r,t)&&es(r.prev,r,r.next)>0&&es(t.prev,t,t.next)>0)}function es(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function Md(r,t){return r.x===t.x&&r.y===t.y}function mC(r,t,e,n){const s=zm(es(r,t,e)),i=zm(es(r,t,n)),a=zm(es(e,n,r)),c=zm(es(e,n,t));return!!(s!==i&&a!==c||s===0&&Pm(r,e,t)||i===0&&Pm(r,n,t)||a===0&&Pm(e,r,n)||c===0&&Pm(e,t,n))}function Pm(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function zm(r){return r>0?1:r<0?-1:0}function B8(r,t){let e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&mC(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function Fp(r,t){return es(r.prev,r,r.next)<0?es(r,t,r.next)>=0&&es(r,r.prev,t)>=0:es(r,t,r.prev)<0||es(r,r.next,t)<0}function L8(r,t){let e=r,n=!1;const s=(r.x+t.x)/2,i=(r.y+t.y)/2;do e.y>i!=e.next.y>i&&e.next.y!==e.y&&s<(e.next.x-e.x)*(i-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==r);return n}function gC(r,t){const e=k2(r.i,r.x,r.y),n=k2(t.i,t.x,t.y),s=r.next,i=t.prev;return r.next=t,t.prev=r,e.next=s,s.prev=e,n.next=e,e.prev=n,i.next=n,n.prev=i,n}function WN(r,t,e,n){const s=k2(r,t,e);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function Up(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function k2(r,t,e){return{i:r,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function O8(r,t,e,n){let s=0;for(let i=t,a=e-n;i<e;i+=n)s+=(r[a]-r[i])*(r[i+1]+r[a+1]),a=i;return s}class F8{static triangulate(t,e,n=2){return x8(t,e,n)}}class sl{static area(t){const e=t.length;let n=0;for(let s=e-1,i=0;i<e;s=i++)n+=t[s].x*t[i].y-t[i].x*t[s].y;return n*.5}static isClockWise(t){return sl.area(t)<0}static triangulateShape(t,e){const n=[],s=[],i=[];qN(t),$N(n,t);let a=t.length;e.forEach(qN);for(let u=0;u<e.length;u++)s.push(a),a+=e[u].length,$N(n,e[u]);const c=F8.triangulate(n,s);for(let u=0;u<c.length;u+=3)i.push(c.slice(u,u+3));return i}}function qN(r){const t=r.length;t>2&&r[t-1].equals(r[0])&&r.pop()}function $N(r,t){for(let e=0;e<t.length;e++)r.push(t[e].x),r.push(t[e].y)}class bp extends Qe{constructor(t=new ld([new Ut(.5,.5),new Ut(-.5,.5),new Ut(-.5,-.5),new Ut(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,s=[],i=[];for(let c=0,u=t.length;c<u;c++){const d=t[c];a(d)}this.setAttribute("position",new ge(s,3)),this.setAttribute("uv",new ge(i,2)),this.computeVertexNormals();function a(c){const u=[],d=e.curveSegments!==void 0?e.curveSegments:12,f=e.steps!==void 0?e.steps:1,p=e.depth!==void 0?e.depth:1;let g=e.bevelEnabled!==void 0?e.bevelEnabled:!0,y=e.bevelThickness!==void 0?e.bevelThickness:.2,x=e.bevelSize!==void 0?e.bevelSize:y-.1,S=e.bevelOffset!==void 0?e.bevelOffset:0,T=e.bevelSegments!==void 0?e.bevelSegments:3;const M=e.extrudePath,N=e.UVGenerator!==void 0?e.UVGenerator:U8;let v,A=!1,R,L,D,U;if(M){v=M.getSpacedPoints(f),A=!0,g=!1;const $=M.isCatmullRomCurve3?M.closed:!1;R=M.computeFrenetFrames(f,$),L=new V,D=new V,U=new V}g||(T=0,y=0,x=0,S=0);const B=c.extractPoints(d);let P=B.shape;const J=B.holes;if(!sl.isClockWise(P)){P=P.reverse();for(let $=0,nt=J.length;$<nt;$++){const ht=J[$];sl.isClockWise(ht)&&(J[$]=ht.reverse())}}function ft($){const ht=10000000000000001e-36;let dt=$[0];for(let pt=1;pt<=$.length;pt++){const Rt=pt%$.length,Ft=$[Rt],Gt=Ft.x-dt.x,ae=Ft.y-dt.y,Kt=Gt*Gt+ae*ae,jt=Math.max(Math.abs(Ft.x),Math.abs(Ft.y),Math.abs(dt.x),Math.abs(dt.y)),ce=ht*jt*jt;if(Kt<=ce){$.splice(Rt,1),pt--;continue}dt=Ft}}ft(P),J.forEach(ft);const Mt=J.length,mt=P;for(let $=0;$<Mt;$++){const nt=J[$];P=P.concat(nt)}function F($,nt,ht){return nt||Ht("ExtrudeGeometry: vec does not exist"),$.clone().addScaledVector(nt,ht)}const Y=P.length;function tt($,nt,ht){let dt,pt,Rt;const Ft=$.x-nt.x,Gt=$.y-nt.y,ae=ht.x-$.x,Kt=ht.y-$.y,jt=Ft*Ft+Gt*Gt,ce=Ft*Kt-Gt*ae;if(Math.abs(ce)>Number.EPSILON){const ee=Math.sqrt(jt),Re=Math.sqrt(ae*ae+Kt*Kt),je=nt.x-Gt/ee,pn=nt.y+Ft/ee,os=ht.x-Kt/Re,jn=ht.y+ae/Re,Yn=((os-je)*Kt-(jn-pn)*ae)/(Ft*Kt-Gt*ae);dt=je+Ft*Yn-$.x,pt=pn+Gt*Yn-$.y;const we=dt*dt+pt*pt;if(we<=2)return new Ut(dt,pt);Rt=Math.sqrt(we/2)}else{let ee=!1;Ft>Number.EPSILON?ae>Number.EPSILON&&(ee=!0):Ft<-Number.EPSILON?ae<-Number.EPSILON&&(ee=!0):Math.sign(Gt)===Math.sign(Kt)&&(ee=!0),ee?(dt=-Gt,pt=Ft,Rt=Math.sqrt(jt)):(dt=Ft,pt=Gt,Rt=Math.sqrt(jt/2))}return new Ut(dt/Rt,pt/Rt)}const lt=[];for(let $=0,nt=mt.length,ht=nt-1,dt=$+1;$<nt;$++,ht++,dt++)ht===nt&&(ht=0),dt===nt&&(dt=0),lt[$]=tt(mt[$],mt[ht],mt[dt]);const Tt=[];let O,et=lt.concat();for(let $=0,nt=Mt;$<nt;$++){const ht=J[$];O=[];for(let dt=0,pt=ht.length,Rt=pt-1,Ft=dt+1;dt<pt;dt++,Rt++,Ft++)Rt===pt&&(Rt=0),Ft===pt&&(Ft=0),O[dt]=tt(ht[dt],ht[Rt],ht[Ft]);Tt.push(O),et=et.concat(O)}let z;if(T===0)z=sl.triangulateShape(mt,J);else{const $=[],nt=[];for(let ht=0;ht<T;ht++){const dt=ht/T,pt=y*Math.cos(dt*Math.PI/2),Rt=x*Math.sin(dt*Math.PI/2)+S;for(let Ft=0,Gt=mt.length;Ft<Gt;Ft++){const ae=F(mt[Ft],lt[Ft],Rt);j(ae.x,ae.y,-pt),dt===0&&$.push(ae)}for(let Ft=0,Gt=Mt;Ft<Gt;Ft++){const ae=J[Ft];O=Tt[Ft];const Kt=[];for(let jt=0,ce=ae.length;jt<ce;jt++){const ee=F(ae[jt],O[jt],Rt);j(ee.x,ee.y,-pt),dt===0&&Kt.push(ee)}dt===0&&nt.push(Kt)}}z=sl.triangulateShape($,nt)}const W=z.length,yt=x+S;for(let $=0;$<Y;$++){const nt=g?F(P[$],et[$],yt):P[$];A?(D.copy(R.normals[0]).multiplyScalar(nt.x),L.copy(R.binormals[0]).multiplyScalar(nt.y),U.copy(v[0]).add(D).add(L),j(U.x,U.y,U.z)):j(nt.x,nt.y,0)}for(let $=1;$<=f;$++)for(let nt=0;nt<Y;nt++){const ht=g?F(P[nt],et[nt],yt):P[nt];A?(D.copy(R.normals[$]).multiplyScalar(ht.x),L.copy(R.binormals[$]).multiplyScalar(ht.y),U.copy(v[$]).add(D).add(L),j(U.x,U.y,U.z)):j(ht.x,ht.y,p/f*$)}for(let $=T-1;$>=0;$--){const nt=$/T,ht=y*Math.cos(nt*Math.PI/2),dt=x*Math.sin(nt*Math.PI/2)+S;for(let pt=0,Rt=mt.length;pt<Rt;pt++){const Ft=F(mt[pt],lt[pt],dt);j(Ft.x,Ft.y,p+ht)}for(let pt=0,Rt=J.length;pt<Rt;pt++){const Ft=J[pt];O=Tt[pt];for(let Gt=0,ae=Ft.length;Gt<ae;Gt++){const Kt=F(Ft[Gt],O[Gt],dt);A?j(Kt.x,Kt.y+v[f-1].y,v[f-1].x+ht):j(Kt.x,Kt.y,p+ht)}}}K(),Z();function K(){const $=s.length/3;if(g){let nt=0,ht=Y*nt;for(let dt=0;dt<W;dt++){const pt=z[dt];ct(pt[2]+ht,pt[1]+ht,pt[0]+ht)}nt=f+T*2,ht=Y*nt;for(let dt=0;dt<W;dt++){const pt=z[dt];ct(pt[0]+ht,pt[1]+ht,pt[2]+ht)}}else{for(let nt=0;nt<W;nt++){const ht=z[nt];ct(ht[2],ht[1],ht[0])}for(let nt=0;nt<W;nt++){const ht=z[nt];ct(ht[0]+Y*f,ht[1]+Y*f,ht[2]+Y*f)}}n.addGroup($,s.length/3-$,0)}function Z(){const $=s.length/3;let nt=0;H(mt,nt),nt+=mt.length;for(let ht=0,dt=J.length;ht<dt;ht++){const pt=J[ht];H(pt,nt),nt+=pt.length}n.addGroup($,s.length/3-$,1)}function H($,nt){let ht=$.length;for(;--ht>=0;){const dt=ht;let pt=ht-1;pt<0&&(pt=$.length-1);for(let Rt=0,Ft=f+T*2;Rt<Ft;Rt++){const Gt=Y*Rt,ae=Y*(Rt+1),Kt=nt+dt+Gt,jt=nt+pt+Gt,ce=nt+pt+ae,ee=nt+dt+ae;xt(Kt,jt,ce,ee)}}}function j($,nt,ht){u.push($),u.push(nt),u.push(ht)}function ct($,nt,ht){at($),at(nt),at(ht);const dt=s.length/3,pt=N.generateTopUV(n,s,dt-3,dt-2,dt-1);ut(pt[0]),ut(pt[1]),ut(pt[2])}function xt($,nt,ht,dt){at($),at(nt),at(dt),at(nt),at(ht),at(dt);const pt=s.length/3,Rt=N.generateSideWallUV(n,s,pt-6,pt-3,pt-2,pt-1);ut(Rt[0]),ut(Rt[1]),ut(Rt[3]),ut(Rt[1]),ut(Rt[2]),ut(Rt[3])}function at($){s.push(u[$*3+0]),s.push(u[$*3+1]),s.push(u[$*3+2])}function ut($){i.push($.x),i.push($.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes,n=this.parameters.options;return P8(e,n,t)}static fromJSON(t,e){const n=[];for(let i=0,a=t.shapes.length;i<a;i++){const c=e[t.shapes[i]];n.push(c)}const s=t.options.extrudePath;return s!==void 0&&(t.options.extrudePath=new Cy[s.type]().fromJSON(s)),new bp(n,t.options)}}const U8={generateTopUV:function(r,t,e,n,s){const i=t[e*3],a=t[e*3+1],c=t[n*3],u=t[n*3+1],d=t[s*3],f=t[s*3+1];return[new Ut(i,a),new Ut(c,u),new Ut(d,f)]},generateSideWallUV:function(r,t,e,n,s,i){const a=t[e*3],c=t[e*3+1],u=t[e*3+2],d=t[n*3],f=t[n*3+1],p=t[n*3+2],g=t[s*3],y=t[s*3+1],x=t[s*3+2],S=t[i*3],T=t[i*3+1],M=t[i*3+2];return Math.abs(c-f)<Math.abs(a-d)?[new Ut(a,1-u),new Ut(d,1-p),new Ut(g,1-x),new Ut(S,1-M)]:[new Ut(c,1-u),new Ut(f,1-p),new Ut(y,1-x),new Ut(T,1-M)]}};function P8(r,t,e){if(e.shapes=[],Array.isArray(r))for(let n=0,s=r.length;n<s;n++){const i=r[n];e.shapes.push(i.uuid)}else e.shapes.push(r.uuid);return e.options=Object.assign({},t),t.extrudePath!==void 0&&(e.options.extrudePath=t.extrudePath.toJSON()),e}class ns extends Qe{constructor(t=1,e=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:s};const i=t/2,a=e/2,c=Math.floor(n),u=Math.floor(s),d=c+1,f=u+1,p=t/c,g=e/u,y=[],x=[],S=[],T=[];for(let M=0;M<f;M++){const N=M*g-a;for(let v=0;v<d;v++){const A=v*p-i;x.push(A,-N,0),S.push(0,0,1),T.push(v/c),T.push(1-M/u)}}for(let M=0;M<u;M++)for(let N=0;N<c;N++){const v=N+d*M,A=N+d*(M+1),R=N+1+d*(M+1),L=N+1+d*M;y.push(v,A,L),y.push(A,R,L)}this.setIndex(y),this.setAttribute("position",new ge(x,3)),this.setAttribute("normal",new ge(S,3)),this.setAttribute("uv",new ge(T,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ns(t.width,t.height,t.widthSegments,t.heightSegments)}}class cx extends Qe{constructor(t=.5,e=1,n=32,s=1,i=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:s,thetaStart:i,thetaLength:a},n=Math.max(3,n),s=Math.max(1,s);const c=[],u=[],d=[],f=[];let p=t;const g=(e-t)/s,y=new V,x=new Ut;for(let S=0;S<=s;S++){for(let T=0;T<=n;T++){const M=i+T/n*a;y.x=p*Math.cos(M),y.y=p*Math.sin(M),u.push(y.x,y.y,y.z),d.push(0,0,1),x.x=(y.x/e+1)/2,x.y=(y.y/e+1)/2,f.push(x.x,x.y)}p+=g}for(let S=0;S<s;S++){const T=S*(n+1);for(let M=0;M<n;M++){const N=M+T,v=N,A=N+n+1,R=N+n+2,L=N+1;c.push(v,A,L),c.push(A,R,L)}}this.setIndex(c),this.setAttribute("position",new ge(u,3)),this.setAttribute("normal",new ge(d,3)),this.setAttribute("uv",new ge(f,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new cx(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Iw extends Qe{constructor(t=new ld([new Ut(0,.5),new Ut(-.5,-.5),new Ut(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],s=[],i=[],a=[];let c=0,u=0;if(Array.isArray(t)===!1)d(t);else for(let f=0;f<t.length;f++)d(t[f]),this.addGroup(c,u,f),c+=u,u=0;this.setIndex(n),this.setAttribute("position",new ge(s,3)),this.setAttribute("normal",new ge(i,3)),this.setAttribute("uv",new ge(a,2));function d(f){const p=s.length/3,g=f.extractPoints(e);let y=g.shape;const x=g.holes;sl.isClockWise(y)===!1&&(y=y.reverse());for(let T=0,M=x.length;T<M;T++){const N=x[T];sl.isClockWise(N)===!0&&(x[T]=N.reverse())}const S=sl.triangulateShape(y,x);for(let T=0,M=x.length;T<M;T++){const N=x[T];y=y.concat(N)}for(let T=0,M=y.length;T<M;T++){const N=y[T];s.push(N.x,N.y,0),i.push(0,0,1),a.push(N.x,N.y)}for(let T=0,M=S.length;T<M;T++){const N=S[T],v=N[0]+p,A=N[1]+p,R=N[2]+p;n.push(v,A,R),u+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return z8(e,t)}static fromJSON(t,e){const n=[];for(let s=0,i=t.shapes.length;s<i;s++){const a=e[t.shapes[s]];n.push(a)}return new Iw(n,t.curveSegments)}}function z8(r,t){if(t.shapes=[],Array.isArray(r))for(let e=0,n=r.length;e<n;e++){const s=r[e];t.shapes.push(s.uuid)}else t.shapes.push(r.uuid);return t}class We extends Qe{constructor(t=1,e=32,n=16,s=0,i=Math.PI*2,a=0,c=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:s,phiLength:i,thetaStart:a,thetaLength:c},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const u=Math.min(a+c,Math.PI);let d=0;const f=[],p=new V,g=new V,y=[],x=[],S=[],T=[];for(let M=0;M<=n;M++){const N=[],v=M/n;let A=0;M===0&&a===0?A=.5/e:M===n&&u===Math.PI&&(A=-.5/e);for(let R=0;R<=e;R++){const L=R/e;p.x=-t*Math.cos(s+L*i)*Math.sin(a+v*c),p.y=t*Math.cos(a+v*c),p.z=t*Math.sin(s+L*i)*Math.sin(a+v*c),x.push(p.x,p.y,p.z),g.copy(p).normalize(),S.push(g.x,g.y,g.z),T.push(L+A,1-v),N.push(d++)}f.push(N)}for(let M=0;M<n;M++)for(let N=0;N<e;N++){const v=f[M][N+1],A=f[M][N],R=f[M+1][N],L=f[M+1][N+1];(M!==0||a>0)&&y.push(v,A,L),(M!==n-1||u<Math.PI)&&y.push(A,R,L)}this.setIndex(y),this.setAttribute("position",new ge(x,3)),this.setAttribute("normal",new ge(S,3)),this.setAttribute("uv",new ge(T,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new We(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Vw extends Uw{constructor(t=1,e=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,s,t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Vw(t.radius,t.detail)}}class da extends Qe{constructor(t=1,e=.4,n=12,s=48,i=Math.PI*2,a=0,c=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:s,arc:i,thetaStart:a,thetaLength:c},n=Math.floor(n),s=Math.floor(s);const u=[],d=[],f=[],p=[],g=new V,y=new V,x=new V;for(let S=0;S<=n;S++){const T=a+S/n*c;for(let M=0;M<=s;M++){const N=M/s*i;y.x=(t+e*Math.cos(T))*Math.cos(N),y.y=(t+e*Math.cos(T))*Math.sin(N),y.z=e*Math.sin(T),d.push(y.x,y.y,y.z),g.x=t*Math.cos(N),g.y=t*Math.sin(N),x.subVectors(y,g).normalize(),f.push(x.x,x.y,x.z),p.push(M/s),p.push(S/n)}}for(let S=1;S<=n;S++)for(let T=1;T<=s;T++){const M=(s+1)*S+T-1,N=(s+1)*(S-1)+T-1,v=(s+1)*(S-1)+T,A=(s+1)*S+T;u.push(M,N,A),u.push(N,v,A)}this.setIndex(u),this.setAttribute("position",new ge(d,3)),this.setAttribute("normal",new ge(f,3)),this.setAttribute("uv",new ge(p,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new da(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Gw extends Qe{constructor(t=new hC(new V(-1,-1,0),new V(-1,1,0),new V(1,1,0)),e=64,n=1,s=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:s,closed:i};const a=t.computeFrenetFrames(e,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const c=new V,u=new V,d=new Ut;let f=new V;const p=[],g=[],y=[],x=[];S(),this.setIndex(x),this.setAttribute("position",new ge(p,3)),this.setAttribute("normal",new ge(g,3)),this.setAttribute("uv",new ge(y,2));function S(){for(let v=0;v<e;v++)T(v);T(i===!1?e:0),N(),M()}function T(v){f=t.getPointAt(v/e,f);const A=a.normals[v],R=a.binormals[v];for(let L=0;L<=s;L++){const D=L/s*Math.PI*2,U=Math.sin(D),B=-Math.cos(D);u.x=B*A.x+U*R.x,u.y=B*A.y+U*R.y,u.z=B*A.z+U*R.z,u.normalize(),g.push(u.x,u.y,u.z),c.x=f.x+n*u.x,c.y=f.y+n*u.y,c.z=f.z+n*u.z,p.push(c.x,c.y,c.z)}}function M(){for(let v=1;v<=e;v++)for(let A=1;A<=s;A++){const R=(s+1)*(v-1)+(A-1),L=(s+1)*v+(A-1),D=(s+1)*v+A,U=(s+1)*(v-1)+A;x.push(R,L,U),x.push(L,D,U)}}function N(){for(let v=0;v<=e;v++)for(let A=0;A<=s;A++)d.x=v/e,d.y=A/s,y.push(d.x,d.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Gw(new Cy[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class I8 extends Ar{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new Xt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class bt extends Ar{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new Xt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=al,this.normalScale=new Ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new tr,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Dy extends bt{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ut(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return De(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Xt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Xt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Xt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class V8 extends Ar{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new Xt(16777215),this.specular=new Xt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=al,this.normalScale=new Ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new tr,this.combine=Qy,this.reflectivity=1,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class G8 extends Ar{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Xt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=al,this.normalScale=new Ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class k8 extends Ar{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=al,this.normalScale=new Ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class H8 extends Ar{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new Xt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Xt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=al,this.normalScale=new Ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new tr,this.combine=Qy,this.reflectivity=1,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class W8 extends Ar{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Xt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=al,this.normalScale=new Ut(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this.fog=t.fog,this}}class q8 extends oC{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}const RS={enabled:!1,files:{},add:function(r,t){this.enabled!==!1&&(XN(r)||(this.files[r]=t))},get:function(r){if(this.enabled!==!1&&!XN(r))return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};function XN(r){try{const t=r.slice(r.indexOf(":")+1);return new URL(t).protocol==="blob:"}catch{return!1}}class $8{constructor(t,e,n){const s=this;let i=!1,a=0,c=0,u;const d=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this._abortController=null,this.itemStart=function(f){c++,i===!1&&s.onStart!==void 0&&s.onStart(f,a,c),i=!0},this.itemEnd=function(f){a++,s.onProgress!==void 0&&s.onProgress(f,a,c),a===c&&(i=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(f){s.onError!==void 0&&s.onError(f)},this.resolveURL=function(f){return u?u(f):f},this.setURLModifier=function(f){return u=f,this},this.addHandler=function(f,p){return d.push(f,p),this},this.removeHandler=function(f){const p=d.indexOf(f);return p!==-1&&d.splice(p,2),this},this.getHandler=function(f){for(let p=0,g=d.length;p<g;p+=2){const y=d[p],x=d[p+1];if(y.global&&(y.lastIndex=0),y.test(f))return x}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const X8=new $8;class kw{constructor(t){this.manager=t!==void 0?t:X8,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}load(){}loadAsync(t,e){const n=this;return new Promise(function(s,i){n.load(t,s,e,i)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}}kw.DEFAULT_MATERIAL_NAME="__DEFAULT";const Vh=new WeakMap;class j8 extends kw{constructor(t){super(t)}load(t,e,n,s){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,a=RS.get(`image:${t}`);if(a!==void 0){if(a.complete===!0)i.manager.itemStart(t),setTimeout(function(){e&&e(a),i.manager.itemEnd(t)},0);else{let p=Vh.get(a);p===void 0&&(p=[],Vh.set(a,p)),p.push({onLoad:e,onError:s})}return a}const c=Ey("img");function u(){f(),e&&e(this);const p=Vh.get(this)||[];for(let g=0;g<p.length;g++){const y=p[g];y.onLoad&&y.onLoad(this)}Vh.delete(this),i.manager.itemEnd(t)}function d(p){f(),s&&s(p),RS.remove(`image:${t}`);const g=Vh.get(this)||[];for(let y=0;y<g.length;y++){const x=g[y];x.onError&&x.onError(p)}Vh.delete(this),i.manager.itemError(t),i.manager.itemEnd(t)}function f(){c.removeEventListener("load",u,!1),c.removeEventListener("error",d,!1)}return c.addEventListener("load",u,!1),c.addEventListener("error",d,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(c.crossOrigin=this.crossOrigin),RS.add(`image:${t}`,c),i.manager.itemStart(t),c.src=t,c}}class Hw extends kw{constructor(t){super(t)}load(t,e,n,s){const i=new is,a=new j8(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(c){i.image=c,i.needsUpdate=!0,e!==void 0&&e(i)},n,s),i}}class Wu extends On{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new Xt(t),this.intensity=e}dispose(){this.dispatchEvent({type:"dispose"})}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,e}}class $p extends Wu{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(On.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Xt(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}toJSON(t){const e=super.toJSON(t);return e.object.groundColor=this.groundColor.getHex(),e}}const ES=new ve,jN=new V,YN=new V;class Ww{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.biasNode=null,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ut(512,512),this.mapType=xi,this.map=null,this.mapPass=null,this.matrix=new ve,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ax,this._frameExtents=new Ut(1,1),this._viewportCount=1,this._viewports=[new Ze(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;jN.setFromMatrixPosition(t.matrixWorld),e.position.copy(jN),YN.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(YN),e.updateMatrixWorld(),ES.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ES,e.coordinateSystem,e.reversedDepth),e.coordinateSystem===Jr||e.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(ES)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.autoUpdate=t.autoUpdate,this.needsUpdate=t.needsUpdate,this.normalBias=t.normalBias,this.blurSamples=t.blurSamples,this.mapSize.copy(t.mapSize),this.biasNode=t.biasNode,this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}const Im=new V,Vm=new Ps,Io=new V;class yC extends On{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ve,this.projectionMatrix=new ve,this.projectionMatrixInverse=new ve,this.coordinateSystem=_r,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorld.decompose(Im,Vm,Io),Io.x===1&&Io.y===1&&Io.z===1?this.matrixWorldInverse.copy(this.matrixWorld).invert():this.matrixWorldInverse.compose(Im,Vm,Io.set(1,1,1)).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorld.decompose(Im,Vm,Io),Io.x===1&&Io.y===1&&Io.z===1?this.matrixWorldInverse.copy(this.matrixWorld).invert():this.matrixWorldInverse.compose(Im,Vm,Io.set(1,1,1)).invert()}clone(){return new this.constructor().copy(this)}}const Xl=new V,KN=new Ut,ZN=new Ut;class Xi extends yC{constructor(t=50,e=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=_d*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(mp*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return _d*2*Math.atan(Math.tan(mp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){Xl.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Xl.x,Xl.y).multiplyScalar(-t/Xl.z),Xl.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Xl.x,Xl.y).multiplyScalar(-t/Xl.z)}getViewSize(t,e){return this.getViewBounds(t,KN,ZN),e.subVectors(ZN,KN)}setViewOffset(t,e,n,s,i,a){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=s,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(mp*.5*this.fov)/this.zoom,n=2*e,s=this.aspect*n,i=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const u=a.fullWidth,d=a.fullHeight;i+=a.offsetX*s/u,e-=a.offsetY*n/d,s*=a.width/u,n*=a.height/d}const c=this.filmOffset;c!==0&&(i+=t*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+s,e,e-n,t,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}class Y8 extends Ww{constructor(){super(new Xi(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(t){const e=this.camera,n=_d*2*t.angle*this.focus,s=this.mapSize.width/this.mapSize.height*this.aspect,i=t.distance||e.far;(n!==e.fov||s!==e.aspect||i!==e.far)&&(e.fov=n,e.aspect=s,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class ux extends Wu{constructor(t,e,n=0,s=Math.PI/3,i=0,a=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(On.DEFAULT_UP),this.updateMatrix(),this.target=new On,this.distance=n,this.angle=s,this.penumbra=i,this.decay=a,this.map=null,this.shadow=new Y8}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.map=t.map,this.shadow=t.shadow.clone(),this}toJSON(t){const e=super.toJSON(t);return e.object.distance=this.distance,e.object.angle=this.angle,e.object.decay=this.decay,e.object.penumbra=this.penumbra,e.object.target=this.target.uuid,this.map&&this.map.isTexture&&(e.object.map=this.map.toJSON(t).uuid),e.object.shadow=this.shadow.toJSON(),e}}class K8 extends Ww{constructor(){super(new Xi(90,1,.5,500)),this.isPointLightShadow=!0}}class hs extends Wu{constructor(t,e,n=0,s=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new K8}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}toJSON(t){const e=super.toJSON(t);return e.object.distance=this.distance,e.object.decay=this.decay,e.object.shadow=this.shadow.toJSON(),e}}class qw extends yC{constructor(t=-1,e=1,n=1,s=-1,i=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=s,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,n,s,i,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=s,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let i=n-t,a=n+t,c=s+e,u=s-e;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=d*this.view.offsetX,a=i+d*this.view.width,c-=f*this.view.offsetY,u=c-f*this.view.height}this.projectionMatrix.makeOrthographic(i,a,c,u,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}class Z8 extends Ww{constructor(){super(new qw(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class wi extends Wu{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(On.DEFAULT_UP),this.updateMatrix(),this.target=new On,this.shadow=new Z8}dispose(){super.dispose(),this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}toJSON(t){const e=super.toJSON(t);return e.object.shadow=this.shadow.toJSON(),e.object.target=this.target.uuid,e}}class Co extends Wu{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Q8 extends Wu{constructor(t,e,n=10,s=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class J8{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new V)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,s=t.y,i=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.282095),e.addScaledVector(a[1],.488603*s),e.addScaledVector(a[2],.488603*i),e.addScaledVector(a[3],.488603*n),e.addScaledVector(a[4],1.092548*(n*s)),e.addScaledVector(a[5],1.092548*(s*i)),e.addScaledVector(a[6],.315392*(3*i*i-1)),e.addScaledVector(a[7],1.092548*(n*i)),e.addScaledVector(a[8],.546274*(n*n-s*s)),e}getIrradianceAt(t,e){const n=t.x,s=t.y,i=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.886227),e.addScaledVector(a[1],2*.511664*s),e.addScaledVector(a[2],2*.511664*i),e.addScaledVector(a[3],2*.511664*n),e.addScaledVector(a[4],2*.429043*n*s),e.addScaledVector(a[5],2*.429043*s*i),e.addScaledVector(a[6],.743125*i*i-.247708),e.addScaledVector(a[7],2*.429043*n*i),e.addScaledVector(a[8],.429043*(n*n-s*s)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(t,e+s*3);return this}toArray(t=[],e=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(t,e+s*3);return t}static getBasisAt(t,e){const n=t.x,s=t.y,i=t.z;e[0]=.282095,e[1]=.488603*s,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*s,e[5]=1.092548*s*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-s*s)}}class tP extends Wu{constructor(t=new J8,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}const Gh=-90,kh=1;class eP extends On{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Xi(Gh,kh,t,e);s.layers=this.layers,this.add(s);const i=new Xi(Gh,kh,t,e);i.layers=this.layers,this.add(i);const a=new Xi(Gh,kh,t,e);a.layers=this.layers,this.add(a);const c=new Xi(Gh,kh,t,e);c.layers=this.layers,this.add(c);const u=new Xi(Gh,kh,t,e);u.layers=this.layers,this.add(u);const d=new Xi(Gh,kh,t,e);d.layers=this.layers,this.add(d)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,s,i,a,c,u]=e;for(const d of e)this.remove(d);if(t===_r)n.up.set(0,1,0),n.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),c.up.set(0,1,0),c.lookAt(0,0,1),u.up.set(0,1,0),u.lookAt(0,0,-1);else if(t===Jr)n.up.set(0,-1,0),n.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),c.up.set(0,-1,0),c.lookAt(0,0,1),u.up.set(0,-1,0),u.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const d of e)this.add(d),d.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:s}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[i,a,c,u,d,f]=this.children,p=t.getRenderTarget(),g=t.getActiveCubeFace(),y=t.getActiveMipmapLevel(),x=t.xr.enabled;t.xr.enabled=!1;const S=n.texture.generateMipmaps;n.texture.generateMipmaps=!1;let T=!1;t.isWebGLRenderer===!0?T=t.state.buffers.depth.getReversed():T=t.reversedDepthBuffer,t.setRenderTarget(n,0,s),T&&t.autoClear===!1&&t.clearDepth(),t.render(e,i),t.setRenderTarget(n,1,s),T&&t.autoClear===!1&&t.clearDepth(),t.render(e,a),t.setRenderTarget(n,2,s),T&&t.autoClear===!1&&t.clearDepth(),t.render(e,c),t.setRenderTarget(n,3,s),T&&t.autoClear===!1&&t.clearDepth(),t.render(e,u),t.setRenderTarget(n,4,s),T&&t.autoClear===!1&&t.clearDepth(),t.render(e,d),n.texture.generateMipmaps=S,t.setRenderTarget(n,5,s),T&&t.autoClear===!1&&t.clearDepth(),t.render(e,f),t.setRenderTarget(p,g,y),t.xr.enabled=x,n.texture.needsPMREMUpdate=!0}}class nP extends Xi{constructor(t=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=t}}class sP{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1,Wt("THREE.Clock: This module has been deprecated. Please use THREE.Timer instead.")}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=performance.now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}class iP extends iC{constructor(t,e,n=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class hx{constructor(t,e,n,s){hx.prototype.isMatrix2=!0,this.elements=[1,0,0,1],t!==void 0&&this.set(t,e,n,s)}identity(){return this.set(1,0,0,1),this}fromArray(t,e=0){for(let n=0;n<4;n++)this.elements[n]=t[n+e];return this}set(t,e,n,s){const i=this.elements;return i[0]=t,i[2]=e,i[1]=n,i[3]=s,this}}function rP(r,t,e,n){const s=oP(n);switch(e){case q3:return r*t;case Wp:return r*t/s.components*s.byteLength;case ex:return r*t/s.components*s.byteLength;case Qo:return r*t*2/s.components*s.byteLength;case nx:return r*t*2/s.components*s.byteLength;case tx:return r*t*3/s.components*s.byteLength;case Ki:return r*t*4/s.components*s.byteLength;case sx:return r*t*4/s.components*s.byteLength;case hp:case dp:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*8;case fp:case pp:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*16;case O2:case U2:return Math.max(r,16)*Math.max(t,8)/4;case L2:case F2:return Math.max(r,8)*Math.max(t,8)/2;case ny:case sy:case ry:case oy:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*8;case iy:case Dp:case ay:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*16;case ly:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*16;case cy:return Math.floor((r+4)/5)*Math.floor((t+3)/4)*16;case uy:return Math.floor((r+4)/5)*Math.floor((t+4)/5)*16;case hy:return Math.floor((r+5)/6)*Math.floor((t+4)/5)*16;case dy:return Math.floor((r+5)/6)*Math.floor((t+5)/6)*16;case fy:return Math.floor((r+7)/8)*Math.floor((t+4)/5)*16;case py:return Math.floor((r+7)/8)*Math.floor((t+5)/6)*16;case my:return Math.floor((r+7)/8)*Math.floor((t+7)/8)*16;case gy:return Math.floor((r+9)/10)*Math.floor((t+4)/5)*16;case yy:return Math.floor((r+9)/10)*Math.floor((t+5)/6)*16;case xy:return Math.floor((r+9)/10)*Math.floor((t+7)/8)*16;case by:return Math.floor((r+9)/10)*Math.floor((t+9)/10)*16;case Sy:return Math.floor((r+11)/12)*Math.floor((t+9)/10)*16;case wy:return Math.floor((r+11)/12)*Math.floor((t+11)/12)*16;case Ty:case JF:case tU:return Math.ceil(r/4)*Math.ceil(t/4)*16;case _y:case My:return Math.ceil(r/4)*Math.ceil(t/4)*8;case Bp:case vy:return Math.ceil(r/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${e} format.`)}function oP(r){switch(r){case xi:case hd:return{byteLength:1,components:1};case Eu:case dd:case ii:return{byteLength:2,components:1};case H3:case W3:return{byteLength:2,components:4};case Jn:case pi:case Di:return{byteLength:4,components:1};case Nw:case Rw:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Hp}}));typeof window<"u"&&(window.__THREE__?Wt("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Hp);const aP=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],CS=new WeakMap;class lP{constructor(t){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(t),this.hasAnimation=t.object.isSkinnedMesh===!0,this.refreshUniforms=aP,this.renderId=0}firstInitialization(t){return this.renderObjects.has(t)===!1?(this.getRenderObjectData(t),!0):!1}needsVelocity(t){const e=t.getMRT();return e!==null&&e.has("velocity")}getRenderObjectData(t){let e=this.renderObjects.get(t);if(e===void 0){const{geometry:n,material:s,object:i}=t;if(e={material:this.getMaterialData(s),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexId:n.index?n.index.id:null,indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(e.center=i.center.clone()),i.morphTargetInfluences&&(e.morphTargetInfluences=i.morphTargetInfluences.slice()),t.bundle!==null&&(e.version=t.bundle.version),e.material.transmission>0){const{width:a,height:c}=t.context;e.bufferWidth=a,e.bufferHeight=c}e.lights=this.getLightsData(t.lightsNode.getLights()),this.renderObjects.set(t,e)}return e}getAttributesData(t){const e={};for(const n in t){const s=t[n];e[n]={id:s.id,version:s.version}}return e}containsNode(t){const e=t.material;for(const n in e)if(e[n]&&e[n].isNode)return!0;return!!(t.context.modelViewMatrix||t.context.modelNormalViewMatrix||t.context.getAO||t.context.getShadow)}getMaterialData(t){const e={};for(const n of this.refreshUniforms){const s=t[n];s!=null&&(typeof s=="object"&&s.clone!==void 0?s.isTexture===!0?e[n]={id:s.id,version:s.version}:e[n]=s.clone():e[n]=s)}return e}equals(t,e){const{object:n,material:s,geometry:i}=t,a=this.getRenderObjectData(t);if(a.worldMatrix.equals(n.matrixWorld)!==!0)return a.worldMatrix.copy(n.matrixWorld),!1;const c=a.material;for(const N in c){const v=c[N],A=s[N];if(v.equals!==void 0){if(v.equals(A)===!1)return v.copy(A),!1}else if(A.isTexture===!0){if(v.id!==A.id||v.version!==A.version)return v.id=A.id,v.version=A.version,!1}else if(v!==A)return c[N]=A,!1}if(c.transmission>0){const{width:N,height:v}=t.context;if(a.bufferWidth!==N||a.bufferHeight!==v)return a.bufferWidth=N,a.bufferHeight=v,!1}const u=a.geometry,d=i.attributes,f=u.attributes,p=Object.keys(f),g=Object.keys(d);if(u.id!==i.id)return u.id=i.id,!1;if(p.length!==g.length)return a.geometry.attributes=this.getAttributesData(d),!1;for(const N of p){const v=f[N],A=d[N];if(A===void 0)return delete f[N],!1;if(v.id!==A.id||v.version!==A.version)return v.id=A.id,v.version=A.version,!1}const y=i.index,x=u.id,S=u.indexVersion,T=y?y.id:null,M=y?y.version:null;if(x!==T||S!==M)return u.id=T,u.indexVersion=M,!1;if(u.drawRange.start!==i.drawRange.start||u.drawRange.count!==i.drawRange.count)return u.drawRange.start=i.drawRange.start,u.drawRange.count=i.drawRange.count,!1;if(a.morphTargetInfluences){let N=!1;for(let v=0;v<a.morphTargetInfluences.length;v++)a.morphTargetInfluences[v]!==n.morphTargetInfluences[v]&&(a.morphTargetInfluences[v]=n.morphTargetInfluences[v],N=!0);if(N)return!1}if(a.lights){for(let N=0;N<e.length;N++)if(a.lights[N].map!==e[N].map)return!1}return a.center&&a.center.equals(n.center)===!1?(a.center.copy(n.center),!0):(t.bundle!==null&&(a.version=t.bundle.version),!0)}getLightsData(t){const e=[];for(const n of t)n.isSpotLight===!0&&n.map!==null&&e.push({map:n.map.version});return e}getLights(t,e){if(CS.has(t)){const s=CS.get(t);if(s.renderId===e)return s.lightsData}const n=this.getLightsData(t.getLights());return CS.set(t,{renderId:e,lightsData:n}),n}needsRefresh(t,e){if(this.hasNode||this.hasAnimation||this.firstInitialization(t)||this.needsVelocity(e.renderer))return!0;const{renderId:n}=e;if(this.renderId!==n)return this.renderId=n,!0;const s=t.object.static===!0,i=t.bundle!==null&&t.bundle.static===!0&&this.getRenderObjectData(t).version===t.bundle.version;if(s||i)return!1;const a=this.getLights(t.lightsNode,n);return this.equals(t,a)!==!0}}const cP=[/^StackTrace\.js$/,/^TSLCore\.js$/,/^.*Node\.js$/,/^three\.webgpu.*\.js$/];function uP(r){const t=/(?:at\s+(.+?)\s+\()?(?:(.+?)@)?([^@\s()]+):(\d+):(\d+)/;return r.split(`
`).map(e=>{const n=e.match(t);if(!n)return null;const s=n[1]||n[2]||"",i=n[3].split("?")[0],a=parseInt(n[4],10),c=parseInt(n[5],10),u=i.split("/").pop();return{fn:s,file:u,line:a,column:c}}).filter(e=>e&&!cP.some(n=>n.test(e.file)))}class ps{constructor(t=null){this.isStackTrace=!0,this.stack=uP(t||new Error().stack)}getLocation(){if(this.stack.length===0)return"[Unknown location]";const t=this.stack[0],e=t.fn;return`${e?`"${e}()" at `:""}"${t.file}:${t.line}"`}getError(t){if(this.stack.length===0)return t;const e=this.stack.map(n=>{const s=`${n.file}:${n.line}:${n.column}`;return n.fn?`    at ${n.fn} (${s})`:`    at ${s}`}).join(`
`);return`${t}
${e}`}}function $w(r,t=0){let e=3735928559^t,n=1103547991^t;if(r instanceof Array)for(let s=0,i;s<r.length;s++)i=r[s],e=Math.imul(e^i,2654435761),n=Math.imul(n^i,1597334677);else for(let s=0,i;s<r.length;s++)i=r.charCodeAt(s),e=Math.imul(e^i,2654435761),n=Math.imul(n^i,1597334677);return e=Math.imul(e^e>>>16,2246822507),e^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(e^e>>>13,3266489909),4294967296*(2097151&n)+(e>>>0)}const Dd=r=>$w(r),Xp=r=>$w(r),Sp=(...r)=>$w(r),hP=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),QN=new WeakMap;function xC(r){return hP.get(r)}function By(r){if(/[iu]?vec\d/.test(r))return r.startsWith("ivec")?Int32Array:r.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(r)||/float/.test(r))return Float32Array;if(/uint/.test(r))return Uint32Array;if(/int/.test(r))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${r}`)}function bC(r){if(/float|int|uint/.test(r))return 1;if(/vec2/.test(r))return 2;if(/vec3/.test(r))return 3;if(/vec4/.test(r)||/mat2/.test(r))return 4;if(/mat3/.test(r))return 9;if(/mat4/.test(r))return 16;Ht(`TSL: Unsupported type: ${r}`,new ps)}function dP(r){if(/float|int|uint/.test(r))return 1;if(/vec2/.test(r))return 2;if(/vec3/.test(r))return 3;if(/vec4/.test(r)||/mat2/.test(r))return 4;if(/mat3/.test(r))return 12;if(/mat4/.test(r))return 16;Ht(`TSL: Unsupported type: ${r}`,new ps)}function fP(r){if(/float|int|uint/.test(r))return 4;if(/vec2/.test(r))return 8;if(/vec3/.test(r)||/vec4/.test(r))return 16;if(/mat2/.test(r))return 8;if(/mat3/.test(r)||/mat4/.test(r))return 16;Ht(`TSL: Unsupported type: ${r}`,new ps)}function xc(r){if(r==null)return null;const t=typeof r;return r.isNode===!0?"node":t==="number"?"float":t==="boolean"?"bool":t==="string"?"string":t==="function"?"shader":r.isVector2===!0?"vec2":r.isVector3===!0?"vec3":r.isVector4===!0?"vec4":r.isMatrix2===!0?"mat2":r.isMatrix3===!0?"mat3":r.isMatrix4===!0?"mat4":r.isColor===!0?"color":r instanceof ArrayBuffer?"ArrayBuffer":null}function Xw(r,...t){const e=r?r.slice(-4):void 0;return t.length===1&&(e==="vec2"?t=[t[0],t[0]]:e==="vec3"?t=[t[0],t[0],t[0]]:e==="vec4"&&(t=[t[0],t[0],t[0],t[0]])),r==="color"?new Xt(...t):e==="vec2"?new Ut(...t):e==="vec3"?new V(...t):e==="vec4"?new Ze(...t):e==="mat2"?new hx(...t):e==="mat3"?new rr(...t):e==="mat4"?new ve(...t):r==="bool"?t[0]||!1:r==="float"||r==="int"||r==="uint"?t[0]||0:r==="string"?t[0]||"":r==="ArrayBuffer"?mP(t[0]):null}function SC(r){let t=QN.get(r);return t===void 0&&(t={},QN.set(r,t)),t}function pP(r){let t="";const e=new Uint8Array(r);for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function mP(r){return Uint8Array.from(atob(r),t=>t.charCodeAt(0)).buffer}const sp={VERTEX:"vertex",FRAGMENT:"fragment"},de={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},gP={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},ri={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},wC=["fragment","vertex"],H2=["setup","analyze","generate"],W2=[...wC,"compute"],qu=["x","y","z","w"],yP={analyze:"setup",generate:"analyze"};let xP=0;class Jt extends Oc{static get type(){return"Node"}constructor(t=null){super(),this.nodeType=t,this.updateType=de.NONE,this.updateBeforeType=de.NONE,this.updateAfterType=de.NONE,this.uuid=St.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:xP++}),this.stackTrace=null,Jt.captureStackTrace===!0&&(this.stackTrace=new ps)}set needsUpdate(t){t===!0&&this.version++}get type(){return this.constructor.type}onUpdate(t,e){return this.updateType=e,this.update=t.bind(this),this}onFrameUpdate(t){return this.onUpdate(t,de.FRAME)}onRenderUpdate(t){return this.onUpdate(t,de.RENDER)}onObjectUpdate(t){return this.onUpdate(t,de.OBJECT)}onReference(t){return this.updateReference=t.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:t}of this._getChildren())yield t}dispose(){this.dispatchEvent({type:"dispose"})}traverse(t){t(this);for(const e of this.getChildren())e.traverse(t)}_getChildren(t=new Set){const e=[];t.add(this);for(const n of Object.getOwnPropertyNames(this)){const s=this[n];if(!(n.startsWith("_")===!0||t.has(s))){if(Array.isArray(s)===!0)for(let i=0;i<s.length;i++){const a=s[i];a&&a.isNode===!0&&e.push({property:n,index:i,childNode:a})}else if(s&&s.isNode===!0)e.push({property:n,childNode:s});else if(s&&Object.getPrototypeOf(s)===Object.prototype)for(const i in s){if(i.startsWith("_")===!0)continue;const a=s[i];a&&a.isNode===!0&&e.push({property:n,index:i,childNode:a})}}}return e}getCacheKey(t=!1,e=null){if(t=t||this.version!==this._cacheKeyVersion,t===!0||this._cacheKey===null){e===null&&(e=new Set);const n=[];for(const{property:s,childNode:i}of this._getChildren(e))n.push(Dd(s.slice(0,-4)),i.getCacheKey(t,e));this._cacheKey=Sp(Xp(n),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(t){const e=this.getNodeType(t);return t.getElementType(e)}getMemberType(){return"void"}getNodeType(t){const e=t.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(t):this.nodeType}getShared(t){const e=this.getHash(t);return t.getNodeFromHash(e)||this}getArrayCount(){return null}setup(t){const e=t.getNodeProperties(this);let n=0;for(const s of this.getChildren())e["node"+n++]=s;return e.outputNode||null}analyze(t,e=null){const n=t.increaseUsage(this);if(this.parents===!0){const s=t.getDataFromNode(this,"any");s.stages=s.stages||{},s.stages[t.shaderStage]=s.stages[t.shaderStage]||[],s.stages[t.shaderStage].push(e)}if(n===1){const s=t.getNodeProperties(this);for(const i of Object.values(s))i&&i.isNode===!0&&i.build(t,this)}}generate(t,e){const{outputNode:n}=t.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(t,e)}updateBefore(){Wt("Abstract function.")}updateAfter(){Wt("Abstract function.")}update(){Wt("Abstract function.")}before(t){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(t),this}build(t,e=null){const n=this.getShared(t);if(this!==n)return n.build(t,e);if(this._beforeNodes!==null){const u=this._beforeNodes;this._beforeNodes=null;for(const d of u)d.build(t,e);this._beforeNodes=u}const s=t.getDataFromNode(this);s.buildStages=s.buildStages||{},s.buildStages[t.buildStage]=!0;const i=yP[t.buildStage];if(i&&s.buildStages[i]!==!0){const u=t.getBuildStage();t.setBuildStage(i),this.build(t),t.setBuildStage(u)}t.addChain(this);let a=null;const c=t.getBuildStage();if(c==="setup"){t.addNode(this),this.updateReference(t);const u=t.getNodeProperties(this);if(u.initialized!==!0){u.initialized=!0,u.outputNode=this.setup(t)||u.outputNode||null;for(const d of Object.values(u))if(d&&d.isNode===!0){if(d.parents===!0){const f=t.getNodeProperties(d);f.parents=f.parents||[],f.parents.push(this)}d.build(t)}t.addSequentialNode(this)}a=u.outputNode}else if(c==="analyze")this.analyze(t,e);else if(c==="generate"){if(this.generate.length<2){const d=this.getNodeType(t),f=t.getDataFromNode(this);a=f.snippet,a===void 0?f.generated===void 0?(f.generated=!0,a=this.generate(t)||"",f.snippet=a):(Wt("Node: Recursion detected.",this),a="/* Recursion detected. */"):f.flowCodes!==void 0&&t.context.nodeBlock!==void 0&&t.addFlowCodeHierarchy(this,t.context.nodeBlock),a=t.format(a,d,e)}else a=this.generate(t,e)||"";a===""&&e!==null&&e!=="void"&&e!=="OutputType"&&(Ht(`TSL: Invalid generated code, expected a "${e}".`),a=t.generateConst(e))}return t.removeChain(this),a}getSerializeChildren(){return this._getChildren()}serialize(t){const e=this.getSerializeChildren(),n={};for(const{property:s,index:i,childNode:a}of e)i!==void 0?(n[s]===void 0&&(n[s]=Number.isInteger(i)?[]:{}),n[s][i]=a.toJSON(t.meta).uuid):n[s]=a.toJSON(t.meta).uuid;Object.keys(n).length>0&&(t.inputNodes=n)}deserialize(t){if(t.inputNodes!==void 0){const e=t.meta.nodes;for(const n in t.inputNodes)if(Array.isArray(t.inputNodes[n])){const s=[];for(const i of t.inputNodes[n])s.push(e[i]);this[n]=s}else if(typeof t.inputNodes[n]=="object"){const s={};for(const i in t.inputNodes[n]){const a=t.inputNodes[n][i];s[i]=e[a]}this[n]=s}else{const s=t.inputNodes[n];this[n]=e[s]}}}toJSON(t){const{uuid:e,type:n}=this,s=t===void 0||typeof t=="string";s&&(t={textures:{},images:{},nodes:{}});let i=t.nodes[e];i===void 0&&(i={uuid:e,type:n,meta:t,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},s!==!0&&(t.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function a(c){const u=[];for(const d in c){const f=c[d];delete f.metadata,u.push(f)}return u}if(s){const c=a(t.textures),u=a(t.images),d=a(t.nodes);c.length>0&&(i.textures=c),u.length>0&&(i.images=u),d.length>0&&(i.nodes=d)}return i}}Jt.captureStackTrace=!1;class $u extends Jt{static get type(){return"ArrayElementNode"}constructor(t,e){super(),this.node=t,this.indexNode=e,this.isArrayElementNode=!0}getNodeType(t){return this.node.getElementType(t)}getMemberType(t,e){return this.node.getMemberType(t,e)}generate(t){const e=this.indexNode.getNodeType(t),n=this.node.build(t),s=this.indexNode.build(t,!t.isVector(e)&&t.isInteger(e)?e:"uint");return`${n}[ ${s} ]`}}class TC extends Jt{static get type(){return"ConvertNode"}constructor(t,e){super(),this.node=t,this.convertTo=e}getNodeType(t){const e=this.node.getNodeType(t);let n=null;for(const s of this.convertTo.split("|"))(n===null||t.getTypeLength(e)===t.getTypeLength(s))&&(n=s);return n}serialize(t){super.serialize(t),t.convertTo=this.convertTo}deserialize(t){super.deserialize(t),this.convertTo=t.convertTo}generate(t,e){const n=this.node,s=this.getNodeType(t),i=n.build(t,s);return t.format(i,s,e)}}class rs extends Jt{static get type(){return"TempNode"}constructor(t=null){super(t),this.isTempNode=!0}hasDependencies(t){return t.getDataFromNode(this).usageCount>1}build(t,e){if(t.getBuildStage()==="generate"){const s=t.getVectorType(this.getNodeType(t,e)),i=t.getDataFromNode(this);if(i.propertyName!==void 0)return t.format(i.propertyName,s,e);if(s!=="void"&&e!=="void"&&this.hasDependencies(t)){const a=super.build(t,s),c=t.getVarFromNode(this,null,s),u=t.getPropertyName(c);return t.addLineFlowCode(`${u} = ${a}`,this),i.snippet=a,i.propertyName=u,t.format(i.propertyName,s,e)}}return super.build(t,e)}}class bP extends rs{static get type(){return"JoinNode"}constructor(t=[],e=null){super(e),this.nodes=t}getNodeType(t){return this.nodeType!==null?t.getVectorType(this.nodeType):t.getTypeFromLength(this.nodes.reduce((e,n)=>e+t.getTypeLength(n.getNodeType(t)),0))}generate(t,e){const n=this.getNodeType(t),s=t.getTypeLength(n),i=this.nodes,a=t.getComponentType(n),c=[];let u=0;for(const f of i){if(u>=s){Ht(`TSL: Length of parameters exceeds maximum length of function '${n}()' type.`,this.stackTrace);break}let p=f.getNodeType(t),g=t.getTypeLength(p),y;if(u+g>s&&(Ht(`TSL: Length of '${n}()' data exceeds maximum length of output type.`,this.stackTrace),g=s-u,p=t.getTypeFromLength(g)),u+=g,y=f.build(t,p),t.getComponentType(p)!==a){const S=t.getTypeFromLength(g,a);y=t.format(y,p,S)}c.push(y)}const d=`${t.getType(n)}( ${c.join(", ")} )`;return t.format(d,n,e)}}const SP=qu.join("");class _C extends Jt{static get type(){return"SplitNode"}constructor(t,e="x"){super(),this.node=t,this.components=e,this.isSplitNode=!0}getVectorLength(){let t=this.components.length;for(const e of this.components)t=Math.max(qu.indexOf(e)+1,t);return t}getComponentType(t){return t.getComponentType(this.node.getNodeType(t))}getNodeType(t){return t.getTypeFromLength(this.components.length,this.getComponentType(t))}getScope(){return this.node.getScope()}generate(t,e){const n=this.node,s=t.getTypeLength(n.getNodeType(t));let i=null;if(s>1){let a=null;this.getVectorLength()>=s&&(a=t.getTypeFromLength(this.getVectorLength(),this.getComponentType(t)));const u=n.build(t,a);this.components.length===s&&this.components===SP.slice(0,this.components.length)?i=t.format(u,a,e):i=t.format(`${u}.${this.components}`,this.getNodeType(t),e)}else i=n.build(t,e);return i}serialize(t){super.serialize(t),t.components=this.components}deserialize(t){super.deserialize(t),this.components=t.components}}class wP extends rs{static get type(){return"SetNode"}constructor(t,e,n){super(),this.sourceNode=t,this.components=e,this.targetNode=n}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{sourceNode:e,components:n,targetNode:s}=this,i=this.getNodeType(t),a=t.getComponentType(s.getNodeType(t)),c=t.getTypeFromLength(n.length,a),u=s.build(t,c),d=e.build(t,i),f=t.getTypeLength(i),p=[];for(let g=0;g<f;g++){const y=qu[g];y===n[0]?(p.push(u),g+=n.length-1):p.push(d+"."+y)}return`${t.getType(i)}( ${p.join(", ")} )`}}class TP extends rs{static get type(){return"FlipNode"}constructor(t,e){super(),this.sourceNode=t,this.components=e}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{components:e,sourceNode:n}=this,s=this.getNodeType(t),i=n.build(t),a=t.getVarFromNode(this),c=t.getPropertyName(a);t.addLineFlowCode(c+" = "+i,this);const u=t.getTypeLength(s),d=[];let f=0;for(let p=0;p<u;p++){const g=qu[p];g===e[f]?(d.push("1.0 - "+(c+"."+g)),f++):d.push(c+"."+g)}return`${t.getType(s)}( ${d.join(", ")} )`}}class jw extends Jt{static get type(){return"InputNode"}constructor(t,e=null){super(e),this.isInputNode=!0,this.value=t,this.precision=null}getNodeType(){return this.nodeType===null?xc(this.value):this.nodeType}getInputType(t){return this.getNodeType(t)}setPrecision(t){return this.precision=t,this}serialize(t){super.serialize(t),t.value=this.value,this.value&&this.value.toArray&&(t.value=this.value.toArray()),t.valueType=xc(this.value),t.nodeType=this.nodeType,t.valueType==="ArrayBuffer"&&(t.value=pP(t.value)),t.precision=this.precision}deserialize(t){super.deserialize(t),this.nodeType=t.nodeType,this.value=Array.isArray(t.value)?Xw(t.valueType,...t.value):t.value,this.precision=t.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(t.value))}generate(){Wt("Abstract function.")}}const JN=/float|u?int/;class io extends jw{static get type(){return"ConstNode"}constructor(t,e=null){super(t,e),this.isConstNode=!0}generateConst(t){return t.generateConst(this.getNodeType(t),this.value)}generate(t,e){const n=this.getNodeType(t);return JN.test(n)&&JN.test(e)?t.generateConst(e,this.value):t.format(this.generateConst(t),n,e)}}class _P extends Jt{static get type(){return"MemberNode"}constructor(t,e){super(),this.structNode=t,this.property=e,this.isMemberNode=!0}hasMember(t){return this.structNode.isMemberNode&&this.structNode.hasMember(t)===!1?!1:this.structNode.getMemberType(t,this.property)!=="void"}getNodeType(t){return this.hasMember(t)===!1?"float":this.structNode.getMemberType(t,this.property)}getMemberType(t,e){if(this.hasMember(t)===!1)return"float";const n=this.getNodeType(t);return t.getStructTypeNode(n).getMemberType(t,e)}generate(t){if(this.hasMember(t)===!1){Wt(`TSL: Member "${this.property}" does not exist in struct.`,this.stackTrace);const n=this.getNodeType(t);return t.generateConst(n)}return this.structNode.build(t)+"."+this.property}}let Cc=null;const q2=new Map;function Bt(r,t){if(q2.has(r)){Wt(`TSL: Redefinition of method chaining '${r}'.`);return}if(typeof t!="function")throw new Error(`THREE.TSL: Node element ${r} is not a function`);q2.set(r,t),r!=="assign"&&(Jt.prototype[r]=function(...e){return this.isStackNode?this.addToStack(t(...e)):t(this,...e)},Jt.prototype[r+"Assign"]=function(...e){return this.isStackNode?this.assign(e[0],t(...e)):this.assign(t(this,...e))})}const MP=r=>r.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),tR=r=>MP(r).split("").sort().join("");Jt.prototype.assign=function(...r){if(this.isStackNode!==!0)return Cc!==null?Cc.assign(this,...r):Ht("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn().",new ps),this;{const t=q2.get("assign");return this.addToStack(t(...r))}};Jt.prototype.toVarIntent=function(){return this};Jt.prototype.get=function(r){return new _P(this,r)};const wp={};function Gm(r,t,e){wp[r]=wp[t]=wp[e]={get(){this._cache=this._cache||{};let a=this._cache[r];return a===void 0&&(a=new _C(this,r),this._cache[r]=a),a},set(a){this[r].assign(Qt(a))}};const n=r.toUpperCase(),s=t.toUpperCase(),i=e.toUpperCase();Jt.prototype["set"+n]=Jt.prototype["set"+s]=Jt.prototype["set"+i]=function(a){const c=tR(r);return new wP(this,c,Qt(a))},Jt.prototype["flip"+n]=Jt.prototype["flip"+s]=Jt.prototype["flip"+i]=function(){const a=tR(r);return new TP(this,a)}}const Vo=["x","y","z","w"],Go=["r","g","b","a"],ko=["s","t","p","q"];for(let r=0;r<4;r++){let t=Vo[r],e=Go[r],n=ko[r];Gm(t,e,n);for(let s=0;s<4;s++){t=Vo[r]+Vo[s],e=Go[r]+Go[s],n=ko[r]+ko[s],Gm(t,e,n);for(let i=0;i<4;i++){t=Vo[r]+Vo[s]+Vo[i],e=Go[r]+Go[s]+Go[i],n=ko[r]+ko[s]+ko[i],Gm(t,e,n);for(let a=0;a<4;a++)t=Vo[r]+Vo[s]+Vo[i]+Vo[a],e=Go[r]+Go[s]+Go[i]+Go[a],n=ko[r]+ko[s]+ko[i]+ko[a],Gm(t,e,n)}}}for(let r=0;r<32;r++)wp[r]={get(){this._cache=this._cache||{};let t=this._cache[r];return t===void 0&&(t=new $u(this,new io(r,"uint")),this._cache[r]=t),t},set(t){this[r].assign(Qt(t))}};Object.defineProperties(Jt.prototype,wp);const eR=new WeakMap,vP=function(r,t=null){const e=xc(r);return e==="node"?r:t===null&&(e==="float"||e==="boolean")||e&&e!=="shader"&&e!=="string"?Qt($2(r,t)):e==="shader"?r.isFn?r:ot(r):r},AP=function(r,t=null){for(const e in r)r[e]=Qt(r[e],t);return r},NP=function(r,t=null){const e=r.length;for(let n=0;n<e;n++)r[n]=Qt(r[n],t);return r},MC=function(r,t=null,e=null,n=null){function s(f){return n!==null?(f=Qt(Object.assign(f,n)),n.intent===!0&&(f=f.toVarIntent())):f=Qt(f),f}let i,a=t,c,u;function d(f){let p;return a?p=/[a-z]/i.test(a)?a+"()":a:p=r.type,c!==void 0&&f.length<c?(Ht(`TSL: "${p}" parameter length is less than minimum required.`,new ps),f.concat(new Array(c-f.length).fill(0))):u!==void 0&&f.length>u?(Ht(`TSL: "${p}" parameter length exceeds limit.`,new ps),f.slice(0,u)):f}return t===null?i=(...f)=>s(new r(...Fu(d(f)))):e!==null?(e=Qt(e),i=(...f)=>s(new r(t,...Fu(d(f)),e))):i=(...f)=>s(new r(t,...Fu(d(f)))),i.setParameterLength=(...f)=>(f.length===1?c=u=f[0]:f.length===2&&([c,u]=f),i),i.setName=f=>(a=f,i),i},RP=function(r,...t){return new r(...Fu(t))};class EP extends Jt{constructor(t,e){super(),this.shaderNode=t,this.rawInputs=e,this.isShaderCallNodeInternal=!0}getNodeType(t){return this.shaderNode.nodeType||this.getOutputNode(t).getNodeType(t)}getElementType(t){return this.getOutputNode(t).getElementType(t)}getMemberType(t,e){return this.getOutputNode(t).getMemberType(t,e)}call(t){const{shaderNode:e,rawInputs:n}=this,s=t.getNodeProperties(e),i=t.getClosestSubBuild(e.subBuilds)||"",a=i||"default";if(s[a])return s[a];const c=t.subBuildFn,u=t.fnCall;t.subBuildFn=i,t.fnCall=this;let d=null;if(e.layout){let f=eR.get(t.constructor);f===void 0&&(f=new WeakMap,eR.set(t.constructor,f));let p=f.get(e);p===void 0&&(p=Qt(t.buildFunctionNode(e)),f.set(e,p)),t.addInclude(p);const g=n?CP(n):null;d=Qt(p.call(g))}else{const f=new Proxy(t,{get:(S,T,M)=>{let N;return Symbol.iterator===T?N=function*(){yield void 0}:N=Reflect.get(S,T,M),N}}),p=n?DP(n):null,g=Array.isArray(n)?n.length>0:n!==null,y=e.jsFunc,x=g||y.length>1?y(p,f):y(f);d=Qt(x)}return t.subBuildFn=c,t.fnCall=u,e.once&&(s[a]=d),d}setupOutput(t){return t.addStack(),t.stack.outputNode=this.call(t),t.removeStack()}getOutputNode(t){const e=t.getNodeProperties(this),n=t.getSubBuildOutput(this);return e[n]=e[n]||this.setupOutput(t),e[n].subBuild=t.getClosestSubBuild(this),e[n]}build(t,e=null){let n=null;const s=t.getBuildStage(),i=t.getNodeProperties(this),a=t.getSubBuildOutput(this),c=this.getOutputNode(t),u=t.fnCall;if(t.fnCall=this,s==="setup"){const d=t.getSubBuildProperty("initialized",this);if(i[d]!==!0&&(i[d]=!0,i[a]=this.getOutputNode(t),i[a].build(t),this.shaderNode.subBuilds))for(const f of t.chaining){const p=t.getDataFromNode(f,"any");p.subBuilds=p.subBuilds||new Set;for(const g of this.shaderNode.subBuilds)p.subBuilds.add(g)}n=i[a]}else s==="analyze"?c.build(t,e):s==="generate"&&(n=c.build(t,e)||"");return t.fnCall=u,n}}function CP(r){let t;return px(r),r[0]&&(r[0].isNode||Object.getPrototypeOf(r[0])!==Object.prototype)?t=[...r]:t=r[0],t}function DP(r){let t=0;return px(r),new Proxy(r,{get:(e,n,s)=>{let i;if(n==="length")return i=r.length,i;if(Symbol.iterator===n)i=function*(){for(const a of r)yield Qt(a)};else{if(r.length>0)if(Object.getPrototypeOf(r[0])===Object.prototype){const a=r[0];a[n]===void 0?i=a[t++]:i=Reflect.get(a,n,s)}else r[0]instanceof Jt&&(r[n]===void 0?i=r[t++]:i=Reflect.get(r,n,s));else i=Reflect.get(e,n,s);i=Qt(i)}return i}})}class BP extends Jt{constructor(t,e){super(e),this.jsFunc=t,this.layout=null,this.global=!0,this.once=!1}setLayout(t){return this.layout=t,this}getLayout(){return this.layout}call(t=null){return new EP(this,t)}setup(){return this.call()}}const LP=[!1,!0],OP=[0,1,2,3],FP=[-1,-2],vC=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],Yw=new Map;for(const r of LP)Yw.set(r,new io(r));const Kw=new Map;for(const r of OP)Kw.set(r,new io(r,"uint"));const Zw=new Map([...Kw].map(r=>new io(r.value,"int")));for(const r of FP)Zw.set(r,new io(r,"int"));const dx=new Map([...Zw].map(r=>new io(r.value)));for(const r of vC)dx.set(r,new io(r));for(const r of vC)dx.set(-r,new io(-r));const fx={bool:Yw,uint:Kw,ints:Zw,float:dx},nR=new Map([...Yw,...dx]),$2=(r,t)=>nR.has(r)?nR.get(r):r.isNode===!0?r:new io(r,t),Ds=function(r,t=null){return(...e)=>{for(const s of e)if(s===void 0)return Ht(`TSL: Invalid parameter for the type "${r}".`,new ps),new io(0,r);if((e.length===0||!["bool","float","int","uint"].includes(r)&&e.every(s=>{const i=typeof s;return i!=="object"&&i!=="function"}))&&(e=[Xw(r,...e)]),e.length===1&&t!==null&&t.has(e[0]))return ip(t.get(e[0]));if(e.length===1){const s=$2(e[0],r);return s.nodeType===r?ip(s):ip(new TC(s,r))}const n=e.map(s=>$2(s));return ip(new bP(n,r))}},Pp=r=>typeof r=="object"&&r!==null?r.value:r,AC=r=>r!=null?r.nodeType||r.convertTo||(typeof r=="string"?r:null):null;function cd(r,t){return new BP(r,t)}const Qt=(r,t=null)=>vP(r,t),ip=(r,t=null)=>Qt(r,t).toVarIntent(),px=(r,t=null)=>new AP(r,t),Fu=(r,t=null)=>new NP(r,t),be=(r,t=null,e=null,n=null)=>new MC(r,t,e,n),$t=(r,...t)=>new RP(r,...t),kt=(r,t=null,e=null,n={})=>new MC(r,t,e,{...n,intent:!0});let UP=0;class PP extends Jt{constructor(t,e=null){super();let n=null;e!==null&&(typeof e=="object"?n=e.return:(typeof e=="string"?n=e:Ht("TSL: Invalid layout type.",new ps),e=null)),this.shaderNode=new cd(t,n),e!==null&&this.setLayout(e),this.isFn=!0}setLayout(t){const e=this.shaderNode.nodeType;if(typeof t.inputs!="object"){const n={name:"fn"+UP++,type:e,inputs:[]};for(const s in t)s!=="return"&&n.inputs.push({name:s,type:t[s]});t=n}return this.shaderNode.setLayout(t),this}getNodeType(t){return this.shaderNode.getNodeType(t)||"float"}call(...t){const e=this.shaderNode.call(t);return this.shaderNode.nodeType==="void"&&e.toStack(),e.toVarIntent()}once(t=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=t,this}generate(t){const e=this.getNodeType(t);return Ht('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".',this.stackTrace),t.generateConst(e)}}function ot(r,t=null){const e=new PP(r,t);return new Proxy(()=>{},{apply(n,s,i){return e.call(...i)},get(n,s,i){return Reflect.get(e,s,i)},set(n,s,i,a){return Reflect.set(e,s,i,a)}})}const zp=r=>{Cc=r},Qw=()=>Cc,re=(...r)=>Cc.If(...r),zP=(...r)=>Cc.Switch(...r);function mx(r){return Cc&&Cc.addToStack(r),r}Bt("toStack",mx);const NC=new Ds("color"),G=new Ds("float",fx.float),Q=new Ds("int",fx.ints),zt=new Ds("uint",fx.uint),eo=new Ds("bool",fx.bool),Vt=new Ds("vec2"),Cs=new Ds("ivec2"),Jw=new Ds("uvec2"),RC=new Ds("bvec2"),st=new Ds("vec3"),tT=new Ds("ivec3"),Xu=new Ds("uvec3"),eT=new Ds("bvec3"),ie=new Ds("vec4"),nT=new Ds("ivec4"),sT=new Ds("uvec4"),EC=new Ds("bvec4"),gx=new Ds("mat2"),qs=new Ds("mat3"),vc=new Ds("mat4"),IP=(r="")=>new io(r,"string"),VP=r=>new io(r,"ArrayBuffer");Bt("toColor",NC);Bt("toFloat",G);Bt("toInt",Q);Bt("toUint",zt);Bt("toBool",eo);Bt("toVec2",Vt);Bt("toIVec2",Cs);Bt("toUVec2",Jw);Bt("toBVec2",RC);Bt("toVec3",st);Bt("toIVec3",tT);Bt("toUVec3",Xu);Bt("toBVec3",eT);Bt("toVec4",ie);Bt("toIVec4",nT);Bt("toUVec4",sT);Bt("toBVec4",EC);Bt("toMat2",gx);Bt("toMat3",qs);Bt("toMat4",vc);const CC=be($u).setParameterLength(2),DC=(r,t)=>new TC(Qt(r),t),GP=(r,t)=>new _C(Qt(r),t);Bt("element",CC);Bt("convert",DC);const kP=r=>(Wt("TSL: append() has been renamed to Stack().",new ps),mx(r));Bt("append",r=>(Wt("TSL: .append() has been renamed to .toStack().",new ps),mx(r)));class Je extends Jt{static get type(){return"PropertyNode"}constructor(t,e=null,n=!1){super(t),this.name=e,this.varying=n,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return Dd(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(t){return this.name||super.getHash(t)}generate(t){let e;return this.varying===!0?(e=t.getVaryingFromNode(this,this.name),e.needsInterpolation=!0):e=t.getVarFromNode(this,this.name),t.getPropertyName(e)}}const cl=(r,t)=>new Je(r,t),Ip=(r,t)=>new Je(r,t,!0),on=$t(Je,"vec4","DiffuseColor"),Au=$t(Je,"vec3","DiffuseContribution"),X2=$t(Je,"vec3","EmissiveColor"),Zo=$t(Je,"float","Roughness"),il=$t(Je,"float","Metalness"),Ly=$t(Je,"float","Clearcoat"),pd=$t(Je,"float","ClearcoatRoughness"),br=$t(Je,"vec3","Sheen"),dc=$t(Je,"float","SheenRoughness"),yx=$t(Je,"float","Iridescence"),Oy=$t(Je,"float","IridescenceIOR"),Fy=$t(Je,"float","IridescenceThickness"),Uy=$t(Je,"float","AlphaT"),uc=$t(Je,"float","Anisotropy"),Tp=$t(Je,"vec3","AnisotropyT"),Uu=$t(Je,"vec3","AnisotropyB"),Dc=$t(Je,"color","SpecularColor"),Cu=$t(Je,"color","SpecularColorBlended"),Du=$t(Je,"float","SpecularF90"),Py=$t(Je,"float","Shininess"),md=$t(Je,"vec4","Output"),Ig=$t(Je,"float","dashSize"),j2=$t(Je,"float","gapSize"),HP=$t(Je,"float","pointWidth"),_p=$t(Je,"float","IOR"),zy=$t(Je,"float","Transmission"),iT=$t(Je,"float","Thickness"),rT=$t(Je,"float","AttenuationDistance"),oT=$t(Je,"color","AttenuationColor"),aT=$t(Je,"float","Dispersion");class BC extends Jt{static get type(){return"UniformGroupNode"}constructor(t,e=!1,n=1){super("string"),this.name=t,this.shared=e,this.order=n,this.isUniformGroup=!0}serialize(t){super.serialize(t),t.name=this.name,t.version=this.version,t.shared=this.shared}deserialize(t){super.deserialize(t),this.name=t.name,this.version=t.version,this.shared=t.shared}}const LC=r=>new BC(r),xx=(r,t=0)=>new BC(r,!0,t),OC=xx("frame"),ne=xx("render"),lT=LC("object");class jp extends jw{static get type(){return"UniformNode"}constructor(t,e=null){super(t,e),this.isUniformNode=!0,this.name="",this.groupNode=lT}setName(t){return this.name=t,this}label(t){return Wt('TSL: "label()" has been deprecated. Use "setName()" instead.',new ps),this.setName(t)}setGroup(t){return this.groupNode=t,this}getGroup(){return this.groupNode}getUniformHash(t){return this.getHash(t)}onUpdate(t,e){return t=t.bind(this),super.onUpdate(n=>{const s=t(n,this);s!==void 0&&(this.value=s)},e)}getInputType(t){let e=super.getInputType(t);return e==="bool"&&(e="uint"),e}generate(t,e){const n=this.getNodeType(t),s=this.getUniformHash(t);let i=t.getNodeFromHash(s);i===void 0&&(t.setHashNode(this,s),i=this);const a=i.getInputType(t),c=t.getUniformFromNode(i,a,t.shaderStage,this.name||t.context.nodeName),u=t.getPropertyName(c);t.context.nodeName!==void 0&&delete t.context.nodeName;let d=u;if(n==="bool"){const f=t.getDataFromNode(this);let p=f.propertyName;if(p===void 0){const g=t.getVarFromNode(this,null,"bool");p=t.getPropertyName(g),f.propertyName=p,d=t.format(u,a,n),t.addLineFlowCode(`${p} = ${d}`,this)}d=p}return t.format(d,n,e)}}const te=(r,t)=>{const e=AC(t||r);if(e===r&&(r=Xw(e)),r&&r.isNode===!0){let n=r.value;r.traverse(s=>{s.isConstNode===!0&&(n=s.value)}),r=n}return new jp(r,e)};class sR extends rs{static get type(){return"ArrayNode"}constructor(t,e,n=null){super(t),this.count=e,this.values=n,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(t){return this.nodeType===null?this.values[0].getNodeType(t):this.nodeType}getElementType(t){return this.getNodeType(t)}getMemberType(t,e){return this.nodeType===null?this.values[0].getMemberType(t,e):super.getMemberType(t,e)}generate(t){const e=this.getNodeType(t);return t.generateArray(e,this.count,this.values)}}const FC=(...r)=>{let t;if(r.length===1){const e=r[0];t=new sR(null,e.length,e)}else{const e=r[0],n=r[1];t=new sR(e,n)}return Qt(t)};Bt("toArray",(r,t)=>FC(Array(t).fill(r)));class WP extends rs{static get type(){return"AssignNode"}constructor(t,e){super(),this.targetNode=t,this.sourceNode=e,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(t,e){return e!=="void"?this.targetNode.getNodeType(t):"void"}needsSplitAssign(t){const{targetNode:e}=this;if(t.isAvailable("swizzleAssign")===!1&&e.isSplitNode&&e.components.length>1){const n=t.getTypeLength(e.node.getNodeType(t));return qu.join("").slice(0,n)!==e.components}return!1}setup(t){const{targetNode:e,sourceNode:n}=this,s=e.getScope(),i=t.getDataFromNode(s);i.assign=!0;const a=t.getNodeProperties(this);a.sourceNode=n,a.targetNode=e.context({assign:!0})}generate(t,e){const{targetNode:n,sourceNode:s}=t.getNodeProperties(this),i=this.needsSplitAssign(t),a=n.build(t),c=n.getNodeType(t),u=s.build(t,c),d=s.getNodeType(t),f=t.getDataFromNode(this);let p;if(f.initialized===!0)e!=="void"&&(p=a);else if(i){const g=t.getVarFromNode(this,null,c),y=t.getPropertyName(g);t.addLineFlowCode(`${y} = ${u}`,this);const x=n.node,T=x.node.context({assign:!0}).build(t);for(let M=0;M<x.components.length;M++){const N=x.components[M];t.addLineFlowCode(`${T}.${N} = ${y}[ ${M} ]`,this)}e!=="void"&&(p=a)}else p=`${a} = ${u}`,(e==="void"||d==="void")&&(t.addLineFlowCode(p,this),e!=="void"&&(p=a));return f.initialized=!0,t.format(p,c,e)}}const UC=be(WP).setParameterLength(2);Bt("assign",UC);class qP extends rs{static get type(){return"FunctionCallNode"}constructor(t=null,e={}){super(),this.functionNode=t,this.parameters=e}setParameters(t){return this.parameters=t,this}getParameters(){return this.parameters}getNodeType(t){return this.functionNode.getNodeType(t)}getMemberType(t,e){return this.functionNode.getMemberType(t,e)}generate(t){const e=[],n=this.functionNode,s=n.getInputs(t),i=this.parameters,a=(u,d)=>{const f=d.type,p=f==="pointer";let g;return p?g="&"+u.build(t):g=u.build(t,f),g};if(Array.isArray(i)){if(i.length>s.length)Ht("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),i.length=s.length;else if(i.length<s.length)for(Ht("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");i.length<s.length;)i.push(G(0));for(let u=0;u<i.length;u++)e.push(a(i[u],s[u]))}else for(const u of s){const d=i[u.name];d!==void 0?e.push(a(d,u)):(Ht(`TSL: Input '${u.name}' not found in 'Fn()'.`),e.push(a(G(0),u)))}return`${n.build(t,"property")}( ${e.join(", ")} )`}}const PC=(r,...t)=>(t=t.length>1||t[0]&&t[0].isNode===!0?Fu(t):px(t[0]),new qP(Qt(r),t));Bt("call",PC);const $P={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class qn extends rs{static get type(){return"OperatorNode"}constructor(t,e,n,...s){if(super(),s.length>0){let i=new qn(t,e,n);for(let a=0;a<s.length-1;a++)i=new qn(t,i,s[a]);e=i,n=s[s.length-1]}this.op=t,this.aNode=e,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(t,e){return t.getMethod($P[this.op],e)}getNodeType(t,e=null){const n=this.op,s=this.aNode,i=this.bNode,a=s.getNodeType(t),c=i?i.getNodeType(t):null;if(a==="void"||c==="void")return e||"void";if(n==="%")return a;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return t.getIntegerType(a);if(n==="!"||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">="){const u=Math.max(t.getTypeLength(a),t.getTypeLength(c));return u>1?`bvec${u}`:"bool"}else{if(t.isMatrix(a)){if(c==="float")return a;if(t.isVector(c))return t.getVectorFromMatrix(a);if(t.isMatrix(c))return a}else if(t.isMatrix(c)){if(a==="float")return c;if(t.isVector(a))return t.getVectorFromMatrix(c)}return t.getTypeLength(c)>t.getTypeLength(a)?c:a}}generate(t,e){const n=this.op,{aNode:s,bNode:i}=this,a=this.getNodeType(t,e);let c=null,u=null;a!=="void"?(c=s.getNodeType(t),u=i?i.getNodeType(t):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?t.isVector(c)?u=c:t.isVector(u)?c=u:c!==u&&(c=u="float"):n===">>"||n==="<<"?(c=a,u=t.changeComponentType(u,"uint")):n==="%"?(c=a,u=t.isInteger(c)&&t.isInteger(u)?u:c):t.isMatrix(c)?u==="float"?u="float":t.isVector(u)?u=t.getVectorFromMatrix(c):t.isMatrix(u)||(c=u=a):t.isMatrix(u)?c==="float"?c="float":t.isVector(c)?c=t.getVectorFromMatrix(u):c=u=a:c=u=a):c=u=a;const d=s.build(t,c),f=i?i.build(t,u):null,p=t.getFunctionOperator(n);if(e!=="void"){const g=t.renderer.coordinateSystem===_r;if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">=")return g?t.isVector(c)?t.format(`${this.getOperatorMethod(t,e)}( ${d}, ${f} )`,a,e):t.format(`( ${d} ${n} ${f} )`,a,e):t.format(`( ${d} ${n} ${f} )`,a,e);if(n==="%")return t.isInteger(u)?t.format(`( ${d} % ${f} )`,a,e):t.format(`${this.getOperatorMethod(t,a)}( ${d}, ${f} )`,a,e);if(n==="!"||n==="~")return t.format(`(${n}${d})`,c,e);if(p)return t.format(`${p}( ${d}, ${f} )`,a,e);if(t.isMatrix(c)&&u==="float")return t.format(`( ${f} ${n} ${d} )`,a,e);if(c==="float"&&t.isMatrix(u))return t.format(`${d} ${n} ${f}`,a,e);{let y=`( ${d} ${n} ${f} )`;return!g&&a==="bool"&&t.isVector(c)&&t.isVector(u)&&(y=`all${y}`),t.format(y,a,e)}}else if(c!=="void")return p?t.format(`${p}( ${d}, ${f} )`,a,e):t.isMatrix(c)&&u==="float"?t.format(`${f} ${n} ${d}`,a,e):t.format(`${d} ${n} ${f}`,a,e)}serialize(t){super.serialize(t),t.op=this.op}deserialize(t){super.deserialize(t),this.op=t.op}}const ws=kt(qn,"+").setParameterLength(2,1/0).setName("add"),Oe=kt(qn,"-").setParameterLength(2,1/0).setName("sub"),fe=kt(qn,"*").setParameterLength(2,1/0).setName("mul"),Nr=kt(qn,"/").setParameterLength(2,1/0).setName("div"),Yp=kt(qn,"%").setParameterLength(2).setName("mod"),zC=kt(qn,"==").setParameterLength(2).setName("equal"),IC=kt(qn,"!=").setParameterLength(2).setName("notEqual"),VC=kt(qn,"<").setParameterLength(2).setName("lessThan"),cT=kt(qn,">").setParameterLength(2).setName("greaterThan"),GC=kt(qn,"<=").setParameterLength(2).setName("lessThanEqual"),kC=kt(qn,">=").setParameterLength(2).setName("greaterThanEqual"),HC=kt(qn,"&&").setParameterLength(2,1/0).setName("and"),WC=kt(qn,"||").setParameterLength(2,1/0).setName("or"),qC=kt(qn,"!").setParameterLength(1).setName("not"),$C=kt(qn,"^^").setParameterLength(2).setName("xor"),XC=kt(qn,"&").setParameterLength(2).setName("bitAnd"),jC=kt(qn,"~").setParameterLength(1).setName("bitNot"),YC=kt(qn,"|").setParameterLength(2).setName("bitOr"),KC=kt(qn,"^").setParameterLength(2).setName("bitXor"),ZC=kt(qn,"<<").setParameterLength(2).setName("shiftLeft"),QC=kt(qn,">>").setParameterLength(2).setName("shiftRight"),JC=ot(([r])=>(r.addAssign(1),r)),t5=ot(([r])=>(r.subAssign(1),r)),e5=ot(([r])=>{const t=Q(r).toConst();return r.addAssign(1),t}),n5=ot(([r])=>{const t=Q(r).toConst();return r.subAssign(1),t});Bt("add",ws);Bt("sub",Oe);Bt("mul",fe);Bt("div",Nr);Bt("mod",Yp);Bt("equal",zC);Bt("notEqual",IC);Bt("lessThan",VC);Bt("greaterThan",cT);Bt("lessThanEqual",GC);Bt("greaterThanEqual",kC);Bt("and",HC);Bt("or",WC);Bt("not",qC);Bt("xor",$C);Bt("bitAnd",XC);Bt("bitNot",jC);Bt("bitOr",YC);Bt("bitXor",KC);Bt("shiftLeft",ZC);Bt("shiftRight",QC);Bt("incrementBefore",JC);Bt("decrementBefore",t5);Bt("increment",e5);Bt("decrement",n5);const s5=(r,t)=>(Wt('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.',new ps),Yp(Q(r),Q(t)));Bt("modInt",s5);class _t extends rs{static get type(){return"MathNode"}constructor(t,e,n=null,s=null){if(super(),(t===_t.MAX||t===_t.MIN)&&arguments.length>3){let i=new _t(t,e,n);for(let a=2;a<arguments.length-1;a++)i=new _t(t,i,arguments[a]);e=i,n=arguments[arguments.length-1],s=null}this.method=t,this.aNode=e,this.bNode=n,this.cNode=s,this.isMathNode=!0}getInputType(t){const e=this.aNode.getNodeType(t),n=this.bNode?this.bNode.getNodeType(t):null,s=this.cNode?this.cNode.getNodeType(t):null,i=t.isMatrix(e)?0:t.getTypeLength(e),a=t.isMatrix(n)?0:t.getTypeLength(n),c=t.isMatrix(s)?0:t.getTypeLength(s);return i>a&&i>c?e:a>c?n:c>i?s:e}getNodeType(t){const e=this.method;return e===_t.LENGTH||e===_t.DISTANCE||e===_t.DOT?"float":e===_t.CROSS?"vec3":e===_t.ALL||e===_t.ANY?"bool":e===_t.EQUALS?t.changeComponentType(this.aNode.getNodeType(t),"bool"):this.getInputType(t)}setup(t){const{aNode:e,bNode:n,method:s}=this;let i=null;if(s===_t.ONE_MINUS)i=Oe(1,e);else if(s===_t.RECIPROCAL)i=Nr(1,e);else if(s===_t.DIFFERENCE)i=Mn(Oe(e,n));else if(s===_t.TRANSFORM_DIRECTION){let a=e,c=n;t.isMatrix(a.getNodeType(t))?c=ie(st(c),0):a=ie(st(a),0);const u=fe(a,c).xyz;i=Ji(u)}return i!==null?i:super.setup(t)}generate(t,e){if(t.getNodeProperties(this).outputNode)return super.generate(t,e);let s=this.method;const i=this.getNodeType(t),a=this.getInputType(t),c=this.aNode,u=this.bNode,d=this.cNode,f=t.renderer.coordinateSystem;if(s===_t.NEGATE)return t.format("( - "+c.build(t,a)+" )",i,e);{const p=[];return s===_t.CROSS?p.push(c.build(t,i),u.build(t,i)):f===_r&&s===_t.STEP?p.push(c.build(t,t.getTypeLength(c.getNodeType(t))===1?"float":a),u.build(t,a)):f===_r&&(s===_t.MIN||s===_t.MAX)?p.push(c.build(t,a),u.build(t,t.getTypeLength(u.getNodeType(t))===1?"float":a)):s===_t.REFRACT?p.push(c.build(t,a),u.build(t,a),d.build(t,"float")):s===_t.MIX?p.push(c.build(t,a),u.build(t,a),d.build(t,t.getTypeLength(d.getNodeType(t))===1?"float":a)):(f===Jr&&s===_t.ATAN&&u!==null&&(s="atan2"),t.shaderStage!=="fragment"&&(s===_t.DFDX||s===_t.DFDY)&&(Wt(`TSL: '${s}' is not supported in the ${t.shaderStage} stage.`,this.stackTrace),s="/*"+s+"*/"),p.push(c.build(t,a)),u!==null&&p.push(u.build(t,a)),d!==null&&p.push(d.build(t,a))),t.format(`${t.getMethod(s,i)}( ${p.join(", ")} )`,i,e)}}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}_t.ALL="all";_t.ANY="any";_t.RADIANS="radians";_t.DEGREES="degrees";_t.EXP="exp";_t.EXP2="exp2";_t.LOG="log";_t.LOG2="log2";_t.SQRT="sqrt";_t.INVERSE_SQRT="inversesqrt";_t.FLOOR="floor";_t.CEIL="ceil";_t.NORMALIZE="normalize";_t.FRACT="fract";_t.SIN="sin";_t.COS="cos";_t.TAN="tan";_t.ASIN="asin";_t.ACOS="acos";_t.ATAN="atan";_t.ABS="abs";_t.SIGN="sign";_t.LENGTH="length";_t.NEGATE="negate";_t.ONE_MINUS="oneMinus";_t.DFDX="dFdx";_t.DFDY="dFdy";_t.ROUND="round";_t.RECIPROCAL="reciprocal";_t.TRUNC="trunc";_t.FWIDTH="fwidth";_t.TRANSPOSE="transpose";_t.DETERMINANT="determinant";_t.INVERSE="inverse";_t.EQUALS="equals";_t.MIN="min";_t.MAX="max";_t.STEP="step";_t.REFLECT="reflect";_t.DISTANCE="distance";_t.DIFFERENCE="difference";_t.DOT="dot";_t.CROSS="cross";_t.POW="pow";_t.TRANSFORM_DIRECTION="transformDirection";_t.MIX="mix";_t.CLAMP="clamp";_t.REFRACT="refract";_t.SMOOTHSTEP="smoothstep";_t.FACEFORWARD="faceforward";const uT=G(1e-6),XP=G(1e6),Iy=G(Math.PI),jP=G(Math.PI*2),YP=G(Math.PI*2),KP=G(Math.PI*.5),i5=kt(_t,_t.ALL).setParameterLength(1),r5=kt(_t,_t.ANY).setParameterLength(1),o5=kt(_t,_t.RADIANS).setParameterLength(1),a5=kt(_t,_t.DEGREES).setParameterLength(1),hT=kt(_t,_t.EXP).setParameterLength(1),vd=kt(_t,_t.EXP2).setParameterLength(1),bx=kt(_t,_t.LOG).setParameterLength(1),ra=kt(_t,_t.LOG2).setParameterLength(1),Oi=kt(_t,_t.SQRT).setParameterLength(1),dT=kt(_t,_t.INVERSE_SQRT).setParameterLength(1),oa=kt(_t,_t.FLOOR).setParameterLength(1),Sx=kt(_t,_t.CEIL).setParameterLength(1),Ji=kt(_t,_t.NORMALIZE).setParameterLength(1),No=kt(_t,_t.FRACT).setParameterLength(1),Ci=kt(_t,_t.SIN).setParameterLength(1),wo=kt(_t,_t.COS).setParameterLength(1),l5=kt(_t,_t.TAN).setParameterLength(1),c5=kt(_t,_t.ASIN).setParameterLength(1),fT=kt(_t,_t.ACOS).setParameterLength(1),pT=kt(_t,_t.ATAN).setParameterLength(1,2),Mn=kt(_t,_t.ABS).setParameterLength(1),mT=kt(_t,_t.SIGN).setParameterLength(1),aa=kt(_t,_t.LENGTH).setParameterLength(1),gT=kt(_t,_t.NEGATE).setParameterLength(1),u5=kt(_t,_t.ONE_MINUS).setParameterLength(1),yT=kt(_t,_t.DFDX).setParameterLength(1),xT=kt(_t,_t.DFDY).setParameterLength(1),h5=kt(_t,_t.ROUND).setParameterLength(1),d5=kt(_t,_t.RECIPROCAL).setParameterLength(1),bT=kt(_t,_t.TRUNC).setParameterLength(1),ST=kt(_t,_t.FWIDTH).setParameterLength(1),f5=kt(_t,_t.TRANSPOSE).setParameterLength(1),p5=kt(_t,_t.DETERMINANT).setParameterLength(1),m5=kt(_t,_t.INVERSE).setParameterLength(1),nr=kt(_t,_t.MIN).setParameterLength(2,1/0),$n=kt(_t,_t.MAX).setParameterLength(2,1/0),Ad=kt(_t,_t.STEP).setParameterLength(2),g5=kt(_t,_t.REFLECT).setParameterLength(2),y5=kt(_t,_t.DISTANCE).setParameterLength(2),x5=kt(_t,_t.DIFFERENCE).setParameterLength(2),no=kt(_t,_t.DOT).setParameterLength(2),hl=kt(_t,_t.CROSS).setParameterLength(2),jr=kt(_t,_t.POW).setParameterLength(2),wT=r=>fe(r,r),b5=r=>fe(r,r,r),TT=r=>fe(r,r,r,r),S5=kt(_t,_t.TRANSFORM_DIRECTION).setParameterLength(2),w5=r=>fe(mT(r),jr(Mn(r),1/3)),_T=r=>no(r,r),Be=kt(_t,_t.MIX).setParameterLength(3),Ro=(r,t=0,e=1)=>new _t(_t.CLAMP,Qt(r),Qt(t),Qt(e)),wx=r=>Ro(r),MT=kt(_t,_t.REFRACT).setParameterLength(3),Eo=kt(_t,_t.SMOOTHSTEP).setParameterLength(3),vT=kt(_t,_t.FACEFORWARD).setParameterLength(3),T5=ot(([r])=>{const n=43758.5453,s=no(r.xy,Vt(12.9898,78.233)),i=Yp(s,Iy);return No(Ci(i).mul(n))}),_5=(r,t,e)=>Be(t,e,r),M5=(r,t,e)=>Eo(t,e,r),v5=(r,t)=>Ad(t,r),ZP=vT,QP=dT;Bt("all",i5);Bt("any",r5);Bt("radians",o5);Bt("degrees",a5);Bt("exp",hT);Bt("exp2",vd);Bt("log",bx);Bt("log2",ra);Bt("sqrt",Oi);Bt("inverseSqrt",dT);Bt("floor",oa);Bt("ceil",Sx);Bt("normalize",Ji);Bt("fract",No);Bt("sin",Ci);Bt("cos",wo);Bt("tan",l5);Bt("asin",c5);Bt("acos",fT);Bt("atan",pT);Bt("abs",Mn);Bt("sign",mT);Bt("length",aa);Bt("lengthSq",_T);Bt("negate",gT);Bt("oneMinus",u5);Bt("dFdx",yT);Bt("dFdy",xT);Bt("round",h5);Bt("reciprocal",d5);Bt("trunc",bT);Bt("fwidth",ST);Bt("min",nr);Bt("max",$n);Bt("step",v5);Bt("reflect",g5);Bt("distance",y5);Bt("dot",no);Bt("cross",hl);Bt("pow",jr);Bt("pow2",wT);Bt("pow3",b5);Bt("pow4",TT);Bt("transformDirection",S5);Bt("mix",_5);Bt("clamp",Ro);Bt("refract",MT);Bt("smoothstep",M5);Bt("faceForward",vT);Bt("difference",x5);Bt("saturate",wx);Bt("cbrt",w5);Bt("transpose",f5);Bt("determinant",p5);Bt("inverse",m5);Bt("rand",T5);class JP extends Jt{static get type(){return"ConditionalNode"}constructor(t,e,n=null){super(),this.condNode=t,this.ifNode=e,this.elseNode=n}getNodeType(t){const{ifNode:e,elseNode:n}=t.getNodeProperties(this);if(e===void 0)return t.flowBuildStage(this,"setup"),this.getNodeType(t);const s=e.getNodeType(t);if(n!==null){const i=n.getNodeType(t);if(t.getTypeLength(i)>t.getTypeLength(s))return i}return s}setup(t){const e=this.condNode,n=this.ifNode.isolate(),s=this.elseNode?this.elseNode.isolate():null,i=t.context.nodeBlock;t.getDataFromNode(n).parentNodeBlock=i,s!==null&&(t.getDataFromNode(s).parentNodeBlock=i);const a=t.context.uniformFlow,c=t.getNodeProperties(this);c.condNode=e,c.ifNode=a?n:n.context({nodeBlock:n}),c.elseNode=s?a?s:s.context({nodeBlock:s}):null}generate(t,e){const n=this.getNodeType(t),s=t.getDataFromNode(this);if(s.nodeProperty!==void 0)return s.nodeProperty;const{condNode:i,ifNode:a,elseNode:c}=t.getNodeProperties(this),u=t.currentFunctionNode,d=e!=="void",f=d?cl(n).build(t):"";s.nodeProperty=f;const p=i.build(t,"bool");if(t.context.uniformFlow&&c!==null){const x=a.build(t,n),S=c.build(t,n),T=t.getTernary(p,x,S);return t.format(T,n,e)}t.addFlowCode(`
${t.tab}if ( ${p} ) {

`).addFlowTab();let y=a.build(t,n);if(y&&(d?y=f+" = "+y+";":(y="return "+y+";",u===null&&(Wt("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values.",this.stackTrace),y="// "+y))),t.removeFlowTab().addFlowCode(t.tab+"	"+y+`

`+t.tab+"}"),c!==null){t.addFlowCode(` else {

`).addFlowTab();let x=c.build(t,n);x&&(d?x=f+" = "+x+";":(x="return "+x+";",u===null&&(Wt("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values.",this.stackTrace),x="// "+x))),t.removeFlowTab().addFlowCode(t.tab+"	"+x+`

`+t.tab+`}

`)}else t.addFlowCode(`

`);return t.format(f,n,e)}}const bi=be(JP).setParameterLength(2,3);Bt("select",bi);class A5 extends Jt{static get type(){return"ContextNode"}constructor(t=null,e={}){super(),this.isContextNode=!0,this.node=t,this.value=e}getScope(){return this.node.getScope()}getNodeType(t){return this.node.getNodeType(t)}getFlowContextData(){const t=[];return this.traverse(e=>{e.isContextNode===!0&&t.push(e.value)}),Object.assign({},...t)}getMemberType(t,e){return this.node.getMemberType(t,e)}analyze(t){const e=t.addContext(this.value);this.node.build(t),t.setContext(e)}setup(t){const e=t.addContext(this.value);this.node.build(t),t.setContext(e)}generate(t,e){const n=t.addContext(this.value),s=this.node.build(t,e);return t.setContext(n),s}}const pl=(r=null,t={})=>{let e=r;return(e===null||e.isNode!==!0)&&(t=e||t,e=null),new A5(e,t)},N5=r=>pl(r,{uniformFlow:!0}),AT=(r,t)=>pl(r,{nodeName:t});function R5(r,t,e=null){return pl(e,{getShadow:({light:n,shadowColorNode:s})=>t===n?s.mul(r):s})}function E5(r,t=null){return pl(t,{getAO:(e,{material:n})=>n.transparent===!0?e:e!==null?e.mul(r):r})}function C5(r,t){return Wt('TSL: "label()" has been deprecated. Use "setName()" instead.'),AT(r,t)}Bt("context",pl);Bt("label",C5);Bt("uniformFlow",N5);Bt("setName",AT);Bt("builtinShadowContext",(r,t,e)=>R5(t,e,r));Bt("builtinAOContext",(r,t)=>E5(t,r));class Vg extends Jt{static get type(){return"VarNode"}constructor(t,e=null,n=!1){super(),this.node=t,this.name=e,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0,this.intent=!1}setIntent(t){return this.intent=t,this}isIntent(t){return t.getDataFromNode(this).forceDeclaration===!0?!1:this.intent}getIntent(){return this.intent}getMemberType(t,e){return this.node.getMemberType(t,e)}getElementType(t){return this.node.getElementType(t)}getNodeType(t){return this.node.getNodeType(t)}getArrayCount(t){return this.node.getArrayCount(t)}isAssign(t){return t.getDataFromNode(this).assign}build(...t){const e=t[0];if(this._hasStack(e)===!1&&e.buildStage==="setup"&&(e.context.nodeLoop||e.context.nodeBlock)){let n=!1;if(this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&e.fnCall&&e.fnCall.shaderNode&&e.getDataFromNode(this.node.shaderNode).hasLoop){const a=e.getDataFromNode(this);a.forceDeclaration=!0,n=!0}const s=e.getBaseStack();n?s.addToStackBefore(this):s.addToStack(this)}return this.isIntent(e)&&this.isAssign(e)!==!0?this.node.build(...t):super.build(...t)}generate(t){const{node:e,name:n,readOnly:s}=this,{renderer:i}=t,a=i.backend.isWebGPUBackend===!0;let c=!1,u=!1;s&&(c=t.isDeterministic(e),u=a?s:c);const d=this.getNodeType(t);if(d=="void")return this.isIntent(t)!==!0&&Ht('TSL: ".toVar()" can not be used with void type.',this.stackTrace),e.build(t);const f=t.getVectorType(d),p=e.build(t,f),g=t.getVarFromNode(this,n,f,void 0,u),y=t.getPropertyName(g);let x=y;if(u)if(a)x=c?`const ${y}`:`let ${y}`;else{const S=e.getArrayCount(t);x=`const ${t.getVar(g.type,y,S)}`}return t.addLineFlowCode(`${x} = ${p}`,this),y}_hasStack(t){return t.getDataFromNode(this).stack!==void 0}}const NT=be(Vg),D5=(r,t=null)=>NT(r,t).toStack(),B5=(r,t=null)=>NT(r,t,!0).toStack(),L5=r=>NT(r).setIntent(!0).toStack();Bt("toVar",D5);Bt("toConst",B5);Bt("toVarIntent",L5);class tz extends Jt{static get type(){return"SubBuild"}constructor(t,e,n=null){super(n),this.node=t,this.name=e,this.isSubBuildNode=!0}getNodeType(t){if(this.nodeType!==null)return this.nodeType;t.addSubBuild(this.name);const e=this.node.getNodeType(t);return t.removeSubBuild(),e}build(t,...e){t.addSubBuild(this.name);const n=this.node.build(t,...e);return t.removeSubBuild(),n}}const Pu=(r,t,e=null)=>new tz(Qt(r),t,e);class ez extends Jt{static get type(){return"VaryingNode"}constructor(t,e=null){super(),this.node=Pu(t,"VERTEX"),this.name=e,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(t,e=null){return this.interpolationType=t,this.interpolationSampling=e,this}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}setupVarying(t){const e=t.getNodeProperties(this);let n=e.varying;if(n===void 0){const s=this.name,i=this.getNodeType(t),a=this.interpolationType,c=this.interpolationSampling;e.varying=n=t.getVaryingFromNode(this,s,i,a,c),e.node=Pu(this.node,"VERTEX")}return n.needsInterpolation||(n.needsInterpolation=t.shaderStage==="fragment"),n}setup(t){this.setupVarying(t),t.flowNodeFromShaderStage(sp.VERTEX,this.node)}analyze(t){this.setupVarying(t),t.flowNodeFromShaderStage(sp.VERTEX,this.node)}generate(t){const e=t.getSubBuildProperty("property",t.currentStack),n=t.getNodeProperties(this),s=this.setupVarying(t);if(n[e]===void 0){const i=this.getNodeType(t),a=t.getPropertyName(s,sp.VERTEX);t.flowNodeFromShaderStage(sp.VERTEX,n.node,i,a),n[e]=a}return t.getPropertyName(s)}}const Uc=be(ez).setParameterLength(1,2),O5=r=>Uc(r);Bt("toVarying",Uc);Bt("toVertexStage",O5);const F5=ot(([r])=>{const t=r.mul(.9478672986).add(.0521327014).pow(2.4),e=r.mul(.0773993808),n=r.lessThanEqual(.04045);return Be(t,e,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),U5=ot(([r])=>{const t=r.pow(.41666).mul(1.055).sub(.055),e=r.mul(12.92),n=r.lessThanEqual(.0031308);return Be(t,e,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),RT="WorkingColorSpace",nz="OutputColorSpace";class ET extends rs{static get type(){return"ColorSpaceNode"}constructor(t,e,n){super("vec4"),this.colorNode=t,this.source=e,this.target=n}resolveColorSpace(t,e){return e===RT?Xe.workingColorSpace:e===nz?t.context.outputColorSpace||t.renderer.outputColorSpace:e}setup(t){const{colorNode:e}=this,n=this.resolveColorSpace(t,this.source),s=this.resolveColorSpace(t,this.target);let i=e;return Xe.enabled===!1||n===s||!n||!s||(Xe.getTransfer(n)===ye&&(i=ie(F5(i.rgb),i.a)),Xe.getPrimaries(n)!==Xe.getPrimaries(s)&&(i=ie(qs(Xe._getMatrix(new rr,n,s)).mul(i.rgb),i.a)),Xe.getTransfer(s)===ye&&(i=ie(U5(i.rgb),i.a))),i}}const P5=(r,t)=>new ET(Qt(r),RT,t),Tx=(r,t)=>new ET(Qt(r),t,RT),sz=(r,t,e)=>new ET(Qt(r),t,e);Bt("workingToColorSpace",P5);Bt("colorSpaceToWorking",Tx);let iz=class extends $u{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),n=this.referenceNode.getNodeType(),s=this.getNodeType();return t.format(e,n,s)}};class z5 extends Jt{static get type(){return"ReferenceBaseNode"}constructor(t,e,n=null,s=null){super(),this.property=t,this.uniformType=e,this.object=n,this.count=s,this.properties=t.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=de.OBJECT}setGroup(t){return this.group=t,this}element(t){return new iz(this,Qt(t))}setNodeType(t){const e=te(null,t);this.group!==null&&e.setGroup(this.group),this.node=e}getNodeType(t){return this.node===null&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let n=t[e[0]];for(let s=1;s<e.length;s++)n=n[e[s]];return n}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const rz=(r,t,e)=>new z5(r,t,e);class oz extends z5{static get type(){return"RendererReferenceNode"}constructor(t,e,n=null){super(t,e,n),this.renderer=n,this.setGroup(ne)}updateReference(t){return this.reference=this.renderer!==null?this.renderer:t.renderer,this.reference}}const I5=(r,t,e=null)=>new oz(r,t,e);class az extends rs{static get type(){return"ToneMappingNode"}constructor(t,e=G5,n=null){super("vec3"),this._toneMapping=t,this.exposureNode=e,this.colorNode=n}customCacheKey(){return Sp(this._toneMapping)}setToneMapping(t){return this._toneMapping=t,this}getToneMapping(){return this._toneMapping}setup(t){const e=this.colorNode||t.context.color,n=this._toneMapping;if(n===Ru)return e;let s=null;const i=t.renderer.library.getToneMappingFunction(n);return i!==null?s=ie(i(e.rgb,this.exposureNode),e.a):(Ht("ToneMappingNode: Unsupported Tone Mapping configuration.",n),s=e),s}}const V5=(r,t,e)=>new az(r,Qt(t),Qt(e)),G5=I5("toneMappingExposure","float");Bt("toneMapping",(r,t,e)=>V5(t,e,r));const iR=new WeakMap;function rR(r,t){let e=iR.get(r);return e===void 0&&(e=new iC(r,t),iR.set(r,e)),e}class jl extends jw{static get type(){return"BufferAttributeNode"}constructor(t,e=null,n=0,s=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferStride=n,this.bufferOffset=s,this.usage=Td,this.instanced=!1,this.attribute=null,this.global=!0,t&&t.isBufferAttribute===!0&&t.itemSize<=4&&(this.attribute=t,this.usage=t.usage,this.instanced=t.isInstancedBufferAttribute)}getHash(t){if(this.bufferStride===0&&this.bufferOffset===0){let e=t.globalCache.getData(this.value);return e===void 0&&(e={node:this},t.globalCache.setData(this.value,e)),e.node.uuid}return this.uuid}getNodeType(t){return this.bufferType===null&&(this.bufferType=t.getTypeFromAttribute(this.attribute)),this.bufferType}setup(t){if(this.attribute!==null)return;const e=this.getNodeType(t),n=t.getTypeLength(e),s=this.value,i=this.bufferStride||n,a=this.bufferOffset;let c;s.isInterleavedBuffer===!0?c=s:s.isBufferAttribute===!0?c=rR(s.array,i):c=rR(s,i);const u=new Lw(c,n,a);c.setUsage(this.usage),this.attribute=u,this.attribute.isInstancedBufferAttribute=this.instanced}generate(t){const e=this.getNodeType(t),n=t.getBufferAttributeFromNode(this,e),s=t.getPropertyName(n);let i=null;return t.shaderStage==="vertex"||t.shaderStage==="compute"?(this.name=s,i=s):i=Uc(this).build(t,e),i}getInputType(){return"bufferAttribute"}setUsage(t){return this.usage=t,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=t),this}setInstanced(t){return this.instanced=t,this}}function _x(r,t=null,e=0,n=0,s=Td,i=!1){return t==="mat3"||t===null&&r.itemSize===9?qs(new jl(r,"vec3",9,0).setUsage(s).setInstanced(i),new jl(r,"vec3",9,3).setUsage(s).setInstanced(i),new jl(r,"vec3",9,6).setUsage(s).setInstanced(i)):t==="mat4"||t===null&&r.itemSize===16?vc(new jl(r,"vec4",16,0).setUsage(s).setInstanced(i),new jl(r,"vec4",16,4).setUsage(s).setInstanced(i),new jl(r,"vec4",16,8).setUsage(s).setInstanced(i),new jl(r,"vec4",16,12).setUsage(s).setInstanced(i)):new jl(r,t,e,n).setUsage(s)}const CT=(r,t=null,e=0,n=0)=>_x(r,t,e,n),lz=(r,t=null,e=0,n=0)=>_x(r,t,e,n,Lp),Vy=(r,t=null,e=0,n=0)=>_x(r,t,e,n,Td,!0),Y2=(r,t=null,e=0,n=0)=>_x(r,t,e,n,Lp,!0);Bt("toAttribute",r=>CT(r.value));class cz extends Jt{static get type(){return"ComputeNode"}constructor(t,e){super("void"),this.isComputeNode=!0,this.computeNode=t,this.workgroupSize=e,this.count=null,this.version=1,this.name="",this.updateBeforeType=de.OBJECT,this.onInitFunction=null}setCount(t){return this.count=t,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(t){return this.name=t,this}label(t){return Wt('TSL: "label()" has been deprecated. Use "setName()" instead.',new ps),this.setName(t)}onInit(t){return this.onInitFunction=t,this}updateBefore({renderer:t}){t.compute(this)}setup(t){const e=this.computeNode.build(t);if(e){const n=t.getNodeProperties(this);n.outputComputeNode=e.outputNode,e.outputNode=null}return e}generate(t,e){const{shaderStage:n}=t;if(n==="compute"){const s=this.computeNode.build(t,"void");s!==""&&t.addLineFlowCode(s,this)}else{const i=t.getNodeProperties(this).outputComputeNode;if(i)return i.build(t,e)}}}const DT=(r,t=[64])=>{(t.length===0||t.length>3)&&Ht("TSL: compute() workgroupSize must have 1, 2, or 3 elements",new ps);for(let e=0;e<t.length;e++){const n=t[e];(typeof n!="number"||n<=0||!Number.isInteger(n))&&Ht(`TSL: compute() workgroupSize element at index [ ${e} ] must be a positive integer`,new ps)}for(;t.length<3;)t.push(1);return new cz(Qt(r),t)},k5=(r,t,e)=>DT(r,e).setCount(t);Bt("compute",k5);Bt("computeKernel",DT);class uz extends Jt{static get type(){return"IsolateNode"}constructor(t,e=!0){super(),this.node=t,this.parent=e,this.isIsolateNode=!0}getNodeType(t){const e=t.getCache(),n=t.getCacheFromNode(this,this.parent);t.setCache(n);const s=this.node.getNodeType(t);return t.setCache(e),s}build(t,...e){const n=t.getCache(),s=t.getCacheFromNode(this,this.parent);t.setCache(s);const i=this.node.build(t,...e);return t.setCache(n),i}setParent(t){return this.parent=t,this}getParent(){return this.parent}}const gd=r=>new uz(Qt(r));function H5(r,t=!0){return Wt('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),gd(r).setParent(t)}Bt("cache",H5);Bt("isolate",gd);class hz extends Jt{static get type(){return"BypassNode"}constructor(t,e){super(),this.isBypassNode=!0,this.outputNode=t,this.callNode=e}getNodeType(t){return this.outputNode.getNodeType(t)}generate(t){const e=this.callNode.build(t,"void");return e!==""&&t.addLineFlowCode(e,this),this.outputNode.build(t)}}const W5=be(hz).setParameterLength(2);Bt("bypass",W5);class q5 extends Jt{static get type(){return"RemapNode"}constructor(t,e,n,s=G(0),i=G(1)){super(),this.node=t,this.inLowNode=e,this.inHighNode=n,this.outLowNode=s,this.outHighNode=i,this.doClamp=!0}setup(){const{node:t,inLowNode:e,inHighNode:n,outLowNode:s,outHighNode:i,doClamp:a}=this;let c=t.sub(e).div(n.sub(e));return a===!0&&(c=c.clamp()),c.mul(i.sub(s)).add(s)}}const $5=be(q5,null,null,{doClamp:!1}).setParameterLength(3,5),X5=be(q5).setParameterLength(3,5);Bt("remap",$5);Bt("remapClamp",X5);class Gg extends Jt{static get type(){return"ExpressionNode"}constructor(t="",e="void"){super(e),this.snippet=t}generate(t,e){const n=this.getNodeType(t),s=this.snippet;if(n==="void")t.addLineFlowCode(s,this);else return t.format(s,n,e)}}const vo=be(Gg).setParameterLength(1,2),j5=r=>(r?bi(r,vo("discard")):vo("discard")).toStack(),dz=()=>vo("return").toStack();Bt("discard",j5);class fz extends rs{static get type(){return"RenderOutputNode"}constructor(t,e,n){super("vec4"),this.colorNode=t,this._toneMapping=e,this.outputColorSpace=n,this.isRenderOutputNode=!0}setToneMapping(t){return this._toneMapping=t,this}getToneMapping(){return this._toneMapping}setup({context:t}){let e=this.colorNode||t.color;const n=(this._toneMapping!==null?this._toneMapping:t.toneMapping)||Ru,s=(this.outputColorSpace!==null?this.outputColorSpace:t.outputColorSpace)||Ec;return n!==Ru&&(e=e.toneMapping(n)),s!==Ec&&s!==Xe.workingColorSpace&&(e=e.workingToColorSpace(s)),e}}const Y5=(r,t=null,e=null)=>new fz(Qt(r),t,e);Bt("renderOutput",Y5);class pz extends rs{static get type(){return"DebugNode"}constructor(t,e=null){super(),this.node=t,this.callback=e}getNodeType(t){return this.node.getNodeType(t)}setup(t){return this.node.build(t)}analyze(t){return this.node.build(t)}generate(t){const e=this.callback,n=this.node.build(t);if(e!==null)e(t,n);else{const s="--- TSL debug - "+t.shaderStage+" shader ---",i="-".repeat(s.length);let a="";a+="// #"+s+`#
`,a+=t.flow.code.replace(/^\t/mg,"")+`
`,a+="/* ... */ "+n+` /* ... */
`,a+="// #"+i+`#
`,z2(a)}return n}}const K5=(r,t=null)=>new pz(Qt(r),t).toStack();Bt("debug",K5);class Z5{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(t){return this._renderer=t,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class mz extends Jt{static get type(){return"InspectorNode"}constructor(t,e="",n=null){super(),this.node=t,this.name=e,this.callback=n,this.updateType=de.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(t){t.renderer.inspector.inspect(this)}getNodeType(t){return this.node.getNodeType(t)}setup(t){let e=this.node;return t.context.inspector===!0&&this.callback!==null&&(e=this.callback(e)),t.renderer.backend.isWebGPUBackend!==!0&&t.renderer.inspector.constructor!==Z5&&an('TSL: ".toInspector()" is only available with WebGPU.'),e}}function Q5(r,t="",e=null){return r=Qt(r),r.before(new mz(r,t,e))}Bt("toInspector",Q5);function gz(r){Wt("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",r)}class J5 extends Jt{static get type(){return"AttributeNode"}constructor(t,e=null){super(e),this.global=!0,this._attributeName=t}getHash(t){return this.getAttributeName(t)}getNodeType(t){let e=this.nodeType;if(e===null){const n=this.getAttributeName(t);if(t.hasGeometryAttribute(n)){const s=t.geometry.getAttribute(n);e=t.getTypeFromAttribute(s)}else e="float"}return e}setAttributeName(t){return this._attributeName=t,this}getAttributeName(){return this._attributeName}generate(t){const e=this.getAttributeName(t),n=this.getNodeType(t);if(t.hasGeometryAttribute(e)===!0){const i=t.geometry.getAttribute(e),a=t.getTypeFromAttribute(i),c=t.getAttribute(e,a);return t.shaderStage==="vertex"?t.format(c.name,a,n):Uc(this).build(t,n)}else return Wt(`AttributeNode: Vertex attribute "${e}" not found on geometry.`),t.generateConst(n)}serialize(t){super.serialize(t),t.global=this.global,t._attributeName=this._attributeName}deserialize(t){super.deserialize(t),this.global=t.global,this._attributeName=t._attributeName}}const dl=(r,t=null)=>new J5(r,t),fn=(r=0)=>dl("uv"+(r>0?r:""),"vec2");class yz extends Jt{static get type(){return"TextureSizeNode"}constructor(t,e=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=t,this.levelNode=e}generate(t,e){const n=this.textureNode.build(t,"property"),s=this.levelNode===null?"0":this.levelNode.build(t,"int");return t.format(`${t.getMethod("textureDimensions")}( ${n}, ${s} )`,this.getNodeType(t),e)}}const Ac=be(yz).setParameterLength(1,2);class xz extends jp{static get type(){return"MaxMipLevelNode"}constructor(t){super(0),this._textureNode=t,this.updateType=de.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const t=this.texture,e=t.images,n=e&&e.length>0?e[0]&&e[0].image||e[0]:t.image;if(n&&n.width!==void 0){const{width:s,height:i}=n;this.value=Math.log2(Math.max(s,i))}}}const BT=be(xz).setParameterLength(1);class t4 extends Error{constructor(t,e=null){super(t),this.name="NodeError",this.stackTrace=e}}const LT=new is;class fa extends jp{static get type(){return"TextureNode"}constructor(t=LT,e=null,n=null,s=null){super(t),this.isTextureNode=!0,this.uvNode=e,this.levelNode=n,this.biasNode=s,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=de.NONE,this.referenceNode=null,this._value=t,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(e===null)}set value(t){this.referenceNode?this.referenceNode.value=t:this._value=t}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Jn?"uvec4":this.value.type===pi?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return fn(this.value.channel)}updateReference(){return this.value}getTransformedUV(t){return this._matrixUniform===null&&(this._matrixUniform=te(this.value.matrix)),this._matrixUniform.mul(st(t,1)).xy}setUpdateMatrix(t){return this.updateMatrix=t,this}setupUV(t,e){return t.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=te(!1)),e=e.toVar(),this.sampler?e=this._flipYUniform.select(e.flipY(),e):e=this._flipYUniform.select(e.setY(Q(Ac(this,this.levelNode).y).sub(e.y).sub(1)),e)),e}setup(t){const e=t.getNodeProperties(this);e.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new t4("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().",this.stackTrace);const s=ot(()=>{let u=this.uvNode;return(u===null||t.context.forceUVContext===!0)&&t.context.getUV&&(u=t.context.getUV(this,t)),u||(u=this.getDefaultUV()),this.updateMatrix===!0&&(u=this.getTransformedUV(u)),u=this.setupUV(t,u),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?de.OBJECT:de.NONE,u})();let i=this.levelNode;i===null&&t.context.getTextureLevel&&(i=t.context.getTextureLevel(this));let a=null,c=null;this.compareNode!==null&&(t.renderer.hasCompatibility(_c.TEXTURE_COMPARE)?a=this.compareNode:this.value.compareFunction===null||this.value.compareFunction===Ew?c=this.compareNode:(a=this.compareNode,an('TSL: Only "LessCompare" is supported for depth texture comparison fallback.'))),e.uvNode=s,e.levelNode=i,e.biasNode=this.biasNode,e.compareNode=a,e.compareStepNode=c,e.gradNode=this.gradNode,e.depthNode=this.depthNode,e.offsetNode=this.offsetNode}generateUV(t,e){return e.build(t,this.sampler===!0?"vec2":"ivec2")}generateOffset(t,e){return e.build(t,"ivec2")}generateSnippet(t,e,n,s,i,a,c,u,d){const f=this.value;let p;return i?p=t.generateTextureBias(f,e,n,i,a,d):u?p=t.generateTextureGrad(f,e,n,u,a,d):c?p=t.generateTextureCompare(f,e,n,c,a,d):this.sampler===!1?p=t.generateTextureLoad(f,e,n,s,a,d):s?p=t.generateTextureLevel(f,e,n,s,a,d):p=t.generateTexture(f,e,n,a,d),p}generate(t,e){const n=this.value,s=t.getNodeProperties(this),i=super.generate(t,"property");if(/^sampler/.test(e))return i+"_sampler";if(t.isReference(e))return i;{const a=t.getDataFromNode(this),c=this.getNodeType(t);let u=a.propertyName;if(u===void 0){const{uvNode:f,levelNode:p,biasNode:g,compareNode:y,compareStepNode:x,depthNode:S,gradNode:T,offsetNode:M}=s,N=this.generateUV(t,f),v=p?p.build(t,"float"):null,A=g?g.build(t,"float"):null,R=S?S.build(t,"int"):null,L=y?y.build(t,"float"):null,D=x?x.build(t,"float"):null,U=T?[T[0].build(t,"vec2"),T[1].build(t,"vec2")]:null,B=M?this.generateOffset(t,M):null,P=t.getVarFromNode(this);u=t.getPropertyName(P);let J=this.generateSnippet(t,i,N,v,A,R,L,U,B);D!==null&&(J=Ad(vo(D,"float"),vo(J,c)).build(t,c)),t.addLineFlowCode(`${u} = ${J}`,this),a.snippet=J,a.propertyName=u}let d=u;return t.needsToWorkingColorSpace(n)&&(d=Tx(vo(d,c),n.colorSpace).setup(t).build(t,c)),t.format(d,c,e)}}setSampler(t){return this.sampler=t,this}getSampler(){return this.sampler}sample(t){const e=this.clone();return e.uvNode=Qt(t),e.referenceNode=this.getBase(),Qt(e)}load(t){return this.sample(t).setSampler(!1)}blur(t){const e=this.clone();e.biasNode=Qt(t).mul(BT(e)),e.referenceNode=this.getBase();const n=e.value;return e.generateMipmaps===!1&&(n&&n.generateMipmaps===!1||n.minFilter===ts||n.magFilter===ts)&&(Wt("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),e.biasNode=null),Qt(e)}level(t){const e=this.clone();return e.levelNode=Qt(t),e.referenceNode=this.getBase(),Qt(e)}size(t){return Ac(this,t)}bias(t){const e=this.clone();return e.biasNode=Qt(t),e.referenceNode=this.getBase(),Qt(e)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(t){const e=this.clone();return e.compareNode=Qt(t),e.referenceNode=this.getBase(),Qt(e)}grad(t,e){const n=this.clone();return n.gradNode=[Qt(t),Qt(e)],n.referenceNode=this.getBase(),Qt(n)}depth(t){const e=this.clone();return e.depthNode=Qt(t),e.referenceNode=this.getBase(),Qt(e)}offset(t){const e=this.clone();return e.offsetNode=Qt(t),e.referenceNode=this.getBase(),Qt(e)}serialize(t){super.serialize(t),t.value=this.value.toJSON(t.meta).uuid,t.sampler=this.sampler,t.updateMatrix=this.updateMatrix,t.updateType=this.updateType}deserialize(t){super.deserialize(t),this.value=t.meta.textures[t.value],this.sampler=t.sampler,this.updateMatrix=t.updateMatrix,this.updateType=t.updateType}update(){const t=this.value,e=this._matrixUniform;e!==null&&(e.value=t.matrix),t.matrixAutoUpdate===!0&&t.updateMatrix();const n=this._flipYUniform;n!==null&&(n.value=t.image instanceof ImageBitmap&&t.flipY===!0||t.isRenderTargetTexture===!0||t.isFramebufferTexture===!0||t.isDepthTexture===!0)}clone(){const t=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return t.sampler=this.sampler,t.depthNode=this.depthNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.offsetNode=this.offsetNode,t}}const bz=be(fa).setParameterLength(1,4).setName("texture"),qe=(r=LT,t=null,e=null,n=null)=>{let s;return r&&r.isTextureNode===!0?(s=Qt(r.clone()),s.referenceNode=r.getBase(),t!==null&&(s.uvNode=Qt(t)),e!==null&&(s.levelNode=Qt(e)),n!==null&&(s.biasNode=Qt(n))):s=bz(r,t,e,n),s},Sz=(r=LT)=>qe(r),Qn=(...r)=>qe(...r).setSampler(!1),wz=(r,t,e)=>qe(r,t).level(e),Tz=r=>(r.isNode===!0?r:qe(r)).convert("sampler"),_z=r=>(r.isNode===!0?r:qe(r)).convert("samplerComparison");class OT extends jp{static get type(){return"BufferNode"}constructor(t,e,n=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferCount=n,this.updateRanges=[]}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(t){return this.getNodeType(t)}getInputType(){return"buffer"}}const Kp=(r,t,e)=>new OT(r,t,e);class Mz extends $u{static get type(){return"UniformArrayElementNode"}constructor(t,e){super(t,e),this.isArrayBufferElementNode=!0}generate(t){const e=super.generate(t),n=this.getNodeType(),s=this.node.getPaddedType();return t.format(e,s,n)}}class vz extends OT{static get type(){return"UniformArrayNode"}constructor(t,e=null){super(null),this.array=t,this.elementType=e===null?xc(t[0]):e,this.paddedType=this.getPaddedType(),this.updateType=de.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const t=this.elementType;let e="vec4";return t==="mat2"?e="mat2":/mat/.test(t)===!0?e="mat4":t.charAt(0)==="i"?e="ivec4":t.charAt(0)==="u"&&(e="uvec4"),e}update(){const{array:t,value:e}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let s=0;s<t.length;s++){const i=s*4;e[i]=t[s]}else if(n==="color")for(let s=0;s<t.length;s++){const i=s*4,a=t[s];e[i]=a.r,e[i+1]=a.g,e[i+2]=a.b||0}else if(n==="mat2")for(let s=0;s<t.length;s++){const i=s*4,a=t[s];e[i]=a.elements[0],e[i+1]=a.elements[1],e[i+2]=a.elements[2],e[i+3]=a.elements[3]}else if(n==="mat3")for(let s=0;s<t.length;s++){const i=s*16,a=t[s];e[i]=a.elements[0],e[i+1]=a.elements[1],e[i+2]=a.elements[2],e[i+4]=a.elements[3],e[i+5]=a.elements[4],e[i+6]=a.elements[5],e[i+8]=a.elements[6],e[i+9]=a.elements[7],e[i+10]=a.elements[8],e[i+15]=1}else if(n==="mat4")for(let s=0;s<t.length;s++){const i=s*16,a=t[s];for(let c=0;c<a.elements.length;c++)e[i+c]=a.elements[c]}else for(let s=0;s<t.length;s++){const i=s*4,a=t[s];e[i]=a.x,e[i+1]=a.y,e[i+2]=a.z||0,e[i+3]=a.w||0}}setup(t){const e=this.array.length,n=this.elementType;let s=Float32Array;const i=this.paddedType,a=t.getTypeLength(i);return n.charAt(0)==="i"&&(s=Int32Array),n.charAt(0)==="u"&&(s=Uint32Array),this.value=new s(e*a),this.bufferCount=e,this.bufferType=i,this.update(),super.setup(t)}element(t){return new Mz(this,Qt(t))}}const yi=(r,t)=>new vz(r,t);class Az extends Jt{constructor(t){super("float"),this.name=t,this.isBuiltinNode=!0}generate(){return this.name}}const ml=be(Az).setParameterLength(1);let Of,Ff;class Rn extends Jt{static get type(){return"ScreenNode"}constructor(t){super(),this.scope=t,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===Rn.DPR?"float":this.scope===Rn.VIEWPORT?"vec4":"vec2"}getUpdateType(){let t=de.NONE;return(this.scope===Rn.SIZE||this.scope===Rn.VIEWPORT||this.scope===Rn.DPR)&&(t=de.RENDER),this.updateType=t,t}update({renderer:t}){const e=t.getRenderTarget();this.scope===Rn.VIEWPORT?e!==null?Ff.copy(e.viewport):(t.getViewport(Ff),Ff.multiplyScalar(t.getPixelRatio())):this.scope===Rn.DPR?this._output.value=t.getPixelRatio():e!==null?(Of.width=e.width,Of.height=e.height):t.getDrawingBufferSize(Of)}setup(){const t=this.scope;let e=null;return t===Rn.SIZE?e=te(Of||(Of=new Ut)):t===Rn.VIEWPORT?e=te(Ff||(Ff=new Ze)):t===Rn.DPR?e=te(1):e=Vt(ju.div(Gu)),this._output=e,e}generate(t){if(this.scope===Rn.COORDINATE){let e=t.getFragCoord();if(t.isFlipY()){const n=t.getNodeProperties(Gu).outputNode.build(t);e=`${t.getType("vec2")}( ${e}.x, ${n}.y - ${e}.y )`}return e}return super.generate(t)}}Rn.COORDINATE="coordinate";Rn.VIEWPORT="viewport";Rn.SIZE="size";Rn.UV="uv";Rn.DPR="dpr";const e4=$t(Rn,Rn.DPR),la=$t(Rn,Rn.UV),Gu=$t(Rn,Rn.SIZE),ju=$t(Rn,Rn.COORDINATE),FT=$t(Rn,Rn.VIEWPORT),UT=FT.zw,n4=ju.sub(FT.xy),Nz=n4.div(UT),Rz=ot(()=>(Wt('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.',new ps),Gu),"vec2").once()();let DS=null,km=null,BS=null,Hm=null,LS=null,Wm=null,OS=null,qm=null,FS=null,$m=null,US=null,Xm=null,PS=null,jm=null;const Pc=te(0,"uint").setName("u_cameraIndex").setGroup(xx("cameraIndex")).toVarying("v_cameraIndex"),fc=te("float").setName("cameraNear").setGroup(ne).onRenderUpdate(({camera:r})=>r.near),pc=te("float").setName("cameraFar").setGroup(ne).onRenderUpdate(({camera:r})=>r.far),ul=ot(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const n of r.cameras)e.push(n.projectionMatrix);km===null?km=yi(e).setGroup(ne).setName("cameraProjectionMatrices"):km.array=e,t=km.element(r.isMultiViewCamera?ml("gl_ViewID_OVR"):Pc).toConst("cameraProjectionMatrix")}else DS===null&&(DS=te(r.projectionMatrix).setName("cameraProjectionMatrix").setGroup(ne).onRenderUpdate(({camera:e})=>e.projectionMatrix)),t=DS;return t}).once()(),s4=ot(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const n of r.cameras)e.push(n.projectionMatrixInverse);Hm===null?Hm=yi(e).setGroup(ne).setName("cameraProjectionMatricesInverse"):Hm.array=e,t=Hm.element(r.isMultiViewCamera?ml("gl_ViewID_OVR"):Pc).toConst("cameraProjectionMatrixInverse")}else BS===null&&(BS=te(r.projectionMatrixInverse).setName("cameraProjectionMatrixInverse").setGroup(ne).onRenderUpdate(({camera:e})=>e.projectionMatrixInverse)),t=BS;return t}).once()(),ro=ot(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const n of r.cameras)e.push(n.matrixWorldInverse);Wm===null?Wm=yi(e).setGroup(ne).setName("cameraViewMatrices"):Wm.array=e,t=Wm.element(r.isMultiViewCamera?ml("gl_ViewID_OVR"):Pc).toConst("cameraViewMatrix")}else LS===null&&(LS=te(r.matrixWorldInverse).setName("cameraViewMatrix").setGroup(ne).onRenderUpdate(({camera:e})=>e.matrixWorldInverse)),t=LS;return t}).once()(),Ez=ot(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const n of r.cameras)e.push(n.matrixWorld);qm===null?qm=yi(e).setGroup(ne).setName("cameraWorldMatrices"):qm.array=e,t=qm.element(r.isMultiViewCamera?ml("gl_ViewID_OVR"):Pc).toConst("cameraWorldMatrix")}else OS===null&&(OS=te(r.matrixWorld).setName("cameraWorldMatrix").setGroup(ne).onRenderUpdate(({camera:e})=>e.matrixWorld)),t=OS;return t}).once()(),Cz=ot(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const n of r.cameras)e.push(n.normalMatrix);$m===null?$m=yi(e).setGroup(ne).setName("cameraNormalMatrices"):$m.array=e,t=$m.element(r.isMultiViewCamera?ml("gl_ViewID_OVR"):Pc).toConst("cameraNormalMatrix")}else FS===null&&(FS=te(r.normalMatrix).setName("cameraNormalMatrix").setGroup(ne).onRenderUpdate(({camera:e})=>e.normalMatrix)),t=FS;return t}).once()(),i4=ot(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(let n=0,s=r.cameras.length;n<s;n++)e.push(new V);Xm===null?Xm=yi(e).setGroup(ne).setName("cameraPositions").onRenderUpdate(({camera:n},s)=>{const i=n.cameras,a=s.array;for(let c=0,u=i.length;c<u;c++)a[c].setFromMatrixPosition(i[c].matrixWorld)}):Xm.array=e,t=Xm.element(r.isMultiViewCamera?ml("gl_ViewID_OVR"):Pc).toConst("cameraPosition")}else US===null&&(US=te(new V).setName("cameraPosition").setGroup(ne).onRenderUpdate(({camera:e},n)=>n.value.setFromMatrixPosition(e.matrixWorld))),t=US;return t}).once()(),Dz=ot(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const n of r.cameras)e.push(n.viewport);jm===null?jm=yi(e,"vec4").setGroup(ne).setName("cameraViewports"):jm.array=e,t=jm.element(Pc).toConst("cameraViewport")}else PS===null&&(PS=ie(0,0,Gu.x,Gu.y).toConst("cameraViewport")),t=PS;return t}).once()(),oR=new Fc;class Le extends Jt{static get type(){return"Object3DNode"}constructor(t,e=null){super(),this.scope=t,this.object3d=e,this.updateType=de.OBJECT,this.uniformNode=new jp(null)}getNodeType(){const t=this.scope;if(t===Le.WORLD_MATRIX)return"mat4";if(t===Le.POSITION||t===Le.VIEW_POSITION||t===Le.DIRECTION||t===Le.SCALE)return"vec3";if(t===Le.RADIUS)return"float"}update(t){const e=this.object3d,n=this.uniformNode,s=this.scope;if(s===Le.WORLD_MATRIX)n.value=e.matrixWorld;else if(s===Le.POSITION)n.value=n.value||new V,n.value.setFromMatrixPosition(e.matrixWorld);else if(s===Le.SCALE)n.value=n.value||new V,n.value.setFromMatrixScale(e.matrixWorld);else if(s===Le.DIRECTION)n.value=n.value||new V,e.getWorldDirection(n.value);else if(s===Le.VIEW_POSITION){const i=t.camera;n.value=n.value||new V,n.value.setFromMatrixPosition(e.matrixWorld),n.value.applyMatrix4(i.matrixWorldInverse)}else if(s===Le.RADIUS){const i=t.object.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),oR.copy(i.boundingSphere).applyMatrix4(e.matrixWorld),n.value=oR.radius}}generate(t){const e=this.scope;return e===Le.WORLD_MATRIX?this.uniformNode.nodeType="mat4":e===Le.POSITION||e===Le.VIEW_POSITION||e===Le.DIRECTION||e===Le.SCALE?this.uniformNode.nodeType="vec3":e===Le.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(t)}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}Le.WORLD_MATRIX="worldMatrix";Le.POSITION="position";Le.SCALE="scale";Le.VIEW_POSITION="viewPosition";Le.DIRECTION="direction";Le.RADIUS="radius";const Bz=be(Le,Le.DIRECTION).setParameterLength(1),Lz=be(Le,Le.WORLD_MATRIX).setParameterLength(1),Oz=be(Le,Le.POSITION).setParameterLength(1),Fz=be(Le,Le.SCALE).setParameterLength(1),Uz=be(Le,Le.VIEW_POSITION).setParameterLength(1),Pz=be(Le,Le.RADIUS).setParameterLength(1);class so extends Le{static get type(){return"ModelNode"}constructor(t){super(t)}update(t){this.object3d=t.object,super.update(t)}}const zz=$t(so,so.DIRECTION),Yr=$t(so,so.WORLD_MATRIX),Iz=$t(so,so.POSITION),Vz=$t(so,so.SCALE),Gz=$t(so,so.VIEW_POSITION),kz=$t(so,so.RADIUS),r4=te(new rr).onObjectUpdate(({object:r},t)=>t.value.getNormalMatrix(r.matrixWorld)),Hz=te(new ve).onObjectUpdate(({object:r},t)=>t.value.copy(r.matrixWorld).invert()),zc=ot(r=>r.context.modelViewMatrix||o4).once()().toVar("modelViewMatrix"),o4=ro.mul(Yr),K2=ot(r=>(r.context.isHighPrecisionModelViewMatrix=!0,te("mat4").onObjectUpdate(({object:t,camera:e})=>t.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld)))).once()().toVar("highpModelViewMatrix"),Z2=ot(r=>{const t=r.context.isHighPrecisionModelViewMatrix;return te("mat3").onObjectUpdate(({object:e,camera:n})=>(t!==!0&&e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),a4=ot(r=>r.shaderStage!=="fragment"?(an("TSL: `clipSpace` is only available in fragment stage."),ie()):r.context.clipSpace.toVarying("v_clipSpace")).once()(),Zp=dl("position","vec3"),Wn=Zp.toVarying("positionLocal"),Nd=Zp.toVarying("positionPrevious"),ca=ot(r=>Yr.mul(Wn).xyz.toVarying(r.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),PT=ot(()=>Wn.transformDirection(Yr).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),ds=ot(r=>{if(r.shaderStage==="fragment"&&r.material.vertexNode){const t=s4.mul(a4);return t.xyz.div(t.w).toVar("positionView")}return r.context.setupPositionView().toVarying("v_positionView")},"vec3").once(["POSITION","VERTEX"])(),yn=ot(r=>{let t;return r.camera.isOrthographicCamera?t=st(0,0,1):t=ds.negate().toVarying("v_positionViewDirection").normalize(),t.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class Wz extends Jt{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(t){if(t.shaderStage!=="fragment")return"true";const{material:e}=t;return e.side===Ss?"false":t.getFrontFacing()}}const l4=$t(Wz),zT=G(l4).mul(2).sub(1),Bd=ot(([r],{material:t})=>{const e=t.side;return e===Ss?r=r.mul(-1):e===ss&&(r=r.mul(zT)),r}),Mx=dl("normal","vec3"),sr=ot(r=>r.geometry.hasAttribute("normal")===!1?(Wt('TSL: Vertex attribute "normal" not found on geometry.'),st(0,1,0)):Mx,"vec3").once()().toVar("normalLocal"),c4=ds.dFdx().cross(ds.dFdy()).normalize().toVar("normalFlat"),Rd=ot(r=>{let t;return r.isFlatShading()?t=c4:t=IT(sr).toVarying("v_normalViewGeometry").normalize(),t},"vec3").once()().toVar("normalViewGeometry"),u4=ot(r=>{let t=Rd.transformDirection(ro);return r.isFlatShading()!==!0&&(t=t.toVarying("v_normalWorldGeometry")),t.normalize().toVar("normalWorldGeometry")},"vec3").once()(),Ve=ot(r=>{let t;return r.subBuildFn==="NORMAL"||r.subBuildFn==="VERTEX"?(t=Rd,r.isFlatShading()!==!0&&(t=Bd(t))):t=r.context.setupNormal().context({getUV:null,getTextureLevel:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),Ic=Ve.transformDirection(ro).toVar("normalWorld"),mc=ot(({subBuildFn:r,context:t})=>{let e;return r==="NORMAL"||r==="VERTEX"?e=Ve:e=t.setupClearcoatNormal().context({getUV:null,getTextureLevel:null}),e},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),h4=ot(([r,t=Yr])=>{const e=qs(t),n=r.div(st(e[0].dot(e[0]),e[1].dot(e[1]),e[2].dot(e[2])));return e.mul(n).xyz}),IT=ot(([r],t)=>{const e=t.context.modelNormalViewMatrix;if(e)return e.transformDirection(r);const n=r4.mul(r);return ro.transformDirection(n)}),qz=ot(()=>(Wt('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),Ve)).once(["NORMAL","VERTEX"])(),$z=ot(()=>(Wt('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),Ic)).once(["NORMAL","VERTEX"])(),Xz=ot(()=>(Wt('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),mc)).once(["NORMAL","VERTEX"])(),aR=new tr,zS=new ve,d4=te(0).onReference(({material:r})=>r).onObjectUpdate(({material:r})=>r.refractionRatio),kg=te(1).onReference(({material:r})=>r).onObjectUpdate(function({material:r,scene:t}){return r.envMap?r.envMapIntensity:t.environmentIntensity}),VT=te(new ve).onReference(function(r){return r.material}).onObjectUpdate(function({material:r,scene:t}){const e=t.environment!==null&&r.envMap===null?t.environmentRotation:r.envMapRotation;return e?(aR.copy(e),zS.makeRotationFromEuler(aR)):zS.identity(),zS}),f4=yn.negate().reflect(Ve),p4=yn.negate().refract(Ve,d4),m4=f4.transformDirection(ro).toVar("reflectVector"),g4=p4.transformDirection(ro).toVar("reflectVector"),y4=new lx;class jz extends fa{static get type(){return"CubeTextureNode"}constructor(t,e=null,n=null,s=null){super(t,e,n,s),this.isCubeTextureNode=!0}getInputType(){return this.value.isDepthTexture===!0?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const t=this.value;return t.mapping===Sd?m4:t.mapping===ey?g4:(Ht('CubeTextureNode: Mapping "%s" not supported.',t.mapping),st(0,0,0))}setUpdateMatrix(){}setupUV(t,e){const n=this.value;return n.isDepthTexture===!0?t.renderer.coordinateSystem===Jr?st(e.x,e.y.negate(),e.z):e:((t.renderer.coordinateSystem===Jr||!n.isRenderTargetTexture)&&(e=st(e.x.negate(),e.yz)),VT.mul(e))}generateUV(t,e){return e.build(t,this.sampler===!0?"vec3":"ivec3")}}const GT=be(jz).setParameterLength(1,4).setName("cubeTexture"),Li=(r=y4,t=null,e=null,n=null)=>{let s;return r&&r.isCubeTextureNode===!0?(s=Qt(r.clone()),s.referenceNode=r,t!==null&&(s.uvNode=Qt(t)),e!==null&&(s.levelNode=Qt(e)),n!==null&&(s.biasNode=Qt(n))):s=GT(r,t,e,n),s},Yz=(r=y4)=>GT(r);class Kz extends $u{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),n=this.referenceNode.getNodeType(),s=this.getNodeType();return t.format(e,n,s)}}class vx extends Jt{static get type(){return"ReferenceNode"}constructor(t,e,n=null,s=null){super(),this.property=t,this.uniformType=e,this.object=n,this.count=s,this.properties=t.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=de.OBJECT}element(t){return new Kz(this,Qt(t))}setGroup(t){return this.group=t,this}setName(t){return this.name=t,this}label(t){return Wt('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(t)}setNodeType(t){let e=null;this.count!==null?e=Kp(null,t,this.count):Array.isArray(this.getValueFromReference())?e=yi(null,t):t==="texture"?e=qe(null):t==="cubeTexture"?e=Li(null):e=te(null,t),this.group!==null&&e.setGroup(this.group),this.name!==null&&e.setName(this.name),this.node=e}getNodeType(t){return this.node===null&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let n=t[e[0]];for(let s=1;s<e.length;s++)n=n[e[s]];return n}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const Ln=(r,t,e)=>new vx(r,t,e),Q2=(r,t,e,n)=>new vx(r,t,n,e);class Zz extends vx{static get type(){return"MaterialReferenceNode"}constructor(t,e,n=null){super(t,e,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(t){return this.reference=this.material!==null?this.material:t.material,this.reference}}const tl=(r,t,e=null)=>new Zz(r,t,e),x4=fn(),Qz=ds.dFdx(),Jz=ds.dFdy(),b4=x4.dFdx(),S4=x4.dFdy(),w4=Ve,T4=Jz.cross(w4),_4=w4.cross(Qz),J2=T4.mul(b4.x).add(_4.mul(S4.x)),tw=T4.mul(b4.y).add(_4.mul(S4.y)),lR=J2.dot(J2).max(tw.dot(tw)),M4=lR.equal(0).select(0,lR.inverseSqrt()),t6=J2.mul(M4).toVar("tangentViewFrame"),e6=tw.mul(M4).toVar("bitangentViewFrame"),Ax=dl("tangent","vec4"),Ed=Ax.xyz.toVar("tangentLocal"),Nx=ot(r=>{let t;return r.subBuildFn==="VERTEX"||r.geometry.hasAttribute("tangent")?t=zc.mul(ie(Ed,0)).xyz.toVarying("v_tangentView").normalize():t=t6,r.isFlatShading()!==!0&&(t=Bd(t)),t},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),v4=Nx.transformDirection(ro).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),Rx=ot(([r,t],e)=>{let n=r.mul(Ax.w).xyz;return e.subBuildFn==="NORMAL"&&e.isFlatShading()!==!0&&(n=n.toVarying(t)),n}).once(["NORMAL"]),n6=Rx(Mx.cross(Ax),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),s6=Rx(sr.cross(Ed),"v_bitangentLocal").normalize().toVar("bitangentLocal"),A4=ot(r=>{let t;return r.subBuildFn==="VERTEX"||r.geometry.hasAttribute("tangent")?t=Rx(Ve.cross(Nx),"v_bitangentView").normalize():t=e6,r.isFlatShading()!==!0&&(t=Bd(t)),t},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),i6=Rx(Ic.cross(v4),"v_bitangentWorld").normalize().toVar("bitangentWorld"),Bu=qs(Nx,A4,Ve).toVar("TBNViewMatrix"),N4=yn.mul(Bu),r6=(r,t)=>r.sub(N4.mul(t)),R4=ot(()=>{let r=Uu.cross(yn);return r=r.cross(Uu).normalize(),r=Be(r,Ve,uc.mul(Zo.oneMinus()).oneMinus().pow2().pow2()).normalize(),r}).once()(),E4=r=>Qt(r).mul(.5).add(.5),o6=r=>Qt(r).mul(2).sub(1),ew=r=>st(r,Oi(wx(G(1).sub(no(r,r)))));class a6 extends rs{static get type(){return"NormalMapNode"}constructor(t,e=null){super("vec3"),this.node=t,this.scaleNode=e,this.normalMapType=al,this.unpackNormalMode=sS}setup(t){const{normalMapType:e,scaleNode:n,unpackNormalMode:s}=this;let i=this.node.mul(2).sub(1);if(e===al?s===$3?i=ew(i.xy):s===nU?i=ew(i.yw):s!==sS&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${s}`):s!==sS&&console.error(`THREE.NodeMaterial: Normal map type '${e}' is not compatible with unpack normal mode '${s}'`),n!==null){let c=n;t.isFlatShading()===!0&&(c=Bd(c)),i=st(i.xy.mul(c),i.z)}let a=null;return e===eU?a=IT(i):e===al?a=Bu.mul(i).normalize():(Ht(`NodeMaterial: Unsupported normal map type: ${e}`),a=Ve),a}}const nw=be(a6).setParameterLength(1,2),l6=ot(({textureNode:r,bumpScale:t})=>{const e=s=>r.isolate().context({getUV:i=>s(i.uvNode||fn()),forceUVContext:!0}),n=G(e(s=>s));return Vt(G(e(s=>s.add(s.dFdx()))).sub(n),G(e(s=>s.add(s.dFdy()))).sub(n)).mul(t)}),c6=ot(r=>{const{surf_pos:t,surf_norm:e,dHdxy:n}=r,s=t.dFdx().normalize(),i=t.dFdy().normalize(),a=e,c=i.cross(a),u=a.cross(s),d=s.dot(c).mul(zT),f=d.sign().mul(n.x.mul(c).add(n.y.mul(u)));return d.abs().mul(e).sub(f).normalize()});class u6 extends rs{static get type(){return"BumpMapNode"}constructor(t,e=null){super("vec3"),this.textureNode=t,this.scaleNode=e}setup(){const t=this.scaleNode!==null?this.scaleNode:1,e=l6({textureNode:this.textureNode,bumpScale:t});return c6({surf_pos:ds,surf_norm:Ve,dHdxy:e})}}const kT=be(u6).setParameterLength(1,2),cR=new Map;class Lt extends Jt{static get type(){return"MaterialNode"}constructor(t){super(),this.scope=t}getCache(t,e){let n=cR.get(t);return n===void 0&&(n=tl(t,e),cR.set(t,n)),n}getFloat(t){return this.getCache(t,"float")}getColor(t){return this.getCache(t,"color")}getTexture(t){return this.getCache(t==="map"?"map":t+"Map","texture")}setup(t){const e=t.context.material,n=this.scope;let s=null;if(n===Lt.COLOR){const i=e.color!==void 0?this.getColor(n):st();e.map&&e.map.isTexture===!0?s=i.mul(this.getTexture("map")):s=i}else if(n===Lt.OPACITY){const i=this.getFloat(n);e.alphaMap&&e.alphaMap.isTexture===!0?s=i.mul(this.getTexture("alpha")):s=i}else if(n===Lt.SPECULAR_STRENGTH)e.specularMap&&e.specularMap.isTexture===!0?s=this.getTexture("specular").r:s=G(1);else if(n===Lt.SPECULAR_INTENSITY){const i=this.getFloat(n);e.specularIntensityMap&&e.specularIntensityMap.isTexture===!0?s=i.mul(this.getTexture(n).a):s=i}else if(n===Lt.SPECULAR_COLOR){const i=this.getColor(n);e.specularColorMap&&e.specularColorMap.isTexture===!0?s=i.mul(this.getTexture(n).rgb):s=i}else if(n===Lt.ROUGHNESS){const i=this.getFloat(n);e.roughnessMap&&e.roughnessMap.isTexture===!0?s=i.mul(this.getTexture(n).g):s=i}else if(n===Lt.METALNESS){const i=this.getFloat(n);e.metalnessMap&&e.metalnessMap.isTexture===!0?s=i.mul(this.getTexture(n).b):s=i}else if(n===Lt.EMISSIVE){const i=this.getFloat("emissiveIntensity"),a=this.getColor(n).mul(i);e.emissiveMap&&e.emissiveMap.isTexture===!0?s=a.mul(this.getTexture(n)):s=a}else if(n===Lt.NORMAL)e.normalMap?(s=nw(this.getTexture("normal"),this.getCache("normalScale","vec2")),s.normalMapType=e.normalMapType,(e.normalMap.format==Qo||e.normalMap.format==Bp||e.normalMap.format==Dp)&&(s.unpackNormalMode=$3)):e.bumpMap?s=kT(this.getTexture("bump").r,this.getFloat("bumpScale")):s=Ve;else if(n===Lt.CLEARCOAT){const i=this.getFloat(n);e.clearcoatMap&&e.clearcoatMap.isTexture===!0?s=i.mul(this.getTexture(n).r):s=i}else if(n===Lt.CLEARCOAT_ROUGHNESS){const i=this.getFloat(n);e.clearcoatRoughnessMap&&e.clearcoatRoughnessMap.isTexture===!0?s=i.mul(this.getTexture(n).r):s=i}else if(n===Lt.CLEARCOAT_NORMAL)e.clearcoatNormalMap?s=nw(this.getTexture(n),this.getCache(n+"Scale","vec2")):s=Ve;else if(n===Lt.SHEEN){const i=this.getColor("sheenColor").mul(this.getFloat("sheen"));e.sheenColorMap&&e.sheenColorMap.isTexture===!0?s=i.mul(this.getTexture("sheenColor").rgb):s=i}else if(n===Lt.SHEEN_ROUGHNESS){const i=this.getFloat(n);e.sheenRoughnessMap&&e.sheenRoughnessMap.isTexture===!0?s=i.mul(this.getTexture(n).a):s=i,s=s.clamp(1e-4,1)}else if(n===Lt.ANISOTROPY)if(e.anisotropyMap&&e.anisotropyMap.isTexture===!0){const i=this.getTexture(n);s=gx(id.x,id.y,id.y.negate(),id.x).mul(i.rg.mul(2).sub(Vt(1)).normalize().mul(i.b))}else s=id;else if(n===Lt.IRIDESCENCE_THICKNESS){const i=Ln("1","float",e.iridescenceThicknessRange);if(e.iridescenceThicknessMap){const a=Ln("0","float",e.iridescenceThicknessRange);s=i.sub(a).mul(this.getTexture(n).g).add(a)}else s=i}else if(n===Lt.TRANSMISSION){const i=this.getFloat(n);e.transmissionMap?s=i.mul(this.getTexture(n).r):s=i}else if(n===Lt.THICKNESS){const i=this.getFloat(n);e.thicknessMap?s=i.mul(this.getTexture(n).g):s=i}else if(n===Lt.IOR)s=this.getFloat(n);else if(n===Lt.LIGHT_MAP)s=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===Lt.AO)s=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===Lt.LINE_DASH_OFFSET)s=e.dashOffset?this.getFloat(n):G(0);else{const i=this.getNodeType(t);s=this.getCache(n,i)}return s}}Lt.ALPHA_TEST="alphaTest";Lt.COLOR="color";Lt.OPACITY="opacity";Lt.SHININESS="shininess";Lt.SPECULAR="specular";Lt.SPECULAR_STRENGTH="specularStrength";Lt.SPECULAR_INTENSITY="specularIntensity";Lt.SPECULAR_COLOR="specularColor";Lt.REFLECTIVITY="reflectivity";Lt.ROUGHNESS="roughness";Lt.METALNESS="metalness";Lt.NORMAL="normal";Lt.CLEARCOAT="clearcoat";Lt.CLEARCOAT_ROUGHNESS="clearcoatRoughness";Lt.CLEARCOAT_NORMAL="clearcoatNormal";Lt.EMISSIVE="emissive";Lt.ROTATION="rotation";Lt.SHEEN="sheen";Lt.SHEEN_ROUGHNESS="sheenRoughness";Lt.ANISOTROPY="anisotropy";Lt.IRIDESCENCE="iridescence";Lt.IRIDESCENCE_IOR="iridescenceIOR";Lt.IRIDESCENCE_THICKNESS="iridescenceThickness";Lt.IOR="ior";Lt.TRANSMISSION="transmission";Lt.THICKNESS="thickness";Lt.ATTENUATION_DISTANCE="attenuationDistance";Lt.ATTENUATION_COLOR="attenuationColor";Lt.LINE_SCALE="scale";Lt.LINE_DASH_SIZE="dashSize";Lt.LINE_GAP_SIZE="gapSize";Lt.LINE_WIDTH="linewidth";Lt.LINE_DASH_OFFSET="dashOffset";Lt.POINT_SIZE="size";Lt.DISPERSION="dispersion";Lt.LIGHT_MAP="light";Lt.AO="ao";const C4=$t(Lt,Lt.ALPHA_TEST),D4=$t(Lt,Lt.COLOR),B4=$t(Lt,Lt.SHININESS),L4=$t(Lt,Lt.EMISSIVE),HT=$t(Lt,Lt.OPACITY),O4=$t(Lt,Lt.SPECULAR),sw=$t(Lt,Lt.SPECULAR_INTENSITY),F4=$t(Lt,Lt.SPECULAR_COLOR),Mp=$t(Lt,Lt.SPECULAR_STRENGTH),Hg=$t(Lt,Lt.REFLECTIVITY),U4=$t(Lt,Lt.ROUGHNESS),P4=$t(Lt,Lt.METALNESS),z4=$t(Lt,Lt.NORMAL),I4=$t(Lt,Lt.CLEARCOAT),V4=$t(Lt,Lt.CLEARCOAT_ROUGHNESS),G4=$t(Lt,Lt.CLEARCOAT_NORMAL),k4=$t(Lt,Lt.ROTATION),H4=$t(Lt,Lt.SHEEN),W4=$t(Lt,Lt.SHEEN_ROUGHNESS),q4=$t(Lt,Lt.ANISOTROPY),$4=$t(Lt,Lt.IRIDESCENCE),X4=$t(Lt,Lt.IRIDESCENCE_IOR),j4=$t(Lt,Lt.IRIDESCENCE_THICKNESS),Y4=$t(Lt,Lt.TRANSMISSION),K4=$t(Lt,Lt.THICKNESS),Z4=$t(Lt,Lt.IOR),Q4=$t(Lt,Lt.ATTENUATION_DISTANCE),J4=$t(Lt,Lt.ATTENUATION_COLOR),tD=$t(Lt,Lt.LINE_SCALE),eD=$t(Lt,Lt.LINE_DASH_SIZE),nD=$t(Lt,Lt.LINE_GAP_SIZE),h6=$t(Lt,Lt.LINE_WIDTH),sD=$t(Lt,Lt.LINE_DASH_OFFSET),iD=$t(Lt,Lt.POINT_SIZE),rD=$t(Lt,Lt.DISPERSION),WT=$t(Lt,Lt.LIGHT_MAP),oD=$t(Lt,Lt.AO),id=te(new Ut).onReference(function(r){return r.material}).onRenderUpdate(function({material:r}){this.value.set(r.anisotropy*Math.cos(r.anisotropyRotation),r.anisotropy*Math.sin(r.anisotropyRotation))}),aD=ot(r=>r.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class d6 extends $u{static get type(){return"StorageArrayElementNode"}constructor(t,e){super(t,e),this.isStorageArrayElementNode=!0}set storageBufferNode(t){this.node=t}get storageBufferNode(){return this.node}getMemberType(t,e){const n=this.storageBufferNode.structTypeNode;return n?n.getMemberType(t,e):"void"}setup(t){return t.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&t.setupPBO(this.node),super.setup(t)}generate(t,e){let n;const s=t.context.assign;if(t.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&s!==!0&&(this.node.value.isInstancedBufferAttribute||t.shaderStage!=="compute")?n=t.generatePBO(this):n=this.node.build(t):n=super.generate(t),s!==!0){const i=this.getNodeType(t);n=t.format(n,i,e)}return n}}const f6=be(d6).setParameterLength(2);class p6 extends OT{static get type(){return"StorageBufferNode"}constructor(t,e=null,n=0){let s,i=null;e&&e.isStruct?(s="struct",i=e.layout,(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute)&&(n=t.count)):e===null&&(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute)?(s=xC(t.itemSize),n=t.count):s=e,super(t,s,n),this.isStorageBufferNode=!0,this.structTypeNode=i,this.access=ri.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,t.isStorageBufferAttribute!==!0&&t.isStorageInstancedBufferAttribute!==!0&&(t.isInstancedBufferAttribute?t.isStorageInstancedBufferAttribute=!0:t.isStorageBufferAttribute=!0)}getHash(t){if(this.bufferCount===0){let e=t.globalCache.getData(this.value);return e===void 0&&(e={node:this},t.globalCache.setData(this.value,e)),e.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(t){return f6(this,t)}setPBO(t){return this.isPBO=t,this}getPBO(){return this.isPBO}setAccess(t){return this.access=t,this}toReadOnly(){return this.setAccess(ri.READ_ONLY)}setAtomic(t){return this.isAtomic=t,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=CT(this.value),this._varying=Uc(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(t){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(t);if(t.isAvailable("storageBuffer")||t.isAvailable("indirectStorageBuffer"))return super.getNodeType(t);const{attribute:e}=this.getAttributeData();return e.getNodeType(t)}getMemberType(t,e){return this.structTypeNode!==null?this.structTypeNode.getMemberType(t,e):"void"}generate(t){if(this.structTypeNode!==null&&this.structTypeNode.build(t),t.isAvailable("storageBuffer")||t.isAvailable("indirectStorageBuffer"))return super.generate(t);const{attribute:e,varying:n}=this.getAttributeData(),s=n.build(t);return t.registerTransform(s,e),s}}const Nc=(r,t=null,e=0)=>new p6(r,t,e);class In extends Jt{static get type(){return"IndexNode"}constructor(t){super("uint"),this.scope=t,this.isIndexNode=!0}generate(t){const e=this.getNodeType(t),n=this.scope;let s;if(n===In.VERTEX)s=t.getVertexIndex();else if(n===In.INSTANCE)s=t.getInstanceIndex();else if(n===In.DRAW)s=t.getDrawIndex();else if(n===In.INVOCATION_LOCAL)s=t.getInvocationLocalIndex();else if(n===In.INVOCATION_SUBGROUP)s=t.getInvocationSubgroupIndex();else if(n===In.SUBGROUP)s=t.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let i;return t.shaderStage==="vertex"||t.shaderStage==="compute"?i=s:i=Uc(this).build(t,e),i}}In.VERTEX="vertex";In.INSTANCE="instance";In.SUBGROUP="subgroup";In.INVOCATION_LOCAL="invocationLocal";In.INVOCATION_SUBGROUP="invocationSubgroup";In.DRAW="draw";const lD=$t(In,In.VERTEX),ua=$t(In,In.INSTANCE),m6=$t(In,In.SUBGROUP),g6=$t(In,In.INVOCATION_SUBGROUP),y6=$t(In,In.INVOCATION_LOCAL),cD=$t(In,In.DRAW);class uD extends Jt{static get type(){return"InstanceNode"}constructor(t,e,n=null){super("void"),this.count=t,this.instanceMatrix=e,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=de.FRAME,this.buffer=null,this.bufferColor=null,this.previousInstanceMatrixNode=null}get isStorageMatrix(){const{instanceMatrix:t}=this;return t&&t.isStorageInstancedBufferAttribute===!0}get isStorageColor(){const{instanceColor:t}=this;return t&&t.isStorageInstancedBufferAttribute===!0}setup(t){let{instanceMatrixNode:e,instanceColorNode:n}=this;e===null&&(e=this._createInstanceMatrixNode(!0,t),this.instanceMatrixNode=e);const{instanceColor:s,isStorageColor:i}=this;if(s&&n===null){if(i)n=Nc(s,"vec3",Math.max(s.count,1)).element(ua);else{const c=new Mc(s.array,3),u=s.usage===Lp?Y2:Vy;this.bufferColor=c,n=st(u(c,"vec3",3,0))}this.instanceColorNode=n}const a=e.mul(Wn).xyz;if(Wn.assign(a),t.needsPreviousData()&&Nd.assign(this.getPreviousInstancedPosition(t)),t.hasGeometryAttribute("normal")){const c=h4(sr,e);sr.assign(c)}this.instanceColorNode!==null&&Ip("vec3","vInstanceColor").assign(this.instanceColorNode)}update(t){this.buffer!==null&&this.isStorageMatrix!==!0&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&this.isStorageColor!==!0&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)),this.previousInstanceMatrixNode!==null&&t.object.previousInstanceMatrix.array.set(this.instanceMatrix.array)}getPreviousInstancedPosition(t){const e=t.object;return this.previousInstanceMatrixNode===null&&(e.previousInstanceMatrix=this.instanceMatrix.clone(),this.previousInstanceMatrixNode=this._createInstanceMatrixNode(!1,t)),this.previousInstanceMatrixNode.mul(Nd).xyz}_createInstanceMatrixNode(t,e){let n;const{instanceMatrix:s}=this,{count:i}=s;if(this.isStorageMatrix)n=Nc(s,"mat4",Math.max(i,1)).element(ua);else if(i*16*4<=e.getUniformBufferLimit())n=Kp(s.array,"mat4",Math.max(i,1)).element(ua);else{const c=new iP(s.array,16,1);t===!0&&(this.buffer=c);const u=s.usage===Lp?Y2:Vy,d=[u(c,"vec4",16,0),u(c,"vec4",16,4),u(c,"vec4",16,8),u(c,"vec4",16,12)];n=vc(...d)}return n}}const x6=be(uD).setParameterLength(2,3);class b6 extends uD{static get type(){return"InstancedMeshNode"}constructor(t){const{count:e,instanceMatrix:n,instanceColor:s}=t;super(e,n,s),this.instancedMesh=t}}const hD=be(b6).setParameterLength(1);class S6 extends Jt{static get type(){return"BatchNode"}constructor(t){super("void"),this.batchMesh=t,this.batchingIdNode=null}setup(t){this.batchingIdNode===null&&(t.getDrawIndex()===null?this.batchingIdNode=ua:this.batchingIdNode=cD);const n=ot(([x])=>{const S=Q(Ac(Qn(this.batchMesh._indirectTexture),0).x).toConst(),T=Q(x).mod(S).toConst(),M=Q(x).div(S).toConst();return Qn(this.batchMesh._indirectTexture,Cs(T,M)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(Q(this.batchingIdNode)),s=this.batchMesh._matricesTexture,i=Q(Ac(Qn(s),0).x).toConst(),a=G(n).mul(4).toInt().toConst(),c=a.mod(i).toConst(),u=a.div(i).toConst(),d=vc(Qn(s,Cs(c,u)),Qn(s,Cs(c.add(1),u)),Qn(s,Cs(c.add(2),u)),Qn(s,Cs(c.add(3),u))),f=this.batchMesh._colorsTexture;if(f!==null){const S=ot(([T])=>{const M=Q(Ac(Qn(f),0).x).toConst(),N=T,v=N.mod(M).toConst(),A=N.div(M).toConst();return Qn(f,Cs(v,A)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);Ip("vec3","vBatchColor").assign(S)}const p=qs(d);Wn.assign(d.mul(Wn));const g=sr.div(st(p[0].dot(p[0]),p[1].dot(p[1]),p[2].dot(p[2]))),y=p.mul(g).xyz;sr.assign(y),t.hasGeometryAttribute("tangent")&&Ed.mulAssign(p)}}const dD=be(S6).setParameterLength(1),uR=new WeakMap;class fD extends Jt{static get type(){return"SkinningNode"}constructor(t){super("void"),this.skinnedMesh=t,this.updateType=de.OBJECT,this.skinIndexNode=dl("skinIndex","uvec4"),this.skinWeightNode=dl("skinWeight","vec4"),this.bindMatrixNode=Ln("bindMatrix","mat4"),this.bindMatrixInverseNode=Ln("bindMatrixInverse","mat4"),this.boneMatricesNode=Q2("skeleton.boneMatrices","mat4",t.skeleton.bones.length),this.positionNode=Wn,this.toPositionNode=Wn,this.previousBoneMatricesNode=null}getSkinnedPosition(t=this.boneMatricesNode,e=this.positionNode){const{skinIndexNode:n,skinWeightNode:s,bindMatrixNode:i,bindMatrixInverseNode:a}=this,c=t.element(n.x),u=t.element(n.y),d=t.element(n.z),f=t.element(n.w),p=i.mul(e),g=ws(c.mul(s.x).mul(p),u.mul(s.y).mul(p),d.mul(s.z).mul(p),f.mul(s.w).mul(p));return a.mul(g).xyz}getSkinnedNormalAndTangent(t=this.boneMatricesNode,e=sr,n=Ed){const{skinIndexNode:s,skinWeightNode:i,bindMatrixNode:a,bindMatrixInverseNode:c}=this,u=t.element(s.x),d=t.element(s.y),f=t.element(s.z),p=t.element(s.w);let g=ws(i.x.mul(u),i.y.mul(d),i.z.mul(f),i.w.mul(p));g=c.mul(g).mul(a);const y=g.transformDirection(e).xyz,x=g.transformDirection(n).xyz;return{skinNormal:y,skinTangent:x}}getPreviousSkinnedPosition(t){const e=t.object;return this.previousBoneMatricesNode===null&&(e.skeleton.previousBoneMatrices=new Float32Array(e.skeleton.boneMatrices),this.previousBoneMatricesNode=Q2("skeleton.previousBoneMatrices","mat4",e.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,Nd)}setup(t){t.needsPreviousData()&&Nd.assign(this.getPreviousSkinnedPosition(t));const e=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(e),t.hasGeometryAttribute("normal")){const{skinNormal:n,skinTangent:s}=this.getSkinnedNormalAndTangent();sr.assign(n),t.hasGeometryAttribute("tangent")&&Ed.assign(s)}return e}generate(t,e){if(e!=="void")return super.generate(t,e)}update(t){const e=t.object&&t.object.skeleton?t.object.skeleton:this.skinnedMesh.skeleton;uR.get(e)!==t.frameId&&(uR.set(e,t.frameId),this.previousBoneMatricesNode!==null&&(e.previousBoneMatrices===null&&(e.previousBoneMatrices=new Float32Array(e.boneMatrices)),e.previousBoneMatrices.set(e.boneMatrices)),e.update())}}const pD=r=>new fD(r),w6=(r,t=null)=>{const e=new fD(r);return e.positionNode=Nc(new Mc(r.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(ua).toVar(),e.skinIndexNode=Nc(new Mc(new Uint32Array(r.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(ua).toVar(),e.skinWeightNode=Nc(new Mc(r.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(ua).toVar(),e.bindMatrixNode=te(r.bindMatrix,"mat4"),e.bindMatrixInverseNode=te(r.bindMatrixInverse,"mat4"),e.boneMatricesNode=Kp(r.skeleton.boneMatrices,"mat4",r.skeleton.bones.length),e.toPositionNode=t,Qt(e)};class T6 extends Jt{static get type(){return"LoopNode"}constructor(t=[]){super("void"),this.params=t}getVarName(t){return String.fromCharCode(105+t)}getProperties(t){const e=t.getNodeProperties(this);if(e.stackNode!==void 0)return e;const n={};for(let c=0,u=this.params.length-1;c<u;c++){const d=this.params[c],f=d.isNode!==!0&&d.name||this.getVarName(c),p=d.isNode!==!0&&d.type||"int";n[f]=vo(f,p)}const s=t.addStack(),i=this.params[this.params.length-1](n);e.returnsNode=i.context({nodeLoop:i}),e.stackNode=s;const a=this.params[0];if(a.isNode!==!0&&typeof a.update=="function"){const c=ot(this.params[0].update)(n);e.updateNode=c.context({nodeLoop:c})}return t.removeStack(),e}setup(t){if(this.getProperties(t),t.fnCall){const e=t.getDataFromNode(t.fnCall.shaderNode);e.hasLoop=!0}}generate(t){const e=this.getProperties(t),n=this.params,s=e.stackNode;for(let a=0,c=n.length-1;a<c;a++){const u=n[a];let d=!1,f=null,p=null,g=null,y=null,x=null,S=null;u.isNode?u.getNodeType(t)==="bool"?(d=!0,y="bool",p=u.build(t,y)):(y="int",g=this.getVarName(a),f="0",p=u.build(t,y),x="<"):(y=u.type||"int",g=u.name||this.getVarName(a),f=u.start,p=u.end,x=u.condition,S=u.update,typeof f=="number"?f=t.generateConst(y,f):f&&f.isNode&&(f=f.build(t,y)),typeof p=="number"?p=t.generateConst(y,p):p&&p.isNode&&(p=p.build(t,y)),f!==void 0&&p===void 0?(f=f+" - 1",p="0",x=">="):p!==void 0&&f===void 0&&(f="0",x="<"),x===void 0&&(Number(f)>Number(p)?x=">=":x="<"));let T;if(d)T=`while ( ${p} )`;else{const M={start:f,end:p},N=M.start,v=M.end;let A;const R=()=>x.includes("<")?"+=":"-=";if(S!=null)switch(typeof S){case"function":A=t.flowStagesNode(e.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":A=g+" "+R()+" "+t.generateConst(y,S);break;case"string":A=g+" "+S;break;default:S.isNode?A=g+" "+R()+" "+S.build(t):(Ht("TSL: 'Loop( { update: ... } )' is not a function, string or number.",this.stackTrace),A="break /* invalid update */")}else y==="int"||y==="uint"?S=x.includes("<")?"++":"--":S=R()+" 1.",A=g+" "+S;const L=t.getVar(y,g)+" = "+N,D=g+" "+x+" "+v;T=`for ( ${L}; ${D}; ${A} )`}t.addFlowCode((a===0?`
`:"")+t.tab+T+` {

`).addFlowTab()}const i=s.build(t,"void");e.returnsNode.build(t,"void"),t.removeFlowTab().addFlowCode(`
`+t.tab+i);for(let a=0,c=this.params.length-1;a<c;a++)t.addFlowCode((a===0?"":t.tab)+`}

`).removeFlowTab();t.addFlowTab()}}const cn=(...r)=>new T6(Fu(r,"int")).toStack(),_6=()=>vo("continue").toStack(),mD=()=>vo("break").toStack(),IS=new WeakMap,xr=new Ze,hR=ot(({bufferMap:r,influence:t,stride:e,width:n,depth:s,offset:i})=>{const a=Q(lD).mul(e).add(i),c=a.div(n),u=a.sub(c.mul(n));return Qn(r,Cs(u,c)).depth(s).xyz.mul(t)});function M6(r){const t=r.morphAttributes.position!==void 0,e=r.morphAttributes.normal!==void 0,n=r.morphAttributes.color!==void 0,s=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,i=s!==void 0?s.length:0;let a=IS.get(r);if(a===void 0||a.count!==i){let N=function(){T.dispose(),IS.delete(r),r.removeEventListener("dispose",N)};var c=N;a!==void 0&&a.texture.dispose();const u=r.morphAttributes.position||[],d=r.morphAttributes.normal||[],f=r.morphAttributes.color||[];let p=0;t===!0&&(p=1),e===!0&&(p=2),n===!0&&(p=3);let g=r.attributes.position.count*p,y=1;const x=4096;g>x&&(y=Math.ceil(g/x),g=x);const S=new Float32Array(g*y*4*i),T=new IU(S,g,y,i);T.type=Di,T.needsUpdate=!0;const M=p*4;for(let v=0;v<i;v++){const A=u[v],R=d[v],L=f[v],D=g*y*4*v;for(let U=0;U<A.count;U++){const B=U*M;t===!0&&(xr.fromBufferAttribute(A,U),S[D+B+0]=xr.x,S[D+B+1]=xr.y,S[D+B+2]=xr.z,S[D+B+3]=0),e===!0&&(xr.fromBufferAttribute(R,U),S[D+B+4]=xr.x,S[D+B+5]=xr.y,S[D+B+6]=xr.z,S[D+B+7]=0),n===!0&&(xr.fromBufferAttribute(L,U),S[D+B+8]=xr.x,S[D+B+9]=xr.y,S[D+B+10]=xr.z,S[D+B+11]=L.itemSize===4?xr.w:1)}}a={count:i,texture:T,stride:p,size:new Ut(g,y)},IS.set(r,a),r.addEventListener("dispose",N)}return a}class v6 extends Jt{static get type(){return"MorphNode"}constructor(t){super("void"),this.mesh=t,this.morphBaseInfluence=te(1),this.updateType=de.OBJECT}setup(t){const{geometry:e}=t,n=e.morphAttributes.position!==void 0,s=e.hasAttribute("normal")&&e.morphAttributes.normal!==void 0,i=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,a=i!==void 0?i.length:0,{texture:c,stride:u,size:d}=M6(e);n===!0&&Wn.mulAssign(this.morphBaseInfluence),s===!0&&sr.mulAssign(this.morphBaseInfluence);const f=Q(d.width);cn(a,({i:p})=>{const g=G(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?g.assign(Qn(this.mesh.morphTexture,Cs(Q(p).add(1),Q(ua))).r):g.assign(Ln("morphTargetInfluences","float").element(p).toVar()),re(g.notEqual(0),()=>{n===!0&&Wn.addAssign(hR({bufferMap:c,influence:g,stride:u,width:f,depth:p,offset:Q(0)})),s===!0&&sr.addAssign(hR({bufferMap:c,influence:g,stride:u,width:f,depth:p,offset:Q(1)}))})})}update(){const t=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?t.value=1:t.value=1-this.mesh.morphTargetInfluences.reduce((e,n)=>e+n,0)}}const gD=be(v6).setParameterLength(1);class Ld extends Jt{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class A6 extends Ld{static get type(){return"AONode"}constructor(t=null){super(),this.aoNode=t}setup(t){t.context.ambientOcclusion.mulAssign(this.aoNode)}}class N6 extends A5{static get type(){return"LightingContextNode"}constructor(t,e=null,n=null,s=null){super(t),this.lightingModel=e,this.backdropNode=n,this.backdropAlphaNode=s,this._value=null}getContext(){const{backdropNode:t,backdropAlphaNode:e}=this,n=st().toVar("directDiffuse"),s=st().toVar("directSpecular"),i=st().toVar("indirectDiffuse"),a=st().toVar("indirectSpecular"),c={directDiffuse:n,directSpecular:s,indirectDiffuse:i,indirectSpecular:a};return{radiance:st().toVar("radiance"),irradiance:st().toVar("irradiance"),iblIrradiance:st().toVar("iblIrradiance"),ambientOcclusion:G(1).toVar("ambientOcclusion"),reflectedLight:c,backdrop:t,backdropAlpha:e}}setup(t){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||t.context.lightingModel,super.setup(t)}}const yD=be(N6);class R6 extends Ld{static get type(){return"IrradianceNode"}constructor(t){super(),this.node=t}setup(t){t.context.irradiance.addAssign(this.node)}}const Hh=new Ut;class Ex extends fa{static get type(){return"ViewportTextureNode"}constructor(t=la,e=null,n=null){let s=null;n===null?(s=new Fw,s.minFilter=sa,n=s):s=n,super(n,t,e),this.generateMipmaps=!1,this.defaultFramebuffer=s,this.isOutputTextureNode=!0,this.updateBeforeType=de.RENDER,this._cacheTextures=new WeakMap}getTextureForReference(t=null){let e,n;if(this.referenceNode?(e=this.referenceNode.defaultFramebuffer,n=this.referenceNode._cacheTextures):(e=this.defaultFramebuffer,n=this._cacheTextures),t===null)return e;if(n.has(t)===!1){const s=e.clone();n.set(t,s)}return n.get(t)}updateReference(t){const e=t.renderer.getRenderTarget();return this.value=this.getTextureForReference(e),this.value}updateBefore(t){const e=t.renderer,n=e.getRenderTarget();n===null?e.getDrawingBufferSize(Hh):Hh.set(n.width,n.height);const s=this.getTextureForReference(n);(s.image.width!==Hh.width||s.image.height!==Hh.height)&&(s.image.width=Hh.width,s.image.height=Hh.height,s.needsUpdate=!0);const i=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,e.copyFramebufferToTexture(s),s.generateMipmaps=i}clone(){const t=new this.constructor(this.uvNode,this.levelNode,this.value);return t.generateMipmaps=this.generateMipmaps,t}}const E6=be(Ex).setParameterLength(0,3),qT=be(Ex,null,null,{generateMipmaps:!0}).setParameterLength(0,3),C6=qT(),xD=(r=la,t=null)=>C6.sample(r,t);let Ym=null;class D6 extends Ex{static get type(){return"ViewportDepthTextureNode"}constructor(t=la,e=null){Ym===null&&(Ym=new Zr),super(t,e,Ym)}getTextureForReference(){return Ym}}const $T=be(D6).setParameterLength(0,2);class Zi extends Jt{static get type(){return"ViewportDepthNode"}constructor(t,e=null){super("float"),this.scope=t,this.valueNode=e,this.isViewportDepthNode=!0}generate(t){const{scope:e}=this;return e===Zi.DEPTH_BASE?t.getFragDepth():super.generate(t)}setup({camera:t}){const{scope:e}=this,n=this.valueNode;let s=null;if(e===Zi.DEPTH_BASE)n!==null&&(s=SD().assign(n));else if(e===Zi.DEPTH)t.isPerspectiveCamera?s=XT(ds.z,fc,pc):s=yd(ds.z,fc,pc);else if(e===Zi.LINEAR_DEPTH)if(n!==null)if(t.isPerspectiveCamera){const i=jT(n,fc,pc);s=yd(i,fc,pc)}else s=n;else s=yd(ds.z,fc,pc);return s}}Zi.DEPTH_BASE="depthBase";Zi.DEPTH="depth";Zi.LINEAR_DEPTH="linearDepth";const yd=(r,t,e)=>r.add(t).div(t.sub(e)),B6=(r,t,e)=>r.add(e).div(e.sub(t)),L6=ot(([r,t,e],n)=>n.renderer.reversedDepthBuffer===!0?e.sub(t).mul(r).sub(e):t.sub(e).mul(r).sub(t)),XT=(r,t,e)=>t.add(r).mul(e).div(e.sub(t).mul(r)),bD=(r,t,e)=>t.mul(r.add(e)).div(r.mul(t.sub(e))),jT=ot(([r,t,e],n)=>n.renderer.reversedDepthBuffer===!0?t.mul(e).div(t.sub(e).mul(r).sub(t)):t.mul(e).div(e.sub(t).mul(r).sub(e))),YT=(r,t,e)=>{t=t.max(1e-6).toVar();const n=ra(r.negate().div(t)),s=ra(e.div(t));return n.div(s)},O6=(r,t,e)=>{const n=r.mul(bx(e.div(t)));return G(Math.E).pow(n).mul(t).negate()},SD=be(Zi,Zi.DEPTH_BASE),KT=$t(Zi,Zi.DEPTH),Gy=be(Zi,Zi.LINEAR_DEPTH).setParameterLength(0,1),F6=Gy($T());KT.assign=r=>SD(r);class Qr extends Jt{static get type(){return"ClippingNode"}constructor(t=Qr.DEFAULT){super(),this.scope=t}setup(t){super.setup(t);const e=t.clippingContext,{intersectionPlanes:n,unionPlanes:s}=e;return this.hardwareClipping=t.material.hardwareClipping,this.scope===Qr.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,s):this.scope===Qr.HARDWARE?this.setupHardwareClipping(s,t):this.setupDefault(n,s)}setupAlphaToCoverage(t,e){return ot(()=>{const n=G().toVar("distanceToPlane"),s=G().toVar("distanceToGradient"),i=G(1).toVar("clipOpacity"),a=e.length;if(this.hardwareClipping===!1&&a>0){const u=yi(e).setGroup(ne);cn(a,({i:d})=>{const f=u.element(d);n.assign(ds.dot(f.xyz).negate().add(f.w)),s.assign(n.fwidth().div(2)),i.mulAssign(Eo(s.negate(),s,n))})}const c=t.length;if(c>0){const u=yi(t).setGroup(ne),d=G(1).toVar("intersectionClipOpacity");cn(c,({i:f})=>{const p=u.element(f);n.assign(ds.dot(p.xyz).negate().add(p.w)),s.assign(n.fwidth().div(2)),d.mulAssign(Eo(s.negate(),s,n).oneMinus())}),i.mulAssign(d.oneMinus())}on.a.mulAssign(i),on.a.equal(0).discard()})()}setupDefault(t,e){return ot(()=>{const n=e.length;if(this.hardwareClipping===!1&&n>0){const i=yi(e).setGroup(ne);cn(n,({i:a})=>{const c=i.element(a);ds.dot(c.xyz).greaterThan(c.w).discard()})}const s=t.length;if(s>0){const i=yi(t).setGroup(ne),a=eo(!0).toVar("clipped");cn(s,({i:c})=>{const u=i.element(c);a.assign(ds.dot(u.xyz).greaterThan(u.w).and(a))}),a.discard()}})()}setupHardwareClipping(t,e){const n=t.length;return e.enableHardwareClipping(n),ot(()=>{const s=yi(t).setGroup(ne),i=ml(e.getClipDistance());cn(n,({i:a})=>{const c=s.element(a),u=ds.dot(c.xyz).sub(c.w).negate();i.element(a).assign(u)})})()}}Qr.ALPHA_TO_COVERAGE="alphaToCoverage";Qr.DEFAULT="default";Qr.HARDWARE="hardware";const U6=()=>new Qr,P6=()=>new Qr(Qr.ALPHA_TO_COVERAGE),z6=()=>new Qr(Qr.HARDWARE),I6=.05,dR=ot(([r])=>No(fe(1e4,Ci(fe(17,r.x).add(fe(.1,r.y)))).mul(ws(.1,Mn(Ci(fe(13,r.y).add(r.x))))))),fR=ot(([r])=>dR(Vt(dR(r.xy),r.z))),V6=ot(([r])=>{const t=$n(aa(yT(r.xyz)),aa(xT(r.xyz))),e=G(1).div(G(I6).mul(t)).toVar("pixScale"),n=Vt(vd(oa(ra(e))),vd(Sx(ra(e)))),s=Vt(fR(oa(n.x.mul(r.xyz))),fR(oa(n.y.mul(r.xyz)))),i=No(ra(e)),a=ws(fe(i.oneMinus(),s.x),fe(i,s.y)),c=nr(i,i.oneMinus()),u=st(a.mul(a).div(fe(2,c).mul(Oe(1,c))),a.sub(fe(.5,c)).div(Oe(1,c)),Oe(1,Oe(1,a).mul(Oe(1,a)).div(fe(2,c).mul(Oe(1,c))))),d=a.lessThan(c.oneMinus()).select(a.lessThan(c).select(u.x,u.y),u.z);return Ro(d,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class G6 extends J5{static get type(){return"VertexColorNode"}constructor(t){super(null,"vec4"),this.isVertexColorNode=!0,this.index=t}getAttributeName(){const t=this.index;return"color"+(t>0?t:"")}generate(t){const e=this.getAttributeName(t),n=t.hasGeometryAttribute(e);let s;return n===!0?s=super.generate(t):s=t.generateConst(this.nodeType,new Ze(1,1,1,1)),s}serialize(t){super.serialize(t),t.index=this.index}deserialize(t){super.deserialize(t),this.index=t.index}}const wD=(r=0)=>new G6(r),k6=ot(([r,t])=>nr(1,r.oneMinus().div(t)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),H6=ot(([r,t])=>nr(r.div(t.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),W6=ot(([r,t])=>r.oneMinus().mul(t.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),q6=ot(([r,t])=>Be(r.mul(2).mul(t),r.oneMinus().mul(2).mul(t.oneMinus()).oneMinus(),Ad(.5,r))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),$6=ot(([r,t])=>{const e=t.a.add(r.a.mul(t.a.oneMinus()));return ie(t.rgb.mul(t.a).add(r.rgb.mul(r.a).mul(t.a.oneMinus())).div(e),e)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),TD=ot(([r])=>ie(r.rgb.mul(r.a),r.a),{color:"vec4",return:"vec4"}),X6=ot(([r])=>(re(r.a.equal(0),()=>ie(0)),ie(r.rgb.div(r.a),r.a)),{color:"vec4",return:"vec4"});class Xn extends Ar{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.maskShadowNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null}_getNodeChildren(){const t=[];for(const e of Object.getOwnPropertyNames(this)){if(e.startsWith("_")===!0)continue;const n=this[e];n&&n.isNode===!0&&t.push({property:e,childNode:n})}return t}customProgramCacheKey(){const t=[];for(const{property:e,childNode:n}of this._getNodeChildren())t.push(Dd(e.slice(0,-4)),n.getCacheKey());return this.type+Xp(t)}build(t){this.setup(t)}setupObserver(t){return new lP(t)}setup(t){t.context.setupNormal=()=>Pu(this.setupNormal(t),"NORMAL","vec3"),t.context.setupPositionView=()=>this.setupPositionView(t),t.context.setupModelViewProjection=()=>this.setupModelViewProjection(t);const e=t.renderer,n=e.getRenderTarget();e.contextNode.isContextNode===!0?t.context={...t.context,...e.contextNode.getFlowContextData()}:Ht('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),this.contextNode!==null&&(this.contextNode.isContextNode===!0?t.context={...t.context,...this.contextNode.getFlowContextData()}:Ht('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),t.addStack();const s=this.setupVertex(t),i=Pu(this.vertexNode||s,"VERTEX");t.context.clipSpace=i,t.stack.outputNode=i,this.setupHardwareClipping(t),this.geometryNode!==null&&(t.stack.outputNode=t.stack.outputNode.bypass(this.geometryNode)),t.addFlow("vertex",t.removeStack()),t.addStack();let a;const c=this.setupClipping(t);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(t):e.depth===!0&&this.setupDepth(t)),this.fragmentNode===null){this.setupDiffuseColor(t),this.setupVariants(t);const u=this.setupLighting(t);c!==null&&t.stack.addToStack(c);const d=ie(u,on.a).max(0);a=this.setupOutput(t,d),md.assign(a);const f=this.outputNode!==null;if(f&&(a=this.outputNode),t.context.getOutput&&(a=t.context.getOutput(a,t)),n!==null){const p=e.getMRT(),g=this.mrtNode;p!==null?(f&&md.assign(a),a=p,g!==null&&(a=p.merge(g))):g!==null&&(a=g)}}else{let u=this.fragmentNode;u.isOutputStructNode!==!0&&(u=ie(u)),a=this.setupOutput(t,u)}t.stack.outputNode=a,t.addFlow("fragment",t.removeStack()),t.observer=this.setupObserver(t)}setupClipping(t){if(t.clippingContext===null)return null;const{unionPlanes:e,intersectionPlanes:n}=t.clippingContext;let s=null;if(e.length>0||n.length>0){const i=t.renderer.currentSamples;this.alphaToCoverage&&i>1?s=P6():t.stack.addToStack(U6())}return s}setupHardwareClipping(t){if(this.hardwareClipping=!1,t.clippingContext===null)return;const e=t.clippingContext.unionPlanes.length;e>0&&e<=8&&t.isAvailable("clipDistance")&&(t.stack.addToStack(z6()),this.hardwareClipping=!0)}setupDepth(t){const{renderer:e,camera:n}=t;let s=this.depthNode;if(s===null){const i=e.getMRT();i&&i.has("depth")?s=i.get("depth"):e.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?s=YT(ds.z,fc,pc):s=yd(ds.z,fc,pc))}s!==null&&KT.assign(s).toStack()}setupPositionView(){return zc.mul(Wn).xyz}setupModelViewProjection(){return ul.mul(ds)}setupVertex(t){return t.addStack(),this.setupPosition(t),t.context.position=t.removeStack(),aD}setupPosition(t){const{object:e,geometry:n}=t;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&gD(e).toStack(),e.isSkinnedMesh===!0&&pD(e).toStack(),this.displacementMap){const s=tl("displacementMap","texture"),i=tl("displacementScale","float"),a=tl("displacementBias","float");Wn.addAssign(sr.normalize().mul(s.x.mul(i).add(a)))}return e.isBatchedMesh&&dD(e).toStack(),e.isInstancedMesh&&e.instanceMatrix&&e.instanceMatrix.isInstancedBufferAttribute===!0&&hD(e).toStack(),this.positionNode!==null&&Wn.assign(Pu(this.positionNode,"POSITION","vec3")),Wn}setupDiffuseColor(t){const{object:e,geometry:n}=t;this.maskNode!==null&&eo(this.maskNode).not().discard();let s=this.colorNode?ie(this.colorNode):D4;this.vertexColors===!0&&n.hasAttribute("color")&&(s=s.mul(wD())),e.instanceColor&&(s=Ip("vec3","vInstanceColor").mul(s)),e.isBatchedMesh&&e._colorsTexture&&(s=Ip("vec3","vBatchColor").mul(s)),on.assign(s);const i=this.opacityNode?G(this.opacityNode):HT;on.a.assign(on.a.mul(i));let a=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(a=this.alphaTestNode!==null?G(this.alphaTestNode):C4,this.alphaToCoverage===!0?(on.a=Eo(a,a.add(ST(on.a)),on.a),on.a.lessThanEqual(0).discard()):on.a.lessThanEqual(a).discard()),this.alphaHash===!0&&on.a.lessThan(V6(Wn)).discard(),t.isOpaque()&&on.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?st(0):on.rgb}setupNormal(){return this.normalNode?st(this.normalNode):z4}setupEnvironment(){let t=null;return this.envNode?t=this.envNode:this.envMap&&(t=this.envMap.isCubeTexture?tl("envMap","cubeTexture"):tl("envMap","texture")),t}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new R6(WT)),e}setupLights(t){const e=[],n=this.setupEnvironment(t);n&&n.isLightingNode&&e.push(n);const s=this.setupLightMap(t);s&&s.isLightingNode&&e.push(s);let i=this.aoNode;i===null&&t.material.aoMap&&(i=oD),t.context.getAO&&(i=t.context.getAO(i,t)),i&&e.push(new A6(i));let a=this.lightsNode||t.lightsNode;return e.length>0&&(a=t.renderer.lighting.createNode([...a.getLights(),...e])),a}setupLightingModel(){}setupLighting(t){const{material:e}=t,{backdropNode:n,backdropAlphaNode:s,emissiveNode:i}=this,c=this.lights===!0||this.lightsNode!==null?this.setupLights(t):null;let u=this.setupOutgoingLight(t);if(c&&c.getScope().hasLights){const d=this.setupLightingModel(t)||null;u=yD(c,d,n,s)}else n!==null&&(u=st(s!==null?Be(u,n,s):n));return(i&&i.isNode===!0||e.emissive&&e.emissive.isColor===!0)&&(X2.assign(st(i||L4)),u=u.add(X2)),u}setupFog(t,e){const n=t.fogNode;return n&&(md.assign(e),e=ie(n.toVar())),e}setupPremultipliedAlpha(t,e){return TD(e)}setupOutput(t,e){return this.fog===!0&&(e=this.setupFog(t,e)),this.premultipliedAlpha===!0&&(e=this.setupPremultipliedAlpha(t,e)),e}setDefaultValues(t){for(const n in t){const s=t[n];this[n]===void 0&&(this[n]=s,s&&s.clone&&(this[n]=s.clone()))}const e=Object.getOwnPropertyDescriptors(t.constructor.prototype);for(const n in e)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&e[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,e[n])}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{},nodes:{}});const n=Ar.prototype.toJSON.call(this,t);n.inputNodes={};for(const{property:i,childNode:a}of this._getNodeChildren())n.inputNodes[i]=a.toJSON(t).uuid;function s(i){const a=[];for(const c in i){const u=i[c];delete u.metadata,a.push(u)}return a}if(e){const i=s(t.textures),a=s(t.images),c=s(t.nodes);i.length>0&&(n.textures=i),a.length>0&&(n.images=a),c.length>0&&(n.nodes=c)}return n}copy(t){return this.lightsNode=t.lightsNode,this.envNode=t.envNode,this.aoNode=t.aoNode,this.colorNode=t.colorNode,this.normalNode=t.normalNode,this.opacityNode=t.opacityNode,this.backdropNode=t.backdropNode,this.backdropAlphaNode=t.backdropAlphaNode,this.alphaTestNode=t.alphaTestNode,this.maskNode=t.maskNode,this.maskShadowNode=t.maskShadowNode,this.positionNode=t.positionNode,this.geometryNode=t.geometryNode,this.depthNode=t.depthNode,this.receivedShadowPositionNode=t.receivedShadowPositionNode,this.castShadowPositionNode=t.castShadowPositionNode,this.receivedShadowNode=t.receivedShadowNode,this.castShadowNode=t.castShadowNode,this.outputNode=t.outputNode,this.mrtNode=t.mrtNode,this.fragmentNode=t.fragmentNode,this.vertexNode=t.vertexNode,this.contextNode=t.contextNode,super.copy(t)}}const j6=new oC;class Y6 extends Xn{static get type(){return"LineBasicNodeMaterial"}constructor(t){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(j6),this.setValues(t)}}const K6=new q8;class Z6 extends Xn{static get type(){return"LineDashedNodeMaterial"}constructor(t){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(K6),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(t)}setupVariants(){const t=this.offsetNode?G(this.offsetNode):sD,e=this.dashScaleNode?G(this.dashScaleNode):tD,n=this.dashSizeNode?G(this.dashSizeNode):eD,s=this.gapSizeNode?G(this.gapSizeNode):nD;Ig.assign(n),j2.assign(s);const i=Uc(dl("lineDistance").mul(e));(t?i.add(t):i).mod(Ig.add(j2)).greaterThan(Ig).discard()}}const Q6=new k8;class J6 extends Xn{static get type(){return"MeshNormalNodeMaterial"}constructor(t){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Q6),this.setValues(t)}setupDiffuseColor(){const t=this.opacityNode?G(this.opacityNode):HT;on.assign(Tx(ie(E4(Ve),t),bn))}}const ZT=ot(([r=PT])=>{const t=r.z.atan(r.x).mul(1/(Math.PI*2)).add(.5),e=r.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Vt(t,e)});class _D extends fl{constructor(t=1,e={}){super(t,t,e),this.isCubeRenderTarget=!0;const n={width:t,height:t,depth:1},s=[n,n,n,n,n,n];this.texture=new lx(s),this._setTextureOptions(e),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(t,e){const n=e.minFilter,s=e.generateMipmaps;e.generateMipmaps=!0,this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i=new X(5,5,5),a=ZT(PT),c=new Xn;c.colorNode=qe(e,a,0),c.side=Ss,c.blending=rl;const u=new C(i,c),d=new Bw;d.add(u),e.minFilter===sa&&(e.minFilter=$s);const f=new eP(1,10,this),p=t.getMRT();return t.setMRT(null),f.update(t,d),t.setMRT(p),e.minFilter=n,e.currentGenerateMipmaps=s,u.geometry.dispose(),u.material.dispose(),this}clear(t,e=!0,n=!0,s=!0){const i=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,n,s);t.setRenderTarget(i)}}const vp=new WeakMap;class tI extends rs{static get type(){return"CubeMapNode"}constructor(t){super("vec3"),this.envNode=t,this._cubeTexture=null,this._cubeTextureNode=Li(null);const e=new lx;e.isRenderTargetTexture=!0,this._defaultTexture=e,this.updateBeforeType=de.RENDER}updateBefore(t){const{renderer:e,material:n}=t,s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const i=s.isTextureNode?s.value:n[s.property];if(i&&i.isTexture){const a=i.mapping;if(a===Jy||a===Aw){if(vp.has(i)){const c=vp.get(i);pR(c,i.mapping),this._cubeTexture=c}else{const c=i.image;if(eI(c)){const u=new _D(c.height);u.fromEquirectangularTexture(e,i),pR(u.texture,i.mapping),this._cubeTexture=u.texture,vp.set(i,u.texture),i.addEventListener("dispose",MD)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(t){return this.updateBefore(t),this._cubeTextureNode}}function eI(r){return r==null?!1:r.height>0}function MD(r){const t=r.target;t.removeEventListener("dispose",MD);const e=vp.get(t);e!==void 0&&(vp.delete(t),e.dispose())}function pR(r,t){t===Jy?r.mapping=Sd:t===Aw&&(r.mapping=ey)}const vD=be(tI).setParameterLength(1);class QT extends Ld{static get type(){return"BasicEnvironmentNode"}constructor(t=null){super(),this.envNode=t}setup(t){t.context.environment=vD(this.envNode)}}class nI extends Ld{static get type(){return"BasicLightMapNode"}constructor(t=null){super(),this.lightMapNode=t}setup(t){const e=G(1/Math.PI);t.context.irradianceLightMap=this.lightMapNode.mul(e)}}class Cx{start(t){t.lightsNode.setupLights(t,t.lightsNode.getLightNodes(t)),this.indirect(t)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class AD extends Cx{constructor(){super()}indirect({context:t}){const e=t.ambientOcclusion,n=t.reflectedLight,s=t.irradianceLightMap;n.indirectDiffuse.assign(ie(0)),s?n.indirectDiffuse.addAssign(s):n.indirectDiffuse.addAssign(ie(1,1,1,0)),n.indirectDiffuse.mulAssign(e),n.indirectDiffuse.mulAssign(on.rgb)}finish(t){const{material:e,context:n}=t,s=n.outgoingLight,i=t.context.environment;if(i)switch(e.combine){case Qy:s.rgb.assign(Be(s.rgb,s.rgb.mul(i.rgb),Mp.mul(Hg)));break;case WF:s.rgb.assign(Be(s.rgb,i.rgb,Mp.mul(Hg)));break;case qF:s.rgb.addAssign(i.rgb.mul(Mp.mul(Hg)));break;default:Wt("BasicLightingModel: Unsupported .combine value:",e.combine);break}}}const sI=new xn;class Bc extends Xn{static get type(){return"MeshBasicNodeMaterial"}constructor(t){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(sI),this.setValues(t)}setupNormal(){return Bd(Rd)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new QT(e):null}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new nI(WT)),e}setupOutgoingLight(){return on.rgb}setupLightingModel(){return new AD}}const Cd=ot(({f0:r,f90:t,dotVH:e})=>{const n=e.mul(-5.55473).sub(6.98316).mul(e).exp2();return r.mul(n.oneMinus()).add(t.mul(n))}),ku=ot(r=>r.diffuseColor.mul(1/Math.PI)),iI=()=>G(.25),rI=ot(({dotNH:r})=>Py.mul(G(.5)).add(1).mul(G(1/Math.PI)).mul(r.pow(Py))),oI=ot(({lightDirection:r})=>{const t=r.add(yn).normalize(),e=Ve.dot(t).clamp(),n=yn.dot(t).clamp(),s=Cd({f0:Dc,f90:1,dotVH:n}),i=iI(),a=rI({dotNH:e});return s.mul(i).mul(a)});class ND extends AD{constructor(t=!0){super(),this.specular=t}direct({lightDirection:t,lightColor:e,reflectedLight:n}){const i=Ve.dot(t).clamp().mul(e);n.directDiffuse.addAssign(i.mul(ku({diffuseColor:on.rgb}))),this.specular===!0&&n.directSpecular.addAssign(i.mul(oI({lightDirection:t})).mul(Mp))}indirect(t){const{ambientOcclusion:e,irradiance:n,reflectedLight:s}=t.context;s.indirectDiffuse.addAssign(n.mul(ku({diffuseColor:on}))),s.indirectDiffuse.mulAssign(e)}}const aI=new H8;class lI extends Xn{static get type(){return"MeshLambertNodeMaterial"}constructor(t){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(aI),this.setValues(t)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new QT(e):null}setupLightingModel(){return new ND(!1)}}const cI=new V8;class uI extends Xn{static get type(){return"MeshPhongNodeMaterial"}constructor(t){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(cI),this.setValues(t)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new QT(e):null}setupLightingModel(){return new ND}setupVariants(){const t=(this.shininessNode?G(this.shininessNode):B4).max(1e-4);Py.assign(t);const e=this.specularNode||O4;Dc.assign(e)}copy(t){return this.shininessNode=t.shininessNode,this.specularNode=t.specularNode,super.copy(t)}}const RD=ot(r=>{if(r.geometry.hasAttribute("normal")===!1)return G(0);const t=Rd.dFdx().abs().max(Rd.dFdy().abs());return t.x.max(t.y).max(t.z)}),JT=ot(r=>{const{roughness:t}=r,e=RD();let n=t.max(.0525);return n=n.add(e),n=n.min(1),n}),ED=ot(({alpha:r,dotNL:t,dotNV:e})=>{const n=r.pow2(),s=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt()),i=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt());return Nr(.5,s.add(i).max(uT))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),hI=ot(({alphaT:r,alphaB:t,dotTV:e,dotBV:n,dotTL:s,dotBL:i,dotNV:a,dotNL:c})=>{const u=c.mul(st(r.mul(e),t.mul(n),a).length()),d=a.mul(st(r.mul(s),t.mul(i),c).length());return Nr(.5,u.add(d))}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),CD=ot(({alpha:r,dotNH:t})=>{const e=r.pow2(),n=t.pow2().mul(e.oneMinus()).oneMinus();return e.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),dI=G(1/Math.PI),fI=ot(({alphaT:r,alphaB:t,dotNH:e,dotTH:n,dotBH:s})=>{const i=r.mul(t),a=st(t.mul(n),r.mul(s),i.mul(e)),c=a.dot(a),u=i.div(c);return dI.mul(i.mul(u.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),t_=ot(({lightDirection:r,f0:t,f90:e,roughness:n,f:s,normalView:i=Ve,USE_IRIDESCENCE:a,USE_ANISOTROPY:c})=>{const u=n.pow2(),d=r.add(yn).normalize(),f=i.dot(r).clamp(),p=i.dot(yn).clamp(),g=i.dot(d).clamp(),y=yn.dot(d).clamp();let x=Cd({f0:t,f90:e,dotVH:y}),S,T;if(Pp(a)&&(x=yx.mix(x,s)),Pp(c)){const M=Tp.dot(r),N=Tp.dot(yn),v=Tp.dot(d),A=Uu.dot(r),R=Uu.dot(yn),L=Uu.dot(d);S=hI({alphaT:Uy,alphaB:u,dotTV:N,dotBV:R,dotTL:M,dotBL:A,dotNV:p,dotNL:f}),T=fI({alphaT:Uy,alphaB:u,dotNH:g,dotTH:v,dotBH:L})}else S=ED({alpha:u,dotNL:f,dotNV:p}),T=CD({alpha:u,dotNH:g});return x.mul(S).mul(T)}),pI=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Ho=null;const Vp=ot(({roughness:r,dotNV:t})=>{Ho===null&&(Ho=new ox(pI,16,16,Qo,ii),Ho.name="DFG_LUT",Ho.minFilter=$s,Ho.magFilter=$s,Ho.wrapS=Yi,Ho.wrapT=Yi,Ho.generateMipmaps=!1,Ho.needsUpdate=!0);const e=Vt(r,t);return qe(Ho,e).rg}),mI=ot(({lightDirection:r,f0:t,f90:e,roughness:n,f:s,USE_IRIDESCENCE:i,USE_ANISOTROPY:a})=>{const c=t_({lightDirection:r,f0:t,f90:e,roughness:n,f:s,USE_IRIDESCENCE:i,USE_ANISOTROPY:a}),u=Ve.dot(r).clamp(),d=Ve.dot(yn).clamp(),f=Vp({roughness:n,dotNV:d}),p=Vp({roughness:n,dotNV:u}),g=t.mul(f.x).add(e.mul(f.y)),y=t.mul(p.x).add(e.mul(p.y)),x=f.x.add(f.y),S=p.x.add(p.y),T=G(1).sub(x),M=G(1).sub(S),N=t.add(t.oneMinus().mul(.047619)),v=g.mul(y).mul(N).div(G(1).sub(T.mul(M).mul(N).mul(N)).add(uT)),A=T.mul(M),R=v.mul(A);return c.add(R)}),DD=ot(r=>{const{dotNV:t,specularColor:e,specularF90:n,roughness:s}=r,i=Vp({dotNV:t,roughness:s});return e.mul(i.x).add(n.mul(i.y))}),iw=ot(({f:r,f90:t,dotVH:e})=>{const n=e.oneMinus().saturate(),s=n.mul(n),i=n.mul(s,s).clamp(0,.9999);return r.sub(st(t).mul(i)).div(i.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),gI=ot(({roughness:r,dotNH:t})=>{const e=r.pow2(),n=G(1).div(e),i=t.pow2().oneMinus().max(.0078125);return G(2).add(n).mul(i.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),yI=ot(({dotNV:r,dotNL:t})=>G(1).div(G(4).mul(t.add(r).sub(t.mul(r))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),xI=ot(({lightDirection:r})=>{const t=r.add(yn).normalize(),e=Ve.dot(r).clamp(),n=Ve.dot(yn).clamp(),s=Ve.dot(t).clamp(),i=gI({roughness:dc,dotNH:s}),a=yI({dotNV:n,dotNL:e});return br.mul(i).mul(a)}),mR=ot(({N:r,V:t,roughness:e})=>{const i=.0078125,a=r.dot(t).saturate(),c=Vt(e,a.oneMinus().sqrt());return c.assign(c.mul(.984375).add(i)),c}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),bI=ot(({f:r})=>{const t=r.length();return $n(t.mul(t).add(r.z).div(t.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Km=ot(({v1:r,v2:t})=>{const e=r.dot(t),n=e.abs().toVar(),s=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),i=n.add(4.1616724).mul(n).add(3.417594).toVar(),a=s.div(i),c=e.greaterThan(0).select(a,$n(e.mul(e).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return r.cross(t).mul(c)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),VS=ot(({N:r,V:t,P:e,mInv:n,p0:s,p1:i,p2:a,p3:c})=>{const u=i.sub(s).toVar(),d=c.sub(s).toVar(),f=u.cross(d),p=st().toVar();return re(f.dot(e.sub(s)).greaterThanEqual(0),()=>{const g=t.sub(r.mul(t.dot(r))).normalize(),y=r.cross(g).negate(),x=n.mul(qs(g,y,r).transpose()).toVar(),S=x.mul(s.sub(e)).normalize().toVar(),T=x.mul(i.sub(e)).normalize().toVar(),M=x.mul(a.sub(e)).normalize().toVar(),N=x.mul(c.sub(e)).normalize().toVar(),v=st(0).toVar();v.addAssign(Km({v1:S,v2:T})),v.addAssign(Km({v1:T,v2:M})),v.addAssign(Km({v1:M,v2:N})),v.addAssign(Km({v1:N,v2:S})),p.assign(st(bI({f:v})))}),p}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Dx=1/6,BD=r=>fe(Dx,fe(r,fe(r,r.negate().add(3)).sub(3)).add(1)),rw=r=>fe(Dx,fe(r,fe(r,fe(3,r).sub(6))).add(4)),LD=r=>fe(Dx,fe(r,fe(r,fe(-3,r).add(3)).add(3)).add(1)),ow=r=>fe(Dx,jr(r,3)),gR=r=>BD(r).add(rw(r)),yR=r=>LD(r).add(ow(r)),xR=r=>ws(-1,rw(r).div(BD(r).add(rw(r)))),bR=r=>ws(1,ow(r).div(LD(r).add(ow(r)))),SR=(r,t,e)=>{const n=r.uvNode,s=fe(n,t.zw).add(.5),i=oa(s),a=No(s),c=gR(a.x),u=yR(a.x),d=xR(a.x),f=bR(a.x),p=xR(a.y),g=bR(a.y),y=Vt(i.x.add(d),i.y.add(p)).sub(.5).mul(t.xy),x=Vt(i.x.add(f),i.y.add(p)).sub(.5).mul(t.xy),S=Vt(i.x.add(d),i.y.add(g)).sub(.5).mul(t.xy),T=Vt(i.x.add(f),i.y.add(g)).sub(.5).mul(t.xy),M=gR(a.y).mul(ws(c.mul(r.sample(y).level(e)),u.mul(r.sample(x).level(e)))),N=yR(a.y).mul(ws(c.mul(r.sample(S).level(e)),u.mul(r.sample(T).level(e))));return M.add(N)},e_=ot(([r,t])=>{const e=Vt(r.size(Q(t))),n=Vt(r.size(Q(t.add(1)))),s=Nr(1,e),i=Nr(1,n),a=SR(r,ie(s,e),oa(t)),c=SR(r,ie(i,n),Sx(t));return No(t).mix(a,c)}),SI=ot(([r,t])=>{const e=t.mul(BT(r));return e_(r,e)}),wR=ot(([r,t,e,n,s])=>{const i=st(MT(t.negate(),Ji(r),Nr(1,n))),a=st(aa(s[0].xyz),aa(s[1].xyz),aa(s[2].xyz));return Ji(i).mul(e.mul(a))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),wI=ot(([r,t])=>r.mul(Ro(t.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),TI=qT(),_I=xD(),TR=ot(([r,t,e],{material:n})=>{const i=(n.side===Ss?TI:_I).sample(r),a=ra(Gu.x).mul(wI(t,e));return e_(i,a)}),_R=ot(([r,t,e])=>(re(e.notEqual(0),()=>{const n=bx(t).negate().div(e);return hT(n.negate().mul(r))}),st(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),MI=ot(([r,t,e,n,s,i,a,c,u,d,f,p,g,y,x])=>{let S,T;if(x){S=ie().toVar(),T=st().toVar();const R=f.sub(1).mul(x.mul(.025)),L=st(f.sub(R),f,f.add(R));cn({start:0,end:3},({i:D})=>{const U=L.element(D),B=wR(r,t,p,U,c),P=a.add(B),J=d.mul(u.mul(ie(P,1))),q=Vt(J.xy.div(J.w)).toVar();q.addAssign(1),q.divAssign(2),q.assign(Vt(q.x,q.y.oneMinus()));const ft=TR(q,e,U);S.element(D).assign(ft.element(D)),S.a.addAssign(ft.a),T.element(D).assign(n.element(D).mul(_R(aa(B),g,y).element(D)))}),S.a.divAssign(3)}else{const R=wR(r,t,p,f,c),L=a.add(R),D=d.mul(u.mul(ie(L,1))),U=Vt(D.xy.div(D.w)).toVar();U.addAssign(1),U.divAssign(2),U.assign(Vt(U.x,U.y.oneMinus())),S=TR(U,e,f),T=n.mul(_R(aa(R),g,y))}const M=T.rgb.mul(S.rgb),N=r.dot(t).clamp(),v=st(DD({dotNV:N,specularColor:s,specularF90:i,roughness:e})),A=T.r.add(T.g,T.b).div(3);return ie(v.oneMinus().mul(M),S.a.oneMinus().mul(A).oneMinus())}),vI=qs(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),AI=r=>{const t=r.sqrt();return st(1).add(t).div(st(1).sub(t))},MR=(r,t)=>r.sub(t).div(r.add(t)).pow2(),NI=(r,t)=>{const e=r.mul(2*Math.PI*1e-9),n=st(54856e-17,44201e-17,52481e-17),s=st(1681e3,1795300,2208400),i=st(43278e5,93046e5,66121e5),a=G(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(e.mul(2239900).add(t.x).cos()).mul(e.pow2().mul(-45282e5).exp());let c=n.mul(i.mul(2*Math.PI).sqrt()).mul(s.mul(e).add(t).cos()).mul(e.pow2().negate().mul(i).exp());return c=st(c.x.add(a),c.y,c.z).div(10685e-11),vI.mul(c)},vR=ot(({outsideIOR:r,eta2:t,cosTheta1:e,thinFilmThickness:n,baseF0:s})=>{const i=Be(r,t,Eo(0,.03,n)),c=r.div(i).pow2().mul(e.pow2().oneMinus()).oneMinus();re(c.lessThan(0),()=>st(1));const u=c.sqrt(),d=MR(i,r),f=Cd({f0:d,f90:1,dotVH:e}),p=f.oneMinus(),g=i.lessThan(r).select(Math.PI,0),y=G(Math.PI).sub(g),x=AI(s.clamp(0,.9999)),S=MR(x,i.toVec3()),T=Cd({f0:S,f90:1,dotVH:u}),M=st(x.x.lessThan(i).select(Math.PI,0),x.y.lessThan(i).select(Math.PI,0),x.z.lessThan(i).select(Math.PI,0)),N=i.mul(n,u,2),v=st(y).add(M),A=f.mul(T).clamp(1e-5,.9999),R=A.sqrt(),L=p.pow2().mul(T).div(st(1).sub(A)),U=f.add(L).toVar(),B=L.sub(p).toVar();return cn({start:1,end:2,condition:"<=",name:"m"},({m:P})=>{B.mulAssign(R);const J=NI(G(P).mul(N),G(P).mul(v)).mul(2);U.addAssign(B.mul(J))}),U.max(st(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),Uf=ot(({normal:r,viewDir:t,roughness:e})=>{const n=r.dot(t).saturate(),s=e.mul(e),i=e.add(.1).reciprocal(),a=G(-1.9362).add(e.mul(1.0678)).add(s.mul(.4573)).sub(i.mul(.8469)),c=G(-.6014).add(e.mul(.5538)).sub(s.mul(.467)).sub(i.mul(.1255));return a.mul(n).add(c).exp().saturate()}),Pf=st(.04),Zm=G(1);class OD extends Cx{constructor(t=!1,e=!1,n=!1,s=!1,i=!1,a=!1){super(),this.clearcoat=t,this.sheen=e,this.iridescence=n,this.anisotropy=s,this.transmission=i,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null,this.iridescenceF0Dielectric=null,this.iridescenceF0Metallic=null}start(t){if(this.clearcoat===!0&&(this.clearcoatRadiance=st().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=st().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=st().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=st().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=st().toVar("sheenSpecularIndirect")),this.iridescence===!0){const e=Ve.dot(yn).clamp(),n=vR({outsideIOR:G(1),eta2:Oy,cosTheta1:e,thinFilmThickness:Fy,baseF0:Dc}),s=vR({outsideIOR:G(1),eta2:Oy,cosTheta1:e,thinFilmThickness:Fy,baseF0:on.rgb});this.iridescenceFresnel=Be(n,s,il),this.iridescenceF0Dielectric=iw({f:n,f90:1,dotVH:e}),this.iridescenceF0Metallic=iw({f:s,f90:1,dotVH:e}),this.iridescenceF0=Be(this.iridescenceF0Dielectric,this.iridescenceF0Metallic,il)}if(this.transmission===!0){const e=ca,n=i4.sub(ca).normalize(),s=Ic,i=t.context;i.backdrop=MI(s,n,Zo,Au,Cu,Du,e,Yr,ro,ul,_p,iT,oT,rT,this.dispersion?aT:null),i.backdropAlpha=zy,on.a.mulAssign(Be(1,i.backdrop.a,zy))}super.start(t)}computeMultiscattering(t,e,n,s,i=null){const a=Ve.dot(yn).clamp(),c=Vp({roughness:Zo,dotNV:a}),u=i?yx.mix(s,i):s,d=u.mul(c.x).add(n.mul(c.y)),p=c.x.add(c.y).oneMinus(),g=u.add(u.oneMinus().mul(.047619)),y=d.mul(g).div(p.mul(g).oneMinus());t.addAssign(d),e.addAssign(y.mul(p))}direct({lightDirection:t,lightColor:e,reflectedLight:n}){const i=Ve.dot(t).clamp().mul(e).toVar();if(this.sheen===!0){this.sheenSpecularDirect.addAssign(i.mul(xI({lightDirection:t})));const a=Uf({normal:Ve,viewDir:yn,roughness:dc}),c=Uf({normal:Ve,viewDir:t,roughness:dc}),u=br.r.max(br.g).max(br.b).mul(a.max(c)).oneMinus();i.mulAssign(u)}if(this.clearcoat===!0){const c=mc.dot(t).clamp().mul(e);this.clearcoatSpecularDirect.addAssign(c.mul(t_({lightDirection:t,f0:Pf,f90:Zm,roughness:pd,normalView:mc})))}n.directDiffuse.addAssign(i.mul(ku({diffuseColor:Au}))),n.directSpecular.addAssign(i.mul(mI({lightDirection:t,f0:Cu,f90:1,roughness:Zo,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:t,lightPosition:e,halfWidth:n,halfHeight:s,reflectedLight:i,ltc_1:a,ltc_2:c}){const u=e.add(n).sub(s),d=e.sub(n).sub(s),f=e.sub(n).add(s),p=e.add(n).add(s),g=Ve,y=yn,x=ds.toVar(),S=mR({N:g,V:y,roughness:Zo}),T=a.sample(S).toVar(),M=c.sample(S).toVar(),N=qs(st(T.x,0,T.y),st(0,1,0),st(T.z,0,T.w)).toVar(),v=Cu.mul(M.x).add(Du.sub(Cu).mul(M.y)).toVar();if(i.directSpecular.addAssign(t.mul(v).mul(VS({N:g,V:y,P:x,mInv:N,p0:u,p1:d,p2:f,p3:p}))),i.directDiffuse.addAssign(t.mul(Au).mul(VS({N:g,V:y,P:x,mInv:qs(1,0,0,0,1,0,0,0,1),p0:u,p1:d,p2:f,p3:p}))),this.clearcoat===!0){const A=mc,R=mR({N:A,V:y,roughness:pd}),L=a.sample(R),D=c.sample(R),U=qs(st(L.x,0,L.y),st(0,1,0),st(L.z,0,L.w)),B=Pf.mul(D.x).add(Zm.sub(Pf).mul(D.y));this.clearcoatSpecularDirect.addAssign(t.mul(B).mul(VS({N:A,V:y,P:x,mInv:U,p0:u,p1:d,p2:f,p3:p})))}}indirect(t){this.indirectDiffuse(t),this.indirectSpecular(t),this.ambientOcclusion(t)}indirectDiffuse(t){const{irradiance:e,reflectedLight:n}=t.context,s=e.mul(ku({diffuseColor:Au})).toVar();if(this.sheen===!0){const i=Uf({normal:Ve,viewDir:yn,roughness:dc}),a=br.r.max(br.g).max(br.b).mul(i).oneMinus();s.mulAssign(a)}n.indirectDiffuse.addAssign(s)}indirectSpecular(t){const{radiance:e,iblIrradiance:n,reflectedLight:s}=t.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(br,Uf({normal:Ve,viewDir:yn,roughness:dc}))),this.clearcoat===!0){const T=mc.dot(yn).clamp(),M=DD({dotNV:T,specularColor:Pf,specularF90:Zm,roughness:pd});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(M))}const i=st().toVar("singleScatteringDielectric"),a=st().toVar("multiScatteringDielectric"),c=st().toVar("singleScatteringMetallic"),u=st().toVar("multiScatteringMetallic");this.computeMultiscattering(i,a,Du,Dc,this.iridescenceF0Dielectric),this.computeMultiscattering(c,u,Du,on.rgb,this.iridescenceF0Metallic);const d=Be(i,c,il),f=Be(a,u,il),p=i.add(a),g=Au.mul(p.oneMinus()),y=n.mul(1/Math.PI),x=e.mul(d).add(f.mul(y)).toVar(),S=g.mul(y).toVar();if(this.sheen===!0){const T=Uf({normal:Ve,viewDir:yn,roughness:dc}),M=br.r.max(br.g).max(br.b).mul(T).oneMinus();x.mulAssign(M),S.mulAssign(M)}s.indirectSpecular.addAssign(x),s.indirectDiffuse.addAssign(S)}ambientOcclusion(t){const{ambientOcclusion:e,reflectedLight:n}=t.context,i=Ve.dot(yn).clamp().add(e),a=Zo.mul(-16).oneMinus().negate().exp2(),c=e.sub(i.pow(a).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),n.indirectDiffuse.mulAssign(e),n.indirectSpecular.mulAssign(c)}finish({context:t}){const{outgoingLight:e}=t;if(this.clearcoat===!0){const n=mc.dot(yn).clamp(),s=Cd({dotVH:n,f0:Pf,f90:Zm}),i=e.mul(Ly.mul(s).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Ly));e.assign(i)}if(this.sheen===!0){const n=e.add(this.sheenSpecularDirect,this.sheenSpecularIndirect.mul(1/Math.PI));e.assign(n)}}}const AR=G(1),aw=G(-2),Qm=G(.8),GS=G(-1),Jm=G(.4),kS=G(2),tg=G(.305),HS=G(3),NR=G(.21),RI=G(4),RR=G(4),EI=G(16),CI=ot(([r])=>{const t=st(Mn(r)).toVar(),e=G(-1).toVar();return re(t.x.greaterThan(t.z),()=>{re(t.x.greaterThan(t.y),()=>{e.assign(bi(r.x.greaterThan(0),0,3))}).Else(()=>{e.assign(bi(r.y.greaterThan(0),1,4))})}).Else(()=>{re(t.z.greaterThan(t.y),()=>{e.assign(bi(r.z.greaterThan(0),2,5))}).Else(()=>{e.assign(bi(r.y.greaterThan(0),1,4))})}),e}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),DI=ot(([r,t])=>{const e=Vt().toVar();return re(t.equal(0),()=>{e.assign(Vt(r.z,r.y).div(Mn(r.x)))}).ElseIf(t.equal(1),()=>{e.assign(Vt(r.x.negate(),r.z.negate()).div(Mn(r.y)))}).ElseIf(t.equal(2),()=>{e.assign(Vt(r.x.negate(),r.y).div(Mn(r.z)))}).ElseIf(t.equal(3),()=>{e.assign(Vt(r.z.negate(),r.y).div(Mn(r.x)))}).ElseIf(t.equal(4),()=>{e.assign(Vt(r.x.negate(),r.z).div(Mn(r.y)))}).Else(()=>{e.assign(Vt(r.x,r.y).div(Mn(r.z)))}),fe(.5,e.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),BI=ot(([r])=>{const t=G(0).toVar();return re(r.greaterThanEqual(Qm),()=>{t.assign(AR.sub(r).mul(GS.sub(aw)).div(AR.sub(Qm)).add(aw))}).ElseIf(r.greaterThanEqual(Jm),()=>{t.assign(Qm.sub(r).mul(kS.sub(GS)).div(Qm.sub(Jm)).add(GS))}).ElseIf(r.greaterThanEqual(tg),()=>{t.assign(Jm.sub(r).mul(HS.sub(kS)).div(Jm.sub(tg)).add(kS))}).ElseIf(r.greaterThanEqual(NR),()=>{t.assign(tg.sub(r).mul(RI.sub(HS)).div(tg.sub(NR)).add(HS))}).Else(()=>{t.assign(G(-2).mul(ra(fe(1.16,r))))}),t}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),FD=ot(([r,t])=>{const e=r.toVar();e.assign(fe(2,e).sub(1));const n=st(e,1).toVar();return re(t.equal(0),()=>{n.assign(n.zyx)}).ElseIf(t.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(t.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(t.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(t.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(t.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),UD=ot(([r,t,e,n,s,i])=>{const a=G(e),c=st(t),u=Ro(BI(a),aw,i),d=No(u),f=oa(u),p=st(Gp(r,c,f,n,s,i)).toVar();return re(d.notEqual(0),()=>{const g=st(Gp(r,c,f.add(1),n,s,i)).toVar();p.assign(Be(p,g,d))}),p}),Gp=ot(([r,t,e,n,s,i])=>{const a=G(e).toVar(),c=st(t),u=G(CI(c)).toVar(),d=G($n(RR.sub(a),0)).toVar();a.assign($n(a,RR));const f=G(vd(a)).toVar(),p=Vt(DI(c,u).mul(f.sub(2)).add(1)).toVar();return re(u.greaterThan(2),()=>{p.y.addAssign(f),u.subAssign(3)}),p.x.addAssign(u.mul(f)),p.x.addAssign(d.mul(fe(3,EI))),p.y.addAssign(fe(4,vd(i).sub(f))),p.x.mulAssign(n),p.y.mulAssign(s),r.sample(p).grad(Vt(),Vt())}),WS=ot(({envMap:r,mipInt:t,outputDirection:e,theta:n,axis:s,CUBEUV_TEXEL_WIDTH:i,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:c})=>{const u=wo(n),d=e.mul(u).add(s.cross(e).mul(Ci(n))).add(s.mul(s.dot(e).mul(u.oneMinus())));return Gp(r,d,t,i,a,c)}),PD=ot(({n:r,latitudinal:t,poleAxis:e,outputDirection:n,weights:s,samples:i,dTheta:a,mipInt:c,envMap:u,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p})=>{const g=st(bi(t,e,hl(e,n))).toVar();re(g.equal(st(0)),()=>{g.assign(st(n.z,0,n.x.negate()))}),g.assign(Ji(g));const y=st().toVar();return y.addAssign(s.element(0).mul(WS({theta:0,axis:g,outputDirection:n,mipInt:c,envMap:u,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p}))),cn({start:Q(1),end:r},({i:x})=>{re(x.greaterThanEqual(i),()=>{mD()});const S=G(a.mul(G(x))).toVar();y.addAssign(s.element(x).mul(WS({theta:S.mul(-1),axis:g,outputDirection:n,mipInt:c,envMap:u,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p}))),y.addAssign(s.element(x).mul(WS({theta:S,axis:g,outputDirection:n,mipInt:c,envMap:u,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p})))}),ie(y,1)}),LI=ot(([r])=>{const t=zt(r).toVar();return t.assign(t.shiftLeft(zt(16)).bitOr(t.shiftRight(zt(16)))),t.assign(t.bitAnd(zt(1431655765)).shiftLeft(zt(1)).bitOr(t.bitAnd(zt(2863311530)).shiftRight(zt(1)))),t.assign(t.bitAnd(zt(858993459)).shiftLeft(zt(2)).bitOr(t.bitAnd(zt(3435973836)).shiftRight(zt(2)))),t.assign(t.bitAnd(zt(252645135)).shiftLeft(zt(4)).bitOr(t.bitAnd(zt(4042322160)).shiftRight(zt(4)))),t.assign(t.bitAnd(zt(16711935)).shiftLeft(zt(8)).bitOr(t.bitAnd(zt(4278255360)).shiftRight(zt(8)))),G(t).mul(23283064365386963e-26)}),OI=ot(([r,t])=>Vt(G(r).div(G(t)),LI(r))),FI=ot(([r,t,e])=>{const n=e.mul(e).toConst(),s=st(1,0,0).toConst(),i=hl(t,s).toConst(),a=Oi(r.x).toConst(),c=fe(2,3.14159265359).mul(r.y).toConst(),u=a.mul(wo(c)).toConst(),d=a.mul(Ci(c)).toVar(),f=fe(.5,t.z.add(1)).toConst();d.assign(f.oneMinus().mul(Oi(u.mul(u).oneMinus())).add(f.mul(d)));const p=s.mul(u).add(i.mul(d)).add(t.mul(Oi($n(0,u.mul(u).add(d.mul(d)).oneMinus()))));return Ji(st(n.mul(p.x),n.mul(p.y),$n(0,p.z)))}),zD=ot(({roughness:r,mipInt:t,envMap:e,N_immutable:n,GGX_SAMPLES:s,CUBEUV_TEXEL_WIDTH:i,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:c})=>{const u=st(n).toVar(),d=st(0).toVar(),f=G(0).toVar();return re(r.lessThan(.001),()=>{d.assign(Gp(e,u,t,i,a,c))}).Else(()=>{const p=bi(Mn(u.z).lessThan(.999),st(0,0,1),st(1,0,0)),g=Ji(hl(p,u)).toVar(),y=hl(u,g).toVar();cn({start:zt(0),end:s},({i:x})=>{const S=OI(x,s),T=FI(S,st(0,0,1),r),M=Ji(g.mul(T.x).add(y.mul(T.y)).add(u.mul(T.z))),N=Ji(M.mul(no(u,M).mul(2)).sub(u)),v=$n(no(u,N),0);re(v.greaterThan(0),()=>{const A=Gp(e,N,t,i,a,c);d.addAssign(A.mul(v)),f.addAssign(v)})}),re(f.greaterThan(0),()=>{d.assign(d.div(f))})}),ie(d,1)}),bc=4,ER=[.125,.215,.35,.446,.526,.582],Nu=20,UI=512,zf=new qw(-1,1,1,-1,0,1),PI=new Xi(90,1),CR=new Xt;let qS=null,$S=0,XS=0;const zI=new V,ky=new WeakMap,II=[3,1,5,0,4,2],jS=FD(fn(),dl("faceIndex")).normalize(),Bx=st(jS.x,jS.y,jS.z);class VI{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(t,e=0,n=.1,s=100,i={}){const{size:a=256,position:c=zI,renderTarget:u=null}=i;if(this._setSize(a),this._hasInitialized===!1){Wt('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const f=u||this._allocateTarget();return i.renderTarget=f,this.fromSceneAsync(t,e,n,s,i),f}qS=this._renderer.getRenderTarget(),$S=this._renderer.getActiveCubeFace(),XS=this._renderer.getActiveMipmapLevel();const d=u||this._allocateTarget();return d.depthBuffer=!0,this._init(d),this._sceneToCubeUV(t,n,s,d,c),e>0&&this._blur(d,0,0,e),this._applyPMREM(d),this._cleanup(d),d}async fromSceneAsync(t,e=0,n=.1,s=100,i={}){return an('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(t,e,n,s,i)}fromEquirectangular(t,e=null){if(this._hasInitialized===!1){Wt('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(t);const n=e||this._allocateTarget();return this.fromEquirectangularAsync(t,n),n}return this._fromTexture(t,e)}async fromEquirectangularAsync(t,e=null){return an('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(t,e)}fromCubemap(t,e=null){if(this._hasInitialized===!1){Wt("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(t);const n=e||this._allocateTarget();return this.fromCubemapAsync(t,e),n}return this._fromTexture(t,e)}async fromCubemapAsync(t,e=null){return an('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(t,e)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=BR(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=LR(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(t){t.mapping===Sd||t.mapping===ey?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4)}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodMeshes.length;t++)this._lodMeshes[t].geometry.dispose()}_cleanup(t){this._renderer.setRenderTarget(qS,$S,XS),t.scissorTest=!1,Wh(t,0,0,t.width,t.height)}_fromTexture(t,e){this._setSizeFromTexture(t),qS=this._renderer.getRenderTarget(),$S=this._renderer.getActiveCubeFace(),XS=this._renderer.getActiveMipmapLevel();const n=e||this._allocateTarget();return this._init(n),this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize;return DR(t,e)}_init(t){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t.width||this._pingPongRenderTarget.height!==t.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=DR(t.width,t.height);const{_lodMax:e}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=GI(e)),this._blurMaterial=kI(e,t.width,t.height),this._ggxMaterial=HI(e,t.width,t.height)}}async _compileMaterial(t){const e=new C(new Qe,t);await this._renderer.compile(e,zf)}_sceneToCubeUV(t,e,n,s,i){const a=PI;a.near=e,a.far=n;const c=[1,1,1,1,-1,1],u=[1,-1,1,-1,1,-1],d=this._renderer,f=d.autoClear;d.getClearColor(CR),d.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new C(new X,new xn({name:"PMREM.Background",side:Ss,depthWrite:!1,depthTest:!1})));const p=this._backgroundBox,g=p.material;let y=!1;const x=t.background;x?x.isColor&&(g.color.copy(x),t.background=null,y=!0):(g.color.copy(CR),y=!0),d.setRenderTarget(s),d.clear(),y&&d.render(p,a);for(let S=0;S<6;S++){const T=S%3;T===0?(a.up.set(0,c[S],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x+u[S],i.y,i.z)):T===1?(a.up.set(0,0,c[S]),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y+u[S],i.z)):(a.up.set(0,c[S],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y,i.z+u[S]));const M=this._cubeSize;Wh(s,T*M,S>2?M:0,M,M),d.render(t,a)}d.autoClear=f,t.background=x}_textureToCubeUV(t,e){const n=this._renderer,s=t.mapping===Sd||t.mapping===ey;s?this._cubemapMaterial===null&&(this._cubemapMaterial=BR(t)):this._equirectMaterial===null&&(this._equirectMaterial=LR(t));const i=s?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=t;const a=this._lodMeshes[0];a.material=i;const c=this._cubeSize;Wh(e,0,0,3*c,2*c),n.setRenderTarget(e),n.render(a,zf)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;const s=this._lodMeshes.length;for(let i=1;i<s;i++)this._applyGGXFilter(t,i-1,i);e.autoClear=n}_applyGGXFilter(t,e,n){const s=this._renderer,i=this._pingPongRenderTarget,a=this._ggxMaterial,c=this._lodMeshes[n];c.material=a;const u=ky.get(a),d=n/(this._lodMeshes.length-1),f=e/(this._lodMeshes.length-1),p=Math.sqrt(d*d-f*f),g=0+d*1.25,y=p*g,{_lodMax:x}=this,S=this._sizeLods[n],T=3*S*(n>x-bc?n-x+bc:0),M=4*(this._cubeSize-S);t.texture.frame=(t.texture.frame||0)+1,u.envMap.value=t.texture,u.roughness.value=y,u.mipInt.value=x-e,Wh(i,T,M,3*S,2*S),s.setRenderTarget(i),s.render(c,zf),i.texture.frame=(i.texture.frame||0)+1,u.envMap.value=i.texture,u.roughness.value=0,u.mipInt.value=x-n,Wh(t,T,M,3*S,2*S),s.setRenderTarget(t),s.render(c,zf)}_blur(t,e,n,s,i){const a=this._pingPongRenderTarget;this._halfBlur(t,a,e,n,s,"latitudinal",i),this._halfBlur(a,t,n,n,s,"longitudinal",i)}_halfBlur(t,e,n,s,i,a,c){const u=this._renderer,d=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&Ht("blur direction must be either latitudinal or longitudinal!");const f=3,p=this._lodMeshes[s];p.material=d;const g=ky.get(d),y=this._sizeLods[n]-1,x=isFinite(i)?Math.PI/(2*y):2*Math.PI/(2*Nu-1),S=i/x,T=isFinite(i)?1+Math.floor(f*S):Nu;T>Nu&&Wt(`sigmaRadians, ${i}, is too large and will clip, as it requested ${T} samples when the maximum is set to ${Nu}`);const M=[];let N=0;for(let D=0;D<Nu;++D){const U=D/S,B=Math.exp(-U*U/2);M.push(B),D===0?N+=B:D<T&&(N+=2*B)}for(let D=0;D<M.length;D++)M[D]=M[D]/N;t.texture.frame=(t.texture.frame||0)+1,g.envMap.value=t.texture,g.samples.value=T,g.weights.array=M,g.latitudinal.value=a==="latitudinal"?1:0,c&&(g.poleAxis.value=c);const{_lodMax:v}=this;g.dTheta.value=x,g.mipInt.value=v-n;const A=this._sizeLods[s],R=3*A*(s>v-bc?s-v+bc:0),L=4*(this._cubeSize-A);Wh(e,R,L,3*A,2*A),u.setRenderTarget(e),u.render(p,zf)}}function GI(r){const t=[],e=[],n=[];let s=r;const i=r-bc+1+ER.length;for(let a=0;a<i;a++){const c=Math.pow(2,s);t.push(c);let u=1/c;a>r-bc?u=ER[a-r+bc-1]:a===0&&(u=0),e.push(u);const d=1/(c-2),f=-d,p=1+d,g=[f,f,p,f,p,p,f,f,p,p,f,p],y=6,x=6,S=3,T=2,M=1,N=new Float32Array(S*x*y),v=new Float32Array(T*x*y),A=new Float32Array(M*x*y);for(let L=0;L<y;L++){const D=L%3*2/3-1,U=L>2?0:-1,B=[D,U,0,D+2/3,U,0,D+2/3,U+1,0,D,U,0,D+2/3,U+1,0,D,U+1,0],P=II[L];N.set(B,S*x*P),v.set(g,T*x*P);const J=[P,P,P,P,P,P];A.set(J,M*x*P)}const R=new Qe;R.setAttribute("position",new fs(N,S)),R.setAttribute("uv",new fs(v,T)),R.setAttribute("faceIndex",new fs(A,M)),n.push(new C(R,null)),s>bc&&s--}return{lodMeshes:n,sizeLods:t,sigmas:e}}function DR(r,t){const e={magFilter:$s,minFilter:$s,generateMipmaps:!1,type:ii,format:Ki,colorSpace:Ay},n=new fl(r,t,e);return n.texture.mapping=D2,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function Wh(r,t,e,n,s){r.viewport.set(t,e,n,s),r.scissor.set(t,e,n,s)}function Lx(r){const t=new Xn;return t.depthTest=!1,t.depthWrite=!1,t.blending=rl,t.name=`PMREM_${r}`,t}function kI(r,t,e){const n=yi(new Array(Nu).fill(0)),s=te(new V(0,1,0)),i=te(0),a=G(Nu),c=te(0),u=te(1),d=qe(),f=te(0),p=G(1/t),g=G(1/e),y=G(r),x={n:a,latitudinal:c,weights:n,poleAxis:s,outputDirection:Bx,dTheta:i,samples:u,envMap:d,mipInt:f,CUBEUV_TEXEL_WIDTH:p,CUBEUV_TEXEL_HEIGHT:g,CUBEUV_MAX_MIP:y},S=Lx("blur");return S.fragmentNode=PD({...x,latitudinal:c.equal(1)}),ky.set(S,x),S}function HI(r,t,e){const n=qe(),s=te(0),i=te(0),a=G(1/t),c=G(1/e),u=G(r),d={envMap:n,roughness:s,mipInt:i,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:u},f=Lx("ggx");return f.fragmentNode=zD({...d,N_immutable:Bx,GGX_SAMPLES:zt(UI)}),ky.set(f,d),f}function BR(r){const t=Lx("cubemap");return t.fragmentNode=Li(r,Bx),t}function LR(r){const t=Lx("equirect");return t.fragmentNode=qe(r,ZT(Bx),0),t}const OR=new WeakMap;function WI(r){const t=Math.log2(r)-2,e=1/r;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:e,maxMip:t}}function qI(r,t,e){const n=$I(t);let s=n.get(r);if((s!==void 0?s.pmremVersion:-1)!==r.pmremVersion){const a=r.image;if(r.isCubeTexture)if(jI(a))s=e.fromCubemap(r,s);else return null;else if(YI(a))s=e.fromEquirectangular(r,s);else return null;s.pmremVersion=r.pmremVersion,n.set(r,s)}return s.texture}function $I(r){let t=OR.get(r);return t===void 0&&(t=new WeakMap,OR.set(r,t)),t}class XI extends rs{static get type(){return"PMREMNode"}constructor(t,e=null,n=null){super("vec3"),this._value=t,this._pmrem=null,this.uvNode=e,this.levelNode=n,this._generator=null;const s=new is;s.isRenderTargetTexture=!0,this._texture=qe(s),this._width=te(0),this._height=te(0),this._maxMip=te(0),this.updateBeforeType=de.RENDER}set value(t){this._value=t,this._pmrem=null}get value(){return this._value}updateFromTexture(t){const e=WI(t.image.height);this._texture.value=t,this._width.value=e.texelWidth,this._height.value=e.texelHeight,this._maxMip.value=e.maxMip}updateBefore(t){let e=this._pmrem;const n=e?e.pmremVersion:-1,s=this._value;n!==s.pmremVersion&&(s.isPMREMTexture===!0?e=s:e=qI(s,t.renderer,this._generator),e!==null&&(this._pmrem=e,this.updateFromTexture(e)))}setup(t){this._generator===null&&(this._generator=new VI(t.renderer)),this.updateBefore(t);let e=this.uvNode;e===null&&t.context.getUV&&(e=t.context.getUV(this,t)),e=VT.mul(st(e.x,e.y.negate(),e.z));let n=this.levelNode;return n===null&&t.context.getTextureLevel&&(n=t.context.getTextureLevel(this)),UD(this._texture,e,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function jI(r){if(r==null)return!1;let t=0;const e=6;for(let n=0;n<e;n++)r[n]!==void 0&&t++;return t===e}function YI(r){return r==null?!1:r.height>0}const n_=be(XI).setParameterLength(1,3),FR=new WeakMap;class KI extends Ld{static get type(){return"EnvironmentNode"}constructor(t=null){super(),this.envNode=t}setup(t){const{material:e}=t;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const p=n.isTextureNode?n.value:e[n.property],g=this._getPMREMNodeCache(t.renderer);let y=g.get(p);y===void 0&&(y=n_(p),g.set(p,y)),n=y}const i=e.useAnisotropy===!0||e.anisotropy>0?R4:Ve,a=n.context(UR(Zo,i)).mul(kg),c=n.context(ZI(Ic)).mul(Math.PI).mul(kg),u=gd(a),d=gd(c);t.context.radiance.addAssign(u),t.context.iblIrradiance.addAssign(d);const f=t.context.lightingModel.clearcoatRadiance;if(f){const p=n.context(UR(pd,mc)).mul(kg),g=gd(p);f.addAssign(g)}}_getPMREMNodeCache(t){let e=FR.get(t);return e===void 0&&(e=new WeakMap,FR.set(t,e)),e}}const UR=(r,t)=>{let e=null;return{getUV:()=>(e===null&&(e=yn.negate().reflect(t),e=TT(r).mix(e,t).normalize(),e=e.transformDirection(ro)),e),getTextureLevel:()=>r}},ZI=r=>({getUV:()=>r,getTextureLevel:()=>G(1)}),QI=new bt;class Xs extends Xn{static get type(){return"MeshStandardNodeMaterial"}constructor(t){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(QI),this.setValues(t)}setupEnvironment(t){let e=super.setupEnvironment(t);return e===null&&t.environmentNode&&(e=t.environmentNode),e?new KI(e):null}setupLightingModel(){return new OD}setupSpecular(){const t=Be(st(.04),on.rgb,il);Dc.assign(st(.04)),Cu.assign(t),Du.assign(1)}setupVariants(){const t=this.metalnessNode?G(this.metalnessNode):P4;il.assign(t);let e=this.roughnessNode?G(this.roughnessNode):U4;e=JT({roughness:e}),Zo.assign(e),this.setupSpecular(),Au.assign(on.rgb.mul(t.oneMinus()))}copy(t){return this.emissiveNode=t.emissiveNode,this.metalnessNode=t.metalnessNode,this.roughnessNode=t.roughnessNode,super.copy(t)}}const JI=new Dy;class tV extends Xs{static get type(){return"MeshPhysicalNodeMaterial"}constructor(t){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(JI),this.setValues(t)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const t=this.iorNode?G(this.iorNode):Z4;_p.assign(t),Dc.assign(nr(wT(_p.sub(1).div(_p.add(1))).mul(F4),st(1)).mul(sw)),Cu.assign(Be(Dc,on.rgb,il)),Du.assign(Be(sw,1,il))}setupLightingModel(){return new OD(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(t){if(super.setupVariants(t),this.useClearcoat){const e=this.clearcoatNode?G(this.clearcoatNode):I4,n=this.clearcoatRoughnessNode?G(this.clearcoatRoughnessNode):V4;Ly.assign(e),pd.assign(JT({roughness:n}))}if(this.useSheen){const e=this.sheenNode?st(this.sheenNode):H4,n=this.sheenRoughnessNode?G(this.sheenRoughnessNode):W4;br.assign(e),dc.assign(n)}if(this.useIridescence){const e=this.iridescenceNode?G(this.iridescenceNode):$4,n=this.iridescenceIORNode?G(this.iridescenceIORNode):X4,s=this.iridescenceThicknessNode?G(this.iridescenceThicknessNode):j4;yx.assign(e),Oy.assign(n),Fy.assign(s)}if(this.useAnisotropy){const e=(this.anisotropyNode?Vt(this.anisotropyNode):q4).toVar();uc.assign(e.length()),re(uc.equal(0),()=>{e.assign(Vt(1,0))}).Else(()=>{e.divAssign(Vt(uc)),uc.assign(uc.saturate())}),Uy.assign(uc.pow2().mix(Zo.pow2(),1)),Tp.assign(Bu[0].mul(e.x).add(Bu[1].mul(e.y))),Uu.assign(Bu[1].mul(e.x).sub(Bu[0].mul(e.y)))}if(this.useTransmission){const e=this.transmissionNode?G(this.transmissionNode):Y4,n=this.thicknessNode?G(this.thicknessNode):K4,s=this.attenuationDistanceNode?G(this.attenuationDistanceNode):Q4,i=this.attenuationColorNode?st(this.attenuationColorNode):J4;if(zy.assign(e),iT.assign(n),rT.assign(s),oT.assign(i),this.useDispersion){const a=this.dispersionNode?G(this.dispersionNode):rD;aT.assign(a)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?st(this.clearcoatNormalNode):G4}setup(t){t.context.setupClearcoatNormal=()=>Pu(this.setupClearcoatNormal(t),"NORMAL","vec3"),super.setup(t)}copy(t){return this.clearcoatNode=t.clearcoatNode,this.clearcoatRoughnessNode=t.clearcoatRoughnessNode,this.clearcoatNormalNode=t.clearcoatNormalNode,this.sheenNode=t.sheenNode,this.sheenRoughnessNode=t.sheenRoughnessNode,this.iridescenceNode=t.iridescenceNode,this.iridescenceIORNode=t.iridescenceIORNode,this.iridescenceThicknessNode=t.iridescenceThicknessNode,this.specularIntensityNode=t.specularIntensityNode,this.specularColorNode=t.specularColorNode,this.iorNode=t.iorNode,this.transmissionNode=t.transmissionNode,this.thicknessNode=t.thicknessNode,this.attenuationDistanceNode=t.attenuationDistanceNode,this.attenuationColorNode=t.attenuationColorNode,this.dispersionNode=t.dispersionNode,this.anisotropyNode=t.anisotropyNode,super.copy(t)}}const eV=ot(({normal:r,lightDirection:t,builder:e})=>{const n=r.dot(t),s=Vt(n.mul(.5).add(.5),0);if(e.material.gradientMap){const i=tl("gradientMap","texture").context({getUV:()=>s});return st(i.r)}else{const i=s.fwidth().mul(.5);return Be(st(.7),st(1),Eo(G(.7).sub(i.x),G(.7).add(i.x),s.x))}});class nV extends Cx{direct({lightDirection:t,lightColor:e,reflectedLight:n},s){const i=eV({normal:Mx,lightDirection:t,builder:s}).mul(e);n.directDiffuse.addAssign(i.mul(ku({diffuseColor:on.rgb})))}indirect(t){const{ambientOcclusion:e,irradiance:n,reflectedLight:s}=t.context;s.indirectDiffuse.addAssign(n.mul(ku({diffuseColor:on}))),s.indirectDiffuse.mulAssign(e)}}const sV=new G8;class iV extends Xn{static get type(){return"MeshToonNodeMaterial"}constructor(t){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(sV),this.setValues(t)}setupLightingModel(){return new nV}}const ID=ot(()=>{const r=st(yn.z,0,yn.x.negate()).normalize(),t=yn.cross(r);return Vt(r.dot(Ve),t.dot(Ve)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),rV=new W8;class oV extends Xn{static get type(){return"MeshMatcapNodeMaterial"}constructor(t){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(rV),this.setValues(t)}setupVariants(t){const e=ID;let n;t.material.matcap?n=tl("matcap","texture").context({getUV:()=>e}):n=st(Be(.2,.8,e.y)),on.rgb.mulAssign(n.rgb)}}class aV extends rs{static get type(){return"RotateNode"}constructor(t,e){super(),this.positionNode=t,this.rotationNode=e}getNodeType(t){return this.positionNode.getNodeType(t)}setup(t){const{rotationNode:e,positionNode:n}=this;if(this.getNodeType(t)==="vec2"){const i=e.cos(),a=e.sin();return gx(i,a,a.negate(),i).mul(n)}else{const i=e,a=vc(ie(1,0,0,0),ie(0,wo(i.x),Ci(i.x).negate(),0),ie(0,Ci(i.x),wo(i.x),0),ie(0,0,0,1)),c=vc(ie(wo(i.y),0,Ci(i.y),0),ie(0,1,0,0),ie(Ci(i.y).negate(),0,wo(i.y),0),ie(0,0,0,1)),u=vc(ie(wo(i.z),Ci(i.z).negate(),0,0),ie(Ci(i.z),wo(i.z),0,0),ie(0,0,1,0),ie(0,0,0,1));return a.mul(c).mul(u).mul(ie(n,1)).xyz}}}const Qp=be(aV).setParameterLength(2),lV=new t8;class VD extends Xn{static get type(){return"SpriteNodeMaterial"}constructor(t){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(lV),this.setValues(t)}setupPositionView(t){const{object:e,camera:n}=t,{positionNode:s,rotationNode:i,scaleNode:a,sizeAttenuation:c}=this,u=zc.mul(st(s||0));let d=Vt(Yr[0].xyz.length(),Yr[1].xyz.length());a!==null&&(d=d.mul(Vt(a))),n.isPerspectiveCamera&&c===!1&&(d=d.mul(u.z.negate()));let f=Zp.xy;if(e.center&&e.center.isVector2===!0){const y=rz("center","vec2",e);f=f.sub(y.sub(.5))}f=f.mul(d);const p=G(i||k4),g=Qp(f,p);return ie(u.xy.add(g),u.zw)}copy(t){return this.positionNode=t.positionNode,this.rotationNode=t.rotationNode,this.scaleNode=t.scaleNode,super.copy(t)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(t){this._useSizeAttenuation!==t&&(this._useSizeAttenuation=t,this.needsUpdate=!0)}}const cV=new er,uV=new Ut;class hV extends VD{static get type(){return"PointsNodeMaterial"}constructor(t){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(cV),this.setValues(t)}setupPositionView(){const{positionNode:t}=this;return zc.mul(st(t||Wn)).xyz}setupVertexSprite(t){const{material:e,camera:n}=t,{rotationNode:s,scaleNode:i,sizeNode:a,sizeAttenuation:c}=this;let u=super.setupVertex(t);if(e.isNodeMaterial!==!0)return u;let d=a!==null?Vt(a):iD;d=d.mul(e4),n.isPerspectiveCamera&&c===!0&&(d=d.mul(dV.div(ds.z.negate()))),i&&i.isNode&&(d=d.mul(Vt(i)));let f=Zp.xy;if(s&&s.isNode){const p=G(s);f=Qp(f,p)}return f=f.mul(d),f=f.div(UT.div(2)),f=f.mul(u.w),u=u.add(ie(f,0,0)),u}setupVertex(t){return t.object.isPoints?super.setupVertex(t):this.setupVertexSprite(t)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(t){this._useAlphaToCoverage!==t&&(this._useAlphaToCoverage=t,this.needsUpdate=!0)}}const dV=te(1).onFrameUpdate(function({renderer:r}){const t=r.getSize(uV);this.value=.5*t.y});class fV extends Cx{constructor(){super(),this.shadowNode=G(1).toVar("shadowMask")}direct({lightNode:t}){t.shadowNode!==null&&this.shadowNode.mulAssign(t.shadowNode)}finish({context:t}){on.a.mulAssign(this.shadowNode.oneMinus()),t.outgoingLight.rgb.assign(on.rgb)}}const pV=new I8;class mV extends Xn{static get type(){return"ShadowNodeMaterial"}constructor(t){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(pV),this.setValues(t)}setupLightingModel(){return new fV}}cl("vec3");cl("vec3");cl("vec3");class gV{constructor(t,e,n){this.renderer=t,this.nodes=e,this.info=n,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const t=(e,n)=>{this._requestId=this._context.requestAnimationFrame(t),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(e,n),this.renderer._inspector.finish()};t()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(t){this._animationLoop=t}getContext(){return this._context}setContext(t){this._context=t}dispose(){this.stop()}}class Lc{constructor(){this.weakMaps={}}_getWeakMap(t){const e=t.length;let n=this.weakMaps[e];return n===void 0&&(n=new WeakMap,this.weakMaps[e]=n),n}get(t){let e=this._getWeakMap(t);for(let n=0;n<t.length-1;n++)if(e=e.get(t[n]),e===void 0)return;return e.get(t[t.length-1])}set(t,e){let n=this._getWeakMap(t);for(let s=0;s<t.length-1;s++){const i=t[s];n.has(i)===!1&&n.set(i,new WeakMap),n=n.get(i)}return n.set(t[t.length-1],e),this}delete(t){let e=this._getWeakMap(t);for(let n=0;n<t.length-1;n++)if(e=e.get(t[n]),e===void 0)return!1;return e.delete(t[t.length-1])}}let yV=0;function xV(r){const t=Object.keys(r);let e=Object.getPrototypeOf(r);for(;e;){const n=Object.getOwnPropertyDescriptors(e);for(const s in n)if(n[s]!==void 0){const i=n[s];i&&typeof i.get=="function"&&t.push(s)}e=Object.getPrototypeOf(e)}return t}class bV{constructor(t,e,n,s,i,a,c,u,d,f){this.id=yV++,this._nodes=t,this._geometries=e,this.renderer=n,this.object=s,this.material=i,this.scene=a,this.camera=c,this.lightsNode=u,this.context=d,this.geometry=s.geometry,this.version=i.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=f,this.clippingContextCacheKey=f!==null?f.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(t){this.clippingContext=t}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(t){for(const e of this.getBindings())if(e.name===t)return e}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getIndirectOffset(){return this._geometries.getIndirectOffset(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(t){this.geometry=t,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const t=this.getNodeBuilderState().nodeAttributes,e=this.geometry,n=[],s=new Set,i={};for(const a of t){let c;if(a.node&&a.node.attribute?c=a.node.attribute:(c=e.getAttribute(a.name),i[a.name]=c.id),c===void 0)continue;n.push(c);const u=c.isInterleavedBufferAttribute?c.data:c;s.add(u)}return this.attributes=n,this.attributesId=i,this.vertexBuffers=Array.from(s.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:t,material:e,geometry:n,group:s,drawRange:i}=this,a=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),c=this.getIndex(),u=c!==null;let d=1;if(n.isInstancedBufferGeometry===!0?d=n.instanceCount:t.count!==void 0&&(d=Math.max(0,t.count)),d===0)return null;if(a.instanceCount=d,t.isBatchedMesh===!0)return a;let f=1;e.wireframe===!0&&!t.isPoints&&!t.isLineSegments&&!t.isLine&&!t.isLineLoop&&(f=2);let p=i.start*f,g=(i.start+i.count)*f;s!==null&&(p=Math.max(p,s.start*f),g=Math.min(g,(s.start+s.count)*f));const y=n.attributes.position;let x=1/0;u?x=c.count:y!=null&&(x=y.count),p=Math.max(p,0),g=Math.min(g,x);const S=g-p;return S<0||S===1/0?null:(a.vertexCount=S,a.firstVertex=p,a)}getGeometryCacheKey(){const{geometry:t}=this;let e="";for(const n of Object.keys(t.attributes).sort()){const s=t.attributes[n];e+=n+",",s.data&&(e+=s.data.stride+","),s.offset&&(e+=s.offset+","),s.itemSize&&(e+=s.itemSize+","),s.normalized&&(e+="n,")}for(const n of Object.keys(t.morphAttributes).sort()){const s=t.morphAttributes[n];e+="morph-"+n+",";for(let i=0,a=s.length;i<a;i++){const c=s[i];e+=c.id+","}}return t.index&&(e+="index,"),e}getMaterialCacheKey(){const{object:t,material:e,renderer:n}=this;let s=e.customProgramCacheKey();for(const i of xV(e)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(i))continue;const a=e[i];let c;if(a!==null){const u=typeof a;u==="number"?c=a!==0?"1":"0":u==="object"?(c="{",a.isTexture&&(c+=a.mapping,n.backend.isWebGPUBackend===!0&&(c+=a.magFilter,c+=a.minFilter,c+=a.wrapS,c+=a.wrapT,c+=a.wrapR)),c+="}"):c=String(a)}else c=String(a);s+=c+","}return s+=this.clippingContextCacheKey+",",t.geometry&&(s+=this.getGeometryCacheKey()),t.skeleton&&(s+=t.skeleton.bones.length+","),t.isBatchedMesh&&(s+=t._matricesTexture.uuid+",",t._colorsTexture!==null&&(s+=t._colorsTexture.uuid+",")),(t.isInstancedMesh||t.count>1||Array.isArray(t.morphTargetInfluences))&&(s+=t.uuid+","),s+=this.context.id+",",s+=t.receiveShadow+",",Dd(s)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const t=this.attributesId;for(const e in t){const n=this.geometry.getAttribute(e);if(n===void 0||t[e]!==n.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let t=0;return this.material.isShadowPassMaterial!==!0&&(t=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(t=Sp(t,this.camera.cameras.length)),this.object.receiveShadow&&(t=Sp(t,1)),t=Sp(t,this.renderer.contextNode.id,this.renderer.contextNode.version),t}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const Wo=[];class SV{constructor(t,e,n,s,i,a){this.renderer=t,this.nodes=e,this.geometries=n,this.pipelines=s,this.bindings=i,this.info=a,this.chainMaps={}}get(t,e,n,s,i,a,c,u){const d=this.getChainMap(u);Wo[0]=t,Wo[1]=e,Wo[2]=a,Wo[3]=i;let f=d.get(Wo);return f===void 0?(f=this.createRenderObject(this.nodes,this.geometries,this.renderer,t,e,n,s,i,a,c,u),d.set(Wo,f)):(f.camera=s,f.updateClipping(c),f.needsGeometryUpdate&&f.setGeometry(t.geometry),(f.version!==e.version||f.needsUpdate)&&(f.initialCacheKey!==f.getCacheKey()?(f.dispose(),f=this.get(t,e,n,s,i,a,c,u)):f.version=e.version)),Wo[0]=null,Wo[1]=null,Wo[2]=null,Wo[3]=null,f}getChainMap(t="default"){return this.chainMaps[t]||(this.chainMaps[t]=new Lc)}dispose(){this.chainMaps={}}createRenderObject(t,e,n,s,i,a,c,u,d,f,p){const g=this.getChainMap(p),y=new bV(t,e,n,s,i,a,c,u,d,f);return y.onDispose=()=>{this.pipelines.delete(y),this.bindings.deleteForRender(y),this.nodes.delete(y),g.delete(y.getChainArray())},y}}class Vc{constructor(){this.data=new WeakMap}get(t){let e=this.data.get(t);return e===void 0&&(e={},this.data.set(t,e)),e}delete(t){let e=null;return this.data.has(t)&&(e=this.data.get(t),this.data.delete(t)),e}has(t){return this.data.has(t)}dispose(){this.data=new WeakMap}}const Kr={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},gc=16,wV=211,TV=212;class _V extends Vc{constructor(t){super(),this.backend=t}delete(t){const e=super.delete(t);return e!==null&&this.backend.destroyAttribute(t),e}update(t,e){const n=this.get(t);if(n.version===void 0)e===Kr.VERTEX?this.backend.createAttribute(t):e===Kr.INDEX?this.backend.createIndexAttribute(t):e===Kr.STORAGE?this.backend.createStorageAttribute(t):e===Kr.INDIRECT&&this.backend.createIndirectStorageAttribute(t),n.version=this._getBufferAttribute(t).version;else{const s=this._getBufferAttribute(t);(n.version<s.version||s.usage===Lp)&&(this.backend.updateAttribute(t),n.version=s.version)}}_getBufferAttribute(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}function GD(r){return r.index!==null?r.index.version:r.attributes.position.version}function kD(r){return r.index!==null?r.index.id:r.attributes.position.id}function PR(r){const t=[],e=r.index,n=r.attributes.position;if(e!==null){const i=e.array;for(let a=0,c=i.length;a<c;a+=3){const u=i[a+0],d=i[a+1],f=i[a+2];t.push(u,d,d,f,f,u)}}else{const i=n.array;for(let a=0,c=i.length/3-1;a<c;a+=3){const u=a+0,d=a+1,f=a+2;t.push(u,d,d,f,f,u)}}const s=new(n.count>=65535?nC:eC)(t,1);return s.version=GD(r),s.__id=kD(r),s}class MV extends Vc{constructor(t,e){super(),this.attributes=t,this.info=e,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(t){const e=t.geometry;return super.has(e)&&this.get(e).initialized===!0}updateForRender(t){this.has(t)===!1&&this.initGeometry(t),this.updateAttributes(t)}initGeometry(t){const e=t.geometry,n=this.get(e);n.initialized=!0,this.info.memory.geometries++;const s=()=>{this.info.memory.geometries--;const i=e.index,a=t.getAttributes();i!==null&&this.attributes.delete(i);for(const u of a)this.attributes.delete(u);const c=this.wireframes.get(e);c!==void 0&&this.attributes.delete(c),e.removeEventListener("dispose",s),this._geometryDisposeListeners.delete(e)};e.addEventListener("dispose",s),this._geometryDisposeListeners.set(e,s)}updateAttributes(t){const e=t.getAttributes();for(const i of e)i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute?this.updateAttribute(i,Kr.STORAGE):this.updateAttribute(i,Kr.VERTEX);const n=this.getIndex(t);n!==null&&this.updateAttribute(n,Kr.INDEX);const s=t.geometry.indirect;s!==null&&this.updateAttribute(s,Kr.INDIRECT)}updateAttribute(t,e){const n=this.info.render.calls;t.isInterleavedBufferAttribute?this.attributeCall.get(t)===void 0?(this.attributes.update(t,e),this.attributeCall.set(t,n)):this.attributeCall.get(t.data)!==n&&(this.attributes.update(t,e),this.attributeCall.set(t.data,n),this.attributeCall.set(t,n)):this.attributeCall.get(t)!==n&&(this.attributes.update(t,e),this.attributeCall.set(t,n))}getIndirect(t){return t.geometry.indirect}getIndirectOffset(t){return t.geometry.indirectOffset}getIndex(t){const{geometry:e,material:n}=t;let s=e.index;if(n.wireframe===!0){const i=this.wireframes;let a=i.get(e);a===void 0?(a=PR(e),i.set(e,a)):(a.version!==GD(e)||a.__id!==kD(e))&&(this.attributes.delete(a),a=PR(e),i.set(e,a)),s=a}return s}dispose(){for(const[t,e]of this._geometryDisposeListeners.entries())t.removeEventListener("dispose",e);this._geometryDisposeListeners.clear()}}class vV{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(t,e,n){this.render.drawCalls++,t.isMesh||t.isSprite?this.render.triangles+=n*(e/3):t.isPoints?this.render.points+=n*e:t.isLineSegments?this.render.lines+=n*(e/2):t.isLine?this.render.lines+=n*(e-1):Ht("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class HD{constructor(t){this.cacheKey=t,this.usedTimes=0}}class AV extends HD{constructor(t,e,n){super(t),this.vertexProgram=e,this.fragmentProgram=n}}class NV extends HD{constructor(t,e){super(t),this.computeProgram=e,this.isComputePipeline=!0}}let RV=0;class YS{constructor(t,e,n,s=null,i=null){this.id=RV++,this.code=t,this.stage=e,this.name=n,this.transforms=s,this.attributes=i,this.usedTimes=0}}class EV extends Vc{constructor(t,e){super(),this.backend=t,this.nodes=e,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(t,e){const{backend:n}=this,s=this.get(t);if(this._needsComputeUpdate(t)){const i=s.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);const a=this.nodes.getForCompute(t);let c=this.programs.compute.get(a.computeShader);c===void 0&&(i&&i.computeProgram.usedTimes===0&&this._releaseProgram(i.computeProgram),c=new YS(a.computeShader,"compute",t.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,c),n.createProgram(c));const u=this._getComputeCacheKey(t,c);let d=this.caches.get(u);d===void 0&&(i&&i.usedTimes===0&&this._releasePipeline(i),d=this._getComputePipeline(t,c,u,e)),d.usedTimes++,c.usedTimes++,s.version=t.version,s.pipeline=d}return s.pipeline}getForRender(t,e=null){const{backend:n}=this,s=this.get(t);if(this._needsRenderUpdate(t)){const i=s.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);const a=t.getNodeBuilderState(),c=t.material?t.material.name:"";let u=this.programs.vertex.get(a.vertexShader);u===void 0&&(i&&i.vertexProgram.usedTimes===0&&this._releaseProgram(i.vertexProgram),u=new YS(a.vertexShader,"vertex",c),this.programs.vertex.set(a.vertexShader,u),n.createProgram(u));let d=this.programs.fragment.get(a.fragmentShader);d===void 0&&(i&&i.fragmentProgram.usedTimes===0&&this._releaseProgram(i.fragmentProgram),d=new YS(a.fragmentShader,"fragment",c),this.programs.fragment.set(a.fragmentShader,d),n.createProgram(d));const f=this._getRenderCacheKey(t,u,d);let p=this.caches.get(f);p===void 0?(i&&i.usedTimes===0&&this._releasePipeline(i),p=this._getRenderPipeline(t,u,d,f,e)):t.pipeline=p,p.usedTimes++,u.usedTimes++,d.usedTimes++,s.pipeline=p}return s.pipeline}delete(t){const e=this.get(t).pipeline;return e&&(e.usedTimes--,e.usedTimes===0&&this._releasePipeline(e),e.isComputePipeline?(e.computeProgram.usedTimes--,e.computeProgram.usedTimes===0&&this._releaseProgram(e.computeProgram)):(e.fragmentProgram.usedTimes--,e.vertexProgram.usedTimes--,e.vertexProgram.usedTimes===0&&this._releaseProgram(e.vertexProgram),e.fragmentProgram.usedTimes===0&&this._releaseProgram(e.fragmentProgram))),super.delete(t)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(t){this.getForRender(t)}_getComputePipeline(t,e,n,s){n=n||this._getComputeCacheKey(t,e);let i=this.caches.get(n);return i===void 0&&(i=new NV(n,e),this.caches.set(n,i),this.backend.createComputePipeline(i,s)),i}_getRenderPipeline(t,e,n,s,i){s=s||this._getRenderCacheKey(t,e,n);let a=this.caches.get(s);return a===void 0&&(a=new AV(s,e,n),this.caches.set(s,a),t.pipeline=a,this.backend.createRenderPipeline(t,i)),a}_getComputeCacheKey(t,e){return t.id+","+e.id}_getRenderCacheKey(t,e,n){return e.id+","+n.id+","+this.backend.getRenderCacheKey(t)}_releasePipeline(t){this.caches.delete(t.cacheKey)}_releaseProgram(t){const e=t.code,n=t.stage;this.programs[n].delete(e)}_needsComputeUpdate(t){const e=this.get(t);return e.pipeline===void 0||e.version!==t.version}_needsRenderUpdate(t){return this.get(t).pipeline===void 0||this.backend.needsRenderUpdate(t)}}class CV extends Vc{constructor(t,e,n,s,i,a){super(),this.backend=t,this.textures=n,this.pipelines=i,this.attributes=s,this.nodes=e,this.info=a,this.pipelines.bindings=this}getForRender(t){const e=t.getBindings();for(const n of e){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,e,0),s.bindGroup=n)}return e}getForCompute(t){const e=this.nodes.getForCompute(t).bindings;for(const n of e){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,e,0),s.bindGroup=n)}return e}updateForCompute(t){this._updateBindings(this.getForCompute(t))}updateForRender(t){this._updateBindings(this.getForRender(t))}deleteForCompute(t){const e=this.nodes.getForCompute(t).bindings;for(const n of e)this.backend.deleteBindGroupData(n),this.delete(n)}deleteForRender(t){const e=t.getBindings();for(const n of e)this.backend.deleteBindGroupData(n),this.delete(n)}_updateBindings(t){for(const e of t)this._update(e,t)}_init(t){for(const e of t.bindings)if(e.isSampledTexture)this.textures.updateTexture(e.texture);else if(e.isSampler)this.textures.updateSampler(e.texture);else if(e.isStorageBuffer){const n=e.attribute,s=n.isIndirectStorageBufferAttribute?Kr.INDIRECT:Kr.STORAGE;this.attributes.update(n,s)}}_update(t,e){const{backend:n}=this;let s=!1,i=!0,a=0,c=0;for(const u of t.bindings)if(this.nodes.updateGroup(u)!==!1){if(u.isStorageBuffer){const f=u.attribute,p=f.isIndirectStorageBufferAttribute?Kr.INDIRECT:Kr.STORAGE,g=n.get(u);this.attributes.update(f,p),g.attribute!==f&&(g.attribute=f,s=!0)}if(u.isUniformBuffer)u.update()&&n.updateBinding(u);else if(u.isSampledTexture){const f=u.update(),p=u.texture,g=this.textures.get(p);if(f&&(this.textures.updateTexture(p),u.generation!==g.generation&&(u.generation=g.generation,s=!0),g.bindGroups.add(t)),n.get(p).externalTexture!==void 0||g.isDefaultTexture?i=!1:(a=a*10+p.id,c+=p.version),p.isStorageTexture===!0&&p.mipmapsAutoUpdate===!0){const x=this.get(p);u.store===!0?x.needsMipmap=!0:this.textures.needsMipmaps(p)&&x.needsMipmap===!0&&(this.backend.generateMipmaps(p),x.needsMipmap=!1)}}else if(u.isSampler&&u.update()){const p=this.textures.updateSampler(u.texture);u.samplerKey!==p&&(u.samplerKey=p,s=!0)}u.isBuffer&&u.updateRanges.length>0&&u.clearUpdateRanges()}s===!0&&this.backend.updateBindings(t,e,i?a:0,c)}}function DV(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.z!==t.z?r.z-t.z:r.id-t.id}function zR(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.z!==t.z?t.z-r.z:r.id-t.id}function IR(r){return(r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode)&&r.side===ss&&r.forceSinglePass===!1}class BV{constructor(t,e,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=t.getNode(e,n),this.lightsArray=[],this.scene=e,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(t,e,n,s,i,a,c){let u=this.renderItems[this.renderItemsIndex];return u===void 0?(u={id:t.id,object:t,geometry:e,material:n,groupOrder:s,renderOrder:t.renderOrder,z:i,group:a,clippingContext:c},this.renderItems[this.renderItemsIndex]=u):(u.id=t.id,u.object=t,u.geometry=e,u.material=n,u.groupOrder=s,u.renderOrder=t.renderOrder,u.z=i,u.group=a,u.clippingContext=c),this.renderItemsIndex++,u}push(t,e,n,s,i,a,c){const u=this.getNextRenderItem(t,e,n,s,i,a,c);t.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(IR(n)&&this.transparentDoublePass.push(u),this.transparent.push(u)):this.opaque.push(u)}unshift(t,e,n,s,i,a,c){const u=this.getNextRenderItem(t,e,n,s,i,a,c);n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(IR(n)&&this.transparentDoublePass.unshift(u),this.transparent.unshift(u)):this.opaque.unshift(u)}pushBundle(t){this.bundles.push(t)}pushLight(t){this.lightsArray.push(t)}sort(t,e){this.opaque.length>1&&this.opaque.sort(t||DV),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(e||zR),this.transparent.length>1&&this.transparent.sort(e||zR)}finish(){this.lightsNode.setLights(this.lightsArray);for(let t=this.renderItemsIndex,e=this.renderItems.length;t<e;t++){const n=this.renderItems[t];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}}const qh=[];class LV{constructor(t){this.lighting=t,this.lists=new Lc}get(t,e){const n=this.lists;qh[0]=t,qh[1]=e;let s=n.get(qh);return s===void 0&&(s=new BV(this.lighting,t,e),n.set(qh,s)),qh[0]=null,qh[1]=null,s}dispose(){this.lists=new Lc}}let OV=0;class FV{constructor(){this.id=OV++,this.mrt=null,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new Ze,this.scissor=!1,this.scissorValue=new Ze,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.camera=null,this.isRenderContext=!0}getCacheKey(){return WD(this)}}function WD(r){const{textures:t,activeCubeFace:e,activeMipmapLevel:n}=r,s=[e,n];for(const i of t)s.push(i.id);return Xp(s)}class UV{constructor(t){this.renderer=t,this._renderContexts={}}get(t=null,e=null,n=0){let s;if(t===null)s="default";else{const u=t.texture.format,d=t.texture.type;s=`${t.textures.length}:${u}:${d}:${t.samples}:${t.depthBuffer}:${t.stencilBuffer}`}const i=e!==null?e.id:"default",a=s+"-"+i+"-"+n;let c=this._renderContexts[a];return c===void 0&&(c=new FV,c.mrt=e,this._renderContexts[a]=c),t!==null&&(c.sampleCount=t.samples===0?1:t.samples),c.clearDepthValue=this.renderer.getClearDepth(),c.clearStencilValue=this.renderer.getClearStencil(),c}dispose(){this._renderContexts={}}}const PV=new V;class zV extends Vc{constructor(t,e,n){super(),this.renderer=t,this.backend=e,this.info=n}updateRenderTarget(t,e=0){const n=this.get(t),s=t.samples===0?1:t.samples,i=n.depthTextureMips||(n.depthTextureMips={}),a=t.textures,c=this.getSize(a[0]),u=c.width>>e,d=c.height>>e;let f=t.depthTexture||i[e];const p=t.depthBuffer===!0||t.stencilBuffer===!0;let g=!1;f===void 0&&p&&(f=new Zr,f.format=t.stencilBuffer?ol:Mo,f.type=t.stencilBuffer?Tc:Jn,f.image.width=u,f.image.height=d,f.image.depth=c.depth,f.renderTarget=t,f.isArrayTexture=t.multiview===!0&&c.depth>1,i[e]=f),(n.width!==c.width||c.height!==n.height)&&(g=!0,f&&(f.needsUpdate=!0,f.image.width=u,f.image.height=d,f.image.depth=f.isArrayTexture?f.image.depth:1)),n.width=c.width,n.height=c.height,n.textures=a,n.depthTexture=f||null,n.depth=t.depthBuffer,n.stencil=t.stencilBuffer,n.renderTarget=t,n.sampleCount!==s&&(g=!0,f&&(f.needsUpdate=!0),n.sampleCount=s);const y={sampleCount:s};if(t.isXRRenderTarget!==!0){for(let x=0;x<a.length;x++){const S=a[x];g&&(S.needsUpdate=!0),this.updateTexture(S,y)}f&&this.updateTexture(f,y)}n.initialized!==!0&&(n.initialized=!0,n.onDispose=()=>{this._destroyRenderTarget(t)},t.addEventListener("dispose",n.onDispose))}updateTexture(t,e={}){const n=this.get(t);if(n.initialized===!0&&n.version===t.version)return;const s=t.isRenderTargetTexture||t.isDepthTexture||t.isFramebufferTexture,i=this.backend;if(s&&n.initialized===!0&&i.destroyTexture(t),t.isFramebufferTexture){const d=this.renderer.getRenderTarget();d?t.type=d.texture.type:t.type=xi}const{width:a,height:c,depth:u}=this.getSize(t);if(e.width=a,e.height=c,e.depth=u,e.needsMipmaps=this.needsMipmaps(t),e.levels=e.needsMipmaps?this.getMipLevels(t,a,c):1,t.isCubeTexture&&t.mipmaps.length>0&&e.levels++,s||t.isStorageTexture===!0||t.isExternalTexture===!0)i.createTexture(t,e),n.generation=t.version;else if(t.version>0){const d=t.image;if(d===void 0)Wt("Renderer: Texture marked for update but image is undefined.");else if(d.complete===!1)Wt("Renderer: Texture marked for update but image is incomplete.");else{if(t.images){const p=[];for(const g of t.images)p.push(g);e.images=p}else e.image=d;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(i.createTexture(t,e),n.isDefaultTexture=!1,n.generation=t.version),t.source.dataReady===!0&&i.updateTexture(t,e);const f=t.isStorageTexture===!0&&t.mipmapsAutoUpdate===!1;e.needsMipmaps&&t.mipmaps.length===0&&!f&&i.generateMipmaps(t),t.onUpdate&&t.onUpdate(t)}}else i.createDefaultTexture(t),n.isDefaultTexture=!0,n.generation=t.version;n.initialized!==!0&&(n.initialized=!0,n.generation=t.version,n.bindGroups=new Set,this.info.memory.textures++,t.isVideoTexture&&Xe.enabled===!0&&Xe.getTransfer(t.colorSpace)!==ye&&Wt("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),n.onDispose=()=>{this._destroyTexture(t)},t.addEventListener("dispose",n.onDispose)),n.version=t.version}updateSampler(t){return this.backend.updateSampler(t)}getSize(t,e=PV){let n=t.images?t.images[0]:t.image;return n?(n.image!==void 0&&(n=n.image),typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?(e.width=n.videoWidth||1,e.height=n.videoHeight||1,e.depth=1):typeof VideoFrame<"u"&&n instanceof VideoFrame?(e.width=n.displayWidth||1,e.height=n.displayHeight||1,e.depth=1):(e.width=n.width||1,e.height=n.height||1,e.depth=t.isCubeTexture?6:n.depth||1)):e.width=e.height=e.depth=1,e}getMipLevels(t,e,n){let s;return t.mipmaps.length>0?s=t.mipmaps.length:t.isCompressedTexture===!0?s=1:s=Math.floor(Math.log2(Math.max(e,n)))+1,s}needsMipmaps(t){return t.generateMipmaps===!0||t.mipmaps.length>0}_destroyRenderTarget(t){if(this.has(t)===!0){const e=this.get(t),n=e.textures,s=e.depthTexture;t.removeEventListener("dispose",e.onDispose);for(let i=0;i<n.length;i++)this._destroyTexture(n[i]);s&&this._destroyTexture(s),this.delete(t),this.backend.delete(t)}}_destroyTexture(t){if(this.has(t)===!0){const e=this.get(t);t.removeEventListener("dispose",e.onDispose);const n=e.isDefaultTexture;if(this.backend.destroyTexture(t,n),e.bindGroups)for(const s of e.bindGroups){const i=this.backend.get(s);i.groups=void 0,i.versions=void 0}this.delete(t),this.info.memory.textures--}}}class s_ extends Xt{constructor(t,e,n,s=1){super(t,e,n),this.a=s}set(t,e,n,s=1){return this.a=s,super.set(t,e,n)}copy(t){return t.a!==void 0&&(this.a=t.a),super.copy(t)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class qD extends Je{static get type(){return"ParameterNode"}constructor(t,e=null){super(t,e),this.isParameterNode=!0}getMemberType(t,e){const n=this.getNodeType(t),s=t.getStructTypeNode(n);let i;return s!==null?i=s.getMemberType(t,e):(Ht(`TSL: Member "${e}" not found in struct "${n}".`,new ps),i="float"),i}getHash(){return this.uuid}generate(){return this.name}}const IV=(r,t)=>new qD(r,t);class VV extends Jt{static get type(){return"StackNode"}constructor(t=null){super(),this.nodes=[],this.outputNode=null,this.parent=t,this._currentCond=null,this._expressionNode=null,this._currentNode=null,this.isStackNode=!0}getElementType(t){return this.hasOutput(t)?this.outputNode.getElementType(t):"void"}getNodeType(t){return this.hasOutput(t)?this.outputNode.getNodeType(t):"void"}getMemberType(t,e){return this.hasOutput(t)?this.outputNode.getMemberType(t,e):"void"}addToStack(t,e=this.nodes.length){return t.isNode!==!0?(Ht("TSL: Invalid node added to stack.",new ps),this):(this.nodes.splice(e,0,t),this)}addToStackBefore(t){const e=this._currentNode?this.nodes.indexOf(this._currentNode):0;return this.addToStack(t,e)}If(t,e){const n=new cd(e);return this._currentCond=bi(t,n),this.addToStack(this._currentCond)}ElseIf(t,e){const n=new cd(e),s=bi(t,n);return this._currentCond.elseNode=s,this._currentCond=s,this}Else(t){return this._currentCond.elseNode=new cd(t),this}Switch(t){return this._expressionNode=Qt(t),this}Case(...t){const e=[];if(t.length>=2)for(let c=0;c<t.length-1;c++)e.push(this._expressionNode.equal(Qt(t[c])));else Ht("TSL: Invalid parameter length. Case() requires at least two parameters.",new ps);const n=t[t.length-1],s=new cd(n);let i=e[0];for(let c=1;c<e.length;c++)i=i.or(e[c]);const a=bi(i,s);return this._currentCond===null?(this._currentCond=a,this.addToStack(this._currentCond)):(this._currentCond.elseNode=a,this._currentCond=a,this)}Default(t){return this.Else(t),this}setup(t){const e=t.getNodeProperties(this);let n=0;for(const s of this.getChildren())s.isVarNode&&s.isIntent(t)&&s.isAssign(t)!==!0||(e["node"+n++]=s);return e.outputNode||null}hasOutput(t){return this.outputNode&&this.outputNode.isNode&&this.outputNode.getNodeType(t)!=="void"}build(t,...e){const n=Qw(),s=t.buildStage;zp(this),t.setActiveStack(this);const i=d=>{if(this._currentNode=d,!(d.isVarNode&&d.isIntent(t)&&d.isAssign(t)!==!0)){if(s==="setup")d.build(t);else if(s==="analyze")d.build(t,this);else if(s==="generate"){const f=t.getDataFromNode(d,"any").stages,p=f&&f[t.shaderStage];if(d.isVarNode&&p&&p.length===1&&p[0]&&p[0].isStackNode)return;d.build(t,"void")}}},a=[...this.nodes];for(const d of a)i(d);this._currentNode=null;const c=this.nodes.filter(d=>a.indexOf(d)===-1);for(const d of c)i(d);let u;return this.hasOutput(t)?u=this.outputNode.build(t,...e):u=super.build(t,...e),zp(n),t.removeActiveStack(this),u}}const Wg=be(VV).setParameterLength(0,1);function GV(r){return Object.entries(r).map(([t,e])=>typeof e=="string"?{name:t,type:e,atomic:!1}:{name:t,type:e.type,atomic:e.atomic||!1})}class kV extends Jt{static get type(){return"StructTypeNode"}constructor(t,e=null){super("struct"),this.membersLayout=GV(t),this.name=e,this.isStructLayoutNode=!0}getLength(){const t=Float32Array.BYTES_PER_ELEMENT;let e=1,n=0;for(const s of this.membersLayout){const i=s.type,a=dP(i),c=fP(i)/t;e=Math.max(e,c);const d=n%e%c;d!==0&&(n+=c-d),n+=a}return Math.ceil(n/e)*e}getMemberType(t,e){const n=this.membersLayout.find(s=>s.name===e);return n?n.type:"void"}getNodeType(t){return t.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(t){t.getStructTypeFromNode(this,this.membersLayout,this.name),t.addInclude(this)}generate(t){return this.getNodeType(t)}}class HV extends Jt{static get type(){return"StructNode"}constructor(t,e){super("vec3"),this.structTypeNode=t,this.values=e,this.isStructNode=!0}getNodeType(t){return this.structTypeNode.getNodeType(t)}getMemberType(t,e){return this.structTypeNode.getMemberType(t,e)}_getChildren(){const t=super._getChildren(),e=t.find(n=>n.childNode===this.structTypeNode);return t.splice(t.indexOf(e),1),t.push(e),t}generate(t){const e=t.getVarFromNode(this),n=e.type,s=t.getPropertyName(e);return t.addLineFlowCode(`${s} = ${t.generateStruct(n,this.structTypeNode.membersLayout,this.values)}`,this),e.name}}const WV=(r,t=null)=>{const e=new kV(r,t),n=(...s)=>{let i=null;if(s.length>0)if(s[0].isNode){i={};const a=Object.keys(r);for(let c=0;c<s.length;c++)i[a[c]]=s[c]}else i=s[0];return new HV(e,i)};return n.layout=e,n.isStruct=!0,n};class $D extends Jt{static get type(){return"OutputStructNode"}constructor(...t){super(),this.members=t,this.isOutputStructNode=!0}getNodeType(){return"OutputType"}generate(t){const e=t.getDataFromNode(this);if(e.membersLayout===void 0){const a=this.members,c=[];for(let u=0;u<a.length;u++){const d="m"+u,f=a[u].getNodeType(t);c.push({name:d,type:f,index:u})}e.membersLayout=c,e.structType=t.getOutputStructTypeFromNode(this,e.membersLayout)}const n=t.getOutputStructName(),s=this.members,i=n!==""?n+".":"";for(let a=0;a<s.length;a++){const c=s[a].build(t);t.addLineFlowCode(`${i}m${a} = ${c}`,this)}return n}}const qV=be($D);class XD{constructor(t=mi){this.blending=t,this.blendSrc=Rp,this.blendDst=Ep,this.blendEquation=Xr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.premultiplyAlpha=!1}copy(t){return this.blending=t.blending,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.premultiplyAlpha=t.premultiplyAlpha,this}clone(){return new this.constructor().copy(this)}}const $V=new XD(rl),XV=new XD(_w);function jD(r,t){for(let e=0;e<r.length;e++)if(r[e].name===t)return e;return-1}class jV extends $D{static get type(){return"MRTNode"}constructor(t){super(),this.outputNodes=t,this.blendModes={output:XV},this.isMRTNode=!0}setBlendMode(t,e){return this.blendModes[t]=e,this}getBlendMode(t){return this.blendModes[t]||$V}has(t){return this.outputNodes[t]!==void 0}get(t){return this.outputNodes[t]}merge(t){const e={...this.outputNodes,...t.outputNodes},n={...this.blendModes,...t.blendModes},s=YD(e);return s.blendings=n,s}setup(t){const e=this.outputNodes,n=t.renderer.getRenderTarget(),s=[],i=n.textures;for(const a in e){const c=jD(i,a);s[c]=ie(e[a])}return this.members=s,super.setup(t)}}const YD=be(jV);class Jp extends rs{static get type(){return"BitcastNode"}constructor(t,e,n=null){super(),this.valueNode=t,this.conversionType=e,this.inputType=n,this.isBitcastNode=!0}getNodeType(t){if(this.inputType!==null){const e=this.valueNode.getNodeType(t),n=t.getTypeLength(e);return t.getTypeFromLength(n,this.conversionType)}return this.conversionType}generate(t){const e=this.getNodeType(t);let n="";if(this.inputType!==null){const s=this.valueNode.getNodeType(t);n=t.getTypeLength(s)===1?this.inputType:t.changeComponentType(s,this.inputType)}else n=this.valueNode.getNodeType(t);return`${t.getBitcastMethod(e,n)}( ${this.valueNode.build(t,n)} )`}}const KD=kt(Jp).setParameterLength(2),YV=r=>new Jp(r,"int","float"),ZD=r=>new Jp(r,"uint","float"),KV=r=>new Jp(r,"float","int"),ZV=r=>new Jp(r,"float","uint"),eg={};class vr extends _t{static get type(){return"BitcountNode"}constructor(t,e){super(t,e),this.isBitcountNode=!0}_resolveElementType(t,e,n){n==="int"?e.assign(KD(t,"uint")):e.assign(t)}_returnDataNode(t){switch(t){case"uint":return zt;case"int":return Q;case"uvec2":return Jw;case"uvec3":return Xu;case"uvec4":return sT;case"ivec2":return Cs;case"ivec3":return tT;case"ivec4":return nT}}_createTrailingZerosBaseLayout(t,e){const n=this._returnDataNode(e);return ot(([i])=>{const a=zt(0);this._resolveElementType(i,a,e);const c=G(a.bitAnd(gT(a))),d=ZD(c).shiftRight(23).sub(127);return n(d)}).setLayout({name:t,type:e,inputs:[{name:"value",type:e}]})}_createLeadingZerosBaseLayout(t,e){const n=this._returnDataNode(e);return ot(([i])=>{re(i.equal(zt(0)),()=>zt(32));const a=zt(0),c=zt(0);return this._resolveElementType(i,a,e),re(a.shiftRight(16).equal(0),()=>{c.addAssign(16),a.shiftLeftAssign(16)}),re(a.shiftRight(24).equal(0),()=>{c.addAssign(8),a.shiftLeftAssign(8)}),re(a.shiftRight(28).equal(0),()=>{c.addAssign(4),a.shiftLeftAssign(4)}),re(a.shiftRight(30).equal(0),()=>{c.addAssign(2),a.shiftLeftAssign(2)}),re(a.shiftRight(31).equal(0),()=>{c.addAssign(1)}),n(c)}).setLayout({name:t,type:e,inputs:[{name:"value",type:e}]})}_createOneBitsBaseLayout(t,e){const n=this._returnDataNode(e);return ot(([i])=>{const a=zt(0);this._resolveElementType(i,a,e),a.assign(a.sub(a.shiftRight(zt(1)).bitAnd(zt(1431655765)))),a.assign(a.bitAnd(zt(858993459)).add(a.shiftRight(zt(2)).bitAnd(zt(858993459))));const c=a.add(a.shiftRight(zt(4))).bitAnd(zt(252645135)).mul(zt(16843009)).shiftRight(zt(24));return n(c)}).setLayout({name:t,type:e,inputs:[{name:"value",type:e}]})}_createMainLayout(t,e,n,s){const i=this._returnDataNode(e);return ot(([c])=>{if(n===1)return i(s(c));{const u=i(0),d=["x","y","z","w"];for(let f=0;f<n;f++){const p=d[f];u[p].assign(s(c[p]))}return u}}).setLayout({name:t,type:e,inputs:[{name:"value",type:e}]})}setup(t){const{method:e,aNode:n}=this,{renderer:s}=t;if(s.backend.isWebGPUBackend)return super.setup(t);const i=this.getInputType(t),a=t.getElementType(i),c=t.getTypeLength(i),u=`${e}_base_${a}`,d=`${e}_${i}`;let f=eg[u];if(f===void 0){switch(e){case vr.COUNT_LEADING_ZEROS:{f=this._createLeadingZerosBaseLayout(u,a);break}case vr.COUNT_TRAILING_ZEROS:{f=this._createTrailingZerosBaseLayout(u,a);break}case vr.COUNT_ONE_BITS:{f=this._createOneBitsBaseLayout(u,a);break}}eg[u]=f}let p=eg[d];return p===void 0&&(p=this._createMainLayout(d,i,c,f),eg[d]=p),ot(()=>p(n))()}}vr.COUNT_TRAILING_ZEROS="countTrailingZeros";vr.COUNT_LEADING_ZEROS="countLeadingZeros";vr.COUNT_ONE_BITS="countOneBits";const QV=kt(vr,vr.COUNT_TRAILING_ZEROS).setParameterLength(1),JV=kt(vr,vr.COUNT_LEADING_ZEROS).setParameterLength(1),tG=kt(vr,vr.COUNT_ONE_BITS).setParameterLength(1),eG=ot(([r])=>{const t=r.toUint().mul(747796405).add(2891336453),e=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return e.shiftRight(22).bitXor(e).toFloat().mul(1/2**32)}),lw=(r,t)=>jr(fe(4,r.mul(Oe(1,r))),t),nG=(r,t)=>r.lessThan(.5)?lw(r.mul(2),t).div(2):Oe(1,lw(fe(Oe(1,r),2),t).div(2)),sG=(r,t,e)=>jr(Nr(jr(r,t),ws(jr(r,t),jr(Oe(1,r),e))),1/t),iG=(r,t)=>Ci(Iy.mul(t.mul(r).sub(1))).div(Iy.mul(t.mul(r).sub(1)));class i_ extends rs{static get type(){return"PackFloatNode"}constructor(t,e){super(),this.vectorNode=e,this.encoding=t,this.isPackFloatNode=!0}getNodeType(){return"uint"}generate(t){const e=this.vectorNode.getNodeType(t);return`${t.getFloatPackingMethod(this.encoding)}(${this.vectorNode.build(t,e)})`}}const rG=kt(i_,"snorm").setParameterLength(1),oG=kt(i_,"unorm").setParameterLength(1),aG=kt(i_,"float16").setParameterLength(1);class r_ extends rs{static get type(){return"UnpackFloatNode"}constructor(t,e){super(),this.uintNode=e,this.encoding=t,this.isUnpackFloatNode=!0}getNodeType(){return"vec2"}generate(t){const e=this.uintNode.getNodeType(t);return`${t.getFloatUnpackingMethod(this.encoding)}(${this.uintNode.build(t,e)})`}}const lG=kt(r_,"snorm").setParameterLength(1),cG=kt(r_,"unorm").setParameterLength(1),uG=kt(r_,"float16").setParameterLength(1),Qa=ot(([r])=>r.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),hG=ot(([r])=>st(Qa(r.z.add(Qa(r.y.mul(1)))),Qa(r.z.add(Qa(r.x.mul(1)))),Qa(r.y.add(Qa(r.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),dG=ot(([r,t,e])=>{const n=st(r).toVar(),s=G(1.4).toVar(),i=G(0).toVar(),a=st(n).toVar();return cn({start:G(0),end:G(3),type:"float",condition:"<="},()=>{const c=st(hG(a.mul(2))).toVar();n.addAssign(c.add(e.mul(G(.1).mul(t)))),a.mulAssign(1.8),s.mulAssign(1.5),n.mulAssign(1.2);const u=G(Qa(n.z.add(Qa(n.x.add(Qa(n.y)))))).toVar();i.addAssign(u.div(s)),a.addAssign(.14)}),i}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class fG extends Jt{static get type(){return"FunctionOverloadingNode"}constructor(t=[],...e){super(),this.functionNodes=t,this.parametersNodes=e,this._candidateFn=null,this.global=!0}getNodeType(t){return this.getCandidateFn(t).shaderNode.layout.type}getCandidateFn(t){const e=this.parametersNodes;let n=this._candidateFn;if(n===null){let s=null,i=-1;for(const a of this.functionNodes){const u=a.shaderNode.layout;if(u===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const d=u.inputs;if(e.length===d.length){let f=0;for(let p=0;p<e.length;p++){const g=e[p],y=d[p];g.getNodeType(t)===y.type&&f++}f>i&&(s=a,i=f)}}this._candidateFn=n=s}return n}setup(t){return this.getCandidateFn(t)(...this.parametersNodes)}}const pG=be(fG),ai=r=>(...t)=>pG(r,...t),Od=te(0).setGroup(ne).onRenderUpdate(r=>r.time),mG=te(0).setGroup(ne).onRenderUpdate(r=>r.deltaTime),QD=te(0,"uint").setGroup(ne).onRenderUpdate(r=>r.frameId),gG=(r=Od)=>r.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),yG=(r=Od)=>r.fract().round(),xG=(r=Od)=>r.add(.5).fract().mul(2).sub(1).abs(),bG=(r=Od)=>r.fract();function SG(r,t=null){return pl(t,{getUV:typeof r=="function"?r:()=>r})}const wG=ot(([r,t,e=Vt(.5)])=>Qp(r.sub(e),t).add(e)),TG=ot(([r,t,e=Vt(.5)])=>{const n=r.sub(e),s=n.dot(n),a=s.mul(s).mul(t);return r.add(n.mul(a))}),_G=ot(({position:r=null,horizontal:t=!0,vertical:e=!1})=>{let n;r!==null?(n=Yr.toVar(),n[3][0]=r.x,n[3][1]=r.y,n[3][2]=r.z):n=Yr;const s=ro.mul(n);return Pp(t)&&(s[0][0]=Yr[0].length(),s[0][1]=0,s[0][2]=0),Pp(e)&&(s[1][0]=0,s[1][1]=Yr[1].length(),s[1][2]=0),s[2][0]=0,s[2][1]=0,s[2][2]=1,ul.mul(s).mul(Wn)}),MG=ot(([r=null])=>{const t=Gy();return Gy($T(r)).sub(t).lessThan(0).select(la,r)}),vG=ot(([r,t=fn(),e=G(0)])=>{const n=r.x,s=r.y,i=e.mod(n.mul(s)).floor(),a=i.mod(n),c=s.sub(i.add(1).div(n).ceil()),u=r.reciprocal(),d=Vt(a,c);return t.add(d).mul(u)}),JD=ot(([r,t=null,e=null,n=G(1),s=Wn,i=sr])=>{let a=i.abs().normalize();a=a.div(a.dot(st(1)));const c=s.yz.mul(n),u=s.zx.mul(n),d=s.xy.mul(n),f=r.value,p=t!==null?t.value:f,g=e!==null?e.value:f,y=qe(f,c).mul(a.x),x=qe(p,u).mul(a.y),S=qe(g,d).mul(a.z);return ws(y,x,S)}),AG=(...r)=>JD(...r),$h=new cc,hu=new V,Xh=new V,KS=new V,If=new ve,ng=new V(0,0,-1),qo=new Ze,Vf=new V,sg=new V,Gf=new Ze,ig=new Ut,Hy=new fl,NG=la.flipX();Hy.depthTexture=new Zr(1,1);let rg=!1;class o_ extends fa{static get type(){return"ReflectorNode"}constructor(t={}){super(t.defaultTexture||Hy.texture,NG),this._reflectorBaseNode=t.reflector||new RG(this,t),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=new o_({defaultTexture:Hy.depthTexture,reflector:this._reflectorBaseNode})}return this._depthNode}setup(t){return t.object.isQuadMesh||this._reflectorBaseNode.build(t),super.setup(t)}clone(){const t=new this.constructor(this.reflectorNode);return t.uvNode=this.uvNode,t.levelNode=this.levelNode,t.biasNode=this.biasNode,t.sampler=this.sampler,t.depthNode=this.depthNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.offsetNode=this.offsetNode,t._reflectorBaseNode=this._reflectorBaseNode,t}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class RG extends Jt{static get type(){return"ReflectorBaseNode"}constructor(t,e={}){super();const{target:n=new On,resolutionScale:s=1,generateMipmaps:i=!1,bounces:a=!0,depth:c=!1,samples:u=0}=e;this.textureNode=t,this.target=n,this.resolutionScale=s,e.resolution!==void 0&&(an('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=e.resolution),this.generateMipmaps=i,this.bounces=a,this.depth=c,this.samples=u,this.updateBeforeType=a?de.RENDER:de.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(t,e){const n=this.resolutionScale;e.getDrawingBufferSize(ig),t.setSize(Math.round(ig.width*n),Math.round(ig.height*n))}setup(t){return this._updateResolution(Hy,t.renderer),super.setup(t)}dispose(){super.dispose();for(const t of this.renderTargets.values())t.dispose()}getVirtualCamera(t){let e=this.virtualCameras.get(t);return e===void 0&&(e=t.clone(),this.virtualCameras.set(t,e)),e}getRenderTarget(t){let e=this.renderTargets.get(t);return e===void 0&&(e=new fl(0,0,{type:ii,samples:this.samples}),this.generateMipmaps===!0&&(e.texture.minFilter=ZF,e.texture.generateMipmaps=!0),this.depth===!0&&(e.depthTexture=new Zr),this.renderTargets.set(t,e)),e}updateBefore(t){if(this.bounces===!1&&rg)return!1;rg=!0;const{scene:e,camera:n,renderer:s,material:i}=t,{target:a}=this,c=this.getVirtualCamera(n),u=this.getRenderTarget(c);s.getDrawingBufferSize(ig),this._updateResolution(u,s),Xh.setFromMatrixPosition(a.matrixWorld),KS.setFromMatrixPosition(n.matrixWorld),If.extractRotation(a.matrixWorld),hu.set(0,0,1),hu.applyMatrix4(If),Vf.subVectors(Xh,KS);const d=Vf.dot(hu)>0;let f=!1;if(d===!0&&this.forceUpdate===!1){if(this.hasOutput===!1){rg=!1;return}f=!0}Vf.reflect(hu).negate(),Vf.add(Xh),If.extractRotation(n.matrixWorld),ng.set(0,0,-1),ng.applyMatrix4(If),ng.add(KS),sg.subVectors(Xh,ng),sg.reflect(hu).negate(),sg.add(Xh),c.coordinateSystem=n.coordinateSystem,c.position.copy(Vf),c.up.set(0,1,0),c.up.applyMatrix4(If),c.up.reflect(hu),c.lookAt(sg),c.near=n.near,c.far=n.far,c.updateMatrixWorld(),c.projectionMatrix.copy(n.projectionMatrix),$h.setFromNormalAndCoplanarPoint(hu,Xh),$h.applyMatrix4(c.matrixWorldInverse),qo.set($h.normal.x,$h.normal.y,$h.normal.z,$h.constant);const p=c.projectionMatrix;Gf.x=(Math.sign(qo.x)+p.elements[8])/p.elements[0],Gf.y=(Math.sign(qo.y)+p.elements[9])/p.elements[5],Gf.z=-1,Gf.w=(1+p.elements[10])/p.elements[14],qo.multiplyScalar(1/qo.dot(Gf));const g=0;p.elements[2]=qo.x,p.elements[6]=qo.y,p.elements[10]=s.coordinateSystem===Jr?qo.z-g:qo.z+1-g,p.elements[14]=qo.w,this.textureNode.value=u.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=u.depthTexture),i.visible=!1;const y=s.getRenderTarget(),x=s.getMRT(),S=s.autoClear;s.setMRT(null),s.setRenderTarget(u),s.autoClear=!0;const T=e.name;e.name=(e.name||"Scene")+" [ Reflector ]",f?(s.clear(),this.hasOutput=!1):(s.render(e,c),this.hasOutput=!0),e.name=T,s.setMRT(x),s.setRenderTarget(y),s.autoClear=S,i.visible=!0,rg=!1,this.forceUpdate=!1}get resolution(){return an('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(t){an('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=t}}const EG=r=>new o_(r),ZS=new qw(-1,1,1,-1,0,1);class CG extends Qe{constructor(t=!1){super();const e=t===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new ge([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ge(e,2))}}const DG=new CG;class Ox extends C{constructor(t=null){super(DG,t),this.camera=ZS,this.isQuadMesh=!0}async renderAsync(t){an('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await t.init(),t.render(this,ZS)}render(t){t.render(this,ZS)}}const BG=new Ut;class LG extends fa{static get type(){return"RTTNode"}constructor(t,e=null,n=null,s={type:ii}){const i=new fl(e,n,s);super(i.texture,fn()),this.isRTTNode=!0,this.node=t,this.width=e,this.height=n,this.pixelRatio=1,this.renderTarget=i,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new Ox(new Xn),this.updateBeforeType=de.RENDER}get autoResize(){return this.width===null}setup(t){return this._rttNode=this.node.context(t.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(t)}setSize(t,e){this.width=t,this.height=e;const n=t*this.pixelRatio,s=e*this.pixelRatio;this.renderTarget.setSize(n,s),this.textureNeedsUpdate=!0}setPixelRatio(t){this.pixelRatio=t,this.setSize(this.width,this.height)}updateBefore({renderer:t}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoResize===!0){const s=t.getPixelRatio(),i=t.getSize(BG),a=Math.floor(i.width*s),c=Math.floor(i.height*s);(a!==this.renderTarget.width||c!==this.renderTarget.height)&&(this.renderTarget.setSize(a,c),this.textureNeedsUpdate=!0)}let e="RTT";this.node.name&&(e=this.node.name+" [ "+e+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=e;const n=t.getRenderTarget();t.setRenderTarget(this.renderTarget),this._quadMesh.render(t),t.setRenderTarget(n)}clone(){const t=new fa(this.value,this.uvNode,this.levelNode);return t.sampler=this.sampler,t.referenceNode=this,t}}const tB=(r,...t)=>new LG(Qt(r),...t),OG=(r,...t)=>r.isSampleNode||r.isTextureNode?r:r.isPassNode?r.getTextureNode():tB(r,...t),rd=ot(([r,t,e],n)=>{let s;n.renderer.coordinateSystem===Jr?(r=Vt(r.x,r.y.oneMinus()).mul(2).sub(1),s=ie(st(r,t),1)):s=ie(st(r.x,r.y.oneMinus(),t).mul(2).sub(1),1);const i=ie(e.mul(s));return i.xyz.div(i.w)}),FG=ot(([r,t])=>{const e=t.mul(ie(r,1)),n=e.xy.div(e.w).mul(.5).add(.5).toVar();return Vt(n.x,n.y.oneMinus())}),UG=ot(([r,t,e])=>{const n=Ac(Qn(t)),s=Cs(r.mul(n)).toVar(),i=Qn(t,s).toVar(),a=Qn(t,s.sub(Cs(2,0))).toVar(),c=Qn(t,s.sub(Cs(1,0))).toVar(),u=Qn(t,s.add(Cs(1,0))).toVar(),d=Qn(t,s.add(Cs(2,0))).toVar(),f=Qn(t,s.add(Cs(0,2))).toVar(),p=Qn(t,s.add(Cs(0,1))).toVar(),g=Qn(t,s.sub(Cs(0,1))).toVar(),y=Qn(t,s.sub(Cs(0,2))).toVar(),x=Mn(Oe(G(2).mul(c).sub(a),i)).toVar(),S=Mn(Oe(G(2).mul(u).sub(d),i)).toVar(),T=Mn(Oe(G(2).mul(p).sub(f),i)).toVar(),M=Mn(Oe(G(2).mul(g).sub(y),i)).toVar(),N=rd(r,i,e).toVar(),v=x.lessThan(S).select(N.sub(rd(r.sub(Vt(G(1).div(n.x),0)),c,e)),N.negate().add(rd(r.add(Vt(G(1).div(n.x),0)),u,e))),A=T.lessThan(M).select(N.sub(rd(r.add(Vt(0,G(1).div(n.y))),p,e)),N.negate().add(rd(r.sub(Vt(0,G(1).div(n.y))),g,e)));return Ji(hl(v,A))}),a_=ot(([r])=>No(G(52.9829189).mul(No(no(r,Vt(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),_o=ot(([r,t,e])=>{const n=G(2.399963229728653),s=Oi(G(r).add(.5).div(G(t))),i=G(r).mul(n).add(e);return Vt(wo(i),Ci(i)).mul(s)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class PG extends Jt{static get type(){return"SampleNode"}constructor(t,e=null){super(),this.callback=t,this.uvNode=e,this.isSampleNode=!0}setup(){return this.sample(fn())}sample(t){return this.callback(t)}}const zG=(r,t=null)=>new PG(r,Qt(t));class Qi extends Jt{static get type(){return"EventNode"}constructor(t,e){super("void"),this.eventType=t,this.callback=e,t===Qi.OBJECT?this.updateType=de.OBJECT:t===Qi.MATERIAL?this.updateType=de.RENDER:t===Qi.BEFORE_OBJECT?this.updateBeforeType=de.OBJECT:t===Qi.BEFORE_MATERIAL&&(this.updateBeforeType=de.RENDER)}update(t){this.callback(t)}updateBefore(t){this.callback(t)}}Qi.OBJECT="object";Qi.MATERIAL="material";Qi.BEFORE_OBJECT="beforeObject";Qi.BEFORE_MATERIAL="beforeMaterial";const Fx=(r,t)=>new Qi(r,t).toStack(),IG=r=>Fx(Qi.OBJECT,r),VG=r=>Fx(Qi.MATERIAL,r),GG=r=>Fx(Qi.BEFORE_OBJECT,r),kG=r=>Fx(Qi.BEFORE_MATERIAL,r);class HG extends Mc{constructor(t,e,n=Float32Array){const s=ArrayBuffer.isView(t)?t:new n(t*e);super(s,e),this.isStorageInstancedBufferAttribute=!0}}class WG extends fs{constructor(t,e,n=Float32Array){const s=ArrayBuffer.isView(t)?t:new n(t*e);super(s,e),this.isStorageBufferAttribute=!0}}const qG=(r,t="float")=>{let e,n;t.isStruct===!0?(e=t.layout.getLength(),n=By("float")):(e=bC(t),n=By(t));const s=new WG(r,e,n);return Nc(s,t,r)},$G=(r,t="float")=>{let e,n;t.isStruct===!0?(e=t.layout.getLength(),n=By("float")):(e=bC(t),n=By(t));const s=new HG(r,e,n);return Nc(s,t,s.count)};class XG extends Jt{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const jG=$t(XG),kf=new tr,QS=new ve,eB=te(0).setGroup(ne).onRenderUpdate(({scene:r})=>r.backgroundBlurriness),cw=te(1).setGroup(ne).onRenderUpdate(({scene:r})=>r.backgroundIntensity),nB=te(new ve).setGroup(ne).onRenderUpdate(({scene:r})=>{const t=r.background;return t!==null&&t.isTexture&&t.mapping!==vw?(kf.copy(r.backgroundRotation),kf.x*=-1,kf.y*=-1,kf.z*=-1,QS.makeRotationFromEuler(kf)):QS.identity(),QS});class YG extends fa{static get type(){return"StorageTextureNode"}constructor(t,e,n=null){super(t,e),this.storeNode=n,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=ri.WRITE_ONLY}getInputType(){return"storageTexture"}setup(t){super.setup(t);const e=t.getNodeProperties(this);return e.storeNode=this.storeNode,e}setAccess(t){return this.access=t,this}setMipLevel(t){return this.mipLevel=t,this}generate(t,e){let n;return this.storeNode!==null?n=this.generateStore(t):n=super.generate(t,e),n}toReadWrite(){return this.setAccess(ri.READ_WRITE)}toReadOnly(){return this.setAccess(ri.READ_ONLY)}toWriteOnly(){return this.setAccess(ri.WRITE_ONLY)}generateStore(t){const e=t.getNodeProperties(this),{uvNode:n,storeNode:s,depthNode:i}=e,a=super.generate(t,"property"),c=n.build(t,this.value.is3DTexture===!0?"uvec3":"uvec2"),u=s.build(t,"vec4"),d=i?i.build(t,"int"):null,f=t.generateTextureStore(t,a,c,d,u);t.addLineFlowCode(f,this)}clone(){const t=super.clone();return t.storeNode=this.storeNode,t.mipLevel=this.mipLevel,t.access=this.access,t}}const sB=be(YG).setParameterLength(1,3),KG=(r,t,e)=>{let n;return r.isStorageTextureNode===!0?(n=r.clone(),n.uvNode=t,n.storeNode=e):n=sB(r,t,e),e!==null&&n.toStack(),n},ZG=ot(({texture:r,uv:t})=>{const n=st().toVar();return re(t.x.lessThan(1e-4),()=>{n.assign(st(1,0,0))}).ElseIf(t.y.lessThan(1e-4),()=>{n.assign(st(0,1,0))}).ElseIf(t.z.lessThan(1e-4),()=>{n.assign(st(0,0,1))}).ElseIf(t.x.greaterThan(1-1e-4),()=>{n.assign(st(-1,0,0))}).ElseIf(t.y.greaterThan(1-1e-4),()=>{n.assign(st(0,-1,0))}).ElseIf(t.z.greaterThan(1-1e-4),()=>{n.assign(st(0,0,-1))}).Else(()=>{const i=r.sample(t.add(st(-.01,0,0))).r.sub(r.sample(t.add(st(.01,0,0))).r),a=r.sample(t.add(st(0,-.01,0))).r.sub(r.sample(t.add(st(0,.01,0))).r),c=r.sample(t.add(st(0,0,-.01))).r.sub(r.sample(t.add(st(0,0,.01))).r);n.assign(st(i,a,c))}),n.normalize()});class QG extends fa{static get type(){return"Texture3DNode"}constructor(t,e=null,n=null){super(t,e,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return st(.5,.5,.5)}setUpdateMatrix(){}generateUV(t,e){return e.build(t,this.sampler===!0?"vec3":"ivec3")}generateOffset(t,e){return e.build(t,"ivec3")}normal(t){return ZG({texture:this,uv:t})}}const Ux=be(QG).setParameterLength(1,3),JG=(...r)=>Ux(...r).setSampler(!1),tk=(r,t,e)=>Ux(r,t).level(e);class ek extends vx{static get type(){return"UserDataNode"}constructor(t,e,n=null){super(t,e,n),this.userData=n}updateReference(t){return this.reference=this.userData!==null?this.userData:t.object.userData,this.reference}}const nk=(r,t,e)=>new ek(r,t,e),VR=new WeakMap;class sk extends rs{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=de.OBJECT,this.updateAfterType=de.OBJECT,this.previousModelWorldMatrix=te(new ve),this.previousProjectionMatrix=te(new ve).setGroup(ne),this.previousCameraViewMatrix=te(new ve)}setProjectionMatrix(t){this.projectionMatrix=t}update({frameId:t,camera:e,object:n}){const s=GR(n);this.previousModelWorldMatrix.value.copy(s);const i=iB(e);i.frameId!==t&&(i.frameId=t,i.previousProjectionMatrix===void 0?(i.previousProjectionMatrix=new ve,i.previousCameraViewMatrix=new ve,i.currentProjectionMatrix=new ve,i.currentCameraViewMatrix=new ve,i.previousProjectionMatrix.copy(this.projectionMatrix||e.projectionMatrix),i.previousCameraViewMatrix.copy(e.matrixWorldInverse)):(i.previousProjectionMatrix.copy(i.currentProjectionMatrix),i.previousCameraViewMatrix.copy(i.currentCameraViewMatrix)),i.currentProjectionMatrix.copy(this.projectionMatrix||e.projectionMatrix),i.currentCameraViewMatrix.copy(e.matrixWorldInverse),this.previousProjectionMatrix.value.copy(i.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(i.previousCameraViewMatrix))}updateAfter({object:t}){GR(t).copy(t.matrixWorld)}setup(){const t=this.projectionMatrix===null?ul:te(this.projectionMatrix),e=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),n=t.mul(zc).mul(Wn),s=this.previousProjectionMatrix.mul(e).mul(Nd),i=n.xy.div(n.w),a=s.xy.div(s.w);return Oe(i,a)}}function iB(r){let t=VR.get(r);return t===void 0&&(t={},VR.set(r,t)),t}function GR(r,t=0){const e=iB(r);let n=e[t];return n===void 0&&(e[t]=n=new ve,e[t].copy(r.matrixWorld)),n}const ik=$t(sk),rk=ot(([r])=>l_(r.rgb)),ok=ot(([r,t=G(1)])=>t.mix(l_(r.rgb),r.rgb)),ak=ot(([r,t=G(1)])=>{const e=ws(r.r,r.g,r.b).div(3),n=r.r.max(r.g.max(r.b)),s=n.sub(e).mul(t).mul(-3);return Be(r.rgb,n,s)}),lk=ot(([r,t=G(1)])=>{const e=st(.57735,.57735,.57735),n=t.cos();return st(r.rgb.mul(n).add(e.cross(r.rgb).mul(t.sin()).add(e.mul(no(e,r.rgb).mul(n.oneMinus())))))}),l_=(r,t=st(Xe.getLuminanceCoefficients(new V)))=>no(r,t),ck=ot(([r,t=st(1),e=st(0),n=st(1),s=G(1),i=st(Xe.getLuminanceCoefficients(new V,Ay))])=>{const a=r.rgb.dot(st(i)),c=$n(r.rgb.mul(t).add(e),0).toVar(),u=c.pow(n).toVar();return re(c.r.greaterThan(0),()=>{c.r.assign(u.r)}),re(c.g.greaterThan(0),()=>{c.g.assign(u.g)}),re(c.b.greaterThan(0),()=>{c.b.assign(u.b)}),c.assign(a.add(c.sub(a).mul(s))),ie(c.rgb,r.a)}),uk=ot(([r,t])=>r.mul(t).floor().div(t));let og=null;class hk extends Ex{static get type(){return"ViewportSharedTextureNode"}constructor(t=la,e=null){og===null&&(og=new Fw),super(t,e,og)}getTextureForReference(){return og}updateReference(){return this}}const dk=be(hk).setParameterLength(0,2),ag=new Ut;class rB extends fa{static get type(){return"PassTextureNode"}constructor(t,e){super(e),this.passNode=t,this.isPassTextureNode=!0,this.setUpdateMatrix(!1)}setup(t){const e=t.getNodeProperties(this);return e.passNode=this.passNode,super.setup(t)}clone(){return new this.constructor(this.passNode,this.value)}}class kR extends rB{static get type(){return"PassMultipleTextureNode"}constructor(t,e,n=!1){super(t,null),this.textureName=e,this.previousTexture=n,this.isPassMultipleTextureNode=!0}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(t){return this.updateTexture(),super.setup(t)}clone(){const t=new this.constructor(this.passNode,this.textureName,this.previousTexture);return t.uvNode=this.uvNode,t.levelNode=this.levelNode,t.biasNode=this.biasNode,t.sampler=this.sampler,t.depthNode=this.depthNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.offsetNode=this.offsetNode,t}}class pa extends rs{static get type(){return"PassNode"}constructor(t,e,n,s={}){super("vec4"),this.scope=t,this.scene=e,this.camera=n,this.options=s,this._pixelRatio=1,this._width=1,this._height=1;const i=new Zr;i.isRenderTargetTexture=!0,i.name="depth";const a=new fl(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:ii,...s});a.texture.name="output",a.depthTexture=i,this.renderTarget=a,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:a.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=te(0),this._cameraFar=te(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=de.FRAME,this.global=!0}setResolutionScale(t){return this._resolutionScale=t,this}getResolutionScale(){return this._resolutionScale}setResolution(t){return Wt("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(t)}getResolution(){return Wt("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(t){return this._layers=t,this}getLayers(){return this._layers}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}getTexture(t){let e=this._textures[t];return e===void 0&&(e=this.renderTarget.texture.clone(),e.name=t,this._textures[t]=e,this.renderTarget.textures.push(e)),e}getPreviousTexture(t){let e=this._previousTextures[t];return e===void 0&&(e=this.getTexture(t).clone(),this._previousTextures[t]=e),e}toggleTexture(t){const e=this._previousTextures[t];if(e!==void 0){const n=this._textures[t],s=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[s]=e,this._textures[t]=e,this._previousTextures[t]=n,this._textureNodes[t].updateTexture(),this._previousTextureNodes[t].updateTexture()}}getTextureNode(t="output"){let e=this._textureNodes[t];return e===void 0&&(e=new kR(this,t),e.updateTexture(),this._textureNodes[t]=e),e}getPreviousTextureNode(t="output"){let e=this._previousTextureNodes[t];return e===void 0&&(this._textureNodes[t]===void 0&&this.getTextureNode(t),e=new kR(this,t,!0),e.updateTexture(),this._previousTextureNodes[t]=e),e}getViewZNode(t="depth"){let e=this._viewZNodes[t];if(e===void 0){const n=this._cameraNear,s=this._cameraFar;this._viewZNodes[t]=e=jT(this.getTextureNode(t),n,s)}return e}getLinearDepthNode(t="depth"){let e=this._linearDepthNodes[t];if(e===void 0){const n=this._cameraNear,s=this._cameraFar,i=this.getViewZNode(t);this._linearDepthNodes[t]=e=yd(i,n,s)}return e}async compileAsync(t){const e=t.getRenderTarget(),n=t.getMRT();t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),await t.compileAsync(this.scene,this.camera),t.setRenderTarget(e),t.setMRT(n)}setup({renderer:t}){return this.renderTarget.samples=this.options.samples===void 0?t.samples:this.options.samples,this.renderTarget.texture.type=t.getOutputBufferType(),this.scope===pa.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(t){const{renderer:e}=t,{scene:n}=this;let s,i;const a=e.getOutputRenderTarget();a&&a.isXRRenderTarget===!0?(i=1,s=e.xr.getCamera(),e.xr.updateCamera(s),ag.set(a.width,a.height)):(s=this.camera,i=e.getPixelRatio(),e.getSize(ag)),this._pixelRatio=i,this.setSize(ag.width,ag.height);const c=e.getRenderTarget(),u=e.getMRT(),d=e.autoClear,f=e.transparent,p=e.opaque,g=s.layers.mask,y=e.contextNode,x=n.overrideMaterial;this._cameraNear.value=s.near,this._cameraFar.value=s.far,this._layers!==null&&(s.layers.mask=this._layers.mask);for(const T in this._previousTextures)this.toggleTexture(T);this.overrideMaterial!==null&&(n.overrideMaterial=this.overrideMaterial),e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),e.autoClear=!0,e.transparent=this.transparent,e.opaque=this.opaque,this.contextNode!==null&&((this._contextNodeCache===null||this._contextNodeCache.version!==this.version)&&(this._contextNodeCache={version:this.version,context:pl({...e.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),e.contextNode=this._contextNodeCache.context);const S=n.name;n.name=this.name?this.name:n.name,e.render(n,s),n.name=S,n.overrideMaterial=x,e.setRenderTarget(c),e.setMRT(u),e.autoClear=d,e.transparent=f,e.opaque=p,e.contextNode=y,s.layers.mask=g}setSize(t,e){this._width=t,this._height=e;const n=Math.floor(this._width*this._pixelRatio*this._resolutionScale),s=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(n,s),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(t,e,n,s){t===null?this._scissor=null:(this._scissor===null&&(this._scissor=new Ze),t.isVector4?this._scissor.copy(t):this._scissor.set(t,e,n,s),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(t,e,n,s){t===null?this._viewport=null:(this._viewport===null&&(this._viewport=new Ze),t.isVector4?this._viewport.copy(t):this._viewport.set(t,e,n,s),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}pa.COLOR="color";pa.DEPTH="depth";const fk=(r,t,e)=>new pa(pa.COLOR,r,t,e),pk=(r,t)=>new rB(r,t),mk=(r,t,e)=>new pa(pa.DEPTH,r,t,e);class gk extends pa{static get type(){return"ToonOutlinePassNode"}constructor(t,e,n,s,i){super(pa.COLOR,t,e),this.colorNode=n,this.thicknessNode=s,this.alphaNode=i,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(t){const{renderer:e}=t,n=e.getRenderObjectFunction();e.setRenderObjectFunction((s,i,a,c,u,d,f,p)=>{if((u.isMeshToonMaterial||u.isMeshToonNodeMaterial)&&u.wireframe===!1){const g=this._getOutlineMaterial(u);e.renderObject(s,i,a,c,g,d,f,p)}e.renderObject(s,i,a,c,u,d,f,p)}),super.updateBefore(t),e.setRenderObjectFunction(n)}_createMaterial(){const t=new Xn;t.isMeshToonOutlineMaterial=!0,t.name="Toon_Outline",t.side=Ss;const e=sr.negate(),n=ul.mul(zc),s=G(1),i=n.mul(ie(Wn,1)),a=n.mul(ie(Wn.add(e),1)),c=Ji(i.sub(a));return t.vertexNode=i.add(c.mul(this.thicknessNode).mul(i.w).mul(s)),t.colorNode=ie(this.colorNode,this.alphaNode),t}_getOutlineMaterial(t){let e=this._materialCache.get(t);return e===void 0&&(e=this._createMaterial(),this._materialCache.set(t,e)),e}}const yk=(r,t,e=new Xt(0,0,0),n=.003,s=1)=>new gk(r,t,Qt(e),Qt(n),Qt(s)),oB=ot(([r,t])=>r.mul(t).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),aB=ot(([r,t])=>(r=r.mul(t),r.div(r.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),lB=ot(([r,t])=>{r=r.mul(t),r=r.sub(.004).max(0);const e=r.mul(r.mul(6.2).add(.5)),n=r.mul(r.mul(6.2).add(1.7)).add(.06);return e.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),xk=ot(([r])=>{const t=r.mul(r.add(.0245786)).sub(90537e-9),e=r.mul(r.add(.432951).mul(.983729)).add(.238081);return t.div(e)}),cB=ot(([r,t])=>{const e=qs(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=qs(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return r=r.mul(t).div(.6),r=e.mul(r),r=xk(r),r=n.mul(r),r.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),bk=qs(st(1.6605,-.1246,-.0182),st(-.5876,1.1329,-.1006),st(-.0728,-.0083,1.1187)),Sk=qs(st(.6274,.0691,.0164),st(.3293,.9195,.088),st(.0433,.0113,.8956)),wk=ot(([r])=>{const t=st(r).toVar(),e=st(t.mul(t)).toVar(),n=st(e.mul(e)).toVar();return G(15.5).mul(n.mul(e)).sub(fe(40.14,n.mul(t))).add(fe(31.96,n).sub(fe(6.868,e.mul(t))).add(fe(.4298,e).add(fe(.1191,t).sub(.00232))))}),uB=ot(([r,t])=>{const e=st(r).toVar(),n=qs(st(.856627153315983,.137318972929847,.11189821299995),st(.0951212405381588,.761241990602591,.0767994186031903),st(.0482516061458583,.101439036467562,.811302368396859)),s=qs(st(1.1271005818144368,-.1413297634984383,-.14132976349843826),st(-.11060664309660323,1.157823702216272,-.11060664309660294),st(-.016493938717834573,-.016493938717834257,1.2519364065950405)),i=G(-12.47393),a=G(4.026069);return e.mulAssign(t),e.assign(Sk.mul(e)),e.assign(n.mul(e)),e.assign($n(e,1e-10)),e.assign(ra(e)),e.assign(e.sub(i).div(a.sub(i))),e.assign(Ro(e,0,1)),e.assign(wk(e)),e.assign(s.mul(e)),e.assign(jr($n(st(0),e),st(2.2))),e.assign(bk.mul(e)),e.assign(Ro(e,0,1)),e}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),hB=ot(([r,t])=>{const e=G(.76),n=G(.15);r=r.mul(t);const s=nr(r.r,nr(r.g,r.b)),i=bi(s.lessThan(.08),s.sub(fe(6.25,s.mul(s))),.04);r.subAssign(i);const a=$n(r.r,$n(r.g,r.b));re(a.lessThan(e),()=>r);const c=Oe(1,e),u=Oe(1,c.mul(c).div(a.add(c.sub(e))));r.mulAssign(u.div(a));const d=Oe(1,Nr(1,n.mul(a.sub(u)).add(1)));return Be(r,st(u),d)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Us extends Jt{static get type(){return"CodeNode"}constructor(t="",e=[],n=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=t,this.includes=e,this.language=n}setIncludes(t){return this.includes=t,this}getIncludes(){return this.includes}generate(t){const e=this.getIncludes(t);for(const s of e)s.build(t);const n=t.getCodeFromNode(this,this.getNodeType(t));return n.code=this.code,n.code}serialize(t){super.serialize(t),t.code=this.code,t.language=this.language}deserialize(t){super.deserialize(t),this.code=t.code,this.language=t.language}}const Px=be(Us).setParameterLength(1,3),Tk=(r,t)=>Px(r,t,"js"),_k=(r,t)=>Px(r,t,"wgsl"),Mk=(r,t)=>Px(r,t,"glsl");class dB extends Us{static get type(){return"FunctionNode"}constructor(t="",e=[],n=""){super(t,e,n)}getNodeType(t){return this.getNodeFunction(t).type}getMemberType(t,e){const n=this.getNodeType(t);return t.getStructTypeNode(n).getMemberType(t,e)}getInputs(t){return this.getNodeFunction(t).inputs}getNodeFunction(t){const e=t.getDataFromNode(this);let n=e.nodeFunction;return n===void 0&&(n=t.parser.parseFunction(this.code),e.nodeFunction=n),n}generate(t,e){super.generate(t);const n=this.getNodeFunction(t),s=n.name,i=n.type,a=t.getCodeFromNode(this,i);s!==""&&(a.name=s);const c=t.getPropertyName(a),u=this.getNodeFunction(t).getCode(c);return a.code=u+`
`,e==="property"?c:t.format(`${c}()`,i,e)}}const fB=(r,t=[],e="")=>{for(let i=0;i<t.length;i++){const a=t[i];typeof a=="function"&&(t[i]=a.functionNode)}const n=new dB(r,t,e),s=(...i)=>n.call(...i);return s.functionNode=n,s},vk=(r,t)=>fB(r,t,"glsl"),Ak=(r,t)=>fB(r,t,"wgsl");function c_(r){let t;const e=r.context.getViewZ;return e!==void 0&&(t=e(this)),(t||ds.z).negate()}const pB=ot(([r,t],e)=>{const n=c_(e);return Eo(r,t,n)}),mB=ot(([r],t)=>{const e=c_(t);return r.mul(r,e,e).negate().exp().oneMinus()}),Nk=ot(([r,t],e)=>{const n=c_(e),i=t.sub(ca.y).max(0).toConst().mul(n).toConst();return r.mul(r,i,i).negate().exp().oneMinus()}),uw=ot(([r,t])=>ie(t.toFloat().mix(md.rgb,r.toVec3()),md.a));let du=null,fu=null;class Rk extends Jt{static get type(){return"RangeNode"}constructor(t=G(),e=G()){super(),this.minNode=t,this.maxNode=e}getVectorLength(t){const e=this.getConstNode(this.minNode),n=this.getConstNode(this.maxNode),s=t.getTypeLength(xc(e.value)),i=t.getTypeLength(xc(n.value));return s>i?s:i}getNodeType(t){return t.object.count>1?t.getTypeFromLength(this.getVectorLength(t)):"float"}getConstNode(t){let e=null;if(t.traverse(n=>{n.isConstNode===!0&&(e=n)}),e===null)throw new t4('THREE.TSL: No "ConstNode" found in node graph.',this.stackTrace);return e}setup(t){const e=t.object;let n=null;if(e.count>1){const s=this.getConstNode(this.minNode),i=this.getConstNode(this.maxNode),a=s.value,c=i.value,u=t.getTypeLength(xc(a)),d=t.getTypeLength(xc(c));du=du||new Ze,fu=fu||new Ze,du.setScalar(0),fu.setScalar(0),u===1?du.setScalar(a):a.isColor?du.set(a.r,a.g,a.b,1):du.set(a.x,a.y,a.z||0,a.w||0),d===1?fu.setScalar(c):c.isColor?fu.set(c.r,c.g,c.b,1):fu.set(c.x,c.y,c.z||0,c.w||0);const f=4,p=f*e.count,g=new Float32Array(p);for(let S=0;S<p;S++){const T=S%f,M=du.getComponent(T),N=fu.getComponent(T);g[S]=St.lerp(M,N,Math.random())}const y=this.getNodeType(t);if(e.count*4*4<=t.getUniformBufferLimit())n=Kp(g,"vec4",e.count).element(ua).convert(y);else{const S=new Mc(g,4);t.geometry.setAttribute("__range"+this.id,S),n=Vy(S).convert(y)}}else n=G(0);return n}}const Ek=be(Rk).setParameterLength(2);class Ck extends Jt{static get type(){return"ComputeBuiltinNode"}constructor(t,e){super(e),this._builtinName=t}getHash(t){return this.getBuiltinName(t)}getNodeType(){return this.nodeType}setBuiltinName(t){return this._builtinName=t,this}getBuiltinName(){return this._builtinName}hasBuiltin(t){return t.hasBuiltin(this._builtinName)}generate(t,e){const n=this.getBuiltinName(t),s=this.getNodeType(t);return t.shaderStage==="compute"?t.format(n,s,e):(Wt(`ComputeBuiltinNode: Compute built-in value ${n} can not be accessed in the ${t.shaderStage} stage`),t.generateConst(s))}serialize(t){super.serialize(t),t.global=this.global,t._builtinName=this._builtinName}deserialize(t){super.deserialize(t),this.global=t.global,this._builtinName=t._builtinName}}const t0=(r,t)=>new Ck(r,t),Dk=t0("numWorkgroups","uvec3"),Bk=t0("workgroupId","uvec3"),Lk=t0("globalId","uvec3"),Ok=t0("localId","uvec3"),Fk=t0("subgroupSize","uint");class Uk extends Jt{constructor(t){super(),this.scope=t}generate(t){const{scope:e}=this,{renderer:n}=t;n.backend.isWebGLBackend===!0?t.addFlowCode(`	// ${e}Barrier 
`):t.addLineFlowCode(`${e}Barrier()`,this)}}const u_=be(Uk),Pk=()=>u_("workgroup").toStack(),zk=()=>u_("storage").toStack(),Ik=()=>u_("texture").toStack();class Vk extends $u{constructor(t,e){super(t,e),this.isWorkgroupInfoElementNode=!0}generate(t,e){let n;const s=t.context.assign;if(n=super.generate(t),s!==!0){const i=this.getNodeType(t);n=t.format(n,i,e)}return n}}class Gk extends Jt{constructor(t,e,n=0){super(e),this.bufferType=e,this.bufferCount=n,this.isWorkgroupInfoNode=!0,this.elementType=e,this.scope=t,this.name=""}setName(t){return this.name=t,this}label(t){return Wt('TSL: "label()" has been deprecated. Use "setName()" instead.',new ps),this.setName(t)}setScope(t){return this.scope=t,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(t){return new Vk(this,t)}generate(t){const e=this.name!==""?this.name:`${this.scope}Array_${this.id}`;return t.getScopedArray(e,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const kk=(r,t)=>new Gk("Workgroup",r,t);class zs extends Jt{static get type(){return"AtomicFunctionNode"}constructor(t,e,n){super("uint"),this.method=t,this.pointerNode=e,this.valueNode=n,this.parents=!0}getInputType(t){return this.pointerNode.getNodeType(t)}getNodeType(t){return this.getInputType(t)}generate(t){const e=t.getNodeProperties(this),n=e.parents,s=this.method,i=this.getNodeType(t),a=this.getInputType(t),c=this.pointerNode,u=this.valueNode,d=[];d.push(`&${c.build(t,a)}`),u!==null&&d.push(u.build(t,a));const f=`${t.getMethod(s,i)}( ${d.join(", ")} )`;if(n?n.length===1&&n[0].isStackNode===!0:!1)t.addLineFlowCode(f,this);else return e.constNode===void 0&&(e.constNode=vo(f,i).toConst()),e.constNode.build(t)}}zs.ATOMIC_LOAD="atomicLoad";zs.ATOMIC_STORE="atomicStore";zs.ATOMIC_ADD="atomicAdd";zs.ATOMIC_SUB="atomicSub";zs.ATOMIC_MAX="atomicMax";zs.ATOMIC_MIN="atomicMin";zs.ATOMIC_AND="atomicAnd";zs.ATOMIC_OR="atomicOr";zs.ATOMIC_XOR="atomicXor";const Hk=be(zs),xa=(r,t,e)=>Hk(r,t,e).toStack(),Wk=r=>xa(zs.ATOMIC_LOAD,r,null),qk=(r,t)=>xa(zs.ATOMIC_STORE,r,t),$k=(r,t)=>xa(zs.ATOMIC_ADD,r,t),Xk=(r,t)=>xa(zs.ATOMIC_SUB,r,t),jk=(r,t)=>xa(zs.ATOMIC_MAX,r,t),Yk=(r,t)=>xa(zs.ATOMIC_MIN,r,t),Kk=(r,t)=>xa(zs.ATOMIC_AND,r,t),Zk=(r,t)=>xa(zs.ATOMIC_OR,r,t),Qk=(r,t)=>xa(zs.ATOMIC_XOR,r,t);class Yt extends rs{static get type(){return"SubgroupFunctionNode"}constructor(t,e=null,n=null){super(),this.method=t,this.aNode=e,this.bNode=n}getInputType(t){const e=this.aNode?this.aNode.getNodeType(t):null,n=this.bNode?this.bNode.getNodeType(t):null,s=t.isMatrix(e)?0:t.getTypeLength(e),i=t.isMatrix(n)?0:t.getTypeLength(n);return s>i?e:n}getNodeType(t){const e=this.method;return e===Yt.SUBGROUP_ELECT?"bool":e===Yt.SUBGROUP_BALLOT?"uvec4":this.getInputType(t)}generate(t,e){const n=this.method,s=this.getNodeType(t),i=this.getInputType(t),a=this.aNode,c=this.bNode,u=[];if(n===Yt.SUBGROUP_BROADCAST||n===Yt.SUBGROUP_SHUFFLE||n===Yt.QUAD_BROADCAST){const f=c.getNodeType(t);u.push(a.build(t,s),c.build(t,f==="float"?"int":s))}else n===Yt.SUBGROUP_SHUFFLE_XOR||n===Yt.SUBGROUP_SHUFFLE_DOWN||n===Yt.SUBGROUP_SHUFFLE_UP?u.push(a.build(t,s),c.build(t,"uint")):(a!==null&&u.push(a.build(t,i)),c!==null&&u.push(c.build(t,i)));const d=u.length===0?"()":`( ${u.join(", ")} )`;return t.format(`${t.getMethod(n,s)}${d}`,s,e)}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}Yt.SUBGROUP_ELECT="subgroupElect";Yt.SUBGROUP_BALLOT="subgroupBallot";Yt.SUBGROUP_ADD="subgroupAdd";Yt.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";Yt.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";Yt.SUBGROUP_MUL="subgroupMul";Yt.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";Yt.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";Yt.SUBGROUP_AND="subgroupAnd";Yt.SUBGROUP_OR="subgroupOr";Yt.SUBGROUP_XOR="subgroupXor";Yt.SUBGROUP_MIN="subgroupMin";Yt.SUBGROUP_MAX="subgroupMax";Yt.SUBGROUP_ALL="subgroupAll";Yt.SUBGROUP_ANY="subgroupAny";Yt.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";Yt.QUAD_SWAP_X="quadSwapX";Yt.QUAD_SWAP_Y="quadSwapY";Yt.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";Yt.SUBGROUP_BROADCAST="subgroupBroadcast";Yt.SUBGROUP_SHUFFLE="subgroupShuffle";Yt.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";Yt.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";Yt.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";Yt.QUAD_BROADCAST="quadBroadcast";const Jk=kt(Yt,Yt.SUBGROUP_ELECT).setParameterLength(0),t9=kt(Yt,Yt.SUBGROUP_BALLOT).setParameterLength(1),e9=kt(Yt,Yt.SUBGROUP_ADD).setParameterLength(1),n9=kt(Yt,Yt.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),s9=kt(Yt,Yt.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),i9=kt(Yt,Yt.SUBGROUP_MUL).setParameterLength(1),r9=kt(Yt,Yt.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),o9=kt(Yt,Yt.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),a9=kt(Yt,Yt.SUBGROUP_AND).setParameterLength(1),l9=kt(Yt,Yt.SUBGROUP_OR).setParameterLength(1),c9=kt(Yt,Yt.SUBGROUP_XOR).setParameterLength(1),u9=kt(Yt,Yt.SUBGROUP_MIN).setParameterLength(1),h9=kt(Yt,Yt.SUBGROUP_MAX).setParameterLength(1),d9=kt(Yt,Yt.SUBGROUP_ALL).setParameterLength(0),f9=kt(Yt,Yt.SUBGROUP_ANY).setParameterLength(0),p9=kt(Yt,Yt.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),m9=kt(Yt,Yt.QUAD_SWAP_X).setParameterLength(1),g9=kt(Yt,Yt.QUAD_SWAP_Y).setParameterLength(1),y9=kt(Yt,Yt.QUAD_SWAP_DIAGONAL).setParameterLength(1),x9=kt(Yt,Yt.SUBGROUP_BROADCAST).setParameterLength(2),b9=kt(Yt,Yt.SUBGROUP_SHUFFLE).setParameterLength(2),S9=kt(Yt,Yt.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),w9=kt(Yt,Yt.SUBGROUP_SHUFFLE_UP).setParameterLength(2),T9=kt(Yt,Yt.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),_9=kt(Yt,Yt.QUAD_BROADCAST).setParameterLength(1);let lg;function zx(r){lg=lg||new WeakMap;let t=lg.get(r);return t===void 0&&lg.set(r,t={}),t}function Ix(r){const t=zx(r);return t.shadowMatrix||(t.shadowMatrix=te("mat4").setGroup(ne).onRenderUpdate(e=>((r.castShadow!==!0||e.renderer.shadowMap.enabled===!1)&&(r.shadow.camera.coordinateSystem!==e.camera.coordinateSystem&&(r.shadow.camera.coordinateSystem=e.camera.coordinateSystem,r.shadow.camera.updateProjectionMatrix()),r.shadow.updateMatrices(r)),r.shadow.matrix)))}function gB(r,t=ca){const e=Ix(r).mul(t);return e.xyz.div(e.w)}function h_(r){const t=zx(r);return t.position||(t.position=te(new V).setGroup(ne).onRenderUpdate((e,n)=>n.value.setFromMatrixPosition(r.matrixWorld)))}function yB(r){const t=zx(r);return t.targetPosition||(t.targetPosition=te(new V).setGroup(ne).onRenderUpdate((e,n)=>n.value.setFromMatrixPosition(r.target.matrixWorld)))}function d_(r){const t=zx(r);return t.viewPosition||(t.viewPosition=te(new V).setGroup(ne).onRenderUpdate(({camera:e},n)=>{n.value=n.value||new V,n.value.setFromMatrixPosition(r.matrixWorld),n.value.applyMatrix4(e.matrixWorldInverse)}))}const f_=r=>ro.transformDirection(h_(r).sub(yB(r))),M9=r=>r.sort((t,e)=>t.id-e.id),v9=(r,t)=>{for(const e of t)if(e.isAnalyticLightNode&&e.light.id===r)return e;return null},JS=new WeakMap,Hf=[];class p_ extends Jt{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=cl("vec3","totalDiffuse"),this.totalSpecularNode=cl("vec3","totalSpecular"),this.outgoingLightNode=cl("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const t=this._lights;for(let n=0;n<t.length;n++){const s=t[n];if(Hf.push(s.id),Hf.push(s.castShadow?1:0),s.isSpotLight===!0){const i=s.map!==null?s.map.id:-1,a=s.colorNode?s.colorNode.getCacheKey():-1;Hf.push(i,a)}}const e=Xp(Hf);return Hf.length=0,e}getHash(t){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(t);const e=[];for(const n of this._lightNodes)e.push(n.getHash());this._lightNodesHash="lights-"+e.join(",")}return this._lightNodesHash}analyze(t){const e=t.getNodeProperties(this);for(const n of e.nodes)n.build(t);e.outputNode.build(t)}setupLightsNode(t){const e=[],n=this._lightNodes,s=M9(this._lights),i=t.renderer.library;for(const a of s)if(a.isNode)e.push(Qt(a));else{let c=null;if(n!==null&&(c=v9(a.id,n)),c===null){const u=i.getLightNodeClass(a.constructor);if(u===null){Wt(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let d=null;JS.has(a)?d=JS.get(a):(d=new u(a),JS.set(a,d)),e.push(d)}}this._lightNodes=e}setupDirectLight(t,e,n){const{lightingModel:s,reflectedLight:i}=t.context;s.direct({...n,lightNode:e,reflectedLight:i},t)}setupDirectRectAreaLight(t,e,n){const{lightingModel:s,reflectedLight:i}=t.context;s.directRectArea({...n,lightNode:e,reflectedLight:i},t)}setupLights(t,e){for(const n of e)n.build(t)}getLightNodes(t){return this._lightNodes===null&&this.setupLightsNode(t),this._lightNodes}setup(t){const e=t.lightsNode;t.lightsNode=this;let n=this.outgoingLightNode;const s=t.context,i=s.lightingModel,a=t.getNodeProperties(this);if(i){const{totalDiffuseNode:c,totalSpecularNode:u}=this;s.outgoingLight=n;const d=t.addStack();a.nodes=d.nodes,i.start(t);const{backdrop:f,backdropAlpha:p}=s,{directDiffuse:g,directSpecular:y,indirectDiffuse:x,indirectSpecular:S}=s.reflectedLight;let T=g.add(x);f!==null&&(p!==null?T=st(p.mix(T,f)):T=st(f)),c.assign(T),u.assign(y.add(S)),n.assign(c.add(u)),i.finish(t),n=n.bypass(t.removeStack())}else a.nodes=[];return t.lightsNode=e,n}setLights(t){return this._lights=t,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const A9=(r=[])=>new p_().setLights(r);class N9 extends Jt{static get type(){return"ShadowBaseNode"}constructor(t){super(),this.light=t,this.updateBeforeType=de.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:t,material:e}){m_.assign(e.receivedShadowPositionNode||t.shadowPositionWorld||ca)}}const m_=cl("vec3","shadowPositionWorld");function R9(r,t={}){return t.toneMapping=r.toneMapping,t.toneMappingExposure=r.toneMappingExposure,t.outputColorSpace=r.outputColorSpace,t.renderTarget=r.getRenderTarget(),t.activeCubeFace=r.getActiveCubeFace(),t.activeMipmapLevel=r.getActiveMipmapLevel(),t.renderObjectFunction=r.getRenderObjectFunction(),t.pixelRatio=r.getPixelRatio(),t.mrt=r.getMRT(),t.clearColor=r.getClearColor(t.clearColor||new Xt),t.clearAlpha=r.getClearAlpha(),t.autoClear=r.autoClear,t.scissorTest=r.getScissorTest(),t}function E9(r,t){return t=R9(r,t),r.setMRT(null),r.setRenderObjectFunction(null),r.setClearColor(0,1),r.autoClear=!0,t}function C9(r,t){r.toneMapping=t.toneMapping,r.toneMappingExposure=t.toneMappingExposure,r.outputColorSpace=t.outputColorSpace,r.setRenderTarget(t.renderTarget,t.activeCubeFace,t.activeMipmapLevel),r.setRenderObjectFunction(t.renderObjectFunction),r.setPixelRatio(t.pixelRatio),r.setMRT(t.mrt),r.setClearColor(t.clearColor,t.clearAlpha),r.autoClear=t.autoClear,r.setScissorTest(t.scissorTest)}function D9(r,t={}){return t.background=r.background,t.backgroundNode=r.backgroundNode,t.overrideMaterial=r.overrideMaterial,t}function B9(r,t){return t=D9(r,t),r.background=null,r.backgroundNode=null,r.overrideMaterial=null,t}function L9(r,t){r.background=t.background,r.backgroundNode=t.backgroundNode,r.overrideMaterial=t.overrideMaterial}function O9(r,t,e){return e=E9(r,e),e=B9(t,e),e}function F9(r,t,e){C9(r,e),L9(t,e)}const Wy=new WeakMap,xB=ot(({depthTexture:r,shadowCoord:t,depthLayer:e})=>{let n=qe(r,t.xy).setName("t_basic");return r.isArrayTexture&&(n=n.depth(e)),n.compare(t.z)}),bB=ot(({depthTexture:r,shadowCoord:t,shadow:e,depthLayer:n})=>{const s=(f,p)=>{let g=qe(r,f);return r.isArrayTexture&&(g=g.depth(n)),g.compare(p)},i=Ln("mapSize","vec2",e).setGroup(ne),a=Ln("radius","float",e).setGroup(ne),c=Vt(1).div(i),u=a.mul(c.x),d=a_(ju.xy).mul(6.28318530718);return ws(s(t.xy.add(_o(0,5,d).mul(u)),t.z),s(t.xy.add(_o(1,5,d).mul(u)),t.z),s(t.xy.add(_o(2,5,d).mul(u)),t.z),s(t.xy.add(_o(3,5,d).mul(u)),t.z),s(t.xy.add(_o(4,5,d).mul(u)),t.z)).mul(1/5)}),SB=ot(({depthTexture:r,shadowCoord:t,shadow:e,depthLayer:n})=>{const s=(p,g)=>{let y=qe(r,p);return r.isArrayTexture&&(y=y.depth(n)),y.compare(g)},i=Ln("mapSize","vec2",e).setGroup(ne),a=Vt(1).div(i),c=a.x,u=a.y,d=t.xy,f=No(d.mul(i).add(.5));return d.subAssign(f.mul(a)),ws(s(d,t.z),s(d.add(Vt(c,0)),t.z),s(d.add(Vt(0,u)),t.z),s(d.add(a),t.z),Be(s(d.add(Vt(c.negate(),0)),t.z),s(d.add(Vt(c.mul(2),0)),t.z),f.x),Be(s(d.add(Vt(c.negate(),u)),t.z),s(d.add(Vt(c.mul(2),u)),t.z),f.x),Be(s(d.add(Vt(0,u.negate())),t.z),s(d.add(Vt(0,u.mul(2))),t.z),f.y),Be(s(d.add(Vt(c,u.negate())),t.z),s(d.add(Vt(c,u.mul(2))),t.z),f.y),Be(Be(s(d.add(Vt(c.negate(),u.negate())),t.z),s(d.add(Vt(c.mul(2),u.negate())),t.z),f.x),Be(s(d.add(Vt(c.negate(),u.mul(2))),t.z),s(d.add(Vt(c.mul(2),u.mul(2))),t.z),f.x),f.y)).mul(1/9)}),wB=ot(({depthTexture:r,shadowCoord:t,depthLayer:e},n)=>{let s=qe(r).sample(t.xy);r.isArrayTexture&&(s=s.depth(e)),s=s.rg;const i=s.x,a=$n(1e-7,s.y.mul(s.y)),c=n.renderer.reversedDepthBuffer?Ad(i,t.z):Ad(t.z,i),u=G(1).toVar();return re(c.notEqual(1),()=>{const d=t.z.sub(i);let f=a.div(a.add(d.mul(d)));f=Ro(Oe(f,.3).div(.65)),u.assign($n(c,f))}),u}),TB=r=>{let t=Wy.get(r);return t===void 0&&(t=new Xn,t.colorNode=ie(0,0,0,1),t.isShadowPassMaterial=!0,t.name="ShadowMaterial",t.blending=rl,t.fog=!1,Wy.set(r,t)),t},_B=r=>{const t=Wy.get(r);t!==void 0&&(t.dispose(),Wy.delete(r))},HR=new Lc,jh=[],MB=(r,t,e,n)=>{jh[0]=r,jh[1]=t;let s=HR.get(jh);return(s===void 0||s.shadowType!==e||s.useVelocity!==n)&&(s=(i,a,c,u,d,f,...p)=>{(i.castShadow===!0||i.receiveShadow&&e===up)&&(n&&(SC(i).useVelocity=!0),i.onBeforeShadow(r,i,c,t.camera,u,a.overrideMaterial,f),r.renderObject(i,a,c,u,d,f,...p),i.onAfterShadow(r,i,c,t.camera,u,a.overrideMaterial,f))},s.shadowType=e,s.useVelocity=n,HR.set(jh,s)),jh[0]=null,jh[1]=null,s},U9=ot(({samples:r,radius:t,size:e,shadowPass:n,depthLayer:s})=>{const i=G(0).toVar("meanVertical"),a=G(0).toVar("squareMeanVertical"),c=r.lessThanEqual(G(1)).select(G(0),G(2).div(r.sub(1))),u=r.lessThanEqual(G(1)).select(G(0),G(-1));cn({start:Q(0),end:Q(r),type:"int",condition:"<"},({i:f})=>{const p=u.add(G(f).mul(c));let g=n.sample(ws(ju.xy,Vt(0,p).mul(t)).div(e));n.value.isArrayTexture&&(g=g.depth(s)),g=g.x,i.addAssign(g),a.addAssign(g.mul(g))}),i.divAssign(r),a.divAssign(r);const d=Oi(a.sub(i.mul(i)).max(0));return Vt(i,d)}),P9=ot(({samples:r,radius:t,size:e,shadowPass:n,depthLayer:s})=>{const i=G(0).toVar("meanHorizontal"),a=G(0).toVar("squareMeanHorizontal"),c=r.lessThanEqual(G(1)).select(G(0),G(2).div(r.sub(1))),u=r.lessThanEqual(G(1)).select(G(0),G(-1));cn({start:Q(0),end:Q(r),type:"int",condition:"<"},({i:f})=>{const p=u.add(G(f).mul(c));let g=n.sample(ws(ju.xy,Vt(p,0).mul(t)).div(e));n.value.isArrayTexture&&(g=g.depth(s)),i.addAssign(g.x),a.addAssign(ws(g.y.mul(g.y),g.x.mul(g.x)))}),i.divAssign(r),a.divAssign(r);const d=Oi(a.sub(i.mul(i)).max(0));return Vt(i,d)}),z9=[xB,bB,SB,wB];let t2;const cg=new Ox;class vB extends N9{static get type(){return"ShadowNode"}constructor(t,e=null){super(t),this.shadow=e||t.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(t,{filterFn:e,depthTexture:n,shadowCoord:s,shadow:i,depthLayer:a}){const c=s.x.greaterThanEqual(0).and(s.x.lessThanEqual(1)).and(s.y.greaterThanEqual(0)).and(s.y.lessThanEqual(1)).and(s.z.lessThanEqual(1)),u=e({depthTexture:n,shadowCoord:s,shadow:i,depthLayer:a});return c.select(u,G(1))}setupShadowCoord(t,e){const{shadow:n}=this,{renderer:s}=t,i=n.biasNode||Ln("bias","float",n).setGroup(ne);let a=e,c;if(n.camera.isOrthographicCamera||s.logarithmicDepthBuffer!==!0)a=a.xyz.div(a.w),c=a.z;else{const u=a.w;a=a.xy.div(u);const d=Ln("near","float",n.camera).setGroup(ne),f=Ln("far","float",n.camera).setGroup(ne);c=YT(u.negate(),d,f)}return a=st(a.x,a.y.oneMinus(),s.reversedDepthBuffer?c.sub(i):c.add(i)),a}getShadowFilterFn(t){return z9[t]}setupRenderTarget(t,e){const n=new Zr(t.mapSize.width,t.mapSize.height);n.name="ShadowDepthTexture",n.compareFunction=e.renderer.reversedDepthBuffer?rx:ix;const s=e.createRenderTarget(t.mapSize.width,t.mapSize.height);return s.texture.name="ShadowMap",s.texture.type=t.mapType,s.depthTexture=n,{shadowMap:s,depthTexture:n}}setupShadow(t){const{renderer:e,camera:n}=t,{light:s,shadow:i}=this,{depthTexture:a,shadowMap:c}=this.setupRenderTarget(i,t),u=e.shadowMap.type;if(u===D3||u===GF?(a.minFilter=$s,a.magFilter=$s):(a.minFilter=ts,a.magFilter=ts),i.camera.coordinateSystem=n.coordinateSystem,i.camera.updateProjectionMatrix(),u===up&&i.isPointLightShadow!==!0){a.compareFunction=null,c.depth>1?(c._vsmShadowMapVertical||(c._vsmShadowMapVertical=t.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Qo,type:ii,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=c._vsmShadowMapVertical,c._vsmShadowMapHorizontal||(c._vsmShadowMapHorizontal=t.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Qo,type:ii,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=c._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=t.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Qo,type:ii,depthBuffer:!1}),this.vsmShadowMapHorizontal=t.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:Qo,type:ii,depthBuffer:!1}));let v=qe(a);a.isArrayTexture&&(v=v.depth(this.depthLayer));let A=qe(this.vsmShadowMapVertical.texture);a.isArrayTexture&&(A=A.depth(this.depthLayer));const R=Ln("blurSamples","float",i).setGroup(ne),L=Ln("radius","float",i).setGroup(ne),D=Ln("mapSize","vec2",i).setGroup(ne);let U=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Xn);U.fragmentNode=U9({samples:R,radius:L,size:D,shadowPass:v,depthLayer:this.depthLayer}).context(t.getSharedContext()),U.name="VSMVertical",U=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Xn),U.fragmentNode=P9({samples:R,radius:L,size:D,shadowPass:A,depthLayer:this.depthLayer}).context(t.getSharedContext()),U.name="VSMHorizontal"}const d=Ln("intensity","float",i).setGroup(ne),f=Ln("normalBias","float",i).setGroup(ne),p=Ix(s).mul(m_.add(Ic.mul(f))),g=this.setupShadowCoord(t,p),y=i.filterNode||this.getShadowFilterFn(e.shadowMap.type)||null;if(y===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const x=u===up&&i.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:a,S=this.setupShadowFilter(t,{filterFn:y,shadowTexture:c.texture,depthTexture:x,shadowCoord:g,shadow:i,depthLayer:this.depthLayer});let T;e.shadowMap.transmitted===!0&&(c.texture.isCubeTexture?T=Li(c.texture,g.xyz):(T=qe(c.texture,g),a.isArrayTexture&&(T=T.depth(this.depthLayer))));let M;T?M=Be(1,S.rgb.mix(T,1),d.mul(T.a)).toVar():M=Be(1,S,d).toVar(),this.shadowMap=c,this.shadow.map=c;const N=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return T&&M.toInspector(`${N} / Color`,()=>this.shadowMap.texture.isCubeTexture?Li(this.shadowMap.texture):qe(this.shadowMap.texture)),M.toInspector(`${N} / Depth`,()=>this.shadowMap.texture.isCubeTexture?Li(this.shadowMap.texture).r.oneMinus():Qn(this.shadowMap.depthTexture,fn().mul(Ac(qe(this.shadowMap.depthTexture)))).r.oneMinus())}setup(t){if(t.renderer.shadowMap.enabled!==!1)return ot(()=>{const e=t.renderer.shadowMap.type;this._currentShadowType!==e&&(this._reset(),this._node=null);let n=this._node;return this.setupShadowPosition(t),n===null&&(this._node=n=this.setupShadow(t),this._currentShadowType=e),t.material.receivedShadowNode&&(n=t.material.receivedShadowNode(n)),n})()}renderShadow(t){const{shadow:e,shadowMap:n,light:s}=this,{renderer:i,scene:a}=t;e.updateMatrices(s),n.setSize(e.mapSize.width,e.mapSize.height,n.depth);const c=a.name;a.name=`Shadow Map [ ${s.name||"ID: "+s.id} ]`,i.render(a,e.camera),a.name=c}updateShadow(t){const{shadowMap:e,light:n,shadow:s}=this,{renderer:i,scene:a,camera:c}=t,u=i.shadowMap.type,d=e.depthTexture.version;this._depthVersionCached=d;const f=s.camera.layers.mask;(s.camera.layers.mask&4294967294)===0&&(s.camera.layers.mask=c.layers.mask);const p=i.getRenderObjectFunction(),g=i.getMRT(),y=g?g.has("velocity"):!1;t2=O9(i,a,t2),a.overrideMaterial=TB(n),i.setRenderObjectFunction(MB(i,s,u,y)),i.setClearColor(0,0),i.setRenderTarget(e),this.renderShadow(t),i.setRenderObjectFunction(p),u===up&&s.isPointLightShadow!==!0&&this.vsmPass(i),s.camera.layers.mask=f,F9(i,a,t2)}vsmPass(t){const{shadow:e}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(e.mapSize.width,e.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(e.mapSize.width,e.mapSize.height,n),t.setRenderTarget(this.vsmShadowMapVertical),cg.material=this.vsmMaterialVertical,cg.render(t),t.setRenderTarget(this.vsmShadowMapHorizontal),cg.material=this.vsmMaterialHorizontal,cg.render(t)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,_B(this.light),this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(t){const{shadow:e}=this;let n=e.needsUpdate||e.autoUpdate;n&&(this._cameraFrameId[t.camera]===t.frameId&&(n=!1),this._cameraFrameId[t.camera]=t.frameId),n&&(this.updateShadow(t),this.shadowMap.depthTexture.version===this._depthVersionCached&&(e.needsUpdate=!1))}}const AB=(r,t)=>new vB(r,t),I9=new Xt,WR=new ve,Wf=new V,e2=new V,V9=[new V(1,0,0),new V(-1,0,0),new V(0,-1,0),new V(0,1,0),new V(0,0,1),new V(0,0,-1)],G9=[new V(0,-1,0),new V(0,-1,0),new V(0,0,-1),new V(0,0,1),new V(0,-1,0),new V(0,-1,0)],k9=[new V(1,0,0),new V(-1,0,0),new V(0,1,0),new V(0,-1,0),new V(0,0,1),new V(0,0,-1)],H9=[new V(0,-1,0),new V(0,-1,0),new V(0,0,1),new V(0,0,-1),new V(0,-1,0),new V(0,-1,0)],NB=ot(({depthTexture:r,bd3D:t,dp:e})=>Li(r,t).compare(e)),RB=ot(({depthTexture:r,bd3D:t,dp:e,shadow:n})=>{const s=Ln("radius","float",n).setGroup(ne),i=Ln("mapSize","vec2",n).setGroup(ne),a=s.div(i.x),c=Mn(t),u=Ji(hl(t,c.x.greaterThan(c.z).select(st(0,1,0),st(1,0,0)))),d=hl(t,u),f=a_(ju.xy).mul(6.28318530718),p=_o(0,5,f),g=_o(1,5,f),y=_o(2,5,f),x=_o(3,5,f),S=_o(4,5,f);return Li(r,t.add(u.mul(p.x).add(d.mul(p.y)).mul(a))).compare(e).add(Li(r,t.add(u.mul(g.x).add(d.mul(g.y)).mul(a))).compare(e)).add(Li(r,t.add(u.mul(y.x).add(d.mul(y.y)).mul(a))).compare(e)).add(Li(r,t.add(u.mul(x.x).add(d.mul(x.y)).mul(a))).compare(e)).add(Li(r,t.add(u.mul(S.x).add(d.mul(S.y)).mul(a))).compare(e)).mul(1/5)}),W9=ot(({filterFn:r,depthTexture:t,shadowCoord:e,shadow:n},s)=>{const i=e.xyz.toConst(),a=i.abs().toConst(),c=a.x.max(a.y).max(a.z),u=te("float").setGroup(ne).onRenderUpdate(()=>n.camera.near),d=te("float").setGroup(ne).onRenderUpdate(()=>n.camera.far),f=Ln("bias","float",n).setGroup(ne),p=G(1).toVar();return re(c.sub(d).lessThanEqual(0).and(c.sub(u).greaterThanEqual(0)),()=>{let g;s.renderer.reversedDepthBuffer?(g=bD(c.negate(),u,d),g.subAssign(f)):(g=XT(c.negate(),u,d),g.addAssign(f));const y=i.normalize();p.assign(r({depthTexture:t,bd3D:y,dp:g,shadow:n}))}),p});class q9 extends vB{static get type(){return"PointShadowNode"}constructor(t,e=null){super(t,e)}getShadowFilterFn(t){return t===VF?NB:RB}setupShadowCoord(t,e){return e}setupShadowFilter(t,{filterFn:e,depthTexture:n,shadowCoord:s,shadow:i}){return W9({filterFn:e,depthTexture:n,shadowCoord:s,shadow:i})}setupRenderTarget(t,e){const n=new o8(t.mapSize.width);n.name="PointShadowDepthTexture",n.compareFunction=e.renderer.reversedDepthBuffer?rx:ix;const s=e.createCubeRenderTarget(t.mapSize.width);return s.texture.name="PointShadowMap",s.depthTexture=n,{shadowMap:s,depthTexture:n}}renderShadow(t){const{shadow:e,shadowMap:n,light:s}=this,{renderer:i,scene:a}=t,c=e.camera,u=e.matrix,d=i.coordinateSystem===Jr,f=d?V9:k9,p=d?G9:H9;n.setSize(e.mapSize.width,e.mapSize.width);const g=i.autoClear,y=i.getClearColor(I9),x=i.getClearAlpha();i.autoClear=!1,i.setClearColor(e.clearColor,e.clearAlpha);for(let S=0;S<6;S++){i.setRenderTarget(n,S),i.clear();const T=s.distance||c.far;T!==c.far&&(c.far=T,c.updateProjectionMatrix()),Wf.setFromMatrixPosition(s.matrixWorld),c.position.copy(Wf),e2.copy(c.position),e2.add(f[S]),c.up.copy(p[S]),c.lookAt(e2),c.updateMatrixWorld(),u.makeTranslation(-Wf.x,-Wf.y,-Wf.z),WR.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),e._frustum.setFromProjectionMatrix(WR,c.coordinateSystem,c.reversedDepth);const M=a.name;a.name=`Point Light Shadow [ ${s.name||"ID: "+s.id} ] - Face ${S+1}`,i.render(a,c),a.name=M}i.autoClear=g,i.setClearColor(y,x)}}const EB=(r,t)=>new q9(r,t);class Yu extends Ld{static get type(){return"AnalyticLightNode"}constructor(t=null){super(),this.light=t,this.color=new Xt,this.colorNode=t&&t.colorNode||te(this.color).setGroup(ne),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=de.FRAME,t&&t.shadow&&(this._shadowDisposeListener=()=>{this.disposeShadow()},t.addEventListener("dispose",this._shadowDisposeListener))}dispose(){this._shadowDisposeListener&&this.light.removeEventListener("dispose",this._shadowDisposeListener),super.dispose()}disposeShadow(){this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null),this.shadowColorNode=null,this.baseColorNode!==null&&(this.colorNode=this.baseColorNode,this.baseColorNode=null)}getHash(){return this.light.uuid}getLightVector(t){return d_(this.light).sub(t.context.positionView||ds)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return AB(this.light)}setupShadow(t){const{renderer:e}=t;if(e.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const s=this.light.shadow.shadowNode;let i;s!==void 0?i=Qt(s):i=this.setupShadowNode(),this.shadowNode=i,this.shadowColorNode=n=this.colorNode.mul(i),this.baseColorNode=this.colorNode}t.context.getShadow&&(n=t.context.getShadow(this,t)),this.colorNode=n}setup(t){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?t.object.receiveShadow&&this.setupShadow(t):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const e=this.setupDirect(t),n=this.setupDirectRectArea(t);e&&t.lightsNode.setupDirectLight(t,this,e),n&&t.lightsNode.setupDirectRectAreaLight(t,this,n)}update(){const{light:t}=this;this.color.copy(t.color).multiplyScalar(t.intensity)}}const g_=ot(({lightDistance:r,cutoffDistance:t,decayExponent:e})=>{const n=r.pow(e).max(.01).reciprocal();return t.greaterThan(0).select(n.mul(r.div(t).pow4().oneMinus().clamp().pow2()),n)}),CB=({color:r,lightVector:t,cutoffDistance:e,decayExponent:n})=>{const s=t.normalize(),i=t.length(),a=g_({lightDistance:i,cutoffDistance:e,decayExponent:n}),c=r.mul(a);return{lightDirection:s,lightColor:c}};class $9 extends Yu{static get type(){return"PointLightNode"}constructor(t=null){super(t),this.cutoffDistanceNode=te(0).setGroup(ne),this.decayExponentNode=te(2).setGroup(ne)}update(t){const{light:e}=this;super.update(t),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}setupShadowNode(){return EB(this.light)}setupDirect(t){return CB({color:this.colorNode,lightVector:this.getLightVector(t),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const X9=ot(([r=fn()])=>{const t=r.mul(2),e=t.x.floor(),n=t.y.floor();return e.add(n).mod(2).sign()}),j9=ot(([r=fn()],{renderer:t,material:e})=>{const n=_T(r.mul(2).sub(1));let s;if(e.alphaToCoverage&&t.currentSamples>0){const i=G(n.fwidth()).toVar();s=Eo(i.oneMinus(),i.add(1),n).oneMinus()}else s=bi(n.greaterThan(1),0,1);return s}),Ap=ot(([r,t,e])=>{const n=G(e).toVar(),s=G(t).toVar(),i=eo(r).toVar();return bi(i,s,n)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),qy=ot(([r,t])=>{const e=eo(t).toVar(),n=G(r).toVar();return bi(e,n.negate(),n)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),bs=ot(([r])=>{const t=G(r).toVar();return Q(oa(t))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),Vn=ot(([r,t])=>{const e=G(r).toVar();return t.assign(bs(e)),e.sub(G(t))}),Y9=ot(([r,t,e,n,s,i])=>{const a=G(i).toVar(),c=G(s).toVar(),u=G(n).toVar(),d=G(e).toVar(),f=G(t).toVar(),p=G(r).toVar(),g=G(Oe(1,c)).toVar();return Oe(1,a).mul(p.mul(g).add(f.mul(c))).add(a.mul(d.mul(g).add(u.mul(c))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),K9=ot(([r,t,e,n,s,i])=>{const a=G(i).toVar(),c=G(s).toVar(),u=st(n).toVar(),d=st(e).toVar(),f=st(t).toVar(),p=st(r).toVar(),g=G(Oe(1,c)).toVar();return Oe(1,a).mul(p.mul(g).add(f.mul(c))).add(a.mul(d.mul(g).add(u.mul(c))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),DB=ai([Y9,K9]),Z9=ot(([r,t,e,n,s,i,a,c,u,d,f])=>{const p=G(f).toVar(),g=G(d).toVar(),y=G(u).toVar(),x=G(c).toVar(),S=G(a).toVar(),T=G(i).toVar(),M=G(s).toVar(),N=G(n).toVar(),v=G(e).toVar(),A=G(t).toVar(),R=G(r).toVar(),L=G(Oe(1,y)).toVar(),D=G(Oe(1,g)).toVar();return G(Oe(1,p)).toVar().mul(D.mul(R.mul(L).add(A.mul(y))).add(g.mul(v.mul(L).add(N.mul(y))))).add(p.mul(D.mul(M.mul(L).add(T.mul(y))).add(g.mul(S.mul(L).add(x.mul(y))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),Q9=ot(([r,t,e,n,s,i,a,c,u,d,f])=>{const p=G(f).toVar(),g=G(d).toVar(),y=G(u).toVar(),x=st(c).toVar(),S=st(a).toVar(),T=st(i).toVar(),M=st(s).toVar(),N=st(n).toVar(),v=st(e).toVar(),A=st(t).toVar(),R=st(r).toVar(),L=G(Oe(1,y)).toVar(),D=G(Oe(1,g)).toVar();return G(Oe(1,p)).toVar().mul(D.mul(R.mul(L).add(A.mul(y))).add(g.mul(v.mul(L).add(N.mul(y))))).add(p.mul(D.mul(M.mul(L).add(T.mul(y))).add(g.mul(S.mul(L).add(x.mul(y))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),BB=ai([Z9,Q9]),J9=ot(([r,t,e])=>{const n=G(e).toVar(),s=G(t).toVar(),i=zt(r).toVar(),a=zt(i.bitAnd(zt(7))).toVar(),c=G(Ap(a.lessThan(zt(4)),s,n)).toVar(),u=G(fe(2,Ap(a.lessThan(zt(4)),n,s))).toVar();return qy(c,eo(a.bitAnd(zt(1)))).add(qy(u,eo(a.bitAnd(zt(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),t7=ot(([r,t,e,n])=>{const s=G(n).toVar(),i=G(e).toVar(),a=G(t).toVar(),c=zt(r).toVar(),u=zt(c.bitAnd(zt(15))).toVar(),d=G(Ap(u.lessThan(zt(8)),a,i)).toVar(),f=G(Ap(u.lessThan(zt(4)),i,Ap(u.equal(zt(12)).or(u.equal(zt(14))),a,s))).toVar();return qy(d,eo(u.bitAnd(zt(1)))).add(qy(f,eo(u.bitAnd(zt(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Ws=ai([J9,t7]),e7=ot(([r,t,e])=>{const n=G(e).toVar(),s=G(t).toVar(),i=Xu(r).toVar();return st(Ws(i.x,s,n),Ws(i.y,s,n),Ws(i.z,s,n))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),n7=ot(([r,t,e,n])=>{const s=G(n).toVar(),i=G(e).toVar(),a=G(t).toVar(),c=Xu(r).toVar();return st(Ws(c.x,a,i,s),Ws(c.y,a,i,s),Ws(c.z,a,i,s))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),qr=ai([e7,n7]),s7=ot(([r])=>{const t=G(r).toVar();return fe(.6616,t)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),i7=ot(([r])=>{const t=G(r).toVar();return fe(.982,t)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),r7=ot(([r])=>{const t=st(r).toVar();return fe(.6616,t)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),LB=ai([s7,r7]),o7=ot(([r])=>{const t=st(r).toVar();return fe(.982,t)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),OB=ai([i7,o7]),Sr=ot(([r,t])=>{const e=Q(t).toVar(),n=zt(r).toVar();return n.shiftLeft(e).bitOr(n.shiftRight(Q(32).sub(e)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),FB=ot(([r,t,e])=>{r.subAssign(e),r.bitXorAssign(Sr(e,Q(4))),e.addAssign(t),t.subAssign(r),t.bitXorAssign(Sr(r,Q(6))),r.addAssign(e),e.subAssign(t),e.bitXorAssign(Sr(t,Q(8))),t.addAssign(r),r.subAssign(e),r.bitXorAssign(Sr(e,Q(16))),e.addAssign(t),t.subAssign(r),t.bitXorAssign(Sr(r,Q(19))),r.addAssign(e),e.subAssign(t),e.bitXorAssign(Sr(t,Q(4))),t.addAssign(r)}),e0=ot(([r,t,e])=>{const n=zt(e).toVar(),s=zt(t).toVar(),i=zt(r).toVar();return n.bitXorAssign(s),n.subAssign(Sr(s,Q(14))),i.bitXorAssign(n),i.subAssign(Sr(n,Q(11))),s.bitXorAssign(i),s.subAssign(Sr(i,Q(25))),n.bitXorAssign(s),n.subAssign(Sr(s,Q(16))),i.bitXorAssign(n),i.subAssign(Sr(n,Q(4))),s.bitXorAssign(i),s.subAssign(Sr(i,Q(14))),n.bitXorAssign(s),n.subAssign(Sr(s,Q(24))),n}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),Si=ot(([r])=>{const t=zt(r).toVar();return G(t).div(G(zt(Q(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),ha=ot(([r])=>{const t=G(r).toVar();return t.mul(t).mul(t).mul(t.mul(t.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),a7=ot(([r])=>{const t=Q(r).toVar(),e=zt(zt(1)).toVar(),n=zt(zt(Q(3735928559)).add(e.shiftLeft(zt(2))).add(zt(13))).toVar();return e0(n.add(zt(t)),n,n)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),l7=ot(([r,t])=>{const e=Q(t).toVar(),n=Q(r).toVar(),s=zt(zt(2)).toVar(),i=zt().toVar(),a=zt().toVar(),c=zt().toVar();return i.assign(a.assign(c.assign(zt(Q(3735928559)).add(s.shiftLeft(zt(2))).add(zt(13))))),i.addAssign(zt(n)),a.addAssign(zt(e)),e0(i,a,c)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),c7=ot(([r,t,e])=>{const n=Q(e).toVar(),s=Q(t).toVar(),i=Q(r).toVar(),a=zt(zt(3)).toVar(),c=zt().toVar(),u=zt().toVar(),d=zt().toVar();return c.assign(u.assign(d.assign(zt(Q(3735928559)).add(a.shiftLeft(zt(2))).add(zt(13))))),c.addAssign(zt(i)),u.addAssign(zt(s)),d.addAssign(zt(n)),e0(c,u,d)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),u7=ot(([r,t,e,n])=>{const s=Q(n).toVar(),i=Q(e).toVar(),a=Q(t).toVar(),c=Q(r).toVar(),u=zt(zt(4)).toVar(),d=zt().toVar(),f=zt().toVar(),p=zt().toVar();return d.assign(f.assign(p.assign(zt(Q(3735928559)).add(u.shiftLeft(zt(2))).add(zt(13))))),d.addAssign(zt(c)),f.addAssign(zt(a)),p.addAssign(zt(i)),FB(d,f,p),d.addAssign(zt(s)),e0(d,f,p)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),h7=ot(([r,t,e,n,s])=>{const i=Q(s).toVar(),a=Q(n).toVar(),c=Q(e).toVar(),u=Q(t).toVar(),d=Q(r).toVar(),f=zt(zt(5)).toVar(),p=zt().toVar(),g=zt().toVar(),y=zt().toVar();return p.assign(g.assign(y.assign(zt(Q(3735928559)).add(f.shiftLeft(zt(2))).add(zt(13))))),p.addAssign(zt(d)),g.addAssign(zt(u)),y.addAssign(zt(c)),FB(p,g,y),p.addAssign(zt(a)),g.addAssign(zt(i)),e0(p,g,y)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),hn=ai([a7,l7,c7,u7,h7]),d7=ot(([r,t])=>{const e=Q(t).toVar(),n=Q(r).toVar(),s=zt(hn(n,e)).toVar(),i=Xu().toVar();return i.x.assign(s.bitAnd(Q(255))),i.y.assign(s.shiftRight(Q(8)).bitAnd(Q(255))),i.z.assign(s.shiftRight(Q(16)).bitAnd(Q(255))),i}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),f7=ot(([r,t,e])=>{const n=Q(e).toVar(),s=Q(t).toVar(),i=Q(r).toVar(),a=zt(hn(i,s,n)).toVar(),c=Xu().toVar();return c.x.assign(a.bitAnd(Q(255))),c.y.assign(a.shiftRight(Q(8)).bitAnd(Q(255))),c.z.assign(a.shiftRight(Q(16)).bitAnd(Q(255))),c}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),$r=ai([d7,f7]),p7=ot(([r])=>{const t=Vt(r).toVar(),e=Q().toVar(),n=Q().toVar(),s=G(Vn(t.x,e)).toVar(),i=G(Vn(t.y,n)).toVar(),a=G(ha(s)).toVar(),c=G(ha(i)).toVar(),u=G(DB(Ws(hn(e,n),s,i),Ws(hn(e.add(Q(1)),n),s.sub(1),i),Ws(hn(e,n.add(Q(1))),s,i.sub(1)),Ws(hn(e.add(Q(1)),n.add(Q(1))),s.sub(1),i.sub(1)),a,c)).toVar();return LB(u)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),m7=ot(([r])=>{const t=st(r).toVar(),e=Q().toVar(),n=Q().toVar(),s=Q().toVar(),i=G(Vn(t.x,e)).toVar(),a=G(Vn(t.y,n)).toVar(),c=G(Vn(t.z,s)).toVar(),u=G(ha(i)).toVar(),d=G(ha(a)).toVar(),f=G(ha(c)).toVar(),p=G(BB(Ws(hn(e,n,s),i,a,c),Ws(hn(e.add(Q(1)),n,s),i.sub(1),a,c),Ws(hn(e,n.add(Q(1)),s),i,a.sub(1),c),Ws(hn(e.add(Q(1)),n.add(Q(1)),s),i.sub(1),a.sub(1),c),Ws(hn(e,n,s.add(Q(1))),i,a,c.sub(1)),Ws(hn(e.add(Q(1)),n,s.add(Q(1))),i.sub(1),a,c.sub(1)),Ws(hn(e,n.add(Q(1)),s.add(Q(1))),i,a.sub(1),c.sub(1)),Ws(hn(e.add(Q(1)),n.add(Q(1)),s.add(Q(1))),i.sub(1),a.sub(1),c.sub(1)),u,d,f)).toVar();return OB(p)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),y_=ai([p7,m7]),g7=ot(([r])=>{const t=Vt(r).toVar(),e=Q().toVar(),n=Q().toVar(),s=G(Vn(t.x,e)).toVar(),i=G(Vn(t.y,n)).toVar(),a=G(ha(s)).toVar(),c=G(ha(i)).toVar(),u=st(DB(qr($r(e,n),s,i),qr($r(e.add(Q(1)),n),s.sub(1),i),qr($r(e,n.add(Q(1))),s,i.sub(1)),qr($r(e.add(Q(1)),n.add(Q(1))),s.sub(1),i.sub(1)),a,c)).toVar();return LB(u)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),y7=ot(([r])=>{const t=st(r).toVar(),e=Q().toVar(),n=Q().toVar(),s=Q().toVar(),i=G(Vn(t.x,e)).toVar(),a=G(Vn(t.y,n)).toVar(),c=G(Vn(t.z,s)).toVar(),u=G(ha(i)).toVar(),d=G(ha(a)).toVar(),f=G(ha(c)).toVar(),p=st(BB(qr($r(e,n,s),i,a,c),qr($r(e.add(Q(1)),n,s),i.sub(1),a,c),qr($r(e,n.add(Q(1)),s),i,a.sub(1),c),qr($r(e.add(Q(1)),n.add(Q(1)),s),i.sub(1),a.sub(1),c),qr($r(e,n,s.add(Q(1))),i,a,c.sub(1)),qr($r(e.add(Q(1)),n,s.add(Q(1))),i.sub(1),a,c.sub(1)),qr($r(e,n.add(Q(1)),s.add(Q(1))),i,a.sub(1),c.sub(1)),qr($r(e.add(Q(1)),n.add(Q(1)),s.add(Q(1))),i.sub(1),a.sub(1),c.sub(1)),u,d,f)).toVar();return OB(p)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),n0=ai([g7,y7]),x7=ot(([r])=>{const t=G(r).toVar(),e=Q(bs(t)).toVar();return Si(hn(e))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),b7=ot(([r])=>{const t=Vt(r).toVar(),e=Q(bs(t.x)).toVar(),n=Q(bs(t.y)).toVar();return Si(hn(e,n))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),S7=ot(([r])=>{const t=st(r).toVar(),e=Q(bs(t.x)).toVar(),n=Q(bs(t.y)).toVar(),s=Q(bs(t.z)).toVar();return Si(hn(e,n,s))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),w7=ot(([r])=>{const t=ie(r).toVar(),e=Q(bs(t.x)).toVar(),n=Q(bs(t.y)).toVar(),s=Q(bs(t.z)).toVar(),i=Q(bs(t.w)).toVar();return Si(hn(e,n,s,i))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),T7=ai([x7,b7,S7,w7]),_7=ot(([r])=>{const t=G(r).toVar(),e=Q(bs(t)).toVar();return st(Si(hn(e,Q(0))),Si(hn(e,Q(1))),Si(hn(e,Q(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),M7=ot(([r])=>{const t=Vt(r).toVar(),e=Q(bs(t.x)).toVar(),n=Q(bs(t.y)).toVar();return st(Si(hn(e,n,Q(0))),Si(hn(e,n,Q(1))),Si(hn(e,n,Q(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),v7=ot(([r])=>{const t=st(r).toVar(),e=Q(bs(t.x)).toVar(),n=Q(bs(t.y)).toVar(),s=Q(bs(t.z)).toVar();return st(Si(hn(e,n,s,Q(0))),Si(hn(e,n,s,Q(1))),Si(hn(e,n,s,Q(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),A7=ot(([r])=>{const t=ie(r).toVar(),e=Q(bs(t.x)).toVar(),n=Q(bs(t.y)).toVar(),s=Q(bs(t.z)).toVar(),i=Q(bs(t.w)).toVar();return st(Si(hn(e,n,s,i,Q(0))),Si(hn(e,n,s,i,Q(1))),Si(hn(e,n,s,i,Q(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),Vx=ai([_7,M7,v7,A7]),$y=ot(([r,t,e,n])=>{const s=G(n).toVar(),i=G(e).toVar(),a=Q(t).toVar(),c=st(r).toVar(),u=G(0).toVar(),d=G(1).toVar();return cn(a,()=>{u.addAssign(d.mul(y_(c))),d.mulAssign(s),c.mulAssign(i)}),u}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Gx=ot(([r,t,e,n])=>{const s=G(n).toVar(),i=G(e).toVar(),a=Q(t).toVar(),c=st(r).toVar(),u=st(0).toVar(),d=G(1).toVar();return cn(a,()=>{u.addAssign(d.mul(n0(c))),d.mulAssign(s),c.mulAssign(i)}),u}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),N7=ot(([r,t,e,n])=>{const s=G(n).toVar(),i=G(e).toVar(),a=Q(t).toVar(),c=st(r).toVar();return Vt($y(c,a,i,s),$y(c.add(st(Q(19),Q(193),Q(17))),a,i,s))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),R7=ot(([r,t,e,n])=>{const s=G(n).toVar(),i=G(e).toVar(),a=Q(t).toVar(),c=st(r).toVar(),u=st(Gx(c,a,i,s)).toVar(),d=G($y(c.add(st(Q(19),Q(193),Q(17))),a,i,s)).toVar();return ie(u,d)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),E7=ot(([r,t,e,n,s,i,a])=>{const c=Q(a).toVar(),u=G(i).toVar(),d=Q(s).toVar(),f=Q(n).toVar(),p=Q(e).toVar(),g=Q(t).toVar(),y=Vt(r).toVar(),x=st(Vx(Vt(g.add(f),p.add(d)))).toVar(),S=Vt(x.x,x.y).toVar();S.subAssign(.5),S.mulAssign(u),S.addAssign(.5);const T=Vt(Vt(G(g),G(p)).add(S)).toVar(),M=Vt(T.sub(y)).toVar();return re(c.equal(Q(2)),()=>Mn(M.x).add(Mn(M.y))),re(c.equal(Q(3)),()=>$n(Mn(M.x),Mn(M.y))),no(M,M)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),C7=ot(([r,t,e,n,s,i,a,c,u])=>{const d=Q(u).toVar(),f=G(c).toVar(),p=Q(a).toVar(),g=Q(i).toVar(),y=Q(s).toVar(),x=Q(n).toVar(),S=Q(e).toVar(),T=Q(t).toVar(),M=st(r).toVar(),N=st(Vx(st(T.add(y),S.add(g),x.add(p)))).toVar();N.subAssign(.5),N.mulAssign(f),N.addAssign(.5);const v=st(st(G(T),G(S),G(x)).add(N)).toVar(),A=st(v.sub(M)).toVar();return re(d.equal(Q(2)),()=>Mn(A.x).add(Mn(A.y)).add(Mn(A.z))),re(d.equal(Q(3)),()=>$n(Mn(A.x),Mn(A.y),Mn(A.z))),no(A,A)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Fd=ai([E7,C7]),D7=ot(([r,t,e])=>{const n=Q(e).toVar(),s=G(t).toVar(),i=Vt(r).toVar(),a=Q().toVar(),c=Q().toVar(),u=Vt(Vn(i.x,a),Vn(i.y,c)).toVar(),d=G(1e6).toVar();return cn({start:-1,end:Q(1),name:"x",condition:"<="},({x:f})=>{cn({start:-1,end:Q(1),name:"y",condition:"<="},({y:p})=>{const g=G(Fd(u,f,p,a,c,s,n)).toVar();d.assign(nr(d,g))})}),re(n.equal(Q(0)),()=>{d.assign(Oi(d))}),d}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),B7=ot(([r,t,e])=>{const n=Q(e).toVar(),s=G(t).toVar(),i=Vt(r).toVar(),a=Q().toVar(),c=Q().toVar(),u=Vt(Vn(i.x,a),Vn(i.y,c)).toVar(),d=Vt(1e6,1e6).toVar();return cn({start:-1,end:Q(1),name:"x",condition:"<="},({x:f})=>{cn({start:-1,end:Q(1),name:"y",condition:"<="},({y:p})=>{const g=G(Fd(u,f,p,a,c,s,n)).toVar();re(g.lessThan(d.x),()=>{d.y.assign(d.x),d.x.assign(g)}).ElseIf(g.lessThan(d.y),()=>{d.y.assign(g)})})}),re(n.equal(Q(0)),()=>{d.assign(Oi(d))}),d}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),L7=ot(([r,t,e])=>{const n=Q(e).toVar(),s=G(t).toVar(),i=Vt(r).toVar(),a=Q().toVar(),c=Q().toVar(),u=Vt(Vn(i.x,a),Vn(i.y,c)).toVar(),d=st(1e6,1e6,1e6).toVar();return cn({start:-1,end:Q(1),name:"x",condition:"<="},({x:f})=>{cn({start:-1,end:Q(1),name:"y",condition:"<="},({y:p})=>{const g=G(Fd(u,f,p,a,c,s,n)).toVar();re(g.lessThan(d.x),()=>{d.z.assign(d.y),d.y.assign(d.x),d.x.assign(g)}).ElseIf(g.lessThan(d.y),()=>{d.z.assign(d.y),d.y.assign(g)}).ElseIf(g.lessThan(d.z),()=>{d.z.assign(g)})})}),re(n.equal(Q(0)),()=>{d.assign(Oi(d))}),d}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),O7=ot(([r,t,e])=>{const n=Q(e).toVar(),s=G(t).toVar(),i=st(r).toVar(),a=Q().toVar(),c=Q().toVar(),u=Q().toVar(),d=st(Vn(i.x,a),Vn(i.y,c),Vn(i.z,u)).toVar(),f=G(1e6).toVar();return cn({start:-1,end:Q(1),name:"x",condition:"<="},({x:p})=>{cn({start:-1,end:Q(1),name:"y",condition:"<="},({y:g})=>{cn({start:-1,end:Q(1),name:"z",condition:"<="},({z:y})=>{const x=G(Fd(d,p,g,y,a,c,u,s,n)).toVar();f.assign(nr(f,x))})})}),re(n.equal(Q(0)),()=>{f.assign(Oi(f))}),f}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),F7=ai([D7,O7]),U7=ot(([r,t,e])=>{const n=Q(e).toVar(),s=G(t).toVar(),i=st(r).toVar(),a=Q().toVar(),c=Q().toVar(),u=Q().toVar(),d=st(Vn(i.x,a),Vn(i.y,c),Vn(i.z,u)).toVar(),f=Vt(1e6,1e6).toVar();return cn({start:-1,end:Q(1),name:"x",condition:"<="},({x:p})=>{cn({start:-1,end:Q(1),name:"y",condition:"<="},({y:g})=>{cn({start:-1,end:Q(1),name:"z",condition:"<="},({z:y})=>{const x=G(Fd(d,p,g,y,a,c,u,s,n)).toVar();re(x.lessThan(f.x),()=>{f.y.assign(f.x),f.x.assign(x)}).ElseIf(x.lessThan(f.y),()=>{f.y.assign(x)})})})}),re(n.equal(Q(0)),()=>{f.assign(Oi(f))}),f}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),P7=ai([B7,U7]),z7=ot(([r,t,e])=>{const n=Q(e).toVar(),s=G(t).toVar(),i=st(r).toVar(),a=Q().toVar(),c=Q().toVar(),u=Q().toVar(),d=st(Vn(i.x,a),Vn(i.y,c),Vn(i.z,u)).toVar(),f=st(1e6,1e6,1e6).toVar();return cn({start:-1,end:Q(1),name:"x",condition:"<="},({x:p})=>{cn({start:-1,end:Q(1),name:"y",condition:"<="},({y:g})=>{cn({start:-1,end:Q(1),name:"z",condition:"<="},({z:y})=>{const x=G(Fd(d,p,g,y,a,c,u,s,n)).toVar();re(x.lessThan(f.x),()=>{f.z.assign(f.y),f.y.assign(f.x),f.x.assign(x)}).ElseIf(x.lessThan(f.y),()=>{f.z.assign(f.y),f.y.assign(x)}).ElseIf(x.lessThan(f.z),()=>{f.z.assign(x)})})})}),re(n.equal(Q(0)),()=>{f.assign(Oi(f))}),f}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),x_=ai([L7,z7]),I7=ot(([r,t,e,n,s,i,a,c,u,d,f])=>{const p=Q(r).toVar(),g=Vt(t).toVar(),y=Vt(e).toVar(),x=Vt(n).toVar(),S=G(s).toVar(),T=G(i).toVar(),M=G(a).toVar(),N=eo(c).toVar(),v=Q(u).toVar(),A=G(d).toVar(),R=G(f).toVar(),L=g.mul(y).add(x),D=G(0).toVar();return re(p.equal(Q(0)),()=>{D.assign(n0(L))}),re(p.equal(Q(1)),()=>{D.assign(Vx(L))}),re(p.equal(Q(2)),()=>{D.assign(x_(L,S,Q(0)))}),re(p.equal(Q(3)),()=>{D.assign(Gx(st(L,0),v,A,R))}),D.assign(D.mul(M.sub(T)).add(T)),re(N,()=>{D.assign(Ro(D,T,M))}),D}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),V7=ot(([r,t,e,n,s,i,a,c,u,d,f])=>{const p=Q(r).toVar(),g=st(t).toVar(),y=st(e).toVar(),x=st(n).toVar(),S=G(s).toVar(),T=G(i).toVar(),M=G(a).toVar(),N=eo(c).toVar(),v=Q(u).toVar(),A=G(d).toVar(),R=G(f).toVar(),L=g.mul(y).add(x),D=G(0).toVar();return re(p.equal(Q(0)),()=>{D.assign(n0(L))}),re(p.equal(Q(1)),()=>{D.assign(Vx(L))}),re(p.equal(Q(2)),()=>{D.assign(x_(L,S,Q(0)))}),re(p.equal(Q(3)),()=>{D.assign(Gx(L,v,A,R))}),D.assign(D.mul(M.sub(T)).add(T)),re(N,()=>{D.assign(Ro(D,T,M))}),D}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),G7=ot(([r])=>{const t=r.y,e=r.z,n=st().toVar();return re(t.lessThan(1e-4),()=>{n.assign(st(e,e,e))}).Else(()=>{let s=r.x;s=s.sub(oa(s)).mul(6).toVar();const i=Q(bT(s)),a=s.sub(G(i)),c=e.mul(t.oneMinus()),u=e.mul(t.mul(a).oneMinus()),d=e.mul(t.mul(a.oneMinus()).oneMinus());re(i.equal(Q(0)),()=>{n.assign(st(e,d,c))}).ElseIf(i.equal(Q(1)),()=>{n.assign(st(u,e,c))}).ElseIf(i.equal(Q(2)),()=>{n.assign(st(c,e,d))}).ElseIf(i.equal(Q(3)),()=>{n.assign(st(c,u,e))}).ElseIf(i.equal(Q(4)),()=>{n.assign(st(d,c,e))}).Else(()=>{n.assign(st(e,c,u))})}),n}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),k7=ot(([r])=>{const t=st(r).toVar(),e=G(t.x).toVar(),n=G(t.y).toVar(),s=G(t.z).toVar(),i=G(nr(e,nr(n,s))).toVar(),a=G($n(e,$n(n,s))).toVar(),c=G(a.sub(i)).toVar(),u=G().toVar(),d=G().toVar(),f=G().toVar();return f.assign(a),re(a.greaterThan(0),()=>{d.assign(c.div(a))}).Else(()=>{d.assign(0)}),re(d.lessThanEqual(0),()=>{u.assign(0)}).Else(()=>{re(e.greaterThanEqual(a),()=>{u.assign(n.sub(s).div(c))}).ElseIf(n.greaterThanEqual(a),()=>{u.assign(ws(2,s.sub(e).div(c)))}).Else(()=>{u.assign(ws(4,e.sub(n).div(c)))}),u.mulAssign(1/6),re(u.lessThan(0),()=>{u.addAssign(1)})}),st(u,d,f)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),H7=ot(([r])=>{const t=st(r).toVar(),e=eT(cT(t,st(.04045))).toVar(),n=st(t.div(12.92)).toVar(),s=st(jr($n(t.add(st(.055)),st(0)).div(1.055),st(2.4))).toVar();return Be(n,s,e)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),UB=(r,t)=>{r=G(r),t=G(t);const e=Vt(t.dFdx(),t.dFdy()).length().mul(.7071067811865476);return Eo(r.sub(e),r.add(e),t)},PB=(r,t,e,n)=>Be(r,t,e[n].clamp()),W7=(r,t,e=fn())=>PB(r,t,e,"x"),q7=(r,t,e=fn())=>PB(r,t,e,"y"),$7=(r,t,e,n,s=fn())=>{const i=s.x.clamp(),a=s.y.clamp(),c=Be(r,t,i),u=Be(e,n,i);return Be(c,u,a)},zB=(r,t,e,n,s)=>Be(r,t,UB(e,n[s])),X7=(r,t,e,n=fn())=>zB(r,t,e,n,"x"),j7=(r,t,e,n=fn())=>zB(r,t,e,n,"y"),Y7=(r=1,t=0,e=fn())=>e.mul(r).add(t),K7=(r,t=1)=>(r=G(r),r.abs().pow(t).mul(r.sign())),Z7=(r,t=1,e=.5)=>G(r).sub(e).mul(t).add(e),Q7=(r=fn(),t=1,e=0)=>y_(r.convert("vec2|vec3")).mul(t).add(e),J7=(r=fn(),t=1,e=0)=>n0(r.convert("vec2|vec3")).mul(t).add(e),tH=(r=fn(),t=1,e=0)=>(r=r.convert("vec2|vec3"),ie(n0(r),y_(r.add(Vt(19,73)))).mul(t).add(e)),eH=(r,t=fn(),e=Vt(1,1),n=Vt(0,0),s=1,i=0,a=1,c=!1,u=1,d=2,f=.5)=>I7(r,t.convert("vec2|vec3"),e,n,s,i,a,c,u,d,f),nH=(r,t=fn(),e=Vt(1,1),n=Vt(0,0),s=1,i=0,a=1,c=!1,u=1,d=2,f=.5)=>V7(r,t.convert("vec2|vec3"),e,n,s,i,a,c,u,d,f),sH=(r=fn(),t=1)=>F7(r.convert("vec2|vec3"),t,Q(1)),iH=(r=fn(),t=1)=>P7(r.convert("vec2|vec3"),t,Q(1)),rH=(r=fn(),t=1)=>x_(r.convert("vec2|vec3"),t,Q(1)),oH=(r=fn())=>T7(r.convert("vec2|vec3")),aH=(r=fn(),t=3,e=2,n=.5,s=1)=>$y(r,Q(t),e,n).mul(s),lH=(r=fn(),t=3,e=2,n=.5,s=1)=>N7(r,Q(t),e,n).mul(s),cH=(r=fn(),t=3,e=2,n=.5,s=1)=>Gx(r,Q(t),e,n).mul(s),uH=(r=fn(),t=3,e=2,n=.5,s=1)=>R7(r,Q(t),e,n).mul(s),hH=(r,t=G(0))=>ws(r,t),dH=(r,t=G(0))=>Oe(r,t),fH=(r,t=G(1))=>fe(r,t),pH=(r,t=G(1))=>Nr(r,t),mH=(r,t=G(1))=>Yp(r,t),gH=(r,t=G(1))=>jr(r,t),yH=(r=G(0),t=G(1))=>pT(r,t),xH=()=>Od,bH=()=>QD,SH=(r,t=G(1))=>Oe(t,r),wH=(r,t,e,n)=>r.greaterThan(t).mix(e,n),TH=(r,t,e,n)=>r.greaterThanEqual(t).mix(e,n),_H=(r,t,e,n)=>r.equal(t).mix(e,n),MH=(r,t=null)=>{if(typeof t=="string"){const e={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},n=t.replace(/^out/,"").toLowerCase();if(e[n]!==void 0)return r.element(e[n])}if(typeof t=="number")return r.element(t);if(typeof t=="string"&&t.length===1){const e={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(e[t]!==void 0)return r.element(e[t])}return r},vH=(r,t=Vt(.5,.5),e=Vt(1,1),n=G(0),s=Vt(0,0))=>{let i=r;if(t&&(i=i.sub(t)),e&&(i=i.mul(e)),n){const a=n.mul(Math.PI/180),c=a.cos(),u=a.sin();i=Vt(i.x.mul(c).sub(i.y.mul(u)),i.x.mul(u).add(i.y.mul(c)))}return t&&(i=i.add(t)),s&&(i=i.add(s)),i},AH=(r,t)=>{r=Vt(r),t=G(t);const e=t.mul(Math.PI/180);return Qp(r,e)},NH=(r,t,e)=>{r=st(r),t=G(t),e=st(e);const n=t.mul(Math.PI/180),s=e.normalize(),i=n.cos(),a=n.sin(),c=G(1).sub(i);return r.mul(i).add(s.cross(r).mul(a)).add(s.mul(s.dot(r)).mul(c))},RH=(r,t)=>(r=st(r),t=G(t),kT(r,t)),EH=ot(([r,t,e])=>{const n=Ji(r).toVar(),s=Oe(G(.5).mul(t.sub(e)),ca).div(n).toVar(),i=Oe(G(-.5).mul(t.sub(e)),ca).div(n).toVar(),a=st().toVar();a.x=n.x.greaterThan(G(0)).select(s.x,i.x),a.y=n.y.greaterThan(G(0)).select(s.y,i.y),a.z=n.z.greaterThan(G(0)).select(s.z,i.z);const c=nr(a.x,a.y,a.z).toVar();return ca.add(n.mul(c)).toVar().sub(e)}),IB=ot(([r,t])=>{const e=r.x,n=r.y,s=r.z;let i=t.element(0).mul(.886227);return i=i.add(t.element(1).mul(2*.511664).mul(n)),i=i.add(t.element(2).mul(2*.511664).mul(s)),i=i.add(t.element(3).mul(2*.511664).mul(e)),i=i.add(t.element(4).mul(2*.429043).mul(e).mul(n)),i=i.add(t.element(5).mul(2*.429043).mul(n).mul(s)),i=i.add(t.element(6).mul(s.mul(s).mul(.743125).sub(.247708))),i=i.add(t.element(7).mul(2*.429043).mul(e).mul(s)),i=i.add(t.element(8).mul(.429043).mul(fe(e,e).sub(fe(n,n)))),i});var _=Object.freeze({__proto__:null,BRDF_GGX:t_,BRDF_Lambert:ku,BasicPointShadowFilter:NB,BasicShadowFilter:xB,Break:mD,Const:B5,Continue:_6,DFGLUT:Vp,D_GGX:CD,Discard:j5,EPSILON:uT,F_Schlick:Cd,Fn:ot,HALF_PI:KP,INFINITY:XP,If:re,Loop:cn,NodeAccess:ri,NodeShaderStage:sp,NodeType:gP,NodeUpdateType:de,OnBeforeMaterialUpdate:kG,OnBeforeObjectUpdate:GG,OnMaterialUpdate:VG,OnObjectUpdate:IG,PCFShadowFilter:bB,PCFSoftShadowFilter:SB,PI:Iy,PI2:jP,PointShadowFilter:RB,Return:dz,Schlick_to_F0:iw,ShaderNode:cd,Stack:mx,Switch:zP,TBNViewMatrix:Bu,TWO_PI:YP,VSMShadowFilter:wB,V_GGX_SmithCorrelated:ED,Var:D5,VarIntent:L5,abs:Mn,acesFilmicToneMapping:cB,acos:fT,add:ws,addMethodChaining:Bt,addNodeElement:gz,agxToneMapping:uB,all:i5,alphaT:Uy,and:HC,anisotropy:uc,anisotropyB:Uu,anisotropyT:Tp,any:r5,append:kP,array:FC,arrayBuffer:VP,asin:c5,assign:UC,atan:pT,atomicAdd:$k,atomicAnd:Kk,atomicFunc:xa,atomicLoad:Wk,atomicMax:jk,atomicMin:Yk,atomicOr:Zk,atomicStore:qk,atomicSub:Xk,atomicXor:Qk,attenuationColor:oT,attenuationDistance:rT,attribute:dl,attributeArray:qG,backgroundBlurriness:eB,backgroundIntensity:cw,backgroundRotation:nB,batch:dD,bentNormalView:R4,billboarding:_G,bitAnd:XC,bitNot:jC,bitOr:YC,bitXor:KC,bitangentGeometry:n6,bitangentLocal:s6,bitangentView:A4,bitangentWorld:i6,bitcast:KD,blendBurn:k6,blendColor:$6,blendDodge:H6,blendOverlay:q6,blendScreen:W6,blur:PD,bool:eo,buffer:Kp,bufferAttribute:CT,builtin:ml,builtinAOContext:E5,builtinShadowContext:R5,bumpMap:kT,bvec2:RC,bvec3:eT,bvec4:EC,bypass:W5,cache:H5,call:PC,cameraFar:pc,cameraIndex:Pc,cameraNear:fc,cameraNormalMatrix:Cz,cameraPosition:i4,cameraProjectionMatrix:ul,cameraProjectionMatrixInverse:s4,cameraViewMatrix:ro,cameraViewport:Dz,cameraWorldMatrix:Ez,cbrt:w5,cdl:ck,ceil:Sx,checker:X9,cineonToneMapping:lB,clamp:Ro,clearcoat:Ly,clearcoatNormalView:mc,clearcoatRoughness:pd,clipSpace:a4,code:Px,color:NC,colorSpaceToWorking:Tx,colorToDirection:o6,compute:k5,computeKernel:DT,computeSkinning:w6,context:pl,convert:DC,convertColorSpace:sz,convertToTexture:OG,cos:wo,countLeadingZeros:JV,countOneBits:tG,countTrailingZeros:QV,cross:hl,cubeTexture:Li,cubeTextureBase:GT,dFdx:yT,dFdy:xT,dashSize:Ig,debug:K5,decrement:n5,decrementBefore:t5,defaultBuildStages:H2,defaultShaderStages:wC,defined:Pp,degrees:a5,deltaTime:mG,densityFogFactor:mB,depth:KT,depthPass:mk,determinant:p5,difference:x5,diffuseColor:on,diffuseContribution:Au,directPointLight:CB,directionToColor:E4,directionToFaceDirection:Bd,dispersion:aT,disposeShadowMaterial:_B,distance:y5,div:Nr,dot:no,drawIndex:cD,dynamicBufferAttribute:lz,element:CC,emissive:X2,equal:zC,equirectUV:ZT,exp:hT,exp2:vd,exponentialHeightFogFactor:Nk,expression:vo,faceDirection:zT,faceForward:vT,faceforward:ZP,float:G,floatBitsToInt:YV,floatBitsToUint:ZD,floor:oa,fog:uw,fract:No,frameGroup:OC,frameId:QD,frontFacing:l4,fwidth:ST,gain:nG,gapSize:j2,getConstNodeType:AC,getCurrentStack:Qw,getDirection:FD,getDistanceAttenuation:g_,getGeometryRoughness:RD,getNormalFromDepth:UG,getParallaxCorrectNormal:EH,getRoughness:JT,getScreenPosition:FG,getShIrradianceAt:IB,getShadowMaterial:TB,getShadowRenderObjectFunction:MB,getTextureIndex:jD,getViewPosition:rd,ggxConvolution:zD,globalId:Lk,glsl:Mk,glslFn:vk,grayscale:rk,greaterThan:cT,greaterThanEqual:kC,hash:eG,highpModelNormalViewMatrix:Z2,highpModelViewMatrix:K2,hue:lk,increment:e5,incrementBefore:JC,inspector:Q5,instance:x6,instanceIndex:ua,instancedArray:$G,instancedBufferAttribute:Vy,instancedDynamicBufferAttribute:Y2,instancedMesh:hD,int:Q,intBitsToFloat:KV,interleavedGradientNoise:a_,inverse:m5,inverseSqrt:dT,inversesqrt:QP,invocationLocalIndex:y6,invocationSubgroupIndex:g6,ior:_p,iridescence:yx,iridescenceIOR:Oy,iridescenceThickness:Fy,isolate:gd,ivec2:Cs,ivec3:tT,ivec4:nT,js:Tk,label:C5,length:aa,lengthSq:_T,lessThan:VC,lessThanEqual:GC,lightPosition:h_,lightProjectionUV:gB,lightShadowMatrix:Ix,lightTargetDirection:f_,lightTargetPosition:yB,lightViewPosition:d_,lightingContext:yD,lights:A9,linearDepth:Gy,linearToneMapping:oB,localId:Ok,log:bx,log2:ra,logarithmicDepthToViewZ:O6,luminance:l_,mat2:gx,mat3:qs,mat4:vc,matcapUV:ID,materialAO:oD,materialAlphaTest:C4,materialAnisotropy:q4,materialAnisotropyVector:id,materialAttenuationColor:J4,materialAttenuationDistance:Q4,materialClearcoat:I4,materialClearcoatNormal:G4,materialClearcoatRoughness:V4,materialColor:D4,materialDispersion:rD,materialEmissive:L4,materialEnvIntensity:kg,materialEnvRotation:VT,materialIOR:Z4,materialIridescence:$4,materialIridescenceIOR:X4,materialIridescenceThickness:j4,materialLightMap:WT,materialLineDashOffset:sD,materialLineDashSize:eD,materialLineGapSize:nD,materialLineScale:tD,materialLineWidth:h6,materialMetalness:P4,materialNormal:z4,materialOpacity:HT,materialPointSize:iD,materialReference:tl,materialReflectivity:Hg,materialRefractionRatio:d4,materialRotation:k4,materialRoughness:U4,materialSheen:H4,materialSheenRoughness:W4,materialShininess:B4,materialSpecular:O4,materialSpecularColor:F4,materialSpecularIntensity:sw,materialSpecularStrength:Mp,materialThickness:K4,materialTransmission:Y4,max:$n,maxMipLevel:BT,mediumpModelViewMatrix:o4,metalness:il,min:nr,mix:Be,mixElement:_5,mod:Yp,modInt:s5,modelDirection:zz,modelNormalMatrix:r4,modelPosition:Iz,modelRadius:kz,modelScale:Vz,modelViewMatrix:zc,modelViewPosition:Gz,modelViewProjection:aD,modelWorldMatrix:Yr,modelWorldMatrixInverse:Hz,morphReference:gD,mrt:YD,mul:fe,mx_aastep:UB,mx_add:hH,mx_atan2:yH,mx_cell_noise_float:oH,mx_contrast:Z7,mx_divide:pH,mx_fractal_noise_float:aH,mx_fractal_noise_vec2:lH,mx_fractal_noise_vec3:cH,mx_fractal_noise_vec4:uH,mx_frame:bH,mx_heighttonormal:RH,mx_hsvtorgb:G7,mx_ifequal:_H,mx_ifgreater:wH,mx_ifgreatereq:TH,mx_invert:SH,mx_modulo:mH,mx_multiply:fH,mx_noise_float:Q7,mx_noise_vec3:J7,mx_noise_vec4:tH,mx_place2d:vH,mx_power:gH,mx_ramp4:$7,mx_ramplr:W7,mx_ramptb:q7,mx_rgbtohsv:k7,mx_rotate2d:AH,mx_rotate3d:NH,mx_safepower:K7,mx_separate:MH,mx_splitlr:X7,mx_splittb:j7,mx_srgb_texture_to_lin_rec709:H7,mx_subtract:dH,mx_timer:xH,mx_transform_uv:Y7,mx_unifiednoise2d:eH,mx_unifiednoise3d:nH,mx_worley_noise_float:sH,mx_worley_noise_vec2:iH,mx_worley_noise_vec3:rH,negate:gT,neutralToneMapping:hB,nodeArray:Fu,nodeImmutable:$t,nodeObject:Qt,nodeObjectIntent:ip,nodeObjects:px,nodeProxy:be,nodeProxyIntent:kt,normalFlat:c4,normalGeometry:Mx,normalLocal:sr,normalMap:nw,normalView:Ve,normalViewGeometry:Rd,normalWorld:Ic,normalWorldGeometry:u4,normalize:Ji,not:qC,notEqual:IC,numWorkgroups:Dk,objectDirection:Bz,objectGroup:lT,objectPosition:Oz,objectRadius:Pz,objectScale:Fz,objectViewPosition:Uz,objectWorldMatrix:Lz,oneMinus:u5,or:WC,orthographicDepthToViewZ:L6,oscSawtooth:bG,oscSine:gG,oscSquare:yG,oscTriangle:xG,output:md,outputStruct:qV,overloadingFn:ai,packHalf2x16:aG,packSnorm2x16:rG,packUnorm2x16:oG,parabola:lw,parallaxDirection:N4,parallaxUV:r6,parameter:IV,pass:fk,passTexture:pk,pcurve:sG,perspectiveDepthToViewZ:jT,pmremTexture:n_,pointShadow:EB,pointUV:jG,pointWidth:HP,positionGeometry:Zp,positionLocal:Wn,positionPrevious:Nd,positionView:ds,positionViewDirection:yn,positionWorld:ca,positionWorldDirection:PT,posterize:uk,pow:jr,pow2:wT,pow3:b5,pow4:TT,premultiplyAlpha:TD,property:cl,quadBroadcast:_9,quadSwapDiagonal:y9,quadSwapX:m9,quadSwapY:g9,radians:o5,rand:T5,range:Ek,rangeFogFactor:pB,reciprocal:d5,reference:Ln,referenceBuffer:Q2,reflect:g5,reflectVector:m4,reflectView:f4,reflector:EG,refract:MT,refractVector:g4,refractView:p4,reinhardToneMapping:aB,remap:$5,remapClamp:X5,renderGroup:ne,renderOutput:Y5,rendererReference:I5,replaceDefaultUV:SG,rotate:Qp,rotateUV:wG,roughness:Zo,round:h5,rtt:tB,sRGBTransferEOTF:F5,sRGBTransferOETF:U5,sample:zG,sampler:Tz,samplerComparison:_z,saturate:wx,saturation:ok,screenCoordinate:ju,screenDPR:e4,screenSize:Gu,screenUV:la,select:bi,setCurrentStack:zp,setName:AT,shaderStages:W2,shadow:AB,shadowPositionWorld:m_,shapeCircle:j9,sharedUniformGroup:xx,sheen:br,sheenRoughness:dc,shiftLeft:ZC,shiftRight:QC,shininess:Py,sign:mT,sin:Ci,sinc:iG,skinning:pD,smoothstep:Eo,smoothstepElement:M5,specularColor:Dc,specularColorBlended:Cu,specularF90:Du,spherizeUV:TG,split:GP,spritesheetUV:vG,sqrt:Oi,stack:Wg,step:Ad,stepElement:v5,storage:Nc,storageBarrier:zk,storageTexture:sB,string:IP,struct:WV,sub:Oe,subBuild:Pu,subgroupAdd:e9,subgroupAll:d9,subgroupAnd:a9,subgroupAny:f9,subgroupBallot:t9,subgroupBroadcast:x9,subgroupBroadcastFirst:p9,subgroupElect:Jk,subgroupExclusiveAdd:s9,subgroupExclusiveMul:o9,subgroupInclusiveAdd:n9,subgroupInclusiveMul:r9,subgroupIndex:m6,subgroupMax:h9,subgroupMin:u9,subgroupMul:i9,subgroupOr:l9,subgroupShuffle:b9,subgroupShuffleDown:T9,subgroupShuffleUp:w9,subgroupShuffleXor:S9,subgroupSize:Fk,subgroupXor:c9,tan:l5,tangentGeometry:Ax,tangentLocal:Ed,tangentView:Nx,tangentWorld:v4,texture:qe,texture3D:Ux,texture3DLevel:tk,texture3DLoad:JG,textureBarrier:Ik,textureBicubic:SI,textureBicubicLevel:e_,textureCubeUV:UD,textureLevel:wz,textureLoad:Qn,textureSize:Ac,textureStore:KG,thickness:iT,time:Od,toneMapping:V5,toneMappingExposure:G5,toonOutlinePass:yk,transformDirection:S5,transformNormal:h4,transformNormalToView:IT,transformedClearcoatNormalView:Xz,transformedNormalView:qz,transformedNormalWorld:$z,transmission:zy,transpose:f5,triNoise3D:dG,triplanarTexture:AG,triplanarTextures:JD,trunc:bT,uint:zt,uintBitsToFloat:ZV,uniform:te,uniformArray:yi,uniformCubeTexture:Yz,uniformFlow:N5,uniformGroup:LC,uniformTexture:Sz,unpackHalf2x16:uG,unpackNormal:ew,unpackSnorm2x16:lG,unpackUnorm2x16:cG,unpremultiplyAlpha:X6,userData:nk,uv:fn,uvec2:Jw,uvec3:Xu,uvec4:sT,varying:Uc,varyingProperty:Ip,vec2:Vt,vec3:st,vec4:ie,vectorComponents:qu,velocity:ik,vertexColor:wD,vertexIndex:lD,vertexStage:O5,vibrance:ak,viewZToLogarithmicDepth:YT,viewZToOrthographicDepth:yd,viewZToPerspectiveDepth:XT,viewZToReversedOrthographicDepth:B6,viewZToReversedPerspectiveDepth:bD,viewport:FT,viewportCoordinate:n4,viewportDepthTexture:$T,viewportLinearDepth:F6,viewportMipTexture:qT,viewportOpaqueMipTexture:xD,viewportResolution:Rz,viewportSafeUV:MG,viewportSharedTexture:dk,viewportSize:UT,viewportTexture:E6,viewportUV:Nz,vogelDiskSample:_o,wgsl:_k,wgslFn:Ak,workgroupArray:kk,workgroupBarrier:Pk,workgroupId:Bk,workingToColorSpace:P5,xor:$C});const xo=new s_;class CH extends Vc{constructor(t,e){super(),this.renderer=t,this.nodes=e}update(t,e,n){const s=this.renderer,i=this.nodes.getBackgroundNode(t)||t.background;let a=!1;if(i===null)s._clearColor.getRGB(xo),xo.a=s._clearColor.a;else if(i.isColor===!0)i.getRGB(xo),xo.a=1,a=!0;else if(i.isNode===!0){const d=this.get(t),f=i;xo.copy(s._clearColor);let p=d.backgroundMesh;if(p===void 0){let A=function(){i.removeEventListener("dispose",A),p.material.dispose(),p.geometry.dispose()};var u=A;const y=ie(f).mul(cw).context({getUV:()=>nB.mul(u4),getTextureLevel:()=>eB}),x=ul.element(3).element(3).equal(1),S=Nr(1,ul.element(1).element(1)).mul(3),T=x.select(Wn.mul(S),Wn),M=zc.mul(ie(T,0));let N=ul.mul(ie(M.xyz,1));N=N.setZ(N.w);const v=new Xn;v.name="Background.material",v.side=Ss,v.depthTest=!1,v.depthWrite=!1,v.allowOverride=!1,v.fog=!1,v.lights=!1,v.vertexNode=N,v.colorNode=y,d.backgroundMeshNode=y,d.backgroundMesh=p=new C(new We(1,32,32),v),p.frustumCulled=!1,p.name="Background.mesh",i.addEventListener("dispose",A)}const g=f.getCacheKey();d.backgroundCacheKey!==g&&(d.backgroundMeshNode.node=ie(f).mul(cw),d.backgroundMeshNode.needsUpdate=!0,p.material.needsUpdate=!0,d.backgroundCacheKey=g),e.unshift(p,p.geometry,p.material,0,0,null,null)}else Ht("Renderer: Unsupported background configuration.",i);const c=s.xr.getEnvironmentBlendMode();if(c==="additive"?xo.set(0,0,0,1):c==="alpha-blend"&&xo.set(0,0,0,0),s.autoClear===!0||a===!0){const d=n.clearColorValue;d.r=xo.r,d.g=xo.g,d.b=xo.b,d.a=xo.a,(s.backend.isWebGLBackend===!0||s.alpha===!0)&&(d.r*=d.a,d.g*=d.a,d.b*=d.a),n.depthClearValue=s.getClearDepth(),n.stencilClearValue=s.getClearStencil(),n.clearColor=s.autoClearColor===!0,n.clearDepth=s.autoClearDepth===!0,n.clearStencil=s.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let DH=0;class hw{constructor(t="",e=[],n=0){this.name=t,this.bindings=e,this.index=n,this.id=DH++}}class BH{constructor(t,e,n,s,i,a,c,u,d,f=[]){this.vertexShader=t,this.fragmentShader=e,this.computeShader=n,this.transforms=f,this.nodeAttributes=s,this.bindings=i,this.updateNodes=a,this.updateBeforeNodes=c,this.updateAfterNodes=u,this.observer=d,this.usedTimes=0}createBindings(){const t=[];for(const e of this.bindings)if(e.bindings[0].groupNode.shared!==!0){const s=new hw(e.name,[],e.index);t.push(s);for(const i of e.bindings)s.bindings.push(i.clone())}else t.push(e);return t}}class qR{constructor(t,e,n=null){this.isNodeAttribute=!0,this.name=t,this.type=e,this.node=n}}class LH{constructor(t,e,n){this.isNodeUniform=!0,this.name=t,this.type=e,this.node=n}get value(){return this.node.value}set value(t){this.node.value=t}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class VB{constructor(t,e,n=!1,s=null){this.isNodeVar=!0,this.name=t,this.type=e,this.readOnly=n,this.count=s}}class OH extends VB{constructor(t,e,n=null,s=null){super(t,e),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=s}}class FH{constructor(t,e,n=""){this.name=t,this.type=e,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let UH=0;class n2{constructor(t=null){this.id=UH++,this.nodesData=new WeakMap,this.parent=t}getData(t){let e=this.nodesData.get(t);return e===void 0&&this.parent!==null&&(e=this.parent.getData(t)),e}setData(t,e){this.nodesData.set(t,e)}}class PH{constructor(t,e){this.name=t,this.members=e,this.output=!1}}class Gc{constructor(t,e){this.name=t,this.value=e,this.boundary=0,this.itemSize=0,this.offset=0,this.index=-1}setValue(t){this.value=t}getValue(){return this.value}}class zH extends Gc{constructor(t,e=0){super(t,e),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class IH extends Gc{constructor(t,e=new Ut){super(t,e),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class VH extends Gc{constructor(t,e=new V){super(t,e),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class GH extends Gc{constructor(t,e=new Ze){super(t,e),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class kH extends Gc{constructor(t,e=new Xt){super(t,e),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class HH extends Gc{constructor(t,e=new hx){super(t,e),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class WH extends Gc{constructor(t,e=new rr){super(t,e),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class qH extends Gc{constructor(t,e=new ve){super(t,e),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class $H extends zH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class XH extends IH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class jH extends VH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class YH extends GH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class KH extends kH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class ZH extends HH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class QH extends WH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class JH extends qH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let tW=0;const $R=new WeakMap,eW=new WeakMap,nW=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),ug=r=>/e/g.test(r)?String(r).replace(/\+/g,""):(r=Number(r),r+(r%1?"":".0"));class GB{constructor(t,e,n){this.object=t,this.material=t&&t.material||null,this.geometry=t&&t.geometry||null,this.renderer=e,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=Wg(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new n2,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:tW++})}isFlatShading(){return this.material.flatShading===!0||this.geometry.hasAttribute("normal")===!1}isOpaque(){const t=this.material;return t.transparent===!1&&t.blending===mi&&t.alphaToCoverage===!1}createRenderTarget(t,e,n){return new fl(t,e,n)}createCubeRenderTarget(t,e){return new _D(t,e)}includes(t){return this.nodes.includes(t)}getOutputStructName(){}_getBindGroup(t,e){const n=e[0].groupNode;let s=n.shared;if(s)for(let a=1;a<e.length;a++)n!==e[a].groupNode&&(s=!1);let i;if(s){let a="";for(const f of e)if(f.isNodeUniformsGroup){f.uniforms.sort((p,g)=>p.nodeUniform.node.id-g.nodeUniform.node.id);for(const p of f.uniforms)a+=p.nodeUniform.node.id}else a+=f.nodeUniform.id;const c=this.renderer._currentRenderContext||this.renderer;let u=$R.get(c);u===void 0&&(u=new Map,$R.set(c,u));const d=Dd(a);i=u.get(d),i===void 0&&(i=new hw(t,e,this.bindingsIndexes[t].group),u.set(d,i))}else i=new hw(t,e,this.bindingsIndexes[t].group);return i}getBindGroupArray(t,e){const n=this.bindings[e];let s=n[t];return s===void 0&&(this.bindingsIndexes[t]===void 0&&(this.bindingsIndexes[t]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[t]=s=[]),s}getBindings(){let t=this.bindGroups;if(t===null){const e={},n=this.bindings;for(const s of W2)for(const i in n[s]){const a=n[s][i],c=e[i]||(e[i]=[]);for(const u of a)c.includes(u)===!1&&c.push(u)}t=[];for(const s in e){const i=e[s],a=this._getBindGroup(s,i);t.push(a)}this.bindGroups=t}return t}sortBindingGroups(){const t=this.getBindings();t.sort((e,n)=>e.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let e=0;e<t.length;e++){const n=t[e];this.bindingsIndexes[n.name].group=e,n.index=e}}setHashNode(t,e){this.hashNodes[e]=t}addNode(t){this.nodes.includes(t)===!1&&(this.nodes.push(t),this.setHashNode(t,t.getHash(this)))}addSequentialNode(t){const e=t.getUpdateBeforeType(),n=t.getUpdateAfterType();(e!==de.NONE||n!==de.NONE)&&this.sequentialNodes.includes(t)===!1&&this.sequentialNodes.push(t)}buildUpdateNodes(){for(const t of this.nodes)t.getUpdateType()!==de.NONE&&this.updateNodes.push(t);for(const t of this.sequentialNodes){const e=t.getUpdateBeforeType(),n=t.getUpdateAfterType();e!==de.NONE&&this.updateBeforeNodes.push(t),n!==de.NONE&&this.updateAfterNodes.push(t)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(t){return t.magFilter===$s||t.magFilter===B2||t.magFilter===Cp||t.magFilter===sa||t.minFilter===$s||t.minFilter===B2||t.minFilter===Cp||t.minFilter===sa}getUniformBufferLimit(){return 16384}addChain(t){this.chaining.push(t)}removeChain(t){if(this.chaining.pop()!==t)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(t){return t}getTernary(){return null}getNodeFromHash(t){return this.hashNodes[t]}addFlow(t,e){return this.flowNodes[t].push(e),e}setContext(t){this.context=t}getContext(){return this.context}addContext(t){const e=this.getContext();return this.setContext({...this.context,...t}),e}getSharedContext(){const t={...this.context};return delete t.material,delete t.getUV,delete t.getOutput,delete t.getTextureLevel,delete t.getAO,delete t.getShadow,t}setCache(t){this.cache=t}getCache(){return this.cache}getCacheFromNode(t,e=!0){const n=this.getDataFromNode(t);return n.cache===void 0&&(n.cache=new n2(e?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){Wt("Abstract function.")}getInstanceIndex(){Wt("Abstract function.")}getDrawIndex(){Wt("Abstract function.")}getFrontFacing(){Wt("Abstract function.")}getFragCoord(){Wt("Abstract function.")}isFlipY(){return!1}increaseUsage(t){const e=this.getDataFromNode(t);return e.usageCount=e.usageCount===void 0?1:e.usageCount+1,e.usageCount}generateTexture(){Wt("Abstract function.")}generateTextureLod(){Wt("Abstract function.")}generateArrayDeclaration(t,e){return this.getType(t)+"[ "+e+" ]"}generateArray(t,e,n=null){let s=this.generateArrayDeclaration(t,e)+"( ";for(let i=0;i<e;i++){const a=n?n[i]:null;a!==null?s+=a.build(this,t):s+=this.generateConst(t),i<e-1&&(s+=", ")}return s+=" )",s}generateStruct(t,e,n=null){const s=[];for(const i of e){const{name:a,type:c}=i;n&&n[a]&&n[a].isNode?s.push(n[a].build(this,c)):s.push(this.generateConst(c))}return t+"( "+s.join(", ")+" )"}generateConst(t,e=null){if(e===null&&(t==="float"||t==="int"||t==="uint"?e=0:t==="bool"?e=!1:t==="color"?e=new Xt:t==="vec2"||t==="uvec2"||t==="ivec2"?e=new Ut:t==="vec3"||t==="uvec3"||t==="ivec3"?e=new V:(t==="vec4"||t==="uvec4"||t==="ivec4")&&(e=new Ze)),t==="float")return ug(e);if(t==="int")return`${Math.round(e)}`;if(t==="uint")return e>=0?`${Math.round(e)}u`:"0u";if(t==="bool")return e?"true":"false";if(t==="color")return`${this.getType("vec3")}( ${ug(e.r)}, ${ug(e.g)}, ${ug(e.b)} )`;const n=this.getTypeLength(t),s=this.getComponentType(t),i=a=>this.generateConst(s,a);if(n===2)return`${this.getType(t)}( ${i(e.x)}, ${i(e.y)} )`;if(n===3)return`${this.getType(t)}( ${i(e.x)}, ${i(e.y)}, ${i(e.z)} )`;if(n===4&&t!=="mat2")return`${this.getType(t)}( ${i(e.x)}, ${i(e.y)}, ${i(e.z)}, ${i(e.w)} )`;if(n>=4&&e&&(e.isMatrix2||e.isMatrix3||e.isMatrix4))return`${this.getType(t)}( ${e.elements.map(i).join(", ")} )`;if(n>4)return`${this.getType(t)}()`;throw new Error(`NodeBuilder: Type '${t}' not found in generate constant attempt.`)}getType(t){return t==="color"?"vec3":t}hasGeometryAttribute(t){return this.geometry&&this.geometry.getAttribute(t)!==void 0}getAttribute(t,e){const n=this.attributes;for(const i of n)if(i.name===t)return i;const s=new qR(t,e);return this.registerDeclaration(s),n.push(s),s}getPropertyName(t){return t.name}isVector(t){return/vec\d/.test(t)}isMatrix(t){return/mat\d/.test(t)}isReference(t){return t==="void"||t==="property"||t==="sampler"||t==="samplerComparison"||t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="depthTexture"||t==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(t){const e=t.type;if(t.isDataTexture){if(e===pi)return"int";if(e===Jn)return"uint"}return"float"}getElementType(t){return t==="mat2"?"vec2":t==="mat3"?"vec3":t==="mat4"?"vec4":this.getComponentType(t)}getComponentType(t){if(t=this.getVectorType(t),t==="float"||t==="bool"||t==="int"||t==="uint")return t;const e=/(b|i|u|)(vec|mat)([2-4])/.exec(t);return e===null?null:e[1]==="b"?"bool":e[1]==="i"?"int":e[1]==="u"?"uint":"float"}getVectorType(t){return t==="color"?"vec3":t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"?"vec4":t}getTypeFromLength(t,e="float"){if(t===1)return e;let n=xC(t);const s=e==="float"?"":e[0];return/mat2/.test(e)===!0&&(n=n.replace("vec","mat")),s+n}getTypeFromArray(t){return nW.get(t.constructor)}isInteger(t){return/int|uint|(i|u)vec/.test(t)}getTypeFromAttribute(t){let e=t;t.isInterleavedBufferAttribute&&(e=t.data);const n=e.array,s=t.itemSize,i=t.normalized;let a;return!(t instanceof sC)&&i!==!0&&(a=this.getTypeFromArray(n)),this.getTypeFromLength(s,a)}getTypeLength(t){const e=this.getVectorType(t),n=/vec([2-4])/.exec(e);return n!==null?Number(n[1]):e==="float"||e==="bool"||e==="int"||e==="uint"?1:/mat2/.test(t)===!0?4:/mat3/.test(t)===!0?9:/mat4/.test(t)===!0?16:0}getVectorFromMatrix(t){return t.replace("mat","vec")}changeComponentType(t,e){return this.getTypeFromLength(this.getTypeLength(t),e)}getIntegerType(t){const e=this.getComponentType(t);return e==="int"||e==="uint"?t:this.changeComponentType(t,"int")}setActiveStack(t){this.activeStacks.push(t)}removeActiveStack(t){if(this.activeStacks[this.activeStacks.length-1]===t)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=Wg(this.stack);const t=Qw();return this.stacks.push(t),zp(this.stack),this.stack}removeStack(){const t=this.stack;for(const e of t.nodes){const n=this.getDataFromNode(e);n.stack=t}return this.stack=t.parent,zp(this.stacks.pop()),t}getDataFromNode(t,e=this.shaderStage,n=null){n=n===null?t.isGlobal(this)?this.globalCache:this.cache:n;let s=n.getData(t);s===void 0&&(s={},n.setData(t,s)),s[e]===void 0&&(s[e]={});let i=s[e];const a=s.any?s.any.subBuilds:null,c=this.getClosestSubBuild(a);return c&&(i.subBuildsCache===void 0&&(i.subBuildsCache={}),i=i.subBuildsCache[c]||(i.subBuildsCache[c]={}),i.subBuilds=a),i}getNodeProperties(t,e="any"){const n=this.getDataFromNode(t,e);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(t,e){const n=this.getDataFromNode(t,"vertex");let s=n.bufferAttribute;if(s===void 0){const i=this.uniforms.index++;s=new qR("nodeAttribute"+i,e,t),this.bufferAttributes.push(s),n.bufferAttribute=s}return s}getStructTypeNode(t,e=this.shaderStage){return this.types[e][t]||null}getStructTypeFromNode(t,e,n=null,s=this.shaderStage){const i=this.getDataFromNode(t,s,this.globalCache);let a=i.structType;if(a===void 0){const c=this.structs.index++;n===null&&(n="StructType"+c),a=new PH(n,e),this.structs[s].push(a),this.types[s][n]=t,i.structType=a}return a}getOutputStructTypeFromNode(t,e){const n=this.getStructTypeFromNode(t,e,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(t,e,n=this.shaderStage,s=null){const i=this.getDataFromNode(t,n,this.globalCache);let a=i.uniform;if(a===void 0){const c=this.uniforms.index++;a=new LH(s||"nodeUniform"+c,e,t),this.uniforms[n].push(a),this.registerDeclaration(a),i.uniform=a}return a}getVarFromNode(t,e=null,n=t.getNodeType(this),s=this.shaderStage,i=!1){const a=this.getDataFromNode(t,s),c=this.getSubBuildProperty("variable",a.subBuilds);let u=a[c];if(u===void 0){const d=i?"_const":"_var",f=this.vars[s]||(this.vars[s]=[]),p=this.vars[d]||(this.vars[d]=0);e===null&&(e=(i?"nodeConst":"nodeVar")+p,this.vars[d]++),c!=="variable"&&(e=this.getSubBuildProperty(e,a.subBuilds));const g=t.getArrayCount(this);u=new VB(e,n,i,g),i||f.push(u),this.registerDeclaration(u),a[c]=u}return u}isDeterministic(t){if(t.isMathNode)return this.isDeterministic(t.aNode)&&(t.bNode?this.isDeterministic(t.bNode):!0)&&(t.cNode?this.isDeterministic(t.cNode):!0);if(t.isOperatorNode)return this.isDeterministic(t.aNode)&&(t.bNode?this.isDeterministic(t.bNode):!0);if(t.isArrayNode){if(t.values!==null){for(const e of t.values)if(!this.isDeterministic(e))return!1}return!0}else if(t.isConstNode)return!0;return!1}getVaryingFromNode(t,e=null,n=t.getNodeType(this),s=null,i=null){const a=this.getDataFromNode(t,"any"),c=this.getSubBuildProperty("varying",a.subBuilds);let u=a[c];if(u===void 0){const d=this.varyings,f=d.length;e===null&&(e="nodeVarying"+f),c!=="varying"&&(e=this.getSubBuildProperty(e,a.subBuilds)),u=new OH(e,n,s,i),d.push(u),this.registerDeclaration(u),a[c]=u}return u}registerDeclaration(t){const e=this.shaderStage,n=this.declarations[e]||(this.declarations[e]={}),s=this.getPropertyName(t);let i=1,a=s;for(;n[a]!==void 0;)a=s+"_"+i++;i>1&&(t.name=a,Wt(`TSL: Declaration name '${s}' of '${t.type}' already in use. Renamed to '${a}'.`)),n[a]=t}getCodeFromNode(t,e,n=this.shaderStage){const s=this.getDataFromNode(t);let i=s.code;if(i===void 0){const a=this.codes[n]||(this.codes[n]=[]),c=a.length;i=new FH("nodeCode"+c,e),a.push(i),s.code=i}return i}addFlowCodeHierarchy(t,e){const{flowCodes:n,flowCodeBlock:s}=this.getDataFromNode(t);let i=!0,a=e;for(;a;){if(s.get(a)===!0){i=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(i)for(const c of n)this.addLineFlowCode(c)}addLineFlowCodeBlock(t,e,n){const s=this.getDataFromNode(t),i=s.flowCodes||(s.flowCodes=[]),a=s.flowCodeBlock||(s.flowCodeBlock=new WeakMap);i.push(e),a.set(n,!0)}addLineFlowCode(t,e=null){return t===""?this:(e!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(e,t,this.context.nodeBlock),t=this.tab+t,/;\s*$/.test(t)||(t=t+`;
`),this.flow.code+=t,this)}addFlowCode(t){return this.flow.code+=t,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(t){return this.flowsData.get(t)}flowNode(t){const e=t.getNodeType(this),n=this.flowChildNode(t,e);return this.flowsData.set(t,n),n}addInclude(t){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(t)}buildFunctionNode(t){const e=new dB,n=this.currentFunctionNode;return this.currentFunctionNode=e,e.code=this.buildFunctionCode(t),this.currentFunctionNode=n,e}flowShaderNode(t){const e=t.layout,n={[Symbol.iterator](){let a=0;const c=Object.values(this);return{next:()=>({value:c[a],done:a++>=c.length})}}};for(const a of e.inputs)n[a.name]=new qD(a.type,a.name);t.layout=null;const s=t.call(n),i=this.flowStagesNode(s,e.type);return t.layout=e,i}flowBuildStage(t,e,n=null){const s=this.getBuildStage();this.setBuildStage(e);const i=t.build(this,n);return this.setBuildStage(s),i}flowStagesNode(t,e=null){const n=this.flow,s=this.vars,i=this.declarations,a=this.cache,c=this.buildStage,u=this.stack,d={code:""};this.flow=d,this.vars={},this.declarations={},this.cache=new n2,this.stack=Wg();for(const f of H2)this.setBuildStage(f),d.result=t.build(this,e);return d.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=s,this.declarations=i,this.cache=a,this.stack=u,this.setBuildStage(c),d}getFunctionOperator(){return null}buildFunctionCode(){Wt("Abstract function.")}flowChildNode(t,e=null){const n=this.flow,s={code:""};return this.flow=s,s.result=t.build(this,e),this.flow=n,s}flowNodeFromShaderStage(t,e,n=null,s=null){const i=this.tab,a=this.cache,c=this.shaderStage,u=this.context;this.setShaderStage(t);const d={...this.context};delete d.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=d;let f=null;if(this.buildStage==="generate"){const p=this.flowChildNode(e,n);s!==null&&(p.code+=`${this.tab+s} = ${p.result};
`),this.flowCode[t]=this.flowCode[t]+p.code,f=p}else f=e.build(this);return this.setShaderStage(c),this.cache=a,this.tab=i,this.context=u,f}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){Wt("Abstract function.")}getVaryings(){Wt("Abstract function.")}getVar(t,e,n=null){return`${n!==null?this.generateArrayDeclaration(t,n):this.getType(t)} ${e}`}getVars(t){let e="";const n=this.vars[t];if(n!==void 0)for(const s of n)e+=`${this.getVar(s.type,s.name)}; `;return e}getUniforms(){Wt("Abstract function.")}getCodes(t){const e=this.codes[t];let n="";if(e!==void 0)for(const s of e)n+=s.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(t){this.shaderStage=t}getShaderStage(){return this.shaderStage}setBuildStage(t){this.buildStage=t}getBuildStage(){return this.buildStage}buildCode(){Wt("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(t){this.subBuildLayers.push(t)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(t){let e;if(t&&t.isNode?t.isShaderCallNodeInternal?e=t.shaderNode.subBuilds:t.isStackNode?e=[t.subBuild]:e=this.getDataFromNode(t,"any").subBuilds:t instanceof Set?e=[...t]:e=t,!e)return null;const n=this.subBuildLayers;for(let s=e.length-1;s>=0;s--){const i=e[s];if(n.includes(i))return i}return null}getSubBuildOutput(t){return this.getSubBuildProperty("outputNode",t)}getSubBuildProperty(t="",e=null){let n;e!==null?n=this.getClosestSubBuild(e):n=this.subBuildFn;let s;return n?s=t?n+"_"+t:n:s=t,s}build(){const{object:t,material:e,renderer:n}=this;if(e!==null){let s=n.library.fromMaterial(e);s===null&&(Ht(`NodeMaterial: Material "${e.type}" is not compatible.`),s=new Xn),s.build(this)}else this.addFlow("compute",t);for(const s of H2){this.setBuildStage(s),this.context.position&&this.context.position.isNode&&this.flowNodeFromShaderStage("vertex",this.context.position);for(const i of W2){this.setShaderStage(i);const a=this.flowNodes[i];for(const c of a)s==="generate"?this.flowNode(c):c.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getSharedDataFromNode(t){let e=eW.get(t);return e===void 0&&(e={}),e}getNodeUniform(t,e){const n=this.getSharedDataFromNode(t);let s=n.cache;if(s===void 0){if(e==="float"||e==="int"||e==="uint")s=new $H(t);else if(e==="vec2"||e==="ivec2"||e==="uvec2")s=new XH(t);else if(e==="vec3"||e==="ivec3"||e==="uvec3")s=new jH(t);else if(e==="vec4"||e==="ivec4"||e==="uvec4")s=new YH(t);else if(e==="color")s=new KH(t);else if(e==="mat2")s=new ZH(t);else if(e==="mat3")s=new QH(t);else if(e==="mat4")s=new JH(t);else throw new Error(`Uniform "${e}" not implemented.`);n.cache=s}return s}format(t,e,n){if(e=this.getVectorType(e),n=this.getVectorType(n),e===n||n===null||this.isReference(n))return t;const s=this.getTypeLength(e),i=this.getTypeLength(n);return s===16&&i===9?`${this.getType(n)}( ${t}[ 0 ].xyz, ${t}[ 1 ].xyz, ${t}[ 2 ].xyz )`:s===9&&i===4?`${this.getType(n)}( ${t}[ 0 ].xy, ${t}[ 1 ].xy )`:s>4||i>4||i===0?t:s===i?`${this.getType(n)}( ${t} )`:s>i?(t=n==="bool"?`all( ${t} )`:`${t}.${"xyz".slice(0,i)}`,this.format(t,this.getTypeFromLength(i,this.getComponentType(e)),n)):i===4&&s>1?`${this.getType(n)}( ${this.format(t,e,"vec3")}, 1.0 )`:s===2?`${this.getType(n)}( ${this.format(t,e,"vec2")}, 0.0 )`:(s===1&&i>1&&e!==this.getComponentType(n)&&(t=`${this.getType(this.getComponentType(n))}( ${t} )`),`${this.getType(n)}( ${t} )`)}getSignature(){return`// Three.js r${Hp} - Node System
`}needsPreviousData(){const t=this.renderer.getMRT();return t&&t.has("velocity")||SC(this.object).useVelocity===!0}}class XR{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(t,e){let n=t.get(e);return n===void 0&&(n={renderId:0,frameId:0},t.set(e,n)),n}updateBeforeNode(t){const e=t.getUpdateBeforeType(),n=t.updateReference(this);if(e===de.FRAME){const s=this._getMaps(this.updateBeforeMap,n);if(s.frameId!==this.frameId){const i=s.frameId;s.frameId=this.frameId,t.updateBefore(this)===!1&&(s.frameId=i)}}else if(e===de.RENDER){const s=this._getMaps(this.updateBeforeMap,n);if(s.renderId!==this.renderId){const i=s.renderId;s.renderId=this.renderId,t.updateBefore(this)===!1&&(s.renderId=i)}}else e===de.OBJECT&&t.updateBefore(this)}updateAfterNode(t){const e=t.getUpdateAfterType(),n=t.updateReference(this);if(e===de.FRAME){const s=this._getMaps(this.updateAfterMap,n);s.frameId!==this.frameId&&t.updateAfter(this)!==!1&&(s.frameId=this.frameId)}else if(e===de.RENDER){const s=this._getMaps(this.updateAfterMap,n);s.renderId!==this.renderId&&t.updateAfter(this)!==!1&&(s.renderId=this.renderId)}else e===de.OBJECT&&t.updateAfter(this)}updateNode(t){const e=t.getUpdateType(),n=t.updateReference(this);if(e===de.FRAME){const s=this._getMaps(this.updateMap,n);s.frameId!==this.frameId&&t.update(this)!==!1&&(s.frameId=this.frameId)}else if(e===de.RENDER){const s=this._getMaps(this.updateMap,n);s.renderId!==this.renderId&&t.update(this)!==!1&&(s.renderId=this.renderId)}else e===de.OBJECT&&t.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class b_{constructor(t,e,n=null,s="",i=!1){this.type=t,this.name=e,this.count=n,this.qualifier=s,this.isConst=i}}b_.isNodeFunctionInput=!0;class sW extends Yu{static get type(){return"AmbientLightNode"}constructor(t=null){super(t)}setup({context:t}){t.irradiance.addAssign(this.colorNode)}}class iW extends Yu{static get type(){return"DirectionalLightNode"}constructor(t=null){super(t)}setupDirect(){const t=this.colorNode;return{lightDirection:f_(this.light),lightColor:t}}}class rW extends Yu{static get type(){return"HemisphereLightNode"}constructor(t=null){super(t),this.lightPositionNode=h_(t),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=te(new Xt).setGroup(ne)}update(t){const{light:e}=this;super.update(t),this.lightPositionNode.object3d=e,this.groundColorNode.value.copy(e.groundColor).multiplyScalar(e.intensity)}setup(t){const{colorNode:e,groundColorNode:n,lightDirectionNode:s}=this,a=Ic.dot(s).mul(.5).add(.5),c=Be(n,e,a);t.context.irradiance.addAssign(c)}}class S_ extends Yu{static get type(){return"SpotLightNode"}constructor(t=null){super(t),this.coneCosNode=te(0).setGroup(ne),this.penumbraCosNode=te(0).setGroup(ne),this.cutoffDistanceNode=te(0).setGroup(ne),this.decayExponentNode=te(0).setGroup(ne),this.colorNode=te(this.color).setGroup(ne)}update(t){super.update(t);const{light:e}=this;this.coneCosNode.value=Math.cos(e.angle),this.penumbraCosNode.value=Math.cos(e.angle*(1-e.penumbra)),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}getSpotAttenuation(t,e){const{coneCosNode:n,penumbraCosNode:s}=this;return Eo(n,s,e)}getLightCoord(t){const e=t.getNodeProperties(this);let n=e.projectionUV;return n===void 0&&(n=gB(this.light,t.context.positionWorld),e.projectionUV=n),n}setupDirect(t){const{colorNode:e,cutoffDistanceNode:n,decayExponentNode:s,light:i}=this,a=this.getLightVector(t),c=a.normalize(),u=c.dot(f_(i)),d=this.getSpotAttenuation(t,u),f=a.length(),p=g_({lightDistance:f,cutoffDistance:n,decayExponent:s});let g=e.mul(d).mul(p),y,x;return i.colorNode?(x=this.getLightCoord(t),y=i.colorNode(x)):i.map&&(x=this.getLightCoord(t),y=qe(i.map,x.xy).onRenderUpdate(()=>i.map)),y&&(g=x.mul(2).sub(1).abs().lessThan(1).all().select(g.mul(y),g)),{lightColor:g,lightDirection:c}}}class oW extends S_{static get type(){return"IESSpotLightNode"}getSpotAttenuation(t,e){const n=this.light.iesMap;let s=null;if(n&&n.isTexture===!0){const i=e.acos().mul(1/Math.PI);s=qe(n,Vt(i,0),0).r}else s=super.getSpotAttenuation(e);return s}}class aW extends Yu{static get type(){return"LightProbeNode"}constructor(t=null){super(t);const e=[];for(let n=0;n<9;n++)e.push(new V);this.lightProbe=yi(e)}update(t){const{light:e}=this;super.update(t);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(e.sh.coefficients[n]).multiplyScalar(e.intensity)}setup(t){const e=IB(Ic,this.lightProbe);t.context.irradiance.addAssign(e)}}const lW=ot(([r,t])=>{const e=r.abs().sub(t);return aa($n(e,0)).add(nr($n(e.x,e.y),0))});class cW extends S_{static get type(){return"ProjectorLightNode"}update(t){super.update(t);const e=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(e.angle*(1-e.penumbra)),.99999),e.aspect===null){let n=1;e.map!==null&&(n=e.map.width/e.map.height),e.shadow.aspect=n}else e.shadow.aspect=e.aspect}getSpotAttenuation(t){const e=G(0),n=this.penumbraCosNode,s=Ix(this.light).mul(t.context.positionWorld||ca);return re(s.w.greaterThan(0),()=>{const i=s.xyz.div(s.w),a=lW(i.xy.sub(Vt(.5)),Vt(.5)),c=Nr(-1,Oe(1,fT(n)).sub(1));e.assign(wx(a.mul(-2).mul(c)))}),e}}const s2=new ve,hg=new ve;let qf=null;class uW extends Yu{static get type(){return"RectAreaLightNode"}constructor(t=null){super(t),this.halfHeight=te(new V).setGroup(ne),this.halfWidth=te(new V).setGroup(ne),this.updateType=de.RENDER}update(t){super.update(t);const{light:e}=this,n=t.camera.matrixWorldInverse;hg.identity(),s2.copy(e.matrixWorld),s2.premultiply(n),hg.extractRotation(s2),this.halfWidth.value.set(e.width*.5,0,0),this.halfHeight.value.set(0,e.height*.5,0),this.halfWidth.value.applyMatrix4(hg),this.halfHeight.value.applyMatrix4(hg)}setupDirectRectArea(t){let e,n;t.isAvailable("float32Filterable")?(e=qe(qf.LTC_FLOAT_1),n=qe(qf.LTC_FLOAT_2)):(e=qe(qf.LTC_HALF_1),n=qe(qf.LTC_HALF_2));const{colorNode:s,light:i}=this,a=d_(i);return{lightColor:s,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:e,ltc_2:n}}static setLTC(t){qf=t}}class kB{parseFunction(){Wt("Abstract function.")}}class w_{constructor(t,e,n="",s=""){this.type=t,this.inputs=e,this.name=n,this.precision=s}getCode(){Wt("Abstract function.")}}w_.isNodeFunction=!0;const hW=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,dW=/[a-z_0-9]+/ig,jR="#pragma main",fW=r=>{r=r.trim();const t=r.indexOf(jR),e=t!==-1?r.slice(t+jR.length):r,n=e.match(hW);if(n!==null&&n.length===5){const s=n[4],i=[];let a=null;for(;(a=dW.exec(s))!==null;)i.push(a);const c=[];let u=0;for(;u<i.length;){const x=i[u][0]==="const";x===!0&&u++;let S=i[u][0];S==="in"||S==="out"||S==="inout"?u++:S="";const T=i[u++][0];let M=Number.parseInt(i[u][0]);Number.isNaN(M)===!1?u++:M=null;const N=i[u++][0];c.push(new b_(T,N,M,S,x))}const d=e.substring(n[0].length),f=n[3]!==void 0?n[3]:"",p=n[2],g=n[1]!==void 0?n[1]:"",y=t!==-1?r.slice(0,t):"";return{type:p,inputs:c,name:f,precision:g,inputsCode:s,blockCode:d,headerCode:y}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class pW extends w_{constructor(t){const{type:e,inputs:n,name:s,precision:i,inputsCode:a,blockCode:c,headerCode:u}=fW(t);super(e,n,s,i),this.inputsCode=a,this.blockCode=c,this.headerCode=u}getCode(t=this.name){let e;const n=this.blockCode;if(n!==""){const{type:s,inputsCode:i,headerCode:a,precision:c}=this;let u=`${s} ${t} ( ${i.trim()} )`;c!==""&&(u=`${c} ${u}`),e=a+u+n}else e="";return e}}class mW extends kB{parseFunction(t){return new pW(t)}}const YR=new WeakMap,Hr=[],Yl=[];class gW extends Vc{constructor(t,e){super(),this.renderer=t,this.backend=e,this.nodeFrame=new XR,this.nodeBuilderCache=new Map,this.callHashCache=new Lc,this.groupsData=new Lc,this.cacheLib={}}updateGroup(t){const e=t.groupNode,n=e.name;if(n===lT.name)return!0;if(n===ne.name){const i=this.get(t),a=this.nodeFrame.renderId;return i.renderId!==a?(i.renderId=a,!0):!1}if(n===OC.name){const i=this.get(t),a=this.nodeFrame.frameId;return i.frameId!==a?(i.frameId=a,!0):!1}Hr[0]=e,Hr[1]=t;let s=this.groupsData.get(Hr);return s===void 0&&this.groupsData.set(Hr,s={}),Hr[0]=null,Hr[1]=null,s.version!==e.version?(s.version=e.version,!0):!1}getForRenderCacheKey(t){return t.initialCacheKey}getForRender(t){const e=this.get(t);let n=e.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:s}=this,i=this.getForRenderCacheKey(t);if(n=s.get(i),n===void 0){const a=u=>{const d=this.backend.createNodeBuilder(t.object,this.renderer);return d.scene=t.scene,d.material=u,d.camera=t.camera,d.context.material=u,d.lightsNode=t.lightsNode,d.environmentNode=this.getEnvironmentNode(t.scene),d.fogNode=this.getFogNode(t.scene),d.clippingContext=t.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&d.enableMultiview(),d};let c=a(t.material);try{c.build()}catch(u){c=a(new Xn),c.build();let d=u.stackTrace;!d&&u.stack&&(d=new ps(u.stack)),Ht("TSL: "+u,d)}n=this._createNodeBuilderState(c),s.set(i,n)}n.usedTimes++,e.nodeBuilderState=n}return n}delete(t){if(t.isRenderObject){const e=this.get(t).nodeBuilderState;e.usedTimes--,e.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(t))}return super.delete(t)}getForCompute(t){const e=this.get(t);let n=e.nodeBuilderState;if(n===void 0){const s=this.backend.createNodeBuilder(t,this.renderer);s.build(),n=this._createNodeBuilderState(s),e.nodeBuilderState=n}return n}_createNodeBuilderState(t){return new BH(t.vertexShader,t.fragmentShader,t.computeShader,t.getAttributesArray(),t.getBindings(),t.updateNodes,t.updateBeforeNodes,t.updateAfterNodes,t.observer,t.transforms)}getEnvironmentNode(t){this.updateEnvironment(t);let e=null;if(t.environmentNode&&t.environmentNode.isNode)e=t.environmentNode;else{const n=this.get(t);n.environmentNode&&(e=n.environmentNode)}return e}getBackgroundNode(t){this.updateBackground(t);let e=null;if(t.backgroundNode&&t.backgroundNode.isNode)e=t.backgroundNode;else{const n=this.get(t);n.backgroundNode&&(e=n.backgroundNode)}return e}getFogNode(t){return this.updateFog(t),t.fogNode||this.get(t).fogNode||null}getCacheKey(t,e){Hr[0]=t,Hr[1]=e;const n=this.renderer.info.calls,s=this.callHashCache.get(Hr)||{};if(s.callId!==n){const i=this.getEnvironmentNode(t),a=this.getFogNode(t);e&&Yl.push(e.getCacheKey(!0)),i&&Yl.push(i.getCacheKey()),a&&Yl.push(a.getCacheKey()),Yl.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),Yl.push(this.renderer.shadowMap.enabled?1:0),Yl.push(this.renderer.shadowMap.type),s.callId=n,s.cacheKey=Xp(Yl),this.callHashCache.set(Hr,s),Yl.length=0}return Hr[0]=null,Hr[1]=null,s.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(t){const e=this.get(t),n=t.background;if(n){const s=t.backgroundBlurriness===0&&e.backgroundBlurriness>0||t.backgroundBlurriness>0&&e.backgroundBlurriness===0;if(e.background!==n||s){const i=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===Jy||n.mapping===Aw||n.mapping===D2){if(t.backgroundBlurriness>0||n.mapping===D2)return n_(n);{let a;return n.isCubeTexture===!0?a=Li(n):a=qe(n),vD(a)}}else{if(n.isTexture===!0)return qe(n,la.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&Ht("WebGPUNodes: Unsupported background configuration.",n)}},s);e.backgroundNode=i,e.background=n,e.backgroundBlurriness=t.backgroundBlurriness}}else e.backgroundNode&&(delete e.backgroundNode,delete e.background)}getCacheNode(t,e,n,s=!1){const i=this.cacheLib[t]||(this.cacheLib[t]=new WeakMap);let a=i.get(e);return(a===void 0||s)&&(a=n(),i.set(e,a)),a}updateFog(t){const e=this.get(t),n=t.fog;if(n){if(e.fog!==n){const s=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const i=Ln("color","color",n).setGroup(ne),a=Ln("density","float",n).setGroup(ne);return uw(i,mB(a))}else if(n.isFog){const i=Ln("color","color",n).setGroup(ne),a=Ln("near","float",n).setGroup(ne),c=Ln("far","float",n).setGroup(ne);return uw(i,pB(a,c))}else Ht("Renderer: Unsupported fog configuration.",n)});e.fogNode=s,e.fog=n}}else delete e.fogNode,delete e.fog}updateEnvironment(t){const e=this.get(t),n=t.environment;if(n){if(e.environment!==n){const s=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return Li(n);if(n.isTexture===!0)return qe(n);Ht("Nodes: Unsupported environment configuration.",n)});e.environmentNode=s,e.environment=n}}else e.environmentNode&&(delete e.environmentNode,delete e.environment)}getNodeFrame(t=this.renderer,e=null,n=null,s=null,i=null){const a=this.nodeFrame;return a.renderer=t,a.scene=e,a.object=n,a.camera=s,a.material=i,a}getNodeFrameForRender(t){return this.getNodeFrame(t.renderer,t.scene,t.object,t.camera,t.material)}getOutputCacheKey(){const t=this.renderer;return t.toneMapping+","+t.currentColorSpace+","+t.xr.isPresenting}hasOutputChange(t){return YR.get(t)!==this.getOutputCacheKey()}getOutputNode(t){const e=this.renderer,n=this.getOutputCacheKey(),s=t.isArrayTexture?Ux(t,st(la,ml("gl_ViewID_OVR"))).renderOutput(e.toneMapping,e.currentColorSpace):qe(t,la).renderOutput(e.toneMapping,e.currentColorSpace);return YR.set(t,n),s}updateBefore(t){const e=t.getNodeBuilderState();for(const n of e.updateBeforeNodes)this.getNodeFrameForRender(t).updateBeforeNode(n)}updateAfter(t){const e=t.getNodeBuilderState();for(const n of e.updateAfterNodes)this.getNodeFrameForRender(t).updateAfterNode(n)}updateForCompute(t){const e=this.getNodeFrame(),n=this.getForCompute(t);for(const s of n.updateNodes)e.updateNode(s)}updateForRender(t){const e=this.getNodeFrameForRender(t),n=t.getNodeBuilderState();for(const s of n.updateNodes)e.updateNode(s)}needsRefresh(t){const e=this.getNodeFrameForRender(t);return t.getMonitor().needsRefresh(t,e)}dispose(){super.dispose(),this.nodeFrame=new XR,this.nodeBuilderCache=new Map,this.cacheLib={}}}const i2=new cc;class Xy{constructor(t=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new rr,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,t!==null&&(this.viewNormalMatrix=t.viewNormalMatrix,this.clippingGroupContexts=t.clippingGroupContexts,this.shadowPass=t.shadowPass,this.viewMatrix=t.viewMatrix)}projectPlanes(t,e,n){const s=t.length;for(let i=0;i<s;i++){i2.copy(t[i]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const a=e[n+i],c=i2.normal;a.x=-c.x,a.y=-c.y,a.z=-c.z,a.w=i2.constant}}updateGlobal(t,e){this.shadowPass=t.overrideMaterial!==null&&t.overrideMaterial.isShadowPassMaterial,this.viewMatrix=e.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(t,e){let n=!1;t.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(t.intersectionPlanes),this.unionPlanes=Array.from(t.unionPlanes),this.parentVersion=t.version),this.clipIntersection!==e.clipIntersection&&(this.clipIntersection=e.clipIntersection,this.clipIntersection?this.unionPlanes.length=t.unionPlanes.length:this.intersectionPlanes.length=t.intersectionPlanes.length);const s=e.clippingPlanes,i=s.length;let a,c;if(this.clipIntersection?(a=this.intersectionPlanes,c=t.intersectionPlanes.length):(a=this.unionPlanes,c=t.unionPlanes.length),a.length!==c+i){a.length=c+i;for(let u=0;u<i;u++)a[c+u]=new Ze;n=!0}this.projectPlanes(s,a,c),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(t){if(this.shadowPass&&!t.clipShadows)return this;let e=this.clippingGroupContexts.get(t);return e===void 0&&(e=new Xy(this),this.clippingGroupContexts.set(t,e)),e.update(this,t),e}get unionClippingCount(){return this.unionPlanes.length}}class yW{constructor(t,e){this.bundleGroup=t,this.camera=e}}const Yh=[];class xW{constructor(){this.bundles=new Lc}get(t,e){const n=this.bundles;Yh[0]=t,Yh[1]=e;let s=n.get(Yh);return s===void 0&&(s=new yW(t,e),n.set(Yh,s)),Yh[0]=null,Yh[1]=null,s}dispose(){this.bundles=new Lc}}class HB{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(t){if(t.isNodeMaterial)return t;let e=null;const n=this.getMaterialNodeClass(t.type);if(n!==null){e=new n;for(const s in t)e[s]=t[s]}return e}addToneMapping(t,e){this.addType(t,e,this.toneMappingNodes)}getToneMappingFunction(t){return this.toneMappingNodes.get(t)||null}getMaterialNodeClass(t){return this.materialNodes.get(t)||null}addMaterial(t,e){this.addType(t,e,this.materialNodes)}getLightNodeClass(t){return this.lightNodes.get(t)||null}addLight(t,e){this.addClass(t,e,this.lightNodes)}addType(t,e,n){if(n.has(e)){Wt(`Redefinition of node ${e}`);return}if(typeof t!="function")throw new Error(`Node class ${t.name} is not a class.`);if(typeof e=="function"||typeof e=="object")throw new Error(`Base class ${e} is not a class.`);n.set(e,t)}addClass(t,e,n){if(n.has(e)){Wt(`Redefinition of node ${e.name}`);return}if(typeof t!="function")throw new Error(`Node class ${t.name} is not a class.`);if(typeof e!="function")throw new Error(`Base class ${e.name} is not a class.`);n.set(e,t)}}const bW=new p_,KR=new WeakMap;class SW{createNode(t=[]){return new p_().setLights(t)}getNode(t){if(t.isQuadMesh)return bW;let e=KR.get(t);return e===void 0&&(e=this.createNode(),KR.set(t,e)),e}}class rp extends fl{constructor(t=1,e=1,n={}){super(t,e,n),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(t){return super.copy(t),this._hasExternalTextures=t._hasExternalTextures,this._autoAllocateDepthBuffer=t._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=t._isOpaqueFramebuffer,this}}const ZR=new V,QR=new V;class wW extends Oc{constructor(t,e=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=t,this._cameraL=new Xi,this._cameraL.viewport=new Ze,this._cameraR=new Xi,this._cameraR.viewport=new Ze,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new nP,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=NW.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Ut,this._onSessionEvent=MW.bind(this),this._onSessionEnd=vW.bind(this),this._onInputSourcesChange=AW.bind(this),this._onAnimationFrame=RW.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=e,this._useMultiview=!1}getController(t){return this._getController(t).getTargetRaySpace()}getControllerGrip(t){return this._getController(t).getGripSpace()}getHand(t){return this._getController(t).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(t){this._foveation=t,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=t),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=t)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(t){this._framebufferScaleFactor=t,this.isPresenting===!0&&Wt("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(t){this._referenceSpaceType=t,this.isPresenting===!0&&Wt("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(t){this._customReferenceSpace=t}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(t,e,n,s,i,a,c,u={}){const d=new ns(t,e),f=new rp(i,a,{format:Ki,type:xi,depthTexture:new Zr(i,a,u.stencil?Tc:Jn,void 0,void 0,void 0,void 0,void 0,void 0,u.stencil?ol:Mo),stencilBuffer:u.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});f._autoAllocateDepthBuffer=!0;const p=new xn({color:16777215,side:na});p.map=f.texture,p.map.offset.y=1,p.map.repeat.y=-1;const g=new C(d,p);g.position.copy(n),g.quaternion.copy(s);const y={type:"quad",width:t,height:e,translation:n,quaternion:s,pixelwidth:i,pixelheight:a,plane:g,material:p,rendercall:c,renderTarget:f};if(this._layers.push(y),this._session!==null){y.plane.material=new xn({color:16777215,side:na}),y.plane.material.blending=ud,y.plane.material.blendEquation=Xr,y.plane.material.blendSrc=lc,y.plane.material.blendDst=lc,y.xrlayer=this._createXRLayer(y);const x=this._session.renderState.layers;x.unshift(y.xrlayer),this._session.updateRenderState({layers:x})}else f.isXRRenderTarget=!1;return g}createCylinderLayer(t,e,n,s,i,a,c,u,d={}){const f=new qt(t,t,t*e/n,64,64,!0,Math.PI-e/2,e),p=new rp(a,c,{format:Ki,type:xi,depthTexture:new Zr(a,c,d.stencil?Tc:Jn,void 0,void 0,void 0,void 0,void 0,void 0,d.stencil?ol:Mo),stencilBuffer:d.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});p._autoAllocateDepthBuffer=!0;const g=new xn({color:16777215,side:Ss});g.map=p.texture,g.map.offset.y=1,g.map.repeat.y=-1;const y=new C(f,g);y.position.copy(s),y.quaternion.copy(i);const x={type:"cylinder",radius:t,centralAngle:e,aspectratio:n,translation:s,quaternion:i,pixelwidth:a,pixelheight:c,plane:y,material:g,rendercall:u,renderTarget:p};if(this._layers.push(x),this._session!==null){x.plane.material=new xn({color:16777215,side:Ss}),x.plane.material.blending=ud,x.plane.material.blendEquation=Xr,x.plane.material.blendSrc=lc,x.plane.material.blendDst=lc,x.xrlayer=this._createXRLayer(x);const S=this._session.renderState.layers;S.unshift(x.xrlayer),this._session.updateRenderState({layers:S})}else p.isXRRenderTarget=!1;return y}renderLayers(){const t=new V,e=new Ps,n=this._renderer,s=this.isPresenting,i=n.getOutputRenderTarget(),a=n._frameBufferTarget;this.isPresenting=!1;const c=new Ut;n.getSize(c);const u=n._quad;for(const d of this._layers)if(d.renderTarget.isXRRenderTarget=this._session!==null,d.renderTarget._hasExternalTextures=d.renderTarget.isXRRenderTarget,d.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){d.xrlayer.transform=new XRRigidTransform(d.plane.getWorldPosition(t),d.plane.getWorldQuaternion(e));const f=this._glBinding.getSubImage(d.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(d.renderTarget,f.colorTexture,void 0),n._setXRLayerSize(d.renderTarget.width,d.renderTarget.height),n.setOutputRenderTarget(d.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:p,quad:g}=this._frameBufferTargets.get(d.renderTarget)||{frameBufferTarget:null,quad:null};p?(n._frameBufferTarget=p,n._quad=g):(n._quad=new Ox(new Xn),this._frameBufferTargets.set(d.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),d.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(d.renderTarget),d.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(i),n._frameBufferTarget=a,n._setXRLayerSize(c.x,c.y),n._quad=u,this.isPresenting=s}getSession(){return this._session}async setSession(t){const e=this._renderer,n=e.backend;this._gl=e.getContext();const s=this._gl,i=s.getContextAttributes();if(this._session=t,t!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(t.addEventListener("select",this._onSessionEvent),t.addEventListener("selectstart",this._onSessionEvent),t.addEventListener("selectend",this._onSessionEvent),t.addEventListener("squeeze",this._onSessionEvent),t.addEventListener("squeezestart",this._onSessionEvent),t.addEventListener("squeezeend",this._onSessionEvent),t.addEventListener("end",this._onSessionEnd),t.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=e.getPixelRatio(),e.getSize(this._currentSize),this._currentAnimationContext=e._animation.getContext(),this._currentAnimationLoop=e._animation.getAnimationLoop(),e._animation.stop(),this._supportsLayers===!0){let a=null,c=null,u=null;e.depth&&(u=e.stencil?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24,a=e.stencil?ol:Mo,c=e.stencil?Tc:Jn);const d={colorFormat:s.RGBA8,depthFormat:u,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&e.hasFeature("OVR_multiview2")&&(d.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const f=this._glBinding.createProjectionLayer(d),p=[f];this._glProjLayer=f,e.setPixelRatio(1),e._setXRLayerSize(f.textureWidth,f.textureHeight);const g=this._useMultiview?2:1,y=new Zr(f.textureWidth,f.textureHeight,c,void 0,void 0,void 0,void 0,void 0,void 0,a,g);if(this._xrRenderTarget=new rp(f.textureWidth,f.textureHeight,{format:Ki,type:xi,colorSpace:e.outputColorSpace,depthTexture:y,stencilBuffer:e.stencil,samples:i.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=t.enabledFeatures.includes("layers"),this._referenceSpace=await t.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const x of this._layers)x.plane.material=new xn({color:16777215,side:x.type==="cylinder"?Ss:na}),x.plane.material.blending=ud,x.plane.material.blendEquation=Xr,x.plane.material.blendSrc=lc,x.plane.material.blendDst=lc,x.xrlayer=this._createXRLayer(x),p.unshift(x.xrlayer);t.updateRenderState({layers:p})}else{const a={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},c=new XRWebGLLayer(t,s,a);this._glBaseLayer=c,t.updateRenderState({baseLayer:c}),e.setPixelRatio(1),e._setXRLayerSize(c.framebufferWidth,c.framebufferHeight),this._xrRenderTarget=new rp(c.framebufferWidth,c.framebufferHeight,{format:Ki,type:xi,colorSpace:e.outputColorSpace,stencilBuffer:e.stencil,resolveDepthBuffer:c.ignoreDepthValues===!1,resolveStencilBuffer:c.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await t.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),e._animation.setAnimationLoop(this._onAnimationFrame),e._animation.setContext(t),e._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(t){const e=this._session;if(e===null)return;const n=t.near,s=t.far,i=this._cameraXR,a=this._cameraL,c=this._cameraR;i.near=c.near=a.near=n,i.far=c.far=a.far=s,i.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==i.near||this._currentDepthFar!==i.far)&&(e.updateRenderState({depthNear:i.near,depthFar:i.far}),this._currentDepthNear=i.near,this._currentDepthFar=i.far),i.layers.mask=t.layers.mask|6,a.layers.mask=i.layers.mask&-5,c.layers.mask=i.layers.mask&-3;const u=t.parent,d=i.cameras;JR(i,u);for(let f=0;f<d.length;f++)JR(d[f],u);d.length===2?TW(i,a,c):i.projectionMatrix.copy(a.projectionMatrix),_W(t,i,u)}_getController(t){let e=this._controllers[t];return e===void 0&&(e=new jU,this._controllers[t]=e),e}}function TW(r,t,e){ZR.setFromMatrixPosition(t.matrixWorld),QR.setFromMatrixPosition(e.matrixWorld);const n=ZR.distanceTo(QR),s=t.projectionMatrix.elements,i=e.projectionMatrix.elements,a=s[14]/(s[10]-1),c=s[14]/(s[10]+1),u=(s[9]+1)/s[5],d=(s[9]-1)/s[5],f=(s[8]-1)/s[0],p=(i[8]+1)/i[0],g=a*f,y=a*p,x=n/(-f+p),S=x*-f;if(t.matrixWorld.decompose(r.position,r.quaternion,r.scale),r.translateX(S),r.translateZ(x),r.matrixWorld.compose(r.position,r.quaternion,r.scale),r.matrixWorldInverse.copy(r.matrixWorld).invert(),s[10]===-1)r.projectionMatrix.copy(t.projectionMatrix),r.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const T=a+x,M=c+x,N=g-S,v=y+(n-S),A=u*c/M*T,R=d*c/M*T;r.projectionMatrix.makePerspective(N,v,A,R,T,M),r.projectionMatrixInverse.copy(r.projectionMatrix).invert()}}function JR(r,t){t===null?r.matrixWorld.copy(r.matrix):r.matrixWorld.multiplyMatrices(t.matrixWorld,r.matrix),r.matrixWorldInverse.copy(r.matrixWorld).invert()}function _W(r,t,e){e===null?r.matrix.copy(t.matrixWorld):(r.matrix.copy(e.matrixWorld),r.matrix.invert(),r.matrix.multiply(t.matrixWorld)),r.matrix.decompose(r.position,r.quaternion,r.scale),r.updateMatrixWorld(!0),r.projectionMatrix.copy(t.projectionMatrix),r.projectionMatrixInverse.copy(t.projectionMatrixInverse),r.isPerspectiveCamera&&(r.fov=_d*2*Math.atan(1/r.projectionMatrix.elements[5]),r.zoom=1)}function MW(r){const t=this._controllerInputSources.indexOf(r.inputSource);if(t===-1)return;const e=this._controllers[t];if(e!==void 0){const n=this.getReferenceSpace();e.update(r.inputSource,r.frame,n),e.dispatchEvent({type:r.type,data:r.inputSource})}}function vW(){const r=this._session,t=this._renderer;r.removeEventListener("select",this._onSessionEvent),r.removeEventListener("selectstart",this._onSessionEvent),r.removeEventListener("selectend",this._onSessionEvent),r.removeEventListener("squeeze",this._onSessionEvent),r.removeEventListener("squeezestart",this._onSessionEvent),r.removeEventListener("squeezeend",this._onSessionEvent),r.removeEventListener("end",this._onSessionEnd),r.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let e=0;e<this._controllers.length;e++){const n=this._controllerInputSources[e];n!==null&&(this._controllerInputSources[e]=null,this._controllers[e].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,t._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const e of this._layers)e.renderTarget=new rp(e.pixelwidth,e.pixelheight,{format:Ki,type:xi,depthTexture:new Zr(e.pixelwidth,e.pixelheight,e.stencilBuffer?Tc:Jn,void 0,void 0,void 0,void 0,void 0,void 0,e.stencilBuffer?ol:Mo),stencilBuffer:e.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),e.renderTarget.isXRRenderTarget=!1,e.plane.material=e.material,e.material.map=e.renderTarget.texture,e.material.map.offset.y=1,e.material.map.repeat.y=-1,delete e.xrlayer;this.isPresenting=!1,this._useMultiview=!1,t._animation.stop(),t._animation.setAnimationLoop(this._currentAnimationLoop),t._animation.setContext(this._currentAnimationContext),t._animation.start(),t.setPixelRatio(this._currentPixelRatio),t.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function AW(r){const t=this._controllers,e=this._controllerInputSources;for(let n=0;n<r.removed.length;n++){const s=r.removed[n],i=e.indexOf(s);i>=0&&(e[i]=null,t[i].disconnect(s))}for(let n=0;n<r.added.length;n++){const s=r.added[n];let i=e.indexOf(s);if(i===-1){for(let c=0;c<t.length;c++)if(c>=e.length){e.push(s),i=c;break}else if(e[c]===null){e[c]=s,i=c;break}if(i===-1)break}const a=t[i];a&&a.connect(s)}}function NW(r){return r.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(r.translation,r.quaternion),width:r.width/2,height:r.height/2,space:this._referenceSpace,viewPixelWidth:r.pixelwidth,viewPixelHeight:r.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(r.translation,r.quaternion),radius:r.radius,centralAngle:r.centralAngle,aspectRatio:r.aspectRatio,space:this._referenceSpace,viewPixelWidth:r.pixelwidth,viewPixelHeight:r.pixelheight,clearOnAccess:!1})}function RW(r,t){if(t===void 0)return;const e=this._cameraXR,n=this._renderer,s=n.backend,i=this._glBaseLayer,a=this.getReferenceSpace(),c=t.getViewerPose(a);if(this._xrFrame=t,c!==null){const u=c.views;this._glBaseLayer!==null&&s.setXRTarget(i.framebuffer);let d=!1;u.length!==e.cameras.length&&(e.cameras.length=0,d=!0);for(let f=0;f<u.length;f++){const p=u[f];let g;if(this._supportsLayers===!0){const x=this._glBinding.getViewSubImage(this._glProjLayer,p);g=x.viewport,f===0&&s.setXRRenderTargetTextures(this._xrRenderTarget,x.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:x.depthStencilTexture)}else g=i.getViewport(p);let y=this._cameras[f];y===void 0&&(y=new Xi,y.layers.enable(f),y.viewport=new Ze,this._cameras[f]=y),y.matrix.fromArray(p.transform.matrix),y.matrix.decompose(y.position,y.quaternion,y.scale),y.projectionMatrix.fromArray(p.projectionMatrix),y.projectionMatrixInverse.copy(y.projectionMatrix).invert(),y.viewport.set(g.x,g.y,g.width,g.height),f===0&&(e.matrix.copy(y.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale)),d===!0&&e.cameras.push(y)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let u=0;u<this._controllers.length;u++){const d=this._controllerInputSources[u],f=this._controllers[u];d!==null&&f!==void 0&&f.update(d,t,a)}this._currentAnimationLoop&&this._currentAnimationLoop(r,t),t.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:t}),this._xrFrame=null}class EW extends Oc{constructor(t){super(),this.domElement=t,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new Ze(0,0,this._width,this._height),this._scissor=new Ze(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new Fw,this.depthTexture=new Zr}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(t){return t.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(t){return t.set(this._width,this._height)}setPixelRatio(t=1){this._pixelRatio!==t&&(this._pixelRatio=t,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(t,e,n){this.xr&&this.xr.isPresenting||(this._width=t,this._height=e,this._pixelRatio=n,this.domElement.width=Math.floor(t*n),this.domElement.height=Math.floor(e*n),this.setViewport(0,0,t,e),this._dispatchResize())}setSize(t,e,n=!0){this.xr&&this.xr.isPresenting||(this._width=t,this._height=e,this.domElement.width=Math.floor(t*this._pixelRatio),this.domElement.height=Math.floor(e*this._pixelRatio),n===!0&&(this.domElement.style.width=t+"px",this.domElement.style.height=e+"px"),this.setViewport(0,0,t,e),this._dispatchResize())}getScissor(t){const e=this._scissor;return t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t}setScissor(t,e,n,s){const i=this._scissor;t.isVector4?i.copy(t):i.set(t,e,n,s)}getScissorTest(){return this._scissorTest}setScissorTest(t){this._scissorTest=t}getViewport(t){return t.copy(this._viewport)}setViewport(t,e,n,s,i=0,a=1){const c=this._viewport;t.isVector4?c.copy(t):c.set(t,e,n,s),c.minDepth=i,c.maxDepth=a}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const tE=new Bw,Kh=new Ut,r2=new Ze,o2=new ax,a2=new Ow,dg=new ve,Wa=new Ze,CW={[na]:Ss,[Ss]:na,[ss]:ss};class DW{constructor(t,e={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,reversedDepthBuffer:s=!1,alpha:i=!0,depth:a=!0,stencil:c=!1,antialias:u=!1,samples:d=0,getFallback:f=null,outputBufferType:p=ii,multiview:g=!1}=e;this.backend=t,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=n,this.reversedDepthBuffer=s,this.outputColorSpace=bn,this.toneMapping=Ru,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=a,this.stencil=c,this.info=new vV,this.contextNode=pl(),this.library=new HB,this.lighting=new SW,this._samples=d||u===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new EW(t.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new Z5,this._inspector.setRenderer(this),this._getFallback=f,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new Ox(new Xn),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const y=this.alpha===!0?0:1;this._clearColor=new s_(0,0,0,y),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._outputBufferType=p,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._callDepth=-1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,transmitted:!1,type:D3},this.xr=new wW(this,g),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(x,S,T)=>{await this.compileAsync(x,S);const M=this._renderLists.get(x,S),N=this._renderContexts.get(this._renderTarget,this._mrt),v=x.overrideMaterial||T.material,A=this._objects.get(T,v,x,S,M.lightsNode,N,N.clippingContext),{fragmentShader:R,vertexShader:L}=A.getNodeBuilderState();return{fragmentShader:R,vertexShader:L}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(t,e)=>{let n=this.backend;try{await n.init(this)}catch(s){if(this._getFallback!==null)try{this.backend=n=this._getFallback(s),await n.init(this)}catch(i){e(i);return}else{e(s);return}}this._nodes=new gW(this,n),this._animation=new gV(this,this._nodes,this.info),this._attributes=new _V(n),this._background=new CH(this,this._nodes),this._geometries=new MV(this._attributes,this.info),this._textures=new zV(this,n,this.info),this._pipelines=new EV(n,this._nodes),this._bindings=new CV(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new SV(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new LV(this.lighting),this._bundles=new xW,this._renderContexts=new UV(this),this._animation.start(),this._initialized=!0,this._inspector.init(),t(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(t,e,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const s=this._nodes.nodeFrame,i=s.renderId,a=this._currentRenderContext,c=this._currentRenderObjectFunction,u=this._handleObjectFunction,d=this._compilationPromises,f=t.isScene===!0?t:tE;n===null&&(n=t);const p=this._renderTarget,g=this._renderContexts.get(p,this._mrt),y=this._activeMipmapLevel,x=[];this._currentRenderContext=g,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=x,s.renderId++,s.update(),g.depth=this.depth,g.stencil=this.stencil,g.clippingContext||(g.clippingContext=new Xy),g.clippingContext.updateGlobal(f,e),f.onBeforeRender(this,t,e,p);const S=this._renderLists.get(t,e);if(S.begin(),this._projectObject(t,e,0,S,g.clippingContext),n!==t&&n.traverseVisible(function(A){A.isLight&&A.layers.test(e.layers)&&S.pushLight(A)}),S.finish(),p!==null){this._textures.updateRenderTarget(p,y);const A=this._textures.get(p);g.textures=A.textures,g.depthTexture=A.depthTexture}else g.textures=null,g.depthTexture=null;n!==t?this._background.update(n,S,g):this._background.update(f,S,g);const T=S.opaque,M=S.transparent,N=S.transparentDoublePass,v=S.lightsNode;this.opaque===!0&&T.length>0&&this._renderObjects(T,e,f,v),this.transparent===!0&&M.length>0&&this._renderTransparents(M,N,e,f,v),s.renderId=i,this._currentRenderContext=a,this._currentRenderObjectFunction=c,this._handleObjectFunction=u,this._compilationPromises=d,await Promise.all(x)}async renderAsync(t,e){an('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(t,e)}async waitForGPU(){Ht("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(t){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=t,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(t){const e=this.contextNode.value;t===!0?(e.modelViewMatrix=K2,e.modelNormalViewMatrix=Z2):this.highPrecision&&(delete e.modelViewMatrix,delete e.modelNormalViewMatrix)}get highPrecision(){const t=this.contextNode.value;return t.modelViewMatrix===K2&&t.modelNormalViewMatrix===Z2}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}getOutputBufferType(){return this._outputBufferType}getColorBufferType(){return an('Renderer: ".getColorBufferType()" has been renamed to ".getOutputBufferType()".'),this.getOutputBufferType()}_onDeviceLost(t){let e=`THREE.WebGPURenderer: ${t.api} Device Lost:

Message: ${t.message}`;t.reason&&(e+=`
Reason: ${t.reason}`),Ht(e),this._isDeviceLost=!0}_renderBundle(t,e,n){const{bundleGroup:s,camera:i,renderList:a}=t,c=this._currentRenderContext,u=this._bundles.get(s,i),d=this.backend.get(u);d.renderContexts===void 0&&(d.renderContexts=new Set);const f=s.version!==d.version,p=d.renderContexts.has(c)===!1||f;if(d.renderContexts.add(c),p){this.backend.beginBundle(c),(d.renderObjects===void 0||f)&&(d.renderObjects=[]),this._currentRenderBundle=u;const{transparentDoublePass:g,transparent:y,opaque:x}=a;this.opaque===!0&&x.length>0&&this._renderObjects(x,i,e,n),this.transparent===!0&&y.length>0&&this._renderTransparents(y,g,i,e,n),this._currentRenderBundle=null,this.backend.finishBundle(c,u),d.version=s.version}else{const{renderObjects:g}=d;for(let y=0,x=g.length;y<x;y++){const S=g[y];this._nodes.needsRefresh(S)&&(this._nodes.updateBefore(S),this._nodes.updateForRender(S),this._bindings.updateForRender(S),this._nodes.updateAfter(S))}}this.backend.addBundle(c,u)}render(t,e){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(t,e)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:t,currentColorSpace:e}=this,n=t!==Ru,s=e!==Xe.workingColorSpace;if(n===!1&&s===!1)return null;const{width:i,height:a}=this.getDrawingBufferSize(Kh),{depth:c,stencil:u}=this;let d=this._frameBufferTarget;d===null&&(d=new fl(i,a,{depthBuffer:c,stencilBuffer:u,type:this._outputBufferType,format:Ki,colorSpace:Xe.workingColorSpace,generateMipmaps:!1,minFilter:$s,magFilter:$s,samples:this.samples}),d.isPostProcessingRenderTarget=!0,this._frameBufferTarget=d);const f=this.getOutputRenderTarget();d.depthBuffer=c,d.stencilBuffer=u,f!==null?d.setSize(f.width,f.height,f.depth):d.setSize(i,a,1);const p=this._canvasTarget;return d.viewport.copy(p._viewport),d.scissor.copy(p._scissor),d.viewport.multiplyScalar(p._pixelRatio),d.scissor.multiplyScalar(p._pixelRatio),d.scissorTest=p._scissorTest,d.multiview=f!==null?f.multiview:!1,d.resolveDepthBuffer=f!==null?f.resolveDepthBuffer:!0,d._autoAllocateDepthBuffer=f!==null?f._autoAllocateDepthBuffer:!1,d}_renderScene(t,e,n=!0){if(this._isDeviceLost===!0)return;const s=n?this._getFrameBufferTarget():null,i=this._nodes.nodeFrame,a=i.renderId,c=this._currentRenderContext,u=this._currentRenderObjectFunction,d=this._handleObjectFunction;this._callDepth++;const f=t.isScene===!0?t:tE,p=this._renderTarget||this._outputRenderTarget,g=this._activeCubeFace,y=this._activeMipmapLevel;let x;s!==null?(x=s,this.setRenderTarget(x)):x=p;const S=this._renderContexts.get(x,this._mrt,this._callDepth);this._currentRenderContext=S,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this._handleObjectFunction=this._renderObjectDirect,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,i.renderId=this.info.calls,this.backend.updateTimeStampUID(S),this.inspector.beginRender(this.backend.getTimestampUID(S),t,e,x);const T=this.xr;if(T.isPresenting===!1){let Mt=!1;if(this.reversedDepthBuffer===!0&&e.reversedDepth!==!0){if(e._reversedDepth=!0,e.isArrayCamera)for(const F of e.cameras)F._reversedDepth=!0;Mt=!0}const mt=this.coordinateSystem;if(e.coordinateSystem!==mt){if(e.coordinateSystem=mt,e.isArrayCamera)for(const F of e.cameras)F.coordinateSystem=mt;Mt=!0}if(Mt===!0&&(e.updateProjectionMatrix(),e.isArrayCamera))for(const F of e.cameras)F.updateProjectionMatrix()}t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),e.parent===null&&e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),T.enabled===!0&&T.isPresenting===!0&&(T.cameraAutoUpdate===!0&&T.updateCamera(e),e=T.getCamera());const M=this._canvasTarget;let N=M._viewport,v=M._scissor,A=M._pixelRatio;x!==null&&(N=x.viewport,v=x.scissor,A=1),this.getDrawingBufferSize(Kh),r2.set(0,0,Kh.width,Kh.height);const R=N.minDepth===void 0?0:N.minDepth,L=N.maxDepth===void 0?1:N.maxDepth;S.viewportValue.copy(N).multiplyScalar(A).floor(),S.viewportValue.width>>=y,S.viewportValue.height>>=y,S.viewportValue.minDepth=R,S.viewportValue.maxDepth=L,S.viewport=S.viewportValue.equals(r2)===!1,S.scissorValue.copy(v).multiplyScalar(A).floor(),S.scissor=M._scissorTest&&S.scissorValue.equals(r2)===!1,S.scissorValue.width>>=y,S.scissorValue.height>>=y,S.clippingContext||(S.clippingContext=new Xy),S.clippingContext.updateGlobal(f,e),f.onBeforeRender(this,t,e,x);const D=e.isArrayCamera?a2:o2;e.isArrayCamera||(dg.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),D.setFromProjectionMatrix(dg,e.coordinateSystem,e.reversedDepth));const U=this._renderLists.get(t,e);if(U.begin(),this._projectObject(t,e,0,U,S.clippingContext),U.finish(),this.sortObjects===!0&&U.sort(this._opaqueSort,this._transparentSort),x!==null){this._textures.updateRenderTarget(x,y);const Mt=this._textures.get(x);S.textures=Mt.textures,S.depthTexture=Mt.depthTexture,S.width=Mt.width,S.height=Mt.height,S.renderTarget=x,S.depth=x.depthBuffer,S.stencil=x.stencilBuffer}else S.textures=null,S.depthTexture=null,S.width=Kh.width,S.height=Kh.height,S.depth=this.depth,S.stencil=this.stencil;S.width>>=y,S.height>>=y,S.activeCubeFace=g,S.activeMipmapLevel=y,S.occlusionQueryCount=U.occlusionQueryCount,S.scissorValue.max(Wa.set(0,0,0,0)),S.scissorValue.x+S.scissorValue.width>S.width&&(S.scissorValue.width=Math.max(S.width-S.scissorValue.x,0)),S.scissorValue.y+S.scissorValue.height>S.height&&(S.scissorValue.height=Math.max(S.height-S.scissorValue.y,0)),this._background.update(f,U,S),S.camera=e,this.backend.beginRender(S);const{bundles:B,lightsNode:P,transparentDoublePass:J,transparent:q,opaque:ft}=U;return B.length>0&&this._renderBundles(B,f,P),this.opaque===!0&&ft.length>0&&this._renderObjects(ft,e,f,P),this.transparent===!0&&q.length>0&&this._renderTransparents(q,J,e,f,P),this.backend.finishRender(S),i.renderId=a,this._currentRenderContext=c,this._currentRenderObjectFunction=u,this._handleObjectFunction=d,this._callDepth--,s!==null&&(this.setRenderTarget(p,g,y),this._renderOutput(x)),f.onAfterRender(this,t,e,x),this.inspector.finishRender(this.backend.getTimestampUID(S)),S}_setXRLayerSize(t,e){this._canvasTarget._width=t,this._canvasTarget._height=e,this.setViewport(0,0,t,e)}_renderOutput(t){const e=this._quad;this._nodes.hasOutputChange(t.texture)&&(e.material.fragmentNode=this._nodes.getOutputNode(t.texture),e.material.needsUpdate=!0);const n=this.autoClear,s=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(e,e.camera,!1),this.autoClear=n,this.xr.enabled=s}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(t){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(t)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(t){return await this.backend.getArrayBufferAsync(t)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(t){return this._canvasTarget.getDrawingBufferSize(t)}getSize(t){return this._canvasTarget.getSize(t)}setPixelRatio(t=1){this._canvasTarget.setPixelRatio(t)}setDrawingBufferSize(t,e,n){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(t,e,n)}setSize(t,e,n=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(t,e,n)}setOpaqueSort(t){this._opaqueSort=t}setTransparentSort(t){this._transparentSort=t}getScissor(t){return this._canvasTarget.getScissor(t)}setScissor(t,e,n,s){this._canvasTarget.setScissor(t,e,n,s)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(t){this._canvasTarget.setScissorTest(t),this.backend.setScissorTest(t)}getViewport(t){return this._canvasTarget.getViewport(t)}setViewport(t,e,n,s,i=0,a=1){this._canvasTarget.setViewport(t,e,n,s,i,a)}getClearColor(t){return t.copy(this._clearColor)}setClearColor(t,e=1){this._clearColor.set(t),this._clearColor.a=e}getClearAlpha(){return this._clearColor.a}setClearAlpha(t){this._clearColor.a=t}getClearDepth(){return this.reversedDepthBuffer===!0?1-this._clearDepth:this._clearDepth}setClearDepth(t){this._clearDepth=t}getClearStencil(){return this._clearStencil}setClearStencil(t){this._clearStencil=t}isOccluded(t){const e=this._currentRenderContext;return e&&this.backend.isOccluded(e,t)}clear(t=!0,e=!0,n=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const s=this._renderTarget||this._getFrameBufferTarget();let i=null;if(s!==null){this._textures.updateRenderTarget(s);const a=this._textures.get(s);i=this._renderContexts.get(s),i.textures=a.textures,i.depthTexture=a.depthTexture,i.width=a.width,i.height=a.height,i.renderTarget=s,i.depth=s.depthBuffer,i.stencil=s.stencilBuffer;const c=this.backend.getClearColor();i.clearColorValue.r=c.r,i.clearColorValue.g=c.g,i.clearColorValue.b=c.b,i.clearColorValue.a=c.a,i.clearDepthValue=this.getClearDepth(),i.clearStencilValue=this.getClearStencil(),i.activeCubeFace=this.getActiveCubeFace(),i.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(t,e,n,i),s!==null&&this._renderTarget===null&&this._renderOutput(s)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(t=!0,e=!0,n=!0){an('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(t,e,n)}async clearColorAsync(){an('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){an('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){an('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const t=this.currentToneMapping!==Ru,e=this.currentColorSpace!==Xe.workingColorSpace;return t||e}get samples(){return this._samples}get currentSamples(){let t=this._samples;return this._renderTarget!==null?t=this._renderTarget.samples:this.needsFrameBufferTarget&&(t=0),t}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Ru}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:Xe.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(t=>{t!==null&&t.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(t,e=0,n=0){this._renderTarget=t,this._activeCubeFace=e,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(t){this._outputRenderTarget=t}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(t){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=t,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(t){this._renderObjectFunction=t}getRenderObjectFunction(){return this._renderObjectFunction}compute(t,e=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return Wt("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(t,e);const n=this._nodes.nodeFrame,s=n.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,n.renderId=this.info.calls,this.backend.updateTimeStampUID(t),this.inspector.beginCompute(this.backend.getTimestampUID(t),t);const i=this.backend,a=this._pipelines,c=this._bindings,u=this._nodes,d=Array.isArray(t)?t:[t];if(d[0]===void 0||d[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");i.beginCompute(t);for(const f of d){if(a.has(f)===!1){const y=()=>{f.removeEventListener("dispose",y),a.delete(f),c.deleteForCompute(f),u.delete(f)};f.addEventListener("dispose",y);const x=f.onInitFunction;x!==null&&x.call(f,{renderer:this})}u.updateForCompute(f),c.updateForCompute(f);const p=c.getForCompute(f),g=a.getForCompute(f,p);i.compute(t,f,p,g,e)}i.finishCompute(t),n.renderId=s,this.inspector.finishCompute(this.backend.getTimestampUID(t))}async computeAsync(t,e=null){this._initialized===!1&&await this.init(),this.compute(t,e)}async hasFeatureAsync(t){return an('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(t)}async resolveTimestampsAsync(t="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(t)}hasFeature(t){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(t)}hasInitialized(){return this._initialized}async initTextureAsync(t){an('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(t)}initTexture(t){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(t)}initRenderTarget(t){if(this._initialized===!1)throw new Error('Renderer: .initRenderTarget() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateRenderTarget(t);const e=this._textures.get(t),n=this._renderContexts.get(t);n.textures=e.textures,n.depthTexture=e.depthTexture,n.width=e.width,n.height=e.height,n.renderTarget=t,n.depth=t.depthBuffer,n.stencil=t.stencilBuffer,this.backend.initRenderTarget(n)}copyFramebufferToTexture(t,e=null){if(e!==null)if(e.isVector2)e=Wa.set(e.x,e.y,t.image.width,t.image.height).floor();else if(e.isVector4)e=Wa.copy(e).floor();else{Ht("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else e=Wa.set(0,0,t.image.width,t.image.height);let n=this._currentRenderContext,s;n!==null?s=n.renderTarget:(s=this._renderTarget||this._getFrameBufferTarget(),s!==null&&(this._textures.updateRenderTarget(s),n=this._textures.get(s))),this._textures.updateTexture(t,{renderTarget:s}),this.backend.copyFramebufferToTexture(t,n,e),this._inspector.copyFramebufferToTexture(t)}copyTextureToTexture(t,e,n=null,s=null,i=0,a=0){this._textures.updateTexture(t),this._textures.updateTexture(e),this.backend.copyTextureToTexture(t,e,n,s,i,a),this._inspector.copyTextureToTexture(t,e)}async readRenderTargetPixelsAsync(t,e,n,s,i,a=0,c=0){return this.backend.copyTextureToBuffer(t.textures[a],e,n,s,i,c)}_projectObject(t,e,n,s,i){if(t.visible===!1)return;if(t.layers.test(e.layers)){if(t.isGroup)n=t.renderOrder,t.isClippingGroup&&t.enabled&&(i=i.getGroupContext(t));else if(t.isLOD)t.autoUpdate===!0&&t.update(e);else if(t.isLight)s.pushLight(t);else if(t.isSprite){const u=e.isArrayCamera?a2:o2;if(!t.frustumCulled||u.intersectsSprite(t,e)){this.sortObjects===!0&&Wa.setFromMatrixPosition(t.matrixWorld).applyMatrix4(dg);const{geometry:d,material:f}=t;f.visible&&s.push(t,d,f,n,Wa.z,null,i)}}else if(t.isLineLoop)Ht("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(t.isMesh||t.isLine||t.isPoints){const u=e.isArrayCamera?a2:o2;if(!t.frustumCulled||u.intersectsObject(t,e)){const{geometry:d,material:f}=t;if(this.sortObjects===!0&&(d.boundingSphere===null&&d.computeBoundingSphere(),Wa.copy(d.boundingSphere.center).applyMatrix4(t.matrixWorld).applyMatrix4(dg)),Array.isArray(f)){const p=d.groups;for(let g=0,y=p.length;g<y;g++){const x=p[g],S=f[x.materialIndex];S&&S.visible&&s.push(t,d,S,n,Wa.z,x,i)}}else f.visible&&s.push(t,d,f,n,Wa.z,null,i)}}}if(t.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const u=s;s=this._renderLists.get(t,e),s.begin(),u.pushBundle({bundleGroup:t,camera:e,renderList:s}),s.finish()}const c=t.children;for(let u=0,d=c.length;u<d;u++)this._projectObject(c[u],e,n,s,i)}_renderBundles(t,e,n){for(const s of t)this._renderBundle(s,e,n)}_renderTransparents(t,e,n,s,i){if(e.length>0){for(const{material:a}of e)a.side=Ss;this._renderObjects(e,n,s,i,"backSide");for(const{material:a}of e)a.side=na;this._renderObjects(t,n,s,i);for(const{material:a}of e)a.side=ss}else this._renderObjects(t,n,s,i)}_renderObjects(t,e,n,s,i=null){for(let a=0,c=t.length;a<c;a++){const{object:u,geometry:d,material:f,group:p,clippingContext:g}=t[a];this._currentRenderObjectFunction(u,n,e,d,f,p,s,g,i)}}_getShadowNodes(t){const e=t.version;let n=this._cacheShadowNodes.get(t);if(n===void 0||n.version!==e){const s=t.map!==null,i=t.colorNode&&t.colorNode.isNode,a=t.castShadowNode&&t.castShadowNode.isNode,c=t.maskShadowNode&&t.maskShadowNode.isNode||t.maskNode&&t.maskNode.isNode;let u=null,d=null,f=null;if(s||i||a||c){let p,g;if(a?(p=t.castShadowNode.rgb,g=t.castShadowNode.a,this.shadowMap.transmitted!==!0&&an("Renderer: `shadowMap.transmitted` needs to be set to `true` when using `material.castShadowNode`.")):(p=st(0),g=G(1)),s&&(g=g.mul(Ln("map","texture",t).a)),i&&(g=g.mul(t.colorNode.a)),d=ie(p,g),c){const y=t.maskShadowNode||t.maskNode;d=ot(([x])=>(y.not().discard(),x))(d)}}t.depthNode&&t.depthNode.isNode&&(f=t.depthNode),t.castShadowPositionNode&&t.castShadowPositionNode.isNode?u=t.castShadowPositionNode:t.positionNode&&t.positionNode.isNode&&(u=t.positionNode),n={version:e,colorNode:d,depthNode:f,positionNode:u},this._cacheShadowNodes.set(t,n)}return n}renderObject(t,e,n,s,i,a,c,u=null,d=null){let f=!1,p,g,y,x;if(t.onBeforeRender(this,e,n,s,i,a),i.allowOverride===!0&&e.overrideMaterial!==null){const S=e.overrideMaterial;if(f=!0,p=S.isNodeMaterial?S.colorNode:null,g=S.isNodeMaterial?S.depthNode:null,y=S.isNodeMaterial?S.positionNode:null,x=e.overrideMaterial.side,i.positionNode&&i.positionNode.isNode&&(S.positionNode=i.positionNode),S.alphaTest=i.alphaTest,S.alphaMap=i.alphaMap,S.transparent=i.transparent||i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode||i.backdropNode&&i.backdropNode.isNode,S.isShadowPassMaterial){const{colorNode:T,depthNode:M,positionNode:N}=this._getShadowNodes(i);this.shadowMap.type===up?S.side=i.shadowSide!==null?i.shadowSide:i.side:S.side=i.shadowSide!==null?i.shadowSide:CW[i.side],T!==null&&(S.colorNode=T),M!==null&&(S.depthNode=M),N!==null&&(S.positionNode=N)}i=S}i.transparent===!0&&i.side===ss&&i.forceSinglePass===!1?(i.side=Ss,this._handleObjectFunction(t,i,e,n,c,a,u,"backSide"),i.side=na,this._handleObjectFunction(t,i,e,n,c,a,u,d),i.side=ss):this._handleObjectFunction(t,i,e,n,c,a,u,d),f&&(e.overrideMaterial.colorNode=p,e.overrideMaterial.depthNode=g,e.overrideMaterial.positionNode=y,e.overrideMaterial.side=x),t.onAfterRender(this,e,n,s,i,a)}hasCompatibility(t){return this.backend.hasCompatibility(t)}_renderObjectDirect(t,e,n,s,i,a,c,u){const d=this._objects.get(t,e,n,s,i,this._currentRenderContext,c,u);d.drawRange=t.geometry.drawRange,d.group=a,this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(d),d.bundle=this._currentRenderBundle.bundleGroup);const f=this._nodes.needsRefresh(d);f&&(this._nodes.updateBefore(d),this._geometries.updateForRender(d),this._nodes.updateForRender(d),this._bindings.updateForRender(d)),this._pipelines.updateForRender(d),this.backend.draw(d,this.info),f&&this._nodes.updateAfter(d)}_createObjectPipeline(t,e,n,s,i,a,c,u){const d=this._objects.get(t,e,n,s,i,this._currentRenderContext,c,u);d.drawRange=t.geometry.drawRange,d.group=a,this._nodes.updateBefore(d),this._geometries.updateForRender(d),this._nodes.updateForRender(d),this._bindings.updateForRender(d),this._pipelines.getForRender(d,this._compilationPromises),this._nodes.updateAfter(d)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class WB{constructor(t=""){this.name=t,this.visibility=0}setVisibility(t){this.visibility|=t}getVisibility(){return this.visibility}clone(){return Object.assign(new this.constructor,this)}}function BW(r){return r+(gc-r%gc)%gc}class qB extends WB{constructor(t,e=null){super(t),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=e,this._updateRanges=[]}get updateRanges(){return this._updateRanges}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}get byteLength(){return BW(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class $B extends qB{constructor(t,e=null){super(t,e),this.isUniformBuffer=!0}}let LW=0;class XB extends $B{constructor(t,e){super("UniformBuffer_"+LW++,t?t.value:null),this.nodeUniform=t,this.groupNode=e,this.isNodeUniformBuffer=!0}set updateRanges(t){this.nodeUniform.updateRanges=t}get updateRanges(){return this.nodeUniform.updateRanges}addUpdateRange(t,e){this.nodeUniform.addUpdateRange(t,e)}clearUpdateRanges(){this.nodeUniform.clearUpdateRanges()}get buffer(){return this.nodeUniform.value}}class OW extends $B{constructor(t){super(t),this.isUniformsGroup=!0,this._values=null,this.uniforms=[],this._updateRangeCache=new Map}addUniformUpdateRange(t){const e=t.index;if(this._updateRangeCache.has(e)!==!0){const n=this.updateRanges,s=t.offset,i=t.itemSize,a={start:s,count:i};n.push(a),this._updateRangeCache.set(e,a)}}clearUpdateRanges(){this._updateRangeCache.clear(),super.clearUpdateRanges()}addUniform(t){return this.uniforms.push(t),this}removeUniform(t){const e=this.uniforms.indexOf(t);return e!==-1&&this.uniforms.splice(e,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let t=this._buffer;if(t===null){const e=this.byteLength;t=new Float32Array(new ArrayBuffer(e)),this._buffer=t}return t}get byteLength(){const t=this.bytesPerElement;let e=0;for(let n=0,s=this.uniforms.length;n<s;n++){const i=this.uniforms[n],a=i.boundary,c=i.itemSize*t,u=e%gc,d=u%a,f=u+d;e+=d,f!==0&&gc-f<c&&(e+=gc-f),i.offset=e/t,i.index=n,e+=c}return Math.ceil(e/gc)*gc}update(){let t=!1;for(const e of this.uniforms)this.updateByType(e)===!0&&(t=!0);return t}updateByType(t){if(t.isNumberUniform)return this.updateNumber(t);if(t.isVector2Uniform)return this.updateVector2(t);if(t.isVector3Uniform)return this.updateVector3(t);if(t.isVector4Uniform)return this.updateVector4(t);if(t.isColorUniform)return this.updateColor(t);if(t.isMatrix3Uniform)return this.updateMatrix3(t);if(t.isMatrix4Uniform)return this.updateMatrix4(t);Ht("WebGPUUniformsGroup: Unsupported uniform type.",t)}updateNumber(t){let e=!1;const n=this.values,s=t.getValue(),i=t.offset,a=t.getType();if(n[i]!==s){const c=this._getBufferForType(a);c[i]=n[i]=s,e=!0,this.addUniformUpdateRange(t)}return e}updateVector2(t){let e=!1;const n=this.values,s=t.getValue(),i=t.offset,a=t.getType();if(n[i+0]!==s.x||n[i+1]!==s.y){const c=this._getBufferForType(a);c[i+0]=n[i+0]=s.x,c[i+1]=n[i+1]=s.y,e=!0,this.addUniformUpdateRange(t)}return e}updateVector3(t){let e=!1;const n=this.values,s=t.getValue(),i=t.offset,a=t.getType();if(n[i+0]!==s.x||n[i+1]!==s.y||n[i+2]!==s.z){const c=this._getBufferForType(a);c[i+0]=n[i+0]=s.x,c[i+1]=n[i+1]=s.y,c[i+2]=n[i+2]=s.z,e=!0,this.addUniformUpdateRange(t)}return e}updateVector4(t){let e=!1;const n=this.values,s=t.getValue(),i=t.offset,a=t.getType();if(n[i+0]!==s.x||n[i+1]!==s.y||n[i+2]!==s.z||n[i+4]!==s.w){const c=this._getBufferForType(a);c[i+0]=n[i+0]=s.x,c[i+1]=n[i+1]=s.y,c[i+2]=n[i+2]=s.z,c[i+3]=n[i+3]=s.w,e=!0,this.addUniformUpdateRange(t)}return e}updateColor(t){let e=!1;const n=this.values,s=t.getValue(),i=t.offset;if(n[i+0]!==s.r||n[i+1]!==s.g||n[i+2]!==s.b){const a=this.buffer;a[i+0]=n[i+0]=s.r,a[i+1]=n[i+1]=s.g,a[i+2]=n[i+2]=s.b,e=!0,this.addUniformUpdateRange(t)}return e}updateMatrix3(t){let e=!1;const n=this.values,s=t.getValue().elements,i=t.offset;if(n[i+0]!==s[0]||n[i+1]!==s[1]||n[i+2]!==s[2]||n[i+4]!==s[3]||n[i+5]!==s[4]||n[i+6]!==s[5]||n[i+8]!==s[6]||n[i+9]!==s[7]||n[i+10]!==s[8]){const a=this.buffer;a[i+0]=n[i+0]=s[0],a[i+1]=n[i+1]=s[1],a[i+2]=n[i+2]=s[2],a[i+4]=n[i+4]=s[3],a[i+5]=n[i+5]=s[4],a[i+6]=n[i+6]=s[5],a[i+8]=n[i+8]=s[6],a[i+9]=n[i+9]=s[7],a[i+10]=n[i+10]=s[8],e=!0,this.addUniformUpdateRange(t)}return e}updateMatrix4(t){let e=!1;const n=this.values,s=t.getValue().elements,i=t.offset;return UW(n,s,i)===!1&&(this.buffer.set(s,i),FW(n,s,i),e=!0,this.addUniformUpdateRange(t)),e}_getBufferForType(t){return t==="int"||t==="ivec2"||t==="ivec3"||t==="ivec4"?new Int32Array(this.buffer.buffer):t==="uint"||t==="uvec2"||t==="uvec3"||t==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function FW(r,t,e){for(let n=0,s=t.length;n<s;n++)r[e+n]=t[n]}function UW(r,t,e){for(let n=0,s=t.length;n<s;n++)if(r[e+n]!==t[n])return!1;return!0}let PW=0;class jB extends OW{constructor(t,e){super(t),this.id=PW++,this.groupNode=e,this.isNodeUniformsGroup=!0}}class YB extends WB{constructor(t,e){super(t),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=e,this.version=e?e.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(t){this._texture!==t&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=t,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:t,version:e}=this;return e!==t.version?(this.version=t.version,!0):!1}clone(){const t=super.clone();return t._texture=null,t._onTextureDispose=()=>{t.generation=null,t.version=0},t.texture=this.texture,t}}let zW=0;class IW extends YB{constructor(t,e){super(t,e),this.id=zW++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class kx extends IW{constructor(t,e,n,s=null){super(t,e?e.value:null),this.textureNode=e,this.groupNode=n,this.access=s}update(){const{textureNode:t}=this;return this.texture!==t.value?(this.texture=t.value,!0):super.update()}}class KB extends kx{constructor(t,e,n,s=null){super(t,e,n,s),this.isSampledCubeTexture=!0}}class dw extends kx{constructor(t,e,n,s=null){super(t,e,n,s),this.isSampledTexture3D=!0}}const eE={bitcast_int_uint:new Us("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }"),bitcast_uint_int:new Us("uint tsl_bitcast_uint_to_int ( uint x ) { return floatBitsToInt( uintBitsToFloat ( x ) ); }")},VW={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint",floatpack_snorm_2x16:"packSnorm2x16",floatpack_unorm_2x16:"packUnorm2x16",floatpack_float16_2x16:"packHalf2x16",floatunpack_snorm_2x16:"unpackSnorm2x16",floatunpack_unorm_2x16:"unpackUnorm2x16",floatunpack_float16_2x16:"unpackHalf2x16"},nE={low:"lowp",medium:"mediump",high:"highp"},sE={swizzleAssign:!0,storageBuffer:!1},iE={perspective:"smooth",linear:"noperspective"},rE={centroid:"centroid"},oE=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision highp sampler2DShadow;
precision highp sampler2DArrayShadow;
precision highp samplerCubeShadow;
`;class GW extends GB{constructor(t,e){super(t,e,new mW),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(t){return t.isVideoTexture===!0&&t.colorSpace!==Ec}_include(t){const e=eE[t];return e.build(this),this.addInclude(e),e}getMethod(t){return eE[t]!==void 0&&this._include(t),VW[t]||t}getBitcastMethod(t,e){return this.getMethod(`bitcast_${e}_${t}`)}getFloatPackingMethod(t){return this.getMethod(`floatpack_${t}_2x16`)}getFloatUnpackingMethod(t){return this.getMethod(`floatunpack_${t}_2x16`)}getTernary(t,e,n){return`${t} ? ${e} : ${n}`}getOutputStructName(){return""}buildFunctionCode(t){const e=t.layout,n=this.flowShaderNode(t),s=[];for(const a of e.inputs)s.push(this.getType(a.type)+" "+a.name);return`${this.getType(e.type)} ${e.name}( ${s.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(t){const e=t.value;if(e.pbo===void 0){const n=e.array,s=e.count*e.itemSize,{itemSize:i}=e,a=e.array.constructor.name.toLowerCase().includes("int");let c=a?ex:Wp;i===2?c=a?nx:Qo:i===3?c=a?QF:tx:i===4&&(c=a?sx:Ki);const u={Float32Array:Di,Uint8Array:xi,Uint16Array:Eu,Uint32Array:Jn,Int8Array:hd,Int16Array:dd,Int32Array:pi,Uint8ClampedArray:xi},d=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(s/i))));let f=Math.ceil(s/i/d);d*f*i<s&&f++;const p=d*f*i,g=new n.constructor(p);g.set(n,0),e.array=g;const y=new ox(e.array,d,f,c,u[e.array.constructor.name]||Di);y.needsUpdate=!0,y.isPBOTexture=!0;const x=new fa(y,null,null);x.setPrecision("high"),e.pboNode=x,e.pbo=x.value,this.getUniformFromNode(e.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(t,e=this.shaderStage){return t.isNodeUniform&&t.node.isTextureNode!==!0&&t.node.isBufferNode!==!0?t.name:super.getPropertyName(t,e)}generatePBO(t){const{node:e,indexNode:n}=t,s=e.value;if(this.renderer.backend.has(s)){const f=this.renderer.backend.get(s);f.pbo=s.pbo}const i=this.getUniformFromNode(s.pboNode,"texture",this.shaderStage,this.context.nodeName),a=this.getPropertyName(i);this.increaseUsage(n);const c=n.build(this,"uint"),u=this.getDataFromNode(t);let d=u.propertyName;if(d===void 0){const f=this.getVarFromNode(t);d=this.getPropertyName(f);const p=this.getDataFromNode(e);let g=p.propertySizeName;g===void 0&&(g=d+"Size",this.getVarFromNode(e,g,"uint"),this.addLineFlowCode(`${g} = uint( textureSize( ${a}, 0 ).x )`,t),p.propertySizeName=g);const{itemSize:y}=s,x="."+qu.join("").slice(0,y),S=`ivec2(${c} % ${g}, ${c} / ${g})`,T=this.generateTextureLoad(null,a,S,"0",null,null);let M="vec4";s.pbo.type===Jn?M="uvec4":s.pbo.type===pi&&(M="ivec4"),this.addLineFlowCode(`${d} = ${M}(${T})${x}`,t),u.propertyName=d}return d}generateTextureLoad(t,e,n,s,i,a){s===null&&(s="0");let c;return i?a?c=`texelFetchOffset( ${e}, ivec3( ${n}, ${i} ), ${s}, ${a} )`:c=`texelFetch( ${e}, ivec3( ${n}, ${i} ), ${s} )`:a?c=`texelFetchOffset( ${e}, ${n}, ${s}, ${a} )`:c=`texelFetch( ${e}, ${n}, ${s} )`,t!==null&&t.isDepthTexture&&(c+=".x"),c}generateTexture(t,e,n,s,i){return s&&(n=`vec3( ${n}, ${s} )`),t.isDepthTexture?i?`textureOffset( ${e}, ${n}, ${i} ).x`:`texture( ${e}, ${n} ).x`:i?`textureOffset( ${e}, ${n}, ${i} )`:`texture( ${e}, ${n} )`}generateTextureLevel(t,e,n,s,i,a){return i&&(n=`vec3( ${n}, ${i} )`),a?`textureLodOffset( ${e}, ${n}, ${s}, ${a} )`:`textureLod( ${e}, ${n}, ${s} )`}generateTextureBias(t,e,n,s,i,a){return i&&(n=`vec3( ${n}, ${i} )`),a?`textureOffset( ${e}, ${n}, ${a}, ${s} )`:`texture( ${e}, ${n}, ${s} )`}generateTextureGrad(t,e,n,s,i,a){return i&&(n=`vec3( ${n}, ${i} )`),a?`textureGradOffset( ${e}, ${n}, ${s[0]}, ${s[1]}, ${a} )`:`textureGrad( ${e}, ${n}, ${s[0]}, ${s[1]} )`}generateTextureCompare(t,e,n,s,i,a,c=this.shaderStage){if(c==="fragment")return t.isCubeTexture?`texture( ${e}, vec4( ${n}, ${s} ) )`:i?a?`textureOffset( ${e}, vec4( ${n}, ${i}, ${s} ), ${a} )`:`texture( ${e}, vec4( ${n}, ${i}, ${s} ) )`:a?`textureOffset( ${e}, vec3( ${n}, ${s} ), ${a} )`:`texture( ${e}, vec3( ${n}, ${s} ) )`;Ht(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${c} shader.`)}getVars(t){const e=[],n=this.vars[t];if(n!==void 0)for(const s of n)e.push(`${this.getVar(s.type,s.name,s.count)};`);return e.join(`
	`)}getUniforms(t){const e=this.uniforms[t],n=[],s={};for(const a of e){let c=null,u=!1;if(a.type==="texture"||a.type==="texture3D"){const d=a.node.value;let f="";(d.isDataTexture===!0||d.isData3DTexture===!0)&&(d.type===Jn?f="u":d.type===pi&&(f="i")),a.type==="texture3D"&&d.isArrayTexture===!1?c=`${f}sampler3D ${a.name};`:d.compareFunction?d.isArrayTexture===!0?c=`sampler2DArrayShadow ${a.name};`:c=`sampler2DShadow ${a.name};`:d.isArrayTexture===!0||d.isDataArrayTexture===!0||d.isCompressedArrayTexture===!0?c=`${f}sampler2DArray ${a.name};`:c=`${f}sampler2D ${a.name};`}else if(a.type==="cubeTexture")c=`samplerCube ${a.name};`;else if(a.type==="cubeDepthTexture")a.node.value.compareFunction?c=`samplerCubeShadow ${a.name};`:c=`samplerCube ${a.name};`;else if(a.type==="buffer"){const d=a.node,f=this.getType(d.bufferType),p=d.bufferCount,g=p>0?p:"";c=`${d.name} {
	${f} ${a.name}[${g}];
};
`}else{const d=a.groupNode.name;if(s[d]===void 0){const f=this.uniformGroups[d];if(f!==void 0){const p=[];for(const g of f.uniforms){const y=g.getType(),x=this.getVectorType(y),S=g.nodeUniform.node.precision;let T=`${x} ${g.name};`;S!==null&&(T=nE[S]+" "+T),p.push("	"+T)}s[d]=p}}u=!0}if(!u){const d=a.node.precision;d!==null&&(c=nE[d]+" "+c),c="uniform "+c,n.push(c)}}let i="";for(const a in s){const c=s[a];i+=this._getGLSLUniformStruct(a,c.join(`
`))+`
`}return i+=n.join(`
`),i}getTypeFromAttribute(t){let e=super.getTypeFromAttribute(t);if(/^[iu]/.test(e)&&t.gpuType!==pi){let n=t;t.isInterleavedBufferAttribute&&(n=t.data);const s=n.array;s instanceof Uint32Array||s instanceof Int32Array||(e=e.slice(1))}return e}getAttributes(t){let e="";if(t==="vertex"||t==="compute"){const n=this.getAttributesArray();let s=0;for(const i of n)e+=`layout( location = ${s++} ) in ${i.type} ${i.name};
`}return e}getStructMembers(t){const e=[];for(const n of t.members)e.push(`	${n.type} ${n.name};`);return e.join(`
`)}getStructs(t){const e=[],n=this.structs[t],s=[];for(const i of n)if(i.output)for(const a of i.members)s.push(`layout( location = ${a.index} ) out ${a.type} ${a.name};`);else{let a="struct "+i.name+` {
`;a+=this.getStructMembers(i),a+=`
};
`,e.push(a)}return s.length===0&&s.push("layout( location = 0 ) out vec4 fragColor;"),`
`+s.join(`
`)+`

`+e.join(`
`)}getVaryings(t){let e="";const n=this.varyings;if(t==="vertex"||t==="compute")for(const s of n){t==="compute"&&(s.needsInterpolation=!0);const i=this.getType(s.type);if(s.needsInterpolation)if(s.interpolationType){const a=iE[s.interpolationType]||s.interpolationType,c=rE[s.interpolationSampling]||"";e+=`${a} ${c} out ${i} ${s.name};
`}else{const a=i.includes("int")||i.includes("uv")||i.includes("iv")?"flat ":"";e+=`${a}out ${i} ${s.name};
`}else e+=`${i} ${s.name};
`}else if(t==="fragment"){for(const s of n)if(s.needsInterpolation){const i=this.getType(s.type);if(s.interpolationType){const a=iE[s.interpolationType]||s.interpolationType,c=rE[s.interpolationSampling]||"";e+=`${a} ${c} in ${i} ${s.name};
`}else{const a=i.includes("int")||i.includes("uv")||i.includes("iv")?"flat ":"";e+=`${a}in ${i} ${s.name};
`}}}for(const s of this.builtins[t])e+=`${s};
`;return e}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,s)=>n*s,1)}u`}getSubgroupSize(){Ht("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){Ht("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){Ht("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(t,e,n=this.shaderStage){const s=this.extensions[n]||(this.extensions[n]=new Map);s.has(t)===!1&&s.set(t,{name:t,behavior:e})}getExtensions(t){const e=[];if(t==="vertex"){const s=this.renderer.backend.extensions;this.object.isBatchedMesh&&s.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",t)}const n=this.extensions[t];if(n!==void 0)for(const{name:s,behavior:i}of n.values())e.push(`#extension ${s} : ${i}`);return e.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(t){let e=sE[t];if(e===void 0){let n;switch(e=!1,t){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const s=this.renderer.backend.extensions;s.has(n)&&(s.get(n),e=!0)}sE[t]=e}return e}isFlipY(){return!0}getUniformBufferLimit(){const t=this.renderer.backend.gl;return t.getParameter(t.MAX_UNIFORM_BLOCK_SIZE)}enableHardwareClipping(t){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${t} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(t,e){this.transforms.push({varyingName:t,attributeNode:e})}getTransforms(){const t=this.transforms;let e="";for(let n=0;n<t.length;n++){const s=t[n],i=this.getPropertyName(s.attributeNode);i&&(e+=`${s.varyingName} = ${i};
	`)}return e}_getGLSLUniformStruct(t,e){return`
layout( std140 ) uniform ${t} {
${e}
};`}_getGLSLVertexCode(t){return`#version 300 es

${this.getSignature()}

// extensions
${t.extensions}

// precision
${oE}

// uniforms
${t.uniforms}

// varyings
${t.varyings}

// attributes
${t.attributes}

// codes
${t.codes}

void main() {

	// vars
	${t.vars}

	// transforms
	${t.transforms}

	// flow
	${t.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(t){return`#version 300 es

${this.getSignature()}

// extensions
${t.extensions}

// precision
${oE}

// structs
${t.structs}

// uniforms
${t.uniforms}

// varyings
${t.varyings}

// codes
${t.codes}

void main() {

	// vars
	${t.vars}

	// flow
	${t.flow}

}
`}buildCode(){const t=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const e in t){let n=`// code

`;n+=this.flowCode[e];const s=this.flowNodes[e],i=s[s.length-1];for(const c of s){const u=this.getFlowData(c),d=c.name;d&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${d}
	`),n+=`${u.code}
	`,c===i&&e!=="compute"&&(n+=`// result
	`,e==="vertex"?(n+="gl_Position = ",n+=`${u.result};`):e==="fragment"&&(c.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${u.result};`)))}const a=t[e];a.extensions=this.getExtensions(e),a.uniforms=this.getUniforms(e),a.attributes=this.getAttributes(e),a.varyings=this.getVaryings(e),a.vars=this.getVars(e),a.structs=this.getStructs(e),a.codes=this.getCodes(e),a.transforms=this.getTransforms(e),a.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(t.vertex),this.fragmentShader=this._getGLSLFragmentCode(t.fragment)):this.computeShader=this._getGLSLVertexCode(t.compute)}getUniformFromNode(t,e,n,s=null){const i=super.getUniformFromNode(t,e,n,s),a=this.getDataFromNode(t,n,this.globalCache);let c=a.uniformGPU;if(c===void 0){const u=t.groupNode,d=u.name,f=this.getBindGroupArray(d,n);if(e==="texture")c=new kx(i.name,i.node,u),f.push(c);else if(e==="cubeTexture"||e==="cubeDepthTexture")c=new KB(i.name,i.node,u),f.push(c);else if(e==="texture3D")c=new dw(i.name,i.node,u),f.push(c);else if(e==="buffer"){i.name=`buffer${t.id}`;const p=this.getSharedDataFromNode(t);let g=p.buffer;g===void 0&&(t.name=`NodeBuffer_${t.id}`,g=new XB(t,u),g.name=t.name,p.buffer=g),f.push(g),c=g}else{let p=this.uniformGroups[d];p===void 0?(p=new jB(d,u),this.uniformGroups[d]=p,f.push(p)):f.indexOf(p)===-1&&f.push(p),c=this.getNodeUniform(i,e);const g=c.name;p.uniforms.some(x=>x.name===g)||p.addUniform(c)}a.uniformGPU=c}return i}}let l2=null,Zh=null;class ZB{constructor(t={}){this.parameters=Object.assign({},t),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[Jo.RENDER]:null,[Jo.COMPUTE]:null},this.trackTimestamp=t.trackTimestamp===!0}async init(t){this.renderer=t}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(t){const e=this.get(t),n=this.renderer.info.frame;let s;t.isComputeNode===!0?s="c:"+this.renderer.info.compute.frameCalls:s="r:"+this.renderer.info.render.frameCalls,e.timestampUID=s+":"+t.id+":f"+n}getTimestampUID(t){return this.get(t).timestampUID}getTimestampFrames(t){const e=this.timestampQueryPool[t];return e?e.getTimestampFrames():[]}_getQueryPool(t){const e=t.startsWith("c:")?Jo.COMPUTE:Jo.RENDER;return this.timestampQueryPool[e]}getTimestamp(t){return this._getQueryPool(t).getTimestamp(t)}hasTimestamp(t){return this._getQueryPool(t).hasTimestamp(t)}isOccluded(){}async resolveTimestampsAsync(t="render"){if(!this.trackTimestamp){an("WebGPURenderer: Timestamp tracking is disabled.");return}const e=this.timestampQueryPool[t];if(!e)return;const n=await e.resolveQueriesAsync();return this.renderer.info[t].timestamp=n,n}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return l2=l2||new Ut,this.renderer.getDrawingBufferSize(l2)}setScissorTest(){}getClearColor(){const t=this.renderer;return Zh=Zh||new s_,t.getClearColor(Zh),Zh.getRGB(Zh),Zh}getDomElement(){let t=this.domElement;return t===null&&(t=this.parameters.canvas!==void 0?this.parameters.canvas:xU(),"setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Hp} webgpu`),this.domElement=t),t}hasCompatibility(){return!1}initRenderTarget(){}set(t,e){this.data.set(t,e)}get(t){let e=this.data.get(t);return e===void 0&&(e={},this.data.set(t,e)),e}has(t){return this.data.has(t)}delete(t){this.data.delete(t)}deleteBindGroupData(){}dispose(){}}let kW=0;class HW{constructor(t,e){this.buffers=[t.bufferGPU,e],this.type=t.type,this.bufferType=t.bufferType,this.pbo=t.pbo,this.byteLength=t.byteLength,this.bytesPerElement=t.BYTES_PER_ELEMENT,this.version=t.version,this.isInteger=t.isInteger,this.activeBufferIndex=0,this.baseId=t.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class WW{constructor(t){this.backend=t}createAttribute(t,e){const n=this.backend,{gl:s}=n,i=t.array,a=t.usage||s.STATIC_DRAW,c=t.isInterleavedBufferAttribute?t.data:t,u=n.get(c);let d=u.bufferGPU;d===void 0&&(d=this._createBuffer(s,e,i,a),u.bufferGPU=d,u.bufferType=e,u.version=c.version);let f;if(i instanceof Float32Array)f=s.FLOAT;else if(typeof Float16Array<"u"&&i instanceof Float16Array)f=s.HALF_FLOAT;else if(i instanceof Uint16Array)t.isFloat16BufferAttribute?f=s.HALF_FLOAT:f=s.UNSIGNED_SHORT;else if(i instanceof Int16Array)f=s.SHORT;else if(i instanceof Uint32Array)f=s.UNSIGNED_INT;else if(i instanceof Int32Array)f=s.INT;else if(i instanceof Int8Array)f=s.BYTE;else if(i instanceof Uint8Array)f=s.UNSIGNED_BYTE;else if(i instanceof Uint8ClampedArray)f=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+i);let p={bufferGPU:d,bufferType:e,type:f,byteLength:i.byteLength,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,pbo:t.pbo,isInteger:f===s.INT||f===s.UNSIGNED_INT||t.gpuType===pi,id:kW++};if(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute){const g=this._createBuffer(s,e,i,a);p=new HW(p,g)}n.set(t,p)}updateAttribute(t){const e=this.backend,{gl:n}=e,s=t.array,i=t.isInterleavedBufferAttribute?t.data:t,a=e.get(i),c=a.bufferType,u=t.isInterleavedBufferAttribute?t.data.updateRanges:t.updateRanges;if(n.bindBuffer(c,a.bufferGPU),u.length===0)n.bufferSubData(c,0,s);else{for(let d=0,f=u.length;d<f;d++){const p=u[d];n.bufferSubData(c,p.start*s.BYTES_PER_ELEMENT,s,p.start,p.count)}i.clearUpdateRanges()}n.bindBuffer(c,null),a.version=i.version}destroyAttribute(t){const e=this.backend,{gl:n}=e;t.isInterleavedBufferAttribute&&e.delete(t.data);const s=e.get(t);n.deleteBuffer(s.bufferGPU),e.delete(t)}async getArrayBufferAsync(t){const e=this.backend,{gl:n}=e,s=t.isInterleavedBufferAttribute?t.data:t,{bufferGPU:i}=e.get(s),a=t.array,c=a.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,i);const u=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,u),n.bufferData(n.COPY_WRITE_BUFFER,c,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,c),await e.utils._clientWaitAsync();const d=new t.array.constructor(a.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,u),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,d),n.deleteBuffer(u),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),d.buffer}_createBuffer(t,e,n,s){const i=t.createBuffer();return t.bindBuffer(e,i),t.bufferData(e,n,s),t.bindBuffer(e,null),i}}let $f,qa;class qW{constructor(t){this.backend=t,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthReversed=!1,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const t=this.gl;$f={[Xr]:t.FUNC_ADD,[B3]:t.FUNC_SUBTRACT,[L3]:t.FUNC_REVERSE_SUBTRACT},qa={[lc]:t.ZERO,[O3]:t.ONE,[F3]:t.SRC_COLOR,[Rp]:t.SRC_ALPHA,[G3]:t.SRC_ALPHA_SATURATE,[I3]:t.DST_COLOR,[P3]:t.DST_ALPHA,[U3]:t.ONE_MINUS_SRC_COLOR,[Ep]:t.ONE_MINUS_SRC_ALPHA,[V3]:t.ONE_MINUS_DST_COLOR,[z3]:t.ONE_MINUS_DST_ALPHA};const e=t.getParameter(t.SCISSOR_BOX),n=t.getParameter(t.VIEWPORT);this.currentScissor=new Ze().fromArray(e),this.currentViewport=new Ze().fromArray(n),this._tempVec4=new Ze}enable(t){const{enabled:e}=this;e[t]!==!0&&(this.gl.enable(t),e[t]=!0)}disable(t){const{enabled:e}=this;e[t]!==!1&&(this.gl.disable(t),e[t]=!1)}setFlipSided(t){if(this.currentFlipSided!==t){const{gl:e}=this;t?e.frontFace(e.CW):e.frontFace(e.CCW),this.currentFlipSided=t}}setCullFace(t){const{gl:e}=this;t!==PF?(this.enable(e.CULL_FACE),t!==this.currentCullFace&&(t===zF?e.cullFace(e.BACK):t===IF?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this.disable(e.CULL_FACE),this.currentCullFace=t}setLineWidth(t){const{currentLineWidth:e,gl:n}=this;t!==e&&(n.lineWidth(t),this.currentLineWidth=t)}setMRTBlending(t,e,n){const s=this.gl,i=this.backend.drawBuffersIndexedExt;if(!i){an("WebGPURenderer: Multiple Render Targets (MRT) blending configuration is not fully supported in compatibility mode. The material blending will be used for all render targets.");return}for(let a=0;a<t.length;a++){const c=t[a];let u=null;if(e!==null){const d=e.getBlendMode(c.name);d.blending===_w?u=n:d.blending!==rl&&(u=d)}else u=n;u!==null?this._setMRTBlendingIndex(a,u):i.blendFuncSeparateiOES(a,s.ONE,s.ZERO,s.ONE,s.ZERO)}}_setMRTBlendingIndex(t,e){const{gl:n}=this,s=this.backend.drawBuffersIndexedExt,i=e.blending,a=e.blendSrc,c=e.blendDst,u=e.blendEquation,d=e.premultipliedAlpha;if(i===ud){const f=e.blendSrcAlpha!==null?e.blendSrcAlpha:a,p=e.blendDstAlpha!==null?e.blendDstAlpha:c,g=e.blendEquationAlpha!==null?e.blendEquationAlpha:u;s.blendEquationSeparateiOES(t,$f[u],$f[g]),s.blendFuncSeparateiOES(t,qa[a],qa[c],qa[f],qa[p])}else if(s.blendEquationSeparateiOES(t,n.FUNC_ADD,n.FUNC_ADD),d)switch(i){case mi:s.blendFuncSeparateiOES(t,n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Tr:s.blendFuncSeparateiOES(t,n.ONE,n.ONE,n.ONE,n.ONE);break;case od:s.blendFuncSeparateiOES(t,n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case ad:s.blendFuncSeparateiOES(t,n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:s.blendFuncSeparateiOES(t,n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break}else switch(i){case mi:s.blendFuncSeparateiOES(t,n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Tr:s.blendFuncSeparateiOES(t,n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case od:s.blendFuncSeparateiOES(t,n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case ad:s.blendFuncSeparateiOES(t,n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:s.blendFuncSeparateiOES(t,n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break}}setBlending(t,e,n,s,i,a,c,u){const{gl:d}=this;if(t===rl){this.currentBlendingEnabled===!0&&(this.disable(d.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(d.BLEND),this.currentBlendingEnabled=!0),t!==ud){if(t!==this.currentBlending||u!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==Xr||this.currentBlendEquationAlpha!==Xr)&&(d.blendEquation(d.FUNC_ADD),this.currentBlendEquation=Xr,this.currentBlendEquationAlpha=Xr),u)switch(t){case mi:d.blendFuncSeparate(d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case Tr:d.blendFunc(d.ONE,d.ONE);break;case od:d.blendFuncSeparate(d.ZERO,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);break;case ad:d.blendFuncSeparate(d.DST_COLOR,d.ONE_MINUS_SRC_ALPHA,d.ZERO,d.ONE);break;default:Ht("WebGLState: Invalid blending: ",t);break}else switch(t){case mi:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case Tr:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE,d.ONE,d.ONE);break;case od:Ht("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case ad:Ht("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Ht("WebGLState: Invalid blending: ",t);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=t,this.currentPremultipledAlpha=u}return}i=i||e,a=a||n,c=c||s,(e!==this.currentBlendEquation||i!==this.currentBlendEquationAlpha)&&(d.blendEquationSeparate($f[e],$f[i]),this.currentBlendEquation=e,this.currentBlendEquationAlpha=i),(n!==this.currentBlendSrc||s!==this.currentBlendDst||a!==this.currentBlendSrcAlpha||c!==this.currentBlendDstAlpha)&&(d.blendFuncSeparate(qa[n],qa[s],qa[a],qa[c]),this.currentBlendSrc=n,this.currentBlendDst=s,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=c),this.currentBlending=t,this.currentPremultipledAlpha=!1}setColorMask(t){this.currentColorMask!==t&&(this.gl.colorMask(t,t,t,t),this.currentColorMask=t)}setDepthTest(t){const{gl:e}=this;t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)}setReversedDepth(t){if(this.currentDepthReversed!==t){const e=this.backend.extensions.get("EXT_clip_control");t?e.clipControlEXT(e.LOWER_LEFT_EXT,e.ZERO_TO_ONE_EXT):e.clipControlEXT(e.LOWER_LEFT_EXT,e.NEGATIVE_ONE_TO_ONE_EXT),this.currentDepthReversed=t}}setDepthMask(t){this.currentDepthMask!==t&&(this.gl.depthMask(t),this.currentDepthMask=t)}setDepthFunc(t){if(this.currentDepthReversed&&(t=J3[t]),this.currentDepthFunc!==t){const{gl:e}=this;switch(t){case jg:e.depthFunc(e.NEVER);break;case Yg:e.depthFunc(e.ALWAYS);break;case Kg:e.depthFunc(e.LESS);break;case bd:e.depthFunc(e.LEQUAL);break;case Zg:e.depthFunc(e.EQUAL);break;case Qg:e.depthFunc(e.GEQUAL);break;case Jg:e.depthFunc(e.GREATER);break;case ty:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}this.currentDepthFunc=t}}scissor(t,e,n,s){const i=this._tempVec4.set(t,e,n,s);if(this.currentScissor.equals(i)===!1){const{gl:a}=this;a.scissor(i.x,i.y,i.z,i.w),this.currentScissor.copy(i)}}viewport(t,e,n,s){const i=this._tempVec4.set(t,e,n,s);if(this.currentViewport.equals(i)===!1){const{gl:a}=this;a.viewport(i.x,i.y,i.z,i.w),this.currentViewport.copy(i)}}setScissorTest(t){const e=this.gl;t?this.enable(e.SCISSOR_TEST):this.disable(e.SCISSOR_TEST)}setStencilTest(t){const{gl:e}=this;t?this.enable(e.STENCIL_TEST):this.disable(e.STENCIL_TEST)}setStencilMask(t){this.currentStencilMask!==t&&(this.gl.stencilMask(t),this.currentStencilMask=t)}setStencilFunc(t,e,n){(this.currentStencilFunc!==t||this.currentStencilRef!==e||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(t,e,n),this.currentStencilFunc=t,this.currentStencilRef=e,this.currentStencilFuncMask=n)}setStencilOp(t,e,n){(this.currentStencilFail!==t||this.currentStencilZFail!==e||this.currentStencilZPass!==n)&&(this.gl.stencilOp(t,e,n),this.currentStencilFail=t,this.currentStencilZFail=e,this.currentStencilZPass=n)}setMaterial(t,e,n){const{gl:s}=this;t.side===ss?this.disable(s.CULL_FACE):this.enable(s.CULL_FACE);let i=t.side===Ss;e&&(i=!i),this.setFlipSided(i),t.blending===mi&&t.transparent===!1?this.setBlending(rl):this.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),this.setDepthFunc(t.depthFunc),this.setDepthTest(t.depthTest),this.setDepthMask(t.depthWrite),this.setColorMask(t.colorWrite);const a=t.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(t.stencilWriteMask),this.setStencilFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),this.setStencilOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),this.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),t.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(s.SAMPLE_ALPHA_TO_COVERAGE):this.disable(s.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let u=0;u<8;u++)u<n?this.enable(12288+u):this.disable(12288+u)}setPolygonOffset(t,e,n){const{gl:s}=this;t?(this.enable(s.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==e||this.currentPolygonOffsetUnits!==n)&&(s.polygonOffset(e,n),this.currentPolygonOffsetFactor=e,this.currentPolygonOffsetUnits=n)):this.disable(s.POLYGON_OFFSET_FILL)}useProgram(t){return this.currentProgram!==t?(this.gl.useProgram(t),this.currentProgram=t,!0):!1}setVertexState(t,e=null){const n=this.gl;return this.currentVAO!==t||this.currentIndex!==e?(n.bindVertexArray(t),e!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.currentVAO=t,this.currentIndex=e,!0):!1}resetVertexState(){const t=this.gl;t.bindVertexArray(null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(t,e){const{gl:n,currentBoundFramebuffers:s}=this;return s[t]!==e?(n.bindFramebuffer(t,e),s[t]=e,t===n.DRAW_FRAMEBUFFER&&(s[n.FRAMEBUFFER]=e),t===n.FRAMEBUFFER&&(s[n.DRAW_FRAMEBUFFER]=e),!0):!1}drawBuffers(t,e){const{gl:n}=this;let s=[],i=!1;if(t.textures!==null){s=this.currentDrawbuffers.get(e),s===void 0&&(s=[],this.currentDrawbuffers.set(e,s));const a=t.textures;if(s.length!==a.length||s[0]!==n.COLOR_ATTACHMENT0){for(let c=0,u=a.length;c<u;c++)s[c]=n.COLOR_ATTACHMENT0+c;s.length=a.length,i=!0}}else s[0]!==n.BACK&&(s[0]=n.BACK,i=!0);i&&n.drawBuffers(s)}activeTexture(t){const{gl:e,currentTextureSlot:n,maxTextures:s}=this;t===void 0&&(t=e.TEXTURE0+s-1),n!==t&&(e.activeTexture(t),this.currentTextureSlot=t)}bindTexture(t,e,n){const{gl:s,currentTextureSlot:i,currentBoundTextures:a,maxTextures:c}=this;n===void 0&&(i===null?n=s.TEXTURE0+c-1:n=i);let u=a[n];u===void 0&&(u={type:void 0,texture:void 0},a[n]=u),(u.type!==t||u.texture!==e)&&(i!==n&&(s.activeTexture(n),this.currentTextureSlot=n),s.bindTexture(t,e),u.type=t,u.texture=e)}bindBufferBase(t,e,n){const{gl:s}=this,i=`${t}-${e}`;return this.currentBoundBufferBases[i]!==n?(s.bindBufferBase(t,e,n),this.currentBoundBufferBases[i]=n,!0):!1}unbindTexture(){const{gl:t,currentTextureSlot:e,currentBoundTextures:n}=this,s=n[e];s!==void 0&&s.type!==void 0&&(t.bindTexture(s.type,null),s.type=void 0,s.texture=void 0)}}class $W{constructor(t){this.backend=t,this.gl=this.backend.gl,this.extensions=t.extensions}convert(t,e=Ec){const{gl:n,extensions:s}=this;let i;const a=Xe.getTransfer(e);if(t===xi)return n.UNSIGNED_BYTE;if(t===H3)return n.UNSIGNED_SHORT_4_4_4_4;if(t===W3)return n.UNSIGNED_SHORT_5_5_5_1;if(t===Nw)return n.UNSIGNED_INT_5_9_9_9_REV;if(t===Rw)return n.UNSIGNED_INT_10F_11F_11F_REV;if(t===hd)return n.BYTE;if(t===dd)return n.SHORT;if(t===Eu)return n.UNSIGNED_SHORT;if(t===pi)return n.INT;if(t===Jn)return n.UNSIGNED_INT;if(t===Di)return n.FLOAT;if(t===ii)return n.HALF_FLOAT;if(t===q3)return n.ALPHA;if(t===tx)return n.RGB;if(t===Ki)return n.RGBA;if(t===Mo)return n.DEPTH_COMPONENT;if(t===ol)return n.DEPTH_STENCIL;if(t===Wp)return n.RED;if(t===ex)return n.RED_INTEGER;if(t===Qo)return n.RG;if(t===nx)return n.RG_INTEGER;if(t===sx)return n.RGBA_INTEGER;if(t===hp||t===dp||t===fp||t===pp)if(a===ye)if(i=s.get("WEBGL_compressed_texture_s3tc_srgb"),i!==null){if(t===hp)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===dp)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===fp)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===pp)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(i=s.get("WEBGL_compressed_texture_s3tc"),i!==null){if(t===hp)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===dp)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===fp)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===pp)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(t===L2||t===O2||t===F2||t===U2)if(i=s.get("WEBGL_compressed_texture_pvrtc"),i!==null){if(t===L2)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===O2)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===F2)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===U2)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(t===ny||t===sy||t===iy||t===ry||t===oy||t===Dp||t===ay)if(i=s.get("WEBGL_compressed_texture_etc"),i!==null){if(t===ny||t===sy)return a===ye?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(t===iy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC;if(t===ry)return i.COMPRESSED_R11_EAC;if(t===oy)return i.COMPRESSED_SIGNED_R11_EAC;if(t===Dp)return i.COMPRESSED_RG11_EAC;if(t===ay)return i.COMPRESSED_SIGNED_RG11_EAC}else return null;if(t===ly||t===cy||t===uy||t===hy||t===dy||t===fy||t===py||t===my||t===gy||t===yy||t===xy||t===by||t===Sy||t===wy)if(i=s.get("WEBGL_compressed_texture_astc"),i!==null){if(t===ly)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===cy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===uy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===hy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===dy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===fy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===py)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===my)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===gy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===yy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===xy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===by)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===Sy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===wy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(t===Ty)if(i=s.get("EXT_texture_compression_bptc"),i!==null){if(t===Ty)return a===ye?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(t===_y||t===My||t===Bp||t===vy)if(i=s.get("EXT_texture_compression_rgtc"),i!==null){if(t===_y)return i.COMPRESSED_RED_RGTC1_EXT;if(t===My)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(t===Bp)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(t===vy)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return t===Tc?n.UNSIGNED_INT_24_8:n[t]!==void 0?n[t]:null}_clientWaitAsync(){const{gl:t}=this,e=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0);return t.flush(),new Promise((n,s)=>{function i(){const a=t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0);if(a===t.WAIT_FAILED){t.deleteSync(e),s();return}if(a===t.TIMEOUT_EXPIRED){requestAnimationFrame(i);return}t.deleteSync(e),n()}i()})}}let aE=!1,fg,c2,lE;class XW{constructor(t){this.backend=t,this.gl=t.gl,this.extensions=t.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,aE===!1&&(this._init(),aE=!0)}_init(){const t=this.gl;fg={[Fn]:t.REPEAT,[Yi]:t.CLAMP_TO_EDGE,[wd]:t.MIRRORED_REPEAT},c2={[ts]:t.NEAREST,[k3]:t.NEAREST_MIPMAP_NEAREST,[Cp]:t.NEAREST_MIPMAP_LINEAR,[$s]:t.LINEAR,[B2]:t.LINEAR_MIPMAP_NEAREST,[sa]:t.LINEAR_MIPMAP_LINEAR},lE={[X3]:t.NEVER,[Z3]:t.ALWAYS,[Ew]:t.LESS,[ix]:t.LEQUAL,[j3]:t.EQUAL,[rx]:t.GEQUAL,[Y3]:t.GREATER,[K3]:t.NOTEQUAL}}getGLTextureType(t){const{gl:e}=this;let n;return t.isCubeTexture===!0?n=e.TEXTURE_CUBE_MAP:t.isArrayTexture===!0||t.isDataArrayTexture===!0||t.isCompressedArrayTexture===!0?n=e.TEXTURE_2D_ARRAY:t.isData3DTexture===!0?n=e.TEXTURE_3D:n=e.TEXTURE_2D,n}getInternalFormat(t,e,n,s,i=!1){const{gl:a,extensions:c}=this;if(t!==null){if(a[t]!==void 0)return a[t];Wt("WebGLBackend: Attempt to use non-existing WebGL internal format '"+t+"'")}let u=e;if(e===a.RED&&(n===a.FLOAT&&(u=a.R32F),n===a.HALF_FLOAT&&(u=a.R16F),n===a.UNSIGNED_BYTE&&(u=a.R8),n===a.UNSIGNED_SHORT&&(u=a.R16),n===a.UNSIGNED_INT&&(u=a.R32UI),n===a.BYTE&&(u=a.R8I),n===a.SHORT&&(u=a.R16I),n===a.INT&&(u=a.R32I)),e===a.RED_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.R8UI),n===a.UNSIGNED_SHORT&&(u=a.R16UI),n===a.UNSIGNED_INT&&(u=a.R32UI),n===a.BYTE&&(u=a.R8I),n===a.SHORT&&(u=a.R16I),n===a.INT&&(u=a.R32I)),e===a.RG&&(n===a.FLOAT&&(u=a.RG32F),n===a.HALF_FLOAT&&(u=a.RG16F),n===a.UNSIGNED_BYTE&&(u=a.RG8),n===a.UNSIGNED_SHORT&&(u=a.RG16),n===a.UNSIGNED_INT&&(u=a.RG32UI),n===a.BYTE&&(u=a.RG8I),n===a.SHORT&&(u=a.RG16I),n===a.INT&&(u=a.RG32I)),e===a.RG_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.RG8UI),n===a.UNSIGNED_SHORT&&(u=a.RG16UI),n===a.UNSIGNED_INT&&(u=a.RG32UI),n===a.BYTE&&(u=a.RG8I),n===a.SHORT&&(u=a.RG16I),n===a.INT&&(u=a.RG32I)),e===a.RGB){const d=i?Ny:Xe.getTransfer(s);n===a.FLOAT&&(u=a.RGB32F),n===a.HALF_FLOAT&&(u=a.RGB16F),n===a.UNSIGNED_BYTE&&(u=a.RGB8),n===a.UNSIGNED_SHORT&&(u=a.RGB16),n===a.UNSIGNED_INT&&(u=a.RGB32UI),n===a.BYTE&&(u=a.RGB8I),n===a.SHORT&&(u=a.RGB16I),n===a.INT&&(u=a.RGB32I),n===a.UNSIGNED_BYTE&&(u=d===ye?a.SRGB8:a.RGB8),n===a.UNSIGNED_SHORT_5_6_5&&(u=a.RGB565),n===a.UNSIGNED_SHORT_5_5_5_1&&(u=a.RGB5_A1),n===a.UNSIGNED_SHORT_4_4_4_4&&(u=a.RGB4),n===a.UNSIGNED_INT_5_9_9_9_REV&&(u=a.RGB9_E5),n===a.UNSIGNED_INT_10F_11F_11F_REV&&(u=a.R11F_G11F_B10F)}if(e===a.RGB_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.RGB8UI),n===a.UNSIGNED_SHORT&&(u=a.RGB16UI),n===a.UNSIGNED_INT&&(u=a.RGB32UI),n===a.BYTE&&(u=a.RGB8I),n===a.SHORT&&(u=a.RGB16I),n===a.INT&&(u=a.RGB32I)),e===a.RGBA){const d=i?Ny:Xe.getTransfer(s);n===a.FLOAT&&(u=a.RGBA32F),n===a.HALF_FLOAT&&(u=a.RGBA16F),n===a.UNSIGNED_BYTE&&(u=a.RGBA8),n===a.UNSIGNED_SHORT&&(u=a.RGBA16),n===a.UNSIGNED_INT&&(u=a.RGBA32UI),n===a.BYTE&&(u=a.RGBA8I),n===a.SHORT&&(u=a.RGBA16I),n===a.INT&&(u=a.RGBA32I),n===a.UNSIGNED_BYTE&&(u=d===ye?a.SRGB8_ALPHA8:a.RGBA8),n===a.UNSIGNED_SHORT_4_4_4_4&&(u=a.RGBA4),n===a.UNSIGNED_SHORT_5_5_5_1&&(u=a.RGB5_A1)}return e===a.RGBA_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.RGBA8UI),n===a.UNSIGNED_SHORT&&(u=a.RGBA16UI),n===a.UNSIGNED_INT&&(u=a.RGBA32UI),n===a.BYTE&&(u=a.RGBA8I),n===a.SHORT&&(u=a.RGBA16I),n===a.INT&&(u=a.RGBA32I)),e===a.DEPTH_COMPONENT&&(n===a.UNSIGNED_SHORT&&(u=a.DEPTH_COMPONENT16),n===a.UNSIGNED_INT&&(u=a.DEPTH_COMPONENT24),n===a.FLOAT&&(u=a.DEPTH_COMPONENT32F)),e===a.DEPTH_STENCIL&&n===a.UNSIGNED_INT_24_8&&(u=a.DEPTH24_STENCIL8),(u===a.R16F||u===a.R32F||u===a.RG16F||u===a.RG32F||u===a.RGBA16F||u===a.RGBA32F)&&c.get("EXT_color_buffer_float"),u}setTextureParameters(t,e){const{gl:n,extensions:s,backend:i}=this,a=Xe.getPrimaries(Xe.workingColorSpace),c=e.colorSpace===Ec?null:Xe.getPrimaries(e.colorSpace),u=e.colorSpace===Ec||a===c?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,e.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,u),n.texParameteri(t,n.TEXTURE_WRAP_S,fg[e.wrapS]),n.texParameteri(t,n.TEXTURE_WRAP_T,fg[e.wrapT]),(t===n.TEXTURE_3D||t===n.TEXTURE_2D_ARRAY)&&(e.isArrayTexture||n.texParameteri(t,n.TEXTURE_WRAP_R,fg[e.wrapR])),n.texParameteri(t,n.TEXTURE_MAG_FILTER,c2[e.magFilter]);const d=e.mipmaps!==void 0&&e.mipmaps.length>0,f=e.minFilter===$s&&d?sa:e.minFilter;if(n.texParameteri(t,n.TEXTURE_MIN_FILTER,c2[f]),e.compareFunction&&(n.texParameteri(t,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(t,n.TEXTURE_COMPARE_FUNC,lE[e.compareFunction])),s.has("EXT_texture_filter_anisotropic")===!0){if(e.magFilter===ts||e.minFilter!==Cp&&e.minFilter!==sa||e.type===Di&&s.has("OES_texture_float_linear")===!1)return;if(e.anisotropy>1){const p=s.get("EXT_texture_filter_anisotropic");n.texParameterf(t,p.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,i.getMaxAnisotropy()))}}}createDefaultTexture(t){const{gl:e,backend:n,defaultTextures:s}=this,i=this.getGLTextureType(t);let a=s[i];a===void 0&&(a=e.createTexture(),n.state.bindTexture(i,a),e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST),s[i]=a),n.set(t,{textureGPU:a,glTextureType:i})}createTexture(t,e){const{gl:n,backend:s}=this,{levels:i,width:a,height:c,depth:u}=e,d=s.utils.convert(t.format,t.colorSpace),f=s.utils.convert(t.type),p=this.getInternalFormat(t.internalFormat,d,f,t.colorSpace,t.isVideoTexture),g=n.createTexture(),y=this.getGLTextureType(t);s.state.bindTexture(y,g),this.setTextureParameters(y,t),t.isArrayTexture||t.isDataArrayTexture||t.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,i,p,a,c,u):t.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,i,p,a,c,u):t.isVideoTexture||n.texStorage2D(y,i,p,a,c),s.set(t,{textureGPU:g,glTextureType:y,glFormat:d,glType:f,glInternalFormat:p})}copyBufferToTexture(t,e){const{gl:n,backend:s}=this,{textureGPU:i,glTextureType:a,glFormat:c,glType:u}=s.get(e),{width:d,height:f}=e.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,t),s.state.bindTexture(a,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(a,0,0,0,d,f,c,u,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),s.state.unbindTexture()}updateTexture(t,e){const{gl:n}=this,{width:s,height:i}=e,{textureGPU:a,glTextureType:c,glFormat:u,glType:d,glInternalFormat:f}=this.backend.get(t);if(!(t.isRenderTargetTexture||a===void 0))if(this.backend.state.bindTexture(c,a),this.setTextureParameters(c,t),t.isCompressedTexture){const p=t.mipmaps,g=e.image;for(let y=0;y<p.length;y++){const x=p[y];t.isCompressedArrayTexture?t.format!==n.RGBA?u!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,x.width,x.height,g.depth,u,x.data):Wt("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,x.width,x.height,g.depth,u,d,x.data):u!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,y,0,0,x.width,x.height,u,x.data):Wt("WebGLBackend: Unsupported compressed texture format")}}else if(t.isCubeTexture){const p=e.images,g=t.mipmaps;for(let y=0;y<6;y++){const x=pg(p[y]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+y,0,0,0,s,i,u,d,x);for(let S=0;S<g.length;S++){const T=g[S],M=pg(T.images[y]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+y,S+1,0,0,M.width,M.height,u,d,M)}}}else if(t.isDataArrayTexture||t.isArrayTexture){const p=e.image;if(t.layerUpdates.size>0){const g=rP(p.width,p.height,t.format,t.type);for(const y of t.layerUpdates){const x=p.data.subarray(y*g/p.data.BYTES_PER_ELEMENT,(y+1)*g/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,y,p.width,p.height,1,u,d,x)}t.clearLayerUpdates()}else n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,u,d,p.data)}else if(t.isData3DTexture){const p=e.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,u,d,p.data)}else if(t.isVideoTexture)t.update(),n.texImage2D(c,0,f,u,d,e.image);else{const p=t.mipmaps;if(p.length>0)for(let g=0,y=p.length;g<y;g++){const x=p[g],S=pg(x);n.texSubImage2D(c,g,0,0,x.width,x.height,u,d,S)}else{const g=pg(e.image);n.texSubImage2D(c,0,0,0,s,i,u,d,g)}}}generateMipmaps(t){const{gl:e,backend:n}=this,{textureGPU:s,glTextureType:i}=n.get(t);n.state.bindTexture(i,s),e.generateMipmap(i)}deallocateRenderBuffers(t){const{gl:e,backend:n}=this;if(t){const s=n.get(t);if(s.renderBufferStorageSetup=void 0,s.framebuffers){for(const i in s.framebuffers)e.deleteFramebuffer(s.framebuffers[i]);delete s.framebuffers}if(s.depthRenderbuffer&&(e.deleteRenderbuffer(s.depthRenderbuffer),delete s.depthRenderbuffer),s.stencilRenderbuffer&&(e.deleteRenderbuffer(s.stencilRenderbuffer),delete s.stencilRenderbuffer),s.msaaFrameBuffer&&(e.deleteFramebuffer(s.msaaFrameBuffer),delete s.msaaFrameBuffer),s.msaaRenderbuffers){for(let i=0;i<s.msaaRenderbuffers.length;i++)e.deleteRenderbuffer(s.msaaRenderbuffers[i]);delete s.msaaRenderbuffers}}}destroyTexture(t,e=!1){const{gl:n,backend:s}=this,{textureGPU:i,renderTarget:a}=s.get(t);this.deallocateRenderBuffers(a),e===!1&&n.deleteTexture(i),s.delete(t)}copyTextureToTexture(t,e,n=null,s=null,i=0,a=0){const{gl:c,backend:u}=this,{state:d}=this.backend,{textureGPU:f,glTextureType:p,glType:g,glFormat:y}=u.get(e);d.bindTexture(p,f);let x,S,T,M,N,v,A,R,L;const D=t.isCompressedTexture?t.mipmaps[a]:t.image;if(n!==null)x=n.max.x-n.min.x,S=n.max.y-n.min.y,T=n.isBox3?n.max.z-n.min.z:1,M=n.min.x,N=n.min.y,v=n.isBox3?n.min.z:0;else{const mt=Math.pow(2,-i);x=Math.floor(D.width*mt),S=Math.floor(D.height*mt),t.isDataArrayTexture||t.isArrayTexture?T=D.depth:t.isData3DTexture?T=Math.floor(D.depth*mt):T=1,M=0,N=0,v=0}s!==null?(A=s.x,R=s.y,L=s.z):(A=0,R=0,L=0),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,e.flipY),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),c.pixelStorei(c.UNPACK_ALIGNMENT,e.unpackAlignment);const U=c.getParameter(c.UNPACK_ROW_LENGTH),B=c.getParameter(c.UNPACK_IMAGE_HEIGHT),P=c.getParameter(c.UNPACK_SKIP_PIXELS),J=c.getParameter(c.UNPACK_SKIP_ROWS),q=c.getParameter(c.UNPACK_SKIP_IMAGES);c.pixelStorei(c.UNPACK_ROW_LENGTH,D.width),c.pixelStorei(c.UNPACK_IMAGE_HEIGHT,D.height),c.pixelStorei(c.UNPACK_SKIP_PIXELS,M),c.pixelStorei(c.UNPACK_SKIP_ROWS,N),c.pixelStorei(c.UNPACK_SKIP_IMAGES,v);const ft=t.isDataArrayTexture||t.isData3DTexture||e.isArrayTexture,Mt=e.isDataArrayTexture||e.isData3DTexture||e.isArrayTexture;if(t.isDepthTexture){const mt=u.get(t),F=u.get(e),Y=u.get(mt.renderTarget),tt=u.get(F.renderTarget),lt=Y.framebuffers[mt.cacheKey],Tt=tt.framebuffers[F.cacheKey];d.bindFramebuffer(c.READ_FRAMEBUFFER,lt),d.bindFramebuffer(c.DRAW_FRAMEBUFFER,Tt);for(let O=0;O<T;O++)ft&&(c.framebufferTextureLayer(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,mt.textureGPU,i,v+O),c.framebufferTextureLayer(c.DRAW_FRAMEBUFFER,c.COLOR_ATTACHMENT0,f,a,L+O)),c.blitFramebuffer(M,N,x,S,A,R,x,S,c.DEPTH_BUFFER_BIT,c.NEAREST);d.bindFramebuffer(c.READ_FRAMEBUFFER,null),d.bindFramebuffer(c.DRAW_FRAMEBUFFER,null)}else if(i!==0||t.isRenderTargetTexture||u.has(t)){const mt=u.get(t);this._srcFramebuffer===null&&(this._srcFramebuffer=c.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=c.createFramebuffer()),d.bindFramebuffer(c.READ_FRAMEBUFFER,this._srcFramebuffer),d.bindFramebuffer(c.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let F=0;F<T;F++)ft?c.framebufferTextureLayer(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,mt.textureGPU,i,v+F):c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,mt.textureGPU,i),Mt?c.framebufferTextureLayer(c.DRAW_FRAMEBUFFER,c.COLOR_ATTACHMENT0,f,a,L+F):c.framebufferTexture2D(c.DRAW_FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,f,a),i!==0?c.blitFramebuffer(M,N,x,S,A,R,x,S,c.COLOR_BUFFER_BIT,c.NEAREST):Mt?c.copyTexSubImage3D(p,a,A,R,L+F,M,N,x,S):c.copyTexSubImage2D(p,a,A,R,M,N,x,S);d.bindFramebuffer(c.READ_FRAMEBUFFER,null),d.bindFramebuffer(c.DRAW_FRAMEBUFFER,null)}else Mt?t.isDataTexture||t.isData3DTexture?c.texSubImage3D(p,a,A,R,L,x,S,T,y,g,D.data):e.isCompressedArrayTexture?c.compressedTexSubImage3D(p,a,A,R,L,x,S,T,y,D.data):c.texSubImage3D(p,a,A,R,L,x,S,T,y,g,D):t.isDataTexture?c.texSubImage2D(c.TEXTURE_2D,a,A,R,x,S,y,g,D.data):t.isCompressedTexture?c.compressedTexSubImage2D(c.TEXTURE_2D,a,A,R,D.width,D.height,y,D.data):c.texSubImage2D(c.TEXTURE_2D,a,A,R,x,S,y,g,D);c.pixelStorei(c.UNPACK_ROW_LENGTH,U),c.pixelStorei(c.UNPACK_IMAGE_HEIGHT,B),c.pixelStorei(c.UNPACK_SKIP_PIXELS,P),c.pixelStorei(c.UNPACK_SKIP_ROWS,J),c.pixelStorei(c.UNPACK_SKIP_IMAGES,q),a===0&&e.generateMipmaps&&c.generateMipmap(p),d.unbindTexture()}copyFramebufferToTexture(t,e,n){const{gl:s}=this,{state:i}=this.backend,{textureGPU:a}=this.backend.get(t),{x:c,y:u,z:d,w:f}=n,p=t.isDepthTexture===!0||e.renderTarget&&e.renderTarget.samples>0,g=e.renderTarget?e.renderTarget.height:this.backend.getDrawingBufferSize().y;if(p){const y=c!==0||u!==0;let x,S;if(t.isDepthTexture===!0?(x=s.DEPTH_BUFFER_BIT,S=s.DEPTH_ATTACHMENT,e.stencil&&(x|=s.STENCIL_BUFFER_BIT)):(x=s.COLOR_BUFFER_BIT,S=s.COLOR_ATTACHMENT0),y){const T=this.backend.get(e.renderTarget),M=T.framebuffers[e.getCacheKey()],N=T.msaaFrameBuffer;i.bindFramebuffer(s.DRAW_FRAMEBUFFER,M),i.bindFramebuffer(s.READ_FRAMEBUFFER,N);const v=g-u-f;s.blitFramebuffer(c,v,c+d,v+f,c,v,c+d,v+f,x,s.NEAREST),i.bindFramebuffer(s.READ_FRAMEBUFFER,M),i.bindTexture(s.TEXTURE_2D,a),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,c,v,d,f),i.unbindTexture()}else{const T=s.createFramebuffer();i.bindFramebuffer(s.DRAW_FRAMEBUFFER,T),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,S,s.TEXTURE_2D,a,0),s.blitFramebuffer(0,0,d,f,0,0,d,f,x,s.NEAREST),s.deleteFramebuffer(T)}}else i.bindTexture(s.TEXTURE_2D,a),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,c,g-f-u,d,f),i.unbindTexture();t.generateMipmaps&&this.generateMipmaps(t),this.backend._setFramebuffer(e)}setupRenderBufferStorage(t,e,n,s=!1){const{gl:i}=this,a=e.renderTarget,{depthTexture:c,depthBuffer:u,stencilBuffer:d,width:f,height:p}=a;if(i.bindRenderbuffer(i.RENDERBUFFER,t),u&&!d){let g=i.DEPTH_COMPONENT24;s===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(i.RENDERBUFFER,a.samples,g,f,p):n>0?(c&&c.isDepthTexture&&c.type===i.FLOAT&&(g=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,n,g,f,p)):i.renderbufferStorage(i.RENDERBUFFER,g,f,p),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,t)}else u&&d&&(n>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,n,i.DEPTH24_STENCIL8,f,p):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,f,p),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,t));i.bindRenderbuffer(i.RENDERBUFFER,null)}async copyTextureToBuffer(t,e,n,s,i,a){const{backend:c,gl:u}=this,{textureGPU:d,glFormat:f,glType:p}=this.backend.get(t),g=u.createFramebuffer();c.state.bindFramebuffer(u.READ_FRAMEBUFFER,g);const y=t.isCubeTexture?u.TEXTURE_CUBE_MAP_POSITIVE_X+a:u.TEXTURE_2D;u.framebufferTexture2D(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,y,d,0);const x=this._getTypedArrayType(p),S=this._getBytesPerTexel(p,f),M=s*i*S,N=u.createBuffer();u.bindBuffer(u.PIXEL_PACK_BUFFER,N),u.bufferData(u.PIXEL_PACK_BUFFER,M,u.STREAM_READ),u.readPixels(e,n,s,i,f,p,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),await c.utils._clientWaitAsync();const v=new x(M/x.BYTES_PER_ELEMENT);return u.bindBuffer(u.PIXEL_PACK_BUFFER,N),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,v),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c.state.bindFramebuffer(u.READ_FRAMEBUFFER,null),u.deleteFramebuffer(g),v}_getTypedArrayType(t){const{gl:e}=this;if(t===e.UNSIGNED_BYTE)return Uint8Array;if(t===e.UNSIGNED_SHORT_4_4_4_4||t===e.UNSIGNED_SHORT_5_5_5_1||t===e.UNSIGNED_SHORT_5_6_5||t===e.UNSIGNED_SHORT)return Uint16Array;if(t===e.UNSIGNED_INT)return Uint32Array;if(t===e.HALF_FLOAT)return Uint16Array;if(t===e.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${t}`)}_getBytesPerTexel(t,e){const{gl:n}=this;let s=0;if(t===n.UNSIGNED_BYTE&&(s=1),(t===n.UNSIGNED_SHORT_4_4_4_4||t===n.UNSIGNED_SHORT_5_5_5_1||t===n.UNSIGNED_SHORT_5_6_5||t===n.UNSIGNED_SHORT||t===n.HALF_FLOAT)&&(s=2),(t===n.UNSIGNED_INT||t===n.FLOAT)&&(s=4),e===n.RGBA)return s*4;if(e===n.RGB)return s*3;if(e===n.ALPHA)return s}dispose(){const{gl:t}=this;this._srcFramebuffer!==null&&t.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&t.deleteFramebuffer(this._dstFramebuffer)}}function pg(r){return r.isDataTexture?r.image.data:typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas?r:r.data}class jW{constructor(t){this.backend=t,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(t){let e=this.extensions[t];return e===void 0&&(e=this.gl.getExtension(t),this.extensions[t]=e),e}has(t){return this.availableExtensions.includes(t)}}class YW{constructor(t){this.backend=t,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const t=this.backend.gl,e=this.backend.extensions;if(e.has("EXT_texture_filter_anisotropic")===!0){const n=e.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const cE={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class KW{constructor(t){this.gl=t.gl,this.extensions=t.extensions,this.info=t.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(t,e){const{gl:n,mode:s,object:i,type:a,info:c,index:u}=this;u!==0?n.drawElements(s,e,a,t):n.drawArrays(s,t,e),c.update(i,e,1)}renderInstances(t,e,n){const{gl:s,mode:i,type:a,index:c,object:u,info:d}=this;n!==0&&(c!==0?s.drawElementsInstanced(i,e,a,t,n):s.drawArraysInstanced(i,t,e,n),d.update(u,e,n))}renderMultiDraw(t,e,n){const{extensions:s,mode:i,object:a,info:c}=this;if(n===0)return;const u=s.get("WEBGL_multi_draw");if(u===null)for(let d=0;d<n;d++)this.render(t[d],e[d]);else{this.index!==0?u.multiDrawElementsWEBGL(i,e,0,this.type,t,0,n):u.multiDrawArraysWEBGL(i,t,0,e,0,n);let d=0;for(let f=0;f<n;f++)d+=e[f];c.update(a,d,1)}}renderMultiDrawInstances(t,e,n,s){const{extensions:i,mode:a,object:c,info:u}=this;if(n===0)return;const d=i.get("WEBGL_multi_draw");if(d===null)for(let f=0;f<n;f++)this.renderInstances(t[f],e[f],s[f]);else{this.index!==0?d.multiDrawElementsInstancedWEBGL(a,e,0,this.type,t,0,s,0,n):d.multiDrawArraysInstancedWEBGL(a,t,0,e,0,s,0,n);let f=0;for(let p=0;p<n;p++)f+=e[p]*s[p];u.update(c,f,1)}}}class QB{constructor(t=256){this.trackTimestamp=!0,this.maxQueries=t,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(t){let e=this.timestamps.get(t);return e===void 0&&(Wt(`TimestampQueryPool: No timestamp available for uid ${t}.`),e=0),e}hasTimestamp(t){return this.timestamps.has(t)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class ZW extends QB{constructor(t,e,n=2048){if(super(n),this.gl=t,this.type=e,this.ext=t.getExtension("EXT_disjoint_timer_query_webgl2")||t.getExtension("EXT_disjoint_timer_query"),!this.ext){Wt("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let s=0;s<this.maxQueries;s++)this.queries.push(t.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(t){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return an(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const e=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(e,"inactive"),this.queryOffsets.set(t,e),e}beginQuery(t){if(!this.trackTimestamp||this.isDisposed)return;const e=this.queryOffsets.get(t);if(e==null||this.activeQuery!==null)return;const n=this.queries[e];if(n)try{this.queryStates.get(e)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=e,this.queryStates.set(e,"started"))}catch(s){Ht("Error in beginQuery:",s),this.activeQuery=null,this.queryStates.set(e,"inactive")}}endQuery(t){if(!this.trackTimestamp||this.isDisposed)return;const e=this.queryOffsets.get(t);if(e!=null&&this.activeQuery===e)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(e,"ended"),this.activeQuery=null}catch(n){Ht("Error in endQuery:",n),this.queryStates.set(e,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const t=new Map;for(const[i,a]of this.queryOffsets)if(this.queryStates.get(a)==="ended"){const u=this.queries[a];t.set(i,this.resolveQuery(u))}if(t.size===0)return this.lastValue;const e={},n=[];for(const[i,a]of t){const c=i.match(/^(.*):f(\d+)$/),u=parseInt(c[2]);n.includes(u)===!1&&n.push(u),e[u]===void 0&&(e[u]=0);const d=await a;this.timestamps.set(i,d),e[u]+=d}const s=e[n[n.length-1]];return this.lastValue=s,this.frames=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,s}catch(t){return Ht("Error resolving queries:",t),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(t){return new Promise(e=>{if(this.isDisposed){e(this.lastValue);return}let n,s=!1;const i=()=>{n&&(clearTimeout(n),n=null)},a=u=>{s||(s=!0,i(),e(u))},c=()=>{if(this.isDisposed){a(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){a(this.lastValue);return}if(!this.gl.getQueryParameter(t,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(c,1);return}const f=this.gl.getQueryParameter(t,this.gl.QUERY_RESULT);e(Number(f)/1e6)}catch(u){Ht("Error checking query:",u),e(this.lastValue)}};c()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const t of this.queries)this.gl.deleteQuery(t);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class uE extends ZB{constructor(t={}){super(t),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(t){super.init(t);const e=this.parameters,n={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil},s=e.context!==void 0?e.context:t.domElement.getContext("webgl2",n);function i(a){a.preventDefault();const c={api:"WebGL",message:a.statusMessage||"Unknown reason",reason:null,originalEvent:a};t.onDeviceLost(c)}this._onContextLost=i,t.domElement.addEventListener("webglcontextlost",i,!1),this.gl=s,this.extensions=new jW(this),this.capabilities=new YW(this),this.attributeUtils=new WW(this),this.textureUtils=new XW(this),this.bufferRenderer=new KW(this),this.state=new qW(this),this.utils=new $W(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.extensions.get("EXT_clip_control"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this.drawBuffersIndexedExt=this.extensions.get("OES_draw_buffers_indexed"),e.reversedDepthBuffer===!0&&this.extensions.has("EXT_clip_control")&&this.state.setReversedDepth(!0)}get coordinateSystem(){return _r}async getArrayBufferAsync(t){return await this.attributeUtils.getArrayBufferAsync(t)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(t){this._xrFramebuffer=t}setXRRenderTargetTextures(t,e,n=null){const s=this.gl;if(this.set(t.texture,{textureGPU:e,glInternalFormat:s.RGBA8}),n!==null){const i=t.stencilBuffer?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24;this.set(t.depthTexture,{textureGPU:n,glInternalFormat:i}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&t._autoAllocateDepthBuffer===!0&&t.multiview===!1&&Wt("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),t._autoAllocateDepthBuffer=!1}}initTimestampQuery(t,e){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new ZW(this.gl,t,2048));const n=this.timestampQueryPool[t];n.allocateQueriesForContext(e)!==null&&n.beginQuery(e)}prepareTimestampBuffer(t,e){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(t){const{state:e}=this,n=this.get(t);if(t.viewport)this.updateViewport(t);else{const{width:i,height:a}=this.getDrawingBufferSize();e.viewport(0,0,i,a)}if(t.scissor)this.updateScissor(t);else{const{width:i,height:a}=this.getDrawingBufferSize();e.scissor(0,0,i,a)}this.initTimestampQuery(Jo.RENDER,this.getTimestampUID(t)),n.previousContext=this._currentContext,this._currentContext=t,this._setFramebuffer(t),this.clear(t.clearColor,t.clearDepth,t.clearStencil,t,!1);const s=t.occlusionQueryCount;s>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(s),n.occlusionQueryObjects=new Array(s),n.occlusionQueryIndex=0)}finishRender(t){const{gl:e,state:n}=this,s=this.get(t),i=s.previousContext;n.resetVertexState();const a=t.occlusionQueryCount;a>0&&(a>s.occlusionQueryIndex&&e.endQuery(e.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(t));const c=t.textures;if(c!==null)for(let u=0;u<c.length;u++){const d=c[u];d.generateMipmaps&&this.generateMipmaps(d)}if(this._currentContext=i,this._resolveRenderTarget(t),i!==null){if(this._setFramebuffer(i),i.viewport)this.updateViewport(i);else{const{width:u,height:d}=this.getDrawingBufferSize();n.viewport(0,0,u,d)}if(i.scissor)this.updateScissor(i);else{const{width:u,height:d}=this.getDrawingBufferSize();n.scissor(0,0,u,d)}}this.prepareTimestampBuffer(Jo.RENDER,this.getTimestampUID(t))}resolveOccludedAsync(t){const e=this.get(t),{currentOcclusionQueries:n,currentOcclusionQueryObjects:s}=e;if(n&&s){const i=new WeakSet,{gl:a}=this;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueries=null;const c=()=>{let u=0;for(let d=0;d<n.length;d++){const f=n[d];f!==null&&a.getQueryParameter(f,a.QUERY_RESULT_AVAILABLE)&&(a.getQueryParameter(f,a.QUERY_RESULT)===0&&i.add(s[d]),n[d]=null,a.deleteQuery(f),u++)}u<n.length?requestAnimationFrame(c):e.occluded=i};c()}}isOccluded(t,e){const n=this.get(t);return n.occluded&&n.occluded.has(e)}updateViewport(t){const{state:e}=this,{x:n,y:s,width:i,height:a}=t.viewportValue;e.viewport(n,t.height-a-s,i,a)}updateScissor(t){const{state:e}=this,{x:n,y:s,width:i,height:a}=t.scissorValue;e.scissor(n,t.height-a-s,i,a)}setScissorTest(t){this.state.setScissorTest(t)}getClearColor(){const t=super.getClearColor();return t.r*=t.a,t.g*=t.a,t.b*=t.a,t}clear(t,e,n,s=null,i=!0,a=!0){const{gl:c,renderer:u}=this;s===null&&(s={textures:null,clearColorValue:this.getClearColor()});let d=0;if(t&&(d|=c.COLOR_BUFFER_BIT),e&&(d|=c.DEPTH_BUFFER_BIT),n&&(d|=c.STENCIL_BUFFER_BIT),d!==0){let f;s.clearColorValue?f=s.clearColorValue:f=this.getClearColor();const p=u.getClearDepth(),g=u.getClearStencil();if(e&&this.state.setDepthMask(!0),s.textures===null)c.clearColor(f.r,f.g,f.b,f.a),c.clear(d);else{if(i&&this._setFramebuffer(s),t)for(let y=0;y<s.textures.length;y++)y===0?c.clearBufferfv(c.COLOR,y,[f.r,f.g,f.b,f.a]):c.clearBufferfv(c.COLOR,y,[0,0,0,1]);e&&n?c.clearBufferfi(c.DEPTH_STENCIL,0,p,g):e?c.clearBufferfv(c.DEPTH,0,[p]):n&&c.clearBufferiv(c.STENCIL,0,[g]),i&&a&&this._resolveRenderTarget(s)}}}beginCompute(t){const{state:e,gl:n}=this;e.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(Jo.COMPUTE,this.getTimestampUID(t))}compute(t,e,n,s,i=null){const{state:a,gl:c}=this;this.discard===!1&&(a.enable(c.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:u,transformBuffers:d,attributes:f}=this.get(s),p=this._getVaoKey(f),g=this.vaoCache[p];g===void 0?this.vaoCache[p]=this._createVao(f):a.setVertexState(g),a.useProgram(u),this._bindUniforms(n);const y=this._getTransformFeedback(d);c.bindTransformFeedback(c.TRANSFORM_FEEDBACK,y),c.beginTransformFeedback(c.POINTS),i=i!==null?i:e.count,Array.isArray(i)?(an("WebGLBackend.compute(): The count parameter must be a single number, not an array."),i=i[0]):i&&typeof i=="object"&&i.isIndirectStorageBufferAttribute&&(an("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),i=e.count),f[0].isStorageInstancedBufferAttribute?c.drawArraysInstanced(c.POINTS,0,1,i):c.drawArrays(c.POINTS,0,i),c.endTransformFeedback(),c.bindTransformFeedback(c.TRANSFORM_FEEDBACK,null);for(let x=0;x<d.length;x++){const S=d[x];S.pbo&&this.has(S.pbo)&&this.textureUtils.copyBufferToTexture(S.transformBuffer,S.pbo),S.switchBuffers()}}finishCompute(t){const{state:e,gl:n}=this;this.discard=!1,e.disable(n.RASTERIZER_DISCARD),this.prepareTimestampBuffer(Jo.COMPUTE,this.getTimestampUID(t)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(t){return t.depthTexture&&t.depthTexture.isArrayTexture&&t.camera.isArrayCamera}draw(t){const{object:e,pipeline:n,material:s,context:i,hardwareClippingPlanes:a}=t,{programGPU:c}=this.get(n),{gl:u,state:d}=this,f=this.get(i),p=t.getDrawParameters();if(p===null)return;this._bindUniforms(t.getBindings());const g=e.isMesh&&e.matrixWorld.determinant()<0;d.setMaterial(s,g,a),i.mrt!==null&&i.textures!==null&&d.setMRTBlending(i.textures,i.mrt,s),d.useProgram(c);const y=t.getAttributes(),x=this.get(y);let S=x.vaoGPU;if(S===void 0){const U=this._getVaoKey(y);S=this.vaoCache[U],S===void 0&&(S=this._createVao(y),this.vaoCache[U]=S,x.vaoGPU=S)}const T=t.getIndex(),M=T!==null?this.get(T).bufferGPU:null;d.setVertexState(S,M);const N=f.lastOcclusionObject;if(N!==e&&N!==void 0){if(N!==null&&N.occlusionTest===!0&&(u.endQuery(u.ANY_SAMPLES_PASSED),f.occlusionQueryIndex++),e.occlusionTest===!0){const U=u.createQuery();u.beginQuery(u.ANY_SAMPLES_PASSED,U),f.occlusionQueries[f.occlusionQueryIndex]=U,f.occlusionQueryObjects[f.occlusionQueryIndex]=e}f.lastOcclusionObject=e}const v=this.bufferRenderer;e.isPoints?v.mode=u.POINTS:e.isLineSegments?v.mode=u.LINES:e.isLine?v.mode=u.LINE_STRIP:e.isLineLoop?v.mode=u.LINE_LOOP:s.wireframe===!0?(d.setLineWidth(s.wireframeLinewidth*this.renderer.getPixelRatio()),v.mode=u.LINES):v.mode=u.TRIANGLES;const{vertexCount:A,instanceCount:R}=p;let{firstVertex:L}=p;if(v.object=e,T!==null){L*=T.array.BYTES_PER_ELEMENT;const U=this.get(T);v.index=T.count,v.type=U.type}else v.index=0;const D=()=>{e.isBatchedMesh?e._multiDrawInstances!==null?(an("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(e._multiDrawStarts,e._multiDrawCounts,e._multiDrawCount,e._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?v.renderMultiDraw(e._multiDrawStarts,e._multiDrawCounts,e._multiDrawCount):an("WebGLBackend: WEBGL_multi_draw not supported."):R>1?v.renderInstances(L,A,R):v.render(L,A)};if(t.camera.isArrayCamera===!0&&t.camera.cameras.length>0&&t.camera.isMultiViewCamera===!1){const U=this.get(t.camera),B=t.camera.cameras,P=t.getBindingGroup("cameraIndex").bindings[0];if(U.indexesGPU===void 0||U.indexesGPU.length!==B.length){const F=new Uint32Array([0,0,0,0]),Y=[];for(let tt=0,lt=B.length;tt<lt;tt++){const Tt=u.createBuffer();F[0]=tt,u.bindBuffer(u.UNIFORM_BUFFER,Tt),u.bufferData(u.UNIFORM_BUFFER,F,u.STATIC_DRAW),Y.push(Tt)}U.indexesGPU=Y}const J=this.get(P),q=this.renderer.getPixelRatio(),ft=this._currentContext.renderTarget,Mt=this._isRenderCameraDepthArray(this._currentContext),mt=this._currentContext.activeCubeFace;if(Mt){const F=this.get(ft.depthTexture);if(F.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){F.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:Y}=ft;for(let tt=0,lt=B.length;tt<lt;tt++)this.renderer._activeCubeFace=tt,this._currentContext.activeCubeFace=tt,this._setFramebuffer(this._currentContext),this.clear(!1,!0,Y,this._currentContext,!1,!1);this.renderer._activeCubeFace=mt,this._currentContext.activeCubeFace=mt}}for(let F=0,Y=B.length;F<Y;F++){const tt=B[F];if(e.layers.test(tt.layers)){Mt&&(this.renderer._activeCubeFace=F,this._currentContext.activeCubeFace=F,this._setFramebuffer(this._currentContext));const lt=tt.viewport;if(lt!==void 0){const Tt=lt.x*q,O=lt.y*q,et=lt.width*q,z=lt.height*q;d.viewport(Math.floor(Tt),Math.floor(t.context.height-z-O),Math.floor(et),Math.floor(z))}d.bindBufferBase(u.UNIFORM_BUFFER,J.index,U.indexesGPU[F]),D()}this._currentContext.activeCubeFace=mt,this.renderer._activeCubeFace=mt}}else D()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(t){this.textureUtils.createDefaultTexture(t)}createTexture(t,e){this.textureUtils.createTexture(t,e)}updateTexture(t,e){this.textureUtils.updateTexture(t,e)}generateMipmaps(t){this.textureUtils.generateMipmaps(t)}destroyTexture(t,e=!1){this.textureUtils.destroyTexture(t,e)}async copyTextureToBuffer(t,e,n,s,i,a){return this.textureUtils.copyTextureToBuffer(t,e,n,s,i,a)}updateSampler(){return""}createNodeBuilder(t,e){return new GW(t,e)}createProgram(t){const e=this.gl,{stage:n,code:s}=t,i=n==="fragment"?e.createShader(e.FRAGMENT_SHADER):e.createShader(e.VERTEX_SHADER);e.shaderSource(i,s),e.compileShader(i),this.set(t,{shaderGPU:i})}destroyProgram(t){this.delete(t)}createRenderPipeline(t,e){const n=this.gl,s=t.pipeline,{fragmentProgram:i,vertexProgram:a}=s,c=n.createProgram(),u=this.get(i).shaderGPU,d=this.get(a).shaderGPU;if(n.attachShader(c,u),n.attachShader(c,d),n.linkProgram(c),this.set(s,{programGPU:c,fragmentShader:u,vertexShader:d}),e!==null&&this.parallel){const f=new Promise(p=>{const g=this.parallel,y=()=>{n.getProgramParameter(c,g.COMPLETION_STATUS_KHR)?(this._completeCompile(t,s),p()):requestAnimationFrame(y)};y()});e.push(f);return}this._completeCompile(t,s)}_handleSource(t,e){const n=t.split(`
`),s=[],i=Math.max(e-6,0),a=Math.min(e+6,n.length);for(let c=i;c<a;c++){const u=c+1;s.push(`${u===e?">":" "} ${u}: ${n[c]}`)}return s.join(`
`)}_getShaderErrors(t,e,n){const s=t.getShaderParameter(e,t.COMPILE_STATUS),a=(t.getShaderInfoLog(e)||"").trim();if(s&&a==="")return"";const c=/ERROR: 0:(\d+)/.exec(a);if(c){const u=parseInt(c[1]);return n.toUpperCase()+`

`+a+`

`+this._handleSource(t.getShaderSource(e),u)}else return a}_logProgramError(t,e,n){if(this.renderer.debug.checkShaderErrors){const s=this.gl,a=(s.getProgramInfoLog(t)||"").trim();if(s.getProgramParameter(t,s.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(s,t,n,e);else{const c=this._getShaderErrors(s,n,"vertex"),u=this._getShaderErrors(s,e,"fragment");Ht("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(t,s.VALIDATE_STATUS)+`

Program Info Log: `+a+`
`+c+`
`+u)}else a!==""&&Wt("WebGLProgram: Program Info Log:",a)}}_completeCompile(t,e){const{state:n,gl:s}=this,i=this.get(e),{programGPU:a,fragmentShader:c,vertexShader:u}=i;s.getProgramParameter(a,s.LINK_STATUS)===!1&&this._logProgramError(a,c,u),n.useProgram(a);const d=t.getBindings();this._setupBindings(d,a),this.set(e,{programGPU:a})}createComputePipeline(t,e){const{state:n,gl:s}=this,i={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(i);const{computeProgram:a}=t,c=s.createProgram(),u=this.get(i).shaderGPU,d=this.get(a).shaderGPU,f=a.transforms,p=[],g=[];for(let T=0;T<f.length;T++){const M=f[T];p.push(M.varyingName),g.push(M.attributeNode)}s.attachShader(c,u),s.attachShader(c,d),s.transformFeedbackVaryings(c,p,s.SEPARATE_ATTRIBS),s.linkProgram(c),s.getProgramParameter(c,s.LINK_STATUS)===!1&&this._logProgramError(c,u,d),n.useProgram(c),this._setupBindings(e,c);const y=a.attributes,x=[],S=[];for(let T=0;T<y.length;T++){const M=y[T].node.attribute;x.push(M),this.has(M)||this.attributeUtils.createAttribute(M,s.ARRAY_BUFFER)}for(let T=0;T<g.length;T++){const M=g[T].attribute;this.has(M)||this.attributeUtils.createAttribute(M,s.ARRAY_BUFFER);const N=this.get(M);S.push(N)}this.set(t,{programGPU:c,transformBuffers:S,attributes:x})}createBindings(t,e){if(this._knownBindings.has(e)===!1){this._knownBindings.add(e);let n=0,s=0;for(const i of e){this.set(i,{textures:s,uniformBuffers:n});for(const a of i.bindings)a.isUniformBuffer&&n++,a.isSampledTexture&&s++}}this.updateBindings(t,e)}updateBindings(t){const{gl:e}=this,n=this.get(t);let s=n.uniformBuffers,i=n.textures;for(const a of t.bindings){const c=this.get(a);if(a.isUniformsGroup||a.isUniformBuffer){const u=a.buffer;let{bufferGPU:d}=this.get(u);d===void 0?(d=e.createBuffer(),e.bindBuffer(e.UNIFORM_BUFFER,d),e.bufferData(e.UNIFORM_BUFFER,u.byteLength,e.DYNAMIC_DRAW),this.set(u,{bufferGPU:d})):e.bindBuffer(e.UNIFORM_BUFFER,d);const f=a.updateRanges;if(e.bindBuffer(e.UNIFORM_BUFFER,d),f.length===0)e.bufferData(e.UNIFORM_BUFFER,u,e.DYNAMIC_DRAW);else{const p=Ry(u),g=p?1:u.BYTES_PER_ELEMENT;for(let y=0,x=f.length;y<x;y++){const S=f[y],T=S.start*g,M=S.count*g,N=T*(p?u.BYTES_PER_ELEMENT:1);e.bufferSubData(e.UNIFORM_BUFFER,N,u,T,M)}}c.index=s++,c.bufferGPU=d,this.set(a,c)}else if(a.isSampledTexture){const{textureGPU:u,glTextureType:d}=this.get(a.texture);c.index=i++,c.textureGPU=u,c.glTextureType=d,this.set(a,c)}}}updateBinding(t){const e=this.gl;if(t.isUniformsGroup||t.isUniformBuffer){const s=this.get(t).bufferGPU,i=t.buffer,a=t.updateRanges;if(e.bindBuffer(e.UNIFORM_BUFFER,s),a.length===0)e.bufferData(e.UNIFORM_BUFFER,i,e.DYNAMIC_DRAW);else{const c=Ry(i),u=c?1:i.BYTES_PER_ELEMENT;for(let d=0,f=a.length;d<f;d++){const p=a[d],g=p.start*u,y=p.count*u,x=g*(c?i.BYTES_PER_ELEMENT:1);e.bufferSubData(e.UNIFORM_BUFFER,x,i,g,y)}}}}createIndexAttribute(t){const e=this.gl;this.attributeUtils.createAttribute(t,e.ELEMENT_ARRAY_BUFFER)}createAttribute(t){if(this.has(t))return;const e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}createStorageAttribute(t){if(this.has(t))return;const e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}updateAttribute(t){this.attributeUtils.updateAttribute(t)}destroyAttribute(t){this.attributeUtils.destroyAttribute(t)}hasFeature(t){const e=Object.keys(cE).filter(s=>cE[s]===t),n=this.extensions;for(let s=0;s<e.length;s++)if(n.has(e[s]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(t,e,n=null,s=null,i=0,a=0){this.textureUtils.copyTextureToTexture(t,e,n,s,i,a)}copyFramebufferToTexture(t,e,n){this.textureUtils.copyFramebufferToTexture(t,e,n)}hasCompatibility(t){return t===_c.TEXTURE_COMPARE?!0:super.hasCompatibility(t)}initRenderTarget(t){const{gl:e,state:n}=this;this._setFramebuffer(t),n.bindFramebuffer(e.FRAMEBUFFER,null)}_setFramebuffer(t){const{gl:e,state:n}=this;let s=null;if(t.textures!==null){const i=t.renderTarget,a=this.get(i),{samples:c,depthBuffer:u,stencilBuffer:d}=i,f=i.isCubeRenderTarget===!0,p=i.isRenderTarget3D===!0,g=i.depth>1,y=i.isXRRenderTarget===!0,x=y===!0&&i._hasExternalTextures===!0;let S=a.msaaFrameBuffer,T=a.depthRenderbuffer;const M=this.extensions.get("WEBGL_multisampled_render_to_texture"),N=this.extensions.get("OVR_multiview2"),v=this._useMultisampledExtension(i),A=WD(t);let R;if(f?(a.cubeFramebuffers||(a.cubeFramebuffers={}),R=a.cubeFramebuffers[A]):y&&x===!1?R=this._xrFramebuffer:(a.framebuffers||(a.framebuffers={}),R=a.framebuffers[A]),R===void 0){R=e.createFramebuffer(),n.bindFramebuffer(e.FRAMEBUFFER,R);const L=t.textures,D=[];if(f){a.cubeFramebuffers[A]=R;const{textureGPU:B}=this.get(L[0]),P=this.renderer._activeCubeFace,J=this.renderer._activeMipmapLevel;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+P,B,J)}else{a.framebuffers[A]=R;for(let B=0;B<L.length;B++){const P=L[B],J=this.get(P);J.renderTarget=t.renderTarget,J.cacheKey=A;const q=e.COLOR_ATTACHMENT0+B;if(i.multiview)N.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,q,J.textureGPU,0,c,0,2);else if(p||g){const ft=this.renderer._activeCubeFace,Mt=this.renderer._activeMipmapLevel;e.framebufferTextureLayer(e.FRAMEBUFFER,q,J.textureGPU,Mt,ft)}else if(v)M.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,q,e.TEXTURE_2D,J.textureGPU,0,c);else{const ft=this.renderer._activeMipmapLevel;e.framebufferTexture2D(e.FRAMEBUFFER,q,e.TEXTURE_2D,J.textureGPU,ft)}}}const U=d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;if(i._autoAllocateDepthBuffer===!0){const B=e.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(B,t,0,v),a.xrDepthRenderbuffer=B,D.push(d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT),e.bindRenderbuffer(e.RENDERBUFFER,B),e.framebufferRenderbuffer(e.FRAMEBUFFER,U,e.RENDERBUFFER,B)}else if(t.depthTexture!==null){D.push(d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT);const B=this.get(t.depthTexture);if(B.renderTarget=t.renderTarget,B.cacheKey=A,i.multiview)N.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,U,B.textureGPU,0,c,0,2);else if(x&&v)M.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,U,e.TEXTURE_2D,B.textureGPU,0,c);else if(t.depthTexture.isArrayTexture){const P=this.renderer._activeCubeFace;e.framebufferTextureLayer(e.FRAMEBUFFER,U,B.textureGPU,0,P)}else if(t.depthTexture.isCubeTexture){const P=this.renderer._activeCubeFace;e.framebufferTexture2D(e.FRAMEBUFFER,U,e.TEXTURE_CUBE_MAP_POSITIVE_X+P,B.textureGPU,0)}else e.framebufferTexture2D(e.FRAMEBUFFER,U,e.TEXTURE_2D,B.textureGPU,0)}a.depthInvalidationArray=D}else{if(this._isRenderCameraDepthArray(t)){n.bindFramebuffer(e.FRAMEBUFFER,R);const D=this.renderer._activeCubeFace,U=this.get(t.depthTexture),B=d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.framebufferTextureLayer(e.FRAMEBUFFER,B,U.textureGPU,0,D)}if((y||v||i.multiview)&&i._isOpaqueFramebuffer!==!0){n.bindFramebuffer(e.FRAMEBUFFER,R);const D=this.get(t.textures[0]);i.multiview?N.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,D.textureGPU,0,c,0,2):v?M.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,D.textureGPU,0,c):e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,D.textureGPU,0);const U=d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;if(i._autoAllocateDepthBuffer===!0){const B=a.xrDepthRenderbuffer;e.bindRenderbuffer(e.RENDERBUFFER,B),e.framebufferRenderbuffer(e.FRAMEBUFFER,U,e.RENDERBUFFER,B)}else{const B=this.get(t.depthTexture);i.multiview?N.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,U,B.textureGPU,0,c,0,2):v?M.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,U,e.TEXTURE_2D,B.textureGPU,0,c):e.framebufferTexture2D(e.FRAMEBUFFER,U,e.TEXTURE_2D,B.textureGPU,0)}}}if(c>0&&v===!1&&!i.multiview){if(S===void 0){const L=[];S=e.createFramebuffer(),n.bindFramebuffer(e.FRAMEBUFFER,S);const D=[],U=t.textures;for(let B=0;B<U.length;B++){D[B]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,D[B]),L.push(e.COLOR_ATTACHMENT0+B);const P=t.textures[B],J=this.get(P);e.renderbufferStorageMultisample(e.RENDERBUFFER,c,J.glInternalFormat,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+B,e.RENDERBUFFER,D[B])}if(e.bindRenderbuffer(e.RENDERBUFFER,null),a.msaaFrameBuffer=S,a.msaaRenderbuffers=D,u&&T===void 0){T=e.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(T,t,c),a.depthRenderbuffer=T;const B=d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;L.push(B)}a.invalidationArray=L}s=a.msaaFrameBuffer}else s=R;n.drawBuffers(t,R)}n.bindFramebuffer(e.FRAMEBUFFER,s)}_getVaoKey(t){let e="";for(let n=0;n<t.length;n++){const s=this.get(t[n]);e+=":"+s.id}return e}_createVao(t){const{gl:e}=this,n=e.createVertexArray();e.bindVertexArray(n);for(let s=0;s<t.length;s++){const i=t[s],a=this.get(i);e.bindBuffer(e.ARRAY_BUFFER,a.bufferGPU),e.enableVertexAttribArray(s);let c,u;i.isInterleavedBufferAttribute===!0?(c=i.data.stride*a.bytesPerElement,u=i.offset*a.bytesPerElement):(c=0,u=0),a.isInteger?e.vertexAttribIPointer(s,i.itemSize,a.type,c,u):e.vertexAttribPointer(s,i.itemSize,a.type,i.normalized,c,u),i.isInstancedBufferAttribute&&!i.isInterleavedBufferAttribute?e.vertexAttribDivisor(s,i.meshPerAttribute):i.isInterleavedBufferAttribute&&i.data.isInstancedInterleavedBuffer&&e.vertexAttribDivisor(s,i.data.meshPerAttribute)}return e.bindBuffer(e.ARRAY_BUFFER,null),n}_getTransformFeedback(t){let e="";for(let i=0;i<t.length;i++)e+=":"+t[i].id;let n=this.transformFeedbackCache[e];if(n!==void 0)return n;const{gl:s}=this;n=s.createTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,n);for(let i=0;i<t.length;i++){const a=t[i];s.bindBufferBase(s.TRANSFORM_FEEDBACK_BUFFER,i,a.transformBuffer)}return s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[e]=n,n}_setupBindings(t,e){const n=this.gl;for(const s of t)for(const i of s.bindings){const c=this.get(i).index;if(i.isUniformsGroup||i.isUniformBuffer){const u=n.getUniformBlockIndex(e,i.name);n.uniformBlockBinding(e,u,c)}else if(i.isSampledTexture){const u=n.getUniformLocation(e,i.name);n.uniform1i(u,c)}}}_bindUniforms(t){const{gl:e,state:n}=this;for(const s of t)for(const i of s.bindings){const a=this.get(i),c=a.index;i.isUniformsGroup||i.isUniformBuffer?n.bindBufferBase(e.UNIFORM_BUFFER,c,a.bufferGPU):i.isSampledTexture&&n.bindTexture(a.glTextureType,a.textureGPU,e.TEXTURE0+c)}}_resolveRenderTarget(t){const{gl:e,state:n}=this,s=t.renderTarget;if(t.textures!==null&&s){const i=this.get(s);if(s.samples>0&&this._useMultisampledExtension(s)===!1){const a=i.framebuffers[t.getCacheKey()];let c=e.COLOR_BUFFER_BIT;s.resolveDepthBuffer&&(s.depthBuffer&&(c|=e.DEPTH_BUFFER_BIT),s.stencilBuffer&&s.resolveStencilBuffer&&(c|=e.STENCIL_BUFFER_BIT));const u=i.msaaFrameBuffer,d=i.msaaRenderbuffers,f=t.textures,p=f.length>1;if(n.bindFramebuffer(e.READ_FRAMEBUFFER,u),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,a),p)for(let g=0;g<f.length;g++)e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0+g,e.RENDERBUFFER,null),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+g,e.TEXTURE_2D,null,0);for(let g=0;g<f.length;g++){if(p){const{textureGPU:y}=this.get(f[g]);e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,d[g]),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,y,0)}if(t.scissor){const{x:y,y:x,width:S,height:T}=t.scissorValue,M=t.height-T-x;e.blitFramebuffer(y,M,y+S,M+T,y,M,y+S,M+T,c,e.NEAREST)}else e.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,c,e.NEAREST)}if(p)for(let g=0;g<f.length;g++){const{textureGPU:y}=this.get(f[g]);e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0+g,e.RENDERBUFFER,d[g]),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+g,e.TEXTURE_2D,y,0)}this._supportsInvalidateFramebuffer===!0&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,i.invalidationArray)}else if(s.resolveDepthBuffer===!1&&i.framebuffers){const a=i.framebuffers[t.getCacheKey()];n.bindFramebuffer(e.DRAW_FRAMEBUFFER,a),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,i.depthInvalidationArray)}}}_useMultisampledExtension(t){return t.multiview===!0?!0:t.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&t._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const t=this.extensions.get("WEBGL_lose_context");t&&t.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const mg={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list"},ta=typeof self<"u"&&self.GPUShaderStage?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},ei={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},Ei={Store:"store"},rn={Load:"load",Clear:"clear"},hE={CCW:"ccw",CW:"cw"},dE={None:"none",Back:"back"},jy={Uint16:"uint16",Uint32:"uint32"},rt={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},u2={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},jo={Linear:"linear",Nearest:"nearest"},Pe={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},pu={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},fE={None:0,All:15},Kl={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},h2={Storage:"storage",ReadOnlyStorage:"read-only-storage"},d2={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},pE={NonFiltering:"non-filtering",Comparison:"comparison"},mu={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},mE={TwoD:"2d",ThreeD:"3d"},fi={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},QW={All:"all"},gg={Vertex:"vertex",Instance:"instance"},fw={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},gE={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class JW extends YB{constructor(t,e,n){super(t,e?e.value:null),this.textureNode=e,this.groupNode=n}update(){const{textureNode:t}=this;return this.texture!==t.value?(this.texture=t.value,!0):super.update()}}class tq extends qB{constructor(t,e){super(t,e?e.array:null),this._attribute=e,this.isStorageBuffer=!0}get attribute(){return this._attribute}}let eq=0;class nq extends tq{constructor(t,e){super("StorageBuffer_"+eq++,t?t.value:null),this.nodeUniform=t,this.access=t?t.access:ri.READ_WRITE,this.groupNode=e}get attribute(){return this.nodeUniform.value}get buffer(){return this.nodeUniform.value.array}}class sq extends Vc{constructor(t){super(),this.device=t;const e=`
struct VarysStruct {
	@builtin( position ) Position: vec4f,
	@location( 0 ) vTex : vec2f,
	@location( 1 ) @interpolate(flat, either) vBaseArrayLayer: u32,
};

@group( 0 ) @binding ( 2 )
var<uniform> flipY: u32;

@vertex
fn mainVS(
		@builtin( vertex_index ) vertexIndex : u32,
		@builtin( instance_index ) instanceIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array(
		vec2f( -1, -1 ),
		vec2f( -1,  3 ),
		vec2f(  3, -1 ),
	);

	let p = pos[ vertexIndex ];
	let mult = select( vec2f( 0.5, -0.5 ), vec2f( 0.5, 0.5 ), flipY != 0 );
	Varys.vTex = p * mult + vec2f( 0.5 );
	Varys.Position = vec4f( p, 0, 1 );
	Varys.vBaseArrayLayer = instanceIndex;

	return Varys;

}

@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img2d : texture_2d<f32>;

@fragment
fn main_2d( Varys: VarysStruct ) -> @location( 0 ) vec4<f32> {

	return textureSample( img2d, imgSampler, Varys.vTex );

}

@group( 0 ) @binding( 1 )
var img2dArray : texture_2d_array<f32>;

@fragment
fn main_2d_array( Varys: VarysStruct ) -> @location( 0 ) vec4<f32> {

	return textureSample( img2dArray, imgSampler, Varys.vTex, Varys.vBaseArrayLayer );

}

const faceMat = array(
  mat3x3f(  0,  0,  -2,  0, -2,   0,  1,  1,   1 ),   // pos-x
  mat3x3f(  0,  0,   2,  0, -2,   0, -1,  1,  -1 ),   // neg-x
  mat3x3f(  2,  0,   0,  0,  0,   2, -1,  1,  -1 ),   // pos-y
  mat3x3f(  2,  0,   0,  0,  0,  -2, -1, -1,   1 ),   // neg-y
  mat3x3f(  2,  0,   0,  0, -2,   0, -1,  1,   1 ),   // pos-z
  mat3x3f( -2,  0,   0,  0, -2,   0,  1,  1,  -1 ),   // neg-z
);

@group( 0 ) @binding( 1 )
var imgCube : texture_cube<f32>;

@fragment
fn main_cube( Varys: VarysStruct ) -> @location( 0 ) vec4<f32> {

	return textureSample( imgCube, imgSampler, faceMat[ Varys.vBaseArrayLayer ] * vec3f( fract( Varys.vTex ), 1 ) );

}
`;this.mipmapSampler=t.createSampler({minFilter:jo.Linear}),this.flipYSampler=t.createSampler({minFilter:jo.Nearest}),this.flipUniformBuffer=t.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),t.queue.writeBuffer(this.flipUniformBuffer,0,new Uint32Array([1])),this.noFlipUniformBuffer=t.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM}),this.transferPipelines={},this.mipmapShaderModule=t.createShaderModule({label:"mipmap",code:e})}getTransferPipeline(t,e){e=e||"2d-array";const n=`${t}-${e}`;let s=this.transferPipelines[n];return s===void 0&&(s=this.device.createRenderPipeline({label:`mipmap-${t}-${e}`,vertex:{module:this.mipmapShaderModule},fragment:{module:this.mipmapShaderModule,entryPoint:`main_${e.replace("-","_")}`,targets:[{format:t}]},layout:"auto"}),this.transferPipelines[n]=s),s}flipY(t,e,n=0){const s=e.format,{width:i,height:a}=e.size,c=this.device.createTexture({size:{width:i,height:a},format:s,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=this.getTransferPipeline(s,t.textureBindingViewDimension),d=this.getTransferPipeline(s,c.textureBindingViewDimension),f=this.device.createCommandEncoder({}),p=(g,y,x,S,T,M)=>{const N=g.getBindGroupLayout(0),v=this.device.createBindGroup({layout:N,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:y.createView({dimension:y.textureBindingViewDimension||"2d-array",baseMipLevel:0,mipLevelCount:1})},{binding:2,resource:{buffer:M?this.flipUniformBuffer:this.noFlipUniformBuffer}}]}),A=f.beginRenderPass({colorAttachments:[{view:S.createView({dimension:"2d",baseMipLevel:0,mipLevelCount:1,baseArrayLayer:T,arrayLayerCount:1}),loadOp:rn.Clear,storeOp:Ei.Store}]});A.setPipeline(g),A.setBindGroup(0,v),A.draw(3,1,0,x),A.end()};p(u,t,n,c,0,!1),p(d,c,0,t,n,!0),this.device.queue.submit([f.finish()]),c.destroy()}generateMipmaps(t,e=null){const n=this.get(t),s=n.layers||this._mipmapCreateBundles(t),i=e||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(i,s),e===null&&this.device.queue.submit([i.finish()]),n.layers=s}_mipmapCreateBundles(t){const e=t.textureBindingViewDimension||"2d-array",n=this.getTransferPipeline(t.format,e),s=n.getBindGroupLayout(0),i=[];for(let a=1;a<t.mipLevelCount;a++)for(let c=0;c<t.depthOrArrayLayers;c++){const u=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:t.createView({dimension:e,baseMipLevel:a-1,mipLevelCount:1})},{binding:2,resource:{buffer:this.noFlipUniformBuffer}}]}),d={colorAttachments:[{view:t.createView({dimension:"2d",baseMipLevel:a,mipLevelCount:1,baseArrayLayer:c,arrayLayerCount:1}),loadOp:rn.Clear,storeOp:Ei.Store}]},f=this.device.createRenderBundleEncoder({colorFormats:[t.format]});f.setPipeline(n),f.setBindGroup(0,u),f.draw(3,1,0,c),i.push({renderBundles:[f.finish()],passDescriptor:d})}return i}_mipmapRunBundles(t,e){const n=e.length;for(let s=0;s<n;s++){const i=e[s],a=t.beginRenderPass(i.passDescriptor);a.executeBundles(i.renderBundles),a.end()}}}const iq={[X3]:"never",[Ew]:"less",[j3]:"equal",[ix]:"less-equal",[Y3]:"greater",[rx]:"greater-equal",[Z3]:"always",[K3]:"not-equal"},rq=[0,1,3,2,4,5];class oq{constructor(t){this.backend=t,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(t){const e=this.backend,n=t.minFilter+"-"+t.magFilter+"-"+t.wrapS+"-"+t.wrapT+"-"+(t.wrapR||"0")+"-"+t.anisotropy+"-"+(t.compareFunction||0);let s=this._samplerCache.get(n);if(s===void 0){const a={addressModeU:this._convertAddressMode(t.wrapS),addressModeV:this._convertAddressMode(t.wrapT),addressModeW:this._convertAddressMode(t.wrapR),magFilter:this._convertFilterMode(t.magFilter),minFilter:this._convertFilterMode(t.minFilter),mipmapFilter:this._convertFilterMode(t.minFilter),maxAnisotropy:1};t.isDepthTexture&&t.compareFunction===null&&(a.magFilter=jo.Nearest,a.minFilter=jo.Nearest,a.mipmapFilter=jo.Nearest),a.magFilter===jo.Linear&&a.minFilter===jo.Linear&&a.mipmapFilter===jo.Linear&&(a.maxAnisotropy=t.anisotropy),t.isDepthTexture&&t.compareFunction!==null&&e.hasCompatibility(_c.TEXTURE_COMPARE)&&(a.compare=iq[t.compareFunction]),s={sampler:e.device.createSampler(a),usedTimes:0},this._samplerCache.set(n,s)}const i=e.get(t);if(i.sampler!==s.sampler){if(i.sampler!==void 0){const a=this._samplerCache.get(i.samplerKey);a.usedTimes--,a.usedTimes===0&&this._samplerCache.delete(i.samplerKey)}i.samplerKey=n,i.sampler=s.sampler,s.usedTimes++}return n}createDefaultTexture(t){let e;const n=pw(t);t.isCubeTexture?e=this._getDefaultCubeTextureGPU(n):e=this._getDefaultTextureGPU(n),this.backend.get(t).texture=e}createTexture(t,e={}){const n=this.backend,s=n.get(t);if(s.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(t.isExternalTexture){s.texture=t.sourceTexture,s.initialized=!0;return}e.needsMipmaps===void 0&&(e.needsMipmaps=!1),e.levels===void 0&&(e.levels=1),e.depth===void 0&&(e.depth=1);const{width:i,height:a,depth:c,levels:u}=e;t.isFramebufferTexture&&(e.renderTarget?e.format=this.backend.utils.getCurrentColorFormat(e.renderTarget):e.format=this.backend.utils.getPreferredCanvasFormat());const d=this._getDimension(t),f=t.internalFormat||e.format||pw(t,n.device);s.format=f;const{samples:p,primarySamples:g,isMSAA:y}=n.utils.getTextureSampleData(t);let x=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;t.isStorageTexture===!0&&(x|=GPUTextureUsage.STORAGE_BINDING),t.isCompressedTexture!==!0&&t.isCompressedArrayTexture!==!0&&f!==rt.RGB9E5UFloat&&(x|=GPUTextureUsage.RENDER_ATTACHMENT);const S={label:t.name,size:{width:i,height:a,depthOrArrayLayers:c},mipLevelCount:u,sampleCount:g,dimension:d,format:f,usage:x};if(f===void 0){Wt("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(t);return}t.isCubeTexture&&(S.textureBindingViewDimension=fi.Cube);try{s.texture=n.device.createTexture(S)}catch{Wt("WebGPURenderer: Failed to create texture with descriptor:",S),this.createDefaultTexture(t);return}if(y){const T=Object.assign({},S);T.label=T.label+"-msaa",T.sampleCount=p,T.mipLevelCount=1,s.msaaTexture=n.device.createTexture(T)}s.initialized=!0,s.textureDescriptorGPU=S}destroyTexture(t,e=!1){const n=this.backend,s=n.get(t);s.texture!==void 0&&e===!1&&s.texture.destroy(),s.msaaTexture!==void 0&&s.msaaTexture.destroy(),n.delete(t)}generateMipmaps(t,e=null){const n=this.backend.get(t);this._generateMipmaps(n.texture,e)}getColorBuffer(){const t=this.backend,e=t.renderer.getCanvasTarget(),{width:n,height:s}=t.getDrawingBufferSize(),i=t.renderer.currentSamples,a=e.colorTexture,c=t.get(a);if(a.width===n&&a.height===s&&a.samples===i)return c.texture;let u=c.texture;return u&&u.destroy(),u=t.device.createTexture({label:"colorBuffer",size:{width:n,height:s,depthOrArrayLayers:1},sampleCount:t.utils.getSampleCount(t.renderer.currentSamples),format:t.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),a.source.width=n,a.source.height=s,a.samples=i,c.texture=u,u}getDepthBuffer(t=!0,e=!1){const n=this.backend,s=n.renderer.getCanvasTarget(),{width:i,height:a}=n.getDrawingBufferSize(),c=n.renderer.currentSamples,u=s.depthTexture;if(u.width===i&&u.height===a&&u.samples===c&&u.depth===t&&u.stencil===e)return n.get(u).texture;const d=n.get(u).texture;let f,p;if(e?(f=ol,p=Tc):t&&(f=Mo,p=Jn),d!==void 0){if(u.image.width===i&&u.image.height===a&&u.format===f&&u.type===p&&u.samples===c)return d;this.destroyTexture(u)}return u.name="depthBuffer",u.format=f,u.type=p,u.image.width=i,u.image.height=a,u.samples=c,this.createTexture(u,{width:i,height:a}),n.get(u).texture}updateTexture(t,e){const n=this.backend.get(t),s=t.mipmaps,{textureDescriptorGPU:i}=n;if(!(t.isRenderTargetTexture||i===void 0)){if(t.isDataTexture)if(s.length>0)for(let a=0,c=s.length;a<c;a++){const u=s[a];this._copyBufferToTexture(u,n.texture,i,0,t.flipY,0,a)}else this._copyBufferToTexture(e.image,n.texture,i,0,t.flipY);else if(t.isArrayTexture||t.isDataArrayTexture||t.isData3DTexture)for(let a=0;a<e.image.depth;a++)this._copyBufferToTexture(e.image,n.texture,i,a,t.flipY,a);else if(t.isCompressedTexture||t.isCompressedArrayTexture)this._copyCompressedBufferToTexture(t.mipmaps,n.texture,i);else if(t.isCubeTexture)this._copyCubeMapToTexture(t,n.texture,i);else if(s.length>0)for(let a=0,c=s.length;a<c;a++){const u=s[a];this._copyImageToTexture(u,n.texture,i,0,t.flipY,t.premultiplyAlpha,a)}else this._copyImageToTexture(e.image,n.texture,i,0,t.flipY,t.premultiplyAlpha);n.version=t.version}}async copyTextureToBuffer(t,e,n,s,i,a){const c=this.backend.device,u=this.backend.get(t),d=u.texture,f=u.textureDescriptorGPU.format,p=this._getBytesPerTexel(f);let g=s*p;g=Math.ceil(g/256)*256;const y=c.createBuffer({size:(i-1)*g+s*p,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),x=c.createCommandEncoder();x.copyTextureToBuffer({texture:d,origin:{x:e,y:n,z:a}},{buffer:y,bytesPerRow:g},{width:s,height:i});const S=this._getTypedArrayType(f);c.queue.submit([x.finish()]),await y.mapAsync(GPUMapMode.READ);const T=y.getMappedRange();return new S(T)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(t){let e=this.defaultTexture[t];if(e===void 0){const n=new is;n.minFilter=ts,n.magFilter=ts,this.createTexture(n,{width:1,height:1,format:t}),this.defaultTexture[t]=e=n}return this.backend.get(e).texture}_getDefaultCubeTextureGPU(t){let e=this.defaultCubeTexture[t];if(e===void 0){const n=new lx;n.minFilter=ts,n.magFilter=ts,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[t]=e=n}return this.backend.get(e).texture}_copyCubeMapToTexture(t,e,n){const s=t.images,i=t.mipmaps;for(let a=0;a<6;a++){const c=s[a],u=t.flipY===!0?rq[a]:a;c.isDataTexture?this._copyBufferToTexture(c.image,e,n,u,t.flipY):this._copyImageToTexture(c,e,n,u,t.flipY,t.premultiplyAlpha);for(let d=0;d<i.length;d++){const p=i[d].images[a];p.isDataTexture?this._copyBufferToTexture(p.image,e,n,u,t.flipY,0,d+1):this._copyImageToTexture(p,e,n,u,t.flipY,t.premultiplyAlpha,d+1)}}}_copyImageToTexture(t,e,n,s,i,a,c=0){const u=this.backend.device,d=c>0?t.width:n.size.width,f=c>0?t.height:n.size.height;try{u.queue.copyExternalImageToTexture({source:t,flipY:i},{texture:e,mipLevel:c,origin:{x:0,y:0,z:s},premultipliedAlpha:a},{width:d,height:f,depthOrArrayLayers:1})}catch{}}_getPassUtils(){let t=this._passUtils;return t===null&&(this._passUtils=t=new sq(this.backend.device)),t}_generateMipmaps(t,e=null){this._getPassUtils().generateMipmaps(t,e)}_flipY(t,e,n=0){this._getPassUtils().flipY(t,e,n)}_copyBufferToTexture(t,e,n,s,i,a=0,c=0){const u=this.backend.device,d=t.data,f=this._getBytesPerTexel(n.format),p=t.width*f;u.queue.writeTexture({texture:e,mipLevel:c,origin:{x:0,y:0,z:s}},d,{offset:t.width*t.height*f*a,bytesPerRow:p},{width:t.width,height:t.height,depthOrArrayLayers:1}),i===!0&&this._flipY(e,n,s)}_copyCompressedBufferToTexture(t,e,n){const s=this.backend.device,i=this._getBlockData(n.format),a=n.size.depthOrArrayLayers>1;for(let c=0;c<t.length;c++){const u=t[c],d=u.width,f=u.height,p=a?n.size.depthOrArrayLayers:1,g=Math.ceil(d/i.width)*i.byteLength,y=g*Math.ceil(f/i.height);for(let x=0;x<p;x++)s.queue.writeTexture({texture:e,mipLevel:c,origin:{x:0,y:0,z:x}},u.data,{offset:x*y,bytesPerRow:g,rowsPerImage:Math.ceil(f/i.height)},{width:Math.ceil(d/i.width)*i.width,height:Math.ceil(f/i.height)*i.height,depthOrArrayLayers:1})}}_getBlockData(t){if(t===rt.BC1RGBAUnorm||t===rt.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(t===rt.BC2RGBAUnorm||t===rt.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(t===rt.BC3RGBAUnorm||t===rt.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(t===rt.BC4RUnorm||t===rt.BC4RSnorm)return{byteLength:8,width:4,height:4};if(t===rt.BC5RGUnorm||t===rt.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(t===rt.BC6HRGBUFloat||t===rt.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(t===rt.BC7RGBAUnorm||t===rt.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(t===rt.ETC2RGB8Unorm||t===rt.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(t===rt.ETC2RGB8A1Unorm||t===rt.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(t===rt.ETC2RGBA8Unorm||t===rt.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(t===rt.EACR11Unorm)return{byteLength:8,width:4,height:4};if(t===rt.EACR11Snorm)return{byteLength:8,width:4,height:4};if(t===rt.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(t===rt.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(t===rt.ASTC4x4Unorm||t===rt.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(t===rt.ASTC5x4Unorm||t===rt.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(t===rt.ASTC5x5Unorm||t===rt.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(t===rt.ASTC6x5Unorm||t===rt.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(t===rt.ASTC6x6Unorm||t===rt.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(t===rt.ASTC8x5Unorm||t===rt.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(t===rt.ASTC8x6Unorm||t===rt.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(t===rt.ASTC8x8Unorm||t===rt.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(t===rt.ASTC10x5Unorm||t===rt.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(t===rt.ASTC10x6Unorm||t===rt.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(t===rt.ASTC10x8Unorm||t===rt.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(t===rt.ASTC10x10Unorm||t===rt.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(t===rt.ASTC12x10Unorm||t===rt.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(t===rt.ASTC12x12Unorm||t===rt.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(t){let e=u2.ClampToEdge;return t===Fn?e=u2.Repeat:t===wd&&(e=u2.MirrorRepeat),e}_convertFilterMode(t){let e=jo.Linear;return(t===ts||t===k3||t===Cp)&&(e=jo.Nearest),e}_getBytesPerTexel(t){if(t===rt.R8Unorm||t===rt.R8Snorm||t===rt.R8Uint||t===rt.R8Sint)return 1;if(t===rt.R16Uint||t===rt.R16Sint||t===rt.R16Float||t===rt.RG8Unorm||t===rt.RG8Snorm||t===rt.RG8Uint||t===rt.RG8Sint)return 2;if(t===rt.R32Uint||t===rt.R32Sint||t===rt.R32Float||t===rt.RG16Uint||t===rt.RG16Sint||t===rt.RG16Float||t===rt.RGBA8Unorm||t===rt.RGBA8UnormSRGB||t===rt.RGBA8Snorm||t===rt.RGBA8Uint||t===rt.RGBA8Sint||t===rt.BGRA8Unorm||t===rt.BGRA8UnormSRGB||t===rt.RGB9E5UFloat||t===rt.RGB10A2Unorm||t===rt.RG11B10UFloat||t===rt.Depth32Float||t===rt.Depth24Plus||t===rt.Depth24PlusStencil8||t===rt.Depth32FloatStencil8)return 4;if(t===rt.RG32Uint||t===rt.RG32Sint||t===rt.RG32Float||t===rt.RGBA16Uint||t===rt.RGBA16Sint||t===rt.RGBA16Float)return 8;if(t===rt.RGBA32Uint||t===rt.RGBA32Sint||t===rt.RGBA32Float)return 16}_getTypedArrayType(t){if(t===rt.R8Uint)return Uint8Array;if(t===rt.R8Sint)return Int8Array;if(t===rt.R8Unorm)return Uint8Array;if(t===rt.R8Snorm)return Int8Array;if(t===rt.RG8Uint)return Uint8Array;if(t===rt.RG8Sint)return Int8Array;if(t===rt.RG8Unorm)return Uint8Array;if(t===rt.RG8Snorm)return Int8Array;if(t===rt.RGBA8Uint)return Uint8Array;if(t===rt.RGBA8Sint)return Int8Array;if(t===rt.RGBA8Unorm||t===rt.RGBA8UnormSRGB)return Uint8Array;if(t===rt.RGBA8Snorm)return Int8Array;if(t===rt.R16Uint)return Uint16Array;if(t===rt.R16Sint)return Int16Array;if(t===rt.RG16Uint)return Uint16Array;if(t===rt.RG16Sint)return Int16Array;if(t===rt.RGBA16Uint)return Uint16Array;if(t===rt.RGBA16Sint)return Int16Array;if(t===rt.R16Float||t===rt.RG16Float||t===rt.RGBA16Float)return Uint16Array;if(t===rt.R32Uint)return Uint32Array;if(t===rt.R32Sint)return Int32Array;if(t===rt.R32Float)return Float32Array;if(t===rt.RG32Uint)return Uint32Array;if(t===rt.RG32Sint)return Int32Array;if(t===rt.RG32Float)return Float32Array;if(t===rt.RGBA32Uint)return Uint32Array;if(t===rt.RGBA32Sint)return Int32Array;if(t===rt.RGBA32Float)return Float32Array;if(t===rt.BGRA8Unorm||t===rt.BGRA8UnormSRGB)return Uint8Array;if(t===rt.RGB10A2Unorm||t===rt.RGB9E5UFloat||t===rt.RG11B10UFloat)return Uint32Array;if(t===rt.Depth32Float)return Float32Array;if(t===rt.Depth24Plus||t===rt.Depth24PlusStencil8)return Uint32Array;if(t===rt.Depth32FloatStencil8)return Float32Array}_getDimension(t){let e;return t.is3DTexture||t.isData3DTexture?e=mE.ThreeD:e=mE.TwoD,e}}function pw(r,t=null){const e=r.format,n=r.type,s=r.colorSpace,i=Xe.getTransfer(s);let a;if(r.isCompressedTexture===!0||r.isCompressedArrayTexture===!0)switch(e){case hp:case dp:a=i===ye?rt.BC1RGBAUnormSRGB:rt.BC1RGBAUnorm;break;case fp:a=i===ye?rt.BC2RGBAUnormSRGB:rt.BC2RGBAUnorm;break;case pp:a=i===ye?rt.BC3RGBAUnormSRGB:rt.BC3RGBAUnorm;break;case _y:a=rt.BC4RUnorm;break;case My:a=rt.BC4RSnorm;break;case Bp:a=rt.BC5RGUnorm;break;case vy:a=rt.BC5RGSnorm;break;case Ty:a=i===ye?rt.BC7RGBAUnormSRGB:rt.BC7RGBAUnorm;break;case sy:case ny:a=i===ye?rt.ETC2RGB8UnormSRGB:rt.ETC2RGB8Unorm;break;case iy:a=i===ye?rt.ETC2RGBA8UnormSRGB:rt.ETC2RGBA8Unorm;break;case ry:a=rt.EACR11Unorm;break;case oy:a=rt.EACR11Snorm;break;case Dp:a=rt.EACRG11Unorm;break;case ay:a=rt.EACRG11Snorm;break;case ly:a=i===ye?rt.ASTC4x4UnormSRGB:rt.ASTC4x4Unorm;break;case cy:a=i===ye?rt.ASTC5x4UnormSRGB:rt.ASTC5x4Unorm;break;case uy:a=i===ye?rt.ASTC5x5UnormSRGB:rt.ASTC5x5Unorm;break;case hy:a=i===ye?rt.ASTC6x5UnormSRGB:rt.ASTC6x5Unorm;break;case dy:a=i===ye?rt.ASTC6x6UnormSRGB:rt.ASTC6x6Unorm;break;case fy:a=i===ye?rt.ASTC8x5UnormSRGB:rt.ASTC8x5Unorm;break;case py:a=i===ye?rt.ASTC8x6UnormSRGB:rt.ASTC8x6Unorm;break;case my:a=i===ye?rt.ASTC8x8UnormSRGB:rt.ASTC8x8Unorm;break;case gy:a=i===ye?rt.ASTC10x5UnormSRGB:rt.ASTC10x5Unorm;break;case yy:a=i===ye?rt.ASTC10x6UnormSRGB:rt.ASTC10x6Unorm;break;case xy:a=i===ye?rt.ASTC10x8UnormSRGB:rt.ASTC10x8Unorm;break;case by:a=i===ye?rt.ASTC10x10UnormSRGB:rt.ASTC10x10Unorm;break;case Sy:a=i===ye?rt.ASTC12x10UnormSRGB:rt.ASTC12x10Unorm;break;case wy:a=i===ye?rt.ASTC12x12UnormSRGB:rt.ASTC12x12Unorm;break;case Ki:a=i===ye?rt.RGBA8UnormSRGB:rt.RGBA8Unorm;break;default:Ht("WebGPURenderer: Unsupported texture format.",e)}else switch(e){case Ki:switch(n){case hd:a=rt.RGBA8Snorm;break;case dd:a=rt.RGBA16Sint;break;case Eu:a=rt.RGBA16Uint;break;case Jn:a=rt.RGBA32Uint;break;case pi:a=rt.RGBA32Sint;break;case xi:a=i===ye?rt.RGBA8UnormSRGB:rt.RGBA8Unorm;break;case ii:a=rt.RGBA16Float;break;case Di:a=rt.RGBA32Float;break;default:Ht("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case tx:switch(n){case Nw:a=rt.RGB9E5UFloat;break;case Rw:a=rt.RG11B10UFloat;break;default:Ht("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case Wp:switch(n){case hd:a=rt.R8Snorm;break;case dd:a=rt.R16Sint;break;case Eu:a=rt.R16Uint;break;case Jn:a=rt.R32Uint;break;case pi:a=rt.R32Sint;break;case xi:a=rt.R8Unorm;break;case ii:a=rt.R16Float;break;case Di:a=rt.R32Float;break;default:Ht("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case Qo:switch(n){case hd:a=rt.RG8Snorm;break;case dd:a=rt.RG16Sint;break;case Eu:a=rt.RG16Uint;break;case Jn:a=rt.RG32Uint;break;case pi:a=rt.RG32Sint;break;case xi:a=rt.RG8Unorm;break;case ii:a=rt.RG16Float;break;case Di:a=rt.RG32Float;break;default:Ht("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case Mo:switch(n){case Eu:a=rt.Depth16Unorm;break;case Jn:a=rt.Depth24Plus;break;case Di:a=rt.Depth32Float;break;default:Ht("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case ol:switch(n){case Tc:a=rt.Depth24PlusStencil8;break;case Di:t&&t.features.has(fw.Depth32FloatStencil8)===!1&&Ht('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),a=rt.Depth32FloatStencil8;break;default:Ht("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case ex:switch(n){case pi:a=rt.R32Sint;break;case Jn:a=rt.R32Uint;break;default:Ht("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case nx:switch(n){case pi:a=rt.RG32Sint;break;case Jn:a=rt.RG32Uint;break;default:Ht("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case sx:switch(n){case pi:a=rt.RGBA32Sint;break;case Jn:a=rt.RGBA32Uint;break;default:Ht("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:Ht("WebGPURenderer: Unsupported texture format.",e)}return a}const aq=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,lq=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,yE={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},cq=r=>{r=r.trim();const t=r.match(aq);if(t!==null&&t.length===4){const e=t[2],n=[];let s=null;for(;(s=lq.exec(e))!==null;)n.push({name:s[1],type:s[2]});const i=[];for(let f=0;f<n.length;f++){const{name:p,type:g}=n[f];let y=g;y.startsWith("ptr")?y="pointer":(y.startsWith("texture")&&(y=g.split("<")[0]),y=yE[y]),i.push(new b_(y,p))}const a=r.substring(t[0].length),c=t[3]||"void",u=t[1]!==void 0?t[1]:"";return{type:yE[c]||c,inputs:i,name:u,inputsCode:e,blockCode:a,outputType:c}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class uq extends w_{constructor(t){const{type:e,inputs:n,name:s,inputsCode:i,blockCode:a,outputType:c}=cq(t);super(e,n,s),this.inputsCode=i,this.blockCode=a,this.outputType=c}getCode(t=this.name){const e=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${t} ( ${this.inputsCode.trim()} ) ${e}`+this.blockCode}}class hq extends kB{parseFunction(t){return new uq(t)}}const dq={[ri.READ_ONLY]:"read",[ri.WRITE_ONLY]:"write",[ri.READ_WRITE]:"read_write"},xE={[Fn]:"repeat",[Yi]:"clamp",[wd]:"mirror"},f2={vertex:ta.VERTEX,fragment:ta.FRAGMENT,compute:ta.COMPUTE},bE={instance:!0,swizzleAssign:!1,storageBuffer:!0},fq={"^^":"tsl_xor"},pq={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},SE={},Xf={tsl_xor:new Us("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Us("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Us("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Us("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Us("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Us("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Us("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Us("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Us("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Us("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Us("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Us("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Us(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`),biquadraticTextureArray:new Us(`
fn tsl_biquadraticTexture_array( map : texture_2d_array<f32>, coord : vec2f, iRes : vec2u, layer : u32, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, layer, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, layer, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, layer, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, layer, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},mq={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>",floatpack_snorm_2x16:"pack2x16snorm",floatpack_unorm_2x16:"pack2x16unorm",floatpack_float16_2x16:"pack2x16float",floatunpack_snorm_2x16:"unpack2x16snorm",floatunpack_unorm_2x16:"unpack2x16unorm",floatunpack_float16_2x16:"unpack2x16float"};let JB="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(JB+=`diagnostic( off, derivative_uniformity );
`);class gq extends GB{constructor(t,e){super(t,e,new hq),this.uniformGroups={},this.uniformGroupsBindings={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(t,e,n,s,i,a=this.shaderStage){return a==="fragment"?s?i?`textureSample( ${e}, ${e}_sampler, ${n}, ${s}, ${i} )`:`textureSample( ${e}, ${e}_sampler, ${n}, ${s} )`:i?`textureSample( ${e}, ${e}_sampler, ${n}, ${i} )`:`textureSample( ${e}, ${e}_sampler, ${n} )`:this.generateTextureSampleLevel(t,e,n,"0",s)}generateTextureSampleLevel(t,e,n,s,i,a){return this.isUnfilterable(t)===!1?i?a?`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${i}, ${s}, ${a} )`:`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${i}, ${s} )`:a?`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${s}, ${a} )`:`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${s} )`:this.isFilteredTexture(t)?this.generateFilteredTexture(t,e,n,a,s,i):this.generateTextureLod(t,e,n,i,a,s)}generateWrapFunction(t){const e=`tsl_coord_${xE[t.wrapS]}S_${xE[t.wrapT]}_${t.is3DTexture||t.isData3DTexture?"3d":"2d"}T`;let n=SE[e];if(n===void 0){const s=[],i=t.is3DTexture||t.isData3DTexture?"vec3f":"vec2f";let a=`fn ${e}( coord : ${i} ) -> ${i} {

	return ${i}(
`;const c=(u,d)=>{u===Fn?(s.push(Xf.repeatWrapping_float),a+=`		tsl_repeatWrapping_float( coord.${d} )`):u===Yi?(s.push(Xf.clampWrapping_float),a+=`		tsl_clampWrapping_float( coord.${d} )`):u===wd?(s.push(Xf.mirrorWrapping_float),a+=`		tsl_mirrorWrapping_float( coord.${d} )`):(a+=`		coord.${d}`,Wt(`WebGPURenderer: Unsupported texture wrap type "${u}" for vertex shader.`))};c(t.wrapS,"x"),a+=`,
`,c(t.wrapT,"y"),(t.is3DTexture||t.isData3DTexture)&&(a+=`,
`,c(t.wrapR,"z")),a+=`
	);

}
`,SE[e]=n=new Us(a,s)}return n.build(this),e}generateArrayDeclaration(t,e){return`array< ${this.getType(t)}, ${e} >`}generateTextureDimension(t,e,n){const s=this.getDataFromNode(t,this.shaderStage,this.globalCache);s.dimensionsSnippet===void 0&&(s.dimensionsSnippet={});let i=s.dimensionsSnippet[n];if(s.dimensionsSnippet[n]===void 0){let a,c;const{primarySamples:u}=this.renderer.backend.utils.getTextureSampleData(t),d=u>1;t.is3DTexture||t.isData3DTexture?c="vec3<u32>":c="vec2<u32>",d||t.isStorageTexture?a=e:a=`${e}${n?`, u32( ${n} )`:""}`,i=new Vg(new Gg(`textureDimensions( ${a} )`,c)),s.dimensionsSnippet[n]=i,(t.isArrayTexture||t.isDataArrayTexture||t.is3DTexture||t.isData3DTexture)&&(s.arrayLayerCount=new Vg(new Gg(`textureNumLayers(${e})`,"u32"))),t.isTextureCube&&(s.cubeFaceCount=new Vg(new Gg("6u","u32")))}return i.build(this)}generateFilteredTexture(t,e,n,s,i="0u",a){const c=this.generateWrapFunction(t),u=this.generateTextureDimension(t,e,i);return s&&(n=`${n} + vec2<f32>(${s}) / ${u}`),a?(this._include("biquadraticTextureArray"),`tsl_biquadraticTexture_array( ${e}, ${c}( ${n} ), ${u}, u32( ${a} ), u32( ${i} ) )`):(this._include("biquadraticTexture"),`tsl_biquadraticTexture( ${e}, ${c}( ${n} ), ${u}, u32( ${i} ) )`)}generateTextureLod(t,e,n,s,i,a="0u"){if(t.isCubeTexture===!0){i&&(n=`${n} + vec3<f32>(${i})`);const y=t.isDepthTexture?"u32":"f32";return`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${y}( ${a} ) )`}const c=this.generateWrapFunction(t),u=this.generateTextureDimension(t,e,a),d=t.is3DTexture||t.isData3DTexture?"vec3":"vec2",f=d==="vec3"?"vec3<u32>( 1, 1, 1 )":"vec2<u32>( 1, 1 )";i&&(n=`${n} + ${d}<f32>(${i}) / ${d}<f32>( ${u} )`);const p=`${d}<f32>( 0 )`,g=`${d}<f32>( ${u} - ${f} )`;return n=`${d}<u32>( clamp( floor( ${c}( ${n} ) * ${d}<f32>( ${u} ) ), ${p}, ${g} ) )`,this.generateTextureLoad(t,e,n,a,s,null)}generateTextureLoad(t,e,n,s,i,a){const c=t.isStorageTexture===!0;s===null&&!c&&(s="0u"),a&&(n=`${n} + ${a}`);let u;return i?c?u=`textureLoad( ${e}, ${n}, ${i} )`:u=`textureLoad( ${e}, ${n}, ${i}, u32( ${s} ) )`:c?u=`textureLoad( ${e}, ${n} )`:(u=`textureLoad( ${e}, ${n}, u32( ${s} ) )`,this.renderer.backend.compatibilityMode&&t.isDepthTexture&&(u+=".x")),u}generateTextureStore(t,e,n,s,i){let a;return s?a=`textureStore( ${e}, ${n}, ${s}, ${i} )`:a=`textureStore( ${e}, ${n}, ${i} )`,a}isSampleCompare(t){return t.isDepthTexture===!0&&t.compareFunction!==null&&this.renderer.hasCompatibility(_c.TEXTURE_COMPARE)}isUnfilterable(t){return this.getComponentTypeFromTexture(t)!=="float"||!this.isAvailable("float32Filterable")&&t.isDataTexture===!0&&t.type===Di||this.isSampleCompare(t)===!1&&t.minFilter===ts&&t.magFilter===ts||this.renderer.backend.utils.getTextureSampleData(t).primarySamples>1}generateTexture(t,e,n,s,i,a=this.shaderStage){let c=null;return this.isUnfilterable(t)?c=this.generateTextureLod(t,e,n,s,i,"0",a):c=this._generateTextureSample(t,e,n,s,i,a),c}generateTextureGrad(t,e,n,s,i,a,c=this.shaderStage){if(c==="fragment")return i?a?`textureSampleGrad( ${e}, ${e}_sampler, ${n}, ${i}, ${s[0]}, ${s[1]}, ${a} )`:`textureSampleGrad( ${e}, ${e}_sampler, ${n}, ${i}, ${s[0]}, ${s[1]} )`:a?`textureSampleGrad( ${e}, ${e}_sampler, ${n}, ${s[0]}, ${s[1]}, ${a} )`:`textureSampleGrad( ${e}, ${e}_sampler, ${n}, ${s[0]}, ${s[1]} )`;Ht(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${c} shader.`)}generateTextureCompare(t,e,n,s,i,a,c=this.shaderStage){if(c==="fragment")return t.isDepthTexture===!0&&t.isArrayTexture===!0?a?`textureSampleCompare( ${e}, ${e}_sampler, ${n}, ${i}, ${s}, ${a} )`:`textureSampleCompare( ${e}, ${e}_sampler, ${n}, ${i}, ${s} )`:a?`textureSampleCompare( ${e}, ${e}_sampler, ${n}, ${s}, ${a} )`:`textureSampleCompare( ${e}, ${e}_sampler, ${n}, ${s} )`;Ht(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${c} shader.`)}generateTextureLevel(t,e,n,s,i,a){return this.isUnfilterable(t)===!1?i?a?`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${i}, ${s}, ${a} )`:`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${i}, ${s} )`:a?`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${s}, ${a} )`:`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${s} )`:this.isFilteredTexture(t)?this.generateFilteredTexture(t,e,n,a,s,i):this.generateTextureLod(t,e,n,i,a,s)}generateTextureBias(t,e,n,s,i,a,c=this.shaderStage){if(c==="fragment")return i?a?`textureSampleBias( ${e}, ${e}_sampler, ${n}, ${i}, ${s}, ${a} )`:`textureSampleBias( ${e}, ${e}_sampler, ${n}, ${i}, ${s} )`:a?`textureSampleBias( ${e}, ${e}_sampler, ${n}, ${s}, ${a} )`:`textureSampleBias( ${e}, ${e}_sampler, ${n}, ${s} )`;Ht(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${c} shader.`)}getPropertyName(t,e=this.shaderStage){if(t.isNodeVarying===!0&&t.needsInterpolation===!0){if(e==="vertex")return`varyings.${t.name}`}else if(t.isNodeUniform===!0){const n=t.name,s=t.type;return s==="texture"||s==="cubeTexture"||s==="cubeDepthTexture"||s==="storageTexture"||s==="texture3D"?n:s==="buffer"||s==="storageBuffer"||s==="indirectStorageBuffer"?this.isCustomStruct(t)?n:n+".value":t.groupNode.name+"."+n}return super.getPropertyName(t)}getOutputStructName(){return"output"}getFunctionOperator(t){const e=fq[t];return e!==void 0?(this._include(e),e):null}getNodeAccess(t,e){return e!=="compute"?t.isAtomic===!0?(Wt("WebGPURenderer: Atomic operations are only supported in compute shaders."),ri.READ_WRITE):ri.READ_ONLY:t.access}getStorageAccess(t,e){return dq[this.getNodeAccess(t,e)]}getUniformFromNode(t,e,n,s=null){const i=super.getUniformFromNode(t,e,n,s),a=this.getDataFromNode(t,n,this.globalCache);if(a.uniformGPU===void 0){let c;const u=t.groupNode,d=u.name,f=this.getBindGroupArray(d,n);if(e==="texture"||e==="cubeTexture"||e==="cubeDepthTexture"||e==="storageTexture"||e==="texture3D"){let p=null;const g=this.getNodeAccess(t,n);if(e==="texture"||e==="storageTexture"?t.value.is3DTexture===!0?p=new dw(i.name,i.node,u,g):p=new kx(i.name,i.node,u,g):e==="cubeTexture"||e==="cubeDepthTexture"?p=new KB(i.name,i.node,u,g):e==="texture3D"&&(p=new dw(i.name,i.node,u,g)),p.store=t.isStorageTextureNode===!0,p.mipLevel=p.store?t.mipLevel:0,p.setVisibility(f2[n]),t.value.isCubeTexture===!0||this.isUnfilterable(t.value)===!1&&p.store===!1){const x=new JW(`${i.name}_sampler`,i.node,u);x.setVisibility(f2[n]),f.push(x,p),c=[x,p]}else f.push(p),c=[p]}else if(e==="buffer"||e==="storageBuffer"||e==="indirectStorageBuffer"){const p=this.getSharedDataFromNode(t);let g=p.buffer;if(g===void 0){const y=e==="buffer"?XB:nq;g=new y(t,u),p.buffer=g}g.setVisibility(g.getVisibility()|f2[n]),f.push(g),c=g,i.name=s||"NodeBuffer_"+i.id}else{let p=this.uniformGroups[d];p===void 0&&(p=new jB(d,u),p.setVisibility(ta.VERTEX|ta.FRAGMENT|ta.COMPUTE),this.uniformGroups[d]=p),f.indexOf(p)===-1&&f.push(p),c=this.getNodeUniform(i,e);const g=c.name;p.uniforms.some(x=>x.name===g)||p.addUniform(c)}a.uniformGPU=c}return i}getBuiltin(t,e,n,s=this.shaderStage){const i=this.builtins[s]||(this.builtins[s]=new Map);return i.has(t)===!1&&i.set(t,{name:t,property:e,type:n}),e}hasBuiltin(t,e=this.shaderStage){return this.builtins[e]!==void 0&&this.builtins[e].has(t)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(t){const e=t.layout,n=this.flowShaderNode(t),s=[];for(const a of e.inputs)s.push(a.name+" : "+this.getType(a.type));let i=`fn ${e.name}( ${s.join(", ")} ) -> ${this.getType(e.type)} {
${n.vars}
${n.code}
`;return n.result&&(i+=`	return ${n.result};
`),i+=`
}
`,i}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(t,e=this.shaderStage){(this.directives[e]||(this.directives[e]=new Set)).add(t)}getDirectives(t){const e=[],n=this.directives[t];if(n!==void 0)for(const s of n)e.push(`enable ${s};`);return e.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(t){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${t} >`,"vertex")}getBuiltins(t){const e=[],n=this.builtins[t];if(n!==void 0)for(const{name:s,property:i,type:a}of n.values())e.push(`@builtin( ${s} ) ${i} : ${a}`);return e.join(`,
	`)}getScopedArray(t,e,n,s){return this.scopedArrays.has(t)===!1&&this.scopedArrays.set(t,{name:t,scope:e,bufferType:n,bufferCount:s}),t}getScopedArrays(t){if(t!=="compute")return;const e=[];for(const{name:n,scope:s,bufferType:i,bufferCount:a}of this.scopedArrays.values()){const c=this.getType(i);e.push(`var<${s}> ${n}: array< ${c}, ${a} >;`)}return e.join(`
`)}getAttributes(t){const e=[];if(t==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",t),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),t==="vertex"||t==="compute"){const n=this.getBuiltins("attribute");n&&e.push(n);const s=this.getAttributesArray();for(let i=0,a=s.length;i<a;i++){const c=s[i],u=c.name,d=this.getType(c.type);e.push(`@location( ${i} ) ${u} : ${d}`)}}return e.join(`,
	`)}getStructMembers(t){const e=[];for(const n of t.members){const s=t.output?"@location( "+n.index+" ) ":"";let i=this.getType(n.type);n.atomic&&(i="atomic< "+i+" >"),e.push(`	${s+n.name} : ${i}`)}return t.output&&e.push(`	${this.getBuiltins("output")}`),e.join(`,
`)}getStructs(t){let e="";const n=this.structs[t];if(n.length>0){const s=[];for(const i of n){let a=`struct ${i.name} {
`;a+=this.getStructMembers(i),a+=`
};`,s.push(a)}e=`
`+s.join(`

`)+`
`}return e}getVar(t,e,n=null){let s=`var ${e} : `;return n!==null?s+=this.generateArrayDeclaration(t,n):s+=this.getType(t),s}getVars(t){const e=[],n=this.vars[t];if(n!==void 0)for(const s of n)e.push(`	${this.getVar(s.type,s.name,s.count)};`);return`
${e.join(`
`)}
`}getVaryings(t){const e=[];if(t==="vertex"&&this.getBuiltin("position","builtinClipSpace","vec4<f32>","vertex"),t==="vertex"||t==="fragment"){const i=this.varyings,a=this.vars[t];for(let c=0;c<i.length;c++){const u=i[c];if(u.needsInterpolation){let d=`@location( ${c} )`;if(u.interpolationType){const f=u.interpolationSampling!==null?`, ${u.interpolationSampling} )`:" )";d+=` @interpolate( ${u.interpolationType}${f}`}else/^(int|uint|ivec|uvec)/.test(u.type)&&(d+=" @interpolate(flat, either)");e.push(`${d} ${u.name} : ${this.getType(u.type)}`)}else t==="vertex"&&a.includes(u)===!1&&a.push(u)}}const n=this.getBuiltins(t);n&&e.push(n);const s=e.join(`,
	`);return t==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+s):s}isCustomStruct(t){const e=t.value,n=t.node,s=(e.isBufferAttribute||e.isInstancedBufferAttribute)&&n.structTypeNode!==null,i=n.value&&n.value.array&&typeof n.value.itemSize=="number"&&n.value.array.length>n.value.itemSize;return s&&!i}getUniforms(t){const e=this.uniforms[t],n=[],s=[],i=[],a={};for(const u of e){const d=u.groupNode.name,f=this.bindingsIndexes[d];if(u.type==="texture"||u.type==="cubeTexture"||u.type==="cubeDepthTexture"||u.type==="storageTexture"||u.type==="texture3D"){const p=u.node.value;(p.isCubeTexture===!0||this.isUnfilterable(p)===!1&&u.node.isStorageTextureNode!==!0)&&(this.isSampleCompare(p)?n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${u.name}_sampler : sampler_comparison;`):n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${u.name}_sampler : sampler;`));let y,x="";const{primarySamples:S}=this.renderer.backend.utils.getTextureSampleData(p);if(S>1&&(x="_multisampled"),p.isCubeTexture===!0&&p.isDepthTexture===!0)y="texture_depth_cube";else if(p.isCubeTexture===!0)y="texture_cube<f32>";else if(p.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&p.compareFunction===null?y=`texture${x}_2d<f32>`:y=`texture_depth${x}_2d${p.isArrayTexture===!0?"_array":""}`;else if(u.node.isStorageTextureNode===!0){const T=pw(p),M=this.getStorageAccess(u.node,t),N=u.node.value.is3DTexture,v=u.node.value.isArrayTexture;y=`texture_storage_${N?"3d":`2d${v?"_array":""}`}<${T}, ${M}>`}else if(p.isArrayTexture===!0||p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0)y="texture_2d_array<f32>";else if(p.is3DTexture===!0||p.isData3DTexture===!0)y="texture_3d<f32>";else{const T=this.getComponentTypeFromTexture(p).charAt(0);y=`texture${x}_2d<${T}32>`}n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${u.name} : ${y};`)}else if(u.type==="buffer"||u.type==="storageBuffer"||u.type==="indirectStorageBuffer"){const p=u.node,g=this.getType(p.getNodeType(this)),y=p.bufferCount,x=y>0&&u.type==="buffer"?", "+y:"",S=p.isStorageBufferNode?`storage, ${this.getStorageAccess(p,t)}`:"uniform";if(this.isCustomStruct(u))s.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var<${S}> ${u.name} : ${g};`);else{const M=`	value : array< ${p.isAtomic?`atomic<${g}>`:`${g}`}${x} >`;s.push(this._getWGSLStructBinding(u.name,M,S,f.binding++,f.group))}}else{const p=u.groupNode.name;if(a[p]===void 0){const g=this.uniformGroups[p];if(g!==void 0){const y=[];for(const S of g.uniforms){const T=S.getType(),M=this.getType(this.getVectorType(T));y.push(`	${S.name} : ${M}`)}let x=this.uniformGroupsBindings[p];x===void 0&&(x={index:f.binding++,id:f.group},this.uniformGroupsBindings[p]=x),a[p]={index:x.index,id:x.id,snippets:y}}}}}for(const u in a){const d=a[u];i.push(this._getWGSLStructBinding(u,d.snippets.join(`,
`),"uniform",d.index,d.id))}return[...n,...s,...i].join(`
`)}buildCode(){const t=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const e in t){this.shaderStage=e;const n=t[e];n.uniforms=this.getUniforms(e),n.attributes=this.getAttributes(e),n.varyings=this.getVaryings(e),n.structs=this.getStructs(e),n.vars=this.getVars(e),n.codes=this.getCodes(e),n.directives=this.getDirectives(e),n.scopedArrays=this.getScopedArrays(e);let s=`// code

`;s+=this.flowCode[e];const i=this.flowNodes[e],a=i[i.length-1],c=a.outputNode,u=c!==void 0&&c.isOutputStructNode===!0;for(const d of i){const f=this.getFlowData(d),p=d.name;if(p&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${p}
`),s+=`${f.code}
	`,d===a&&e!=="compute"){if(s+=`// result

	`,e==="vertex")s+=`varyings.builtinClipSpace = ${f.result};`;else if(e==="fragment")if(u)n.returnType=c.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",s+=`return ${f.result};`;else{let g="	@location(0) color: vec4<f32>";const y=this.getBuiltins("output");y&&(g+=`,
	`+y),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",g),n.structs+=`
var<private> output : OutputStruct;`,s+=`output.color = ${f.result};

	return output;`}}}n.flow=s}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(t.vertex),this.fragmentShader=this._getWGSLFragmentCode(t.fragment);else{const e=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(t.compute,e)}}getMethod(t,e=null){let n;return e!==null&&(n=this._getWGSLMethod(t+"_"+e)),n===void 0&&(n=this._getWGSLMethod(t)),n||t}getBitcastMethod(t){return`bitcast<${this.getType(t)}>`}getFloatPackingMethod(t){return this.getMethod(`floatpack_${t}_2x16`)}getFloatUnpackingMethod(t){return this.getMethod(`floatunpack_${t}_2x16`)}getTernary(t,e,n){return`select( ${n}, ${e}, ${t} )`}getType(t){return pq[t]||t}isAvailable(t){let e=bE[t];return e===void 0&&(t==="float32Filterable"?e=this.renderer.hasFeature("float32-filterable"):t==="clipDistance"&&(e=this.renderer.hasFeature("clip-distances")),bE[t]=e),e}getUniformBufferLimit(){return this.renderer.backend.device.limits.maxUniformBufferBindingSize}_getWGSLMethod(t){return Xf[t]!==void 0&&this._include(t),mq[t]}_include(t){const e=Xf[t];return e.build(this),this.addInclude(e),e}_getWGSLVertexCode(t){return`${this.getSignature()}
// directives
${t.directives}

// structs
${t.structs}

// uniforms
${t.uniforms}

// varyings
${t.varyings}
var<private> varyings : VaryingsStruct;

// codes
${t.codes}

@vertex
fn main( ${t.attributes} ) -> VaryingsStruct {

	// vars
	${t.vars}

	// flow
	${t.flow}

	return varyings;

}
`}_getWGSLFragmentCode(t){return`${this.getSignature()}
// global
${JB}

// structs
${t.structs}

// uniforms
${t.uniforms}

// codes
${t.codes}

@fragment
fn main( ${t.varyings} ) -> ${t.returnType} {

	// vars
	${t.vars}

	// flow
	${t.flow}

}
`}_getWGSLComputeCode(t,e){const[n,s,i]=e;return`${this.getSignature()}
// directives
${t.directives}

// system
var<private> instanceIndex : u32;

// locals
${t.scopedArrays}

// structs
${t.structs}

// uniforms
${t.uniforms}

// codes
${t.codes}

@compute @workgroup_size( ${n}, ${s}, ${i} )
fn main( ${t.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${n} * numWorkgroups.x )
		+ globalId.z * ( ${n} * numWorkgroups.x ) * ( ${s} * numWorkgroups.y );

	// vars
	${t.vars}

	// flow
	${t.flow}

}
`}_getWGSLStruct(t,e){return`
struct ${t} {
${e}
};`}_getWGSLStructBinding(t,e,n,s=0,i=0){const a=t+"Struct";return`${this._getWGSLStruct(a,e)}
@binding( ${s} ) @group( ${i} )
var<${n}> ${t} : ${a};`}}class yq{constructor(t){this.backend=t}getCurrentDepthStencilFormat(t){let e;return t.depth&&(t.depthTexture!==null?e=this.getTextureFormatGPU(t.depthTexture):t.stencil?e=rt.Depth24PlusStencil8:e=rt.Depth24Plus),e}getTextureFormatGPU(t){return this.backend.get(t).format}getTextureSampleData(t){let e;if(t.isFramebufferTexture)e=1;else if(t.isDepthTexture&&!t.renderTarget){const i=this.backend.renderer,a=i.getRenderTarget();e=a?a.samples:i.currentSamples}else t.renderTarget&&(e=t.renderTarget.samples);e=e||1;const n=e>1&&t.renderTarget!==null&&t.isDepthTexture!==!0&&t.isFramebufferTexture!==!0;return{samples:e,primarySamples:n?1:e,isMSAA:n}}getCurrentColorFormat(t){let e;return t.textures!==null?e=this.getTextureFormatGPU(t.textures[0]):e=this.getPreferredCanvasFormat(),e}getCurrentColorFormats(t){return t.textures!==null?t.textures.map(e=>this.getTextureFormatGPU(e)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(t){return t.textures!==null?t.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(t,e){if(t.isPoints)return mg.PointList;if(t.isLineSegments||t.isMesh&&e.wireframe===!0)return mg.LineList;if(t.isLine)return mg.LineStrip;if(t.isMesh)return mg.TriangleList}getSampleCount(t){return t>=4?4:1}getSampleCountRenderContext(t){return t.textures!==null?this.getSampleCount(t.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===xi)return rt.BGRA8Unorm;if(e===ii)return rt.RGBA16Float;throw new Error("Unsupported output buffer type.")}}const tL=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&tL.set(Float16Array,["float16"]);const xq=new Map([[sC,["float16"]]]),bq=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class Sq{constructor(t){this.backend=t}createAttribute(t,e){const n=this._getBufferAttribute(t),s=this.backend,i=s.get(n);let a=i.buffer;if(a===void 0){const c=s.device;let u=n.array;if(t.normalized===!1){if(u.constructor===Int16Array||u.constructor===Int8Array)u=new Int32Array(u);else if((u.constructor===Uint16Array||u.constructor===Uint8Array)&&(u=new Uint32Array(u),e&GPUBufferUsage.INDEX))for(let p=0;p<u.length;p++)u[p]===65535&&(u[p]=4294967295)}if(n.array=u,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){u=new u.constructor(n.count*4);for(let p=0;p<n.count;p++)u.set(n.array.subarray(p*3,p*3+3),p*4);n.itemSize=4,n.array=u,i._force3to4BytesAlignment=!0}const d=u.byteLength,f=d+(4-d%4)%4;a=c.createBuffer({label:n.name,size:f,usage:e,mappedAtCreation:!0}),new u.constructor(a.getMappedRange()).set(u),a.unmap(),i.buffer=a}}updateAttribute(t){const e=this._getBufferAttribute(t),n=this.backend,s=n.device,i=n.get(e),a=n.get(e).buffer;let c=e.array;if(i._force3to4BytesAlignment===!0){c=new c.constructor(e.count*4);for(let d=0;d<e.count;d++)c.set(e.array.subarray(d*3,d*3+3),d*4);e.array=c}const u=e.updateRanges;if(u.length===0)s.queue.writeBuffer(a,0,c,0);else{const d=Ry(c),f=d?1:c.BYTES_PER_ELEMENT;for(let p=0,g=u.length;p<g;p++){const y=u[p];let x,S;if(i._force3to4BytesAlignment===!0){const M=Math.floor(y.start/3),N=Math.ceil(y.count/3);x=M*4*f,S=N*4*f}else x=y.start*f,S=y.count*f;const T=x*(d?c.BYTES_PER_ELEMENT:1);s.queue.writeBuffer(a,T,c,x,S)}e.clearUpdateRanges()}}createShaderVertexBuffers(t){const e=t.getAttributes(),n=new Map;for(let s=0;s<e.length;s++){const i=e[s],a=i.array.BYTES_PER_ELEMENT,c=this._getBufferAttribute(i);let u=n.get(c);if(u===void 0){let p,g;i.isInterleavedBufferAttribute===!0?(p=i.data.stride*a,g=i.data.isInstancedInterleavedBuffer?gg.Instance:gg.Vertex):(p=i.itemSize*a,g=i.isInstancedBufferAttribute?gg.Instance:gg.Vertex),i.normalized===!1&&(i.array.constructor===Int16Array||i.array.constructor===Uint16Array)&&(p=4),u={arrayStride:p,attributes:[],stepMode:g},n.set(c,u)}const d=this._getVertexFormat(i),f=i.isInterleavedBufferAttribute===!0?i.offset*a:0;u.attributes.push({shaderLocation:s,offset:f,format:d})}return Array.from(n.values())}destroyAttribute(t){const e=this.backend;e.get(this._getBufferAttribute(t)).buffer.destroy(),e.delete(t)}async getArrayBufferAsync(t){const e=this.backend,n=e.device,i=e.get(this._getBufferAttribute(t)).buffer,a=i.size,c=n.createBuffer({label:`${t.name}_readback`,size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),u=n.createCommandEncoder({label:`readback_encoder_${t.name}`});u.copyBufferToBuffer(i,0,c,0,a);const d=u.finish();n.queue.submit([d]),await c.mapAsync(GPUMapMode.READ);const f=c.getMappedRange(),p=new t.array.constructor(f.slice(0));return c.unmap(),p.buffer}_getVertexFormat(t){const{itemSize:e,normalized:n}=t,s=t.array.constructor,i=t.constructor;let a;if(e===1)a=bq.get(s);else{const u=(xq.get(i)||tL.get(s))[n?1:0];if(u){const d=s.BYTES_PER_ELEMENT*e,p=Math.floor((d+3)/4)*4/s.BYTES_PER_ELEMENT;if(p%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");a=`${u}x${p}`}}return a||Ht("WebGPUAttributeUtils: Vertex format not supported yet."),a}_getBufferAttribute(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}class wq{constructor(t){this.layoutGPU=t,this.usedTimes=0}}class Tq{constructor(t){this.backend=t,this._bindGroupLayoutCache=new Map}createBindingsLayout(t){const e=this.backend,n=e.device,s=e.get(t);if(s.layout)return s.layout.layoutGPU;const i=this._createLayoutEntries(t),a=Dd(JSON.stringify(i));let c=this._bindGroupLayoutCache.get(a);return c===void 0&&(c=new wq(n.createBindGroupLayout({entries:i})),this._bindGroupLayoutCache.set(a,c)),c.usedTimes++,s.layout=c,s.layoutKey=a,c.layoutGPU}createBindings(t,e,n,s=0){const{backend:i}=this,a=i.get(t),c=this.createBindingsLayout(t);let u;n>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[n]===s&&(u=a.groups[n])),u===void 0&&(u=this.createBindGroup(t,c),n>0&&(a.groups[n]=u,a.versions[n]=s)),a.group=u}updateBinding(t){const e=this.backend,n=e.device,s=t.buffer,i=e.get(t).buffer,a=t.updateRanges;if(a.length===0)n.queue.writeBuffer(i,0,s,0);else{const c=Ry(s),u=c?1:s.BYTES_PER_ELEMENT;for(let d=0,f=a.length;d<f;d++){const p=a[d],g=p.start*u,y=p.count*u,x=g*(c?s.BYTES_PER_ELEMENT:1);n.queue.writeBuffer(i,x,s,g,y)}}}createBindGroupIndex(t,e){const s=this.backend.device,i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a=t[0],c=s.createBuffer({label:"bindingCameraIndex_"+a,size:16,usage:i});s.queue.writeBuffer(c,0,t,0);const u=[{binding:0,resource:{buffer:c}}];return s.createBindGroup({label:"bindGroupCameraIndex_"+a,layout:e,entries:u})}createBindGroup(t,e){const n=this.backend,s=n.device;let i=0;const a=[];for(const c of t.bindings){if(c.isUniformBuffer){const u=n.get(c);if(u.buffer===void 0){const d=c.byteLength,f=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,p=[];c.visibility&ta.VERTEX&&p.push("vertex"),c.visibility&ta.FRAGMENT&&p.push("fragment"),c.visibility&ta.COMPUTE&&p.push("compute");const g=`(${p.join(",")})`,y=s.createBuffer({label:`bindingBuffer${c.id}_${c.name}_${g}`,size:d,usage:f});u.buffer=y}a.push({binding:i,resource:{buffer:u.buffer}})}else if(c.isStorageBuffer){const u=n.get(c.attribute).buffer;a.push({binding:i,resource:{buffer:u}})}else if(c.isSampledTexture){const u=n.get(c.texture);let d;if(u.externalTexture!==void 0)d=s.importExternalTexture({source:u.externalTexture});else{const f=c.store?1:u.texture.mipLevelCount,p=c.store?c.mipLevel:0;let g=`view-${u.texture.width}-${u.texture.height}`;if(u.texture.depthOrArrayLayers>1&&(g+=`-${u.texture.depthOrArrayLayers}`),g+=`-${f}-${p}`,d=u[g],d===void 0){const y=QW.All;let x;c.isSampledCubeTexture?x=fi.Cube:c.isSampledTexture3D?x=fi.ThreeD:c.texture.isArrayTexture||c.texture.isDataArrayTexture||c.texture.isCompressedArrayTexture?x=fi.TwoDArray:x=fi.TwoD,d=u[g]=u.texture.createView({aspect:y,dimension:x,mipLevelCount:f,baseMipLevel:p})}}a.push({binding:i,resource:d})}else if(c.isSampler){const u=n.get(c.texture);a.push({binding:i,resource:u.sampler})}i++}return s.createBindGroup({label:"bindGroup_"+t.name,layout:e,entries:a})}_createLayoutEntries(t){const e=[];let n=0;for(const s of t.bindings){const i=this.backend,a={binding:n,visibility:s.visibility};if(s.isUniformBuffer||s.isStorageBuffer){const c={};s.isStorageBuffer&&(s.visibility&ta.COMPUTE&&(s.access===ri.READ_WRITE||s.access===ri.WRITE_ONLY)?c.type=h2.Storage:c.type=h2.ReadOnlyStorage),a.buffer=c}else if(s.isSampledTexture&&s.store){const c={};c.format=this.backend.get(s.texture).texture.format;const u=s.access;u===ri.READ_WRITE?c.access=d2.ReadWrite:u===ri.WRITE_ONLY?c.access=d2.WriteOnly:c.access=d2.ReadOnly,s.texture.isArrayTexture?c.viewDimension=fi.TwoDArray:s.texture.is3DTexture&&(c.viewDimension=fi.ThreeD),a.storageTexture=c}else if(s.isSampledTexture){const c={},{primarySamples:u}=i.utils.getTextureSampleData(s.texture);if(u>1&&(c.multisampled=!0,s.texture.isDepthTexture||(c.sampleType=mu.UnfilterableFloat)),s.texture.isDepthTexture)i.compatibilityMode&&s.texture.compareFunction===null?c.sampleType=mu.UnfilterableFloat:c.sampleType=mu.Depth;else if(s.texture.isDataTexture||s.texture.isDataArrayTexture||s.texture.isData3DTexture){const d=s.texture.type;d===pi?c.sampleType=mu.SInt:d===Jn?c.sampleType=mu.UInt:d===Di&&(this.backend.hasFeature("float32-filterable")?c.sampleType=mu.Float:c.sampleType=mu.UnfilterableFloat)}s.isSampledCubeTexture?c.viewDimension=fi.Cube:s.texture.isArrayTexture||s.texture.isDataArrayTexture||s.texture.isCompressedArrayTexture?c.viewDimension=fi.TwoDArray:s.isSampledTexture3D&&(c.viewDimension=fi.ThreeD),a.texture=c}else if(s.isSampler){const c={};s.texture.isDepthTexture&&(s.texture.compareFunction!==null&&i.hasCompatibility(_c.TEXTURE_COMPARE)?c.type=pE.Comparison:c.type=pE.NonFiltering),a.sampler=c}else Ht(`WebGPUBindingUtils: Unsupported binding "${s}".`);e.push(a),n++}return e}deleteBindGroupData(t){const{backend:e}=this,n=e.get(t);n.layout&&(n.layout.usedTimes--,n.layout.usedTimes===0&&this._bindGroupLayoutCache.delete(n.layoutKey),n.layout=void 0,n.layoutKey=void 0)}dispose(){this._bindGroupLayoutCache.clear()}}class _q{constructor(t){this.backend=t,this._activePipelines=new WeakMap}setPipeline(t,e){this._activePipelines.get(t)!==e&&(t.setPipeline(e),this._activePipelines.set(t,e))}_getSampleCount(t){return this.backend.utils.getSampleCountRenderContext(t)}createRenderPipeline(t,e){const{object:n,material:s,geometry:i,pipeline:a}=t,{vertexProgram:c,fragmentProgram:u}=a,d=this.backend,f=d.device,p=d.utils,g=d.get(a),y=[];for(const ft of t.getBindings()){const Mt=d.get(ft),{layoutGPU:mt}=Mt.layout;y.push(mt)}const x=d.attributeUtils.createShaderVertexBuffers(t);let S;s.blending!==rl&&(s.blending!==mi||s.transparent!==!1)&&(S=this._getBlending(s));let T={};s.stencilWrite===!0&&(T={compare:this._getStencilCompare(s),failOp:this._getStencilOperation(s.stencilFail),depthFailOp:this._getStencilOperation(s.stencilZFail),passOp:this._getStencilOperation(s.stencilZPass)});const M=this._getColorWriteMask(s),N=[];if(t.context.textures!==null){const ft=t.context.textures,Mt=t.context.mrt;for(let mt=0;mt<ft.length;mt++){const F=ft[mt],Y=p.getTextureFormatGPU(F);let tt;if(Mt!==null)if(this.backend.compatibilityMode!==!0){const lt=Mt.getBlendMode(F.name);lt.blending===_w?tt=S:lt.blending!==rl&&(tt=this._getBlending(lt))}else an("WebGPURenderer: Multiple Render Targets (MRT) blending configuration is not fully supported in compatibility mode. The material blending will be used for all render targets."),tt=S;else tt=S;N.push({format:Y,blend:tt,writeMask:M})}}else{const ft=p.getCurrentColorFormat(t.context);N.push({format:ft,blend:S,writeMask:M})}const v=d.get(c).module,A=d.get(u).module,R=this._getPrimitiveState(n,i,s),L=this._getDepthCompare(s),D=p.getCurrentDepthStencilFormat(t.context),U=this._getSampleCount(t.context),B={label:`renderPipeline_${s.name||s.type}_${s.id}`,vertex:Object.assign({},v,{buffers:x}),fragment:Object.assign({},A,{targets:N}),primitive:R,multisample:{count:U,alphaToCoverageEnabled:s.alphaToCoverage&&U>1},layout:f.createPipelineLayout({bindGroupLayouts:y})},P={},J=t.context.depth,q=t.context.stencil;if((J===!0||q===!0)&&(J===!0&&(P.format=D,P.depthWriteEnabled=s.depthWrite,P.depthCompare=L),q===!0&&(P.stencilFront=T,P.stencilBack=T,P.stencilReadMask=s.stencilFuncMask,P.stencilWriteMask=s.stencilWriteMask),s.polygonOffset===!0&&(P.depthBias=s.polygonOffsetUnits,P.depthBiasSlopeScale=s.polygonOffsetFactor,P.depthBiasClamp=0),B.depthStencil=P),f.pushErrorScope("validation"),e===null)g.pipeline=f.createRenderPipeline(B),f.popErrorScope().then(ft=>{ft!==null&&(g.error=!0,Ht(ft.message))});else{const ft=new Promise(async Mt=>{try{g.pipeline=await f.createRenderPipelineAsync(B)}catch{}const mt=await f.popErrorScope();mt!==null&&(g.error=!0,Ht(mt.message)),Mt()});e.push(ft)}}createBundleEncoder(t,e="renderBundleEncoder"){const n=this.backend,{utils:s,device:i}=n,a=s.getCurrentDepthStencilFormat(t),c=s.getCurrentColorFormats(t),u=this._getSampleCount(t),d={label:e,colorFormats:c,depthStencilFormat:a,sampleCount:u};return i.createRenderBundleEncoder(d)}createComputePipeline(t,e){const n=this.backend,s=n.device,i=n.get(t.computeProgram).module,a=n.get(t),c=[];for(const u of e){const d=n.get(u),{layoutGPU:f}=d.layout;c.push(f)}a.pipeline=s.createComputePipeline({compute:i,layout:s.createPipelineLayout({bindGroupLayouts:c})})}_getBlending(t){let e,n;const s=t.blending,i=t.blendSrc,a=t.blendDst,c=t.blendEquation;if(s===ud){const u=t.blendSrcAlpha!==null?t.blendSrcAlpha:i,d=t.blendDstAlpha!==null?t.blendDstAlpha:a,f=t.blendEquationAlpha!==null?t.blendEquationAlpha:c;e={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(c)},n={srcFactor:this._getBlendFactor(u),dstFactor:this._getBlendFactor(d),operation:this._getBlendOperation(f)}}else{const u=t.premultipliedAlpha,d=(f,p,g,y)=>{e={srcFactor:f,dstFactor:p,operation:pu.Add},n={srcFactor:g,dstFactor:y,operation:pu.Add}};if(u)switch(s){case mi:d(Pe.One,Pe.OneMinusSrcAlpha,Pe.One,Pe.OneMinusSrcAlpha);break;case Tr:d(Pe.One,Pe.One,Pe.One,Pe.One);break;case od:d(Pe.Zero,Pe.OneMinusSrc,Pe.Zero,Pe.One);break;case ad:d(Pe.Dst,Pe.OneMinusSrcAlpha,Pe.Zero,Pe.One);break}else switch(s){case mi:d(Pe.SrcAlpha,Pe.OneMinusSrcAlpha,Pe.One,Pe.OneMinusSrcAlpha);break;case Tr:d(Pe.SrcAlpha,Pe.One,Pe.One,Pe.One);break;case od:Ht(`WebGPURenderer: "SubtractiveBlending" requires "${t.isMaterial?"material":"blendMode"}.premultipliedAlpha = true".`);break;case ad:Ht(`WebGPURenderer: "MultiplyBlending" requires "${t.isMaterial?"material":"blendMode"}.premultipliedAlpha = true".`);break}}if(e!==void 0&&n!==void 0)return{color:e,alpha:n};Ht("WebGPURenderer: Invalid blending: ",s)}_getBlendFactor(t){let e;switch(t){case lc:e=Pe.Zero;break;case O3:e=Pe.One;break;case F3:e=Pe.Src;break;case U3:e=Pe.OneMinusSrc;break;case Rp:e=Pe.SrcAlpha;break;case Ep:e=Pe.OneMinusSrcAlpha;break;case I3:e=Pe.Dst;break;case V3:e=Pe.OneMinusDst;break;case P3:e=Pe.DstAlpha;break;case z3:e=Pe.OneMinusDstAlpha;break;case G3:e=Pe.SrcAlphaSaturated;break;case wV:e=Pe.Constant;break;case TV:e=Pe.OneMinusConstant;break;default:Ht("WebGPURenderer: Blend factor not supported.",t)}return e}_getStencilCompare(t){let e;const n=t.stencilFunc;switch(n){case uU:e=ei.Never;break;case P2:e=ei.Always;break;case hU:e=ei.Less;break;case fU:e=ei.LessEqual;break;case dU:e=ei.Equal;break;case gU:e=ei.GreaterEqual;break;case pU:e=ei.Greater;break;case mU:e=ei.NotEqual;break;default:Ht("WebGPURenderer: Invalid stencil function.",n)}return e}_getStencilOperation(t){let e;switch(t){case Mu:e=Kl.Keep;break;case sU:e=Kl.Zero;break;case iU:e=Kl.Replace;break;case cU:e=Kl.Invert;break;case rU:e=Kl.IncrementClamp;break;case oU:e=Kl.DecrementClamp;break;case aU:e=Kl.IncrementWrap;break;case lU:e=Kl.DecrementWrap;break;default:Ht("WebGPURenderer: Invalid stencil operation.",e)}return e}_getBlendOperation(t){let e;switch(t){case Xr:e=pu.Add;break;case B3:e=pu.Subtract;break;case L3:e=pu.ReverseSubtract;break;case kF:e=pu.Min;break;case HF:e=pu.Max;break;default:Ht("WebGPUPipelineUtils: Blend equation not supported.",t)}return e}_getPrimitiveState(t,e,n){const s={},i=this.backend.utils;s.topology=i.getPrimitiveTopology(t,n),e.index!==null&&t.isLine===!0&&t.isLineSegments!==!0&&(s.stripIndexFormat=e.index.array instanceof Uint16Array?jy.Uint16:jy.Uint32);let a=n.side===Ss;return t.isMesh&&t.matrixWorld.determinant()<0&&(a=!a),s.frontFace=a===!0?hE.CW:hE.CCW,s.cullMode=n.side===ss?dE.None:dE.Back,s}_getColorWriteMask(t){return t.colorWrite===!0?fE.All:fE.None}_getDepthCompare(t){let e;if(t.depthTest===!1)e=ei.Always;else{const n=this.backend.parameters.reversedDepthBuffer?J3[t.depthFunc]:t.depthFunc;switch(n){case jg:e=ei.Never;break;case Yg:e=ei.Always;break;case Kg:e=ei.Less;break;case bd:e=ei.LessEqual;break;case Zg:e=ei.Equal;break;case Qg:e=ei.GreaterEqual;break;case Jg:e=ei.Greater;break;case ty:e=ei.NotEqual;break;default:Ht("WebGPUPipelineUtils: Invalid depth function.",n)}}return e}}class Mq extends QB{constructor(t,e,n=2048){super(n),this.device=t,this.type=e,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${e}`});const s=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${e}`,size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${e}`,size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(t){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return an(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const e=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(t,e),e}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const t=new Map(this.queryOffsets),e=this.currentQueryIndex,n=e*8;this.currentQueryIndex=0,this.queryOffsets.clear();const s=this.device.createCommandEncoder();s.resolveQuerySet(this.querySet,0,e,this.resolveBuffer,0),s.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const i=s.finish();if(this.device.queue.submit([i]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const a=new BigUint64Array(this.resultBuffer.getMappedRange(0,n)),c={},u=[];for(const[f,p]of t){const g=f.match(/^(.*):f(\d+)$/),y=parseInt(g[2]);u.includes(y)===!1&&u.push(y),c[y]===void 0&&(c[y]=0);const x=a[p],S=a[p+1],T=Number(S-x)/1e6;this.timestamps.set(f,T),c[y]+=T}const d=c[u[u.length-1]];return this.resultBuffer.unmap(),this.lastValue=d,this.frames=u,d}catch(t){return Ht("Error resolving queries:",t),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(t){Ht("Error waiting for pending resolve:",t)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(t){Ht("Error unmapping buffer:",t)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class vq extends ZB{constructor(t={}){super(t),this.isWebGPUBackend=!0,this.parameters.alpha=t.alpha===void 0?!0:t.alpha,this.parameters.requiredLimits=t.requiredLimits===void 0?{}:t.requiredLimits,this.compatibilityMode=null,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new yq(this),this.attributeUtils=new Sq(this),this.bindingUtils=new Tq(this),this.pipelineUtils=new _q(this),this.textureUtils=new oq(this),this.occludedResolveCache=new Map;const e=typeof navigator>"u"?!0:/Android/.test(navigator.userAgent)===!1;this._compatibility={[_c.TEXTURE_COMPARE]:e}}async init(t){await super.init(t);const e=this.parameters;let n;if(e.device===void 0){const s={powerPreference:e.powerPreference,featureLevel:"compatibility"},i=typeof navigator<"u"?await navigator.gpu.requestAdapter(s):null;if(i===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const a=Object.values(fw),c=[];for(const d of a)i.features.has(d)&&c.push(d);const u={requiredFeatures:c,requiredLimits:e.requiredLimits};n=await i.requestDevice(u)}else n=e.device;this.compatibilityMode=!n.features.has("core-features-and-limits"),this.compatibilityMode&&(t._samples=0),n.lost.then(s=>{if(s.reason==="destroyed")return;const i={api:"WebGPU",message:s.message||"Unknown reason",reason:s.reason||null,originalEvent:s};t.onDeviceLost(i)}),this.device=n,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(fw.TimestampQuery),this.updateSize()}get context(){const t=this.renderer.getCanvasTarget(),e=this.get(t);let n=e.context;if(n===void 0){const s=this.parameters;t.isDefaultCanvasTarget===!0&&s.context!==void 0?n=s.context:n=t.domElement.getContext("webgpu"),"setAttribute"in t.domElement&&t.domElement.setAttribute("data-engine",`three.js r${Hp} webgpu`);const i=s.alpha?"premultiplied":"opaque",a=s.outputType===ii?"extended":"standard";n.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:i,toneMapping:{mode:a}}),e.context=n}return n}get coordinateSystem(){return Jr}async getArrayBufferAsync(t){return await this.attributeUtils.getArrayBufferAsync(t)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const t=this.renderer,e=t.getCanvasTarget(),n=this.get(e),s=t.currentSamples;let i=n.descriptor;if(i===void 0||n.samples!==s){i={colorAttachments:[{view:null}]},(t.depth===!0||t.stencil===!0)&&(i.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(t.depth,t.stencil).createView()});const c=i.colorAttachments[0];s>0?c.view=this.textureUtils.getColorBuffer().createView():c.resolveTarget=void 0,n.descriptor=i,n.samples=s}const a=i.colorAttachments[0];return s>0?a.resolveTarget=this.context.getCurrentTexture().createView():a.view=this.context.getCurrentTexture().createView(),i}_isRenderCameraDepthArray(t){return t.depthTexture&&t.depthTexture.image.depth>1&&t.camera.isArrayCamera}_getRenderPassDescriptor(t,e={}){const n=t.renderTarget,s=this.get(n);let i=s.descriptors;(i===void 0||s.width!==n.width||s.height!==n.height||s.samples!==n.samples)&&(i={},s.descriptors=i);const a=t.getCacheKey();let c=i[a];if(c===void 0){const d=t.textures,f=[];let p;const g=this._isRenderCameraDepthArray(t);for(let y=0;y<d.length;y++){const x=this.get(d[y]),S={label:`colorAttachment_${y}`,baseMipLevel:t.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:t.activeCubeFace,arrayLayerCount:1,dimension:fi.TwoD};if(n.isRenderTarget3D)p=t.activeCubeFace,S.baseArrayLayer=0,S.dimension=fi.ThreeD,S.depthOrArrayLayers=d[y].image.depth;else if(n.isRenderTarget&&d[y].image.depth>1)if(g===!0){const T=t.camera.cameras;for(let M=0;M<T.length;M++){const N={...S,baseArrayLayer:M,arrayLayerCount:1,dimension:fi.TwoD},v=x.texture.createView(N);f.push({view:v,resolveTarget:void 0,depthSlice:void 0})}}else S.dimension=fi.TwoDArray,S.depthOrArrayLayers=d[y].image.depth;if(g!==!0){const T=x.texture.createView(S);let M,N;x.msaaTexture!==void 0?(M=x.msaaTexture.createView(),N=T):(M=T,N=void 0),f.push({view:M,resolveTarget:N,depthSlice:p})}}if(c={textureViews:f},t.depth){const y=this.get(t.depthTexture),x={};(t.depthTexture.isArrayTexture||t.depthTexture.isCubeTexture)&&(x.dimension=fi.TwoD,x.arrayLayerCount=1,x.baseArrayLayer=t.activeCubeFace),c.depthStencilView=y.texture.createView(x)}i[a]=c,s.width=n.width,s.height=n.height,s.samples=n.samples,s.activeMipmapLevel=t.activeMipmapLevel,s.activeCubeFace=t.activeCubeFace}const u={colorAttachments:[]};for(let d=0;d<c.textureViews.length;d++){const f=c.textureViews[d];let p={r:0,g:0,b:0,a:1};d===0&&e.clearValue&&(p=e.clearValue),u.colorAttachments.push({view:f.view,depthSlice:f.depthSlice,resolveTarget:f.resolveTarget,loadOp:e.loadOp||rn.Load,storeOp:e.storeOp||Ei.Store,clearValue:p})}return c.depthStencilView&&(u.depthStencilAttachment={view:c.depthStencilView}),u}beginRender(t){const e=this.get(t),n=this.device,s=t.occlusionQueryCount;let i;s>0&&(e.currentOcclusionQuerySet&&e.currentOcclusionQuerySet.destroy(),e.currentOcclusionQueryBuffer&&e.currentOcclusionQueryBuffer.destroy(),e.currentOcclusionQuerySet=e.occlusionQuerySet,e.currentOcclusionQueryBuffer=e.occlusionQueryBuffer,e.currentOcclusionQueryObjects=e.occlusionQueryObjects,i=n.createQuerySet({type:"occlusion",count:s,label:`occlusionQuerySet_${t.id}`}),e.occlusionQuerySet=i,e.occlusionQueryIndex=0,e.occlusionQueryObjects=new Array(s),e.lastOcclusionObject=null);let a;t.textures===null?a=this._getDefaultRenderPassDescriptor():a=this._getRenderPassDescriptor(t,{loadOp:rn.Load}),this.initTimestampQuery(Jo.RENDER,this.getTimestampUID(t),a),a.occlusionQuerySet=i;const c=a.depthStencilAttachment;if(t.textures!==null){const d=a.colorAttachments;for(let f=0;f<d.length;f++){const p=d[f];t.clearColor?(p.clearValue=f===0?t.clearColorValue:{r:0,g:0,b:0,a:1},p.loadOp=rn.Clear):p.loadOp=rn.Load,p.storeOp=Ei.Store}}else{const d=a.colorAttachments[0];t.clearColor?(d.clearValue=t.clearColorValue,d.loadOp=rn.Clear):d.loadOp=rn.Load,d.storeOp=Ei.Store}t.depth&&(t.clearDepth?(c.depthClearValue=t.clearDepthValue,c.depthLoadOp=rn.Clear):c.depthLoadOp=rn.Load,c.depthStoreOp=Ei.Store),t.stencil&&(t.clearStencil?(c.stencilClearValue=t.clearStencilValue,c.stencilLoadOp=rn.Clear):c.stencilLoadOp=rn.Load,c.stencilStoreOp=Ei.Store);const u=n.createCommandEncoder({label:"renderContext_"+t.id});if(this._isRenderCameraDepthArray(t)===!0){const d=t.camera.cameras;!e.layerDescriptors||e.layerDescriptors.length!==d.length?this._createDepthLayerDescriptors(t,e,a,d):this._updateDepthLayerDescriptors(t,e,d),e.bundleEncoders=[],e.bundleSets=[];for(let f=0;f<d.length;f++){const p=this.pipelineUtils.createBundleEncoder(t,"renderBundleArrayCamera_"+f),g={attributes:{},bindingGroups:[],pipeline:null,index:null};e.bundleEncoders.push(p),e.bundleSets.push(g)}e.currentPass=null}else{const d=u.beginRenderPass(a);e.currentPass=d,t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}e.descriptor=a,e.encoder=u,e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.renderBundles=[]}_createDepthLayerDescriptors(t,e,n,s){const i=n.depthStencilAttachment;e.layerDescriptors=[];const a=this.get(t.depthTexture);a.viewCache||(a.viewCache=[]);for(let c=0;c<s.length;c++){const u={...n,colorAttachments:[{...n.colorAttachments[0],view:n.colorAttachments[c].view}]};if(n.depthStencilAttachment){const d=c;a.viewCache[d]||(a.viewCache[d]=a.texture.createView({dimension:fi.TwoD,baseArrayLayer:c,arrayLayerCount:1})),u.depthStencilAttachment={view:a.viewCache[d],depthLoadOp:i.depthLoadOp||rn.Clear,depthStoreOp:i.depthStoreOp||Ei.Store,depthClearValue:i.depthClearValue||1},t.stencil&&(u.depthStencilAttachment.stencilLoadOp=i.stencilLoadOp,u.depthStencilAttachment.stencilStoreOp=i.stencilStoreOp,u.depthStencilAttachment.stencilClearValue=i.stencilClearValue)}else u.depthStencilAttachment={...i};e.layerDescriptors.push(u)}}_updateDepthLayerDescriptors(t,e,n){for(let s=0;s<n.length;s++){const i=e.layerDescriptors[s];if(i.depthStencilAttachment){const a=i.depthStencilAttachment;t.depth&&(t.clearDepth?(a.depthClearValue=t.clearDepthValue,a.depthLoadOp=rn.Clear):a.depthLoadOp=rn.Load),t.stencil&&(t.clearStencil?(a.stencilClearValue=t.clearStencilValue,a.stencilLoadOp=rn.Clear):a.stencilLoadOp=rn.Load)}}}finishRender(t){const e=this.get(t),n=t.occlusionQueryCount;e.renderBundles.length>0&&e.currentPass.executeBundles(e.renderBundles),n>e.occlusionQueryIndex&&e.currentPass.endOcclusionQuery();const s=e.encoder;if(this._isRenderCameraDepthArray(t)===!0){const i=[];for(let a=0;a<e.bundleEncoders.length;a++){const c=e.bundleEncoders[a];i.push(c.finish())}for(let a=0;a<e.layerDescriptors.length;a++)if(a<i.length){const c=e.layerDescriptors[a],u=s.beginRenderPass(c);if(t.viewport){const{x:d,y:f,width:p,height:g,minDepth:y,maxDepth:x}=t.viewportValue;u.setViewport(d,f,p,g,y,x)}if(t.scissor){const{x:d,y:f,width:p,height:g}=t.scissorValue;u.setScissorRect(d,f,p,g)}u.executeBundles([i[a]]),u.end()}}else e.currentPass&&e.currentPass.end();if(n>0){const i=n*8;let a=this.occludedResolveCache.get(i);a===void 0&&(a=this.device.createBuffer({size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(i,a));const c=this.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});e.encoder.resolveQuerySet(e.occlusionQuerySet,0,n,a,0),e.encoder.copyBufferToBuffer(a,0,c,0,i),e.occlusionQueryBuffer=c,this.resolveOccludedAsync(t)}if(this.device.queue.submit([e.encoder.finish()]),t.textures!==null){const i=t.textures;for(let a=0;a<i.length;a++){const c=i[a];c.generateMipmaps===!0&&this.textureUtils.generateMipmaps(c)}}}isOccluded(t,e){const n=this.get(t);return n.occluded&&n.occluded.has(e)}async resolveOccludedAsync(t){const e=this.get(t),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:s}=e;if(n&&s){const i=new WeakSet;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const a=n.getMappedRange(),c=new BigUint64Array(a);for(let u=0;u<s.length;u++)c[u]===BigInt(0)&&i.add(s[u]);n.destroy(),e.occluded=i}}updateViewport(t){const{currentPass:e}=this.get(t),{x:n,y:s,width:i,height:a,minDepth:c,maxDepth:u}=t.viewportValue;e.setViewport(n,s,i,a,c,u)}updateScissor(t){const{currentPass:e}=this.get(t),{x:n,y:s,width:i,height:a}=t.scissorValue;e.setScissorRect(n,s,i,a)}getClearColor(){const t=super.getClearColor();return this.renderer.alpha===!0&&(t.r*=t.a,t.g*=t.a,t.b*=t.a),t}clear(t,e,n,s=null){const i=this.device,a=this.renderer;let c=[],u,d,f,p;if(t){const x=this.getClearColor();d={r:x.r,g:x.g,b:x.b,a:x.a}}if(s===null){f=a.depth,p=a.stencil;const x=this._getDefaultRenderPassDescriptor();if(t){c=x.colorAttachments;const S=c[0];S.clearValue=d,S.loadOp=rn.Clear,S.storeOp=Ei.Store}(f||p)&&(u=x.depthStencilAttachment)}else{f=s.depth,p=s.stencil;const x={loadOp:t?rn.Clear:rn.Load,clearValue:t?d:void 0};f&&(x.depthLoadOp=e?rn.Clear:rn.Load,x.depthClearValue=e?a.getClearDepth():void 0,x.depthStoreOp=Ei.Store),p&&(x.stencilLoadOp=n?rn.Clear:rn.Load,x.stencilClearValue=n?a.getClearStencil():void 0,x.stencilStoreOp=Ei.Store);const S=this._getRenderPassDescriptor(s,x);c=S.colorAttachments,u=S.depthStencilAttachment}f&&u&&(e?(u.depthLoadOp=rn.Clear,u.depthClearValue=a.getClearDepth(),u.depthStoreOp=Ei.Store):(u.depthLoadOp=rn.Load,u.depthStoreOp=Ei.Store)),p&&u&&(n?(u.stencilLoadOp=rn.Clear,u.stencilClearValue=a.getClearStencil(),u.stencilStoreOp=Ei.Store):(u.stencilLoadOp=rn.Load,u.stencilStoreOp=Ei.Store));const g=i.createCommandEncoder({label:"clear"});g.beginRenderPass({colorAttachments:c,depthStencilAttachment:u}).end(),i.queue.submit([g.finish()])}beginCompute(t){const e=this.get(t),n={label:"computeGroup_"+t.id};this.initTimestampQuery(Jo.COMPUTE,this.getTimestampUID(t),n),e.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+t.id}),e.passEncoderGPU=e.cmdEncoderGPU.beginComputePass(n)}compute(t,e,n,s,i=null){const a=this.get(e),{passEncoderGPU:c}=this.get(t),u=this.get(s).pipeline;this.pipelineUtils.setPipeline(c,u);for(let d=0,f=n.length;d<f;d++){const p=n[d],g=this.get(p);c.setBindGroup(d,g.group)}if(i===null&&(i=e.count),i&&typeof i=="object"&&i.isIndirectStorageBufferAttribute){const d=this.get(i).buffer;c.dispatchWorkgroupsIndirect(d,0);return}if(typeof i=="number"){const d=i;if(a.dispatchSize===void 0||a.count!==d){a.dispatchSize=[0,1,1],a.count=d;const f=e.workgroupSize;let p=f[0];for(let x=1;x<f.length;x++)p*=f[x];const g=Math.ceil(d/p),y=this.device.limits.maxComputeWorkgroupsPerDimension;i=[g,1,1],g>y&&(i[0]=Math.min(g,y),i[1]=Math.ceil(g/y)),a.dispatchSize=i}i=a.dispatchSize}c.dispatchWorkgroups(i[0],i[1]||1,i[2]||1)}finishCompute(t){const e=this.get(t);e.passEncoderGPU.end(),this.device.queue.submit([e.cmdEncoderGPU.finish()])}draw(t,e){const{object:n,material:s,context:i,pipeline:a}=t,c=t.getBindings(),u=this.get(i),d=this.get(a),f=d.pipeline;if(d.error===!0)return;const p=t.getIndex(),g=p!==null,y=t.getDrawParameters();if(y===null)return;const x=(T,M)=>{this.pipelineUtils.setPipeline(T,f),M.pipeline=f;const N=M.bindingGroups;for(let A=0,R=c.length;A<R;A++){const L=c[A],D=this.get(L);N[L.index]!==L.id&&(T.setBindGroup(L.index,D.group),N[L.index]=L.id)}if(g===!0&&M.index!==p){const A=this.get(p).buffer,R=p.array instanceof Uint16Array?jy.Uint16:jy.Uint32;T.setIndexBuffer(A,R),M.index=p}const v=t.getVertexBuffers();for(let A=0,R=v.length;A<R;A++){const L=v[A];if(M.attributes[A]!==L){const D=this.get(L).buffer;T.setVertexBuffer(A,D),M.attributes[A]=L}}i.stencil===!0&&s.stencilWrite===!0&&u.currentStencilRef!==s.stencilRef&&(T.setStencilReference(s.stencilRef),u.currentStencilRef=s.stencilRef)},S=(T,M)=>{if(x(T,M),n.isBatchedMesh===!0){const N=n._multiDrawStarts,v=n._multiDrawCounts,A=n._multiDrawCount,R=n._multiDrawInstances;R!==null&&an("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");let L=g===!0?p.array.BYTES_PER_ELEMENT:1;s.wireframe&&(L=n.geometry.attributes.position.count>65535?4:2);for(let D=0;D<A;D++){const U=R?R[D]:1,B=U>1?0:D;g===!0?T.drawIndexed(v[D],U,N[D]/L,0,B):T.draw(v[D],U,N[D],B),e.update(n,v[D],U)}}else if(g===!0){const{vertexCount:N,instanceCount:v,firstVertex:A}=y,R=t.getIndirect();if(R!==null){const L=this.get(R).buffer,D=t.getIndirectOffset(),U=Array.isArray(D)?D:[D];for(let B=0;B<U.length;B++)T.drawIndexedIndirect(L,U[B])}else T.drawIndexed(N,v,A,0,0);e.update(n,N,v)}else{const{vertexCount:N,instanceCount:v,firstVertex:A}=y,R=t.getIndirect();if(R!==null){const L=this.get(R).buffer,D=t.getIndirectOffset(),U=Array.isArray(D)?D:[D];for(let B=0;B<U.length;B++)T.drawIndirect(L,U[B])}else T.draw(N,v,A,0);e.update(n,N,v)}};if(t.camera.isArrayCamera&&t.camera.cameras.length>0){const T=this.get(t.camera),M=t.camera.cameras,N=t.getBindingGroup("cameraIndex");if(T.indexesGPU===void 0||T.indexesGPU.length!==M.length){const A=this.get(N),R=[],L=new Uint32Array([0,0,0,0]);for(let D=0,U=M.length;D<U;D++){L[0]=D;const{layoutGPU:B}=A.layout,P=this.bindingUtils.createBindGroupIndex(L,B);R.push(P)}T.indexesGPU=R}const v=this.renderer.getPixelRatio();for(let A=0,R=M.length;A<R;A++){const L=M[A];if(n.layers.test(L.layers)){const D=L.viewport;let U=u.currentPass,B=u.currentSets;if(u.bundleEncoders){const P=u.bundleEncoders[A],J=u.bundleSets[A];U=P,B=J}D&&U.setViewport(Math.floor(D.x*v),Math.floor(D.y*v),Math.floor(D.width*v),Math.floor(D.height*v),i.viewportValue.minDepth,i.viewportValue.maxDepth),N&&T.indexesGPU&&(U.setBindGroup(N.index,T.indexesGPU[A]),B.bindingGroups[N.index]=N.id),S(U,B)}}}else if(u.currentPass){if(u.occlusionQuerySet!==void 0){const T=u.lastOcclusionObject;T!==n&&(T!==null&&T.occlusionTest===!0&&(u.currentPass.endOcclusionQuery(),u.occlusionQueryIndex++),n.occlusionTest===!0&&(u.currentPass.beginOcclusionQuery(u.occlusionQueryIndex),u.occlusionQueryObjects[u.occlusionQueryIndex]=n),u.lastOcclusionObject=n)}S(u.currentPass,u.currentSets)}}needsRenderUpdate(t){const e=this.get(t),{object:n,material:s}=t,i=this.utils,a=i.getSampleCountRenderContext(t.context),c=i.getCurrentColorSpace(t.context),u=i.getCurrentColorFormat(t.context),d=i.getCurrentDepthStencilFormat(t.context),f=i.getPrimitiveTopology(n,s);let p=!1;return(e.material!==s||e.materialVersion!==s.version||e.transparent!==s.transparent||e.blending!==s.blending||e.premultipliedAlpha!==s.premultipliedAlpha||e.blendSrc!==s.blendSrc||e.blendDst!==s.blendDst||e.blendEquation!==s.blendEquation||e.blendSrcAlpha!==s.blendSrcAlpha||e.blendDstAlpha!==s.blendDstAlpha||e.blendEquationAlpha!==s.blendEquationAlpha||e.colorWrite!==s.colorWrite||e.depthWrite!==s.depthWrite||e.depthTest!==s.depthTest||e.depthFunc!==s.depthFunc||e.stencilWrite!==s.stencilWrite||e.stencilFunc!==s.stencilFunc||e.stencilFail!==s.stencilFail||e.stencilZFail!==s.stencilZFail||e.stencilZPass!==s.stencilZPass||e.stencilFuncMask!==s.stencilFuncMask||e.stencilWriteMask!==s.stencilWriteMask||e.side!==s.side||e.alphaToCoverage!==s.alphaToCoverage||e.sampleCount!==a||e.colorSpace!==c||e.colorFormat!==u||e.depthStencilFormat!==d||e.primitiveTopology!==f||e.clippingContextCacheKey!==t.clippingContextCacheKey)&&(e.material=s,e.materialVersion=s.version,e.transparent=s.transparent,e.blending=s.blending,e.premultipliedAlpha=s.premultipliedAlpha,e.blendSrc=s.blendSrc,e.blendDst=s.blendDst,e.blendEquation=s.blendEquation,e.blendSrcAlpha=s.blendSrcAlpha,e.blendDstAlpha=s.blendDstAlpha,e.blendEquationAlpha=s.blendEquationAlpha,e.colorWrite=s.colorWrite,e.depthWrite=s.depthWrite,e.depthTest=s.depthTest,e.depthFunc=s.depthFunc,e.stencilWrite=s.stencilWrite,e.stencilFunc=s.stencilFunc,e.stencilFail=s.stencilFail,e.stencilZFail=s.stencilZFail,e.stencilZPass=s.stencilZPass,e.stencilFuncMask=s.stencilFuncMask,e.stencilWriteMask=s.stencilWriteMask,e.side=s.side,e.alphaToCoverage=s.alphaToCoverage,e.sampleCount=a,e.colorSpace=c,e.colorFormat=u,e.depthStencilFormat=d,e.primitiveTopology=f,e.clippingContextCacheKey=t.clippingContextCacheKey,p=!0),p}getRenderCacheKey(t){const{object:e,material:n}=t,s=this.utils,i=t.context,a=e.isMesh&&e.matrixWorld.determinant()<0;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,a,s.getSampleCountRenderContext(i),s.getCurrentColorSpace(i),s.getCurrentColorFormat(i),s.getCurrentDepthStencilFormat(i),s.getPrimitiveTopology(e,n),t.getGeometryCacheKey(),t.clippingContextCacheKey].join()}updateSampler(t){return this.textureUtils.updateSampler(t)}createDefaultTexture(t){return this.textureUtils.createDefaultTexture(t)}createTexture(t,e){this.textureUtils.createTexture(t,e)}updateTexture(t,e){this.textureUtils.updateTexture(t,e)}generateMipmaps(t){this.textureUtils.generateMipmaps(t)}destroyTexture(t,e=!1){this.textureUtils.destroyTexture(t,e)}async copyTextureToBuffer(t,e,n,s,i,a){return this.textureUtils.copyTextureToBuffer(t,e,n,s,i,a)}initTimestampQuery(t,e,n){if(!this.trackTimestamp)return;this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new Mq(this.device,t,2048));const s=this.timestampQueryPool[t],i=s.allocateQueriesForContext(e);n.timestampWrites={querySet:s.querySet,beginningOfPassWriteIndex:i,endOfPassWriteIndex:i+1}}createNodeBuilder(t,e){return new gq(t,e)}createProgram(t){const e=this.get(t);e.module={module:this.device.createShaderModule({code:t.code,label:t.stage+(t.name!==""?`_${t.name}`:"")}),entryPoint:"main"}}destroyProgram(t){this.delete(t)}createRenderPipeline(t,e){this.pipelineUtils.createRenderPipeline(t,e)}createComputePipeline(t,e){this.pipelineUtils.createComputePipeline(t,e)}beginBundle(t){const e=this.get(t);e._currentPass=e.currentPass,e._currentSets=e.currentSets,e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.currentPass=this.pipelineUtils.createBundleEncoder(t)}finishBundle(t,e){const n=this.get(t),i=n.currentPass.finish();this.get(e).bundleGPU=i,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(t,e){this.get(t).renderBundles.push(this.get(e).bundleGPU)}createBindings(t,e,n,s){this.bindingUtils.createBindings(t,e,n,s)}updateBindings(t,e,n,s){this.bindingUtils.createBindings(t,e,n,s)}updateBinding(t){this.bindingUtils.updateBinding(t)}deleteBindGroupData(t){this.bindingUtils.deleteBindGroupData(t)}createIndexAttribute(t){let e=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute)&&(e|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(t,e)}createAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(t){this.attributeUtils.updateAttribute(t)}destroyAttribute(t){this.attributeUtils.destroyAttribute(t)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(t){return gE[t]!==void 0&&(t=gE[t]),this.device.features.has(t)}copyTextureToTexture(t,e,n=null,s=null,i=0,a=0){let c=0,u=0,d=0,f=0,p=0,g=0,y=t.image.width,x=t.image.height,S=1;n!==null&&(n.isBox3===!0?(f=n.min.x,p=n.min.y,g=n.min.z,y=n.max.x-n.min.x,x=n.max.y-n.min.y,S=n.max.z-n.min.z):(f=n.min.x,p=n.min.y,y=n.max.x-n.min.x,x=n.max.y-n.min.y,S=1)),s!==null&&(c=s.x,u=s.y,d=s.z||0);const T=this.device.createCommandEncoder({label:"copyTextureToTexture_"+t.id+"_"+e.id}),M=this.get(t).texture,N=this.get(e).texture;T.copyTextureToTexture({texture:M,mipLevel:i,origin:{x:f,y:p,z:g}},{texture:N,mipLevel:a,origin:{x:c,y:u,z:d}},[y,x,S]),this.device.queue.submit([T.finish()]),a===0&&e.generateMipmaps&&this.textureUtils.generateMipmaps(e)}copyFramebufferToTexture(t,e,n){const s=this.get(e);let i=null;e.renderTarget?t.isDepthTexture?i=this.get(e.depthTexture).texture:i=this.get(e.textures[0]).texture:t.isDepthTexture?i=this.textureUtils.getDepthBuffer(e.depth,e.stencil):i=this.context.getCurrentTexture();const a=this.get(t).texture;if(i.format!==a.format){Ht("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",i.format,a.format);return}let c;if(s.currentPass?(s.currentPass.end(),c=s.encoder):c=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+t.id}),c.copyTextureToTexture({texture:i,origin:[n.x,n.y,0]},{texture:a},[n.z,n.w]),t.generateMipmaps&&this.textureUtils.generateMipmaps(t,c),s.currentPass){const{descriptor:u}=s;for(let d=0;d<u.colorAttachments.length;d++)u.colorAttachments[d].loadOp=rn.Load;e.depth&&(u.depthStencilAttachment.depthLoadOp=rn.Load),e.stencil&&(u.depthStencilAttachment.stencilLoadOp=rn.Load),s.currentPass=c.beginRenderPass(u),s.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}else this.device.queue.submit([c.finish()])}hasCompatibility(t){return this._compatibility[_c.TEXTURE_COMPARE]!==void 0?this._compatibility[_c.TEXTURE_COMPARE]:super.hasCompatibility(t)}dispose(){if(this.bindingUtils.dispose(),this.textureUtils.dispose(),this.occludedResolveCache){for(const t of this.occludedResolveCache.values())t.destroy();this.occludedResolveCache.clear()}if(this.timestampQueryPool)for(const t of Object.values(this.timestampQueryPool))t!==null&&t.dispose();this.parameters.device===void 0&&this.device!==null&&this.device.destroy()}}class Aq extends ux{constructor(t,e,n,s,i,a){super(t,e,n,s,i,a),this.iesMap=null}copy(t,e){return super.copy(t,e),this.iesMap=t.iesMap,this}}class Nq extends ux{constructor(t,e,n,s,i,a){super(t,e,n,s,i,a),this.aspect=null}copy(t,e){return super.copy(t,e),this.aspect=t.aspect,this}}class Rq extends HB{constructor(){super(),this.addMaterial(uI,"MeshPhongMaterial"),this.addMaterial(Xs,"MeshStandardMaterial"),this.addMaterial(tV,"MeshPhysicalMaterial"),this.addMaterial(iV,"MeshToonMaterial"),this.addMaterial(Bc,"MeshBasicMaterial"),this.addMaterial(lI,"MeshLambertMaterial"),this.addMaterial(J6,"MeshNormalMaterial"),this.addMaterial(oV,"MeshMatcapMaterial"),this.addMaterial(Y6,"LineBasicMaterial"),this.addMaterial(Z6,"LineDashedMaterial"),this.addMaterial(hV,"PointsMaterial"),this.addMaterial(VD,"SpriteMaterial"),this.addMaterial(mV,"ShadowMaterial"),this.addLight($9,hs),this.addLight(iW,wi),this.addLight(uW,Q8),this.addLight(S_,ux),this.addLight(sW,Co),this.addLight(rW,$p),this.addLight(aW,tP),this.addLight(oW,Aq),this.addLight(cW,Nq),this.addToneMapping(oB,$F),this.addToneMapping(aB,XF),this.addToneMapping(lB,jF),this.addToneMapping(cB,Mw),this.addToneMapping(uB,YF),this.addToneMapping(hB,KF)}}class Eq extends DW{constructor(t={}){let e;t.forceWebGL?e=uE:(e=vq,t.getFallback=()=>(Wt("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new uE(t)));const n=new e(t);super(n,t),this.library=new Rq,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}const yg=Math.PI/2-.01,wE=new V(0,1,0),p2=new V,TE=new V,jf=new tr(0,0,0,"YXZ");class Cq{constructor(t,e,n={}){this.camera=t,this.domElement=e,this.movementSpeed=n.movementSpeed??9,this.lookSensitivity=n.lookSensitivity??.0023,this.activeKeys=new Set,this.yaw=0,this.pitch=0,this.moveForward=0,this.moveStrafe=0,this.moveVertical=0,this.handleClick=this.handleClick.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handlePointerLockChange=this.handlePointerLockChange.bind(this),this.handleWindowBlur=this.handleWindowBlur.bind(this),this.syncAnglesFromCamera(),this.domElement.addEventListener("click",this.handleClick),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp),document.addEventListener("pointerlockchange",this.handlePointerLockChange),window.addEventListener("blur",this.handleWindowBlur)}isPointerLocked(){return document.pointerLockElement===this.domElement}syncAnglesFromCamera(){jf.setFromQuaternion(this.camera.quaternion,"YXZ"),this.pitch=jf.x,this.yaw=jf.y}handleClick(){this.isPointerLocked()||this.domElement.requestPointerLock()}handleMouseMove(t){this.isPointerLocked()&&(this.yaw-=t.movementX*this.lookSensitivity,this.pitch-=t.movementY*this.lookSensitivity,this.pitch>yg&&(this.pitch=yg),this.pitch<-yg&&(this.pitch=-yg),jf.set(this.pitch,this.yaw,0),this.camera.quaternion.setFromEuler(jf))}handleKeyDown(t){this.isPointerLocked()&&this.activeKeys.add(t.code)}handleKeyUp(t){this.isPointerLocked()&&this.activeKeys.delete(t.code)}handlePointerLockChange(){this.isPointerLocked()?this.syncAnglesFromCamera():this.activeKeys.clear()}handleWindowBlur(){this.activeKeys.clear()}update(t){if(!this.isPointerLocked()){this.activeKeys.clear();return}if(this.moveForward=0,this.moveStrafe=0,this.moveVertical=0,this.activeKeys.has("KeyW")&&(this.moveForward+=1),this.activeKeys.has("KeyS")&&(this.moveForward-=1),this.activeKeys.has("KeyA")&&(this.moveStrafe-=1),this.activeKeys.has("KeyD")&&(this.moveStrafe+=1),this.activeKeys.has("Space")&&(this.moveVertical+=1),(this.activeKeys.has("ShiftLeft")||this.activeKeys.has("ShiftRight"))&&(this.moveVertical-=1),this.moveForward===0&&this.moveStrafe===0&&this.moveVertical===0)return;this.camera.getWorldDirection(p2).normalize(),TE.crossVectors(p2,wE).normalize();const e=this.movementSpeed*t;this.moveForward!==0&&this.camera.position.addScaledVector(p2,this.moveForward*e),this.moveStrafe!==0&&this.camera.position.addScaledVector(TE,this.moveStrafe*e),this.moveVertical!==0&&this.camera.position.addScaledVector(wE,this.moveVertical*e)}dispose(){this.domElement.removeEventListener("click",this.handleClick),window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp),document.removeEventListener("pointerlockchange",this.handlePointerLockChange),window.removeEventListener("blur",this.handleWindowBlur)}}function _E(r){for(const t of Object.keys(r)){const e=r[t];e&&typeof e=="object"&&e.isTexture&&e.dispose()}typeof r.dispose=="function"&&r.dispose()}function Fi(r){r.traverse(t=>{if(t.geometry&&typeof t.geometry.dispose=="function"&&t.geometry.dispose(),t.material)if(Array.isArray(t.material))for(const e of t.material)_E(e);else _E(t.material)}),r.parent&&r.parent.remove(r)}function Dq(r){const t=[...r.children];for(const e of t)Fi(e)}class Bq{constructor({manifest:t,root:e,scene:n,camera:s,renderer:i}){this.manifest=t,this.root=e,this.scene=n,this.camera=s,this.renderer=i,this.activeSceneIndex=-1,this.activeSceneInstance=null}getContext(){return{camera:this.camera,renderer:this.renderer,root:this.root,scene:this.scene}}async load(t){if(t<0||t>=this.manifest.length)throw new Error(`Scene index out of range: ${t}`);this.unloadCurrent();const n=this.manifest[t].create();this.activeSceneInstance=n,this.activeSceneIndex=t,typeof n.init=="function"&&await n.init(this.getContext())}async goTo(t){return t===this.activeSceneIndex?!1:(await this.load(t),!0)}update(t,e){!this.activeSceneInstance||typeof this.activeSceneInstance.update!="function"||this.activeSceneInstance.update({...this.getContext(),delta:t,elapsed:e})}resize(t,e){!this.activeSceneInstance||typeof this.activeSceneInstance.resize!="function"||this.activeSceneInstance.resize({...this.getContext(),height:e,width:t})}hasNext(){return this.activeSceneIndex<this.manifest.length-1}hasPrevious(){return this.activeSceneIndex>0}async next(){return this.hasNext()?(await this.load(this.activeSceneIndex+1),!0):!1}async previous(){return this.hasPrevious()?(await this.load(this.activeSceneIndex-1),!0):!1}getSceneList(){return this.manifest.map((t,e)=>({id:t.id,index:e,title:t.title}))}getCurrentSceneInfo(){if(this.activeSceneIndex<0)return null;const t=this.manifest[this.activeSceneIndex];return{id:t.id,index:this.activeSceneIndex,title:t.title,total:this.manifest.length}}unloadCurrent(){this.activeSceneInstance&&typeof this.activeSceneInstance.dispose=="function"&&this.activeSceneInstance.dispose(this.getContext()),this.activeSceneInstance=null,this.activeSceneIndex=-1,Dq(this.root)}dispose(){this.unloadCurrent()}}_.BRDF_GGX;_.BRDF_Lambert;_.BasicPointShadowFilter;_.BasicShadowFilter;const Lq=_.Break;_.Const;_.Continue;_.DFGLUT;_.D_GGX;_.Discard;_.EPSILON;_.F_Schlick;const _n=_.Fn;_.INFINITY;const Lu=_.If,ma=_.Loop;_.NodeAccess;_.NodeShaderStage;_.NodeType;_.NodeUpdateType;_.PCFShadowFilter;_.PCFSoftShadowFilter;_.PI;_.PI2;_.TWO_PI;_.HALF_PI;_.PointShadowFilter;_.Return;_.Schlick_to_F0;_.ShaderNode;_.Stack;_.Switch;_.TBNViewMatrix;_.VSMShadowFilter;_.V_GGX_SmithCorrelated;_.Var;_.VarIntent;const oi=_.abs;_.acesFilmicToneMapping;const ME=_.acos,Xo=_.add;_.addMethodChaining;_.addNodeElement;_.agxToneMapping;_.all;_.alphaT;_.and;_.anisotropy;_.anisotropyB;_.anisotropyT;_.any;_.append;_.array;_.arrayBuffer;_.asin;_.assign;_.atan;_.atomicAdd;_.atomicAnd;_.atomicFunc;_.atomicLoad;_.atomicMax;_.atomicMin;_.atomicOr;_.atomicStore;_.atomicSub;_.atomicXor;_.attenuationColor;_.attenuationDistance;_.attribute;_.attributeArray;_.backgroundBlurriness;_.backgroundIntensity;_.backgroundRotation;_.batch;_.bentNormalView;_.billboarding;_.bitAnd;_.bitNot;_.bitOr;_.bitXor;_.bitangentGeometry;_.bitangentLocal;_.bitangentView;_.bitangentWorld;_.bitcast;_.blendBurn;_.blendColor;_.blendDodge;_.blendOverlay;_.blendScreen;_.blur;_.bool;_.buffer;_.bufferAttribute;_.bumpMap;_.builtin;_.builtinAOContext;_.builtinShadowContext;_.bvec2;_.bvec3;_.bvec4;_.bypass;_.cache;_.call;_.cameraFar;_.cameraIndex;_.cameraNear;_.cameraNormalMatrix;const ir=_.cameraPosition;_.cameraProjectionMatrix;_.cameraProjectionMatrixInverse;_.cameraViewMatrix;_.cameraViewport;_.cameraWorldMatrix;_.cbrt;_.cdl;_.ceil;_.checker;_.cineonToneMapping;const wr=_.clamp;_.clearcoat;_.clearcoatNormalView;_.clearcoatRoughness;_.clipSpace;_.code;const Ke=_.color;_.colorSpaceToWorking;_.colorToDirection;_.compute;_.computeKernel;_.computeSkinning;_.context;_.convert;_.convertColorSpace;_.convertToTexture;_.countLeadingZeros;_.countOneBits;_.countTrailingZeros;const Yo=_.cos,xg=_.cross;_.cubeTexture;_.cubeTextureBase;_.dFdx;_.dFdy;_.dashSize;_.debug;_.decrement;_.decrementBefore;_.defaultBuildStages;_.defaultShaderStages;_.defined;_.degrees;_.deltaTime;_.densityFog;_.densityFogFactor;_.depth;_.depthPass;_.determinant;_.difference;_.diffuseColor;_.directPointLight;_.directionToColor;_.directionToFaceDirection;_.dispersion;_.distance;_.div;const xe=_.dot;_.drawIndex;_.dynamicBufferAttribute;_.element;_.emissive;_.equal;const Oq=_.equirectUV,En=_.exp;_.exp2;_.exponentialHeightFogFactor;_.expression;const Fq=_.faceDirection;_.faceForward;_.faceforward;const k=_.float;_.floatBitsToInt;_.floatBitsToUint;const eL=_.floor;_.fog;const si=_.fract;_.frameGroup;_.frameId;const T_=_.frontFacing;_.fwidth;_.gain;_.gapSize;_.getConstNodeType;_.getCurrentStack;_.getDirection;_.getDistanceAttenuation;_.getGeometryRoughness;_.getNormalFromDepth;_.interleavedGradientNoise;_.vogelDiskSample;_.getParallaxCorrectNormal;_.getRoughness;_.getScreenPosition;_.getShIrradianceAt;_.getShadowMaterial;_.getShadowRenderObjectFunction;_.getTextureIndex;_.getViewPosition;_.globalId;_.glsl;_.glslFn;_.grayscale;_.greaterThan;_.greaterThanEqual;_.hash;_.highpModelNormalViewMatrix;_.highpModelViewMatrix;_.hue;_.increment;_.incrementBefore;_.instance;_.instanceIndex;_.instancedArray;_.instancedBufferAttribute;_.instancedDynamicBufferAttribute;_.instancedMesh;_.int;_.intBitsToFloat;_.inverse;_.inverseSqrt;_.inversesqrt;_.invocationLocalIndex;_.invocationSubgroupIndex;_.ior;_.iridescence;_.iridescenceIOR;_.iridescenceThickness;_.ivec2;_.ivec3;_.ivec4;_.js;_.label;const Ao=_.length;_.lengthSq;_.lessThan;_.lessThanEqual;_.lightPosition;_.lightProjectionUV;_.lightShadowMatrix;_.lightTargetDirection;_.lightTargetPosition;_.lightViewPosition;_.lightingContext;_.lights;_.linearDepth;_.linearToneMapping;_.localId;_.log;_.log2;_.logarithmicDepthToViewZ;_.luminance;_.mat2;const Uq=_.mat3;_.mat4;_.matcapUV;_.materialAO;_.materialAlphaTest;_.materialAnisotropy;_.materialAnisotropyVector;_.materialAttenuationColor;_.materialAttenuationDistance;_.materialClearcoat;_.materialClearcoatNormal;_.materialClearcoatRoughness;_.materialColor;_.materialDispersion;_.materialEmissive;_.materialEnvIntensity;_.materialEnvRotation;_.materialIOR;_.materialIridescence;_.materialIridescenceIOR;_.materialIridescenceThickness;_.materialLightMap;_.materialLineDashOffset;_.materialLineDashSize;_.materialLineGapSize;_.materialLineScale;_.materialLineWidth;_.materialMetalness;_.materialNormal;_.materialOpacity;_.materialPointSize;_.materialReference;_.materialReflectivity;_.materialRefractionRatio;_.materialRotation;_.materialRoughness;_.materialSheen;_.materialSheenRoughness;_.materialShininess;_.materialSpecular;_.materialSpecularColor;_.materialSpecularIntensity;_.materialSpecularStrength;_.materialThickness;_.materialTransmission;const le=_.max;_.maxMipLevel;_.mediumpModelViewMatrix;_.metalness;const __=_.min,Zt=_.mix;_.mixElement;_.mod;_.modInt;_.modelDirection;_.modelNormalMatrix;_.modelPosition;_.modelRadius;_.modelScale;_.modelViewMatrix;_.modelViewPosition;const Pq=_.modelViewProjection,zq=_.modelWorldMatrix;_.modelWorldMatrixInverse;_.morphReference;_.mrt;const Ko=_.mul;_.mx_aastep;_.mx_add;_.mx_atan2;_.mx_cell_noise_float;_.mx_contrast;_.mx_divide;const Yf=_.mx_fractal_noise_float;_.mx_fractal_noise_vec2;_.mx_fractal_noise_vec3;_.mx_fractal_noise_vec4;_.mx_frame;_.mx_heighttonormal;_.mx_hsvtorgb;_.mx_ifequal;_.mx_ifgreater;_.mx_ifgreatereq;_.mx_invert;_.mx_modulo;_.mx_multiply;const hi=_.mx_noise_float;_.mx_noise_vec3;_.mx_noise_vec4;_.mx_place2d;_.mx_power;_.mx_ramp4;_.mx_ramplr;_.mx_ramptb;_.mx_rgbtohsv;_.mx_rotate2d;_.mx_rotate3d;_.mx_safepower;_.mx_separate;_.mx_splitlr;_.mx_splittb;_.mx_srgb_texture_to_lin_rec709;_.mx_subtract;_.mx_timer;_.mx_transform_uv;_.mx_unifiednoise2d;_.mx_unifiednoise3d;_.mx_worley_noise_float;_.mx_worley_noise_vec2;_.mx_worley_noise_vec3;_.negate;_.neutralToneMapping;_.nodeArray;_.nodeImmutable;_.nodeObject;_.nodeObjectIntent;_.nodeObjects;_.nodeProxy;_.nodeProxyIntent;_.normalFlat;_.normalGeometry;const op=_.normalLocal;_.normalMap;_.normalView;_.normalViewGeometry;const Iq=_.normalWorld;_.normalWorldGeometry;const Cn=_.normalize;_.not;_.notEqual;_.numWorkgroups;_.objectDirection;_.objectGroup;_.objectPosition;_.objectRadius;_.objectScale;_.objectViewPosition;_.objectWorldMatrix;_.OnBeforeObjectUpdate;_.OnBeforeMaterialUpdate;_.OnObjectUpdate;_.OnMaterialUpdate;_.oneMinus;_.or;_.orthographicDepthToViewZ;_.oscSawtooth;_.oscSine;_.oscSquare;_.oscTriangle;_.output;_.outputStruct;_.overloadingFn;_.packHalf2x16;_.packSnorm2x16;_.packUnorm2x16;_.parabola;_.parallaxDirection;_.parallaxUV;_.parameter;_.pass;_.passTexture;_.pcurve;_.perspectiveDepthToViewZ;_.pmremTexture;_.pointShadow;_.pointUV;_.pointWidth;const Vq=_.positionGeometry,ji=_.positionLocal;_.positionPrevious;_.positionView;_.positionViewDirection;const kc=_.positionWorld;_.positionWorldDirection;_.posterize;const zn=_.pow;_.pow2;_.pow3;_.pow4;_.premultiplyAlpha;_.property;_.radians;_.rand;_.range;_.rangeFog;_.rangeFogFactor;_.reciprocal;_.reference;_.referenceBuffer;const Gq=_.reflect;_.reflectVector;_.reflectView;_.reflector;_.refract;_.refractVector;_.refractView;_.reinhardToneMapping;_.remap;const vE=_.remapClamp;_.renderGroup;_.renderOutput;_.rendererReference;_.replaceDefaultUV;_.rotate;_.rotateUV;_.roughness;_.round;_.rtt;_.sRGBTransferEOTF;_.sRGBTransferOETF;_.sample;_.sampler;_.samplerComparison;_.saturate;_.saturation;_.screen;_.screenCoordinate;_.screenDPR;_.screenSize;_.screenUV;_.select;_.setCurrentStack;_.setName;_.shaderStages;_.shadow;_.shadowPositionWorld;_.shapeCircle;_.sharedUniformGroup;_.sheen;_.sheenRoughness;_.shiftLeft;_.shiftRight;_.shininess;_.sign;const $i=_.sin;_.sinc;_.skinning;const ln=_.smoothstep;_.smoothstepElement;_.specularColor;_.specularF90;_.spherizeUV;_.split;_.spritesheetUV;const Mr=_.sqrt;_.stack;const me=_.step;_.stepElement;_.storage;_.storageBarrier;_.storageTexture;_.string;_.struct;const el=_.sub;_.subgroupAdd;_.subgroupAll;_.subgroupAnd;_.subgroupAny;_.subgroupBallot;_.subgroupBroadcast;_.subgroupBroadcastFirst;_.subBuild;_.subgroupElect;_.subgroupExclusiveAdd;_.subgroupExclusiveMul;_.subgroupInclusiveAdd;_.subgroupInclusiveMul;_.subgroupIndex;_.subgroupMax;_.subgroupMin;_.subgroupMul;_.subgroupOr;_.subgroupShuffle;_.subgroupShuffleDown;_.subgroupShuffleUp;_.subgroupShuffleXor;_.subgroupSize;_.subgroupXor;_.tan;_.tangentGeometry;_.tangentLocal;_.tangentView;_.tangentWorld;const Np=_.texture;_.texture3D;_.textureBarrier;_.textureBicubic;_.textureBicubicLevel;_.textureCubeUV;_.textureLoad;_.textureSize;_.textureLevel;_.textureStore;_.thickness;const Rc=_.time;_.toneMapping;_.toneMappingExposure;_.toonOutlinePass;_.transformDirection;_.transformNormal;_.transformNormalToView;_.transformedClearcoatNormalView;_.transformedNormalView;_.transformedNormalWorld;_.transmission;_.transpose;_.triNoise3D;_.triplanarTexture;_.triplanarTextures;_.trunc;_.uint;_.uintBitsToFloat;const he=_.uniform;_.uniformArray;_.uniformCubeTexture;_.uniformGroup;_.uniformFlow;_.uniformTexture;_.unpackHalf2x16;_.unpackSnorm2x16;_.unpackUnorm2x16;_.unpremultiplyAlpha;_.userData;const kq=_.uv;_.uvec2;_.uvec3;_.uvec4;const Hq=_.varying,bg=_.varyingProperty,dn=_.vec2,Dt=_.vec3,zu=_.vec4;_.vectorComponents;_.velocity;_.vertexColor;_.vertexIndex;_.vertexStage;_.vibrance;_.viewZToLogarithmicDepth;_.viewZToOrthographicDepth;_.viewZToPerspectiveDepth;_.viewZToReversedOrthographicDepth;_.viewZToReversedPerspectiveDepth;_.viewport;_.viewportCoordinate;_.viewportDepthTexture;_.viewportLinearDepth;_.viewportMipTexture;_.viewportOpaqueMipTexture;_.viewportResolution;_.viewportSafeUV;_.viewportSharedTexture;_.viewportSize;_.viewportTexture;_.viewportUV;_.wgsl;_.wgslFn;_.workgroupArray;_.workgroupBarrier;_.workgroupId;_.workingToColorSpace;_.xor;class nL extends C{constructor(){const t=new Xn;super(new X(1,1,1),t),this.turbidity=he(2),this.rayleigh=he(1),this.mieCoefficient=he(.005),this.mieDirectionalG=he(.8),this.sunPosition=he(new V),this.upUniform=he(new V(0,1,0)),this.cloudScale=he(2e-4),this.cloudSpeed=he(1e-4),this.cloudCoverage=he(.4),this.cloudDensity=he(.4),this.cloudElevation=he(.5),this.isSky=!0,this.isSkyMesh=!0;const e=bg("vec3"),n=bg("float"),s=bg("vec3"),i=bg("vec3"),a=_n(()=>{const u=k(2.718281828459045),d=Dt(5804542996261093e-21,13562911419845635e-21,30265902468824876e-21),f=Dt(18399918514433978e-2,27798023919660528e-2,40790479543861094e-2),p=k(1.6110731556870734),g=k(1.5),y=k(1e3),x=Cn(this.sunPosition);e.assign(x);const S=xe(x,this.upUniform),T=wr(S,-1,1),M=y.mul(le(0,k(1).sub(zn(u,p.sub(ME(T)).div(g).negate()))));n.assign(M);const N=k(1).sub(wr(k(1).sub(En(this.sunPosition.y.div(45e4))),0,1)),v=this.rayleigh.sub(k(1).mul(k(1).sub(N)));s.assign(d.mul(v));const A=k(.2).mul(this.turbidity).mul(1e-17),R=k(.434).mul(A).mul(f);i.assign(R.mul(this.mieCoefficient));const L=Pq;return L.z.assign(L.w),L})(),c=_n(()=>{const u=k(3.141592653589793),d=k(8400),f=k(1250),p=k(.9999566769464484),g=k(.05968310365946075),y=k(.07957747154594767),x=Cn(kc.sub(ir)),S=ME(le(0,xe(this.upUniform,x))),T=k(1).div(Yo(S).add(k(.15).mul(zn(k(93.885).sub(S.mul(180).div(u)),-1.253)))),M=d.mul(T),N=f.mul(T),v=En(Ko(s,M).add(Ko(i,N)).negate()),A=xe(x,e),R=A.mul(.5).add(.5),L=g.mul(k(1).add(zn(R,2))),D=s.mul(L),U=zn(this.mieDirectionalG,2),B=k(1).div(zn(k(1).sub(k(2).mul(this.mieDirectionalG).mul(A)).add(U),1.5)),P=y.mul(k(1).sub(U)).mul(B),J=i.mul(P),q=zn(n.mul(Xo(D,J).div(Xo(s,i))).mul(el(1,v)),Dt(1.5));q.mulAssign(Zt(Dt(1),zn(n.mul(Xo(D,J).div(Xo(s,i))).mul(v),Dt(1/2)),wr(zn(el(1,xe(this.upUniform,e)),5),0,1)));const ft=Dt(.1).mul(v),Mt=ln(p,p.add(2e-5),A);ft.addAssign(n.mul(19e3).mul(v).mul(Mt));const mt=Xo(q,ft).mul(.04).add(Dt(0,3e-4,75e-5)).toVar(),F=_n(([lt])=>si($i(xe(lt,dn(127.1,311.7))).mul(43758.5453123))),Y=_n(([lt])=>{const Tt=dn(lt).toVar(),O=eL(Tt),et=si(Tt),z=et.mul(et).mul(el(3,et.mul(2))),W=F(O),yt=F(Xo(O,dn(1,0))),K=F(Xo(O,dn(0,1))),Z=F(Xo(O,dn(1,1)));return Zt(Zt(W,yt,z.x),Zt(K,Z,z.x),z.y)}),tt=_n(([lt])=>{const Tt=dn(lt).toVar(),O=k(0).toVar(),et=k(.5).toVar();return ma(5,()=>{O.addAssign(et.mul(Y(Tt))),Tt.mulAssign(2),et.mulAssign(.5)}),O});return Lu(x.y.greaterThan(0).and(this.cloudCoverage.greaterThan(0)),()=>{const lt=Zt(1,.1,this.cloudElevation),Tt=x.xz.div(x.y.mul(lt)).toVar();Tt.mulAssign(this.cloudScale),Tt.addAssign(Rc.mul(this.cloudSpeed));const O=tt(Tt.mul(1e3)).add(tt(Tt.mul(2e3).add(3.7)).mul(.5)).toVar();O.assign(O.mul(.5).add(.5));const et=ln(el(1,this.cloudCoverage),el(1,this.cloudCoverage).add(.3),O).toVar(),z=ln(0,Xo(.1,Ko(.2,this.cloudElevation)),x.y);et.mulAssign(z);const W=xe(x,e).mul(.5).add(.5),yt=le(0,e.y.mul(2)),K=q.mul(.04),Z=Zt(Dt(.3),Dt(1),yt).toVar();Z.assign(Zt(Z,K.add(Dt(1)),W.mul(.5))),Z.mulAssign(n.mul(2e-5)),mt.assign(Zt(mt,Z,et.mul(this.cloudDensity)))}),zu(mt,1)})();t.side=Ss,t.depthWrite=!1,t.vertexNode=a,t.colorNode=c}}const AE="cooper-farmhouse-intro",Wq="Cooper Farmhouse and Cornfield Intro",Yy=Math.PI*2,qq=.7,$q=5.9,Xq=-196,jq=28,Zl=new On,Qh=new V,m2=new V,Kf=new V;function Yq(r){let t=r>>>0;return()=>(t=1664525*t+1013904223>>>0,t/4294967296)}function Kq(r,t){const e=Math.sin(t*.055)*1.55,n=Math.max(0,1-Math.abs(t+84)/290),s=Math.exp(-Math.pow((r-e)/8.1,2))*.34*n,i=Math.sin((r+28)*.024)*.68+Math.cos((t-36)*.019)*.54,a=Math.sin((r-170)*.0048)*.34+Math.cos((t+120)*.0052)*.32,c=Math.sin((r*.9+t*.24)*.14)*.1;return i+a+c-s-.45}function Zq(r,t){if(t<Xq||t>jq)return-1/0;const e=Math.sin(t*.055)*1.55,n=r-e;if(Math.abs(n)>$q)return-1/0;const s=Math.cos(n*.7)*.06,i=Math.exp(-Math.pow((Math.abs(n)-2.05)/.55,2))*-.045;return .08+s+i}function NE(r){if(!r)return;const t=r.position.x,e=r.position.z,n=Kq(t,e),s=Zq(t,e),a=Math.max(n,s)+qq;r.position.y<a&&(r.position.y=a,r.updateMatrixWorld())}function sL(r,t){const e=document.createElement("canvas");e.width=r,e.height=r;const n=e.getContext("2d");if(!n)throw new Error("Could not create canvas context for procedural scene texture.");t(n,r);const s=new Ti(e);return s.colorSpace=bn,s.generateMipmaps=!0,s.minFilter=sa,s.magFilter=$s,s.wrapS=Fn,s.wrapT=Fn,s.needsUpdate=!0,s}function Qq(r){const t=sL(512,(e,n)=>{e.fillStyle="#8f7652",e.fillRect(0,0,n,n);for(let s=0;s<42e3;s+=1){const i=Math.floor(r()*n),a=Math.floor(r()*n),c=92+Math.floor(r()*58),u=.03+r()*.13;e.fillStyle=`rgba(${c}, ${66+Math.floor(r()*24)}, ${42+Math.floor(r()*20)}, ${u})`,e.fillRect(i,a,1,1)}e.globalAlpha=.16,e.strokeStyle="#705737",e.lineWidth=1;for(let s=0;s<120;s+=1){const i=s/120*n;e.beginPath(),e.moveTo(0,i+Math.sin(s*.53)*5.5),e.bezierCurveTo(n*.24,i+7,n*.62,i-7,n,i+Math.cos(s*.7)*6),e.stroke()}e.globalAlpha=1});return t.repeat.set(86,86),t}function Jq(r){const t=sL(512,(e,n)=>{e.fillStyle="#7a5f43",e.fillRect(0,0,n,n);for(let s=0;s<28e3;s+=1){const i=Math.floor(r()*n),a=Math.floor(r()*n),c=84+Math.floor(r()*44),u=.05+r()*.15;e.fillStyle=`rgba(${c}, ${56+Math.floor(r()*18)}, ${38+Math.floor(r()*16)}, ${u})`,e.fillRect(i,a,1,1)}e.fillStyle="rgba(62, 48, 36, 0.5)",e.fillRect(n*.29,0,n*.11,n),e.fillRect(n*.61,0,n*.11,n),e.strokeStyle="rgba(188, 153, 108, 0.3)",e.lineWidth=2;for(let s=0;s<35;s+=1){const i=s/35*n;e.beginPath(),e.moveTo(n*.22,i),e.lineTo(n*.76,i+(r()-.5)*8),e.stroke()}});return t.repeat.set(1,8),t}const ap=Object.freeze({timeOfDay:15,turbidity:10,rayleigh:2,mieCoefficient:.005,mieDirectionalG:.8});function iL(){const r=ap.timeOfDay/24*Math.PI*2,t=Math.max(-.05,Math.sin(r-Math.PI/2)),e=St.clamp((t+.05)/1.05,0,1),n=St.lerp(Math.PI*.51,Math.PI*.02,e),s=r+Math.PI*.35,i=new V().setFromSphericalCoords(1,n,s).normalize();return{mix:e,sunDirection:i}}function t$(){const r=new vt,t=new nL;t.scale.setScalar(1e5),r.add(t);const{mix:e,sunDirection:n}=iL();t.turbidity.value=ap.turbidity,t.rayleigh.value=ap.rayleigh,t.mieCoefficient.value=ap.mieCoefficient,t.mieDirectionalG.value=ap.mieDirectionalG,t.sunPosition.value.copy(n);const s=new C(new We(120,32,16),new xn({color:16777215}));s.position.copy(n).multiplyScalar(5e4);const i=St.lerp(0,1,e);return s.visible=i>.02,r.add(s),r}function e$(){const r=new vt,{mix:t,sunDirection:e}=iL(),n=new wi(16777215,6);n.position.copy(e).multiplyScalar(200),n.target.position.set(0,0,0),n.target.updateMatrixWorld();const s=new Xt(16765347),i=new Xt(16777215);n.color.copy(s).lerp(i,t),n.intensity=St.lerp(.5,7,Math.pow(t,.7));const a=new Co(16777215,.03);return r.add(n,n.target,a),r}function n$(r){const t=new vt,e=Qq(r),n=Jq(r),s=new ns(1800,1800,220,220);s.rotateX(-Math.PI/2);const i=s.attributes.position;for(let f=0;f<i.count;f+=1){const p=i.getX(f),g=i.getZ(f),y=Math.sin(g*.055)*1.55,x=Math.max(0,1-Math.abs(g+84)/290),S=Math.exp(-Math.pow((p-y)/8.1,2))*.34*x,T=Math.sin((p+28)*.024)*.68+Math.cos((g-36)*.019)*.54,M=Math.sin((p-170)*.0048)*.34+Math.cos((g+120)*.0052)*.32,N=Math.sin((p*.9+g*.24)*.14)*.1,v=(r()-.5)*.1;i.setY(f,T+M+N+v-S-.45)}i.needsUpdate=!0,s.computeVertexNormals();const a=new C(s,new bt({color:9402965,map:e,metalness:.03,roughness:.96}));t.add(a);const c=new ns(11.8,224,18,180);c.rotateX(-Math.PI/2),c.translate(0,.08,-84);const u=c.attributes.position;for(let f=0;f<u.count;f+=1){const p=u.getZ(f),g=u.getX(f),y=Math.sin(p*.055)*1.55,x=Math.cos(g*.7)*.06,S=Math.exp(-Math.pow((Math.abs(g)-2.05)/.55,2))*-.045;u.setX(f,g+y),u.setY(f,u.getY(f)+x+S)}u.needsUpdate=!0,c.computeVertexNormals();const d=new C(c,new bt({color:7691844,map:n,metalness:.01,roughness:.97}));t.add(d);for(const f of[-1,1]){const p=new ns(2.3,224,3,180);p.rotateX(-Math.PI/2),p.translate(f*6.75,.04,-84);const g=p.attributes.position;for(let x=0;x<g.count;x+=1){const S=g.getZ(x),T=g.getX(x),M=Math.sin(S*.055)*1.55,N=Math.cos((T+f*3)*2.1)*.03;g.setX(x,T+M),g.setY(x,g.getY(x)+N)}g.needsUpdate=!0,p.computeVertexNormals();const y=new C(p,new bt({color:8283464,metalness:.01,roughness:.95}));t.add(y)}return t}function s$(){const r=new vt,t=new bt({color:6639932,metalness:.04,roughness:.9}),e=new xn({color:2893345,depthWrite:!1,fog:!0,transparent:!0,opacity:.8}),n=[];for(let s=4;s>-180;s-=19){const i=12+Math.sin(s*.04)*.8,a=new C(new qt(.19,.27,9.4,8),t);a.position.set(i,4.75,s),r.add(a);const c=new C(new X(2.5,.14,.14),t);c.position.set(i,8.3,s),r.add(c);for(const u of[-.9,0,.9]){const d=new C(new We(.08,10,10),new bt({color:9867402,metalness:.03,roughness:.76}));d.position.set(i+u,8.2,s),r.add(d)}n.push(new V(i,8.3,s))}for(let s=0;s<3;s+=1){const i=-.82+s*.82,a=n.map((u,d)=>{const f=n.length>1?d/(n.length-1):0;return new V(u.x+i,u.y-.32-s*.12-Math.sin(f*Math.PI)*.42,u.z)}),c=new C(new Gw(new aC(a),Math.max(a.length*8,24),.026,6,!1),e);r.add(c)}return r}function Sg(r,t){const e=new C(new X(t.width,t.height,.1),t.frameMaterial);e.position.set(t.x,t.y,t.z),e.rotation.y=t.rotationY??0,r.add(e);const n=new C(new ns(t.width*.74,t.height*.68),t.paneMaterial);n.position.set(t.x+Math.sin(t.rotationY??0)*.055,t.y,t.z+Math.cos(t.rotationY??0)*.055),n.rotation.y=t.rotationY??0,r.add(n)}function i$(r){const t=new vt;t.position.set(-30,0,-72),t.scale.setScalar(1.08);const e=new bt({color:13814203,metalness:.02,roughness:.88}),n=new bt({color:7889998,metalness:.02,roughness:.86}),s=new bt({color:7101004,metalness:.04,roughness:.93}),i=new bt({color:10135731,emissive:7228722,emissiveIntensity:.08,metalness:0,roughness:.38,transparent:!0,opacity:.84}),a=new bt({color:8350030,metalness:.01,roughness:.91}),c=new C(new X(14,.75,10.5),n);c.position.y=.35,t.add(c);const u=new C(new X(12.5,4.9,9.6),e);u.position.y=2.95,t.add(u);const d=new C(new X(9.1,3.8,8.2),e);d.position.y=6.8,t.add(d);const f=new C(new X(7,.34,10.4),s);f.position.set(-3,8.7,0),f.rotation.z=.62,t.add(f);const p=new C(new X(7,.34,10.4),s);p.position.set(2.5,8.7,0),p.rotation.z=-.62,t.add(p);const g=new C(new X(.36,.3,10.1),n);g.position.set(-.25,10.4,0),t.add(g);for(const tt of[-1,1]){const lt=new C(new X(.18,.2,10.5),n);lt.position.set(tt*3.65,8.08,0),t.add(lt)}const y=new C(new X(5.6,.22,3.1),a);y.position.set(0,.62,6.15),t.add(y);const x=new C(new X(6.4,.22,3.5),e);x.position.set(0,3.6,6.15),t.add(x);for(let tt=-2;tt<=2;tt+=1){const lt=new C(new X(.2,2.9,.2),n);lt.position.set(tt*1.2,2.05,7.15),t.add(lt)}for(let tt=-2;tt<=1;tt+=1){const lt=new C(new X(1.02,.11,.1),n);lt.position.set(tt*1.2+.6,1.24,7.15),t.add(lt)}const S=new C(new X(1.35,2.4,.12),n);S.position.set(0,1.85,4.95),t.add(S);const T=new C(new X(.96,1.86,.08),e);T.position.set(0,1.84,5.02),t.add(T);const M=new C(new X(2.4,.42,1.4),a);M.position.set(0,.3,7.1),t.add(M);const N=[-4.1,-2.25,2.25,4.1];for(const tt of N)Sg(t,{frameMaterial:n,height:1.45,paneMaterial:i,width:1.1,x:tt,y:3,z:4.95});const v=[-2.45,0,2.45];for(const tt of v)Sg(t,{frameMaterial:n,height:1.3,paneMaterial:i,width:1.02,x:tt,y:6.7,z:4.2});const A=[2.4,5.6];for(const tt of A)Sg(t,{frameMaterial:n,height:1.35,paneMaterial:i,rotationY:Math.PI/2,width:1.05,x:6.25,y:tt,z:-1.2}),Sg(t,{frameMaterial:n,height:1.35,paneMaterial:i,rotationY:-Math.PI/2,width:1.05,x:-6.25,y:tt,z:1.1});const R=new C(new X(1.05,3,1.05),n);R.position.set(3.2,9.3,-2.6),t.add(R);const L=new vt;L.position.set(14,0,-6);const D=new C(new X(11.8,7.3,10.4),new bt({color:9133893,metalness:.02,roughness:.91}));D.position.y=3.75,L.add(D);const U=new C(new X(6.6,.35,11.2),s);U.position.set(-2.7,8.3,0),U.rotation.z=.58,L.add(U);const B=new C(new X(6.6,.35,11.2),s);B.position.set(2.6,8.3,0),B.rotation.z=-.58,L.add(B);const P=new C(new X(3.1,3.9,.2),n);P.position.set(0,2.05,5.2),L.add(P);const J=new C(new X(3.5,.24,.22),n);J.position.set(0,4.25,5.18),L.add(J),t.add(L);const q=new vt;q.position.set(21,0,-8.8);const ft=new C(new qt(1.8,2.1,10.6,14),new bt({color:10193526,metalness:.05,roughness:.87}));ft.position.y=5.4,q.add(ft);const Mt=new C(new gi(2.2,2.2,14),new bt({color:7626828,metalness:.04,roughness:.86}));Mt.position.y=11.8,q.add(Mt),t.add(q);const mt=new bt({color:7363911,metalness:.01,roughness:.93});for(let tt=0;tt<22;tt+=1){const lt=new C(new X(.18,1.3,.18),mt);if(lt.position.set(-16+tt*2,.65,11.5+Math.sin(tt*.36)*.35),t.add(lt),tt<21){const Tt=new C(new X(1.85,.12,.1),mt);Tt.position.set(-15.05+tt*2,1.02,11.5+Math.sin(tt*.36+.18)*.35),t.add(Tt)}}const F=new C(new X(.14,1.2,.14),mt);F.position.set(-8.4,.61,9.4),t.add(F);const Y=new C(new X(.66,.42,.45),new bt({color:4404779,metalness:.16,roughness:.62}));return Y.position.set(-8.1,1.16,9.4),t.add(Y),t.rotation.y=-.08+(r()-.5)*.03,t}function r$(r,t=null){const e=new vt,n=[],i=1/Math.sqrt(4),a=520,c=560;for(let q=a;q>=-a;){const Mt=(3.5+Math.min(1,Math.abs(q)/a)*3.1)*i,mt=Math.round(Math.abs(q)*1.2)%2===0?0:1;for(let F=-a;F<=a;){const Y=Math.min(1,Math.hypot(F,q)/a),tt=(2.9+Y*3.6)*i,lt=(r()-.5)*(.62+Y*1.25)+mt,Tt=(r()-.5)*(.52+Y*1.05),O=F+lt,et=q+Tt;if(Math.hypot(O,et)>c){F+=tt;continue}if(et>86&&Math.abs(O)<330){F+=tt;continue}const W=Math.sin(et*.055)*1.55,yt=Math.max(0,1-Math.abs(et+84)/290),K=(7+Math.max(0,5.2-Math.abs(et+72)*.036))*yt;if(yt>.001&&Math.abs(O-W)<K){F+=tt;continue}if(O>-40&&O<44&&et>-95&&et<-40){F+=tt;continue}const H=1-Y*.68;if(r()>H){F+=tt;continue}n.push({amp:.06+r()*.11,height:.9+r()*.75,lean:(r()-.5)*.08,phase:r()*Yy,x:O,yaw:r()*Yy,z:et}),F+=tt}q-=Mt}const u=104,d=new Map;for(const q of n){const ft=Math.floor(q.x/u),Mt=Math.floor(q.z/u),mt=`${ft}|${Mt}`;d.has(mt)||d.set(mt,[]),d.get(mt).push(q)}const f=new qt(.03,.06,2.2,7);f.translate(0,1.1,0);const p=new X(1.05,.05,.14);p.rotateZ(.58),p.translate(.33,1.02,0);const g=new X(.92,.045,.12);g.rotateZ(-.52),g.translate(-.3,1.34,0);const y=new gi(.08,.34,6);y.translate(0,2.22,0);const x=new bt({color:9082944,metalness:.01,roughness:.92,vertexColors:!0}),S=new bt({color:10267467,metalness:.01,roughness:.9,vertexColors:!0}),T=new bt({color:11508311,metalness:.01,roughness:.88,vertexColors:!0}),M=[],N=new Xt,v=new Xt,A=new Xt;for(const q of d.values()){let ft=0,Mt=0;for(const ct of q)ft+=ct.x,Mt+=ct.z;ft/=q.length,Mt/=q.length;const mt=Math.hypot(ft,Mt);let F=1;mt>470?F=5:mt>390?F=4:mt>310?F=3:mt>230&&(F=2);const Y=F===1?q:q.filter((ct,xt)=>xt%F===0),tt=Y.length;if(tt===0)continue;const lt=mt<320,Tt=mt<240,O=new vt,et=new yc(f,x,tt),z=lt?new yc(p,S,tt):null,W=lt?new yc(g,S,tt):null,yt=Tt?new yc(y,T,tt):null;et.frustumCulled=!1,z&&(z.frustumCulled=!1),W&&(W.frustumCulled=!1),yt&&(yt.frustumCulled=!1);let K=0,Z=0;for(let ct=0;ct<tt;ct+=1){const xt=Y[ct];K+=xt.x,Z+=xt.z,N.setHSL(.17+r()*.05,.44,.34+r()*.11),v.copy(N).offsetHSL(-.01,.06,.04),A.copy(N).offsetHSL(-.03,-.1,.2),et.setColorAt(ct,N),z&&z.setColorAt(ct,v),W&&W.setColorAt(ct,v),yt&&yt.setColorAt(ct,A)}et.instanceColor&&(et.instanceColor.needsUpdate=!0),z&&z.instanceColor&&(z.instanceColor.needsUpdate=!0),W&&W.instanceColor&&(W.instanceColor.needsUpdate=!0),yt&&yt.instanceColor&&(yt.instanceColor.needsUpdate=!0),K/=tt,Z/=tt;const H=new V(K,2.2,Z);let j=16;for(let ct=0;ct<tt;ct+=1){const xt=Y[ct],at=xt.x-H.x,ut=xt.z-H.z;j=Math.max(j,Math.hypot(at,ut)+4.5)}O.add(et),z&&O.add(z),W&&O.add(W),yt&&O.add(yt),e.add(O),M.push({bounds:new Fc(H.clone(),j),center:H,group:O,leafLower:W,leafUpper:z,lodStride:F,plants:Y,stalks:et,tassels:yt})}const R=new ax,L=new ve,D=330*330,U=36100;let B=0;const P=(q,ft,Mt,mt,F)=>{const Y=q.plants.length;for(let tt=0;tt<Y;tt+=1){const lt=q.plants[tt],Tt=Math.sin(ft*1.9+lt.phase+lt.z*.04+lt.x*.03)*.36,O=(Mt+mt+F+Tt)*lt.amp;Zl.position.set(lt.x,0,lt.z),Zl.rotation.set(O*.4,lt.yaw+O*.28,O+lt.lean),Zl.scale.set(1,lt.height,1),Zl.updateMatrix(),q.stalks.setMatrixAt(tt,Zl.matrix),q.leafUpper&&q.leafUpper.setMatrixAt(tt,Zl.matrix),q.leafLower&&q.leafLower.setMatrixAt(tt,Zl.matrix),q.tassels&&q.tassels.setMatrixAt(tt,Zl.matrix)}q.stalks.instanceMatrix.needsUpdate=!0,q.leafUpper&&(q.leafUpper.instanceMatrix.needsUpdate=!0),q.leafLower&&(q.leafLower.instanceMatrix.needsUpdate=!0),q.tassels&&(q.tassels.instanceMatrix.needsUpdate=!0)},J=(q,ft)=>{const Mt=Math.sin(q*.42)*.78,mt=Math.sin(q*1.06+.6)*.34,F=Math.sin(q*.19+1.7)*.22,Y=!!(ft&&B%4===0);B+=1,Y&&ft&&(L.multiplyMatrices(ft.projectionMatrix,ft.matrixWorldInverse),R.setFromProjectionMatrix(L));for(const tt of M){if(Y&&ft){const lt=tt.center.x-ft.position.x,Tt=tt.center.z-ft.position.z,O=lt*lt+Tt*Tt,et=O<=D,z=O<=U;tt.group.visible=et&&R.intersectsSphere(tt.bounds),tt.leafUpper&&(tt.leafUpper.visible=z),tt.leafLower&&(tt.leafLower.visible=z),tt.tassels&&(tt.tassels.visible=z)}tt.group.visible&&P(tt,q,Mt,mt,F)}};return J(0,t),{group:e,update:J}}function o$(r){const e=new Array(940),n=new Float32Array(940*3),s=new Qe;for(let c=0;c<940;c+=1)e[c]={baseX:-130+r()*260,baseY:.3+r()*22,baseZ:-206+r()*236,phase:r(),speed:.03+r()*.11,swirl:.4+r()*1.1};s.setAttribute("position",new fs(n,3));const i=new to(s,new er({color:13611142,depthWrite:!1,opacity:.28,size:.7,sizeAttenuation:!0,transparent:!0})),a=c=>{const u=s.attributes.position,d=Math.sin(c*.21)*11;for(let f=0;f<940;f+=1){const p=e[f],g=f*3,y=(c*p.speed+p.phase)%1*260-130;n[g]=p.baseX+y*.14+d+Math.sin(c*.4+p.phase*Yy)*2.4,n[g+1]=p.baseY+Math.sin(c*(.62+p.swirl*.18)+p.phase*11)*(.3+p.swirl*.2),n[g+2]=p.baseZ+Math.cos(c*(.39+p.swirl*.1)+p.phase*9)*(1+p.swirl)}u.needsUpdate=!0};return a(0),{points:i,update:a}}function a$(r){const t=new vt,e=new vt,n=new vt,s=[],i=.42,a=new bt({color:7034439,metalness:.1,roughness:.7}),c=new bt({color:2762017,metalness:.24,roughness:.58}),u=new bt({color:10137018,metalness:0,roughness:.25,transparent:!0,opacity:.7}),d=new bt({color:1775896,metalness:.03,roughness:.86}),f=new bt({color:9407880,metalness:.55,roughness:.28});e.add(n);const p=new C(new X(4.15,.42,1.84),c);p.position.y=.68,n.add(p);const g=new C(new X(2.15,.88,1.82),a);g.position.set(-1.05,1.1,0),n.add(g);const y=new C(new X(1.75,1.16,1.52),a);y.position.set(1.12,1.28,0),n.add(y);const x=new C(new X(1.28,.58,1.42),a);x.position.set(2.02,1.08,0),n.add(x);const S=new C(new X(1.35,.18,1.24),a);S.position.set(1.16,1.92,0),n.add(S);const T=new C(new ns(1.26,.74),u);T.position.set(1.84,1.45,0),T.rotation.y=Math.PI/2,n.add(T);for(const F of[-1,1]){const Y=new C(new ns(.62,.52),u);Y.position.set(1.08,1.52,F*.77),Y.rotation.y=F*Math.PI*.5,n.add(Y)}const M=new C(new X(.16,.28,1.86),c);M.position.set(2.72,.68,0),n.add(M);const N=new C(new X(.2,.28,1.86),c);N.position.set(-2.14,.68,0),n.add(N);const v=new C(new X(.08,.42,1.2),new bt({color:6511958,metalness:.47,roughness:.33}));v.position.set(2.66,1.12,0),n.add(v);for(const F of[-1,1]){const Y=new C(new X(.08,.16,.28),new bt({color:13086857,emissive:9137984,emissiveIntensity:.1,roughness:.4,metalness:.1}));Y.position.set(2.71,1.06,F*.58),n.add(Y)}const A=new C(new X(2.18,.12,.14),c);A.position.set(-1.06,1.58,.88),n.add(A);const R=A.clone();R.position.z=-.88,n.add(R);const L=new qt(i,i,.34,20);L.rotateX(Math.PI/2);const D=new qt(.2,.2,.35,18);D.rotateX(Math.PI/2);const U=[[-1.22,.42,-.93],[-1.22,.42,.93],[1.46,.42,-.93],[1.46,.42,.93]];for(const[F,Y,tt]of U){const lt=new vt;lt.position.set(F,Y,tt),n.add(lt);const Tt=new C(L,d);lt.add(Tt);const O=new C(D,f);lt.add(O);const et=new C(new qt(.06,.06,.38,10),new bt({color:7366752,metalness:.45,roughness:.42}));et.rotation.x=Math.PI/2,lt.add(et),s.push(lt)}t.add(e);const B=320,P=new Array(B),J=new Float32Array(B*3),q=new Qe;for(let F=0;F<B;F+=1)P[F]={lateral:(r()-.5)*3.8,rise:1.2+r()*1.8,seed:r(),speed:.7+r()*.95};q.setAttribute("position",new fs(J,3));const ft=new to(q,new er({color:12951925,depthWrite:!1,opacity:.34,size:.98,sizeAttenuation:!0,transparent:!0}));t.add(ft);let Mt=0;const mt=(F,Y)=>{const lt=-82+Math.sin(F*.23)*92,Tt=Math.cos(F*.23)*21.16,O=Math.sin(lt*.055)*1.55,et=Math.cos(lt*.055)*.08525,z=Math.sin(F*.8)*.26,W=Math.cos(F*.8)*.208,yt=O+z,K=et*Tt+W,Z=.44+Math.sin(F*10.2)*.03+Math.cos(F*2.3)*.015,j=Math.atan2(Tt,K)+Math.PI;e.position.set(yt,Z,lt),e.rotation.y=j,n.rotation.x=Math.sin(F*11.3)*.012,n.rotation.z=Math.sin(F*7.2)*.018;const ct=Math.hypot(K,Tt);Mt-=ct/i*Y;for(const at of s)at.rotation.z=Mt;Qh.set(Math.cos(j),0,Math.sin(j)),m2.set(-Qh.z,0,Qh.x),Kf.copy(e.position).addScaledVector(Qh,-2.75),Kf.y=e.position.y+.08;const xt=q.attributes.position;for(let at=0;at<B;at+=1){const ut=P[at],$=(F*(.75+ut.speed*.48)+ut.seed*2.6)%1,nt=1.2+$*(8.2+ut.speed*3.7),ht=ut.lateral*(.45+$*1.8),dt=at*3;J[dt]=Kf.x-Qh.x*nt+m2.x*ht,J[dt+1]=Kf.y+$*ut.rise+Math.sin(F*4.4+ut.seed*Yy)*.14,J[dt+2]=Kf.z-Qh.z*nt+m2.z*ht}xt.needsUpdate=!0};return mt(0,0),{group:t,update:mt}}const l$={id:AE,title:Wq,create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null;return{init({root:c,camera:u,scene:d}){r=c,e=d.background,n=d.fog,d.background=new Xt(13812392),d.fog=new qp(12955789,34,272),t=new vt,t.name=`${AE}-group`,c.add(t);const f=Yq(114721);t.add(e$()),t.add(t$()),t.add(n$(f)),t.add(s$()),t.add(i$(f)),s=r$(f,u),t.add(s.group),i=a$(f),t.add(i.group),a=o$(f),t.add(a.points),u.position.set(-40,5.1,-30),u.lookAt(-4,4.2,-78),NE(u)},update({delta:c,elapsed:u,camera:d}){t&&(NE(d),s&&s.update(u,d),i&&i.update(u,c),a&&a.update(u))},resize(){},dispose({scene:c}){t&&(c.background=e,c.fog=n,r&&t.parent!==r&&r.add(t),Fi(t),r=null,t=null,e=null,n=null,s=null,i=null,a=null)}}}},c$=.75;function u$(r,t){return Math.sin(r*.015+t*.01)*.5+Math.sin(r*.04)*.15+Math.cos(t*.03)*.2}function RE(r){if(!r)return;const e=u$(r.position.x,r.position.z)+c$;r.position.y<e&&(r.position.y=e,r.updateMatrixWorld())}const h$={id:"cornfield-drone-chase",title:"Cornfield Drone Chase",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,g=null,y=null,x=null;const S=[],T=300;let M=0;const N=.04,v=4e5,A=220,R=220,L=-30,D=25,U=D*D,B=[],P=[],J=18,q=.025;return{init({root:Z,scene:H,camera:j}){r=new vt,r.name="cornfield-drone-group",Z.add(r),t=H.background,e=H.fog,H.background=new Xt(6991574),H.fog=new qp(11061469,30,260),j.position.set(20,10,60),j.lookAt(0,2,-20),RE(j),F(),Y(),tt(),lt(),Tt(),O(),et(),z()},update({delta:Z,elapsed:H,camera:j}){if(!r)return;RE(j);const ct=M;M=(M+N*Z)%1,M<ct&&ft();const xt=W(M),at=W(M+.002),ut=K(at,xt),$=Math.atan2(ut.x,ut.z);if(n){const nt=Math.sin(H*14)*.06+Math.sin(H*9.3)*.04;n.position.set(xt.x,.55+nt,xt.z),n.rotation.y=$+Math.PI,n.userData.wheels?.forEach(ht=>{ht.rotation.x+=Z*28})}if(s){const nt=(M+q)%1,ht=W(nt),dt=W(nt+.002),pt=K(dt,ht);s.position.set(ht.x+Math.sin(H*.6)*2.5,J+Math.sin(H*.9)*1.2,ht.z+Math.cos(H*.45)*1.5),s.rotation.y=Math.atan2(pt.x,pt.z)+Math.PI,s.rotation.z=Math.sin(H*1.1)*.04,s.rotation.x=Math.sin(H*.7)*.02}if(i&&Mt(xt,Z,H),f&&mt(xt,$,Z),d){const nt=d.geometry.attributes.position.array,ht=d.userData.count;for(let dt=0;dt<ht;dt++){const pt=dt*3;nt[pt]+=Math.sin(H*.25+dt*1.3)*Z*.5,nt[pt+1]+=Math.sin(H*.4+dt*.9)*Z*.12,nt[pt+2]+=Math.cos(H*.18+dt*.6)*Z*.4}d.geometry.attributes.position.needsUpdate=!0}},resize(){},dispose({scene:Z}){Z&&(Z.background=t,Z.fog=e),r&&Fi(r),r=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,g=null,y=null,x=null}};function ft(){const Z=new On;for(let H=0;H<v;H++){if(P[H]===0)continue;P[H]=0;const j=B[H];Z.position.set(j.x,j.y,j.z),Z.rotation.set(0,j.ry,0),Z.scale.set(j.sx,j.sy,j.sx),Z.updateMatrix(),i.setMatrixAt(H,Z.matrix),a&&a.setMatrixAt(H,Z.matrix),c&&c.setMatrixAt(H,Z.matrix),u&&u.setMatrixAt(H,Z.matrix)}i&&(i.instanceMatrix.needsUpdate=!0),a&&(a.instanceMatrix.needsUpdate=!0),c&&(c.instanceMatrix.needsUpdate=!0),u&&(u.instanceMatrix.needsUpdate=!0)}function Mt(Z,H,j){const ct=new On,xt=3.2,at=xt*xt,ut=5;let $=!1;for(let nt=0;nt<v;nt++){const ht=B[nt],dt=ht.x-Z.x,pt=ht.z-Z.z,Rt=dt*dt+pt*pt;if(Rt>U&&P[nt]===0)continue;Rt<at&&(P[nt]=Math.min(P[nt]+H*ut,1));const Ft=P[nt],Gt=Math.sin(j*2.8+ht.x*.5+ht.z*.35)*.07*(1-Ft*.8);if(ct.position.set(ht.x,ht.y,ht.z),ct.rotation.set(0,ht.ry,0),Ft>.005){const ae=Math.sqrt(Rt)+.001,Kt=dt/ae,jt=pt/ae,ce=Ft*1.4;ct.rotation.x=ce*jt+Gt,ct.rotation.z=-ce*Kt,ct.scale.set(ht.sx,ht.sy*(1-Ft*.4),ht.sx)}else ct.rotation.x=Gt,ct.rotation.z=0,ct.scale.set(ht.sx,ht.sy,ht.sx);ct.updateMatrix(),i.setMatrixAt(nt,ct.matrix),a&&a.setMatrixAt(nt,ct.matrix),c&&c.setMatrixAt(nt,ct.matrix),u&&u.setMatrixAt(nt,ct.matrix),$=!0}$&&(i.instanceMatrix.needsUpdate=!0),$&&a&&(a.instanceMatrix.needsUpdate=!0),$&&c&&(c.instanceMatrix.needsUpdate=!0),$&&u&&(u.instanceMatrix.needsUpdate=!0)}function mt(Z,H,j){const ct=f.geometry.attributes.position.array,xt=f.geometry.attributes.size.array,at=f.userData.velocities,ut=f.userData.ages,$=f.userData.maxAge,nt=f.userData.count,ht=Z.x-Math.sin(H)*3.5,dt=Z.z-Math.cos(H)*3.5;for(let pt=0;pt<nt;pt++){ut[pt]+=j,ut[pt]>$&&(ct[pt*3]=ht+(Math.random()-.5)*2.5,ct[pt*3+1]=.2+Math.random()*.4,ct[pt*3+2]=dt+(Math.random()-.5)*2.5,at[pt*3]=(Math.random()-.5)*3.5,at[pt*3+1]=2+Math.random()*3.5,at[pt*3+2]=(Math.random()-.5)*3.5,ut[pt]=0);const Rt=ut[pt]/$,Ft=1-Rt*.6;ct[pt*3]+=at[pt*3]*j*Ft,ct[pt*3+1]+=at[pt*3+1]*j*(1-Rt*.8),ct[pt*3+2]+=at[pt*3+2]*j*Ft,xt[pt]=(Rt<.3?Rt/.3:1)*(1-Rt*.5)*2.5}f.geometry.attributes.position.needsUpdate=!0,f.geometry.attributes.size.needsUpdate=!0}function F(){for(let Z=0;Z<T;Z++){const H=Z/T,j=L+(.5-H)*180,ct=Math.sin(H*Math.PI*3)*20;S.push({x:ct,z:j})}}function Y(){y=new V(80,100,-180).normalize(),p=new nL,p.scale.setScalar(480),p.frustumCulled=!1,r.add(p),p.turbidity.value=10,p.rayleigh.value=2,p.mieCoefficient.value=.005,p.mieDirectionalG.value=.8,p.sunPosition.value.copy(y);const Z=120/5e4*480;g=new C(new We(Z,32,16),new xn({color:16777215})),g.position.copy(y).multiplyScalar(480*.95),r.add(g)}function tt(){const Z=document.createElement("canvas");Z.width=1024,Z.height=1024;const H=Z.getContext("2d");H.fillStyle="#7a6543",H.fillRect(0,0,1024,1024);for(let $=0;$<3e4;$++){const nt=Math.random()*1024,ht=Math.random()*1024,dt=1+Math.random()*3,pt=80+Math.floor(Math.random()*80),Rt=Math.floor(Math.random()*30);H.fillStyle=`rgb(${pt+Rt+20},${pt+Rt},${pt-10})`,H.fillRect(nt,ht,dt,dt)}H.strokeStyle="rgba(60,45,25,0.12)",H.lineWidth=1;for(let $=0;$<1024;$+=12+Math.random()*6)H.beginPath(),H.moveTo(0,$),H.lineTo(1024,$+(Math.random()-.5)*4),H.stroke();const j=new Ti(Z);j.wrapS=Fn,j.wrapT=Fn,j.repeat.set(30,30),j.anisotropy=4;const ct=new ns(600,600,80,80);ct.rotateX(-Math.PI/2);const xt=ct.attributes.position.array;for(let $=0;$<xt.length;$+=3){const nt=xt[$],ht=xt[$+2];xt[$+1]+=Math.sin(nt*.015+ht*.01)*.5+Math.sin(nt*.04)*.15+Math.cos(ht*.03)*.2}ct.computeVertexNormals();const at=new bt({map:j,color:11573360,roughness:.92,metalness:0}),ut=new C(ct,at);ut.name="ground",r.add(ut)}function lt(){const Z=new qt(.03,.06,2.2,7);Z.translate(0,1.1,0);const H=new X(1.05,.05,.14);H.rotateZ(.58),H.translate(.33,1.02,0);const j=new X(.92,.045,.12);j.rotateZ(-.52),j.translate(-.3,1.34,0);const ct=new gi(.08,.34,6);ct.translate(0,2.22,0);const xt=new bt({color:9082944,metalness:.01,roughness:.92,vertexColors:!0}),at=new bt({color:10267467,metalness:.01,roughness:.9,vertexColors:!0}),ut=new bt({color:11508311,metalness:.01,roughness:.88,vertexColors:!0});i=new yc(Z,xt,v),i.name="corn-stalks",a=new yc(ct,ut,v),a.name="corn-tassels",c=new yc(H,at,v),c.name="corn-leaf-upper",u=new yc(j,at,v),u.name="corn-leaf-lower";const $=new On,nt=new Xt,ht=new Xt,dt=new Xt;for(let pt=0;pt<v;pt++){const Rt=(Math.random()-.5)*A*2,Ft=L+(Math.random()-.5)*R*2,Gt=.9+Math.random()*.75,ae=1,Kt=Math.random()*Math.PI*2;$.position.set(Rt,0,Ft),$.rotation.set(0,Kt,0),$.scale.set(ae,Gt,ae),$.updateMatrix(),i.setMatrixAt(pt,$.matrix),a&&a.setMatrixAt(pt,$.matrix),c&&c.setMatrixAt(pt,$.matrix),u&&u.setMatrixAt(pt,$.matrix),nt.setHSL(.17+Math.random()*.05,.44,.34+Math.random()*.11),ht.copy(nt).offsetHSL(-.01,.06,.04),dt.copy(nt).offsetHSL(-.03,-.1,.2),i.setColorAt(pt,nt),c&&c.setColorAt(pt,ht),u&&u.setColorAt(pt,ht),a&&a.setColorAt(pt,dt),B.push({x:Rt,y:0,z:Ft,ry:Kt,sx:ae,sy:Gt}),P.push(0)}i.instanceMatrix.needsUpdate=!0,i.instanceColor.needsUpdate=!0,a.instanceMatrix.needsUpdate=!0,a.instanceColor.needsUpdate=!0,c&&(c.instanceMatrix.needsUpdate=!0,c.instanceColor&&(c.instanceColor.needsUpdate=!0)),u&&(u.instanceMatrix.needsUpdate=!0,u.instanceColor&&(u.instanceColor.needsUpdate=!0)),r.add(i),r.add(a),c&&r.add(c),u&&r.add(u)}function Tt(){n=new vt,n.name="pickup-truck";const Z=new bt({color:8150586,roughness:.78,metalness:.18}),H=new bt({color:3814704,roughness:.6,metalness:.35}),j=new bt({color:13421772,roughness:.15,metalness:.85}),ct=new X(2,.25,5),xt=new C(ct,H);xt.position.set(0,.25,0),n.add(xt);const at=new X(2.15,1,4.8),ut=new C(at,Z);ut.position.set(0,.85,0),n.add(ut);const $=new X(2,.95,2.2),nt=new bt({color:7163440,roughness:.72,metalness:.15}),ht=new C($,nt);ht.position.set(0,1.85,-.7),n.add(ht);const dt=new X(2.1,.08,2.3),pt=new C(dt,Z);pt.position.set(0,2.35,-.7),n.add(pt);const Rt=new ns(1.85,.8),Ft=new bt({color:9090252,roughness:.05,metalness:.4,transparent:!0,opacity:.45}),Gt=new C(Rt,Ft);Gt.position.set(0,2,.42),Gt.rotation.x=-.2,n.add(Gt);const ae=new ns(1.7,.6),Kt=new C(ae,Ft);Kt.position.set(0,2,-1.82),Kt.rotation.x=.15,n.add(Kt);for(const Ee of[-1,1]){const ke=new ns(1.6,.55),$e=new C(ke,Ft);$e.position.set(Ee*1.01,2,-.7),$e.rotation.y=Ee*Math.PI/2,n.add($e)}const jt=new C(new X(2,.1,2.3),H);jt.position.set(0,1.4,1.55),n.add(jt);const ce=new X(.08,.65,2.3);for(const Ee of[-1,1]){const ke=new C(ce,Z);ke.position.set(Ee*1,1.75,1.55),n.add(ke)}const ee=new C(new X(2,.65,.08),Z);ee.position.set(0,1.75,2.7),n.add(ee);for(const[Ee,ke]of[[-2.45,"front"],[2.72,"rear"]]){const $e=new X(2.3,.18,.12),js=new C($e,j);js.position.set(0,.45,Ee),js.name=`bumper-${ke}`,n.add(js)}const Re=new X(1.6,.5,.06),je=new bt({color:5592405,roughness:.3,metalness:.7}),pn=new C(Re,je);pn.position.set(0,.75,-2.42),n.add(pn);const os=new Wr(.14,10),jn=new bt({color:16777200,emissive:16777160,emissiveIntensity:.6,roughness:.1});for(const Ee of[-.7,.7]){const ke=new C(os,jn);ke.position.set(Ee,.9,-2.43),n.add(ke)}const Yn=new Wr(.1,8),we=new bt({color:16719904,emissive:13369344,emissiveIntensity:.5,roughness:.3});for(const Ee of[-.8,.8]){const ke=new C(Yn,we);ke.position.set(Ee,.8,2.73),ke.rotation.y=Math.PI,n.add(ke)}for(const Ee of[-1,1]){const ke=new C(new X(.4,.04,.04),H);ke.position.set(Ee*1.25,1.9,.1),n.add(ke);const $e=new C(new X(.18,.14,.04),j);$e.position.set(Ee*1.45,1.9,.1),n.add($e)}const Ye=new qt(.42,.42,.28,14);Ye.rotateZ(Math.PI/2);const Dn=new bt({color:1710618,roughness:.95,metalness:0}),Ge=new qt(.18,.18,.3,8);Ge.rotateZ(Math.PI/2),n.userData.wheels=[];const as=[[-1.15,.42,-1.4],[1.15,.42,-1.4],[-1.15,.42,1.6],[1.15,.42,1.6]];for(const[Ee,ke,$e]of as){const js=new vt;js.position.set(Ee,ke,$e),js.add(new C(Ye,Dn)),js.add(new C(Ge,j)),n.add(js),n.userData.wheels.push(js)}const Te=new X(.12,.2,1);for(const Ee of[-1,1])for(const[ke]of[[-1.4],[1.6]]){const $e=new C(Te,Z);$e.position.set(Ee*1.12,.65,ke),n.add($e)}const _e=new qt(.01,.015,1.5,4),Kn=new bt({color:3355443,metalness:.6,roughness:.3}),ls=new C(_e,Kn);ls.position.set(-.8,3.1,-.9),ls.rotation.z=.08,n.add(ls);const Bn=S[0];n.position.set(Bn.x,.55,Bn.z),r.add(n)}function O(){s=new vt,s.name="surveillance-drone";const Z=new bt({color:14212322,roughness:.25,metalness:.55}),H=new bt({color:657960,roughness:.05,metalness:.85}),j=new bt({color:2763317,roughness:.3,metalness:.6}),ct=new qt(.25,.45,4.5,8);ct.rotateX(Math.PI/2);const xt=new C(ct,Z);s.add(xt);const at=new gi(.25,1.2,8);at.rotateX(-Math.PI/2);const ut=new C(at,Z);ut.position.set(0,0,-2.85),s.add(ut);const $=new We(.2,10,10,0,Math.PI*2,0,Math.PI*.6),nt=new bt({color:328965,roughness:.05,metalness:.9}),ht=new C($,nt);ht.position.set(0,-.3,-2.4),ht.rotation.x=Math.PI,s.add(ht);const dt=new X(14,.06,2),pt=new C(dt,j);pt.position.set(0,.05,-.3),s.add(pt);const Rt=new X(13.5,.02,1.7),Ft=new C(Rt,H);Ft.position.set(0,.12,-.3),s.add(Ft);const Gt=new xn({color:2236996});for(let ee=-6;ee<=6;ee++){const Re=new C(new X(.015,.025,1.7),Gt);Re.position.set(ee*1,.14,-.3),s.add(Re)}const ae=new qt(.08,.12,2.5,6);ae.rotateX(Math.PI/2);const Kt=new C(ae,Z);Kt.position.set(0,.05,3.4),s.add(Kt);const jt=new X(4,.04,.7),ce=new C(jt,j);ce.position.set(0,.1,4.5),s.add(ce);for(const ee of[-1,1]){const Re=new X(.04,1,.5),je=new C(Re,Z);je.position.set(ee*.3,.6,4.5),je.rotation.z=ee*.3,s.add(je)}s.position.set(0,J,0),s.scale.set(.55,.55,.55),r.add(s)}function et(){const H=new Qe,j=new Float32Array(500*3),ct=new Float32Array(500),xt=new Float32Array(500*3),at=new Float32Array(500),ut=4;for(let Rt=0;Rt<500;Rt++)j[Rt*3]=9999,j[Rt*3+1]=-10,j[Rt*3+2]=9999,ct[Rt]=0,at[Rt]=ut*Math.random();H.setAttribute("position",new ge(j,3)),H.setAttribute("size",new ge(ct,1));const $=new er({color:13150330,size:1.8,sizeAttenuation:!0,transparent:!0,opacity:.5,depthWrite:!1});f=new to(H,$),f.name="truck-dust",f.userData={count:500,velocities:xt,ages:at,maxAge:ut},r.add(f);const nt=800,ht=new Qe,dt=new Float32Array(nt*3);for(let Rt=0;Rt<nt;Rt++)dt[Rt*3]=(Math.random()-.5)*160,dt[Rt*3+1]=.3+Math.random()*12,dt[Rt*3+2]=L+(Math.random()-.5)*200;ht.setAttribute("position",new ge(dt,3));const pt=new er({color:13942938,size:.35,sizeAttenuation:!0,transparent:!0,opacity:.25,depthWrite:!1});d=new to(ht,pt),d.name="ambient-dust",d.userData={count:nt},r.add(d)}function z(){x=new wi(16777215,6);const Z=(y||new V(80,100,-180).normalize()).clone();x.position.copy(Z).multiplyScalar(200),r.add(x);const H=new Co(16777215,.03);r.add(H)}function W(Z){const j=(Z%1+1)%1*(T-1),ct=Math.floor(j),xt=Math.min(ct+1,T-1),at=j-ct;return yt(S[ct],S[xt],at)}function yt(Z,H,j){return{x:Z.x+(H.x-Z.x)*j,z:Z.z+(H.z-Z.z)*j}}function K(Z,H){return{x:Z.x-H.x,z:Z.z-H.z}}}},hc=15,Jh=12,gu=6,lp=1600,qg=900,Ky=8;function $g(r){return St.clamp(r,0,1)}function EE(r,t,e){if(r===t)return e<r?0:1;const n=$g((e-r)/(t-r));return n*n*(3-2*n)}function d$(r){let t=r>>>0;return()=>(t=t*1664525+1013904223>>>0,t/4294967296)}function CE(){const t=document.createElement("canvas");t.width=128,t.height=128;const e=t.getContext("2d");if(!e){const i=new is;return i.needsUpdate=!0,i}const n=e.createRadialGradient(128*.5,128*.5,0,128*.5,128*.5,128*.5);n.addColorStop(0,"rgba(255, 252, 242, 1)"),n.addColorStop(.2,"rgba(255, 232, 198, 0.9)"),n.addColorStop(.65,"rgba(220, 166, 103, 0.25)"),n.addColorStop(1,"rgba(220, 166, 103, 0)"),e.fillStyle=n,e.fillRect(0,0,128,128);const s=new Ti(t);return s.needsUpdate=!0,s}function f$(r){const e=document.createElement("canvas");e.width=512,e.height=512;const n=e.getContext("2d");if(!n){const i=new is;return i.needsUpdate=!0,i}n.fillStyle="#4d3020",n.fillRect(0,0,512,512);for(let i=0;i<48;i+=1){const a=i*10.666666666666666,c=.08+r()*.1;n.fillStyle=`rgba(29, 18, 12, ${c})`,n.fillRect(0,a,512,2)}for(let i=0;i<30;i+=1){const a=i*17.066666666666666+r()*6;n.fillStyle="rgba(22, 12, 8, 0.16)",n.fillRect(a,0,2+r()*2,512)}for(let i=0;i<6500;i+=1){const a=Math.floor(r()*512),c=Math.floor(r()*512),u=.04+r()*.18;n.fillStyle=`rgba(190, 127, 77, ${u})`,n.fillRect(a,c,1,1)}const s=new Ti(e);return s.colorSpace=bn,s.wrapS=Fn,s.wrapT=Fn,s.repeat.set(3.8,2.4),s.needsUpdate=!0,s}function p$(r){const n=document.createElement("canvas");n.width=256,n.height=384;const s=n.getContext("2d");if(!s){const c=new is;return c.needsUpdate=!0,c}const i=s.createLinearGradient(0,0,0,384);i.addColorStop(0,"rgba(252, 235, 204, 0.55)"),i.addColorStop(1,"rgba(212, 180, 142, 0.1)"),s.fillStyle=i,s.fillRect(0,0,256,384);for(let c=0;c<20;c+=1){const u=c/19*256,d=4+r()*8,f=.06+r()*.09;s.fillStyle=`rgba(255, 241, 218, ${f})`,s.fillRect(u,0,d,384)}for(let c=0;c<1200;c+=1){const u=Math.floor(r()*256),d=Math.floor(r()*384),f=.03+r()*.08;s.fillStyle=`rgba(255, 244, 228, ${f})`,s.fillRect(u,d,1,1)}const a=new Ti(n);return a.colorSpace=bn,a.needsUpdate=!0,a}function m$(r){const t=new vt,e=new C(new X(hc,.24,Jh),new bt({color:6175272,map:r,roughness:.95,metalness:.02}));e.position.set(0,-.12,-1),t.add(e);const n=new bt({color:6044201,roughness:.94,metalness:.02}),s=new bt({color:4927266,roughness:.94,metalness:.02}),i=new bt({color:3022359,roughness:.96,metalness:0}),a=new C(new X(hc,gu,.22),n);a.position.set(0,gu*.5,-Jh*.5-1),t.add(a);const c=new C(new X(.22,gu,Jh),s);c.position.set(-hc*.5,gu*.5,-1),t.add(c);const u=new C(new X(.22,gu,Jh),s);u.position.set(hc*.5,gu*.5,-1),t.add(u);const d=new C(new X(hc,.2,Jh),i);d.position.set(0,gu+.1,-1),t.add(d);const f=new C(new X(hc,.14,.3),new bt({color:2890259,roughness:.9,metalness:.02}));return f.position.set(0,.05,-Jh*.5-.89),t.add(f),t}function g$(r){const t=new vt;t.position.set(-hc*.5+.02,3.15,-4),t.rotation.y=Math.PI*.5;const e=new bt({color:2890258,roughness:.88,metalness:.02}),n=new C(new ns(3.3,4.4),new xn({color:16171915,transparent:!0,opacity:.62,side:ss}));n.position.set(-.07,0,0),t.add(n);const s=new C(new X(3.65,.16,.2),e);s.position.set(0,2.25,.06),t.add(s);const i=new C(new X(3.65,.16,.2),e);i.position.set(0,-2.25,.06),t.add(i);const a=new C(new X(.16,4.64,.2),e);a.position.set(-1.8,0,.06),t.add(a);const c=new C(new X(.16,4.64,.2),e);c.position.set(1.8,0,.06),t.add(c);const u=new C(new X(.1,4.4,.16),e);u.position.set(0,0,.06),t.add(u);const d=new C(new ns(5.7,4.7,18,14),new bt({color:16113857,map:r,roughness:1,metalness:0,transparent:!0,opacity:.45,side:ss,depthWrite:!1}));return d.position.set(.68,-.18,.22),t.add(d),{curtain:d,glowMaterial:n.material,group:t}}function y$(r){const t=new vt,e=new bt({color:4007193,roughness:.87,metalness:.03}),n=new bt({color:2824978,roughness:.9,metalness:.02}),s=new C(new X(.22,4.6,.62),e);s.position.set(-1.82,0,.05),t.add(s);const i=new C(new X(.22,4.6,.62),e);i.position.set(1.82,0,.05),t.add(i);const a=new C(new X(3.86,.22,.62),e);a.position.set(0,2.2,.05),t.add(a);const c=new C(new X(3.86,.22,.62),e);c.position.set(0,-2.2,.05),t.add(c);const u=new C(new X(3.42,4.16,.06),new bt({color:3022100,roughness:.94,metalness:.02}));u.position.set(0,0,-.21),t.add(u);const d=new C(new X(.08,4.16,.58),n);d.position.set(-1.65,0,.05),t.add(d);const f=new C(new X(.08,4.16,.58),n);f.position.set(1.65,0,.05),t.add(f);for(let p=0;p<4;p+=1){const g=new C(new X(3.35,.12,.58),new bt({color:4861215,roughness:.9,metalness:.02}));g.position.set(0,-1.7+p*1.13,.07),t.add(g);let y=-1.48;for(;y<1.34;){const S=.1+r()*.14,T=.56+r()*.46,M=.14+r()*.1,N=.32+r()*.2,v=.34+r()*.2,A=new Xt().setHSL(.02+r()*.12,N,v),R=new C(new X(S,T,M),new bt({color:A,roughness:.88,metalness:.02}));if(R.position.set(y+S*.5,-2+p*1.13+T*.5,.17+(r()-.5)*.06),R.rotation.z=(r()-.5)*.06,t.add(R),y+=S+.035+r()*.03,r()>.74&&y<1.16){const L=.22+r()*.24,D=.14+r()*.1,U=.1+r()*.12,B=new Xt().setHSL(.03+r()*.1,.22+r()*.2,.26+r()*.16),P=new C(new X(L,U,D),new bt({color:B,roughness:.9,metalness:.02}));P.position.set(y+L*.5,-2+p*1.13+U*.5+.03,.2),P.rotation.z=(r()-.5)*.08,t.add(P),y+=L+.04}}const x=new C(new X(.2,.86,.2),new bt({color:new Xt().setHSL(.04+r()*.08,.3+r()*.2,.24+r()*.2),roughness:.9,metalness:.02}));if(x.position.set(1.34-r()*.24,-1.58+p*1.13,.2),x.rotation.z=-.32-r()*.15,t.add(x),r()>.4){const S=new C(new X(.46+r()*.24,.14+r()*.08,.22),new bt({color:new Xt().setHSL(.03+r()*.1,.26+r()*.2,.22+r()*.14),roughness:.9,metalness:.02}));S.position.set(-1.2+r()*1.8,-1.92+p*1.13,.21),S.rotation.z=(r()-.5)*.06,t.add(S)}}return t.position.set(.6,2.26,-6.63),t}function x$(){const r=new vt,t=new bt({color:2759187,roughness:.89,metalness:.03}),e=new bt({color:9137495,roughness:.97,metalness:0}),n=new bt({color:5061166,roughness:.98,metalness:0}),s=new C(new X(3.1,.48,5.8),t);s.position.y=.23,r.add(s);const i=new C(new X(2.92,.34,5.58),e);i.position.y=.64,r.add(i);const a=new C(new X(2.84,.25,3.86),n);a.position.set(0,.9,.46),r.add(a);const c=new C(new X(1.35,.2,.72),new bt({color:10586226,roughness:.95,metalness:0}));c.position.set(0,.93,-2.1),r.add(c);const u=new qt(.07,.07,2,14),d=[[-1.45,1,-2.8],[1.45,1,-2.8],[-1.45,1,2.8],[1.45,1,2.8]];for(const[f,p,g]of d){const y=new C(u,t);y.position.set(f,p,g),r.add(y);const x=new C(new We(.14,12,10),new bt({color:3679001,roughness:.85,metalness:.04}));x.position.set(f,2.03,g),r.add(x)}return r.position.set(5.15,0,-1.9),r.rotation.y=-.02,r}function b$(){const r=new vt,t=new bt({color:3812644,roughness:.88,metalness:.02}),e=new bt({color:7032380,roughness:.86,metalness:.01}),n=new bt({color:5200754,roughness:.84,metalness:.02}),s=new bt({color:3615267,roughness:.8,metalness:.06}),i=new bt({color:9137497,roughness:.8,metalness:0}),a=new bt({color:4337703,roughness:.74,metalness:.03}),c=new C(new X(.86,1.32,.5),t);c.position.y=1.14,r.add(c);const u=new C(new X(.28,.78,.06),e);u.position.set(0,1.18,.28),r.add(u);const d=new C(new X(.44,.42,.42),i);d.position.set(.02,2.02,.04),r.add(d);const f=new C(new X(.46,.12,.44),a);f.position.set(.02,2.24,.04),r.add(f);const p=new C(new X(.46,.24,.1),a);p.position.set(.02,2.03,-.16),r.add(p);const g=new C(new X(.08,.22,.34),a);g.position.set(-.21,2.02,.04),r.add(g);const y=new C(new X(.08,.22,.34),a);y.position.set(.25,2.02,.04),r.add(y);const x=new C(new X(.24,.1,.16),a);x.position.set(.02,1.86,.14),r.add(x);const S=new C(new X(.22,.9,.22),t);S.position.set(-.55,1.1,.03),S.rotation.z=.14,r.add(S);const T=new C(new X(.22,.9,.22),t);T.position.set(.59,1.06,-.02),T.rotation.z=-.16,r.add(T);const M=new C(new X(.26,.9,.26),n);M.position.set(-.16,.11,.03),r.add(M);const N=new C(new X(.26,.9,.26),n);N.position.set(.16,.11,-.01),r.add(N);const v=new C(new X(.26,.16,.3),s);v.position.set(-.16,-.42,.06),r.add(v);const A=new C(new X(.26,.16,.3),s);return A.position.set(.16,-.42,.04),r.add(A),r.position.set(-3,0,3),r.rotation.y=Math.PI*.38,r}function S$(){const r=new vt,t=new bt({color:3418919,roughness:.9,metalness:.01}),e=new bt({color:7692626,roughness:.88,metalness:.01}),n=new bt({color:5266804,roughness:.86,metalness:.01}),s=new bt({color:3615782,roughness:.82,metalness:.05}),i=new bt({color:10585199,roughness:.8,metalness:0}),a=new bt({color:4600876,roughness:.74,metalness:.02}),c=new C(new X(.78,1.24,.44),t);c.position.y=1.1,r.add(c);const u=new C(new X(.26,.66,.06),e);u.position.set(.03,1.12,.25),r.add(u);const d=new C(new X(.38,.36,.38),i);d.position.set(.06,1.94,.05),r.add(d);const f=new C(new X(.4,.1,.4),a);f.position.set(.06,2.14,.05),r.add(f);const p=new C(new X(.4,.28,.1),a);p.position.set(.06,1.96,-.15),r.add(p);const g=new C(new X(.07,.2,.3),a);g.position.set(-.13,1.95,.05),r.add(g);const y=new C(new X(.07,.2,.3),a);y.position.set(.25,1.95,.05),r.add(y);const x=new C(new X(.1,.24,.1),a);x.position.set(.06,1.75,-.18),r.add(x);const S=new C(new X(.46,.14,.34),t);S.position.set(.05,1.72,-.02),r.add(S);const T=new C(new X(.2,.84,.2),t);T.position.set(-.48,1.06,-.02),T.rotation.z=.12,r.add(T);const M=new C(new X(.2,.84,.2),t);M.position.set(.56,1.04,-.03),M.rotation.z=-.14,r.add(M);const N=new C(new X(.23,.84,.23),n);N.position.set(-.12,.08,.03),r.add(N);const v=new C(new X(.23,.84,.23),n);v.position.set(.16,.08,-.02),r.add(v);const A=new C(new X(.23,.14,.28),s);A.position.set(-.12,-.41,.05),r.add(A);const R=new C(new X(.23,.14,.28),s);return R.position.set(.16,-.41,.03),r.add(R),r.position.set(2,0,3),r.rotation.y=-Math.PI*.9,r}function w$(){const r=new vt,t=[],e=-1.42,n=1.42;for(let s=0;s<Ky;s+=1){const i=s/(Ky-1),a=St.lerp(e,n,i),c=new C(new X(.2,.02,5.1),new bt({color:12024646,roughness:.96,metalness:.01,transparent:!0,opacity:.08}));c.position.set(a,.03,-.24+(s%2===0?.06:-.04)),c.scale.y=.2,r.add(c),t.push({baseY:c.position.y,mesh:c,phase:i*Math.PI*2})}return{group:r,lines:t}}function T$(r,t){const e=new Float32Array(lp*3),n=new Float32Array(lp*5),s=new Float32Array(lp*3);for(let u=0;u<lp;u+=1){const d=u*3,f=u*5,p=(t()-.5)*(hc-1.4),g=.35+t()*4.6,y=-5.6+t()*8.6;e[d]=p,e[d+1]=g,e[d+2]=y,n[f]=t()*Math.PI*2,n[f+1]=.5+t()*1.2,n[f+2]=.22+t()*.45,n[f+3]=p,n[f+4]=y;const S=Math.floor(t()*Ky)/(Ky-1);s[d]=St.lerp(-1.42,1.42,S)+(t()-.5)*.05,s[d+1]=.03+t()*.03,s[d+2]=-2.5+t()*4.9}const i=new Qe;i.setAttribute("position",new fs(e,3));const a=new er({color:13339735,size:.085,transparent:!0,opacity:.48,map:r,alphaTest:.01,blending:mi,depthWrite:!1,sizeAttenuation:!0}),c=new to(i,a);return{geometry:i,points:c,positions:e,seeds:n,settleTargets:s}}function _$(r,t){const e=new Float32Array(qg*3),n=new Float32Array(qg*6);for(let c=0;c<qg;c+=1){const u=c*3,d=c*6,f=-8.6-t()*2.9,p=.2+t()*6.2,g=-8+t()*7.6;e[u]=f,e[u+1]=p,e[u+2]=g,n[d]=f,n[d+1]=p,n[d+2]=g,n[d+3]=t()*Math.PI*2,n[d+4]=.4+t()*1.6,n[d+5]=.14+t()*.35}const s=new Qe;s.setAttribute("position",new fs(e,3));const i=new er({color:11756852,size:.16,transparent:!0,opacity:.42,map:r,alphaTest:.02,depthWrite:!1,blending:Tr,sizeAttenuation:!0}),a=new to(s,i);return{geometry:s,points:a,positions:e,seeds:n}}function M$(r,t,e,n){const{geometry:s,positions:i,seeds:a,settleTargets:c}=r;for(let u=0;u<lp;u+=1){const d=u*3,f=u*5,p=a[f],g=a[f+1],y=a[f+2],x=a[f+3],S=a[f+4],T=x+n*.8+Math.sin(t*g+p)*y,M=.55+(Math.sin(t*(g*1.25)+p*1.33)*.5+.5)*4.1+Math.cos(t*.45+p*.7)*.18,N=S+Math.cos(t*(g*.86)+p*.78)*(y*1.1),v=e*(.88+.12*Math.sin(p));i[d]=St.lerp(T,c[d],v),i[d+1]=St.lerp(M,c[d+1],v),i[d+2]=St.lerp(N,c[d+2]+Math.sin(t*.82+p)*.02,v)}s.attributes.position.needsUpdate=!0}function v$(r,t,e){const{geometry:n,positions:s,seeds:i}=r;for(let a=0;a<qg;a+=1){const c=a*3,u=a*6,d=i[u],f=i[u+1],p=i[u+2],g=i[u+3],y=i[u+4],x=i[u+5];s[c]=d+Math.sin(t*(y*.9)+g)*(.35+x),s[c+1]=f+Math.sin(t*(y*1.7)+g*1.3)*(.32+x*.5),s[c+2]=p+Math.cos(t*(y*1.25)+g)*(.95+x*.6)+e*.7}n.attributes.position.needsUpdate=!0}const A$={id:"dust-storm-murph-anomaly",title:"Dust Storm and Murph's Anomaly",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=[],d=null,f=null,p=null,g=null,y=null,x=null,S=null,T=null,M=null,N=null,v=0;return{init({root:A,camera:R,scene:L}){t=A,e=L,n=L.background,s=L.fog,L.background=new Xt(2826523),L.fog=new Hu(4863014,.012),r=new vt,r.name="scene-03-dust-storm-murph",A.add(r),R.position.set(.45,2.2,8),R.lookAt(-.15,1.35,-2.7);const D=d$(302031),U=f$(D),B=p$(D),P=m$(U);r.add(P);const J=g$(B);P.add(J.group),i=J.curtain,a=Float32Array.from(i.geometry.attributes.position.array),c=J.glowMaterial;const q=y$(D);P.add(q);const ft=x$();P.add(ft);const Mt=b$();P.add(Mt);const mt=S$();P.add(mt);const F=w$();P.add(F.group),u=F.lines;const Y=new Co(9336162,1.25);r.add(Y),p=new hs(16764309,7.4,32,1.48),p.position.set(-7.55,3.4,-3.85),r.add(p);const tt=new $p(12753531,3811099,1.55);r.add(tt),g=new hs(16767410,4.8,24,1.62),g.position.set(.8,5.35,-1.1),r.add(g),y=new hs(12882534,3.6,22,1.72),y.position.set(.4,1.2,1.8),r.add(y),x=new hs(14725251,2.9,24,1.74),x.position.set(-.2,2,6.3),r.add(x),S=new hs(14790527,3,14,1.82),S.position.set(.7,2.7,-5.4),r.add(S),T=new hs(16763034,2.4,5.6,1.95),T.position.set(-.26,1.88,.7),Mt.add(T),M=new hs(16763034,2.25,5.4,1.95),M.position.set(.18,1.8,.68),mt.add(M);const lt=new C(new We(.15,12,10),new bt({color:3812643,emissive:new Xt(16764574),emissiveIntensity:.38,roughness:.82,metalness:.08}));lt.position.set(.8,5.15,-1.1),r.add(lt),N=new hs(16754782,.28,4.5,2.3),N.position.set(.1,.24,-1.05),r.add(N);const Tt=CE(),O=CE();f=T$(Tt,D),d=_$(O,D),r.add(d.points),r.add(f.points)},update({delta:A,elapsed:R}){if(!r||!i)return;v+=A;const L=R%15.5/15.5,D=EE(.45,.62,L),U=1-EE(.88,.98,L),B=$g(D*U),P=Math.sin(v*.8)*.55+Math.sin(v*1.95)*.28;p&&(p.intensity=6.8+(1-B)*2.2+Math.sin(v*1.1)*.35,p.position.y=3.35+Math.sin(v*.45)*.12),g&&(g.intensity=4.1+B*1.2+Math.sin(v*.65)*.16),y&&(y.intensity=3+B*.9+Math.sin(v*.8)*.12),x&&(x.intensity=2.4+B*.72+Math.sin(v*.72)*.1),S&&(S.intensity=2.45+(1-B)*.7+Math.sin(v*.6)*.12),T&&(T.intensity=2+B*.6+Math.sin(v*.9)*.08),M&&(M.intensity=1.85+B*.56+Math.sin(v*.94+1.1)*.08),N&&(N.intensity=.2+B*.34+Math.sin(v*6.4)*.02),c&&(c.opacity=.96+(1-B)*.08+Math.sin(v*.9)*.03);for(const J of u){const q=Math.sin(v*2.4+J.phase)*.03;J.mesh.material.opacity=.08+B*.84+q*B,J.mesh.scale.y=.2+B*2.8,J.mesh.position.y=J.baseY+B*.01}if(i&&a){const J=i.geometry.attributes.position,q=J.array;for(let ft=0;ft<q.length;ft+=3){const Mt=a[ft],mt=a[ft+1],F=$g((2.35-mt)/4.7),Y=Math.pow(F,1.7),tt=$g(.5+.5*Math.sin(v*2.6+Mt*1.3+mt*.4)),lt=Math.sin(v*2.3+mt*2.6+Mt*1.6)*.022*F,Tt=(.2+tt*1.35+Math.max(0,P)*.42)*Y,O=Math.sin(v*6+Mt*3.4+mt*1.2)*.12*F,et=Tt+O,z=(.14+tt*.5+Math.sin(v*1.8+mt*1.5)*.12)*Math.pow(F,1.35);q[ft]=a[ft]+lt,q[ft+1]=a[ft+1]+et,q[ft+2]=a[ft+2]+Math.max(.04*F,z)}J.needsUpdate=!0}f&&(M$(f,v,B,P),f.points.material&&(f.points.material.opacity=.44+(1-B)*.18)),d&&(v$(d,v,P),d.points.material&&(d.points.material.opacity=.33+(1-B)*.23))},resize(){},dispose(){e&&(e.background=n,e.fog=s),r&&(t&&r.parent!==t&&t.add(r),Fi(r)),r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=[],d=null,f=null,p=null,g=null,y=null,x=null,S=null,T=null,M=null,N=null,v=0}}}},di=38,qi=28,oc=10.5,So=.45,N$=.35,R$=.35,wg=.12;function DE(r){if(!r)return;const t=-di*.5+So*.5+wg,e=di*.5-So*.5-wg,n=-qi*.5+So*.5+wg,s=qi*.5-So*.5-wg,i=N$,a=oc-R$,c=St.clamp(r.position.x,t,e),u=St.clamp(r.position.y,i,a),d=St.clamp(r.position.z,n,s);(c!==r.position.x||u!==r.position.y||d!==r.position.z)&&(r.position.set(c,u,d),r.updateMatrixWorld())}function Hx(r){let t=r>>>0;return()=>(t=t*1664525+1013904223>>>0,t/4294967296)}function E$(){const r=document.createElement("canvas");r.width=1024,r.height=1024;const t=r.getContext("2d"),e=Hx(404);t.fillStyle="#5a5b60",t.fillRect(0,0,r.width,r.height);for(let c=0;c<2400;c+=1){const u=e()*r.width,d=e()*r.height,f=88+Math.floor(e()*26);t.fillStyle=`rgba(${f}, ${f}, ${f+4}, 0.11)`,t.fillRect(u,d,1.2,1.2)}t.strokeStyle="rgba(150, 153, 162, 0.42)",t.lineWidth=2;const n=-120,s=r.height+130;for(let c=180;c<1900;c+=38)t.beginPath(),t.arc(n,s,c,-Math.PI*.04,-Math.PI*.95,!0),t.stroke();const i=t.createRadialGradient(r.width*.5,r.height*.2,140,r.width*.5,r.height*.4,900);i.addColorStop(0,"rgba(255, 255, 255, 0.03)"),i.addColorStop(1,"rgba(0, 0, 0, 0.2)"),t.fillStyle=i,t.fillRect(0,0,r.width,r.height);const a=new Ti(r);return a.colorSpace=bn,a.wrapS=Fn,a.wrapT=Fn,a.repeat.set(1.15,1.05),a}function C$(){const r=document.createElement("canvas");r.width=512,r.height=512;const t=r.getContext("2d"),e=Hx(2001);t.fillStyle="#6a412d",t.fillRect(0,0,r.width,r.height);for(let s=0;s<r.width;s+=5){const i=Math.floor(e()*28)-14;t.strokeStyle=`rgba(${130+i}, ${84+i*.42}, ${58+i*.3}, 0.3)`,t.lineWidth=1+e()*1.5,t.beginPath(),t.moveTo(s+e()*2,0),t.bezierCurveTo(s+8+e()*6,r.height*.28,s-9+e()*7,r.height*.72,s+e()*2,r.height),t.stroke()}for(let s=0;s<7;s+=1){const i=28+s*72+e()*10;t.strokeStyle="rgba(62, 39, 26, 0.32)",t.lineWidth=2,t.beginPath(),t.moveTo(i,0),t.lineTo(i,r.height),t.stroke()}const n=new Ti(r);return n.colorSpace=bn,n.wrapS=Fn,n.wrapT=Fn,n.repeat.set(4.6,1.5),n}function D$(r){const t=document.createElement("canvas");t.width=180,t.height=260;const e=t.getContext("2d"),n=Hx(140+r*19),s=e.createLinearGradient(0,0,0,t.height);s.addColorStop(0,"#1e1d1f"),s.addColorStop(1,"#2a2321"),e.fillStyle=s,e.fillRect(0,0,t.width,t.height);const i=110+Math.floor(n()*80),a=40+Math.floor(n()*70);e.fillStyle=`rgba(${a}, ${a+6}, ${a+14}, 0.95)`,e.fillRect(56,164,68,62),e.fillStyle=`rgba(${i}, ${Math.max(90,i-15)}, ${Math.max(80,i-32)}, 0.95)`,e.beginPath(),e.arc(90,124,24,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(${35+Math.floor(n()*40)}, ${26+Math.floor(n()*30)}, ${22+Math.floor(n()*30)}, 0.95)`,e.beginPath(),e.moveTo(67,120),e.quadraticCurveTo(90,70+n()*12,113,120),e.lineTo(113,106),e.quadraticCurveTo(90,56+n()*8,67,106),e.closePath(),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.2)",e.lineWidth=2,e.strokeRect(8,8,t.width-16,t.height-16);const c=new Ti(t);return c.colorSpace=bn,c}function B$(){const r=document.createElement("canvas");r.width=1024,r.height=320;const t=r.getContext("2d");t.clearRect(0,0,r.width,r.height),t.fillStyle="#8f8f90",t.font='700 148px "Avenir Next", "Segoe UI", sans-serif',t.textAlign="center",t.textBaseline="middle",t.fillText("LAZARUS",r.width*.5,138),t.strokeStyle="#8f8f90",t.lineWidth=10,t.beginPath(),t.arc(r.width*.5,230,38,Math.PI*.15,Math.PI*.85,!1),t.stroke(),t.fillStyle="#8f8f90",t.beginPath(),t.moveTo(r.width*.5-54,226),t.lineTo(r.width*.5+54,226),t.lineTo(r.width*.5,272),t.closePath(),t.fill();const e=new Ti(r);return e.colorSpace=bn,e}function L$(){const r=document.createElement("canvas");r.width=1024,r.height=560;const t=r.getContext("2d"),e=new Ti(r);return e.colorSpace=bn,{canvas:r,ctx:t,texture:e}}function BE(r,t,e){r.fillStyle="#060f1c",r.fillRect(0,0,t.width,t.height);const n={x:t.width*(.32+Math.sin(e*.27)*.08),y:t.height*(.45+Math.cos(e*.19)*.12)},s={x:t.width*(.67+Math.cos(e*.33)*.06),y:t.height*(.53+Math.sin(e*.24)*.1)},i=r.createRadialGradient(n.x,n.y,14,n.x,n.y,210);i.addColorStop(0,"rgba(255, 175, 214, 0.9)"),i.addColorStop(.35,"rgba(208, 125, 221, 0.55)"),i.addColorStop(1,"rgba(28, 46, 95, 0)"),r.fillStyle=i,r.fillRect(0,0,t.width,t.height);const a=r.createRadialGradient(s.x,s.y,10,s.x,s.y,180);a.addColorStop(0,"rgba(242, 167, 202, 0.88)"),a.addColorStop(.3,"rgba(182, 101, 209, 0.52)"),a.addColorStop(1,"rgba(18, 26, 70, 0)"),r.fillStyle=a,r.fillRect(0,0,t.width,t.height),r.strokeStyle="rgba(194, 236, 255, 0.16)",r.lineWidth=1.6;for(let u=0;u<56;u+=1){const d=u/56*t.height+Math.sin(e*1.8+u*.35)*1.3;r.beginPath(),r.moveTo(0,d),r.lineTo(t.width,d),r.stroke()}const c=170;for(let u=0;u<c;u+=1){const d=u*13.173,f=(Math.sin(d)+1)*.5*t.width,p=(Math.cos(d*1.29)+1)*.5*t.height,g=.22+Math.abs(Math.sin(e*2.5+u*.4))*.6;r.fillStyle=`rgba(215, 235, 255, ${g})`,r.fillRect(f,p,1.4,1.4)}}function g2(){const r=new vt,t=new bt({color:1382171,roughness:.65,metalness:.1}),e=new bt({color:9278105,roughness:.32,metalness:.85}),n=new C(new X(1.3,.16,1.36),t);n.position.set(0,.98,0),r.add(n);const s=new C(new X(1.28,1.62,.15),t);s.position.set(0,1.73,-.58),r.add(s);const i=new C(new X(1.34,1.7,.05),e);i.position.set(0,1.73,-.67),r.add(i);const a=new C(new qt(.05,.05,1.3,12),e);a.rotation.x=Math.PI*.5,a.position.set(-.73,1.33,.08),r.add(a);const c=a.clone();c.position.x=.73,r.add(c);const u=new C(new qt(.05,.05,.58,10),e);u.position.set(-.68,1.05,.05),r.add(u);const d=u.clone();d.position.x=.68,r.add(d);const f=new C(new qt(.12,.14,.44,16),e);f.position.set(0,.56,0),r.add(f);const p=new C(new qt(.22,.25,.07,12),e);p.position.set(0,.28,0),r.add(p);const g=new We(.08,8,8);for(let y=0;y<5;y+=1){const x=y/5*Math.PI*2,S=new C(new X(.55,.045,.07),e);S.position.set(Math.cos(x)*.36,.19,Math.sin(x)*.36),S.rotation.y=x,r.add(S);const T=new C(g,e);T.position.set(Math.cos(x)*.64,.08,Math.sin(x)*.64),r.add(T)}return r}function O$({jacketColor:r,shirtColor:t,skinColor:e,hairColor:n}){const s=new vt,i=new bt({color:r,roughness:.75,metalness:.05}),a=new bt({color:t,roughness:.68,metalness:.03}),c=new bt({color:e,roughness:.72,metalness:.02}),u=new bt({color:n,roughness:.75,metalness:.08}),d=new C(new X(.92,1.28,.52),i);d.position.set(0,1.9,-.1),s.add(d);const f=new C(new X(1.04,.26,.56),i);f.position.set(0,2.53,-.12),s.add(f);const p=new C(new X(.32,.72,.57),a);p.position.set(0,1.95,.03),s.add(p);const g=new C(new We(.31,16,16),c);g.position.set(0,2.77,-.18),s.add(g);const y=new C(new We(.33,16,16,0,Math.PI*2,0,Math.PI*.68),u);y.position.set(0,2.9,-.2),s.add(y);const x=new C(new We(.2,14,14),u);x.scale.set(1.1,.78,.58),x.position.set(0,2.79,-.33),s.add(x);const S=new C(new We(.085,10,10),u);S.position.set(-.23,2.74,-.2),s.add(S);const T=S.clone();T.position.x=.23,s.add(T);const M=new Xt(r).multiplyScalar(.72),N=new bt({color:M,roughness:.78,metalness:.03}),v=new C(new Ou(.12,.64,4,8),N);v.position.set(-.2,1.13,.25),v.rotation.x=Math.PI*.5,v.rotation.z=Math.PI*.04,s.add(v);const A=v.clone();A.position.x=.2,A.rotation.z=-Math.PI*.04,s.add(A);const R=new C(new We(.12,12,12),N);R.position.set(-.2,1.11,.76),s.add(R);const L=R.clone();L.position.x=.2,s.add(L);const D=new C(new Ou(.095,.78,4,8),N);D.position.set(-.2,.62,.76),s.add(D);const U=D.clone();U.position.x=.2,s.add(U);const B=new bt({color:1447704,roughness:.62,metalness:.08}),P=new C(new X(.26,.14,.46),B);P.position.set(-.2,.09,.99),s.add(P);const J=P.clone();J.position.x=.2,s.add(J);const q=new C(new Ou(.11,.62,4,8),i);q.rotation.z=-Math.PI*.21,q.rotation.x=Math.PI*.08,q.position.set(-.57,2.3,-.05),s.add(q);const ft=q.clone();return ft.position.x=.57,ft.rotation.z=Math.PI*.21,s.add(ft),s}function F$(){const r=new vt,t=new bt({color:12038312,roughness:.85,metalness:.03}),e=new bt({color:8825019,roughness:.72,metalness:.02}),n=new bt({color:13873814,roughness:.72,metalness:.02}),s=new bt({color:9338216,roughness:.8,metalness:.05}),i=new C(new X(.95,1.5,.52),e);i.position.set(0,3.35,0),r.add(i);const a=new C(new Ou(.13,1.1,4,10),t);a.position.set(-.2,2.05,0),r.add(a);const c=a.clone();c.position.x=.2,r.add(c);const u=new C(new We(.32,16,16),n);u.position.set(0,4.35,-.06),r.add(u);const d=new C(new We(.34,16,16,0,Math.PI*2,0,Math.PI*.67),s);d.position.set(0,4.5,-.08),r.add(d);const f=new C(new We(.21,14,14),s);f.position.set(0,4.34,-.26),f.scale.set(1.08,.74,.55),r.add(f);const p=new C(new We(.09,10,10),s);p.position.set(-.24,4.32,-.09),r.add(p);const g=p.clone();g.position.x=.24,r.add(g);const y=new C(new Ou(.095,1.04,4,8),e);y.position.set(-.56,3.5,-.02),y.rotation.z=-Math.PI*.12,y.rotation.y=Math.PI*.08,r.add(y);const x=y.clone();return x.position.x=.56,x.rotation.z=Math.PI*.12,x.rotation.y=-Math.PI*.08,r.add(x),r}const U$={id:"nasa-facility-reveal",title:"Secret NASA Facility Reveal",create(){const r={group:null,root:null,scene:null,previousBackground:null,previousFog:null,fluorescents:[],dust:null,monitor:null,monitorLight:null,timeOffset:Math.PI*.25};return{init({root:t,camera:e,scene:n}){r.root=t,r.scene=n,r.previousBackground=n.background,r.previousFog=n.fog,n.background=new Xt(920072),n.fog=new qp(1642766,34,105),e.position.set(6,3.45,9),e.lookAt(2.5,2.2,-2.6),DE(e);const s=new vt;s.name="nasa-meeting-room",t.add(s),r.group=s;const i=E$(),a=new bt({color:9408406,map:i,roughness:.96,metalness:.02}),c=new C(new ns(di,qi),a);c.rotation.x=-Math.PI*.5,s.add(c);const u=new bt({color:3025709,roughness:.84,metalness:.08}),d=new C(new ns(di,qi),u);d.position.y=oc,d.rotation.x=Math.PI*.5,s.add(d);const f=C$(),p=new bt({color:9656378,map:f,emissive:2232585,emissiveIntensity:.08,roughness:.62,metalness:.06}),g=new bt({color:14537157,roughness:.88,metalness:.02}),y=new bt({color:3875092,roughness:.68,metalness:.12}),x=7,S=oc-x,T=new C(new X(di,x,So),p);T.position.set(0,x*.5,-qi*.5),s.add(T);const M=new C(new X(di,S,So),g);M.position.set(0,x+S*.5,-qi*.5+.02),s.add(M);const N=new C(new X(di,x,So),p);N.position.set(0,x*.5,qi*.5),s.add(N);const v=new C(new X(di,S,So),g);v.position.set(0,x+S*.5,qi*.5-.02),s.add(v);const A=new X(So,x,qi),R=new X(So,S,qi),L=new C(A,p);L.position.set(-di*.5,x*.5,0),s.add(L);const D=new C(A,p);D.position.set(di*.5,x*.5,0),s.add(D);const U=new C(R,g);U.position.set(-di*.5+.02,x+S*.5,0),s.add(U);const B=new C(R,g);B.position.set(di*.5-.02,x+S*.5,0),s.add(B);for(let Te=0;Te<12;Te+=1){const _e=new C(new X(.06,x,So+.02),y);_e.position.set(-di*.5+Te*3.3+1.4,x*.5,-qi*.5+.02),s.add(_e)}const P=new Co(14071445,1.05);s.add(P);const J=new wi(16770504,1.02);J.position.set(7.5,oc-.8,5.8),s.add(J);const q=new wi(14596504,.52);q.position.set(-8,4.2,-7.2),s.add(q);const ft=new hs(16238494,1.35,34,1.6);ft.position.set(0,5.2,-11.1),s.add(ft);const Mt=new hs(15317908,1,32,1.75);Mt.position.set(0,4.1,10.5),s.add(Mt);const mt=[[-12.5,-10.8],[-6.8,-10.6],[-.2,-10.3],[6.8,-10.5],[13.4,-10.6],[-3.2,-6.5],[3.1,-6.3],[10.2,-6.8],[-9.6,-3.2],[-2.1,-2.7],[5.8,-2.1],[13.1,-1.4]];for(let Te=0;Te<mt.length;Te+=1){const[_e,Kn]=mt[Te],ls=new bt({color:16052713,emissive:16773839,emissiveIntensity:1.35,roughness:.4,metalness:.05}),Bn=new C(new X(3.8,.14,.88),ls);Bn.position.set(_e,oc-.1,Kn),s.add(Bn);const Ee=new hs(16773073,2.95,36,1.45);Ee.position.set(_e,oc-.42,Kn),s.add(Ee);const ke=new hs(16769720,2.15,24,1.7);ke.position.set(_e,oc-.9,Kn),s.add(ke),r.fluorescents.push({baseIntensity:2.78+Te%3*.18,baseBoostIntensity:2.02+Te%3*.16,baseEmissive:1.3+Te%3*.08,light:Ee,boostLight:ke,material:ls,phase:Te*.87})}const F=new vt;F.position.set(1.4,0,-.85),s.add(F);const Y=new bt({color:8732702,roughness:.38,metalness:.18}),tt=new bt({color:6105877,roughness:.42,metalness:.14}),lt=new C(new X(13.4,.3,4.7),Y);lt.position.set(0,1.2,0),F.add(lt);const Tt=new C(new X(13.2,.12,4.4),tt);Tt.position.set(0,1.03,0),F.add(Tt);const O=new bt({color:1973536,roughness:.58,metalness:.22}),et=[[-4.8,-1.45],[4.8,-1.45],[-4.8,1.45],[4.8,1.45]];for(const[Te,_e]of et){const Kn=new C(new X(.66,1.02,.66),O);Kn.position.set(Te,.52,_e),F.add(Kn)}const z=new bt({color:14933458,roughness:.93,metalness:0}),W=new bt({color:5200230,roughness:.82,metalness:.1}),yt=[{x:-2.4,z:-1.3,r:.08},{x:2.8,z:-1.1,r:-.11},{x:-.7,z:.9,r:.04},{x:4.2,z:1.3,r:-.07}];for(const Te of yt){const _e=new C(new X(1.3,.03,.88),z);_e.position.set(Te.x,1.36,Te.z),_e.rotation.y=Te.r,F.add(_e)}const K=new C(new X(1.28,.11,.92),W);K.position.set(-5.3,1.39,-.1),K.rotation.y=.2,F.add(K);const Z=new V(F.position.x,0,F.position.z),H=[[-4.9,-4.32,.02],[-1.65,-4.36,-.03],[1.65,-4.32,0],[4.92,-4.26,.04],[-4.85,4.3,Math.PI-.03],[-1.6,4.35,Math.PI+.02],[1.62,4.35,Math.PI-.05],[4.88,4.26,Math.PI+.04],[-9.35,.05,Math.PI*.5+.08],[9.4,-.1,-Math.PI*.5-.05]],j=[];for(let Te=0;Te<H.length;Te+=1){const[_e,Kn,ls]=H[Te],Bn=g2();Bn.position.set(Z.x+_e,0,Z.z+Kn),Bn.rotation.y=ls,s.add(Bn),j.push(Bn)}const ct=[{anchor:0,jacketColor:2040619,shirtColor:14539215,skinColor:12950137,hairColor:3092271},{anchor:3,jacketColor:4010026,shirtColor:13618630,skinColor:13740932,hairColor:5190954},{anchor:4,jacketColor:4930868,shirtColor:14013647,skinColor:9069647,hairColor:2956826},{anchor:7,jacketColor:2438215,shirtColor:13685979,skinColor:12424563,hairColor:2829357},{anchor:8,jacketColor:1645085,shirtColor:13620438,skinColor:11041631,hairColor:2039585}];for(const Te of ct){const _e=O$(Te);_e.position.copy(j[Te.anchor].position),_e.rotation.y=j[Te.anchor].rotation.y,s.add(_e)}const xt=F$();xt.position.set(-3,-1.38,-9),xt.rotation.y=.5,s.add(xt);const at=[-15.4,-12.2,-9.1,-5.9,-2.8,2.8,5.9,9.1,12.2,15.4];for(let Te=0;Te<at.length;Te+=1){const _e=new vt;_e.position.set(at[Te],5.66,-qi*.5+.26),s.add(_e);const Kn=new C(new X(1.28,1.58,.1),new bt({color:987153,roughness:.54,metalness:.28}));_e.add(Kn);const ls=new C(new X(.92,1.2,.05),new bt({color:15065817,roughness:.92,metalness:.02}));ls.position.z=.05,_e.add(ls);const Bn=D$(Te),Ee=new C(new ns(.66,.88),new bt({map:Bn,roughness:.82,metalness:.02}));Ee.position.z=.09,_e.add(Ee)}const ut=B$(),$=new C(new ns(6.2,1.95),new bt({map:ut,transparent:!0,roughness:.88,metalness:.04}));$.position.set(0,6,-qi*.5+.25),s.add($);const nt=new bt({color:2763309,roughness:.5,metalness:.36}),ht=new bt({color:3158068,roughness:.42,metalness:.62}),dt=0,pt=-12.45,Rt=new C(new qt(.82,.9,3.2,20),nt);Rt.position.set(dt,1.6,pt),s.add(Rt);const Ft=new C(new qt(.08,.14,1.24,14),ht);Ft.position.set(dt,3.6,pt),s.add(Ft);const Gt=new C(new da(.72,.06,12,40,Math.PI*.78),ht);Gt.position.set(dt-.31,3.92,pt+.04),Gt.rotation.set(Math.PI*.56,-Math.PI*.05,Math.PI*.28),s.add(Gt);const ae=Gt.clone();ae.position.x=dt+.31,ae.rotation.z=-Math.PI*.28,s.add(ae);const Kt=L$();BE(Kt.ctx,Kt.canvas,0),Kt.texture.needsUpdate=!0,r.monitor=Kt;const jt=new vt;jt.position.set(di*.5-.28,4.5,-1.5),jt.rotation.y=-Math.PI*.5,s.add(jt);const ce=new C(new X(5.75,3.55,.18),new bt({color:1184534,roughness:.42,metalness:.6}));jt.add(ce);const ee=new C(new ns(5.28,3.04),new bt({color:16777215,map:Kt.texture,emissive:7906776,emissiveIntensity:.86,roughness:.36,metalness:.08}));ee.position.z=.11,jt.add(ee);const Re=new C(new qt(.17,.22,2.8,12),new bt({color:4804439,roughness:.36,metalness:.76}));Re.position.set(0,-3.08,-.02),jt.add(Re);const je=new C(new qt(.65,.82,.22,20),new bt({color:2501169,roughness:.42,metalness:.66}));je.position.set(0,-4.55,-.02),jt.add(je);const pn=new hs(11188681,.24,10,2);pn.position.set(di*.5-1.9,4.38,-1.5),s.add(pn),r.monitorLight=pn;const os=g2();os.position.set(-17,.02,3.8),os.rotation.y=Math.PI*.5,s.add(os);const jn=g2();jn.scale.set(.95,.95,.95),jn.position.set(-17.02,1.16,3.8),jn.rotation.y=Math.PI*.5,s.add(jn);const Yn=680,we=new Float32Array(Yn*3),Ye=Hx(904);for(let Te=0;Te<Yn;Te+=1){const _e=Te*3;we[_e]=(Ye()-.5)*(di-2.4),we[_e+1]=.6+Ye()*(oc-1.3),we[_e+2]=(Ye()-.5)*(qi-2)}const Dn=new Qe;Dn.setAttribute("position",new fs(we,3));const Ge=new er({color:14932168,size:.055,transparent:!0,opacity:.26,depthWrite:!1,sizeAttenuation:!0}),as=new to(Dn,Ge);as.position.y=.15,s.add(as),r.dust=as},update({delta:t,elapsed:e,camera:n}){if(r.group){DE(n);for(const s of r.fluorescents){const i=.985+Math.sin(e*.62+s.phase+r.timeOffset)*.025,a=Math.sin(e*9+s.phase*1.6)*.004,c=i+a;s.light.intensity=s.baseIntensity*c,s.boostLight.intensity=s.baseBoostIntensity*c,s.material.emissiveIntensity=s.baseEmissive*c}r.monitor&&(BE(r.monitor.ctx,r.monitor.canvas,e),r.monitor.texture.needsUpdate=!0),r.monitorLight&&(r.monitorLight.intensity=.22+Math.sin(e*2.2)*.04),r.dust&&(r.dust.rotation.y+=t*.028,r.dust.position.y=.15+Math.sin(e*.26)*.06,r.dust.material.opacity=.24+Math.sin(e*.8)*.04)}},resize(){},dispose(){r.scene&&(r.scene.background=r.previousBackground,r.scene.fog=r.previousFog),r.group&&(r.root&&r.group.parent!==r.root&&r.root.add(r.group),Fi(r.group)),r.group=null,r.root=null,r.scene=null,r.previousBackground=null,r.previousFog=null,r.fluorescents.length=0,r.dust=null,r.monitor=null,r.monitorLight=null}}}},or=1,Is=or/1e3,rL=6371,oL=110,ea=rL*or,kp=(rL+oL)*or,ac=kp-ea,P$=420*or,z$=P$,I$=.6*or,V$=2200*or,G$=4.2*or,k$=26*or,H$=.14*or,W$=.62*or,q$=1.35,$$=.12*or,X$=.08*or,cp=5,j$=11,Y$=8,K$=35e-5,Z$=.35,Tg=.14,Q$=32,J$=.34,tX=ac,LE=1,y2=new Xt(8366292),OE=new V(.83,.34,-.45).normalize(),eX=28.573,nX=-80.649,sX=0,iX=0,rX=.2,Ql=1.2,Sc=24,x2=13.2,mw=1.2,Xg=4,b2=Sc+mw+Xg,oX=0,aX=6.2,lX=5.4,cX=2,uX=.85,FE=.7,hX=10,dX=5.2,fX=1.9,pX=.72,mX=.65,gX=-3.4*Is,yX=4.2*Is,xX=1.2*Is,bX=-5.2*Is,SX=5.8*Is,wX=4.2*Is,TX=-18*Is,_X=12*Is,MX=10*Is,vX=6.2,AX=-2.2*Is,NX=-38*Is,RX=1.4*Is,EX=12*Is,CX=1.8*Is,DX=30*Is,UE=2,BX=10,LX=30,OX=.06,FX=.15,M_=0,UX=M_-ea,PE=18,zE=10,PX=1.7,IE=new Xt(8300498),zX=new Xt(132106),un=new V,ni=new V,Hs=new V,Ls=new V,$a=new V,_g=new V,Zf=new V,Jl=new Ps,td=new Ps,S2=new V,VE=new V,yu=new V,w2=new V,GE=new V,kE=new V,HE=new V,WE=new Xt,qE=new Xt,Xa=new Xt,tc=new V(1,1,1),$E=new V,gw=new V(0,1,0),IX=new V(0,58.5,0),VX=new V(0,104,0),GX=new Set(["KeyW","KeyA","KeyS","KeyD","Space","ShiftLeft","ShiftRight"]);function Iu(r){return St.clamp(r,0,1)}function Fs(r,t,e){if(r===t)return e<r?0:1;const n=Iu((e-r)/(t-r));return n*n*(3-2*n)}function Ri(r){return(Math.random()*2-1)*r}function Rs(r){return r*Is}function kX(r,t){const e=St.degToRad(r),n=St.degToRad(t),s=Math.cos(e);return new V(Math.sin(n)*s,Math.sin(e),Math.cos(n)*s).normalize()}function HX(r){const t=St.clamp(r,0,Sc),e=Math.min(cp,Sc),n=Math.min(j$,Math.max(Sc-e,0)),s=Math.max(Math.min(Y$,Sc-e-n),1e-6),i=e,a=i+n,c=St.clamp(K$,1e-4,.15),u=c/Math.max(e,1e-6),f=Math.max(1-c,1e-6)-u*(n+s*.5),p=.5*n*(n+s),g=Math.max(f/Math.max(p,1e-6),1e-6),y=u+g*n,x=y/s,S=u*n+.5*g*n*n;if(t<=i)return{distance:u*t,phaseOneEnd:i,phaseTwoEnd:a,speed:u,totalDistance:1,velocity01:St.clamp(u/Math.max(y,1e-6),0,1)};if(t<=a){const v=t-i,A=u+g*v,R=c+u*v+.5*g*v*v;return{distance:St.clamp(R,0,1),phaseOneEnd:i,phaseTwoEnd:a,speed:A,totalDistance:1,velocity01:St.clamp(A/Math.max(y,1e-6),0,1)}}const T=Math.min(t-a,s),M=Math.max(0,y-x*T),N=c+S+y*T-.5*x*T*T;return{distance:St.clamp(N,0,1),phaseOneEnd:i,phaseTwoEnd:a,speed:M,totalDistance:1,velocity01:St.clamp(M/Math.max(y,1e-6),0,1)}}function ec(r,t){return[r[0]*t,r[1]*t,r[2]*t]}function WX(r){let t=1;switch(r){case"terrestrial":t=2.15;break;case"rocky":t=2;break;case"gasGiant":case"iceGiant":t=1.35;break;default:t=1;break}return t*PX}function qX(r,t){const e=Math.max(r.atmosphereHeightKm,1),n=St.clamp(r.atmosphereDensity,.15,1.8),s=St.clamp((n-.25)/1.35,0,1),i=WX(r.kind);let a={rayleighScatteringKm:[.0058,.0135,.0331],mieScatteringKm:[.0022,.0022,.0022],mieExtinctionKm:[.0032,.0032,.0032],rayleighScaleHeightKm:St.lerp(7.2,10.8,s),upperRayleighScaleHeightKm:Math.max(36,e*.36*i),upperRayleighStrength:.04,mieScaleHeightKm:St.lerp(.9,1.7,s),miePhaseG:.76,ozoneExtinctionKm:[65e-5,.001881,85e-6],ozoneCenterHeightKm:Math.min(e*.42,26),ozoneWidthKm:Math.max(6,Math.min(e*.18,14)),solarIntensity:13.8};const c=n,u=n*1.02,d=ec(a.rayleighScatteringKm,c),f=ec(a.mieScatteringKm,u),p=ec(a.mieExtinctionKm,u),g=[Math.max(p[0],f[0]+1e-4),Math.max(p[1],f[1]+1e-4),Math.max(p[2],f[2]+1e-4)],y=ec(a.ozoneExtinctionKm??[0,0,0],n),x=t,S=1/Math.max(x,1e-6);return{rayleighScatteringWorld:ec(d,S),mieScatteringWorld:ec(f,S),mieExtinctionWorld:ec(g,S),ozoneExtinctionWorld:ec(y,S),rayleighScaleHeightWorld:Math.max(a.rayleighScaleHeightKm*x,1e-5),upperRayleighScaleHeightWorld:Math.max((a.upperRayleighScaleHeightKm??a.rayleighScaleHeightKm*2.6)*x,1e-5),upperRayleighStrength:St.clamp(a.upperRayleighStrength,0,.24),mieScaleHeightWorld:Math.max(a.mieScaleHeightKm*x,1e-5),ozoneCenterHeightWorld:Math.max((a.ozoneCenterHeightKm??0)*x,0),ozoneWidthWorld:Math.max((a.ozoneWidthKm??1)*x,1e-5),miePhaseG:St.clamp(a.miePhaseG,0,.92),solarIntensity:a.solarIntensity??18}}function $X(r,t,e,n,s,i,a,c){const u=Dt(c.rayleighScatteringWorld[0],c.rayleighScatteringWorld[1],c.rayleighScatteringWorld[2]),d=Dt(c.mieScatteringWorld[0],c.mieScatteringWorld[1],c.mieScatteringWorld[2]),f=Dt(c.mieExtinctionWorld[0],c.mieExtinctionWorld[1],c.mieExtinctionWorld[2]),p=Dt(c.ozoneExtinctionWorld[0],c.ozoneExtinctionWorld[1],c.ozoneExtinctionWorld[2]),g=k(c.rayleighScaleHeightWorld),y=k(c.upperRayleighScaleHeightWorld),x=k(c.upperRayleighStrength),S=k(c.mieScaleHeightWorld),T=k(c.ozoneCenterHeightWorld),M=k(c.ozoneWidthWorld),N=k(c.miePhaseG),v=k(c.solarIntensity),A=_n(()=>{const L=ir,D=Cn(kc.sub(ir)),U=Cn(r),B=t,P=e,J=n,q=le(J.sub(P),P.mul(.005)),ft=q.mul(.24),Mt=q.mul(.16),mt=L.sub(B),F=xe(mt,D),Y=xe(mt,mt).sub(J.mul(J)),tt=F.mul(F).sub(Y),lt=me(0,tt),Tt=Mr(le(tt,0)),O=dn(F.negate().sub(Tt),F.negate().add(Tt)),et=xe(mt,D),z=xe(mt,mt).sub(P.mul(P)),W=et.mul(et).sub(z),yt=me(0,W),K=Mr(le(W,0)),Z=dn(et.negate().sub(K),et.negate().add(K)),H=me(0,Z.x).mul(yt),j=le(O.x,0).mul(lt),ct=le(Zt(O.y,__(O.y,Z.x),H),0).mul(lt),xt=le(ct.sub(j),0),at=xt.div(k(PE)),ut=ln(0,Mt,xt),$=xe(D,U),nt=k(.05968310365946075).mul(k(1).add($.mul($))),ht=N.mul(N),dt=k(.07957747154594767).mul(k(1).sub(ht)).div(zn(k(1).add(ht).sub(k(2).mul(N).mul($)),1.5)),pt=k(0).toVar(),Rt=k(0).toVar(),Ft=k(0).toVar(),Gt=Dt(0,0,0).toVar();ma(PE,({i:os})=>{const jn=j.add(at.mul(k(os).add(.5))),Yn=L.add(D.mul(jn)),we=Yn.sub(B),Ye=Ao(we),Dn=Ye.sub(P),Ge=me(0,Dn),as=le(Dn,0),Te=le(J.sub(Ye),0),_e=ln(0,ft,Te),Kn=En(as.negate().div(g)),ls=En(as.negate().div(y)).mul(x),Bn=Kn.add(ls).mul(Ge).mul(_e),Ee=En(as.negate().div(S)).mul(Ge).mul(_e),ke=le(k(1).sub(oi(as.sub(T)).div(M)),0).mul(Ge).mul(_e);pt.addAssign(Bn.mul(at)),Rt.addAssign(Ee.mul(at)),Ft.addAssign(ke.mul(at));const $e=xe(we,U),js=xe(we,we).sub(J.mul(J)),oo=$e.mul($e).sub(js),Rr=me(0,oo),Ui=Mr(le(oo,0)),Do=dn($e.negate().sub(Ui),$e.negate().add(Ui)),ao=le(Do.x,0).mul(Rr),Ys=le(Do.y.sub(ao),0).mul(Rr).div(k(zE)),_i=xe(we,U),ba=xe(we,we).sub(P.mul(P)),lo=_i.mul(_i).sub(ba),gl=me(0,lo),Pi=Mr(le(lo,0)),Zn=_i.negate().sub(Pi),Ts=k(1).sub(me(0,Zn).mul(gl)),Mi=k(0).toVar(),Er=k(0).toVar(),Bo=k(0).toVar();ma(zE,({i:Cr})=>{const Dr=ao.add(Ys.mul(k(Cr).add(.5))),uo=Yn.add(U.mul(Dr)),vi=Ao(uo.sub(B)),vn=vi.sub(P),zi=me(0,vn),Ks=le(vn,0),ar=le(J.sub(vi),0),Vs=ln(0,ft,ar),Wc=En(Ks.negate().div(g)),xl=En(Ks.negate().div(y)).mul(x);Mi.addAssign(Wc.add(xl).mul(Ys).mul(zi).mul(Vs)),Er.addAssign(En(Ks.negate().div(S)).mul(Ys).mul(zi).mul(Vs)),Bo.addAssign(le(k(1).sub(oi(Ks.sub(T)).div(M)),0).mul(Ys).mul(zi).mul(Vs))});const Hc=u.mul(pt).add(f.mul(Rt)).add(p.mul(Ft)),yl=u.mul(Mi).add(f.mul(Er)).add(p.mul(Bo)),co=En(Hc.add(yl).negate()).mul(Ts),Sa=u.mul(Bn.mul(nt)).add(d.mul(Ee.mul(dt)));Gt.addAssign(Sa.mul(co).mul(at))});const ae=u.mul(pt).add(f.mul(Rt)).add(p.mul(Ft)),Kt=En(ae.negate()),jt=Dt(1,1,1).sub(Kt).mul(u.mul(.018).add(d.mul(.0035))).mul(v.mul(.38)),ce=Gt.mul(v).add(jt).mul(ut),ee=ce.div(ce.mul(.22).add(Dt(1,1,1))),Re=xe(Kt,Dt(.2126,.7152,.0722)).clamp(0,1),je=T_.select(i,a),pn=zn(k(1).sub(Re),1.15).mul(ut).mul(s).mul(je).clamp(0,1);return zu(ee,pn)}),R=new Bc;return R.outputNode=A(),R.transparent=!0,R.premultipliedAlpha=!1,R.depthWrite=!1,R.depthTest=!0,R.side=ss,R.blending=mi,R}function XX({atmosphereCenter:r,bodyRadius:t,cameraPosition:e,model:n,sunDirection:s,targetPosition:i,topRadius:a}){yu.copy(i).sub(e);const c=yu.length();if(c<1e-5)return{airlight:y2,effectWeight:0,transLuma:1,transmittance:tc.set(1,1,1)};yu.multiplyScalar(1/c),w2.copy(e).sub(r);const u=w2.dot(yu),d=w2.lengthSq()-a*a,f=u*u-d;if(f<=0)return{airlight:y2,effectWeight:0,transLuma:1,transmittance:tc.set(1,1,1)};const p=Math.sqrt(Math.max(f,0)),g=-u-p,y=-u+p,x=Math.max(g,0),S=Math.min(c,y),T=Math.max(S-x,0);if(T<=1e-5)return{airlight:y2,effectWeight:0,transLuma:1,transmittance:tc.set(1,1,1)};GE.copy(e).addScaledVector(yu,x).sub(r),kE.copy(e).addScaledVector(yu,S).sub(r);const M=GE.length(),N=kE.length(),v=Math.max(M-t,0),A=Math.max(N-t,0),R=Math.max(a-t,1e-5),L=Fs(Z$,R*.72,T),D=Math.max(n.rayleighScaleHeightWorld,R*.16),U=Math.max(n.mieScaleHeightWorld,R*.08),B=Math.exp(-v/D),P=Math.exp(-A/D),J=Math.exp(-v/U),q=Math.exp(-A/U),ft=(B+P)*T*.5,Mt=(J+q)*T*.5,mt=new V(n.rayleighScatteringWorld[0]*ft,n.rayleighScatteringWorld[1]*ft,n.rayleighScatteringWorld[2]*ft),F=new V(n.mieExtinctionWorld[0]*Mt,n.mieExtinctionWorld[1]*Mt,n.mieExtinctionWorld[2]*Mt);tc.set(Math.exp(-(mt.x+F.x)*Tg),Math.exp(-(mt.y+F.y)*Tg),Math.exp(-(mt.z+F.z)*Tg)),HE.copy(s).normalize();const Y=St.clamp(yu.dot(HE),-1,1),tt=.05968310365946075*(1+Y*Y),lt=n.miePhaseG,Tt=lt*lt,O=.07957747154594767*(1-Tt)/Math.pow(1+Tt-2*lt*Y,1.5),et=new V(n.rayleighScatteringWorld[0]*ft*tt,n.rayleighScatteringWorld[1]*ft*tt,n.rayleighScatteringWorld[2]*ft*tt),z=new V(n.mieScatteringWorld[0]*Mt*O,n.mieScatteringWorld[1]*Mt*O,n.mieScatteringWorld[2]*Mt*O),W=n.solarIntensity*Tg*.34;Xa.setRGB((et.x+z.x)*W,(et.y+z.y)*W,(et.z+z.z)*W),Xa.setRGB(Xa.r/(Xa.r*.24+1),Xa.g/(Xa.g*.24+1),Xa.b/(Xa.b*.24+1));const yt=St.clamp(tc.x*.2126+tc.y*.7152+tc.z*.0722,0,1);return{airlight:Xa,effectWeight:St.clamp(L,0,1),transLuma:yt,transmittance:tc}}function jX(r){const t=new vt;t.name="scene05-earth-system";const e=Iq.normalize(),n=Cn(ir.sub(kc)),s=new bt({color:16777215,map:r,metalness:0,roughness:.96}),i=new C(new We(ea,144,96),s);i.name="scene05-earth",i.receiveShadow=!0,i.castShadow=!1,t.add(i);const a=new Xs({transparent:!0,depthWrite:!1,roughness:.94,metalness:0}),c=e.mul(18).add(Dt(Rc.mul(.016),Rc.mul(-.011),Rc.mul(.007))),u=hi(c),d=hi(c.mul(2.5).add(Dt(-3.6,5.2,7.1))),f=ln(.56,.88,u.mul(.7).add(d.mul(.3))),p=k(1).sub(oi(xe(e,n))).pow(3.1);a.colorNode=Zt(Ke(9481160),Ke(16777215),f),a.opacityNode=f.mul(.2).add(p.mul(.1)).clamp(0,.28);const g=new C(new We(ea*1.008,120,72),a);g.name="scene05-earth-clouds",g.castShadow=!1,g.receiveShadow=!1,g.visible=!1,t.add(g);const y=new V(0,-ea+M_,0),x=qX({atmosphereDensity:1,atmosphereHeightKm:oL,kind:"terrestrial"},or),S=he(1),T=he(1),M=he(0),N=$X(he(OE.clone()),he(y.clone()),he(ea),he(kp),S,T,M,x),v=new C(new We(kp,128,80),N);v.name="scene05-earth-atmosphere",t.add(v),t.position.copy(y);const A=kX(eX,nX),R=new Ps().setFromUnitVectors(A,gw);return t.quaternion.copy(R),t.rotateY(St.degToRad(sX)),{atmosphereCenter:y,atmosphereModel:x,atmosphere:v,atmosphereBackFaceOpacity:M,clouds:g,earth:i,group:t,atmosphereFrontFaceOpacity:T,atmosphereShellOpacity:S,sunDirection:OE.clone()}}function YX(){const r=new vt;r.name="scene05-nasa-launch-facility";const t=new bt({color:6251629,metalness:.08,roughness:.92}),e=new bt({color:12107464,metalness:.72,roughness:.36}),n=new bt({color:3620166,metalness:.66,roughness:.44}),s=new C(new qt(102,118,14,72),t);s.position.y=1,s.receiveShadow=!0,r.add(s);const i=new C(new qt(24,28,28,40),n);i.position.y=-10,r.add(i);const a=new C(new qt(30,34,126,64,1,!0),e);a.position.y=63,r.add(a);const c=new C(new qt(41,45,132,64,1,!0),n);c.position.y=66,c.material=c.material.clone(),c.material.opacity=.92,c.material.transparent=!0,r.add(c);const u=new C(new da(36,1.8,18,64),n);u.position.y=127,u.rotation.x=Math.PI/2,r.add(u);const d=new C(new da(34,1.3,14,48),e);d.position.y=20,d.rotation.x=Math.PI/2,r.add(d);for(let p=0;p<18;p+=1){const g=p/18*Math.PI*2,y=36.2,x=new C(new X(1.2,124,2.4),e);x.position.set(Math.cos(g)*y,63,Math.sin(g)*y),x.castShadow=!0,r.add(x)}const f=[];for(let p=0;p<3;p+=1){const g=48+p*24;for(let y=0;y<3;y+=1){const x=y/3*Math.PI*2+p*.17,S=new vt;S.position.set(Math.cos(x)*31,g,Math.sin(x)*31),S.rotation.y=x+Math.PI;const T=new C(new X(20,1.4,2.2),e);T.position.z=10,T.castShadow=!0,S.add(T);const M=new C(new X(3.4,3.4,3.4),n);M.position.z=20.5,S.add(M),S.userData.retractAngle=-.78-p*.08,f.push(S),r.add(S)}}return r.scale.setScalar(Is),{group:r,serviceArms:f}}function Mg({boostOuterColor:r,boostTint:t=.4,flickerScale:e=8.5,flickerSpeed:n=3.2,height:s,innerColor:i,intensityGain:a=2.2,outerColor:c,radiusBottom:u,radiusTop:d}){const f=new qt(d,u,s,28,1,!0);f.translate(0,-s*.5,0);const p=he(0),g=he(0),y=ji.y.negate().div(s).clamp(0,1),x=k(1).sub(y).pow(2.1),S=ji.xz.length(),M=k(1).sub(S.div(u)).clamp(0,1).pow(1.35+e*.012),N=Rc.mul(n).sin().mul(.045).add(.955),v=x.mul(M).mul(N).mul(p).mul(a),A=Zt(k(1),k(1.54),g),R=Zt(Ke(i),Ke(r),g.mul(t)),L=Zt(Ke(c),Ke(r),g),D=Zt(R,L,y).mul(v).mul(A),U=new Bc;U.colorNode=D,U.opacityNode=v,U.transparent=!0,U.depthWrite=!1,U.blending=Tr;const B=new C(f,U);return B.visible=!1,{mesh:B,setPower:(P,J=!1)=>{const q=Iu(P);p.value=q,g.value=J?1:0,B.visible=q>.003,B.scale.set(1+q*.1,.85+q*.65,1+q*.1)}}}function KX(){const r=new vt;r.name="scene05-launch-rocket";const t=new bt({color:15856888,metalness:.26,roughness:.43}),e=new bt({color:3093825,metalness:.44,roughness:.38}),n=new bt({color:10265519,metalness:.74,roughness:.28}),s=new vt;s.name="scene05-stage-one",r.add(s);const i=new C(new qt(4.2,4.8,62,32),t);i.position.y=31,i.castShadow=!0,s.add(i);const a=new C(new qt(4.35,4.6,4.8,32),e);a.position.y=17,s.add(a);const c=new C(new qt(6.2,5.2,8,28),n);c.position.y=4,s.add(c);for(let jt=0;jt<4;jt+=1){const ce=jt/4*Math.PI*2,ee=new C(new qt(1.28,1.44,44,16),t);ee.position.set(Math.cos(ce)*7.1,24,Math.sin(ce)*7.1),ee.castShadow=!0,s.add(ee)}const u=new vt;u.name="scene05-upper-stage",u.position.y=62,r.add(u);const d=new vt;d.name="scene05-ranger-payload",d.position.y=41,d.visible=!1;const f=t.clone();f.metalness=.22,f.roughness=.5;const p=e.clone();p.metalness=.38,p.roughness=.42;const g=new bt({color:2372169,metalness:.35,roughness:.18,transparent:!0,opacity:.82});g.depthWrite=!1,g.polygonOffset=!0,g.polygonOffsetFactor=-2,g.polygonOffsetUnits=-2;const y=[new Ut(0,5),new Ut(.65,4.25),new Ut(2.3,2.85),new Ut(3.7,-.6),new Ut(3.1,-2.3),new Ut(1.55,-5.05),new Ut(.7,-4.55),new Ut(0,-4.2),new Ut(-.7,-4.55),new Ut(-1.55,-5.05),new Ut(-3.1,-2.3),new Ut(-3.7,-.6),new Ut(-2.3,2.85),new Ut(-.65,4.25)],x=.58,S=new ld(y),T=new bp(S,{depth:x,bevelEnabled:!1});T.translate(0,0,-x*.5);const M=new C(T,f);M.castShadow=!0,d.add(M);const N=y.map(jt=>new Ut(jt.x*1.07,jt.y*1.03)),v=y.map(jt=>new Ut(jt.x*.91,jt.y*.95)),A=new ld(N);A.holes.push(new V2(v));const R=.1,L=.05,D=new bp(A,{depth:R,bevelEnabled:!1});D.translate(0,0,-R*.5);const U=x*.5+R*.5+L,B=new C(D,p);B.position.z=U,B.castShadow=!0,d.add(B);const P=new C(D,p);P.position.z=-U,P.castShadow=!0,d.add(P);const J=[new Ut(0,3.85),new Ut(.95,3.3),new Ut(1.2,2.05),new Ut(.75,.85),new Ut(0,.5),new Ut(-.75,.85),new Ut(-1.2,2.05),new Ut(-.95,3.3)],q=.22,ft=new ld(J),Mt=new bp(ft,{depth:q,bevelEnabled:!1});Mt.translate(0,0,-q*.5);const mt=new C(Mt,f);mt.position.set(0,.2,x*.5+q*.5+.05),mt.castShadow=!0,d.add(mt);const F=x*.5+q+.11,Y=[new Ut(0,1.45),new Ut(.95,1.12),new Ut(1.25,.25),new Ut(1.02,-.9),new Ut(0,-1.25),new Ut(-1.02,-.9),new Ut(-1.25,.25),new Ut(-.95,1.12)],tt=new ld(Y),lt=new Iw(tt,8),Tt=new C(lt,g);Tt.position.set(0,2.35,F),Tt.renderOrder=10,d.add(Tt);const O=new C(new X(.18,5.9,.22),p);O.position.set(2.8,-.8,U+R*.5+.11+.03),O.rotation.z=St.degToRad(-14),d.add(O);const et=new C(new X(.18,5.9,.22),p);et.position.set(-2.8,-.8,U+R*.5+.11+.03),et.rotation.z=St.degToRad(14),d.add(et);const z=new C(new X(1.6,1.35,.6),p);z.position.set(0,-4.25,-.73),d.add(z);const W=new C(new X(.48,.9,.45),n);W.position.set(.65,-4.95,-.675),d.add(W);const yt=new C(new X(.48,.9,.45),n);yt.position.set(-.65,-4.95,-.675),d.add(yt),d.rotation.set(St.degToRad(4),0,0),u.add(d);const K=t.clone();K.side=ss;const Z=e.clone();Z.side=ss;const H=n.clone();H.side=ss;const j=new vt;j.name="scene05-stage-two-fairing-fragments",u.add(j);const ct=[];for(let jt=0;jt<2;jt+=1){const ce=jt===0?-1:1,ee=ce>0?-Math.PI*.5:Math.PI*.5,Re=new vt;Re.userData.sideSign=ce;const je=new C(new qt(3,3.4,31,28,1,!0,ee,Math.PI),K);je.position.y=15.5,je.castShadow=!0,Re.add(je);const pn=new C(new qt(3.15,3.15,3.2,24,1,!0,ee,Math.PI),Z);pn.position.y=8,pn.castShadow=!0,Re.add(pn);const os=new C(new qt(2.55,3,6.2,24,1,!0,ee,Math.PI),H);os.position.y=34,os.castShadow=!0,Re.add(os);const jn=new C(new qt(2.06,2.06,9.3,24,1,!0,ee,Math.PI),K);jn.position.y=40.5,jn.castShadow=!0,Re.add(jn);const Yn=new C(new gi(2.5,12.5,24,1,!0,ee,Math.PI),K);Yn.position.y=49.2,Yn.castShadow=!0,Re.add(Yn);const we=new C(new qt(.95,1.5,3.8,18,1,!1,ee,Math.PI),H);we.position.y=-.25,we.castShadow=!0,Re.add(we);const Ye=3.42,Dn=1.32,Ge=new C(new cx(Dn,Ye,36,1,ee,Math.PI),K);Ge.rotation.x=-Math.PI/2,Ge.position.y=0,Ge.castShadow=!0,Re.add(Ge),Re.position.set(0,0,0),Re.rotation.set(0,0,0),ct.push(Re),j.add(Re)}const xt=[],at=new qt(1.35,2.1,4.8,20);for(let jt=0;jt<5;jt+=1){const ce=jt/4*Math.PI*2,ee=jt===4,Re=ee?0:Math.cos(ce)*2.5,je=ee?0:Math.sin(ce)*2.5,pn=new C(at,n);pn.position.set(Re,.8,je),s.add(pn),xt.push(new V(Re,-1.4,je))}const ut=[new V(0,60.25,0)],$=new vt;$.position.y=-.8,s.add($);const nt=Mg({boostOuterColor:8378879,boostTint:.35,flickerScale:9.8,flickerSpeed:3.7,height:52,innerColor:16774090,intensityGain:2.3,outerColor:16749635,radiusBottom:6.6,radiusTop:2.5}),ht=Mg({boostOuterColor:11135231,boostTint:.25,flickerScale:11.4,flickerSpeed:4.5,height:37,innerColor:16777215,intensityGain:2.85,outerColor:16764276,radiusBottom:3.15,radiusTop:.9});$.add(nt.mesh,ht.mesh);const dt=new C(new We(3.6,20,14),new xn({color:16767130,transparent:!0,opacity:.56,blending:Tr,depthWrite:!1}));dt.scale.set(1.2,.66,1.2),dt.position.y=-2.2,$.add(dt);const pt=new vt;pt.position.y=-1.4,pt.visible=!1,u.add(pt);const Rt=Mg({boostOuterColor:8707327,flickerScale:10.3,flickerSpeed:3.9,height:20,innerColor:16775124,intensityGain:2.4,outerColor:16755542,radiusBottom:2.65,radiusTop:.82}),Ft=Mg({boostOuterColor:11923199,boostTint:.2,flickerScale:12.2,flickerSpeed:4.7,height:13.5,innerColor:16777215,intensityGain:3,outerColor:16766867,radiusBottom:1.25,radiusTop:.4});pt.add(Rt.mesh,Ft.mesh);const Gt=new C(new We(1.7,16,12),new xn({color:16770750,transparent:!0,opacity:.62,blending:Tr,depthWrite:!1}));Gt.scale.set(1.16,.54,1.16),Gt.position.y=-.95,pt.add(Gt);function ae(jt,ce=!1){const ee=Iu(jt);nt.setPower(ee,ce),ht.setPower(ee,ce),$.visible=ee>.003,dt.visible=$.visible,dt.material.opacity=St.lerp(.2,.6,ee),dt.scale.setScalar(St.lerp(.72,1.34,ee)),dt.scale.y*=.56}function Kt(jt,ce=!1){const ee=Iu(jt);Rt.setPower(ee,ce),Ft.setPower(ee,ce),pt.visible=ee>.003,Gt.visible=pt.visible,Gt.material.opacity=St.lerp(.22,.64,ee),Gt.scale.setScalar(St.lerp(.76,1.26,ee)),Gt.scale.y*=.54}return r.scale.setScalar(Is),{group:r,stageOne:s,stageOneNozzles:xt,setStageOnePlume:ae,setStageTwoPlume:Kt,stageTwoNozzles:ut,upperStage:u,rangerPayload:d,stageTwoFragments:ct}}function ZX(){const r=new vt;r.name="scene05-endurance";const t=new bt({color:14540253,roughness:.4,metalness:.6}),e=new bt({color:3355443,roughness:.5,metalness:.7}),n=new bt({color:1118481,roughness:.15,metalness:.9}),s=new bt({color:328965,roughness:.05,metalness:.8}),i=[t,e,n,s],a=i.map(B=>B.color.clone());for(const B of i)B.transparent=!0,B.opacity=1;const c=32,u=12;for(let B=0;B<u;B+=1){const P=B/u*Math.PI*2,J=new vt,q=new C(new X(8,7,10),t);q.castShadow=!0,q.receiveShadow=!0,J.add(q);const ft=new C(new X(7.5,6.5,1),n);ft.position.set(0,0,-4.6),ft.castShadow=!0,ft.receiveShadow=!0,J.add(ft);const Mt=new C(new X(8.2,2,4),e);Mt.position.set(0,0,1),J.add(Mt),J.position.set(Math.cos(P)*c,Math.sin(P)*c,0),J.rotation.z=P+Math.PI/2,J.lookAt(0,0,0),r.add(J);const mt=P+Math.PI/u,F=new vt;F.position.set(Math.cos(mt)*c,Math.sin(mt)*c,0),F.rotation.z=mt;const Y=new C(new qt(2,2,9,32),t);Y.castShadow=!0,Y.receiveShadow=!0,F.add(Y);const tt=new C(new qt(2.8,2.8,2.5,32),t);F.add(tt);const lt=new C(new qt(1.2,1.2,3.5,32),s);lt.rotation.z=Math.PI/2,F.add(lt);const Tt=new C(new qt(1.5,1.5,3.2,32),e);Tt.rotation.z=Math.PI/2,F.add(Tt),r.add(F)}const d=c-5,f=new vt;f.position.set(0,d/2+2,0);const p=new C(new qt(2.5,2.5,d,32),t);p.castShadow=!0,p.receiveShadow=!0,f.add(p);for(let B=-1;B<=1;B+=1){const P=new C(new qt(3,3,2,32),e);P.position.y=B*(d/3),f.add(P)}r.add(f);const g=new C(new qt(4,4,3,32),t);g.rotation.x=Math.PI/2,g.castShadow=!0,g.receiveShadow=!0,r.add(g);const y=new C(new da(3,.5,16,64),e);y.position.z=1.5,r.add(y);const x=new vt,S=new gi(4.5,10,4);S.rotateY(Math.PI/4),S.rotateX(Math.PI/2),S.scale(1.1,.2,1);const T=new C(S,t);T.castShadow=!0,T.receiveShadow=!0,x.add(T);const M=S.clone();M.scale(.98,.5,.98),M.translate(0,-.15,0);const N=new C(M,e);N.castShadow=!0,x.add(N);const v=new C(new X(2.2,.8,3.5),t);v.position.set(0,.4,0),v.rotation.x=Math.PI/16,v.castShadow=!0,x.add(v);const A=new C(new X(1.8,.6,1.5),s);A.position.set(0,.7,1.2),A.rotation.x=Math.PI/6,x.add(A);const R=new X(3.5,.2,4),L=new C(R,t);L.position.set(-2.8,0,-2.5),L.rotation.y=Math.PI/8,L.castShadow=!0,x.add(L);const D=new C(R,t);D.position.set(2.8,0,-2.5),D.rotation.y=-Math.PI/8,D.castShadow=!0,x.add(D);const U=new C(new X(3,1,1.5),e);return U.position.set(0,-.1,-4.8),x.add(U),x.position.set(0,0,7.5),x.rotation.set(0,0,0),r.add(x),r.scale.setScalar(Is*q$),{baseColors:a,group:r,materials:i}}function QX(){const t=new Float32Array(15600),e=new Float32Array(5200*3),n=ea*180,s=new V;for(let u=0;u<5200;u+=1){const d=u*3,f=Math.acos(St.randFloatSpread(2)),p=Math.random()*Math.PI*2,g=Math.sin(f);s.set(g*Math.cos(p),Math.cos(f),g*Math.sin(p)),t[d]=s.x*n,t[d+1]=s.y*n,t[d+2]=s.z*n;const y=St.randFloat(.14,.98),x=Math.pow(Math.random(),1.1),S=St.clamp(y*(.58+x*.72),.06,1),T=St.randFloat(-.08,.08);e[d]=St.clamp(S+T*.5,.04,1),e[d+1]=St.clamp(S+T*.15,.04,1),e[d+2]=St.clamp(S-T*.45,.04,1)}const i=new Qe;i.setAttribute("position",new ge(t,3)),i.setAttribute("color",new ge(e,3));const a=new er({color:16777215,size:1.38,sizeAttenuation:!1,transparent:!0,opacity:0,depthWrite:!1,vertexColors:!0}),c=new to(i,a);return c.name="scene05-space-stars",c}function JX(){const r=new vt;return r.name="scene05-exhaust-particles-disabled",r.visible=!1,{clear(){},points:r,update(){}}}const tj={id:"endurance-launch",title:"Endurance Launch from Earth",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,g=0,y=0,x=0,S=null,T=null,M=null,N=[],v=[];const A=new Xt,R={elapsed:0,orbitPitch:0,orbitYaw:0,previousRocketPosition:new V,rocketVelocity:new V,rocketAcceleration:new V,sequenceComplete:!1,stageOneDetached:!1,detachedAlongOffset:0,detachedAlongSpeed:0,detachedSideOffset:0,detachedSideSpeed:0,detachedEarthOffset:0,detachedEarthSpeed:0,detachedSideSign:1,detachedSideDirection:new V(1,0,0),detachedTiltBaseQuaternion:new Ps,detachedTiltTargetQuaternion:new Ps,detachedSpinAxis:new V(0,1,0),detachedSpinRate:0,separationShock:0,detachedTimer:0,centerTransition01:0,enduranceSpinAngle:0,stageTwoSeparated:!1,stageTwoSeparationTimer:0};function L(F,Y){R.stageOneDetached&&R.detachedTimer>=pX?R.centerTransition01=Math.min(1,R.centerTransition01+Y*.5):R.centerTransition01=0;const tt=R.centerTransition01*R.centerTransition01*(3-2*R.centerTransition01);return _g.copy(IX).lerp(VX,tt),F.copy(_g).applyMatrix4(s.group.matrixWorld),F}function D(F){const Y=Math.max(F-Ql,0),tt=HX(Y),lt=Iu(tt.distance/tt.totalDistance),Tt=Math.max(Y-Sc,0),O=Math.min(Tt,mw),et=St.clamp(Tt-mw,0,Xg),z=Iu(et/Math.max(Xg,1e-6)),W=et-et*et/(2*Math.max(Xg,1e-6)),yt=O+W,K=lt*z$+yt*I$,Z=Fs(cp,Sc*.86,Y),j=(Math.pow(lt,1.22)*V$*Z+yt*G$)/ea,ct=Math.sin(lt*Math.PI*.82)*k$*Z+yt*H$,xt=ea+K,at=Math.cos(j),ut=-Math.sin(j);un.set(0,at,ut).normalize(),ni.set(0,-Math.sin(j),-Math.cos(j)).normalize(),s.group.position.set(ct,UX+un.y*xt,un.z*xt);const $=Fs(cp+.3,Sc*.9,Y);Ls.copy(un).lerp(ni,$*.9).normalize();const nt=1-Fs(.05,.9,lt),ht=(Math.sin(F*52)+Math.sin(F*31+.7))*.0024*nt,dt=Math.sin(F*2.5)*.008*nt+ht;return s.group.quaternion.setFromUnitVectors(gw,Ls),td.setFromAxisAngle(Ls,dt),s.group.quaternion.multiply(td),s.group.updateMatrixWorld(!0),{ascentProgress:lt,altitude:K,coastProgress:z,launchTime:Y,velocity01:tt.velocity01}}function U(F){R.stageOneDetached||(R.stageOneDetached=!0,R.detachedTimer=0,R.separationShock=0,R.centerTransition01=0,s.stageOne.getWorldPosition(un),s.stageOne.getWorldQuaternion(Jl),s.stageOne.getWorldScale(Hs),s.group.remove(s.stageOne),t.add(s.stageOne),s.stageOne.position.copy(un),s.stageOne.quaternion.copy(Jl),s.stageOne.scale.copy(Hs),s.stageOne.frustumCulled=!1,ni.set(0,1,0).applyQuaternion(s.group.quaternion).normalize(),Ls.set(1,0,0).applyQuaternion(s.group.quaternion).normalize(),$a.copy(e.atmosphereCenter).sub(s.group.position).normalize(),Hs.copy(s.stageOne.position).sub(s.group.position),R.detachedAlongOffset=Hs.dot(ni),R.detachedSideOffset=Hs.dot(Ls),R.detachedEarthOffset=Hs.dot($a),F?(Zf.copy(F.position).sub(s.group.position),R.detachedSideSign=Ls.dot(Zf)>=0?1:-1):R.detachedSideSign=Math.abs(R.detachedSideOffset)>Rs(.01)?Math.sign(R.detachedSideOffset):Math.random()<.5?-1:1,R.detachedSideDirection.copy(Ls).multiplyScalar(R.detachedSideSign),R.detachedAlongOffset=gX,R.detachedSideOffset=yX,R.detachedEarthOffset=xX,R.detachedAlongSpeed=bX,R.detachedSideSpeed=SX,R.detachedEarthSpeed=wX,s.stageOne.position.copy(s.group.position),s.stageOne.position.addScaledVector(ni,R.detachedAlongOffset),s.stageOne.position.addScaledVector(R.detachedSideDirection,R.detachedSideOffset),s.stageOne.position.addScaledVector($a,R.detachedEarthOffset),R.detachedTiltBaseQuaternion.copy(s.stageOne.quaternion),un.set(Ri(.65),Ri(.25),Ri(.65)),un.lengthSq()<1e-6&&un.set(0,0,1),un.applyQuaternion(s.group.quaternion).normalize(),td.setFromAxisAngle(un,St.degToRad(St.randFloat(BX,LX))),R.detachedTiltTargetQuaternion.copy(R.detachedTiltBaseQuaternion).multiply(td),R.detachedSpinAxis.copy(R.detachedSideDirection).addScaledVector(ni,.55).add(new V(Ri(.12),Ri(.12),Ri(.12))).normalize(),R.detachedSpinRate=St.randFloat(OX,FX)*(Math.random()<.5?-1:1),s.setStageOnePlume(0),s.setStageTwoPlume(.15))}function B(F){if(!R.stageOneDetached)return;R.detachedTimer+=F;const Y=Fs(0,vX,R.detachedTimer),tt=1-Fs(0,mX,R.detachedTimer);un.set(0,1,0).applyQuaternion(s.group.quaternion).normalize(),ni.set(1,0,0).applyQuaternion(s.group.quaternion).normalize().multiplyScalar(R.detachedSideSign),R.detachedSideDirection.lerp(ni,St.clamp(F*1.3,0,1)).normalize(),Hs.copy(e.atmosphereCenter).sub(s.group.position).normalize();const lt=St.lerp(AX,NX,Y)+TX*tt,Tt=St.lerp(RX,EX,Y)+_X*tt,O=St.lerp(CX,DX,Y)+MX*tt;if(R.detachedAlongSpeed+=lt*F,R.detachedAlongOffset+=R.detachedAlongSpeed*F,R.detachedSideSpeed+=Tt*F,R.detachedSideOffset+=R.detachedSideSpeed*F,R.detachedEarthSpeed+=O*F,R.detachedEarthOffset+=R.detachedEarthSpeed*F,Ls.copy(s.group.position),Ls.addScaledVector(un,R.detachedAlongOffset),Ls.addScaledVector(R.detachedSideDirection,R.detachedSideOffset),Ls.addScaledVector(Hs,R.detachedEarthOffset),s.stageOne.position.copy(Ls),R.detachedTimer<=UE){const et=Fs(0,UE,R.detachedTimer);s.stageOne.quaternion.copy(R.detachedTiltBaseQuaternion).slerp(R.detachedTiltTargetQuaternion,et)}else td.setFromAxisAngle(R.detachedSpinAxis,R.detachedSpinRate*F),s.stageOne.quaternion.multiply(td)}function P(){if(R.stageTwoSeparated||!s?.stageTwoFragments?.length)return;R.stageTwoSeparated=!0,v=[],s.rangerPayload.visible=!0,un.set(0,1,0).applyQuaternion(s.group.quaternion).normalize(),ni.set(1,0,0).applyQuaternion(s.group.quaternion).normalize(),Hs.copy(e.atmosphereCenter).sub(s.group.position).normalize();const F=Rs(aX),Y=Rs(lX),tt=Rs(cX);for(let lt=0;lt<s.stageTwoFragments.length;lt+=1){const Tt=s.stageTwoFragments[lt],O=Tt.userData.sideSign??(lt===0?-1:1);Tt.getWorldPosition(Ls),Tt.getWorldQuaternion(Jl),Tt.getWorldScale($a),Tt.parent&&Tt.parent.remove(Tt),t.add(Tt),Tt.position.copy(Ls),Tt.quaternion.copy(Jl),Tt.scale.copy($a),Tt.frustumCulled=!1;const et=new V;et.addScaledVector(ni,O*F*St.randFloat(.9,1.2)),et.addScaledVector(un,-Y*St.randFloat(.92,1.15)),et.addScaledVector(Hs,tt*St.randFloat(.85,1.25)),et.add(new V(Ri(Rs(.9)),Ri(Rs(.5)),Ri(Rs(.9))));const z=new V;z.addScaledVector(un,O*uX),z.x+=Ri(.45),z.y+=Ri(.25),z.z+=Ri(.45),v.push({object:Tt,velocity:et,angularVelocity:z,springTimer:FE,springLateralDir:ni.clone().multiplyScalar(O),springBackDir:un.clone().negate(),springSpinDir:un.clone().multiplyScalar(O)})}}function J(F){if(!R.stageTwoSeparated||v.length===0)return;const Y=St.clamp(F,0,.05);if(Y<=0)return;const tt=Math.exp(-.02*Y),lt=Math.exp(-.035*Y),Tt=Rs(hX),O=Rs(dX),et=fX;for(let z=0;z<v.length;z+=1){const W=v[z],yt=W.object;if(W.springTimer>0){const H=Iu(W.springTimer/FE),j=H*H;W.velocity.addScaledVector(W.springLateralDir,Tt*j*Y),W.velocity.addScaledVector(W.springBackDir,O*j*Y),W.angularVelocity.addScaledVector(W.springSpinDir,et*j*Y),W.springTimer=Math.max(0,W.springTimer-Y)}S2.copy(yt.position).sub(e.atmosphereCenter);const K=S2.lengthSq();if(K>1e-5){const H=1/Math.sqrt(K),ct=-398600.4418*(H*H*H);W.velocity.addScaledVector(S2,ct*Y)}W.velocity.multiplyScalar(tt),yt.position.addScaledVector(W.velocity,Y),W.angularVelocity.multiplyScalar(lt);const Z=W.angularVelocity.length();Z>1e-6&&(VE.copy(W.angularVelocity).multiplyScalar(1/Z),Jl.setFromAxisAngle(VE,Z*Y),yt.quaternion.multiply(Jl))}}function q(){const F=R.stageOneDetached?s.stageTwoNozzles:s.stageOneNozzles,Y=[];for(let tt=0;tt<F.length;tt+=1)un.copy(F[tt]).applyMatrix4(s.group.matrixWorld),Y.push(un.clone());return Y}function ft(F,Y,tt,lt,Tt){L(un,Y),ni.copy(un).sub(e.atmosphereCenter).normalize();const O=Fs(cp,cp+7,Tt),et=St.lerp(Rs(16),Rs(96),O),z=St.lerp(.22,.88,O),W=St.lerp(.12,.28,O),yt=z+R.orbitYaw,K=St.clamp(W+R.orbitPitch,-.72,1.08);Hs.set(Math.sin(yt)*Math.cos(K)*et,Math.sin(K)*et,Math.cos(yt)*Math.cos(K)*et),Jl.setFromUnitVectors(gw,ni),Hs.applyQuaternion(Jl),Ls.copy(un).add(Hs);const Z=Fs(0,.35,Tt),H=1-Fs(.8,3.2,Tt),ct=Z*H*Rs(.18);$a.set(Ri(ct),Ri(ct*.6),Ri(ct)),Ls.add($a),F.position.copy(Ls),F.lookAt(un);const xt=St.lerp(43,57,Fs(.18,.78,lt));Math.abs(F.fov-xt)>.02&&(F.fov=xt,F.updateProjectionMatrix()),tt<Ql+.2&&(F.position.y+=Math.sin(tt*88)*Rs(.08))}function Mt(F,Y){if(!e||!e.atmosphereShellOpacity||!e.atmosphereFrontFaceOpacity||!e.atmosphereBackFaceOpacity)return;const tt=F.position.distanceTo(e.atmosphereCenter),lt=Math.max(0,Y??0),Tt=tt-kp,et=Math.max(Q$*or,ac*J$),z=1-St.smoothstep(Tt,-et,et),W=St.clamp(Fs(0,tX,lt)*LE,0,LE);e.atmosphereFrontFaceOpacity.value=St.clamp(1-z,0,1),e.atmosphereBackFaceOpacity.value=St.clamp(z,0,1),e.atmosphereShellOpacity.value=W}function mt(F){if(!e||!i||!i.materials||!i.baseColors)return;i.group.getWorldPosition($E);const Y=XX({atmosphereCenter:e.atmosphereCenter,bodyRadius:ea,cameraPosition:F.position,model:e.atmosphereModel,sunDirection:e.sunDirection,targetPosition:$E,topRadius:kp}),tt=Y.transmittance;for(let lt=0;lt<i.materials.length;lt+=1){const Tt=i.materials[lt],O=i.baseColors[lt];WE.setRGB(O.r*tt.x+Y.airlight.r*(1-tt.x),O.g*tt.y+Y.airlight.g*(1-tt.y),O.b*tt.z+Y.airlight.b*(1-tt.z)),qE.copy(O).lerp(WE,Y.effectWeight),Tt.color.copy(qE);const et=St.clamp(1-Y.effectWeight*(1-Y.transLuma)*1.2,.03,1);Tt.opacity=et}}return{async init({root:F,camera:Y,renderer:tt,scene:lt}){r=F,t=new vt,t.name="scene05-root",F.add(t),g=Y.near,y=Y.far,x=Y.fov,Y.near=Rs(5),Y.far=24e4,Y.fov=45,Y.updateProjectionMatrix(),lt.background&&lt.background.isColor?S=lt.background.clone():S=null,lt.background=IE.clone(),d=new $p(14018559,3089945,.72),u=new wi(16773336,2.05),f=new wi(8103935,.55),p=new hs(16752199,0,Rs(340),1.9),u.position.set(760,1140,580),f.position.set(-980,340,-920),t.add(d,u,f,p);const O=await new Hw().loadAsync("/textures/earth_texture.jpg");O.colorSpace=bn,O.wrapS=Fn,O.wrapT=Yi,O.center.set(.5,.5),O.offset.set(rX,0),O.rotation=St.degToRad(iX),O.generateMipmaps=!0,tt?.capabilities&&typeof tt.capabilities.getMaxAnisotropy=="function"&&(O.anisotropy=Math.min(8,tt.capabilities.getMaxAnisotropy())),O.needsUpdate=!0,e=jX(O),n=YX(),s=KX(),i=ZX(),a=QX(),c=JX(),t.add(e.group),t.add(n.group),t.add(s.group),t.add(c.points),t.add(i.group),t.add(a),N=[],lt.traverse(z=>{z?.isPoints&&(z===a||z.name==="scene05-space-stars"||(N.push({object:z,visible:z.visible}),z.visible=!1))}),D(0),R.previousRocketPosition.copy(s.group.position),s.setStageOnePlume(0),s.setStageTwoPlume(0);const et=Ql+b2;D(et),$a.copy(s.group.position),D(et+.12),_g.copy(s.group.position),Hs.copy(_g).sub($a),Hs.lengthSq()<1e-8&&Hs.set(0,0,-1),Hs.normalize(),D(et),L(un,0),ni.set(0,1,0).applyQuaternion(s.group.quaternion).normalize(),Ls.copy(un).sub(e.atmosphereCenter).normalize(),i.group.position.copy(un),i.group.position.addScaledVector(Hs,W$),i.group.position.addScaledVector(ni,$$),i.group.position.addScaledVector(Ls,X$),i.group.rotation.set(.46,-.12,.9),D(0),R.previousRocketPosition.copy(s.group.position),Y.position.set(Rs(10.5),Rs(68),Rs(18.5)),Y.lookAt(0,M_+Rs(66),0),T=z=>{GX.has(z.code)&&document.pointerLockElement&&(z.preventDefault(),z.stopPropagation(),typeof z.stopImmediatePropagation=="function"&&z.stopImmediatePropagation())},window.addEventListener("keydown",T,!0),M=z=>{document.pointerLockElement&&(R.orbitYaw-=z.movementX*.0022,R.orbitPitch=St.clamp(R.orbitPitch+z.movementY*.0018,-.85,.95))},window.addEventListener("mousemove",M,!0)},update({delta:F,camera:Y,scene:tt}){if(!t||!s||!e||!n||!i||!a||!c)return;const lt=Math.min(F,.05);R.sequenceComplete||(R.elapsed+=lt);const Tt=R.elapsed;let O=D(Tt),et=O.ascentProgress,z=O.altitude,W=O.coastProgress,yt=O.velocity01;!R.sequenceComplete&&O.launchTime>=b2&&(R.sequenceComplete=!0,R.elapsed=Ql+b2,O=D(R.elapsed),et=O.ascentProgress,z=O.altitude,W=O.coastProgress,yt=O.velocity01,R.separationShock=0,c.clear(),c.points.visible=!1,s.setStageOnePlume(0),s.setStageTwoPlume(0),R.stageTwoSeparationTimer=0),R.sequenceComplete&&!R.stageTwoSeparated&&(R.stageTwoSeparationTimer+=lt,R.stageTwoSeparationTimer>=oX&&P()),R.stageTwoSeparated&&J(lt),R.sequenceComplete?(R.rocketVelocity.set(0,0,0),R.rocketAcceleration.set(0,0,0)):(Zf.copy(s.group.position).sub(R.previousRocketPosition).multiplyScalar(1/Math.max(lt,1e-4)),R.rocketAcceleration.copy(Zf).sub(R.rocketVelocity).multiplyScalar(1/Math.max(lt,1e-4)),R.rocketVelocity.copy(Zf)),R.previousRocketPosition.copy(s.group.position);const K=Fs(Ql-.5,Ql+.45,Tt);!R.stageOneDetached&&O.launchTime>=x2&&U(Y),R.sequenceComplete||B(lt),R.separationShock=Math.max(0,R.separationShock-lt*1.85),Mt(Y,z);const Z=Fs(x2,x2+2.5,O.launchTime),H=St.lerp(.8,1.2,yt),j=R.stageOneDetached?St.lerp(.52,.86,Z)*H:K*St.lerp(.75,1.05,yt),ct=1-Fs(0,1,W),xt=R.sequenceComplete?0:j*ct;if(R.sequenceComplete)s.setStageOnePlume(0),s.setStageTwoPlume(0);else if(R.stageOneDetached){const dt=.9+Math.sin(Tt*28)*.1;s.setStageOnePlume(0),s.setStageTwoPlume(xt*dt,!0)}else{const dt=.9+Math.sin(Tt*36)*.1;s.setStageOnePlume(xt*dt,!1),s.setStageTwoPlume(0)}const at=q();un.set(0,-1,0).applyQuaternion(s.group.quaternion).normalize();const ut=1-Fs(ac*.1,ac*.95,z),$=ut>.45&&xt>.02;R.sequenceComplete?c.points.visible=!1:$?(c.points.visible=!0,c.update(lt,at,un,R.rocketVelocity,xt,ut)):(c.clear(),c.points.visible=!1);const nt=Fs(Ql-.32,Ql+1.15,Tt);for(let dt=0;dt<n.serviceArms.length;dt+=1){const pt=n.serviceArms[dt],Rt=pt.userData.retractAngle??-.8;pt.rotation.x=Rt*nt}const ht=Fs(ac*.1,ac*.5,z);A.copy(IE).lerp(zX,ht),tt.background=A,d.intensity=St.lerp(.72,.22,ht),u.intensity=St.lerp(2.05,2.4,ht),f.intensity=St.lerp(.55,.9,ht),p.intensity=R.sequenceComplete?0:St.lerp(0,9.4,xt),ni.copy(at[0]??s.group.position).add(un.clone().multiplyScalar(Rs(8))),p.position.copy(ni),R.sequenceComplete||(e.earth.rotation.y+=lt*.012,e.clouds.rotation.y+=lt*.018,e.atmosphere.rotation.y+=lt*.004),R.enduranceSpinAngle+=lt*.12,i.group.rotation.set(.46,-.12,.9+R.enduranceSpinAngle),mt(Y),a.material.opacity=St.lerp(0,.86,Fs(ac*.2,ac*.65,z)),ft(Y,lt,Tt,et,O.launchTime)},resize(){},dispose({camera:F,scene:Y}){F&&(F.near=g||F.near,F.far=y||F.far,F.fov=x||F.fov,F.updateProjectionMatrix()),T&&(window.removeEventListener("keydown",T,!0),T=null),M&&(window.removeEventListener("mousemove",M,!0),M=null),Y&&(Y.background=S??new Xt(132106));for(let tt=0;tt<N.length;tt+=1){const lt=N[tt];lt?.object&&(lt.object.visible=lt.visible)}N=[],t&&(r&&t.parent!==r&&r.add(t),Fi(t)),r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,S=null}}}},Ud=1,aL=Ud/1e3,lL=58232,cL=2500,yw=lL*Ud,XE=(lL+cL)*Ud,ej=7e4,nj=14e4,jE=ej*Ud,Zy=nj*Ud,sj=new Xt(132106),ij=new Xt(16777215),YE=18,KE=10,rj=1.7,oj=40,aj=12,uL=36e4,lj=500,hL=14e3,xw=hL/lj,dL=new V(-.86,.18,.47).normalize(),cj=new Set(["KeyW","KeyA","KeyS","KeyD","Space","ShiftLeft","ShiftRight"]),ed=new V,ZE=new V,vg=new V,QE=new V,uj=new V(0,0,0),JE=new V(0,1,0);function nd(r){return r*aL}function hj(r){return St.clamp(r,0,1)}function ja(r,t,e){if(r===t)return e<r?0:1;const n=hj((e-r)/(t-r));return n*n*(3-2*n)}function dj(r){let t=r>>>0;return()=>(t=1664525*t+1013904223>>>0,t/4294967296)}function fj({width:r,height:t},e){const n=document.createElement("canvas");n.width=r,n.height=t;const s=n.getContext("2d");if(!s)throw new Error("Could not create canvas context for procedural texture.");e(s,r,t);const i=new Ti(n);return i.colorSpace=bn,i.generateMipmaps=!0,i.minFilter=sa,i.magFilter=$s,i.wrapS=Yi,i.wrapT=Fn,i.needsUpdate=!0,i}function pj(){const r=dj(607);return fj({width:2048,height:256},(t,e,n)=>{t.clearRect(0,0,e,n);for(let s=0;s<e;s+=1){const i=s/(e-1),a=ja(.01,.06,i),c=1-ja(.94,.99,i),u=a*c,d=.52+.22*Math.sin(i*82+.7)+.18*Math.sin(i*193+1.9)+.08*Math.sin(i*421+.4),f=.12*Math.sin(i*1600+8.2)+.06*Math.sin(i*2400+1.1),p=(r()-.5)*.1+f,g=1-ja(.615,.64,i)*(1-ja(.64,.675,i)),y=1-ja(.23,.255,i)*(1-ja(.255,.275,i));let x=u*g*y;x*=St.clamp(d+p,.06,1.1),x*=St.lerp(.52,1,ja(.12,.42,i)),x*=St.lerp(1,1.15,ja(.72,.92,i)),x=St.clamp(x,0,1);const S=St.lerp(.92,1.06,ja(.12,.9,i)),T=St.lerp(.22,.98,x),M=Math.floor(238*T*S),N=Math.floor(220*T),v=Math.floor(186*T*.98);t.fillStyle=`rgba(${M}, ${N}, ${v}, ${x})`,t.fillRect(s,0,1,n)}t.globalAlpha=.08,t.fillStyle="#000000";for(let s=0;s<1200;s+=1){const i=Math.floor(r()*e),a=Math.floor(r()*n),c=1+Math.floor(r()*2);t.fillRect(i,a,c,1)}t.globalAlpha=1})}function mj(r,t,e){const n=r.attributes.position,s=new Float32Array(n.count*2),i=Math.max(e-t,1e-6);for(let a=0;a<n.count;a+=1){const c=n.getX(a),u=n.getY(a),f=(Math.atan2(u,c)+Math.PI)/(Math.PI*2),p=Math.sqrt(c*c+u*u),g=St.clamp((p-t)/i,0,1),y=a*2;s[y]=g,s[y+1]=f}r.setAttribute("uv",new fs(s,2)),r.attributes.uv.needsUpdate=!0}function gj(){const t=new Float32Array(21e3),e=new Float32Array(7e3*3),n=uL*.86,s=new V;for(let u=0;u<7e3;u+=1){const d=u*3,f=Math.acos(St.randFloatSpread(2)),p=Math.random()*Math.PI*2,g=Math.sin(f);s.set(g*Math.cos(p),Math.cos(f),g*Math.sin(p)),t[d]=s.x*n,t[d+1]=s.y*n,t[d+2]=s.z*n;const y=St.randFloat(.12,1.05),x=Math.pow(Math.random(),1.05),S=St.clamp(y*(.5+x*.8),.04,1),T=St.randFloat(-.09,.1);e[d]=St.clamp(S+T*.5,.02,1),e[d+1]=St.clamp(S+T*.15,.02,1),e[d+2]=St.clamp(S-T*.45,.02,1)}const i=new Qe;i.setAttribute("position",new ge(t,3)),i.setAttribute("color",new ge(e,3));const a=new er({color:ij,size:1.15,sizeAttenuation:!1,transparent:!0,opacity:1,depthWrite:!1,vertexColors:!0}),c=new to(i,a);return c.name="scene06-space-stars",c}function nc(r,t){return[r[0]*t,r[1]*t,r[2]*t]}function yj(r){let t=1;switch(r){case"terrestrial":t=2.15;break;case"rocky":t=2;break;case"gasGiant":case"iceGiant":t=1.35;break;default:t=1;break}return t*rj}function xj(r,t){const e=Math.max(r.atmosphereHeightKm,1),n=St.clamp(r.atmosphereDensity,.15,1.8),s=St.clamp((n-.25)/1.35,0,1),i=yj(r.kind);let a={rayleighScatteringKm:[.0058,.0135,.0331],mieScatteringKm:[.0022,.0022,.0022],mieExtinctionKm:[.0032,.0032,.0032],rayleighScaleHeightKm:St.lerp(7.2,10.8,s),upperRayleighScaleHeightKm:Math.max(36,e*.36*i),upperRayleighStrength:.04,mieScaleHeightKm:St.lerp(.9,1.7,s),miePhaseG:.76,ozoneExtinctionKm:[65e-5,.001881,85e-6],ozoneCenterHeightKm:Math.min(e*.42,26),ozoneWidthKm:Math.max(6,Math.min(e*.18,14)),solarIntensity:13.8};a={rayleighScatteringKm:[.0016,.0031,.0058],mieScatteringKm:[.0022,.0022,.0022],mieExtinctionKm:[.0032,.0032,.0032],rayleighScaleHeightKm:Math.max(20,e*.09),upperRayleighScaleHeightKm:Math.max(64,e*.26*i),upperRayleighStrength:.02,mieScaleHeightKm:Math.max(6,e*.026),miePhaseG:.82,ozoneExtinctionKm:[0,0,0],ozoneCenterHeightKm:e*.65,ozoneWidthKm:Math.max(12,e*.22),solarIntensity:10};const c=n,u=n*.9,d=nc(a.rayleighScatteringKm,c),f=nc(a.mieScatteringKm,u),p=nc(a.mieExtinctionKm,u),g=[Math.max(p[0],f[0]+1e-4),Math.max(p[1],f[1]+1e-4),Math.max(p[2],f[2]+1e-4)],y=nc(a.ozoneExtinctionKm??[0,0,0],1),x=t,S=1/Math.max(x,1e-6);return{rayleighScatteringWorld:nc(d,S),mieScatteringWorld:nc(f,S),mieExtinctionWorld:nc(g,S),ozoneExtinctionWorld:nc(y,S),rayleighScaleHeightWorld:Math.max(a.rayleighScaleHeightKm*x,1e-5),upperRayleighScaleHeightWorld:Math.max((a.upperRayleighScaleHeightKm??a.rayleighScaleHeightKm*2.6)*x,1e-5),upperRayleighStrength:St.clamp(a.upperRayleighStrength??.05,0,.24),mieScaleHeightWorld:Math.max(a.mieScaleHeightKm*x,1e-5),ozoneCenterHeightWorld:Math.max((a.ozoneCenterHeightKm??0)*x,0),ozoneWidthWorld:Math.max((a.ozoneWidthKm??1)*x,1e-5),miePhaseG:St.clamp(a.miePhaseG,0,.92),solarIntensity:a.solarIntensity??18}}function bj(r,t,e,n,s,i,a,c){const u=Dt(c.rayleighScatteringWorld[0],c.rayleighScatteringWorld[1],c.rayleighScatteringWorld[2]),d=Dt(c.mieScatteringWorld[0],c.mieScatteringWorld[1],c.mieScatteringWorld[2]),f=Dt(c.mieExtinctionWorld[0],c.mieExtinctionWorld[1],c.mieExtinctionWorld[2]),p=Dt(c.ozoneExtinctionWorld[0],c.ozoneExtinctionWorld[1],c.ozoneExtinctionWorld[2]),g=k(c.rayleighScaleHeightWorld),y=k(c.upperRayleighScaleHeightWorld),x=k(c.upperRayleighStrength),S=k(c.mieScaleHeightWorld),T=k(c.ozoneCenterHeightWorld),M=k(c.ozoneWidthWorld),N=k(c.miePhaseG),v=k(c.solarIntensity),A=_n(()=>{const L=ir,D=Cn(kc.sub(ir)),U=Cn(r),B=t,P=e,J=n,q=le(J.sub(P),P.mul(.005)),ft=q.mul(.24),Mt=q.mul(.16),mt=L.sub(B),F=xe(mt,D),Y=xe(mt,mt).sub(J.mul(J)),tt=F.mul(F).sub(Y),lt=me(0,tt),Tt=Mr(le(tt,0)),O=dn(F.negate().sub(Tt),F.negate().add(Tt)),et=xe(mt,D),z=xe(mt,mt).sub(P.mul(P)),W=et.mul(et).sub(z),yt=me(0,W),K=Mr(le(W,0)),Z=dn(et.negate().sub(K),et.negate().add(K)),H=me(0,Z.x).mul(yt),j=le(O.x,0).mul(lt),ct=le(Zt(O.y,__(O.y,Z.x),H),0).mul(lt),xt=le(ct.sub(j),0),at=xt.div(k(YE)),ut=ln(0,Mt,xt),$=xe(D,U),nt=k(.05968310365946075).mul(k(1).add($.mul($))),ht=N.mul(N),dt=k(.07957747154594767).mul(k(1).sub(ht)).div(zn(k(1).add(ht).sub(k(2).mul(N).mul($)),1.5)),pt=k(0).toVar(),Rt=k(0).toVar(),Ft=k(0).toVar(),Gt=Dt(0,0,0).toVar();ma(YE,({i:os})=>{const jn=j.add(at.mul(k(os).add(.5))),Yn=L.add(D.mul(jn)),we=Yn.sub(B),Ye=Ao(we),Dn=Ye.sub(P),Ge=me(0,Dn),as=le(Dn,0),Te=le(J.sub(Ye),0),_e=ln(0,ft,Te),Kn=En(as.negate().div(g)),ls=En(as.negate().div(y)).mul(x),Bn=Kn.add(ls).mul(Ge).mul(_e),Ee=En(as.negate().div(S)).mul(Ge).mul(_e),ke=le(k(1).sub(oi(as.sub(T)).div(M)),0).mul(Ge).mul(_e);pt.addAssign(Bn.mul(at)),Rt.addAssign(Ee.mul(at)),Ft.addAssign(ke.mul(at));const $e=xe(we,U),js=xe(we,we).sub(J.mul(J)),oo=$e.mul($e).sub(js),Rr=me(0,oo),Ui=Mr(le(oo,0)),Do=dn($e.negate().sub(Ui),$e.negate().add(Ui)),ao=le(Do.x,0).mul(Rr),Ys=le(Do.y.sub(ao),0).mul(Rr).div(k(KE)),_i=xe(we,U),ba=xe(we,we).sub(P.mul(P)),lo=_i.mul(_i).sub(ba),gl=me(0,lo),Pi=Mr(le(lo,0)),Zn=_i.negate().sub(Pi),Ts=k(1).sub(me(0,Zn).mul(gl)),Mi=k(0).toVar(),Er=k(0).toVar(),Bo=k(0).toVar();ma(KE,({i:Cr})=>{const Dr=ao.add(Ys.mul(k(Cr).add(.5))),uo=Yn.add(U.mul(Dr)),vi=Ao(uo.sub(B)),vn=vi.sub(P),zi=me(0,vn),Ks=le(vn,0),ar=le(J.sub(vi),0),Vs=ln(0,ft,ar),Wc=En(Ks.negate().div(g)),xl=En(Ks.negate().div(y)).mul(x);Mi.addAssign(Wc.add(xl).mul(Ys).mul(zi).mul(Vs)),Er.addAssign(En(Ks.negate().div(S)).mul(Ys).mul(zi).mul(Vs)),Bo.addAssign(le(k(1).sub(oi(Ks.sub(T)).div(M)),0).mul(Ys).mul(zi).mul(Vs))});const Hc=u.mul(pt).add(f.mul(Rt)).add(p.mul(Ft)),yl=u.mul(Mi).add(f.mul(Er)).add(p.mul(Bo)),co=En(Hc.add(yl).negate()).mul(Ts),Sa=u.mul(Bn.mul(nt)).add(d.mul(Ee.mul(dt)));Gt.addAssign(Sa.mul(co).mul(at))});const ae=u.mul(pt).add(f.mul(Rt)).add(p.mul(Ft)),Kt=En(ae.negate()),jt=Dt(1,1,1).sub(Kt).mul(u.mul(.018).add(d.mul(.0035))).mul(v.mul(.38)),ce=Gt.mul(v).add(jt).mul(ut),ee=ce.div(ce.mul(.22).add(Dt(1,1,1))),Re=xe(Kt,Dt(.2126,.7152,.0722)).clamp(0,1),je=T_.select(i,a),pn=zn(k(1).sub(Re),1.15).mul(ut).mul(s).mul(je).clamp(0,1);return zu(ee,pn)}),R=new Bc;return R.outputNode=A(),R.transparent=!0,R.premultipliedAlpha=!1,R.depthWrite=!1,R.depthTest=!0,R.side=ss,R.blending=mi,R}function Sj({ringTexture:r,saturnTexture:t}){const e=new vt;e.name="scene06-saturn-system";const n=new Xs({metalness:0,roughness:.98}),s=Np(t),i=ln(.9,.975,oi(op.y));n.colorNode=Zt(s.rgb,Ke(13221545),i);const a=new C(new We(yw,168,112),n);a.name="scene06-saturn",a.receiveShadow=!0,e.add(a);const c=new bt({color:16777215,map:r,metalness:.08,roughness:.88,transparent:!0,depthWrite:!1,side:ss});c.alphaTest=.01;const u=new cx(jE,Zy,420,1);mj(u,jE,Zy);const d=new C(u,c);d.name="scene06-saturn-rings",d.rotation.x=Math.PI/2,d.renderOrder=20,e.add(d);const f=xj({atmosphereDensity:.72,atmosphereHeightKm:cL,kind:"gasGiant"},Ud),p=he(1),g=he(1),y=he(0),x=he(new V(0,0,0)),S=bj(he(dL.clone()),x,he(yw),he(XE),p,g,y,f),T=new C(new We(XE,128,88),S);return T.name="scene06-saturn-atmosphere",T.renderOrder=10,e.add(T),e.rotation.x=St.degToRad(26.7),e.rotation.z=St.degToRad(12),{atmosphere:T,group:e,rings:d,saturn:a,atmosphereCenterWorld:x}}function Ag(r,t,e){const n=new Xs;return n.colorNode=Ke(r),n.roughnessNode=k(t),n.metalnessNode=k(e),n}function wj(){const r=new vt;r.name="scene06-docked-endurance";const t=new vt;t.name="scene06-endurance";const e=Ag(14540253,.4,.6),n=Ag(3355443,.5,.7),s=Ag(1118481,.15,.9),i=Ag(328965,.05,.8),a=32,c=12;for(let U=0;U<c;U+=1){const B=U/c*Math.PI*2,P=new vt,J=new X(8,7,10),q=new C(J,e);q.castShadow=!0,q.receiveShadow=!0,P.add(q);const ft=new C(new X(7.5,6.5,1),s);ft.position.set(0,0,-4.6),ft.castShadow=!0,ft.receiveShadow=!0,P.add(ft);const Mt=new C(new X(8.2,2,4),n);Mt.position.set(0,0,1),P.add(Mt),P.position.set(Math.cos(B)*a,Math.sin(B)*a,0),P.rotation.z=B+Math.PI/2,P.lookAt(0,0,0),t.add(P);const mt=B+Math.PI/c,F=new vt;F.position.set(Math.cos(mt)*a,Math.sin(mt)*a,0),F.rotation.z=mt;const Y=new C(new qt(2,2,9,32),e);Y.castShadow=!0,Y.receiveShadow=!0,F.add(Y);const tt=new C(new qt(2.8,2.8,2.5,32),e);F.add(tt);const lt=new qt(1.2,1.2,3.5,32),Tt=new C(lt,i);Tt.rotation.z=Math.PI/2,F.add(Tt);const O=new C(new qt(1.5,1.5,3.2,32),n);O.rotation.z=Math.PI/2,F.add(O),t.add(F)}const u=a-5,d=new vt;d.position.set(0,u/2+2,0);const f=new C(new qt(2.5,2.5,u,32),e);f.castShadow=!0,f.receiveShadow=!0,d.add(f);for(let U=-1;U<=1;U+=1){const B=new C(new qt(3,3,2,32),n);B.position.y=U*(u/3),d.add(B)}t.add(d);const p=new C(new qt(4,4,3,32),e);p.rotation.x=Math.PI/2,p.castShadow=!0,p.receiveShadow=!0,t.add(p);const g=new C(new da(3,.5,16,64),n);g.position.z=1.5,t.add(g);const y=new vt;y.name="scene06-ranger";const x=new gi(4.5,10,4);x.rotateY(Math.PI/4),x.rotateX(Math.PI/2),x.scale(1.1,.2,1);const S=new C(x,e);S.castShadow=!0,S.receiveShadow=!0,y.add(S);const T=x.clone();T.scale(.98,.5,.98),T.translate(0,-.15,0);const M=new C(T,n);M.castShadow=!0,y.add(M);const N=new C(new X(2.2,.8,3.5),e);N.position.set(0,.4,0),N.rotation.x=Math.PI/16,N.castShadow=!0,y.add(N);const v=new C(new X(1.8,.6,1.5),i);v.position.set(0,.7,1.2),v.rotation.x=Math.PI/6,y.add(v);const A=new X(3.5,.2,4),R=new C(A,e);R.position.set(-2.8,0,-2.5),R.rotation.y=Math.PI/8,R.castShadow=!0,y.add(R);const L=new C(A,e);L.position.set(2.8,0,-2.5),L.rotation.y=-Math.PI/8,L.castShadow=!0,y.add(L);const D=new C(new X(3,1,1.5),n);return D.position.set(0,-.1,-4.8),y.add(D),y.position.set(0,0,7.5),y.rotation.set(0,0,0),t.add(y),t.scale.setScalar(aL),r.add(t),r.scale.setScalar(xw),r.rotation.set(.62,-.12,.94),{docked:r}}const Tj={id:"endurance-saturn-approach",title:"Endurance Near Saturn",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=0,u=0,d=0,f=null,p=null;const g={orbitAngle:-.5,shipSpinRate:.15,flybyProgress:.14,flybyDuration:22,cameraBasePosition:new V,cameraForward:new V,cameraRight:new V,cameraUp:new V,shipAnchorPosition:new V};function y(S){!s||!n||(ed.copy(s.position).normalize(),ZE.crossVectors(JE,ed).normalize(),vg.copy(ed).multiplyScalar(nd(1600)),vg.addScaledVector(ZE,nd(-1250)),vg.addScaledVector(JE,nd(650)),S.position.copy(s.position).add(vg),QE.copy(s.position).lerp(uj,.08),S.lookAt(QE))}function x(){!s||!n||(ed.set(Math.cos(g.orbitAngle)*(Zy*1.08),yw*.11,Math.sin(g.orbitAngle)*(Zy*1.08)),n.group.localToWorld(ed),g.shipAnchorPosition.copy(ed))}return{async init({camera:S,renderer:T,root:M,scene:N}){r=M,t=new vt,t.name="scene06-group",M.add(t),c=S.near,u=S.far,d=S.fov,S.near=aj,S.far=uL,S.fov=oj,S.updateProjectionMatrix(),N.background&&N.background.isColor?f=N.background.clone():f=null,N.background=sj.clone(),a=new Co(1909808,.18),i=new wi(16773590,2.6),i.position.copy(dL).multiplyScalar(2e5),t.add(a,i,i.target);const A=await new Hw().loadAsync("/textures/saturn_texture.jpg");A.colorSpace=bn,A.wrapS=Fn,A.wrapT=Yi,A.center.set(.5,.5),A.rotation=0,A.generateMipmaps=!0,T?.capabilities&&typeof T.capabilities.getMaxAnisotropy=="function"&&(A.anisotropy=Math.min(8,T.capabilities.getMaxAnisotropy())),A.needsUpdate=!0;const R=pj();T?.capabilities&&typeof T.capabilities.getMaxAnisotropy=="function"&&(R.anisotropy=Math.min(8,T.capabilities.getMaxAnisotropy())),R.needsUpdate=!0,n=Sj({ringTexture:R,saturnTexture:A}),t.add(n.group),n.group.updateMatrixWorld(!0),e=gj(),t.add(e),s=wj().docked,t.add(s),x(),s.position.copy(g.shipAnchorPosition),y(S);const L=S.position.clone();g.cameraBasePosition.set(0,0,0),g.cameraForward.set(0,0,-1).applyQuaternion(S.quaternion).normalize(),g.cameraRight.set(1,0,0).applyQuaternion(S.quaternion).normalize(),g.cameraUp.set(0,1,0).applyQuaternion(S.quaternion).normalize(),S.position.set(0,0,0),n.group.position.copy(L).negate(),n.group.updateMatrixWorld(!0),n.atmosphereCenterWorld.value.copy(n.group.position),e.position.set(0,0,0),p=D=>{cj.has(D.code)&&(D.preventDefault(),D.stopPropagation(),typeof D.stopImmediatePropagation=="function"&&D.stopImmediatePropagation())},window.addEventListener("keydown",p,!0)},update({delta:S,camera:T}){if(!t||!n||!e||!s)return;g.flybyProgress=(g.flybyProgress+S/g.flybyDuration)%1,T.position.copy(g.cameraBasePosition);const N=(g.flybyProgress*2-1)*nd(1700*xw),v=nd(-40*xw),A=nd(hL);s.position.copy(g.cameraBasePosition),s.position.addScaledVector(g.cameraForward,A),s.position.addScaledVector(g.cameraRight,N),s.position.addScaledVector(g.cameraUp,v),s.rotation.z+=S*g.shipSpinRate*5,s.rotation.y+=S*g.shipSpinRate*.25,e.position.copy(T.position)},resize(){},dispose({camera:S,scene:T}){p&&(window.removeEventListener("keydown",p,!0),p=null),S.near=c,S.far=u,S.fov=d,S.updateProjectionMatrix(),T.background=f?f.clone():null,t&&(r&&t.parent!==r&&r.add(t),Fi(t),t=null,e=null,n=null,s=null,i=null,a=null,r=null)}}}},_j=.07,Mj=new V(0,0,0),vj=new Set(["KeyW","KeyA","KeyS","KeyD","Space","ShiftLeft","ShiftRight"]);function Aj(){const r=_n(([f])=>{const p=Dt(f).toVar(),g=si(p.mul(.1031)).toVar();return g.addAssign(xe(g,g.zyx.add(31.32))),si(g.x.add(g.y).mul(g.z))}),t=_n(([f])=>{const p=Dt(f).toVar(),g=eL(p).toVar(),y=si(p).toVar(),x=y.mul(y).mul(k(3).sub(y.mul(2))).toVar();return Zt(Zt(Zt(r(g.add(Dt(0,0,0))),r(g.add(Dt(1,0,0))),x.x),Zt(r(g.add(Dt(0,1,0))),r(g.add(Dt(1,1,0))),x.x),x.y),Zt(Zt(r(g.add(Dt(0,0,1))),r(g.add(Dt(1,0,1))),x.x),Zt(r(g.add(Dt(0,1,1))),r(g.add(Dt(1,1,1))),x.x),x.y),x.z)}),e=_n(([f])=>{const p=Dt(f).toVar(),g=k(0).toVar(),y=k(.5).toVar(),x=Dt(p).toVar();return ma(5,()=>{g.addAssign(y.mul(t(x))),x.mulAssign(2),y.mulAssign(.5)}),g}),n=_n(([f])=>{const p=Dt(f).toVar(),g=Rc.mul(.055).toVar(),y=Dt(g,g.mul(.36),g.mul(-.24)).toVar(),x=Dt(g.mul(-.17),g.mul(.43),g.mul(.31)).toVar(),S=e(p.mul(2.4).add(Dt(13.1,-4.2,7.7)).add(y)).sub(.5).mul(.34).toVar(),T=Cn(Dt(p.x.add(S),p.y.add(S.mul(.28)),p.z.sub(S.mul(.52)))).toVar(),M=e(T.mul(2.9)).toVar(),N=e(T.mul(6.2).add(Dt(7,1,11)).add(x)).toVar(),v=k(1).sub(ln(.06,.78,oi(T.y.add(N.sub(.5).mul(.2))))),A=ln(.28,.75,M).mul(v),R=ln(.54,.88,N).mul(v).mul(.42);return Zt(Dt(.03,.06,.12),Dt(.16,.27,.46),N).toVar().mul(A.add(R))}),s=_n(([f])=>{const p=Dt(f).toVar(),g=Rc.mul(.048).toVar(),y=Dt(g.mul(-.22),g.mul(.49),g.mul(.27)).toVar(),x=Dt(g.mul(.32),g.mul(-.18),g.mul(.44)).toVar(),S=Dt(p.x,p.y.mul(.8).add(p.z.mul(.6)),p.z.mul(.8).sub(p.y.mul(.6))).toVar(),T=e(S.mul(2).add(Dt(2,5,8)).add(y)).sub(.5).mul(.3).toVar(),M=Dt(S.x.add(T.mul(.4)),S.y,S.z.sub(T.mul(.45))).toVar(),N=e(M.mul(2.8).add(Dt(1,2,3)).add(x)).toVar(),v=e(M.mul(6).add(Dt(9,3,1)).add(x.mul(1.6))).toVar(),A=k(1).sub(ln(0,.2,oi(M.y.add(v.sub(.5).mul(.12))))),R=k(1).sub(ln(0,.9,oi(M.y))),L=Zt(Dt(.09,.14,.28),Dt(.32,.5,.78),N).toVar();return L.mulAssign(A.mul(1.45).add(R.mul(.22))),L}),i=_n(([f,p,g])=>{const y=dn(f).toVar(),x=k(p).toVar(),S=k(g).toVar(),T=y.x.toVar(),M=y.y.toVar(),N=T.mul(T).add(S.mul(S)).toVar();return dn(N.mul(M),x.mul(x).mul(T).div(N))}),a=_n(([f,p])=>{const g=Dt(f).toVar(),y=Cn(p).toVar(),x=k(1.2),S=k(40),T=Ao(g).toVar(),M=Mr(le(T.mul(T).sub(x.mul(x)),.001)).toVar(),N=xe(Cn(g),y).toVar(),v=xg(g,y).toVar(),A=Ao(v).toVar(),R=Dt(0).toVar();Lu(A.lessThan(1e-4),()=>{R.assign(Cn(xg(g,Dt(0,1,0)))),Lu(Ao(R).lessThan(1e-4),()=>{R.assign(Cn(xg(g,Dt(1,0,0))))})}).Else(()=>{R.assign(Cn(v))});const L=Cn(g).toVar(),D=xg(R,L).toVar(),U=k(0).toVar(),B=dn(M,N).toVar(),P=k(.0042).add(r(y.mul(331.7)).sub(.5).mul(9e-4)).toVar(),J=k(0).toVar();ma(920,()=>{const mt=i(B,A,x).toVar(),F=i(B.add(mt.mul(P).mul(.5)),A,x).toVar(),Y=i(B.add(F.mul(P).mul(.5)),A,x).toVar(),tt=i(B.add(Y.mul(P)),A,x).toVar();B.addAssign(mt.add(F.mul(2)).add(Y.mul(2)).add(tt).mul(P.div(6))),U.addAssign(P.mul(A)),Lu(oi(B.x).greaterThan(S),()=>{J.assign(1),Lq()})});const q=Cn(L.mul(Yo(U)).add(D.mul($i(U)))).toVar(),ft=Dt(0).toVar();Lu(J.equal(0),()=>{ft.assign(Dt(1,.8,.4).mul(2))}).ElseIf(B.x.lessThan(0),()=>{ft.assign(s(q))}).Else(()=>{ft.assign(n(q))});const Mt=r(q.mul(700)).sub(.5).mul(.01);return ft.addAssign(Dt(Mt)),ft}),c=new We(500,320,320),u=new Bc({side:Ss});u.colorNode=a(ir,kc.sub(ir).normalize()),u.depthWrite=!1;const d=new C(c,u);return d.name="scene07-wormhole-sky",d.renderOrder=-100,d}function Nj(){const t=new Float32Array(4200),e=new Float32Array(1400*3);for(let a=0;a<1400;a+=1){const c=Math.random()*2-1,u=Math.random()*Math.PI*2,d=St.lerp(230,470,Math.pow(Math.random(),.6)),f=Math.sqrt(1-c*c),p=d*f*Math.cos(u),g=d*c,y=d*f*Math.sin(u);t[a*3]=p,t[a*3+1]=g,t[a*3+2]=y;const x=St.lerp(.65,1,Math.pow(Math.random(),1.5)),S=St.lerp(.96,1,Math.random()),T=St.lerp(.88,.99,Math.random());e[a*3]=x*S,e[a*3+1]=x*.97,e[a*3+2]=x*T}const n=new Qe;n.setAttribute("position",new fs(t,3)),n.setAttribute("color",new fs(e,3));const s=new er({size:1.05,sizeAttenuation:!0,vertexColors:!0,transparent:!0,opacity:.94,depthWrite:!1}),i=new to(n,s);return i.name="scene07-starfield",i.renderOrder=-95,i}function Rj(){const r=new vt;r.name="scene07-endurance";function t(B,P,J){const q=new Xs;return q.colorNode=Ke(B),q.roughnessNode=k(P),q.metalnessNode=k(J),q}const e=t(14540253,.4,.6),n=t(3355443,.5,.7),s=t(1118481,.15,.9),i=t(328965,.05,.8),a=[e,n,s,i],c=32,u=12;for(let B=0;B<u;B+=1){const P=B/u*Math.PI*2,J=new vt,q=new X(8,7,10),ft=new C(q,e);ft.castShadow=!0,ft.receiveShadow=!0,J.add(ft);const Mt=new C(new X(7.5,6.5,1),s);Mt.position.set(0,0,-4.6),Mt.castShadow=!0,Mt.receiveShadow=!0,J.add(Mt);const mt=new C(new X(8.2,2,4),n);mt.position.set(0,0,1),J.add(mt),J.position.set(Math.cos(P)*c,Math.sin(P)*c,0),J.rotation.z=P+Math.PI/2,J.lookAt(0,0,0),r.add(J);const F=P+Math.PI/u,Y=new vt;Y.position.set(Math.cos(F)*c,Math.sin(F)*c,0),Y.rotation.z=F;const tt=new C(new qt(2,2,9,32),e);tt.castShadow=!0,tt.receiveShadow=!0,Y.add(tt);const lt=new C(new qt(2.8,2.8,2.5,32),e);Y.add(lt);const Tt=new qt(1.2,1.2,3.5,32),O=new C(Tt,i);O.rotation.z=Math.PI/2,Y.add(O);const et=new C(new qt(1.5,1.5,3.2,32),n);et.rotation.z=Math.PI/2,Y.add(et),r.add(Y)}const d=c-5,f=new vt;f.position.set(0,d/2+2,0);const p=new C(new qt(2.5,2.5,d,32),e);p.castShadow=!0,p.receiveShadow=!0,f.add(p);for(let B=-1;B<=1;B+=1){const P=new C(new qt(3,3,2,32),n);P.position.y=B*(d/3),f.add(P)}r.add(f);const g=new C(new qt(4,4,3,32),e);g.rotation.x=Math.PI/2,g.castShadow=!0,g.receiveShadow=!0,r.add(g);const y=new C(new da(3,.5,16,64),n);y.position.z=1.5,r.add(y);const x=new vt,S=new gi(4.5,10,4);S.rotateY(Math.PI/4),S.rotateX(Math.PI/2),S.scale(1.1,.2,1);const T=new C(S,e);T.castShadow=!0,T.receiveShadow=!0,x.add(T);const M=S.clone();M.scale(.98,.5,.98),M.translate(0,-.15,0);const N=new C(M,n);N.castShadow=!0,x.add(N);const v=new C(new X(2.2,.8,3.5),e);v.position.set(0,.4,0),v.rotation.x=Math.PI/16,v.castShadow=!0,x.add(v);const A=new C(new X(1.8,.6,1.5),i);A.position.set(0,.7,1.2),A.rotation.x=Math.PI/6,x.add(A);const R=new X(3.5,.2,4),L=new C(R,e);L.position.set(-2.8,0,-2.5),L.rotation.y=Math.PI/8,L.castShadow=!0,x.add(L);const D=new C(R,e);D.position.set(2.8,0,-2.5),D.rotation.y=-Math.PI/8,D.castShadow=!0,x.add(D);const U=new C(new X(3,1,1.5),n);return U.position.set(0,-.1,-4.8),x.add(U),x.position.set(0,0,7.5),x.rotation.set(0,0,0),r.add(x),{group:r,materials:a}}const Ej={id:"wormhole-crossing",title:"Wormhole Crossing Sequence",create(){let r=null,t=null,e=null,n=0,s=0,i=0,a=null,c=null,u=null;const d={elapsed:0,spinAngle:0},f=new V(-9.4,1.25,11.8),g=new V(0,-25,-170).clone().sub(f);function y(x){const S=Math.max(x,0);t.position.copy(f).addScaledVector(g,S);const T=Math.exp(-S*2.4);t.position.x+=Math.sin(S*Math.PI*1.2)*.2*T,t.position.y+=Math.sin(S*Math.PI*.9)*.1*T}return{init({root:x,camera:S,renderer:T,scene:M}){r=new vt,r.name="scene07-wormhole-crossing",r.add(Aj()),r.add(Nj());const N=new Co(16777215,.42);N.name="scene07-ambient",r.add(N);const v=new wi(16777215,2.3);v.name="scene07-sun",v.position.set(7.5,5.2,8.5),r.add(v),e=Rj(),t=new vt,t.name="scene07-ship-rig",t.scale.setScalar(_j),t.add(e.group),r.add(t),x.add(r),M&&(a=M.background,M.background=new Xt(0)),S&&(n=S.near,s=S.far,i=S.fov,S.near=.05,S.far=1200,S.fov=55,S.updateProjectionMatrix(),S.position.set(0,1.8,14),S.lookAt(Mj),c=S.position.clone()),u=A=>{vj.has(A.code)&&document.pointerLockElement===T?.domElement&&(A.preventDefault(),A.stopPropagation(),typeof A.stopImmediatePropagation=="function"&&A.stopImmediatePropagation())},window.addEventListener("keydown",u,!0),window.addEventListener("keyup",u,!0),d.elapsed=0,d.spinAngle=0,y(0),e.group.rotation.set(.46,-.12,.9)},update({delta:x,camera:S}){if(!t||!e||!S||!c)return;S.position.copy(c);const T=Math.min(Math.max(x,0),.05);d.elapsed+=T;const N=d.elapsed/13;y(N),d.spinAngle+=T*.78,e.group.rotation.set(.46,-.12,.9+d.spinAngle)},resize(){},dispose({camera:x,scene:S}){u&&(window.removeEventListener("keydown",u,!0),window.removeEventListener("keyup",u,!0),u=null),x&&(x.near=n||x.near,x.far=s||x.far,x.fov=i||x.fov,x.updateProjectionMatrix()),S&&(S.background=a??S.background),r&&(Fi(r),r=null),t=null,e=null,c=null}}}},Cj=200,Dj=100,bw=[[.94,.32,.38,28,.5],[-.42,.91,.24,18,.46],[.78,-.52,.16,12,.42],[-.35,-.78,.1,10,.35],[.55,.62,.06,9.5,.28]],Bj=.38;function Lj(){const r=he(0),t=he(new V(-.28,.62,-.73).normalize()),e=_n(([g])=>{const y=g.y,x=Dt(.52,.68,.88),S=Dt(.76,.87,.99),T=Dt(.5,.72,.95),M=Dt(.19,.44,.83),N=Dt(.04,.13,.52),v=ln(k(-.1),k(0),y),A=ln(k(0),k(.28),y),R=ln(k(.28),k(.85),y),L=Zt(Zt(x,S,v),Zt(T,Zt(M,N,R),A),A),D=wr(xe(g,t),k(0),k(1)),U=zn(D,k(5e3)).mul(50),B=zn(D,k(20)).mul(2.8),P=zn(D,k(4)).mul(.5);return L.add(Dt(1,.95,.75).mul(U)).add(Dt(1,.72,.32).mul(B)).add(Dt(1,.8,.5).mul(P))}),n=new Bc({side:Ss});n.colorNode=e(Cn(ji.xyz));const s=new C(new We(1500,32,16),n);s.name="miller-ocean-sky-dome";const i=_n(([g,y])=>{let x=k(0),S=k(0),T=k(0);for(const[M,N,v,A,R]of bw){const L=2*Math.PI/A,D=Math.sqrt(9.81*L),U=R*v,B=k(L).mul(k(M).mul(g).add(k(N).mul(y))).sub(k(D).mul(r));x=x.add(k(M*U).mul(Yo(B))),S=S.add(k(v).mul($i(B))),T=T.add(k(N*U).mul(Yo(B)))}return Dt(g.add(x),S,y.add(T))}),a=_n(([g,y])=>{let x=k(0),S=k(0),T=k(0);for(const[M,N,v,A,R]of bw){const L=2*Math.PI/A,D=Math.sqrt(9.81*L),U=L*v,B=k(L).mul(k(M).mul(g).add(k(N).mul(y))).sub(k(D).mul(r));x=x.add(k(M*U).mul($i(B))),S=S.add(k(R*U).mul(Yo(B))),T=T.add(k(N*U).mul($i(B)))}return Cn(Dt(x.negate(),k(1).sub(S),T.negate()))}),c=Hq(a(ji.x,ji.z)),u=_n(()=>{const g=kc.xyz,y=Cn(c),x=r,S=k(Math.PI*2),T=g.xz.mul(.44).add(dn(x.mul(.023),x.mul(.016))),M=g.xz.mul(.8).add(dn(x.mul(-.016),x.mul(.03))),N=g.xz.mul(1.55).add(dn(x.mul(.011),x.mul(-.021))),v=g.xz.mul(2.8).add(dn(x.mul(-.008),x.mul(.014))),A=Dt($i(T.x.mul(S)).mul(.06),k(1),Yo(T.y.mul(S)).mul(.06)),R=Dt($i(M.x.mul(S)).mul(.04),k(1),Yo(M.y.mul(S)).mul(.04)),L=Dt($i(N.x.mul(S)).mul(.022),k(1),Yo(N.y.mul(S)).mul(.022)),D=Dt($i(v.x.mul(S)).mul(.01),k(1),Yo(v.y.mul(S)).mul(.01)),U=Cn(y.add(A.mul(k(.32))).add(R.mul(k(.22))).add(L.mul(k(.13))).add(D.mul(k(.07)))),B=Cn(ir.sub(g)),P=wr(xe(U,B),k(.001),k(1)),J=k(.02),q=J.add(k(1).sub(J).mul(zn(k(1).sub(P),k(5)))),ft=Gq(B.negate(),U),Mt=e(ft),mt=wr(xe(ft,t),k(0),k(1)),F=zn(mt,k(2500)).mul(22),Y=zn(mt,k(14)).mul(1.5),tt=Dt(1,.95,.72).mul(F).add(Dt(1,.7,.36).mul(Y)),lt=Mt.add(tt),Tt=Dt(.005,.042,.115),O=Dt(.022,.15,.268),et=Zt(Tt,O,k(1).sub(q).mul(.3)),z=zn(wr(xe(B,t.negate()),k(0),k(1)),k(4)),W=Dt(0,.27,.19).mul(z.mul(.42)).mul(k(1).sub(q)),yt=zn(wr(k(1).sub(U.y).mul(5),k(0),k(1)),k(2)),K=Dt(.9,.95,1).mul(yt.mul(.28)),Z=Cn(B.add(t)),H=wr(xe(U,Z),k(0),k(1)),j=zn(H,k(1200)).mul(22),ct=Dt(1,.96,.8).mul(j),xt=Zt(et.add(W),lt,q).add(ct).add(K),at=Ao(g.sub(ir)),ut=wr(k(1).sub(En(at.negate().mul(.0026))),k(0),k(1)),$=Dt(.76,.87,.99);return Zt(xt,$,ut)}),d=new ns(1200,1200,256,256);d.rotateX(-Math.PI/2);const f=new Bc;f.positionNode=i(ji.x,ji.z),f.colorNode=u();const p=new C(d,f);return p.name="miller-ocean-surface",{oceanMesh:p,skyMesh:s,timeU:r}}function Oj(r,t,e){let n=0;for(const[s,i,a,c]of bw){const u=2*Math.PI/c,d=Math.sqrt(9.81*u),f=u*(s*r+i*t)-d*e;n+=a*Math.sin(f)}return n}function t3(){const r=new vt;r.name="miller-astronaut";const t=new Dy({color:15921902,roughness:.78,metalness:.08,sheen:.22,sheenColor:13489631}),e=new bt({color:7305608,roughness:.58,metalness:.26}),n=new Dy({color:1448740,roughness:.1,metalness:.9,clearcoat:1,clearcoatRoughness:.12}),s=new C(new X(1.05,1.28,.62),t);s.position.y=2.42,r.add(s);const i=new C(new X(.42,.26,.12),e);i.position.set(0,2.23,.37),r.add(i);const a=new vt;a.position.set(0,3.52,0),a.rotation.y=Math.PI,r.add(a);const c=new C(new X(.92,.86,.8),t);a.add(c);const u=new C(new X(.56,.44,.1),n);u.position.set(0,.03,.45),a.add(u);const d=new C(new X(.56,.82,.24),e);d.position.set(0,2.41,-.42),r.add(d);const f=new vt,p=new C(new X(.26,.56,.26),t);p.position.y=-.16,f.add(p);const g=new C(new X(.24,.5,.24),t);g.position.y=-.72,f.add(g),f.position.set(-.66,2.58,.02),r.add(f);const y=f.clone(!0);y.position.x=.66,r.add(y);const x=new vt,S=new C(new X(.34,.72,.34),t);S.position.y=-.2,x.add(S);const T=new C(new X(.31,.68,.31),t);T.position.y=-.9,x.add(T);const M=new C(new X(.42,.22,.65),e);M.position.set(0,-1.34,-.12),x.add(M),x.position.set(-.24,1.74,0),r.add(x);const N=x.clone(!0);N.position.x=.24,r.add(N);const v=new C(new X(.22,.22,.22),e);v.position.set(-.66,2.92,0),r.add(v);const A=v.clone();return A.position.x=.66,r.add(A),r.userData.pose={leftArm:f,rightArm:y,leftLeg:x,rightLeg:N,neutralY:r.position.y},r}function Fj(){const r=document.createElement("canvas");r.width=1024,r.height=4096;const t=r.getContext("2d");if(!t){const i=new ox(new Uint8Array([0,0,0,255]),1,1,Ki);return i.colorSpace=bn,i.needsUpdate=!0,i}t.clearRect(0,0,r.width,r.height);const e=r.width,n=r.height;t.fillStyle="#050505",t.fillRect(e*.1,n*.28,e*.8,n*.08),t.fillRect(e*.1,n*.72,e*.38,n*.12),t.fillRect(e*.52,n*.72,e*.38,n*.12),t.fillStyle="#a55a30",t.textAlign="center",t.textBaseline="middle",t.font="bold 40px sans-serif",t.fillText("MARINE CORPS",e*.5,n*.43),t.font="bold 240px sans-serif",t.scale(1,1.2),t.fillText("CASE",e*.5,n*.48/1.2),t.scale(1,1/1.2),t.font="bold 40px sans-serif",t.fillText("U.S.M.C.",e*.5,n*.53);const s=new Ti(r);return s.colorSpace=bn,s.anisotropy=16,s.needsUpdate=!0,s}function T2(r,t={}){const e=new Xs,n=Ke(.55,.55,.55),s=Ke(.1,.1,.1),i=k(.85),a=kq(),c=si($i(a.x.mul(800).add(a.y.mul(20))).mul(43758.5453)),u=Zt(k(.3),k(.45),c),d=dn(3,30),f=a.mul(d),p=k(.08),g=me(p,si(f.x)).mul(me(p,k(1).sub(si(f.x)))),y=me(p,si(f.y)).mul(me(p,k(1).sub(si(f.y)))),x=g.mul(y),S=k(1).sub(x),T=le(me(k(.88),a.y),me(a.y,k(.12))),M=me(k(.5),op.x.abs().add(op.z.abs())),N=S.mul(T).mul(M);let v=Zt(n,s,N.mul(k(.8))),A=Zt(u,k(.9),N);if(t.hasDecals){const R=Np(r),L=me(k(.9),op.z),D=me(k(.1),R.a).mul(L),U=me(R.r,k(.1)).mul(D);v=Zt(v,R,D),A=Zt(A,k(.05),U),e.metalnessNode=Zt(i,k(0),U)}else e.metalnessNode=i;if(t.hasCircle){const R=me(k(.9),op.x),L=Ao(a.sub(dn(.5,.65))),D=me(L,k(.15)),U=me(L,k(.13)),B=me(L,k(.05)),P=le(D.sub(U),B).mul(R);v=Zt(v,s,P),A=Zt(A,k(.8),P)}return e.colorNode=v,e.roughnessNode=A,e}function Uj(r){const i=new X(.65,5,.65),a=T2(r),c=T2(r,{hasDecals:!0}),u=T2(r,{hasCircle:!0}),d=new vt;d.name="miller-tars";const f=.25,p=-.25,g=new C(i,a);g.position.x=-.65*1.5-.02*1.5,g.rotation.x=f,d.add(g);const y=new C(i,c);y.position.x=-.65*.5-.02*.5,y.rotation.x=p,d.add(y);const x=new C(i,a);x.position.x=.65*.5+.02*.5,x.rotation.x=p,d.add(x);const S=new C(i,u);return S.position.x=.65*1.5+.02*1.5,S.rotation.x=f,d.add(S),d.position.y=5/2,d}function Sw(r,t){const e=r.mul(t);return si($i(xe(e,Dt(12.9898,78.233,37.719))).mul(43758.5453))}function Pj(){const r=new Xs,t=ji,e=.8,n=.5,s=me(.96,si(t.x.mul(e))),i=me(.96,si(t.z.mul(n))),a=le(s,i),c=Sw(t,k(15)).mul(.1),u=Ke(15527664),d=Ke(13686234),f=Ke(6316128);let p=Zt(u,d,c);p=Zt(p,f,a);const g=me(k(8.2),t.z),y=me(t.z,k(-4)).mul(me(k(.8),t.y)),x=le(g,y.mul(Sw(t,k(5)).mul(.5)));return p=Zt(p,Ke(2236962),x),r.colorNode=p,r.roughnessNode=k(.4).add(c).add(a.mul(.4)),r.metalnessNode=k(.15),r}function zj(){const r=new Xs,t=Sw(ji,k(25)).mul(.08);return r.colorNode=Ke(1381912).add(t),r.roughnessNode=k(.85).sub(t),r.metalnessNode=k(.3),r}function Ij(){const r=new Xs;return r.colorNode=Ke(66051),r.roughnessNode=k(.02),r.metalnessNode=k(.95),r}function Vj(){const e=new X(1,1,1,16,4,32),n=e.attributes.position;for(let s=0;s<n.count;s+=1){const i=n.getX(s)*2,a=n.getY(s)*2,c=n.getZ(s)*2,u=c*(18/2);let d=0;u<-3?d=8.5/2:u<6?d=St.lerp(8.5/2,1.2,(u+3)/9):d=St.lerp(1.2,.3,(u-6)/3),d*=1-Math.pow(Math.abs(c),4)*.05;const f=i*d;let p=0;if(a>0){u<-4?p=1:u<1?p=St.lerp(1,2.2,(u+4)/5):u<7?p=St.lerp(2.2,.4,(u-1)/6):p=St.lerp(.4,.1,(u-7)/2);const g=Math.pow(Math.abs(i),1.5),y=St.lerp(.8,.1,(u+9)/18);p=St.lerp(p,y,g)}else p=-.1+(u+9)/18*.2;n.setXYZ(s,f,p,u)}return e.computeVertexNormals(),e}function Gj(){const r=new vt;r.name="miller-ranger";const t=new vt,e=Pj(),n=zj(),s=Ij();t.add(new C(Vj(),e));const i=R=>{const L=new vt,D=R?1:-1,U=new C(new X(1.5,.8,6),n);U.position.set(4*D,.3,-5),U.rotation.y=.05*D,L.add(U);const B=new C(new X(1,.5,6.5),n);B.position.set(3*D,.2,.5),B.rotation.y=-.28*D,L.add(B);const P=new C(new X(.5,.3,4),n);return P.position.set(1.4*D,.1,5),P.rotation.y=-.45*D,L.add(P),L};t.add(i(!0)),t.add(i(!1));const a=new C(new X(8.2,1.4,1.2),n);a.position.set(0,.4,-8.6),t.add(a);const c=Math.atan2(1.8,6),u=(R,L,D,U,B,P=0)=>{const J=B/9;let q=St.lerp(4.25,1.2,(B+3)/9);q*=1-Math.pow(Math.abs(J),4)*.05;const ft=Math.min(Math.abs(U)/q,1),Mt=St.lerp(2.2,.4,(B-1)/6),mt=Math.pow(ft,1.5),F=St.lerp(.8,.1,(B+9)/18),Y=St.lerp(Mt,F,mt),tt=Math.min((Math.abs(U)+.1)/q,1),lt=St.lerp(Mt,F,Math.pow(tt,1.5)),Tt=Math.atan2(lt-Y,.1)*Math.sign(U),O=new C(new X(R,L,D),s);O.position.set(U,Y-L/2+.03,B),O.rotation.set(c,P,Tt),t.add(O)};u(.7,.1,.8,-.8,1.8,-.1),u(.7,.1,.8,0,1.8,0),u(.7,.1,.8,.8,1.8,.1),u(.9,.1,.9,-1,3,-.15),u(.9,.1,.9,0,3,0),u(.9,.1,.9,1,3,.15),u(1,.1,1,-1.2,4.2,-.2),u(1,.1,1,0,4.2,0),u(1,.1,1,1.2,4.2,.2);const d=-Math.atan2(1.2,5),f=(R,L)=>{const D=new C(new X(.8,.1,1),s);D.position.set(R,1.95,L),D.rotation.set(d,0,R>0?-.1:.1),t.add(D)};f(-.7,.2),f(.7,.2);const p=new vt,g=new C(new qt(.06,.05,1.8,8),e);g.position.set(0,-1.5,0),p.add(g);const y=new C(new qt(.05,.05,1.8,8),n);y.rotation.x=-Math.PI/4,y.position.set(0,-.8,-.6),p.add(y);const x=new C(new X(.3,.4,.4),n);x.position.set(0,-.6,0),p.add(x);const S=new C(new X(.8,.15,2.2),n);S.position.set(0,-2.4,0),p.add(S),p.position.set(3.2,.2,-4.5),t.add(p);const T=p.clone();T.position.set(-3.2,.2,-4.5),t.add(T);const M=new vt,N=new C(new qt(.05,.04,1.6,8),e);N.position.set(0,-1.4,0),M.add(N);const v=new C(new qt(.04,.04,1.2,8),n);v.rotation.x=Math.PI/4,v.position.set(0,-.8,.4),M.add(v);const A=new C(new X(.6,.15,1.5),n);return A.position.set(0,-2.2,0),M.add(A),M.position.set(0,.6,5.5),t.add(M),t.rotation.x=-.04,t.position.y=2.22,r.add(t),r}function kj(){const r=new ns(420,152,Cj,Dj),t=r.attributes.position,e=t.count,n=new Float32Array(t.array.length);n.set(t.array);for(let d=0;d<e;d+=1){const f=t.getX(d),p=t.getY(d),g=Math.sin(f*.021)*2.8,y=Math.max(0,p-24)*.56,x=Math.sin(f*.17+p*.11)*2.35+Math.cos(f*.12-p*.05)*1.4;t.setZ(d,g+y+x)}t.needsUpdate=!0,r.computeVertexNormals();const s=new Dy({color:2438721,roughness:.14,metalness:.05,transmission:.07,thickness:1.2,clearcoat:.9,clearcoatRoughness:.26,reflectivity:.88,ior:1.33,transparent:!0,opacity:.94}),i=new C(r,s);i.position.set(0,46,232);const a=r.clone(),c=new bt({color:15003123,roughness:.46,metalness:.05,transparent:!0,opacity:.26}),u=new C(a,c);return u.position.set(0,90.5,227.5),u.scale.set(1,.18,1),{basePositions:n,wave:i,foam:u}}function e3(r,t,e,n=0){if(!r?.userData?.pose)return;const s=Math.sin(t*1.6+e)*.33,i=Math.sin(t*3.8+e*2.6)*.045;r.position.y=r.userData.pose.neutralY+i,r.rotation.y=n+Math.sin(t*.27+e)*.05,r.userData.pose.leftArm.rotation.x=-.25+s*.45,r.userData.pose.rightArm.rotation.x=.22-s*.42,r.userData.pose.leftLeg.rotation.x=.18-s*.58,r.userData.pose.rightLeg.rotation.x=-.16+s*.52}function n3(r,t,e,n=1){if(!r||!t?.geometry?.attributes?.position)return;const s=t.geometry.attributes.position,i=s.count,a=e*.62;for(let c=0;c<i;c+=1){const u=r[c*3],d=r[c*3+1],f=r[c*3+2],p=Math.sin(u*.086+a+d*.17)*2.6*n,g=Math.cos(u*.042-a*.42+d*.14)*2.9*n,y=Math.max(0,d-23)*.11*(1+Math.sin(a*.8)*.3);s.setZ(c,f+p+g+y)}s.needsUpdate=!0,t.geometry.computeVertexNormals()}const Hj={id:"millers-planet-wave",title:"Miller's Planet and Wave",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,g=null,y=null,x=null,S=null;return{init({root:T,camera:M,scene:N}){t=T,r=new vt,r.name="scene-millers-planet-wave",T.add(r),x=N.fog,S=N.background,N.background=new Xt(134168),N.fog=new Hu(12108232,.0068);const v=new $p(15002350,5005421,1);r.add(v);const A=new wi(16118507,1.95);A.position.set(-18,27,11),r.add(A);const R=new wi(12242393,.68);R.position.set(10,7,-8),r.add(R);const L=Lj();e=L.skyMesh,n=L.oceanMesh,s=L.timeU,r.add(e),r.add(n);const D=kj();i=D.wave,a=D.foam,c=D.basePositions,u=new Float32Array(a.geometry.attributes.position.array),r.add(i),r.add(a),d=t3(),d.position.set(-1.9,-.54,2.8),d.rotation.y=-.12,d.userData.pose.neutralY=d.position.y,r.add(d),f=t3(),f.scale.setScalar(.96),f.position.set(1.85,-.78,6.15),f.rotation.y=.34,f.userData.pose.neutralY=f.position.y,r.add(f),y=Fj(),g=Uj(y),g.position.set(6.35,2.05,5.15),g.rotation.y=4,r.add(g),p=Gj(),p.scale.setScalar(2),p.position.set(.8,-2,22.6),p.rotation.y=-Math.PI/2,r.add(p),M.position.set(1.8,3.2,-5.6),M.lookAt(.2,1.5,10.8)},update({elapsed:T,camera:M}){if(s&&(s.value=T*.55),M){const v=Oj(M.position.x,M.position.z,T*.55)+Bj;M.position.y<v&&(M.position.y=v)}if(i){const N=(Math.sin(T*.16)*.5+.5)*1;i.position.z=St.lerp(238,118,N),i.position.x=Math.sin(T*.05)*7.8,i.rotation.y=Math.sin(T*.07)*.055,n3(c,i,T,1)}a&&(a.position.z=i?i.position.z-4.2:a.position.z,a.position.x=i?i.position.x:a.position.x,a.rotation.y=i?i.rotation.y:a.rotation.y,n3(u,a,T+.85,.8)),e3(d,T,0,-.12),e3(f,T,1.6,.34)},resize(){},dispose({scene:T}){T.fog=x,T.background=S,y&&(y.dispose(),y=null),r&&(t&&r.parent!==t&&t.add(r),Fi(r)),r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,g=null,x=null,S=null}}}};function Wj(){const r=new Xs,t=ji.xz,e=j=>{let ct=k(0);ct=ct.add(hi(Dt(j.x.mul(4e-4),k(0),j.y.mul(4e-4))).mul(350));const xt=hi(Dt(j.x.mul(.002),k(100),j.y.mul(.002))),at=k(1).sub(oi(xt));return ct=ct.add(at.mul(at).mul(150)),ct=ct.add(hi(Dt(j.x.mul(.01),k(200),j.y.mul(.01))).mul(25)),ct},n=e(t),s=e(dn(0,0)),i=n.sub(s);r.positionNode=ji.add(Dt(0,i,0));const a=k(.5),c=e(t.add(dn(a.negate(),k(0)))),u=e(t.add(dn(a,k(0)))),d=e(t.add(dn(k(0),a.negate()))),f=e(t.add(dn(k(0),a))),p=u.sub(c).div(a.mul(2)),g=f.sub(d).div(a.mul(2)),y=Cn(Dt(p.negate(),k(1),g.negate())),x=xe(y,Dt(0,1,0)),S=hi(Dt(t.x.mul(.01),k(5),t.y.mul(.01))).mul(.1),T=ln(k(.75),k(.65),x.add(S)),M=hi(Dt(t.x.mul(.003),k(10),t.y.mul(.001))),N=ln(k(-.2),k(.3),M),v=hi(Dt(t.x.mul(.08),k(20),t.y.mul(.08))),A=ln(k(.3),k(.7),v),R=Ke("#e6ecf0"),L=k(.9),D=hi(Dt(t.x.mul(.8),k(30),t.y.mul(.8))),U=hi(Dt(t.x.mul(.8),k(31),t.y.mul(.8))),B=Dt(D.mul(.2),k(0),U.mul(.2)),P=Ke("#9ca7b0"),J=k(.4),q=hi(Dt(t.x.mul(.2),k(40),t.y.mul(.05))),ft=hi(Dt(t.x.mul(.2),k(41),t.y.mul(.05))),Mt=Dt(q.mul(.1),k(0),ft.mul(.1)),mt=Ke("#3c4245"),F=k(.95),Y=hi(Dt(t.x.mul(.4),k(50),t.y.mul(.4))),tt=hi(Dt(t.x.mul(.4),k(51),t.y.mul(.4))),lt=Dt(Y.mul(.4),k(0),tt.mul(.4)),Tt=Ke("#2a2d2f"),O=k(.85),et=hi(Dt(t.x.mul(.1),k(60),t.y.mul(.1))),z=hi(Dt(t.x.mul(.1),k(61),t.y.mul(.1))),W=Dt(et.mul(.6),k(0),z.mul(.6));let yt=Zt(R,P,N),K=Zt(L,J,N),Z=Zt(B,Mt,N);yt=Zt(yt,mt,A),K=Zt(K,F,A),Z=Zt(Z,lt,A),r.colorNode=Zt(yt,Tt,T),r.roughnessNode=Zt(K,O,T);const H=Zt(Z,W,T);return r.normalNode=Cn(y.add(H)),r.metalnessNode=k(0),r}const qj=new V(0,1,0),$j=10,s3=.02,i3=.5,r3=.2,o3=new V(506.728,-5.863,-342.568),Xj=new V(1379.031,-192.585,-794.478);function a3(r,t){r.updateMatrixWorld(!0);const e=new ga().setFromObject(r);Number.isFinite(e.min.y)&&(r.position.y+=t-e.min.y)}function xu(r,t){return(r<<t|r>>>32-t)>>>0}function jj(r,t,e){return e=(e^t)-xu(t,14)>>>0,r=(r^e)-xu(e,11)>>>0,t=(t^r)-xu(r,25)>>>0,e=(e^t)-xu(t,16)>>>0,r=(r^e)-xu(e,4)>>>0,t=(t^r)-xu(r,14)>>>0,e=(e^t)-xu(t,24)>>>0,e>>>0}function sc(r,t,e){const i=3735928584+(r>>>0)>>>0,a=3735928584+(t>>>0)>>>0,c=3735928584+(e>>>0)>>>0;return jj(i,a,c)}function _2(r){return r*r*r*(r*(r*6-15)+10)}function ic(r,t,e,n){const s=r&15,i=s<8?t:e,a=s<4?e:s===12||s===14?t:n,c=(s&1)===0?i:-i,u=(s&2)===0?a:-a;return c+u}function Yj(r,t,e,n,s,i,a,c,u,d,f){const p=1-u,g=1-d;return(1-f)*(g*(r*p+t*u)+d*(e*p+n*u))+f*(g*(s*p+i*u)+d*(a*p+c*u))}function M2(r,t,e){const n=Math.floor(r),s=Math.floor(t),i=Math.floor(e),a=r-n,c=t-s,u=e-i,d=_2(a),f=_2(c),p=_2(u),g=ic(sc(n,s,i),a,c,u),y=ic(sc(n+1,s,i),a-1,c,u),x=ic(sc(n,s+1,i),a,c-1,u),S=ic(sc(n+1,s+1,i),a-1,c-1,u),T=ic(sc(n,s,i+1),a,c,u-1),M=ic(sc(n+1,s,i+1),a-1,c,u-1),N=ic(sc(n,s+1,i+1),a,c-1,u-1),v=ic(sc(n+1,s+1,i+1),a-1,c-1,u-1);return .982*Yj(g,y,x,S,T,M,N,v,d,f,p)}function fL(r,t){let e=0;e+=M2(r*4e-4,0,t*4e-4)*350;const n=M2(r*.002,100,t*.002),s=1-Math.abs(n);return e+=s*s*150,e+=M2(r*.01,200,t*.01)*25,e}const Kj=fL(0,0);function wc(r,t){return fL(r,t)-Kj}function Zj(r,t,e=.5){const n=wc(r-e,t),s=wc(r+e,t),i=wc(r,t-e),a=wc(r,t+e),c=(s-n)/(e*2),u=(a-i)/(e*2);return new V(-c,1,-u).normalize()}function Os(r,t){const e=new C(new X(t.size[0],t.size[1],t.size[2]),new bt({color:t.color,roughness:t.roughness??.78,metalness:t.metalness??.14}));return e.position.set(t.position[0],t.position[1],t.position[2]),t.rotation&&e.rotation.set(t.rotation[0],t.rotation[1],t.rotation[2]),t.name&&(e.name=t.name),r.add(e),e}function pL({name:r,accentColor:t}){const e=new vt;e.name=r;const n="#dfe4e8",s="#9ba4ac",i="#0f1822",a="#66727d",c="#5b6670",u=Os(e,{name:`${r}-torso`,size:[1.18,1.6,.72],position:[0,2.08,0],color:n});Os(e,{name:`${r}-chest-plate`,size:[.96,.8,.18],position:[0,2.18,.45],color:s,roughness:.66,metalness:.24}),Os(e,{name:`${r}-backpack`,size:[.86,.95,.34],position:[0,2.08,-.53],color:s,roughness:.64,metalness:.26}),Os(e,{name:`${r}-accent-collar`,size:[.52,.16,.22],position:[0,2.78,.42],color:t}),Os(e,{name:`${r}-accent-stripe`,size:[.16,.64,.07],position:[.26,2.18,.53],color:t}),Os(e,{name:`${r}-left-shoulder`,size:[.4,.22,.4],position:[-.78,2.72,0],color:t}),Os(e,{name:`${r}-right-shoulder`,size:[.4,.22,.4],position:[.78,2.72,0],color:t});const d=Os(e,{name:`${r}-helmet`,size:[.82,.82,.82],position:[0,3.34,0],color:n,roughness:.62,metalness:.3});Os(d,{name:`${r}-visor`,size:[.58,.6,.16],position:[0,-.02,.46],color:i,roughness:.28,metalness:.08});const f=Os(e,{name:`${r}-left-arm`,size:[.34,1.12,.34],position:[-.78,2.05,0],color:n}),p=Os(e,{name:`${r}-right-arm`,size:[.34,1.12,.34],position:[.78,2.05,0],color:n}),g=Os(e,{name:`${r}-left-forearm`,size:[.31,.74,.31],position:[-.78,1.34,.02],color:s}),y=Os(e,{name:`${r}-right-forearm`,size:[.31,.74,.31],position:[.78,1.34,.02],color:s});Os(e,{name:`${r}-left-glove`,size:[.31,.24,.36],position:[-.78,.9,.08],color:a}),Os(e,{name:`${r}-right-glove`,size:[.31,.24,.36],position:[.78,.9,.08],color:a});const x=Os(e,{name:`${r}-left-leg`,size:[.4,1.14,.4],position:[-.24,.84,0],color:n}),S=Os(e,{name:`${r}-right-leg`,size:[.4,1.14,.4],position:[.24,.84,0],color:n});return Os(e,{name:`${r}-left-boot`,size:[.44,.26,.58],position:[-.24,.16,.08],color:c}),Os(e,{name:`${r}-right-boot`,size:[.44,.26,.58],position:[.24,.16,.08],color:c}),u.rotation.z=0,d.rotation.y=.16,f.rotation.z=.06,p.rotation.z=-.06,p.rotation.x=-.04,g.rotation.z=-.08,y.rotation.z=.08,y.rotation.x=-.08,x.rotation.x=0,S.rotation.x=0,e}function Qj({name:r}){return pL({name:r,accentColor:"#74808b"})}function Jj({anchorPosition:r,forward:t}){const e=new vt;e.name="manns-planet-fight-characters";const n=new V().crossVectors(t,qj).normalize(),s=r.clone().addScaledVector(t,$j),i=pL({name:"dr-mann-blocky",accentColor:"#cc6f42"});i.scale.setScalar(i3);const a=.8;i.position.copy(s),i.position.addScaledVector(n,-1.9),i.position.addScaledVector(t,a),a3(i,wc(i.position.x,i.position.z)+s3);const c=Qj({name:"cooper-blocky"});c.scale.setScalar(i3);const u=-1.05;c.position.copy(s),c.position.addScaledVector(n,1.35),c.position.addScaledVector(t,u);const d=Zj(c.position.x,c.position.z),f=new V(i.position.x-c.position.x,0,i.position.z-c.position.z);f.lengthSq()<1e-5&&f.copy(n),f.normalize();const p=f.sub(d.clone().multiplyScalar(f.dot(d)));p.lengthSq()<1e-5&&p.copy(n),p.normalize();const g=p.clone().negate(),y=new V().crossVectors(g,d);y.lengthSq()<1e-5&&y.set(1,0,0),y.normalize();const x=new V().crossVectors(d,y).normalize(),S=new ve().makeBasis(y,x,d);c.quaternion.setFromRotationMatrix(S),a3(c,wc(c.position.x,c.position.z)+s3);const T=new V().subVectors(c.position,i.position);return T.y=0,T.lengthSq()>1e-5&&(i.rotation.y=Math.atan2(T.x,T.z)),i.rotation.x=0,i.rotation.z=0,e.add(i),e.add(c),e}const tY={id:"manns-planet",title:"Dr. Mann's Ice Planet",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null;const d=f=>{const p=wc(f.position.x,f.position.z)+r3;f.position.y<p&&(f.position.y=p,f.updateMatrixWorld())};return{init({root:f,camera:p,renderer:g,scene:y}){t=f,r=new vt,r.name="manns-planet-group",f.add(r),e=y.background,n=y.fog,s=g.toneMapping,i=g.toneMappingExposure,a=p.fov,c=p.near,u=p.far;const x=new Xt("#d4cfcc");y.background=x,y.fog=new Hu(x,.0018),g.toneMapping=Mw,g.toneMappingExposure=1.1;const S=new Co("#aab8c4",.8);r.add(S);const T=new wi("#fff0e0",2);T.position.set(800,600,-1e3),r.add(T);const M=new ns(8e3,8e3,1024,1024);M.rotateX(-Math.PI/2);const N=Wj(),v=new C(M,N);v.name="manns-planet-terrain",r.add(v),p.fov=45,p.near=.1,p.far=15e3,p.position.set(522.722,-15.244,-342.701),p.lookAt(-326.001,93.416,-860.256),p.updateProjectionMatrix(),p.updateMatrixWorld(),d(p);const A=o3.clone(),R=wc(A.x,A.z)+r3;A.y<R&&(A.y=R);const L=new V().subVectors(Xj,o3).normalize(),D=Jj({anchorPosition:A,forward:L});r.add(D)},update({camera:f}){f&&d(f)},resize(){},dispose({root:f,camera:p,renderer:g,scene:y}){y.background=e,y.fog=n,g.toneMapping=s,g.toneMappingExposure=i,a!==null&&c!==null&&u!==null&&(p.fov=a,p.near=c,p.far=u,p.updateProjectionMatrix()),r&&(f&&r.parent!==f&&t&&t.add(r),Fi(r),r=null,t=null)}}}},v_=1,mL=6120,gL=160,l3=mL*v_,c3=(mL+gL)*v_,eY=new Xt(132106),nY=new Xt(16777215),yL=new V(.88,.2,.43).normalize(),sY=46,iY=35,xL=9e4,u3=18,h3=10,rY=1.7,oY=340,d3=new V(6895.77,4931.842,6170.045),aY=new V(6480.178,4737.868,5281.418),lY=56,cY=-8,uY=-96,hY=6,dY=-188,v2=3.15,fY=6.5,A2=4,pY=14.5,mY=3,gY=3,f3=4.1,yY=.35,xY=new V(0,0,1.5),Ng=new V(0,0,1),bY=4.5/12*Math.PI*2,SY=24,wY=28,TY=37,_Y=-2.6,MY=2.6,vY=.95,AY=.2,NY=8.8,RY=.45,EY=1.25,CY=.9,DY=2.8,BY=2.2,LY=8.2,OY=1.8,FY=10.5,UY=18.5,PY=1.8,zY=5.4,p3=95,IY=new Set(["KeyW","KeyA","KeyS","KeyD","Space","ShiftLeft","ShiftRight"]),bu=new V,Ya=new V,Su=new V,wu=new V,Tu=new V,xd=new V,Rg=new V,m3=new V,g3=new V,N2=new V,R2=new V(0,1,0),y3=new Ps,Eg=new Ps,x3=new Ps,Cg=new Ps,b3=new Ps;function Qf(r,t,e){if(r===t)return e<r?0:1;const n=St.clamp((e-r)/(t-r),0,1);return n*n*(3-2*n)}function VY(r,t,e,n,s,i){xd.copy(e).sub(r).multiplyScalar(s),xd.addScaledVector(t,-i),t.addScaledVector(xd,n),r.addScaledVector(t,n)}function GY(r,t,e){r.traverse(n=>{if(!n.isMesh||!n.material)return;const s=i=>{i.polygonOffset=!0,i.polygonOffsetFactor=t,i.polygonOffsetUnits=e,i.needsUpdate=!0};if(Array.isArray(n.material))for(const i of n.material)s(i);else s(n.material)})}function kY(){const t=new Float32Array(21e3),e=new Float32Array(7e3*3),n=xL*.86,s=new V;for(let u=0;u<7e3;u+=1){const d=u*3,f=Math.acos(St.randFloatSpread(2)),p=Math.random()*Math.PI*2,g=Math.sin(f);s.set(g*Math.cos(p),Math.cos(f),g*Math.sin(p)),t[d]=s.x*n,t[d+1]=s.y*n,t[d+2]=s.z*n;const y=St.randFloat(.12,1.05),x=Math.pow(Math.random(),1.05),S=St.clamp(y*(.5+x*.8),.04,1),T=St.randFloat(-.09,.1);e[d]=St.clamp(S+T*.5,.02,1),e[d+1]=St.clamp(S+T*.15,.02,1),e[d+2]=St.clamp(S-T*.45,.02,1)}const i=new Qe;i.setAttribute("position",new ge(t,3)),i.setAttribute("color",new ge(e,3));const a=new er({color:nY,size:1.15,sizeAttenuation:!1,transparent:!0,opacity:1,depthWrite:!1,vertexColors:!0}),c=new to(i,a);return c.name="scene10-space-stars",c}function vu(r,t,e){const n=new Xs;return n.colorNode=Ke(r),n.roughnessNode=k(t),n.metalnessNode=k(e),n}function nl(r){const t=Math.sin(r+1)*43758.5453;return t-Math.floor(t)}function HY({matDarkHull:r,matSolarPanel:t,matTornFace:e,matWhiteHull:n}){const s=new vt,i=new C(new X(8,7,5),n);i.position.set(0,0,-2.5),i.castShadow=!0,i.receiveShadow=!0,s.add(i);const a=new C(new X(7.5,6.5,1),t);a.position.set(0,0,-4.6),a.castShadow=!0,s.add(a);const c=new C(new X(8.2,2,2.5),r);c.position.set(0,0,-1.25),s.add(c);const u=16,d=14,f=-4,p=4,g=-3.5,y=3.5,x=[],S=[],T=(A,R)=>A*(d+1)+R;for(let A=0;A<=u;A+=1)for(let R=0;R<=d;R+=1){const L=f+A/u*(p-f),D=g+R/d*(y-g);let U=.05;if(A>0&&A<u&&R>0&&R<d){const B=A*31+R*17,P=Math.sin(A*2.1+R*1.3)*1.1+Math.cos(A*4.7-R*2.9)*.7+(nl(B)-.5)*1.2;U=.05+Math.abs(P)}x.push(L,D,U)}for(let A=0;A<u;A+=1)for(let R=0;R<d;R+=1){const L=T(A,R),D=T(A+1,R),U=T(A+1,R+1),B=T(A,R+1);S.push(L,D,U,L,U,B)}const M=new Qe;M.setAttribute("position",new ge(x,3)),M.setIndex(S),M.computeVertexNormals();const N=new C(M,e);N.castShadow=!0,s.add(N);const v=20;for(let A=0;A<v;A+=1){const L=A/(v-1)*Math.PI*2,D=Math.cos(L)*3.8,U=Math.sin(L)*3.3,B=nl(A*7),P=nl(A*7+1),J=nl(A*7+2),q=nl(A*7+3),ft=.4+B*1.5,Mt=.3+P*1.2,mt=.3+J*1,F=.1+q*1.5,Y=new C(new X(ft,Mt,mt),n);Y.position.set(D,U,F),Y.rotation.x=(B-.5)*1.5,Y.rotation.y=(P-.5)*1.5,Y.rotation.z=L+(J-.5)*.5,Y.castShadow=!0,s.add(Y)}return s}function WY(){const r=new vt;r.name="scene10-endurance-damaged";const t=vu(14540253,.4,.6),e=vu(3355443,.5,.7),n=vu(1118481,.15,.9),s=vu(328965,.05,.8),i=vu(2236962,.9,.3),a=vu(1710618,.85,.45),c=32,u=12,d=4,f=5;for(let T=0;T<u;T+=1){const M=T/u*Math.PI*2,N=Math.cos(M)*c,v=Math.sin(M)*c;if(T===d){const q=new vt,ft=new C(new X(8,7,1.2),i);ft.castShadow=!0,q.add(ft);const Mt=[{w:.8,h:3,d:.35,x:2.4,y:1.8,z:.55,rx:.2,rz:.3},{w:.5,h:1.8,d:.3,x:-2.1,y:-2.2,z:.55,rx:-.1,rz:-.2},{w:.9,h:1.4,d:.35,x:2.7,y:-1.3,z:.5,rx:.25,rz:.35},{w:.4,h:2.3,d:.28,x:-2.9,y:1,z:.5,rx:-.15,rz:-.28},{w:.7,h:.9,d:.4,x:.3,y:2.7,z:.45,rx:.1,rz:.18}];for(const mt of Mt){const F=new C(new X(mt.w,mt.h,mt.d),i);F.position.set(mt.x,mt.y,mt.z),F.rotation.set(mt.rx,0,mt.rz),F.castShadow=!0,q.add(F)}q.position.set(N,v,0),q.rotation.z=M+Math.PI/2,q.lookAt(0,0,0),r.add(q)}else if(T===f){const q=HY({matDarkHull:e,matSolarPanel:n,matTornFace:a,matWhiteHull:t});q.position.set(N,v,0),q.rotation.z=M+Math.PI/2,q.lookAt(0,0,0),q.rotateY(Math.PI),r.add(q)}else{const q=new vt,ft=new C(new X(8,7,10),t);ft.castShadow=!0,ft.receiveShadow=!0,q.add(ft);const Mt=new C(new X(7.5,6.5,1),n);Mt.position.set(0,0,-4.6),Mt.castShadow=!0,Mt.receiveShadow=!0,q.add(Mt);const mt=new C(new X(8.2,2,4),e);mt.position.set(0,0,1),q.add(mt),q.position.set(N,v,0),q.rotation.z=M+Math.PI/2,q.lookAt(0,0,0),r.add(q)}const A=M+Math.PI/u,R=Math.cos(A)*c,L=Math.sin(A)*c,D=new vt;D.position.set(R,L,0),D.rotation.z=A;const U=new C(new qt(2,2,9,32),t);U.castShadow=!0,U.receiveShadow=!0,D.add(U);const B=new C(new qt(2.8,2.8,2.5,32),t);D.add(B);const P=new C(new qt(1.2,1.2,3.5,32),s);P.rotation.z=Math.PI/2,D.add(P);const J=new C(new qt(1.5,1.5,3.2,32),e);J.rotation.z=Math.PI/2,D.add(J),r.add(D)}const p=c-5,g=new vt;g.position.set(0,p/2+2,0);const y=new C(new qt(2.5,2.5,p,32),t);y.castShadow=!0,y.receiveShadow=!0,g.add(y);for(let T=-1;T<=1;T+=1){const M=new C(new qt(3,3,2,32),e);M.position.y=T*(p/3),g.add(M)}r.add(g);const x=new C(new qt(4,4,3,32),t);x.rotation.x=Math.PI/2,x.castShadow=!0,x.receiveShadow=!0,r.add(x);const S=new C(new da(3,.5,16,64),e);return S.position.z=1.5,r.add(S),r.userData.hullMaterial=t,r}function qY(r){const t=new vt;t.name="scene10-endurance-peeling-debris";const e=r??vu(14540253,.4,.6),n=[];for(let s=0;s<SY;s+=1){const i=s*13,a=.45+nl(i+1)*1.25,c=.35+nl(i+2)*.9,u=.35+nl(i+3)*1.05,d=nl(i+4);let f=null;d<.58?f=new X(a,c,u):d<.86?f=new qt(a*.28,a*.55,u,4,1):f=new Vw(a*.58,0);const p=new C(f,e);p.castShadow=!0,p.receiveShadow=!0,t.add(p),n.push({angularVelocity:new V,axialSpeed:0,detachTime:0,lifetime:0,localAnchor:new V,localBaseQuaternion:new Ps,localOutward:new V,localTangent:new V,maxPeelDistance:0,mesh:p,outwardSpeed:0,peelStartTime:0,peelTwist:0,released:!1,releasedAge:0,rollRate:0,spinCarry:0,tumbleRate:0,velocity:new V})}return{group:t,pieces:n}}function ww(r,t){const e=r.mul(t);return si($i(xe(e,Dt(12.9898,78.233,37.719))).mul(43758.5453))}function $Y(){const r=new Xs,t=ji,e=.8,n=.5,s=me(.96,si(t.x.mul(e))),i=me(.96,si(t.z.mul(n))),a=le(s,i),c=ww(t,k(15)).mul(.1),u=Ke(15527664),d=Ke(13686234),f=Ke(6316128);let p=Zt(u,d,c);p=Zt(p,f,a);const g=me(k(8.2),t.z),y=me(t.z,k(-4)).mul(me(k(.8),t.y)),x=le(g,y.mul(ww(t,k(5)).mul(.5)));return p=Zt(p,Ke(2236962),x),r.colorNode=p,r.roughnessNode=k(.4).add(c).add(a.mul(.4)),r.metalnessNode=k(.15),r}function XY(){const r=new Xs,t=ww(ji,k(25)).mul(.08);return r.colorNode=Ke(1381912).add(t),r.roughnessNode=k(.85).sub(t),r.metalnessNode=k(.3),r}function jY(){const r=new Xs;return r.colorNode=Ke(66051),r.roughnessNode=k(.02),r.metalnessNode=k(.95),r}function YY(){const e=new X(1,1,1,16,4,32),n=e.attributes.position;for(let s=0;s<n.count;s+=1){const i=n.getX(s)*2,a=n.getY(s)*2,c=n.getZ(s)*2,u=c*(18/2);let d=0;u<-3?d=8.5/2:u<6?d=St.lerp(8.5/2,1.2,(u+3)/9):d=St.lerp(1.2,.3,(u-6)/3),d*=1-Math.pow(Math.abs(c),4)*.05;const f=i*d;let p=0;if(a>0){u<-4?p=1:u<1?p=St.lerp(1,2.2,(u+4)/5):u<7?p=St.lerp(2.2,.4,(u-1)/6):p=St.lerp(.4,.1,(u-7)/2);const g=Math.pow(Math.abs(i),1.5),y=St.lerp(.8,.1,(u+9)/18);p=St.lerp(p,y,g)}else p=-.1+(u+9)/18*.2;n.setXYZ(s,f,p,u)}return e.computeVertexNormals(),e}function KY(){const r=new vt;r.name="scene10-ranger";const t=$Y(),e=XY(),n=jY();r.add(new C(YY(),t));const s=p=>{const g=new vt,y=p?1:-1,x=new C(new X(1.5,.8,6),e);x.position.set(4*y,.3,-5),x.rotation.y=.05*y,g.add(x);const S=new C(new X(1,.5,6.5),e);S.position.set(3*y,.2,.5),S.rotation.y=-.28*y,g.add(S);const T=new C(new X(.5,.3,4),e);return T.position.set(1.4*y,.1,5),T.rotation.y=-.45*y,g.add(T),g};r.add(s(!0)),r.add(s(!1));const i=new C(new X(8.2,1.4,1.2),e);i.position.set(0,.4,-8.6),r.add(i);const a=Math.atan2(1.8,6),c=(p,g,y,x,S,T=0)=>{const M=S/9;let N=St.lerp(4.25,1.2,(S+3)/9);N*=1-Math.pow(Math.abs(M),4)*.05;const v=Math.min(Math.abs(x)/N,1),A=St.lerp(2.2,.4,(S-1)/6),R=Math.pow(v,1.5),L=St.lerp(.8,.1,(S+9)/18),D=St.lerp(A,L,R),U=Math.min((Math.abs(x)+.1)/N,1),B=St.lerp(A,L,Math.pow(U,1.5)),P=Math.atan2(B-D,.1)*Math.sign(-x),J=new C(new X(p,g,y),n);J.position.set(x,D-g/2+.02,S),J.rotation.set(a,T,P),r.add(J)};c(.7,.1,.8,-.8,1.8,-.1),c(.7,.1,.8,0,1.8,0),c(.7,.1,.8,.8,1.8,.1),c(.9,.1,.9,-1,3,-.15),c(.9,.1,.9,0,3,0),c(.9,.1,.9,1,3,.15),c(1,.1,1,-1.2,4.2,-.2),c(1,.1,1,0,4.2,0),c(1,.1,1,1.2,4.2,.2);const u=-Math.atan2(1.2,5),d=(p,g)=>{const y=new C(new X(.8,.1,1),n);y.position.set(p,1.95,g),y.rotation.set(u,0,p>0?-.1:.1),r.add(y)};d(-.7,.2),d(.7,.2),r.updateMatrixWorld(!0);const f=new ga().setFromObject(r).getCenter(new V);for(const p of r.children)p.position.sub(f);return GY(r,-1,-2),r}function rc(r,t){return[r[0]*t,r[1]*t,r[2]*t]}function ZY(r){let t=1;switch(r){case"terrestrial":t=2.15;break;case"rocky":t=2;break;case"gasGiant":case"iceGiant":t=1.35;break;default:t=1;break}return t*rY}function QY(r,t){const e=Math.max(r.atmosphereHeightKm,1),n=St.clamp(r.atmosphereDensity,.15,1.8),s=St.clamp((n-.25)/1.35,0,1),i=ZY(r.kind);let a={rayleighScatteringKm:[.0058,.0135,.0331],mieScatteringKm:[.0022,.0022,.0022],mieExtinctionKm:[.0032,.0032,.0032],rayleighScaleHeightKm:St.lerp(7.2,10.8,s),upperRayleighScaleHeightKm:Math.max(36,e*.36*i),upperRayleighStrength:.04,mieScaleHeightKm:St.lerp(.9,1.7,s),miePhaseG:.76,ozoneExtinctionKm:[65e-5,.001881,85e-6],ozoneCenterHeightKm:Math.min(e*.42,26),ozoneWidthKm:Math.max(6,Math.min(e*.18,14)),solarIntensity:13.8};a={rayleighScatteringKm:[.0044,.0104,.024],mieScatteringKm:[.0015,.0015,.0015],mieExtinctionKm:[.0024,.0024,.0024],rayleighScaleHeightKm:Math.max(3.6,Math.min(e*.11,6.2)),upperRayleighScaleHeightKm:Math.max(16,e*.28*i),upperRayleighStrength:.032,mieScaleHeightKm:Math.max(.4,Math.min(e*.035,.95)),miePhaseG:.71,ozoneExtinctionKm:[0,0,0],ozoneCenterHeightKm:e*.45,ozoneWidthKm:Math.max(3.5,e*.14),solarIntensity:11.6};const c=n*.78,u=n*.9,d=rc(a.rayleighScatteringKm,c),f=rc(a.mieScatteringKm,u),p=rc(a.mieExtinctionKm,u),g=[Math.max(p[0],f[0]+1e-4),Math.max(p[1],f[1]+1e-4),Math.max(p[2],f[2]+1e-4)],y=rc(a.ozoneExtinctionKm??[0,0,0],1),x=t,S=1/Math.max(x,1e-6);return{rayleighScatteringWorld:rc(d,S),mieScatteringWorld:rc(f,S),mieExtinctionWorld:rc(g,S),ozoneExtinctionWorld:rc(y,S),rayleighScaleHeightWorld:Math.max(a.rayleighScaleHeightKm*x,1e-5),upperRayleighScaleHeightWorld:Math.max((a.upperRayleighScaleHeightKm??a.rayleighScaleHeightKm*2.6)*x,1e-5),upperRayleighStrength:St.clamp(a.upperRayleighStrength??.05,0,.24),mieScaleHeightWorld:Math.max(a.mieScaleHeightKm*x,1e-5),ozoneCenterHeightWorld:Math.max((a.ozoneCenterHeightKm??0)*x,0),ozoneWidthWorld:Math.max((a.ozoneWidthKm??1)*x,1e-5),miePhaseG:St.clamp(a.miePhaseG,0,.92),solarIntensity:a.solarIntensity??18}}function JY(r,t,e,n,s,i,a,c){const u=Dt(c.rayleighScatteringWorld[0],c.rayleighScatteringWorld[1],c.rayleighScatteringWorld[2]),d=Dt(c.mieScatteringWorld[0],c.mieScatteringWorld[1],c.mieScatteringWorld[2]),f=Dt(c.mieExtinctionWorld[0],c.mieExtinctionWorld[1],c.mieExtinctionWorld[2]),p=Dt(c.ozoneExtinctionWorld[0],c.ozoneExtinctionWorld[1],c.ozoneExtinctionWorld[2]),g=k(c.rayleighScaleHeightWorld),y=k(c.upperRayleighScaleHeightWorld),x=k(c.upperRayleighStrength),S=k(c.mieScaleHeightWorld),T=k(c.ozoneCenterHeightWorld),M=k(c.ozoneWidthWorld),N=k(c.miePhaseG),v=k(c.solarIntensity),A=_n(()=>{const L=ir,D=Cn(kc.sub(ir)),U=Cn(r),B=t,P=e,J=n,q=le(J.sub(P),P.mul(.005)),ft=q.mul(.24),Mt=q.mul(.16),mt=L.sub(B),F=xe(mt,D),Y=xe(mt,mt).sub(J.mul(J)),tt=F.mul(F).sub(Y),lt=me(0,tt),Tt=Mr(le(tt,0)),O=dn(F.negate().sub(Tt),F.negate().add(Tt)),et=xe(mt,D),z=xe(mt,mt).sub(P.mul(P)),W=et.mul(et).sub(z),yt=me(0,W),K=Mr(le(W,0)),Z=dn(et.negate().sub(K),et.negate().add(K)),H=me(0,Z.x).mul(yt),j=le(O.x,0).mul(lt),ct=le(Zt(O.y,__(O.y,Z.x),H),0).mul(lt),xt=le(ct.sub(j),0),at=xt.div(k(u3)),ut=ln(0,Mt,xt),$=xe(D,U),nt=k(.05968310365946075).mul(k(1).add($.mul($))),ht=N.mul(N),dt=k(.07957747154594767).mul(k(1).sub(ht)).div(zn(k(1).add(ht).sub(k(2).mul(N).mul($)),1.5)),pt=k(0).toVar(),Rt=k(0).toVar(),Ft=k(0).toVar(),Gt=Dt(0,0,0).toVar();ma(u3,({i:os})=>{const jn=j.add(at.mul(k(os).add(.5))),Yn=L.add(D.mul(jn)),we=Yn.sub(B),Ye=Ao(we),Dn=Ye.sub(P),Ge=me(0,Dn),as=le(Dn,0),Te=le(J.sub(Ye),0),_e=ln(0,ft,Te),Kn=En(as.negate().div(g)),ls=En(as.negate().div(y)).mul(x),Bn=Kn.add(ls).mul(Ge).mul(_e),Ee=En(as.negate().div(S)).mul(Ge).mul(_e),ke=le(k(1).sub(oi(as.sub(T)).div(M)),0).mul(Ge).mul(_e);pt.addAssign(Bn.mul(at)),Rt.addAssign(Ee.mul(at)),Ft.addAssign(ke.mul(at));const $e=xe(we,U),js=xe(we,we).sub(J.mul(J)),oo=$e.mul($e).sub(js),Rr=me(0,oo),Ui=Mr(le(oo,0)),Do=dn($e.negate().sub(Ui),$e.negate().add(Ui)),ao=le(Do.x,0).mul(Rr),Ys=le(Do.y.sub(ao),0).mul(Rr).div(k(h3)),_i=xe(we,U),ba=xe(we,we).sub(P.mul(P)),lo=_i.mul(_i).sub(ba),gl=me(0,lo),Pi=Mr(le(lo,0)),Zn=_i.negate().sub(Pi),Ts=k(1).sub(me(0,Zn).mul(gl)),Mi=k(0).toVar(),Er=k(0).toVar(),Bo=k(0).toVar();ma(h3,({i:Cr})=>{const Dr=ao.add(Ys.mul(k(Cr).add(.5))),uo=Yn.add(U.mul(Dr)),vi=Ao(uo.sub(B)),vn=vi.sub(P),zi=me(0,vn),Ks=le(vn,0),ar=le(J.sub(vi),0),Vs=ln(0,ft,ar),Wc=En(Ks.negate().div(g)),xl=En(Ks.negate().div(y)).mul(x);Mi.addAssign(Wc.add(xl).mul(Ys).mul(zi).mul(Vs)),Er.addAssign(En(Ks.negate().div(S)).mul(Ys).mul(zi).mul(Vs)),Bo.addAssign(le(k(1).sub(oi(Ks.sub(T)).div(M)),0).mul(Ys).mul(zi).mul(Vs))});const Hc=u.mul(pt).add(f.mul(Rt)).add(p.mul(Ft)),yl=u.mul(Mi).add(f.mul(Er)).add(p.mul(Bo)),co=En(Hc.add(yl).negate()).mul(Ts),Sa=u.mul(Bn.mul(nt)).add(d.mul(Ee.mul(dt)));Gt.addAssign(Sa.mul(co).mul(at))});const ae=u.mul(pt).add(f.mul(Rt)).add(p.mul(Ft)),Kt=En(ae.negate()),jt=Dt(1,1,1).sub(Kt).mul(u.mul(.018).add(d.mul(.0035))).mul(v.mul(.38)),ce=Gt.mul(v).add(jt).mul(ut),ee=ce.div(ce.mul(.22).add(Dt(1,1,1))),Re=xe(Kt,Dt(.2126,.7152,.0722)).clamp(0,1),je=T_.select(i,a),pn=zn(k(1).sub(Re),1.15).mul(ut).mul(s).mul(je).clamp(0,1);return zu(ee,pn)}),R=new Bc;return R.outputNode=A(),R.transparent=!0,R.premultipliedAlpha=!1,R.depthWrite=!1,R.depthTest=!0,R.side=ss,R.blending=mi,R}function tK(){const r=new Xs,t=F=>F.mul(.5).add(.5),e=ji.normalize(),n=t(Yf(e.mul(1.8),4,2,.5)),s=t(Yf(e.mul(5.5),5,2.1,.48)),i=t(Yf(e.mul(14),4,2,.45)),a=t(Yf(e.mul(22),3,2.3,.5)),c=t(Yf(e.mul(40),2,2,.5)),u=oi(e.y),d=ln(.35,.75,u),f=wr(ln(.38,.62,n).add(d.mul(.5)),k(0),k(1)),p=oi(a.sub(.5)).mul(2),g=oi(c.sub(.5)).mul(2),y=ln(0,.12,p),x=ln(0,.06,g),S=f.mul(d.oneMinus().add(.3).clamp(0,1)),T=Zt(k(1),y,S.mul(.9)).mul(Zt(k(1),x,S.mul(.6))),M=Dt(.01,.06,.14),N=Dt(.08,.21,.42),v=Dt(.48,.76,.92),A=Dt(.88,.95,1),R=Dt(.96,.985,1),L=Dt(.82,.9,.97),D=Dt(.9,.96,1);let U=M.toVar();U=Zt(U,Zt(N,v,s),f);const B=ln(.52,.78,i).mul(f);U=Zt(U,A,B),U=Zt(U,R,d.mul(.85));const P=Zt(L,D,ln(0,.08,p));U=Zt(P,U,T);const J=Zt(k(.85),k(.08),f),q=T.oneMinus().mul(.55),ft=B.mul(.35),Mt=wr(J.add(q).add(ft),k(.04),k(.95)),mt=Zt(k(0),k(.05),f.mul(T));return r.colorNode=U,r.roughnessNode=Mt,r.metalnessNode=mt,r}function eK(){const r=new vt;r.name="scene10-manns-planet-system";const t=tK(),e=new C(new We(l3,168,112),t);e.name="scene10-manns-planet",e.receiveShadow=!0,r.add(e);const n=QY({atmosphereDensity:.92,atmosphereHeightKm:gL,kind:"rocky"},v_),s=he(1),i=he(1),a=he(0),c=he(new V(0,0,0)),u=JY(he(yL.clone()),c,he(l3),he(c3),s,i,a,n),d=new C(new We(c3,128,88),u);return d.name="scene10-manns-planet-atmosphere",d.renderOrder=10,r.add(d),r.rotation.x=St.degToRad(23.5),r.rotation.z=St.degToRad(-9.5),{atmosphere:d,atmosphereCenterWorld:c,group:r,planet:e}}const nK={id:"endurance-spin-docking",title:"Endurance Spin-Docking Maneuver",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=0,g=0,y=0,x=null;const S={ready:!1,time:0,enduranceSpinAngle:0,rangerSpinAngle:0,currentEnduranceSpinRate:v2,baseEndurancePosition:new V,baseEnduranceQuaternion:new Ps,rangerInitialPosition:new V,approachStarted:!1,dockPortWorld:new V,dockAxisWorld:new V,rangerStartParallel:0,rangerStartRadial:0,rangerStartRadialDir:new V(1,0,0),rangerVelocity:new V,rangerTargetPosition:new V};function T(B){B.position.set(6878.606,4914.173,6141.678),B.lookAt(6301.714,4779.175,5336.091)}function M(){n&&(n.group.getWorldPosition(bu),n.atmosphereCenterWorld.value.copy(bu))}function N(){s&&(S.dockAxisWorld.copy(Ng).applyQuaternion(s.quaternion).normalize(),S.dockPortWorld.copy(xY).applyQuaternion(s.quaternion),S.dockPortWorld.add(s.position))}function v(){!s||!i||(Ya.copy(aY).sub(d3).normalize(),Su.crossVectors(Ya,R2).normalize(),wu.crossVectors(Su,Ya).normalize(),Tu.copy(d3).addScaledVector(Ya,oY),s.position.copy(Tu),s.position.addScaledVector(Su,lY),s.position.addScaledVector(wu,cY),s.rotation.set(-.5,-.3,.84),i.position.copy(Tu),i.position.addScaledVector(Su,uY),i.position.addScaledVector(wu,hY),i.position.addScaledVector(Ya,dY),i.scale.setScalar(1.35))}function A(){!s||!i||(S.time=0,S.enduranceSpinAngle=0,S.rangerSpinAngle=0,S.currentEnduranceSpinRate=v2,S.approachStarted=!1,S.baseEndurancePosition.copy(s.position),S.baseEnduranceQuaternion.copy(s.quaternion),S.rangerInitialPosition.copy(i.position),S.rangerVelocity.set(0,0,0),N(),Eg.setFromUnitVectors(R2,Tu.copy(S.dockAxisWorld).negate()),i.quaternion.copy(Eg),S.rangerTargetPosition.copy(i.position),S.ready=!0)}function R(B,P){const J=bY+St.randFloatSpread(vY),q=St.randFloat(wY,TY),ft=St.randFloat(_Y,MY);B.localAnchor.set(Math.cos(J)*q,Math.sin(J)*q,ft),B.localOutward.set(Math.cos(J),Math.sin(J),St.randFloatSpread(.14)).normalize(),B.localTangent.crossVectors(Ng,B.localOutward),B.localTangent.lengthSq()<1e-6?B.localTangent.set(1,0,0):B.localTangent.normalize(),B.localBaseQuaternion.setFromEuler(new tr(St.randFloatSpread(1.15),St.randFloatSpread(1.15),St.randFloatSpread(1.15))),B.peelStartTime=P+St.randFloat(AY,NY),B.detachTime=B.peelStartTime+St.randFloat(RY,EY),B.maxPeelDistance=St.randFloat(CY,DY),B.peelTwist=St.randFloatSpread(1.25),B.outwardSpeed=St.randFloat(BY,LY),B.axialSpeed=St.randFloatSpread(OY),B.spinCarry=St.randFloat(.28,.82),B.rollRate=St.randFloatSpread(2.3),B.tumbleRate=St.randFloatSpread(1.7),B.lifetime=St.randFloat(FY,UY),B.released=!1,B.releasedAge=0,B.velocity.set(0,0,0),B.angularVelocity.set(0,0,0)}function L(){if(a)for(const B of a.pieces){const P=-St.randFloat(0,4.5);R(B,P)}}function D(B){if(!(!S.ready||!s||!a)){Rg.copy(Ng).applyQuaternion(s.quaternion).normalize(),m3.copy(Rg).multiplyScalar(S.currentEnduranceSpinRate);for(const P of a.pieces)if(P.released){P.releasedAge+=B,P.mesh.position.addScaledVector(P.velocity,B);const J=P.angularVelocity.length();if(J>1e-6&&(Ya.copy(P.angularVelocity).multiplyScalar(1/J),Cg.setFromAxisAngle(Ya,J*B),P.mesh.quaternion.premultiply(Cg).normalize()),P.releasedAge>=P.lifetime){const q=St.randFloat(PY,zY);R(P,S.time+q)}}else{const J=Qf(P.peelStartTime,P.detachTime,S.time),q=P.maxPeelDistance*J*J;g3.copy(P.localAnchor).addScaledVector(P.localOutward,q),N2.copy(g3).applyQuaternion(s.quaternion),P.mesh.position.copy(s.position).add(N2),Cg.copy(s.quaternion).multiply(P.localBaseQuaternion),b3.setFromAxisAngle(P.localTangent,P.peelTwist*J),P.mesh.quaternion.copy(Cg).multiply(b3),S.time>=P.detachTime&&(P.released=!0,P.releasedAge=0,wu.copy(N2),Tu.crossVectors(m3,wu),xd.copy(P.localOutward).applyQuaternion(s.quaternion).normalize(),P.velocity.copy(Tu),P.velocity.addScaledVector(xd,P.outwardSpeed),P.velocity.addScaledVector(Rg,P.axialSpeed),P.velocity.length()>p3&&P.velocity.setLength(p3),P.angularVelocity.copy(Rg).multiplyScalar(S.currentEnduranceSpinRate*P.spinCarry),P.angularVelocity.addScaledVector(xd,P.rollRate),P.velocity.lengthSq()>1e-6&&(bu.copy(P.velocity).normalize(),P.angularVelocity.addScaledVector(bu,P.tumbleRate)))}}}function U(B){if(!S.ready||!s||!i)return;S.time+=B;const P=A2+pY,J=P+mY,q=J+gY,ft=Qf(0,fY,S.time),Mt=Qf(A2,P,S.time),mt=Qf(P,J,S.time),F=Qf(J,q,S.time);S.currentEnduranceSpinRate=St.lerp(v2,0,F),S.enduranceSpinAngle+=S.currentEnduranceSpinRate*B,y3.setFromAxisAngle(Ng,S.enduranceSpinAngle),s.quaternion.copy(S.baseEnduranceQuaternion).multiply(y3),s.position.copy(S.baseEndurancePosition),N();const Y=St.lerp(0,S.currentEnduranceSpinRate,ft);S.rangerSpinAngle+=Y*B,!S.approachStarted&&S.time>=A2&&(S.approachStarted=!0,bu.copy(i.position).sub(S.dockPortWorld),S.rangerStartParallel=bu.dot(S.dockAxisWorld),Ya.copy(S.dockAxisWorld).multiplyScalar(S.rangerStartParallel),Su.copy(bu).sub(Ya),S.rangerStartRadial=Su.length(),S.rangerStartRadial>1e-4?S.rangerStartRadialDir.copy(Su).normalize():S.rangerStartRadialDir.set(1,0,0));const tt=S.approachStarted?Mt:0,lt=S.approachStarted?mt:0;if(!S.approachStarted)S.rangerTargetPosition.copy(S.rangerInitialPosition);else{wu.copy(S.rangerStartRadialDir);const Tt=St.lerp(S.rangerStartParallel,f3,tt),O=St.lerp(Tt,f3,lt),et=St.lerp(S.rangerStartRadial,yY,tt);let z=St.lerp(et,0,lt);z=St.lerp(z,0,F),S.rangerTargetPosition.copy(S.dockPortWorld),S.rangerTargetPosition.addScaledVector(S.dockAxisWorld,O),S.rangerTargetPosition.addScaledVector(wu,z)}if(!S.approachStarted)i.position.copy(S.rangerInitialPosition),S.rangerVelocity.set(0,0,0);else{const Tt=St.lerp(5,9.8,lt),O=St.lerp(4.6,7.4,lt);VY(i.position,S.rangerVelocity,S.rangerTargetPosition,B,Tt,O)}Eg.setFromUnitVectors(R2,Tu.copy(S.dockAxisWorld).negate()),x3.setFromAxisAngle(S.dockAxisWorld,S.rangerSpinAngle),i.quaternion.copy(x3).multiply(Eg),lt>.995&&i.position.lerp(S.rangerTargetPosition,St.clamp(B*6,0,1)),F>.995&&(i.position.copy(S.rangerTargetPosition),S.rangerVelocity.set(0,0,0))}return{init({camera:B,renderer:P,root:J,scene:q}){r=J,t=new vt,t.name="scene10-group",J.add(t),p=B.near,g=B.far,y=B.fov,B.near=iY,B.far=xL,B.fov=sY,B.updateProjectionMatrix(),q.background&&q.background.isColor?x=q.background.clone():x=null,q.background=eY.clone(),u=new Co(1712432,.2),c=new wi(16773854,2.6),c.position.copy(yL).multiplyScalar(2e5),t.add(u,c,c.target),n=eK(),t.add(n.group),M(),e=kY(),t.add(e),T(B),f=B.position.clone(),d=ft=>{IY.has(ft.code)&&document.pointerLockElement===P?.domElement&&(ft.preventDefault(),ft.stopPropagation(),typeof ft.stopImmediatePropagation=="function"&&ft.stopImmediatePropagation())},window.addEventListener("keydown",d,!0),window.addEventListener("keyup",d,!0),s=WY(),i=KY(),a=qY(s.userData?.hullMaterial),t.add(s,i,a.group),v(),A(),L(),D(0)},update({camera:B,delta:P}){!n||!e||!s||!i||(f&&B.position.copy(f),M(),U(P),D(P),e.position.copy(B.position))},resize(){},dispose({camera:B,scene:P}){d&&(window.removeEventListener("keydown",d,!0),window.removeEventListener("keyup",d,!0),d=null),B.near=p,B.far=g,B.fov=y,B.updateProjectionMatrix(),P.background=x?x.clone():null,t&&(r&&t.parent!==r&&r.add(t),Fi(t),t=null,e=null,n=null,s=null,i=null,a=null,S.ready=!1,c=null,u=null,f=null,r=null)}}}},S3="gargantua-slingshot",sK="Slingshot Around Gargantua",iK=30,Dg=new V(0,1.2,-72),rK=new V(0,4,40),oK="/textures/noise_deep.png",aK=132106,lK=.02,w3=new V(-7.5,3,-43),cK=16769965,uK=2.4,Bg=1,hK=.2,dK=new Set(["KeyW","KeyA","KeyS","KeyD","Space","ShiftLeft","ShiftRight"]),fK=_n(([r,t])=>{const e=k(t).toVar(),n=Dt(r).toVar(),s=k($i(e)).toVar(),i=k(Yo(e)).toVar(),a=k(el(1,i)).toVar();return Uq(a.mul(n.x).mul(n.x).add(i),a.mul(n.x).mul(n.y).sub(n.z.mul(s)),a.mul(n.z).mul(n.x).add(n.y.mul(s)),a.mul(n.x).mul(n.y).add(n.z.mul(s)),a.mul(n.y).mul(n.y).add(i),a.mul(n.y).mul(n.z).sub(n.x.mul(s)),a.mul(n.z).mul(n.x).sub(n.y.mul(s)),a.mul(n.y).mul(n.z).add(n.x.mul(s)),a.mul(n.z).mul(n.z).add(i))}).setLayout({name:"rotateAxis",type:"mat3",inputs:[{name:"axis",type:"vec3"},{name:"angle",type:"float"}]}),pK=_n(([r])=>Zt(r.div(12.92),zn(Xo(r,.055).div(1.055),Dt(2.4)),me(.04045,r))),mK=_n(([r])=>{const t=r.mul(12.92),e=zn(r,Dt(1/2.4)).mul(1.055).sub(.055);return Zt(t,e,me(.0031308,r))}),T3=_n(([r])=>r.r.mul(.2126).add(r.g.mul(.7152)).add(r.b.mul(.0722)).toVar()),_3=_n(([r,t,e,n,s])=>Ko(.5,Ko(2,n).add(s.negate().add(e).mul(r)).add(Ko(2,s).sub(Ko(5,n)).add(Ko(4,e)).sub(t).mul(r).mul(r)).add(s.negate().add(Ko(3,n)).sub(Ko(3,e)).add(t).mul(r).mul(r).mul(r))),{T:"float",D:"vec3",C:"vec3",B:"vec3",A:"vec3",return:"vec3"}),gK=_n(([r,t,e,n])=>{const s=e.w.sub(t.w),i=n.w.sub(e.w),a=r.sub(t.w).div(s).saturate(),c=r.sub(e.w).div(i).saturate(),u=Dt(el(1,a),a.sub(c),c),d=_3(u.x,t.xyz,t.xyz,e.xyz,n.xyz),f=_3(u.y,t.xyz,e.xyz,n.xyz,n.xyz),p=n.xyz;return Lu(r.lessThan(e.w),()=>d.xyz),Lu(r.lessThan(n.w),()=>f.xyz),p.xyz},{T:"float",A:"vec4",B:"vec4",C:"vec4",return:"vec3"}),yK=r=>si($i(xe(r,dn(12.9898,78.233))).mul(43758.5453)),Jf=_n(([r])=>r.x.mul(r.x).add(r.y.mul(r.y)).add(r.z.mul(r.z)).sqrt()),M3=_n(([r,t,e,n,s])=>{const i=wr(r.sub(t).div(e.sub(t)),0,1),a=i.mul(i).mul(k(3).sub(i.mul(2)));return Zt(n,s,a)},{value:"float",inMin:"float",inMax:"float",outMin:"float",outMax:"float",return:"float"});function xK({noiseTexture:r,starsTexture:t,scale:e=5}){const n=new vt,s=new We(1,16,16),i=new Xs({side:ss}),a={iterations:he(k(128)),stepSize:he(k(.0071)),noiseFactor:he(k(.01)),power:he(k(.3)),clamp1:he(k(.5)),clamp2:he(k(1)),originRadius:he(k(.13)),width:he(k(.03)),uvMotion:he(k(0)),rampCol1:he(Ke(1,.99,.95)),rampPos1:he(k(.06)),rampCol2:he(Ke(1,.82,.34)),rampPos2:he(k(.33)),rampCol3:he(Ke(.42,.16,.02)),rampPos3:he(k(1)),rampEmission:he(k(1.95)),emissionColor:he(Ke(1,.72,.26))};i.colorNode=_n(()=>{const u=a.stepSize,d=a.noiseFactor,f=a.power,p=a.originRadius,g=a.width,y=a.iterations,x=Vq.mul(Dt(1,1,-1)).xzy,S=me(0,Fq.negate()),T=ir.mul(zq).mul(Dt(1,1,-1)).xzy,M=Zt(x,T.xyz,S),v=Cn(el(ir,kc)).mul(Dt(1,1,-1)).xzy.negate().toVar(),A=yK(x.xy).mul(d),R=v.mul(A),L=M.sub(R).toVar(),D=Dt(0).toVar(),U=k(0).toVar();ma(y,()=>{const ft=Cn(L),Mt=Jf(L),mt=u.mul(f).div(Mt.mul(Mt)),F=vE(Mt,1,.5,0,1),Y=ft.mul(mt.mul(F)),tt=v.sub(Y).normalize(),lt=v.mul(u);L.addAssign(lt);const Tt=Jf(L.mul(Dt(1,1,0))),O=Tt.mul(4.27).sub(Rc.mul(.1)),et=Dt(0,0,1),W=L.mul(fK(et,O)).mul(2),yt=Np(r,W),K=g.negate(),Z=Dt(K,0,g),H=el(Z,Dt(L.z)),j=H.mul(H).div(g),ct=le(g.sub(j).div(g),0),xt=yt.mul(ct),at=Jf(xt),ut=W.mul(1.002),$=Np(r,ut).mul(ct),nt=Jf($),ht=Tt.add(at.sub(.78).mul(1.5)).add(at.sub(nt).mul(19.75)),dt=zu(a.rampCol1,a.rampPos1),pt=zu(a.rampCol2,a.rampPos2),Rt=zu(a.rampCol3,a.rampPos3),Ft=gK(ht.x,dt,pt,Rt),Gt=vE(nt,.35,1.2,.75,1.15),ae=Ft.mul(a.rampEmission.mul(Gt)).add(a.emissionColor),jt=Jf(L).lessThan(p),ce=Zt(ae,Dt(0),jt),ee=oi(L.z),Re=at.sub(.75).mul(-.6),je=ee.add(Re),pn=M3(Tt,1,0,0,1),os=M3(je,g,0,0,pn),jn=Zt(os,1,jt),we=U.oneMinus().mul(T3(jn)),Ye=Zt(D,ce,we),Dn=Zt(U,1,T3(jn));L.addAssign(lt),v.assign(tt),D.assign(Ye),U.assign(Dn)});const B=v.mul(Dt(1,-1,1)).xzy,P=mK(Np(t,Oq(B)).mul(k(1))),J=k(1).sub(U),q=Zt(D,P,J.mul(1));return pK(q)})(),i.emissiveNode=i.colorNode,i.needsUpdate=!0;const c=new C(s,i);return c.scale.setScalar(e),c.frustumCulled=!1,n.add(c),{group:n,material:i,uniforms:a}}async function bK(){const t=await new Hw().loadAsync(oK);return t.wrapS=Fn,t.wrapT=Fn,t.needsUpdate=!0,t}function SK(r){let t=r>>>0;return()=>{t+=1831565813;let e=t;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}function wK({starCount:r=5200,baseRadius:t=4200,seed:e=296379127}={}){const n=SK(e),s=new Float32Array(r*3),i=new Float32Array(r*3),a=new Float32Array(r*3),c=Math.PI*2;for(let u=0;u<r;u+=1){const d=u*3,f=n()*2-1,p=n()*c,g=Math.sqrt(Math.max(0,1-f*f)),y=g*Math.cos(p),x=g*Math.sin(p);a[d]=y,a[d+1]=f,a[d+2]=x,s[d]=y*t,s[d+1]=f*t,s[d+2]=x*t;const S=.14+n()*(.98-.14),T=Math.pow(n(),1.1),M=St.clamp(S*(.58+T*.72),.06,1),N=-.08+n()*.16;i[d]=St.clamp(M+N*.5,.04,1),i[d+1]=St.clamp(M+N*.15,.04,1),i[d+2]=St.clamp(M-N*.45,.04,1)}return{colors:i,directions:a,positions:s,starCount:r}}function TK(r,{width:t=2048,height:e=1024}={}){const n=document.createElement("canvas");n.width=t,n.height=e;const s=n.getContext("2d");if(!s)throw new Error("Failed to create 2D context for static starfield texture.");s.fillStyle="#02040a",s.fillRect(0,0,t,e);const i=Math.PI*2;for(let c=0;c<r.starCount;c+=1){const u=c*3,d=r.directions[u],f=r.directions[u+1],p=r.directions[u+2],g=Math.atan2(p,d)/i+.5,y=Math.acos(St.clamp(f,-1,1))/Math.PI,x=Math.floor(g*t)%t,S=Math.floor(y*e),T=Math.floor(St.clamp(r.colors[u],0,1)*255),M=Math.floor(St.clamp(r.colors[u+1],0,1)*255),N=Math.floor(St.clamp(r.colors[u+2],0,1)*255),v=(r.colors[u]+r.colors[u+1]+r.colors[u+2])/3,A=St.clamp(.35+v*.6,.3,.95);s.fillStyle=`rgba(${T}, ${M}, ${N}, ${A.toFixed(3)})`,s.fillRect(x,S,1,1)}const a=new Ti(n);return a.mapping=Jy,a.colorSpace=bn,a.flipY=!1,a.needsUpdate=!0,a}function _K(r,t){r.layers.set(t),r.traverse(e=>{e.layers.set(t)})}function sd(r,t,e){const n=new Xs;return n.colorNode=Ke(r),n.roughnessNode=k(t),n.metalnessNode=k(e),n}function tp(r){const t=Math.sin(r+1)*43758.5453;return t-Math.floor(t)}function MK({matDarkHull:r,matSolarPanel:t,matTornFace:e,matWhiteHull:n}){const s=new vt,i=new C(new X(8,7,5),n);i.position.set(0,0,-2.5),i.castShadow=!0,i.receiveShadow=!0,s.add(i);const a=new C(new X(7.5,6.5,1),t);a.position.set(0,0,-4.6),a.castShadow=!0,s.add(a);const c=new C(new X(8.2,2,2.5),r);c.position.set(0,0,-1.25),s.add(c);{const S=[],T=[],M=(A,R)=>A*15+R;for(let A=0;A<=16;A+=1)for(let R=0;R<=14;R+=1){const L=-4+A/16*8,D=-3.5+R/14*(3.5- -3.5);let U=.05;if(A>0&&A<16&&R>0&&R<14){const B=A*31+R*17,P=Math.sin(A*2.1+R*1.3)*1.1+Math.cos(A*4.7-R*2.9)*.7+(tp(B)-.5)*1.2;U=.05+Math.abs(P)}S.push(L,D,U)}for(let A=0;A<16;A+=1)for(let R=0;R<14;R+=1){const L=M(A,R),D=M(A+1,R),U=M(A+1,R+1),B=M(A,R+1);T.push(L,D,U,L,U,B)}const N=new Qe;N.setAttribute("position",new ge(S,3)),N.setIndex(T),N.computeVertexNormals();const v=new C(N,e);v.castShadow=!0,s.add(v)}const u=20;for(let d=0;d<u;d+=1){const p=d/(u-1)*Math.PI*2,g=Math.cos(p)*3.8,y=Math.sin(p)*3.3,x=tp(d*7),S=tp(d*7+1),T=tp(d*7+2),M=tp(d*7+3),N=.4+x*1.5,v=.3+S*1.2,A=.3+T*1,R=.1+M*1.5,L=new X(N,v,A),D=new C(L,n);D.position.set(g,y,R),D.rotation.x=(x-.5)*1.5,D.rotation.y=(S-.5)*1.5,D.rotation.z=p+(T-.5)*.5,D.castShadow=!0,s.add(D)}return s}function vK(){const r=sd(14540253,.4,.6),t=sd(3355443,.5,.7),e=sd(1118481,.15,.9),n=sd(328965,.05,.8),s=sd(2236962,.9,.3),i=sd(1710618,.85,.45),a=new vt,c=32,u=12,d=4,f=5;for(let B=0;B<u;B+=1){const P=B/u*Math.PI*2,J=Math.cos(P)*c,q=Math.sin(P)*c;if(B===d){const O=new vt,et=new C(new X(8,7,1.2),s);et.castShadow=!0,O.add(et),[{w:.8,h:3,d:.35,x:2.4,y:1.8,z:.55,rx:.2,rz:.3},{w:.5,h:1.8,d:.3,x:-2.1,y:-2.2,z:.55,rx:-.1,rz:-.2},{w:.9,h:1.4,d:.35,x:2.7,y:-1.3,z:.5,rx:.25,rz:.35},{w:.4,h:2.3,d:.28,x:-2.9,y:1,z:.5,rx:-.15,rz:-.28},{w:.7,h:.9,d:.4,x:.3,y:2.7,z:.45,rx:.1,rz:.18}].forEach(W=>{const yt=new C(new X(W.w,W.h,W.d),s);yt.position.set(W.x,W.y,W.z),yt.rotation.set(W.rx,0,W.rz),yt.castShadow=!0,O.add(yt)}),O.position.set(J,q,0),O.rotation.z=P+Math.PI/2,O.lookAt(0,0,0),a.add(O)}else if(B===f){const O=MK({matDarkHull:t,matSolarPanel:e,matTornFace:i,matWhiteHull:r});O.position.set(J,q,0),O.rotation.z=P+Math.PI/2,O.lookAt(0,0,0),O.rotateY(Math.PI),a.add(O)}else{const O=new vt,et=new C(new X(8,7,10),r);et.castShadow=!0,et.receiveShadow=!0,O.add(et);const z=new C(new X(7.5,6.5,1),e);z.position.set(0,0,-4.6),z.castShadow=!0,z.receiveShadow=!0,O.add(z);const W=new C(new X(8.2,2,4),t);W.position.set(0,0,1),O.add(W),O.position.set(J,q,0),O.rotation.z=P+Math.PI/2,O.lookAt(0,0,0),a.add(O)}const ft=P+Math.PI/u,Mt=Math.cos(ft)*c,mt=Math.sin(ft)*c,F=new vt;F.position.set(Mt,mt,0),F.rotation.z=ft;const Y=new C(new qt(2,2,9,32),r);Y.castShadow=!0,Y.receiveShadow=!0,F.add(Y);const tt=new C(new qt(2.8,2.8,2.5,32),r);F.add(tt);const lt=new C(new qt(1.2,1.2,3.5,32),n);lt.rotation.z=Math.PI/2,F.add(lt);const Tt=new C(new qt(1.5,1.5,3.2,32),t);Tt.rotation.z=Math.PI/2,F.add(Tt),a.add(F)}const p=c-5,g=new vt;g.position.set(0,p/2+2,0);const y=new C(new qt(2.5,2.5,p,32),r);y.castShadow=!0,y.receiveShadow=!0,g.add(y);for(let B=-1;B<=1;B+=1){const P=new C(new qt(3,3,2,32),t);P.position.y=B*(p/3),g.add(P)}a.add(g);const x=new C(new qt(4,4,3,32),r);x.rotation.x=Math.PI/2,x.castShadow=!0,x.receiveShadow=!0,a.add(x);const S=new C(new da(3,.5,16,64),t);S.position.z=1.5,a.add(S);const T=new vt;T.scale.set(2,2,2);const M=new gi(4.5,10,4);M.rotateY(Math.PI/4),M.rotateX(Math.PI/2),M.scale(1.1,.2,1),T.add(new C(M,r));const N=M.clone();N.scale(.98,.5,.98),N.translate(0,-.15,0),T.add(new C(N,t));const v=new C(new X(2.2,.8,3.5),r);v.position.set(0,.4,0),v.rotation.x=Math.PI/16,v.castShadow=!0,T.add(v);const A=new C(new X(1.8,.6,1.5),n);A.position.set(0,.7,1.2),A.rotation.x=Math.PI/6,T.add(A);const R=new X(3.5,.2,4),L=new C(R,r);L.position.set(-2.8,0,-2.5),L.rotation.y=Math.PI/8,L.castShadow=!0,T.add(L);const D=new C(R,r);D.position.set(2.8,0,-2.5),D.rotation.y=-Math.PI/8,D.castShadow=!0,T.add(D);const U=new C(new X(3,1,1.5),t);return U.position.set(0,-.1,-4.8),T.add(U),T.position.set(0,-5,3),T.rotateX(-300),a.add(T),a.rotation.x=-.5,a.rotation.y=-.3,a}const AK={id:S3,title:sK,create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,g=null,y=!1;return{async init({root:x,scene:S,camera:T,renderer:M}){if(y=!1,a=x,d=T??null,r=new vt,r.name=`${S3}-group`,x.add(r),T&&(f=T.layers.mask,T.layers.enable(Bg),T.position.copy(Dg).add(rK),T.lookAt(Dg),g=T.position.clone()),c=S.background,u=S.environment,s=wK(),n=TK(s),S.background=n,S.environment=n,e=await bK(),y){e&&(e.dispose(),e=null);return}t=xK({noiseTexture:e,starsTexture:n,scale:iK}),t.group.position.copy(Dg),t.group.rotation.z=St.degToRad(6),r.add(t.group),i=vK(),i.scale.setScalar(lK),i.position.copy(w3),_K(i,Bg),r.add(i);const N=new On;N.position.copy(w3),N.layers.set(Bg);const v=new wi(cK,uK);v.position.copy(Dg),v.layers.set(Bg),v.target=N,r.add(v,N),p=A=>{dK.has(A.code)&&document.pointerLockElement===M?.domElement&&(A.preventDefault(),A.stopPropagation(),typeof A.stopImmediatePropagation=="function"&&A.stopImmediatePropagation())},window.addEventListener("keydown",p,!0),window.addEventListener("keyup",p,!0)},update({delta:x,camera:S}){i&&(g&&S&&S.position.copy(g),i.rotation.z+=x*hK)},resize(){},dispose({scene:x}){y=!0,p&&(window.removeEventListener("keydown",p,!0),window.removeEventListener("keyup",p,!0),p=null),x&&(x.background=c??new Xt(aK),x.environment=u??null),d&&f!==null&&(d.layers.mask=f),r&&(a&&r.parent!==a&&a.add(r),Fi(r)),e&&(e.dispose(),e=null),n&&(n.dispose(),n=null),t=null,i=null,s=null,r=null,a=null,c=null,u=null,d=null,f=null,g=null}}}},kn=5.5,Nn=7,Es=60,E2=2.1,NK=new Set(["KeyW","KeyA","KeyS","KeyD","Space","ShiftLeft","ShiftRight"]),Lg=Math.PI/2-.05,v3=.001,A3=20,N3=34,R3=22,bo=2,Ka=1,$o=0,RK=A3*A3,EK=N3*N3,CK=R3*R3,ep=new V,Za=new V,Og=new V,Fg=new ga;function Ug(r){const t=document.createElement("canvas"),e=1024,n=256;t.width=e,t.height=n;const s=t.getContext("2d");if(!s)return new is;s.fillStyle="#050302",s.fillRect(0,0,e,n);let i=r||1;const a=()=>(i=(i*16807+11)%2147483647,(i&2147483647)/2147483647);let c=0;for(;c<e;){const d=.5+a()*3,f=.5+a()*2.5,p=a();let g=0,y=0,x=0;p>.93?(g=55+Math.floor(a()*55),y=32+Math.floor(a()*22),x=12+Math.floor(a()*12)):p>.6?(g=16+Math.floor(a()*22),y=10+Math.floor(a()*14),x=4+Math.floor(a()*8)):(g=2+Math.floor(a()*7),y=1+Math.floor(a()*5),x=Math.floor(a()*3)),s.fillStyle=`rgb(${g},${y},${x})`,s.fillRect(Math.floor(c),0,Math.ceil(f),n),c+=f+d}const u=new Ti(t);return u.wrapS=Fn,u.wrapT=Fn,u.repeat.set(3,1),u}function E3(r){const t=document.createElement("canvas"),e=256,n=512;t.width=e,t.height=n;const s=t.getContext("2d");if(!s)return new is;s.fillStyle="#040302",s.fillRect(0,0,e,n);let i=r||77;const a=()=>(i=(i*16807+11)%2147483647,(i&2147483647)/2147483647);let c=0;for(;c<n;){const d=.5+a()*3,f=.5+a()*2,p=a();let g=0,y=0,x=0;p>.88?(g=40+Math.floor(a()*35),y=24+Math.floor(a()*16),x=8+Math.floor(a()*10)):p>.5?(g=10+Math.floor(a()*16),y=7+Math.floor(a()*10),x=3+Math.floor(a()*6)):(g=2+Math.floor(a()*5),y=1+Math.floor(a()*3),x=Math.floor(a()*2)),s.fillStyle=`rgb(${g},${y},${x})`,s.fillRect(0,Math.floor(c),e,Math.ceil(f)),c+=f+d}const u=new Ti(t);return u.wrapS=Fn,u.wrapT=Fn,u.repeat.set(1,2),u}function _u(r){return new bt({color:r||1118481,metalness:.85,roughness:.4})}function DK(){const r=new vt,t=new bt({color:12369084,roughness:.5,metalness:.15}),e=new bt({color:8947848,roughness:.5,metalness:.2}),n=new bt({color:4473924,roughness:.6,metalness:.3}),s=new bt({color:1719644,roughness:.05,metalness:.9}),i=new bt({color:13404245,roughness:.9}),a=new bt({color:2763306,roughness:.7,metalness:.3}),c=new bt({color:3815994,roughness:.6,metalness:.4});function u(x,S,T,M,N,v,A,R,L,D){const U=new C(new X(x,S,T),M);return U.position.set(N||0,v||0,A||0),U}const d=new vt;d.add(u(.52,.52,.52,t)),d.add(u(.42,.32,.06,s,0,.02,.28)),d.add(u(.38,.28,.04,i,0,.02,.24)),d.add(u(.54,.06,.06,e,0,.22,0)),d.add(u(.54,.06,.06,e,0,-.1,0)),d.position.set(0,1.82,0),r.add(d),r.add(u(.28,.1,.28,n,0,1.48,0)),r.add(u(.52,.8,.32,t,0,1.1,0)),r.add(u(.28,.22,.03,n,0,1.22,.18));for(let x=0;x<3;x+=1)r.add(u(.04,.04,.025,e,-.08+x*.08,1.28,.195));r.add(u(.54,.05,.34,n,0,1.4,0)),r.add(u(.54,.06,.34,n,0,.72,0)),r.add(u(.44,.65,.22,c,0,1.1,-.27)),r.add(u(.18,.45,.05,n,.06,1.15,-.4)),r.add(u(.06,.06,.06,n,.06,1.35,-.42));const f=new vt;f.add(u(.22,.68,.22,t)),f.add(u(.2,.18,.22,a,0,-.43,0)),f.position.set(-.42,1.18,0),f.rotation.z=.55,f.rotation.x=-.9,r.add(f);const p=new vt;p.add(u(.22,.68,.22,t)),p.add(u(.2,.18,.22,a,0,-.43,0)),p.position.set(.42,1.22,0),p.rotation.z=-.3,p.rotation.x=-.7,r.add(p);const g=new vt;g.add(u(.22,.72,.22,t)),g.add(u(.24,.18,.3,a,0,-.45,.03)),g.position.set(-.14,.34,0),g.rotation.x=.18,r.add(g);const y=new vt;return y.add(u(.22,.72,.22,t)),y.add(u(.24,.18,.3,a,0,-.45,.03)),y.position.set(.14,.34,0),y.rotation.x=-.12,r.add(y),r.scale.setScalar(1.3),r}const BK={id:"tesseract-bookshelf",title:"Tesseract Bookshelf Sequence",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,g=null;const y={pitch:0,radius:0,yaw:0};return{init({root:x,camera:S,renderer:T,scene:M}){i=M.background,a=M.fog,c=T.toneMappingExposure,M.background=new Xt(0),M.fog=new Hu(0,.018),T.toneMappingExposure=.55,u=S.fov,d=S.near,f=S.far,S.fov=58,S.near=.05,S.far=300,S.position.set(0,5.5,6),S.lookAt(.5,3.5,0),S.updateProjectionMatrix(),r=new vt,r.name="scene-12-tesseract",x.add(r);const N=[Ug(1),Ug(42),Ug(137),Ug(999)],v=[E3(7),E3(53)],A=N.map(H=>new bt({map:H,emissiveMap:H,emissive:new Xt(.7,.4,.18),roughness:.95,metalness:0})),R=N.map(H=>{const j=H.clone();return j.rotation=Math.PI/2,j.center.set(.5,.5),new bt({map:j,emissiveMap:j,emissive:new Xt(.7,.4,.18),roughness:.95,metalness:0})}),L=v.map(H=>new bt({map:H,emissiveMap:H,emissive:new Xt(.55,.3,.12),roughness:.9,metalness:.05})),D=new bt({color:3346944,emissive:new Xt(.25,.09,.01),roughness:.9}),U=new xn({color:new Xt(.35,.85,1.2)}),B=new xn({color:new Xt(1.2,.45,.05)}),P=new xn({color:new Xt(.6,.25,.02)}),J=S.position.clone(),q=(H,j,ct)=>{Og.set(H,j,ct);const xt=J.distanceToSquared(Og);return xt>EK?$o:xt>RK?Ka:bo},ft=_u(592137),Mt=_u(460551);let mt=0;const F=(H,j,ct,xt="high")=>{const at=new vt,ut=xt==="low",$=.35,nt=ct?R:A,ht=nt[mt%nt.length],dt=L[mt%L.length];mt+=1;const pt=new C(new X(H,j,.04),ht);if(pt.position.z=$*.5,at.add(pt),!ut){const Kt=new C(new X(H*.96,j*.96,.005),D);Kt.position.z=$*.5-.025,at.add(Kt)}const Rt=ut?Math.max(2,Math.round(j/1.35)):Math.max(3,Math.round(j/.45));for(let Kt=0;Kt<=Rt;Kt+=1){const jt=-j/2+j/Rt*Kt,ce=new C(new X(H,ut?.024:.028,$),dt);ce.position.set(0,jt,0),at.add(ce)}const Ft=ut?Math.max(1,Math.round(H/2.25)):Math.max(2,Math.round(H/.75));for(let Kt=0;Kt<=Ft;Kt+=1){const jt=-H/2+H/Ft*Kt,ce=new C(new X(ut?.016:.02,j,$),ft);ce.position.set(jt,0,0),at.add(ce)}if(!ut){const Kt=new C(new X($,j,.025),dt);Kt.position.set(-H/2,0,0),at.add(Kt);const jt=new C(new X($,j,.025),dt);jt.position.set(H/2,0,0),at.add(jt)}const Gt=ut?.045:.055,ae=ut?[[0,j/2+Gt/2,0,H+Gt*1.6,Gt,$+.02],[0,-j/2-Gt/2,0,H+Gt*1.6,Gt,$+.02]]:[[0,j/2+Gt/2,0,H+Gt*2,Gt,$+.04],[0,-j/2-Gt/2,0,H+Gt*2,Gt,$+.04],[-H/2-Gt/2,0,0,Gt,j,$+.04],[H/2+Gt/2,0,0,Gt,j,$+.04]];for(const[Kt,jt,ce,ee,Re,je]of ae){const pn=new C(new X(ee,Re,je),Mt);pn.position.set(Kt,jt,ce),at.add(pn)}return at},Y=new vt;r.add(Y),t=new vt,t.name="scene-12-tesseract-static",Y.add(t);const tt=({width:H,height:j,rotated:ct,x:xt,y:at,z:ut,rotationX:$,rotationY:nt})=>{const ht=q(xt,at,ut);if(ht===$o)return;const dt=F(H,j,ct,ht===bo?"high":"low");dt.position.set(xt,at,ut),typeof $=="number"&&(dt.rotation.x=$),typeof nt=="number"&&(dt.rotation.y=nt),t.add(dt)};for(let H=-Es;H<=Es;H+=E2){const ct=E2*.95,xt=[[-kn,1.5,Math.PI/2],[kn,1.5,-Math.PI/2]];for(const[ut,$,nt]of xt)tt({width:ct,height:3.4,rotated:!0,x:ut,y:$,z:H,rotationY:nt});const at=[[0,Nn,Math.PI/2],[0,-Nn+2,-Math.PI/2]];for(const[ut,$,nt]of at)tt({width:ct,height:3.4*.85,rotated:!1,x:ut,y:$,z:H,rotationX:nt})}for(let H=1;H<=4;H+=1){const j=H*2.8,ct=E2*(1+H*.08);for(let xt=-Es;xt<=Es;xt+=ct){const at=3.8+H*.3,ut=ct*.93,$=[[-kn-j,1.5,Math.PI/2],[kn+j,1.5,-Math.PI/2]];for(const[ht,dt,pt]of $)tt({width:ut,height:at,rotated:!0,x:ht,y:dt,z:xt,rotationY:pt});const nt=[[0,Nn+j,Math.PI/2],[0,-Nn+2-j,-Math.PI/2]];for(const[ht,dt,pt]of nt)tt({width:ut,height:at*.8,rotated:!1,x:ht,y:dt,z:xt,rotationX:pt})}}const lt=()=>{const H=new vt,j=_u(394756);for(let ct=0;ct<4;ct+=1){const xt=ct*2.8,ut=(ct+1)*2.8-xt;let $=0;for(let nt=-Es;nt<=Es;nt+=1.6,$+=1){let ht=0;for(let dt=-1.5;dt<=1.8;dt+=.7,ht+=1){const pt=1.5+dt,Rt=q(0,pt,nt);if(Rt===$o||Rt===Ka&&($+ht+ct)%2===1)continue;const Ft=Rt===bo?.025:.018,Gt=new C(new X(ut,Ft,Ft),j);Gt.position.set(-kn-xt-ut/2,pt,nt),H.add(Gt);const ae=new C(new X(ut,Ft,Ft),j);ae.position.set(kn+xt+ut/2,pt,nt),H.add(ae)}}$=0;for(let nt=-Es;nt<=Es;nt+=2,$+=1){let ht=0;for(let dt=-2;dt<=2;dt+=.8,ht+=1){const pt=q(dt,Nn+xt,nt);if(pt===$o||pt===Ka&&($+ht+ct)%2===1)continue;const Rt=pt===bo?.025:.018,Ft=new C(new X(Rt,ut,Rt),j);Ft.position.set(dt,Nn+xt+ut/2,nt),H.add(Ft);const Gt=new C(new X(Rt,ut,Rt),j);Gt.position.set(dt,-Nn+2-xt-ut/2,nt),H.add(Gt)}}}return H};t.add(lt());const Tt=()=>{const H=new vt,j=_u(394758),ct=_u(526344),xt=_u(460551),at=_u(657930);let ut=0;for(let nt=-Es;nt<=Es;nt+=4.5,ut+=1)for(const ht of[-kn-.2,kn+.2]){const dt=q(ht,1.5,nt);if(dt===$o||dt===Ka&&ut%2===1)continue;const pt=new vt;if(pt.add(new C(new X(.05,Nn*2+4,dt===bo?.15:.12),j)),dt===bo)for(const Rt of[-Nn-1.5,Nn+1.5]){const Ft=new C(new X(.22,.05,.22),j);Ft.position.y=Rt,pt.add(Ft)}pt.position.set(ht,1.5,nt),H.add(pt)}ut=0;for(let nt=-Es;nt<=Es;nt+=5.5,ut+=1){let ht=0;for(let dt=-Nn+2;dt<=Nn;dt+=3.2,ht+=1){const pt=q(0,dt,nt);if(pt===$o||pt===Ka&&(ut+ht)%2===1)continue;const Rt=pt===bo?.045:.03,Ft=new C(new X(kn*2+1,Rt,Rt),ct);Ft.position.set(0,dt,nt),H.add(Ft)}}const $=[[-kn,Nn],[kn,Nn],[-kn,-Nn+2],[kn,-Nn+2]];for(const[nt,ht]of $){const dt=new C(new X(.06,.06,Es*2),xt);dt.position.set(nt,ht,0),H.add(dt)}ut=0;for(let nt=-Es;nt<=Es;nt+=4,ut+=1){const ht=q(kn+4.5,2,nt);if(ht===$o||ht===Ka&&ut%2===1)continue;const dt=new vt,pt=3.5,Rt=5,Ft=[[0,Rt/2,pt,.06],[0,-Rt/2,pt,.06],[-pt/2,0,.06,Rt],[pt/2,0,.06,Rt]];for(const[Gt,ae,Kt,jt]of Ft){const ce=new C(new X(Kt,jt,.06),at);ce.position.set(Gt,ae,0),dt.add(ce)}if(ht===bo){const Gt=new C(new X(.04,Math.sqrt(pt*pt+Rt*Rt),.04),at);Gt.rotation.z=Math.atan2(Rt,pt),dt.add(Gt)}dt.position.set(kn+4.5,2,nt),dt.rotation.y=-Math.PI/2,H.add(dt)}return H};t.add(Tt());const O=()=>{const H=new vt,j=[new xn({color:new Xt(.62,.2,.03)}),new xn({color:new Xt(.88,.32,.06)}),new xn({color:new Xt(1,.42,.09)})],ct=[new xn({color:new Xt(.08,.25,.52)}),new xn({color:new Xt(.1,.38,.68)}),new xn({color:new Xt(.15,.5,.82)})];let xt=0;for(let at=-Es;at<=Es;at+=.9,xt+=1){const ut=q(0,Nn+.3,at);if(ut===$o||ut===Ka&&xt%3!==0)continue;const $=.78+Math.random()*.18,nt=ut===bo?.025:.018,ht=new C(new X($,nt,.02),U);ht.position.set(-kn*.2,Nn+.3,at),H.add(ht);const dt=ht.clone();dt.position.set(kn*.15,Nn+.28,at),H.add(dt)}xt=0;for(let at=-Es;at<=Es;at+=1.4,xt+=1){const ut=q(0,-Nn+2.4,at);if(ut===$o||ut===Ka&&xt%2===1)continue;const $=ut===bo?.02:.016,nt=ut===bo?1.3:.95,ht=new C(new X($,$,nt),B);ht.position.set(-kn+.2,-Nn+2.4,at),H.add(ht);const dt=new C(new X($,$,nt),P);dt.position.set(kn-.2,-Nn+2.4,at),H.add(dt)}for(let at=0;at<72;at+=1){const $=Math.random()>.3?j:ct,nt=$[Math.floor(Math.random()*$.length)],ht=Math.floor(Math.random()*4),dt=(Math.random()-.5)*Es*1.35,pt=.45+Math.random()*1.65;let Rt=null;ht<2?(Rt=new C(new X(.01,pt,.01),nt),Rt.position.set(ht===0?-kn-Math.random()*10:kn+Math.random()*10,Math.random()*(Nn*2)-Nn+2,dt)):(Rt=new C(new X(pt,.01,.01),nt),Rt.position.set((Math.random()-.5)*kn*2,ht===2?Nn+Math.random()*10:-Nn+2-Math.random()*10,dt));const Ft=q(Rt.position.x,Rt.position.y,Rt.position.z);Ft!==$o&&(Ft===Ka&&at%2===1||H.add(Rt))}return H};t.add(O()),e=DK(),e.position.set(.4,2.5,2.5),e.rotation.y=-.35,e.rotation.z=.12,e.rotation.x=-.08,Y.add(e),Fg.setFromObject(e),Fg.getCenter(ep),Za.copy(S.position).sub(ep),y.radius=Math.max(Za.length(),v3),y.yaw=Math.atan2(Za.x,Za.z),y.pitch=St.clamp(Math.atan2(Za.y,Math.max(Math.hypot(Za.x,Za.z),v3)),-Lg,Lg),p=H=>{NK.has(H.code)&&document.pointerLockElement===T?.domElement&&(H.preventDefault(),H.stopPropagation(),typeof H.stopImmediatePropagation=="function"&&H.stopImmediatePropagation())},window.addEventListener("keydown",p,!0),g=H=>{document.pointerLockElement===T?.domElement&&(H.preventDefault(),H.stopPropagation(),typeof H.stopImmediatePropagation=="function"&&H.stopImmediatePropagation(),y.yaw-=H.movementX*.0022,y.pitch=St.clamp(y.pitch+H.movementY*.0018,-Lg,Lg))},window.addEventListener("mousemove",g,!0),t.add(new Co(526360,.4)),n=new hs(16772829,12,22),n.position.set(.5,7,3),Y.add(n);const et=new hs(3364266,5,18);et.position.set(-5,-1,2),t.add(et);const z=new hs(16772795,8,15);z.position.set(-1.5,4,-5),t.add(z);const W=new hs(4500223,6,30);W.position.set(-1,Nn+2,-3),t.add(W);const yt=new hs(16742195,4,20);yt.position.set(-kn+1,2,3),t.add(yt);const K=new hs(16737809,3,18);K.position.set(kn-1,1,-2),t.add(K);const Z=new ux(16777215,15,25,Math.PI/7,.6,1.5);Z.position.set(.5,9,3),Z.target=e,t.add(Z);for(let H=0;H<20;H+=1){const j=Math.random()>.4,ct=new hs(j?new Xt(.9,.4+Math.random()*.3,.05):new Xt(.1,.3+Math.random()*.3,.8),.8+Math.random()*2.5,10+Math.random()*12);ct.position.set((Math.random()-.5)*22,Math.random()*14-3,(Math.random()-.5)*40),Og.copy(ct.position),!(J.distanceToSquared(Og)>CK)&&t.add(ct)}t.updateMatrixWorld(!0),t.traverse(H=>{H.matrixAutoUpdate=!1,H.updateMatrix()}),s=null},update({camera:x,elapsed:S}){if(!x||!e||!n)return;s===null&&(s=S);const T=S-s;e.position.y=2.5+Math.sin(T*.38)*.28,e.rotation.z=.12+Math.sin(T*.27)*.04,e.rotation.x=-.08+Math.cos(T*.22)*.025,n.position.x=.5+Math.sin(T*.17)*.6,Fg.setFromObject(e),Fg.getCenter(ep);const M=Math.cos(y.pitch)*y.radius;Za.set(Math.sin(y.yaw)*M,Math.sin(y.pitch)*y.radius,Math.cos(y.yaw)*M),x.position.copy(ep).add(Za),x.lookAt(ep)},resize(){},dispose({scene:x,camera:S,renderer:T}){p&&(window.removeEventListener("keydown",p,!0),p=null),g&&(window.removeEventListener("mousemove",g,!0),g=null),r&&Fi(r),r=null,t=null,e=null,n=null,s=null,y.radius=0,y.yaw=0,y.pitch=0,S&&(S.fov=u??S.fov,S.near=d??S.near,S.far=f??S.far,S.updateProjectionMatrix()),x&&(x.background=i,x.fog=a),T&&c!==null&&(T.toneMappingExposure=c),i=null,a=null,c=null,u=null,d=null,f=null}}}},nn=800,A_=4e3,Hn=A_*2,LK=A_/2,OK=128,FK=64,UK=60,C2=13946557,PK=.03,C3=new V(0,-600,-A_*.35),zK=new V(0,-800,0);function xs(r){let t=r;return()=>(t=(t*16807+0)%2147483647,(t-1)/2147483646)}const IK={id:"cooper-station-reunion",title:"Cooper Station Reunion",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=0;function f(z,W,yt){const K=document.createElement("canvas");K.width=z,K.height=W;const Z=K.getContext("2d");yt(Z,z,W);const H=new Ti(K);return H.wrapS=H.wrapT=Fn,H}function p(){return f(2048,2048,(z,W,yt)=>{const K=xs(123),Z=8,H=W/Z,j=yt/Z;z.fillStyle="#4a7a2e",z.fillRect(0,0,W,yt);for(let at=0;at<yt;at+=8)for(let ut=0;ut<W;ut+=8){const $=100+Math.sin(ut*.01)*10+(K()-.5)*20,nt=50+(K()-.5)*12;z.fillStyle=`rgb(${Math.floor(nt)},${Math.floor($)},${Math.floor(nt*.55)})`,z.fillRect(ut,at,8,8)}const ct=["#5a8a3e","#3d6b22","#7a9a4e","#8b7d3a","#6b8a2e","#4e7528","#9a8844","#c4a94e","#6a9038","#557722","#b8a050","#7d8830","#a09040","#88a048"];for(let at=0;at<Z;at++)for(let ut=0;ut<Z;ut++){const $=1+Math.floor(K()*3);for(let nt=0;nt<$;nt++){const ht=15+K()*10,dt=ut*H+ht+K()*(H*.15),pt=at*j+ht+K()*(j*.15),Rt=H*(.3+K()*.5)-ht,Ft=j*(.3+K()*.5)-ht;if(z.fillStyle=ct[Math.floor(K()*ct.length)],z.beginPath(),z.moveTo(dt+K()*8,pt+K()*8),z.lineTo(dt+Rt+K()*8-4,pt+K()*8-4),z.lineTo(dt+Rt+K()*8,pt+Ft+K()*8),z.lineTo(dt+K()*8-4,pt+Ft+K()*8-4),z.closePath(),z.fill(),K()>.3){z.save(),z.clip(),z.strokeStyle="rgba(0,0,0,0.07)",z.lineWidth=1;const Gt=K()>.5,ae=3+K()*3;for(let Kt=0;Kt<Math.max(Rt,Ft)*1.5;Kt+=ae)z.beginPath(),Gt?(z.moveTo(dt+Kt+Math.sin(Kt*.1)*2,pt-10),z.lineTo(dt+Kt+Math.sin(Kt*.1+1)*2,pt+Ft+10)):(z.moveTo(dt-10,pt+Kt+Math.sin(Kt*.1)*2),z.lineTo(dt+Rt+10,pt+Kt+Math.sin(Kt*.1+1)*2)),z.stroke();z.restore()}}}z.lineCap="round";for(let at=1;at<Z;at++){const ut=at*H;z.strokeStyle="#555555",z.lineWidth=6+K()*3,z.beginPath(),z.moveTo(ut+(K()-.5)*15,0);for(let $=0;$<=yt;$+=yt/8)z.lineTo(ut+(K()-.5)*20,$);z.stroke(),z.strokeStyle="#888877",z.lineWidth=1,z.setLineDash([5,7]),z.beginPath(),z.moveTo(ut+(K()-.5)*8,0);for(let $=0;$<=yt;$+=yt/8)z.lineTo(ut+(K()-.5)*10,$);z.stroke(),z.setLineDash([])}for(let at=1;at<Z;at++){const ut=at*j;z.strokeStyle="#555555",z.lineWidth=5+K()*3,z.beginPath(),z.moveTo(0,ut+(K()-.5)*15);for(let $=0;$<=W;$+=W/8)z.lineTo($,ut+(K()-.5)*20);z.stroke()}for(let at=0;at<10;at++){const ut=K()*W,$=K()*yt,nt=ut+(K()-.5)*H*2,ht=$+(K()-.5)*j*2;z.strokeStyle="#666",z.lineWidth=3+K()*2,z.beginPath(),z.moveTo(ut,$),z.quadraticCurveTo(ut+(K()-.5)*80,$+(K()-.5)*80,nt,ht),z.stroke()}const xt=["#c8b898","#b8a888","#d4c4a4","#a89878","#e0d0b0","#988868","#fff8f0","#e8e0d0","#8b7355","#ccbbaa"];for(let at=0;at<Z;at++)for(let ut=0;ut<Z;ut++){if(K()>.55)continue;const $=ut*H+H*(.3+K()*.4),nt=at*j+j*(.3+K()*.4),ht=3+Math.floor(K()*12);for(let dt=0;dt<ht;dt++){const pt=$+(K()-.5)*H*.5,Rt=nt+(K()-.5)*j*.5,Ft=6+K()*10,Gt=6+K()*10;z.save(),z.translate(pt,Rt),z.rotate((K()-.5)*.25),z.fillStyle=xt[Math.floor(K()*xt.length)],z.fillRect(-Ft/2,-Gt/2,Ft,Gt),z.fillStyle="rgba(0,0,0,0.15)",z.fillRect(-Ft/2,-Gt/2,Ft,3),z.restore()}}for(let at=0;at<12;at++){const ut=(Math.floor(K()*Z)+.5)*H+(K()-.5)*30,$=(Math.floor(K()*Z)+.5)*j+(K()-.5)*30,nt=15+K()*30;z.fillStyle=`rgba(${25+K()*15},${90+K()*50},${25+K()*15},0.75)`,z.beginPath();const ht=5+Math.floor(K()*4);for(let dt=0;dt<ht;dt++){const pt=dt/ht*Math.PI*2,Rt=nt*(.7+K()*.5);dt===0?z.moveTo(ut+Math.cos(pt)*Rt,$+Math.sin(pt)*Rt):z.lineTo(ut+Math.cos(pt)*Rt,$+Math.sin(pt)*Rt)}z.closePath(),z.fill()}for(let at=0;at<1e3;at++){const ut=K()*W,$=K()*yt,nt=1.5+K()*4;z.fillStyle=`rgb(${15+K()*35},${45+K()*65},${10+K()*25})`,z.beginPath(),z.arc(ut,$,nt,0,Math.PI*2),z.fill()}for(let at=0;at<6;at++){const ut=K()*W,$=K()*yt;z.fillStyle=`rgba(${30+K()*15},${65+K()*25},${115+K()*35},0.6)`,z.beginPath(),z.ellipse(ut,$,12+K()*25,8+K()*18,K()*Math.PI,0,Math.PI*2),z.fill()}for(let at=0;at<10;at++){z.strokeStyle=`rgba(${135+K()*25},${115+K()*20},${75+K()*20},0.4)`,z.lineWidth=2+K()*1.5,z.beginPath();let ut=K()*W,$=K()*yt;z.moveTo(ut,$);for(let nt=0;nt<3+K()*3;nt++)ut+=(K()-.5)*120,$+=(K()-.5)*120,z.lineTo(ut,$);z.stroke()}})}function g(){return f(1024,1024,(z,W,yt)=>{z.fillStyle="#8080ff",z.fillRect(0,0,W,yt);const K=xs(789);for(let Z=0;Z<2e3;Z++){const H=K()*W,j=K()*yt,ct=1+K()*4,xt=100+K()*60;z.fillStyle=`rgb(${xt},${xt},255)`,z.beginPath(),z.arc(H,j,ct,0,Math.PI*2),z.fill()}})}function y(z,W,yt){const K=f(z,z,(Z,H,j)=>{const ct=H*.5,xt=j*.5,at=Z.createRadialGradient(ct,xt,0,ct,xt,H*.5);for(const[ut,$]of yt)at.addColorStop(ut,`rgba(${W.r}, ${W.g}, ${W.b}, ${$})`);Z.fillStyle=at,Z.fillRect(0,0,H,j)});return K.wrapS=K.wrapT=Yi,K.colorSpace=bn,K}function x(){const z=new qt(nn,nn,Hn,OK,FK,!0),W=p();W.repeat.set(12,6),W.colorSpace=bn;const yt=g();yt.repeat.set(12,6);const K=new bt({map:W,normalMap:yt,normalScale:new Ut(.3,.3),roughness:.85,metalness:0,side:Ss}),Z=new C(z,K);return Z.rotation.x=Math.PI/2,Z.receiveShadow=!0,s.add(Z),Z}function S(){const z=new vt,W={r:255,g:247,b:232},yt=y(1024,W,[[0,1],[.2,.92],[.5,.45],[.85,.08],[1,0]]),K=y(1024,W,[[0,.72],[.28,.42],[.65,.14],[1,0]]);for(let Z=-1;Z<=1;Z+=2){const H=Z*Hn/2,j=new Wr(nn*.75,96),ct=new xn({color:16777215,side:ss,toneMapped:!1}),xt=new C(j,ct);xt.position.z=H,z.add(xt);const at=new Wr(nn*1.6,96),ut=new xn({map:yt,color:16774888,transparent:!0,opacity:.95,side:ss,depthWrite:!1,depthTest:!1,blending:Tr,toneMapped:!1}),$=new C(at,ut);$.position.z=H-Z*20,z.add($);const nt=new Wr(nn*2.3,96),ht=new xn({map:K,color:16049609,transparent:!0,opacity:.62,side:ss,depthWrite:!1,depthTest:!1,blending:Tr,toneMapped:!1}),dt=new C(nt,ht);dt.position.z=H-Z*95,z.add(dt);const pt=new Wr(nn*3.1,96),Rt=new xn({map:K,color:15653816,transparent:!0,opacity:.35,side:ss,depthWrite:!1,depthTest:!1,blending:Tr,toneMapped:!1}),Ft=new C(pt,Rt);Ft.position.z=H-Z*220,z.add(Ft)}return s.add(z),z}function T(){const z=new vt,W=xs(555),yt=[new bt({color:13154456,roughness:.8}),new bt({color:12101768,roughness:.8}),new bt({color:13943972,roughness:.8}),new bt({color:15260864,roughness:.8}),new bt({color:10522752,roughness:.8}),new bt({color:16777215,roughness:.7}),new bt({color:9127187,roughness:.9})],K=[new bt({color:6702131,roughness:.9}),new bt({color:5592405,roughness:.7,metalness:.2}),new bt({color:8930338,roughness:.85}),new bt({color:3355443,roughness:.6,metalness:.3})],Z=[];for(let H=0;H<UK;H++)Z.push({angle:W()*Math.PI*2,z:(W()-.5)*Hn*.85,spread:50+W()*100,count:10+Math.floor(W()*25)});for(const H of Z)for(let j=0;j<H.count;j++){const ct=H.angle+(W()-.5)*H.spread/nn,xt=H.z+(W()-.5)*H.spread*2,at=Math.cos(ct)*(nn-5),ut=Math.sin(ct)*(nn-5),$=12+W()*14,nt=7+W()*8,ht=12+W()*14,dt=new X($,nt,ht),pt=new C(dt,yt[Math.floor(W()*yt.length)]);pt.castShadow=!0;const Rt=new gi(Math.max($,ht)*.7,4+W()*4,4),Ft=new C(Rt,K[Math.floor(W()*K.length)]);Ft.position.y=nt/2+2,Ft.rotation.y=Math.PI/4;const Gt=new vt;Gt.add(pt),Gt.add(Ft),Gt.position.set(at,ut,xt),Gt.lookAt(0,0,xt),Gt.rotateX(Math.PI/2),z.add(Gt)}return s.add(z),z}function M(){const z=new vt,W=xs(777),yt=new qt(.3,.5,4,5),K=new bt({color:7029286,roughness:.95}),Z=[new bt({color:2976542,roughness:.9}),new bt({color:3832360,roughness:.9}),new bt({color:1989140,roughness:.9}),new bt({color:4885054,roughness:.9})];for(let H=0;H<600;H++){const j=W()*Math.PI*2,ct=(W()-.5)*Hn*.85,xt=Math.cos(j)*(nn-3),at=Math.sin(j)*(nn-3),ut=new vt,$=new C(yt,K);ut.add($);const nt=W();if(nt<.5){const dt=2+W()*3,pt=new We(dt,6,5),Rt=new C(pt,Z[Math.floor(W()*Z.length)]);Rt.position.y=3+dt*.6,ut.add(Rt)}else if(nt<.8){const dt=2+W()*2,pt=new gi(dt,dt*2.5,6),Rt=new C(pt,Z[Math.floor(W()*Z.length)]);Rt.position.y=3+dt,ut.add(Rt)}else for(let dt=0;dt<3;dt++){const pt=1.5+W()*1.5,Rt=new We(pt,5,4),Ft=new C(Rt,Z[Math.floor(W()*Z.length)]);Ft.position.set((W()-.5)*2,3+dt*1.8,(W()-.5)*2),ut.add(Ft)}ut.position.set(xt,at,ct),ut.lookAt(0,0,ct),ut.rotateX(Math.PI/2);const ht=.7+W()*.6;ut.scale.set(ht,ht,ht),z.add(ut)}return s.add(z),z}function N(){const z=new vt,W=new bt({color:9136970,roughness:.9}),yt=xs(333);for(let K=0;K<40;K++){const Z=yt()*Math.PI*2,H=(yt()-.5)*Hn*.8,j=20+yt()*60,ct=new X(j,2,.3),xt=new C(ct,W),at=Math.cos(Z)*(nn-2),ut=Math.sin(Z)*(nn-2);xt.position.set(at,ut,H),xt.lookAt(0,0,H),xt.rotateX(Math.PI/2),z.add(xt)}s.add(z)}function v(){const z=new vt,W=xs(999),yt=new bt({color:13386820,metalness:.5,roughness:.4}),K=new bt({color:4491468,metalness:.5,roughness:.4}),Z=new bt({color:4500036,roughness:.7});for(let H=0;H<10;H++){const j=W()*Math.PI*2,ct=(W()-.5)*Hn*.7,xt=new vt,at=new X(.3,5,8),ut=new C(at,yt);ut.position.set(-3,2.5,0);const $=new C(at,yt);$.position.set(3,2.5,0),xt.add(ut,$);const nt=new C(new X(6.5,.3,.3),yt);nt.position.y=5,xt.add(nt);const ht=new X(2,.1,6),dt=new C(ht,K);dt.position.set(8,2,0),dt.rotation.x=-.3,xt.add(dt);const pt=new Wr(12,16),Rt=new C(pt,Z);Rt.rotation.x=-Math.PI/2,Rt.position.y=-.1,xt.add(Rt);const Ft=Math.cos(j)*(nn-3),Gt=Math.sin(j)*(nn-3);xt.position.set(Ft,Gt,ct),xt.lookAt(0,0,ct),xt.rotateX(Math.PI/2),xt.scale.setScalar(.8),z.add(xt)}s.add(z)}function A(){const z=new vt,W=xs(1234),yt=new bt({color:12096874,roughness:.95}),K=new bt({color:16777215,roughness:.6});for(let Z=0;Z<5;Z++){const H=W()*Math.PI*2,j=(W()-.5)*Hn*.7,ct=new vt,xt=new Wr(20,4),at=new C(xt,yt);at.rotation.x=-Math.PI/2,at.rotation.z=Math.PI/4,ct.add(at);for(let nt=0;nt<4;nt++){const ht=nt/4*Math.PI*2+Math.PI/4,dt=new X(.3,.05,20),pt=new C(dt,K);pt.position.set(Math.cos(ht)*10,.05,Math.sin(ht)*10),pt.rotation.y=ht,ct.add(pt)}const ut=Math.cos(H)*(nn-2),$=Math.sin(H)*(nn-2);ct.position.set(ut,$,j),ct.lookAt(0,0,j),ct.rotateX(Math.PI/2),z.add(ct)}s.add(z)}function R(){const z=new Qe,W=2e3,yt=new Float32Array(W*3),K=xs(8888);for(let j=0;j<W;j++){const ct=K()*Math.PI*2,xt=100+K()*(nn-150);yt[j*3]=Math.cos(ct)*xt,yt[j*3+1]=Math.sin(ct)*xt,yt[j*3+2]=(K()-.5)*Hn}z.setAttribute("position",new fs(yt,3));const Z=new er({color:15853267,size:2,transparent:!0,opacity:.065,depthWrite:!1}),H=new to(z,Z);s.add(H)}function L(){const z=new wi(16772829,2.5);z.position.set(0,nn*.6,-Hn*.5),z.target.position.set(0,-nn,-100),s.add(z),s.add(z.target);const W=new wi(16773853,1.8);W.position.set(0,nn*.6,Hn*.5),W.target.position.set(0,-nn,100),s.add(W),s.add(W.target);const yt=new Co(16774630,.45);s.add(yt);const K=new $p(16777215,4473924,.35);s.add(K)}function D(){t.background=new Xt(C2)}function U(){const z=new vt,W=new bt({color:4473924,metalness:.7,roughness:.3}),yt=new xn({color:16772812}),K=xs(4444);for(let Z=0;Z<120;Z++){const H=K()*Math.PI*2,j=(K()-.5)*Hn*.85,ct=new vt,xt=new C(new qt(.15,.2,6,6),W);xt.position.y=3,ct.add(xt);const at=new C(new We(.4,6,4),yt);at.position.y=6.2,ct.add(at);const ut=Math.cos(H)*(nn-2),$=Math.sin(H)*(nn-2);ct.position.set(ut,$,j),ct.lookAt(0,0,j),ct.rotateX(Math.PI/2),z.add(ct)}s.add(z)}function B(){const z=new vt,W=xs(5555),yt=new bt({color:11184810,roughness:.8}),K=new bt({color:7838139,metalness:.4,roughness:.5});for(let Z=0;Z<4;Z++){const H=W()*Math.PI*2,j=(W()-.5)*Hn*.6,ct=new vt;for(let $=0;$<4;$++){const nt=$/4*Math.PI*2,ht=new C(new qt(.3,.3,15,6),yt);ht.position.set(Math.cos(nt)*3,7.5,Math.sin(nt)*3),ct.add(ht)}const xt=new C(new We(5,8,6),K);xt.position.y=17,xt.scale.y=.7,ct.add(xt);const at=Math.cos(H)*(nn-5),ut=Math.sin(H)*(nn-5);ct.position.set(at,ut,j),ct.lookAt(0,0,j),ct.rotateX(Math.PI/2),ct.scale.setScalar(1.2),z.add(ct)}for(let Z=0;Z<6;Z++){const H=W()*Math.PI*2,j=(W()-.5)*Hn*.7,ct=new vt,xt=new C(new X(25+W()*15,8+W()*6,20+W()*10),new bt({color:13417386,roughness:.8}));xt.position.y=5,ct.add(xt);const at=new C(new X(28+W()*15,1,23+W()*10),new bt({color:6710886,roughness:.7}));at.position.y=10,ct.add(at);const ut=Math.cos(H)*(nn-6),$=Math.sin(H)*(nn-6);ct.position.set(ut,$,j),ct.lookAt(0,0,j),ct.rotateX(Math.PI/2),z.add(ct)}s.add(z)}function P(z,W,yt,K=3){const Z=Math.cos(W)*(nn-K),H=Math.sin(W)*(nn-K);z.position.set(Z,H,yt),z.lookAt(0,0,yt),z.rotateX(Math.PI/2)}function J(){const z=new vt,W=xs(7001),yt=new bt({color:15788248,roughness:.8}),K=new bt({color:5592405,roughness:.6,metalness:.2});for(let Z=0;Z<4;Z++){const H=new vt,j=new C(new X(10,8,18),yt);j.position.y=4,H.add(j);const ct=new gi(9,4,4),xt=new C(ct,K);xt.position.y=10,xt.rotation.y=Math.PI/4,H.add(xt);const at=new C(new X(3,12,3),yt);at.position.set(0,10,-7),H.add(at);const ut=new C(new gi(2.5,8,8),K);ut.position.set(0,20,-7),H.add(ut),P(H,W()*Math.PI*2,(W()-.5)*Hn*.7,5),z.add(H)}s.add(z)}function q(){const z=new vt,W=xs(7101),yt=new bt({color:15658734,roughness:.3,metalness:.4}),K=new bt({color:13382451,roughness:.6}),Z=new bt({color:12303291,roughness:.9});for(let H=0;H<6;H++){const j=new vt,ct=new C(new X(20,.3,15),Z);j.add(ct);const xt=new C(new X(18,.4,12),yt);xt.position.y=5,j.add(xt);for(let ut=-7;ut<=7;ut+=14)for(let $=-4;$<=4;$+=8){const nt=new C(new qt(.3,.3,5,6),yt);nt.position.set(ut,2.5,$),j.add(nt)}for(let ut=-4;ut<=4;ut+=4){const $=new C(new X(.8,2.5,.8),K);$.position.set(ut,1.25,0),j.add($)}const at=new C(new X(8,4,6),new bt({color:14538952,roughness:.8}));at.position.set(0,2,-9),j.add(at),P(j,W()*Math.PI*2,(W()-.5)*Hn*.75,4),z.add(j)}s.add(z)}function ft(){const z=new vt,W=xs(7201),yt=new bt({color:3815994,roughness:.95}),K=[13378082,2250188,15658734,2236962,8956484,14527010,6710886,11158562];for(let Z=0;Z<10;Z++){const H=new vt,j=20+W()*20,ct=15+W()*15,xt=new C(new X(j,.2,ct),yt);H.add(xt);const at=4+Math.floor(W()*10);for(let ut=0;ut<at;ut++){const $=new bt({color:K[Math.floor(W()*K.length)],roughness:.4,metalness:.3}),nt=new vt,ht=new C(new X(2.2,1.2,4.5),$);ht.position.y=.7,nt.add(ht);const dt=new C(new X(1.8,.9,2.2),new bt({color:3368601,roughness:.1,metalness:.3}));dt.position.y=1.6,nt.add(dt),nt.position.set((W()-.5)*(j-4),.1,(W()-.5)*(ct-5)),nt.rotation.y=W()>.5?0:Math.PI,H.add(nt)}P(H,W()*Math.PI*2,(W()-.5)*Hn*.75,3),z.add(H)}s.add(z)}function Mt(){const z=new vt,W=xs(7301),yt=new bt({color:4500189,roughness:.1,metalness:.1}),K=new bt({color:13417386,roughness:.85});for(let Z=0;Z<5;Z++){const H=new vt,j=new C(new X(18,.3,12),K);H.add(j);const ct=new C(new X(14,.1,8),yt);ct.position.y=.05,H.add(ct);const xt=new bt({color:16777215,roughness:.6});for(let at=-1;at<=1;at+=2){const ut=new C(new X(.5,.5,8),xt);ut.position.set(at*7.25,.3,0),H.add(ut)}for(let at=-1;at<=1;at+=2){const ut=new C(new X(15,.5,.5),xt);ut.position.set(0,.3,at*4.25),H.add(ut)}P(H,W()*Math.PI*2,(W()-.5)*Hn*.6,3),z.add(H)}s.add(z)}function mt(){const z=new vt,W=xs(7401),yt=[13378082,2250188,15658734,2236962,8956484,14527010,16777215,4473924];for(let K=0;K<80;K++){const Z=new bt({color:yt[Math.floor(W()*yt.length)],roughness:.4,metalness:.3}),H=new vt,j=new C(new X(2,1.1,4),Z);j.position.y=.6,H.add(j);const ct=new C(new X(1.6,.8,2),new bt({color:3368601,roughness:.1,metalness:.3}));ct.position.y=1.5,H.add(ct);const xt=W()*Math.PI*2,at=(W()-.5)*Hn*.85;P(H,xt,at,1.5),z.add(H)}s.add(z)}function F(){const z=new vt,W=xs(7501),yt=new bt({color:11197866,roughness:.05,metalness:.1,transparent:!0,opacity:.5});for(let K=0;K<8;K++){const Z=new vt,H=8+W()*6,j=15+W()*15,ct=new qt(H/2,H/2,j,12,1,!0,0,Math.PI),xt=new C(ct,yt);xt.rotation.z=Math.PI/2,xt.rotation.y=Math.PI/2,xt.position.y=0,Z.add(xt);for(let at=-1;at<=1;at+=2){const ut=new Wr(H/2,12,0,Math.PI),$=new C(ut,yt);$.position.set(0,0,at*j/2),$.rotation.x=at>0?0:Math.PI,Z.add($)}P(Z,W()*Math.PI*2,(W()-.5)*Hn*.7,2),z.add(Z)}s.add(z)}function Y(){const z=new vt,W=xs(7601),yt=new bt({color:12632256,roughness:.5,metalness:.4}),K=new bt({color:8947848,roughness:.5,metalness:.5});for(let Z=0;Z<12;Z++){const H=new vt,j=2+W()*2,ct=8+W()*10,xt=new C(new qt(j,j,ct,12),yt);xt.position.y=ct/2,H.add(xt);const at=new C(new gi(j+.3,3,12),K);at.position.y=ct+1.5,H.add(at);const ut=new vt;ut.add(H);const $=Math.floor(W()*3);for(let nt=0;nt<$;nt++){const ht=H.clone();ht.position.set((W()-.5)*8,0,(W()-.5)*8);const dt=.6+W()*.5;ht.scale.setScalar(dt),ut.add(ht)}P(ut,W()*Math.PI*2,(W()-.5)*Hn*.8,4),z.add(ut)}s.add(z)}function tt(){const z=new vt,W=xs(7701),yt=new bt({color:10066329,roughness:.8}),K=new bt({color:7829367,metalness:.5,roughness:.4});for(let Z=0;Z<8;Z++){const H=new vt,j=15+W()*10,ct=new C(new X(j,.5,6),yt);ct.position.y=6,H.add(ct);for(let xt=-j/2+2;xt<=j/2-2;xt+=j-4){const at=new C(new X(1.5,6,1.5),yt);at.position.set(xt,3,0),H.add(at)}for(let xt=-1;xt<=1;xt+=2){const at=new C(new X(j,1.2,.2),K);at.position.set(0,7,xt*2.8),H.add(at)}P(H,W()*Math.PI*2,(W()-.5)*Hn*.7,4),z.add(H)}s.add(z)}function lt(){const z=new vt,W=xs(7801),yt=new bt({color:9136970,roughness:.9}),K=new bt({color:3836462,roughness:.95});for(let Z=0;Z<15;Z++){const H=new vt,j=new C(new Wr(8,12),K);j.rotation.x=-Math.PI/2,H.add(j);for(let ct=0;ct<2+Math.floor(W()*3);ct++){const xt=new vt,at=new C(new X(2.5,.15,1.2),yt);at.position.y=1,xt.add(at);for(let ut=-1;ut<=1;ut+=2){const $=new C(new X(2.5,.1,.5),yt);$.position.set(0,.6,ut*.9),xt.add($)}for(let ut=-1;ut<=1;ut+=2){const $=new C(new X(.1,1,.1),yt);$.position.set(ut*1,.5,0),xt.add($)}xt.position.set((W()-.5)*10,0,(W()-.5)*10),xt.rotation.y=W()*Math.PI,H.add(xt)}P(H,W()*Math.PI*2,(W()-.5)*Hn*.7,3),z.add(H)}s.add(z)}function Tt(){const z=new vt,W=xs(7901),yt=new bt({color:7035722,roughness:.95});for(let K=0;K<50;K++){const Z=new vt,H=new C(new qt(.2,.25,10,5),yt);H.position.y=5,Z.add(H);const j=new C(new X(4,.2,.2),yt);j.position.y=9.5,Z.add(j);for(let ct=-1.5;ct<=1.5;ct+=1.5){const xt=new C(new qt(.08,.08,.5,4),new bt({color:8947848,metalness:.4,roughness:.3}));xt.position.set(ct,9.8,0),Z.add(xt)}P(Z,W()*Math.PI*2,(W()-.5)*Hn*.85,2),z.add(Z)}s.add(z)}function O(){const z=new vt,W=xs(6789),yt=new bt({color:9148740,roughness:.95}),K=new bt({color:12888398,roughness:.95});for(let Z=0;Z<30;Z++){const H=W()*Math.PI*2,j=(W()-.5)*Hn*.8,ct=W()>.5,xt=30+W()*60,at=30+W()*60,ut=new X(xt,1.5+W()*1.5,at),$=new C(ut,ct?K:yt),nt=Math.cos(H)*(nn-2),ht=Math.sin(H)*(nn-2);$.position.set(nt,ht,j),$.lookAt(0,0,j),$.rotateX(Math.PI/2),z.add($)}s.add(z)}function et(){D(),x(),S(),T(),M(),N(),v(),A(),R(),U(),B(),O(),J(),q(),ft(),Mt(),mt(),F(),Y(),tt(),lt(),Tt(),L()}return{init({root:z,camera:W,renderer:yt,scene:K}){r=z,t=K,e=W,n=yt,s=new vt,s.name="cooper-station-group",s.position.z=LK,s.rotation.z=d,r.add(s),i=t.fog,a=t.background,c=typeof n?.toneMappingExposure=="number"?n.toneMappingExposure:null,u={near:e.near,far:e.far,fov:e.fov},t.fog=new Hu(C2,15e-5),t.background=new Xt(C2),n&&(n.toneMappingExposure=1.1),e.near=1,e.far=12e3,e.fov=65,e.position.copy(C3),e.lookAt(zK),e.updateProjectionMatrix(),et()},update({delta:z}={}){if(!e)return;const W=Math.min(Math.max(z??1/60,0),.05);d=(d+W*PK)%(Math.PI*2),s&&(s.rotation.z=d),e.position.copy(C3)},resize(){},dispose(){s&&(r&&s.parent!==r&&r.add(s),Fi(s)),t&&(t.fog=i,t.background=a),n&&c!==null&&(n.toneMappingExposure=c),e&&u&&(e.near=u.near,e.far=u.far,e.fov=u.fov,e.updateProjectionMatrix()),r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=0}}}},VK=[l$,h$,A$,U$,tj,Tj,Ej,Hj,tY,nK,AK,BK,IK],GK=2;class kK{constructor(t){this.container=t,this.renderer=null,this.scene=null,this.camera=null,this.clock=new sP,this.sceneRoot=null,this.globalSet=null,this.controls=null,this.sceneManager=null,this.isRendering=!1,this.renderFrame=this.renderFrame.bind(this),this.handleResize=this.handleResize.bind(this)}async init(){if(!this.container)throw new Error("Missing viewport container element.");this.renderer=new Eq({antialias:!0});try{await this.renderer.init()}catch{throw this.renderer&&(this.renderer.dispose(),this.renderer=null),new Error("WebGPU initialization failed. This browser or device does not support WebGPU.")}this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,GK)),this.renderer.toneMapping=Mw,this.renderer.toneMappingExposure=.95,this.scene=new Bw,this.scene.background=new Xt(132106);const t=Math.max(this.container.clientWidth,1),e=Math.max(this.container.clientHeight,1);this.camera=new Xi(65,t/e,.1,5e3),this.camera.position.set(0,2.2,15),this.sceneRoot=new vt,this.scene.add(this.sceneRoot),this.globalSet=this.createGlobalSet(),this.scene.add(this.globalSet),this.renderer.setSize(t,e,!1),this.container.replaceChildren(this.renderer.domElement),this.controls=new Cq(this.camera,this.renderer.domElement),this.sceneManager=new Bq({camera:this.camera,manifest:VK,renderer:this.renderer,root:this.sceneRoot,scene:this.scene}),await this.sceneManager.load(0),window.addEventListener("resize",this.handleResize)}resumeRendering(){!this.renderer||this.isRendering||(this.clock.getDelta(),this.renderer.setAnimationLoop(this.renderFrame),this.isRendering=!0)}pauseRendering(){!this.renderer||!this.isRendering||(this.renderer.setAnimationLoop(null),this.isRendering=!1)}createGlobalSet(){const t=new vt;return t.name="app-global-placeholder",t}renderFrame(){const t=this.clock.getDelta(),e=this.clock.elapsedTime;this.controls&&this.controls.update(t),this.sceneManager&&this.sceneManager.update(t,e),this.renderer.render(this.scene,this.camera)}handleResize(){if(!this.renderer||!this.camera||!this.container)return;const t=Math.max(this.container.clientWidth,1),e=Math.max(this.container.clientHeight,1);this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e,!1),this.sceneManager&&this.sceneManager.resize(t,e)}async goToNextScene(){return this.sceneManager?this.sceneManager.next():!1}async goToPreviousScene(){return this.sceneManager?this.sceneManager.previous():!1}async goToScene(t){return this.sceneManager?this.sceneManager.goTo(t):!1}getCurrentSceneInfo(){return this.sceneManager?this.sceneManager.getCurrentSceneInfo():null}getSceneList(){return this.sceneManager?this.sceneManager.getSceneList():[]}hasNextScene(){return this.sceneManager?this.sceneManager.hasNext():!1}hasPreviousScene(){return this.sceneManager?this.sceneManager.hasPrevious():!1}dispose(){window.removeEventListener("resize",this.handleResize),this.pauseRendering(),this.controls&&(this.controls.dispose(),this.controls=null),this.sceneManager&&(this.sceneManager.dispose(),this.sceneManager=null),this.globalSet&&(Fi(this.globalSet),this.globalSet=null),this.renderer&&(this.renderer.dispose(),this.renderer=null),this.scene=null,this.camera=null}}const Pg=650;function zg(r){return new Promise(t=>{window.setTimeout(t,r)})}function HK(r){return r instanceof Error?r.message.toLowerCase().includes("webgpu")?"This browser could not initialize WebGPU. Please switch to a WebGPU-capable browser/device.":r.message:"Failed to initialize the scene system."}function WK(){const r=ys.useRef(null),t=ys.useRef(null),e=ys.useRef(!1),n=ys.useRef(null),s=ys.useRef(!1),[i,a]=ys.useState("booting"),[c,u]=ys.useState(0),[d,f]=ys.useState(!0),[p,g]=ys.useState(null),[y,x]=ys.useState([]),[S,T]=ys.useState(!1),[M,N]=ys.useState("");ys.useEffect(()=>{let q=!0;return(async()=>{try{const Mt=new kK(r.current);if(t.current=Mt,await Mt.init(),!q){Mt.dispose();return}Mt.pauseRendering(),g(Mt.getCurrentSceneInfo()),x(Mt.getSceneList()),a("idle")}catch(Mt){if(!q)return;t.current&&t.current.pauseRendering(),N(HK(Mt)),a("error")}})(),()=>{q=!1,t.current&&(t.current.dispose(),t.current=null)}},[]),ys.useEffect(()=>{const q=new Audio("/music.mp3");return q.loop=!0,q.preload="auto",n.current=q,()=>{q.pause(),q.currentTime=0,n.current=null}},[]);const v=ys.useMemo(()=>p?p.index<p.total-1:!1,[p]),A=ys.useMemo(()=>p?p.index>0:!1,[p]),R=i==="playing"||i==="transitioning",L=M.toLowerCase().includes("webgpu"),D=ys.useCallback(async q=>{if(i!=="playing"||e.current||!t.current)return!1;e.current=!0,a("transitioning"),u(1);let ft=!1;try{await zg(Pg),ft=await q(),ft&&g(t.current.getCurrentSceneInfo())}catch(Mt){return N(Mt instanceof Error?Mt.message:"Navigation failed."),a("error"),t.current&&t.current.pauseRendering(),u(0),e.current=!1,!1}return u(0),await zg(Pg),a("playing"),e.current=!1,ft},[i]),U=ys.useCallback(async()=>{i!=="idle"||e.current||(e.current=!0,!s.current&&n.current&&(s.current=!0,n.current.play().catch(()=>{s.current=!1})),f(!1),u(1),await zg(34),t.current&&t.current.resumeRendering(),a("transitioning"),f(!0),u(0),await zg(Pg),a("playing"),e.current=!1)},[i]),B=ys.useCallback(async()=>{!v||!t.current||await D(()=>t.current.goToNextScene())},[v,D]),P=ys.useCallback(async()=>{!A||!t.current||await D(()=>t.current.goToPreviousScene())},[A,D]),J=ys.useCallback(async q=>{if(!p||q===p.index||!t.current){T(!1);return}await D(()=>t.current.goToScene(q))&&T(!1)},[D,p]);return Se.jsxs("div",{className:"app-shell",children:[Se.jsx("div",{className:"viewport",ref:r}),i==="booting"&&Se.jsx("div",{className:"overlay status-overlay",children:Se.jsxs("div",{className:"status-panel",children:[Se.jsx("h2",{children:"Boot Sequence"}),Se.jsx("p",{children:"Preparing renderer and loading scene modules."})]})}),i==="idle"&&Se.jsx("div",{className:"overlay entrance-overlay",children:Se.jsx("div",{className:"entrance-panel",children:Se.jsxs("div",{className:"entrance-layout",children:[Se.jsxs("div",{className:"entrance-copy-block",children:[Se.jsx("p",{className:"entrance-kicker",children:"Three.js Recreation Of"}),Se.jsx("h1",{children:"Interstellar"}),Se.jsxs("div",{className:"entrance-meta",children:[Se.jsx("span",{children:"13 Scenes"}),Se.jsx("span",{children:"Cinematic"}),Se.jsx("span",{children:"WebGPU"})]}),Se.jsx("p",{className:"entrance-tip",children:"Some scenes require good GPU to run smoothly"}),Se.jsx("button",{className:"primary-action",type:"button",onClick:U,children:"Enter"})]}),Se.jsx("div",{className:"entrance-art-wrap",children:Se.jsx("img",{className:"entrance-art",src:"/logo-tp.png",alt:"Endurance ring illustration"})})]})})}),i==="error"&&Se.jsx("div",{className:"overlay status-overlay",children:Se.jsxs("div",{className:"status-panel",children:[Se.jsx("h2",{children:L?"WebGPU Unsupported":"Render System Error"}),Se.jsx("p",{children:M})]})}),R&&p&&Se.jsxs(Se.Fragment,{children:[Se.jsx("button",{className:`scene-menu-toggle ${S?"is-open":""}`,type:"button",onClick:()=>T(q=>!q),disabled:i!=="playing",children:"Scenes"}),Se.jsxs("aside",{className:`scene-menu ${S?"is-open":""}`,children:[Se.jsxs("div",{className:"scene-menu-header",children:[Se.jsx("p",{children:"Scene Navigator"}),Se.jsxs("span",{children:[p.total," Total"]})]}),Se.jsx("div",{className:"scene-menu-list",children:y.map(q=>Se.jsxs("button",{className:q.index===p.index?"is-active":"",type:"button",onClick:()=>J(q.index),disabled:i!=="playing",children:[Se.jsx("span",{children:String(q.index+1).padStart(2,"0")}),Se.jsx("span",{children:q.title})]},q.id))})]}),Se.jsxs("div",{className:"scene-hud",children:[Se.jsxs("p",{className:"scene-counter",children:[String(p.index+1).padStart(2,"0")," / ",String(p.total).padStart(2,"0")]}),Se.jsx("h3",{children:p.title})]}),Se.jsxs("div",{className:"scene-controls",children:[p.index>0&&Se.jsx("button",{type:"button",onClick:P,disabled:i!=="playing",children:"Previous Scene"}),Se.jsx("button",{type:"button",onClick:B,disabled:i!=="playing"||!v,children:"Next Scene"})]}),Se.jsxs("div",{className:"scene-input-hint",children:[Se.jsx("p",{children:"WSAD for movement"}),Se.jsx("p",{children:"Shift down, Space up"}),Se.jsx("p",{children:"Mouse for view panning"})]})]}),Se.jsx("div",{className:"fade-layer",style:{opacity:c,transition:`opacity ${d?Pg:0}ms ease`}})]})}UF.createRoot(document.getElementById("root")).render(Se.jsx(WK,{}));
