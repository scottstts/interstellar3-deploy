(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();var jb={exports:{}},Af={};var hN;function SF(){if(hN)return Af;hN=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function e(n,s,i){var a=null;if(i!==void 0&&(a=""+i),s.key!==void 0&&(a=""+s.key),"key"in s){i={};for(var c in s)c!=="key"&&(i[c]=s[c])}else i=s;return s=i.ref,{$$typeof:r,type:n,key:a,ref:s!==void 0?s:null,props:i}}return Af.Fragment=t,Af.jsx=e,Af.jsxs=e,Af}var dN;function wF(){return dN||(dN=1,jb.exports=SF()),jb.exports}var we=wF(),Yb={exports:{}},Nf={},Kb={exports:{}},Zb={};var fN;function TF(){return fN||(fN=1,(function(r){function t(U,K){var nt=U.length;U.push(K);t:for(;0<nt;){var ht=nt-1>>>1,_t=U[ht];if(0<s(_t,K))U[ht]=K,U[nt]=_t,nt=ht;else break t}}function e(U){return U.length===0?null:U[0]}function n(U){if(U.length===0)return null;var K=U[0],nt=U.pop();if(nt!==K){U[0]=nt;t:for(var ht=0,_t=U.length,P=_t>>>1;ht<P;){var q=2*(ht+1)-1,L=U[q],I=q+1,H=U[I];if(0>s(L,nt))I<_t&&0>s(H,L)?(U[ht]=H,U[I]=nt,ht=I):(U[ht]=L,U[q]=nt,ht=q);else if(I<_t&&0>s(H,nt))U[ht]=H,U[I]=nt,ht=I;else break t}}return K}function s(U,K){var nt=U.sortIndex-K.sortIndex;return nt!==0?nt:U.id-K.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;r.unstable_now=function(){return i.now()}}else{var a=Date,c=a.now();r.unstable_now=function(){return a.now()-c}}var u=[],d=[],f=1,p=null,g=3,y=!1,x=!1,S=!1,T=!1,M=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;function A(U){for(var K=e(d);K!==null;){if(K.callback===null)n(d);else if(K.startTime<=U)n(d),K.sortIndex=K.expirationTime,t(u,K);else break;K=e(d)}}function R(U){if(S=!1,A(U),!x)if(e(u)!==null)x=!0,F||(F=!0,j());else{var K=e(d);K!==null&&ft(R,K.startTime-U)}}var F=!1,D=-1,O=5,B=-1;function z(){return T?!0:!(r.unstable_now()-B<O)}function tt(){if(T=!1,F){var U=r.unstable_now();B=U;var K=!0;try{t:{x=!1,S&&(S=!1,N(D),D=-1),y=!0;var nt=g;try{e:{for(A(U),p=e(u);p!==null&&!(p.expirationTime>U&&z());){var ht=p.callback;if(typeof ht=="function"){p.callback=null,g=p.priorityLevel;var _t=ht(p.expirationTime<=U);if(U=r.unstable_now(),typeof _t=="function"){p.callback=_t,A(U),K=!0;break e}p===e(u)&&n(u),A(U)}else n(u);p=e(u)}if(p!==null)K=!0;else{var P=e(d);P!==null&&ft(R,P.startTime-U),K=!1}}break t}finally{p=null,g=nt,y=!1}K=void 0}}finally{K?j():F=!1}}}var j;if(typeof v=="function")j=function(){v(tt)};else if(typeof MessageChannel<"u"){var dt=new MessageChannel,wt=dt.port2;dt.port1.onmessage=tt,j=function(){wt.postMessage(null)}}else j=function(){M(tt,0)};function ft(U,K){D=M(function(){U(r.unstable_now())},K)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(U){U.callback=null},r.unstable_forceFrameRate=function(U){0>U||125<U?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<U?Math.floor(1e3/U):5},r.unstable_getCurrentPriorityLevel=function(){return g},r.unstable_next=function(U){switch(g){case 1:case 2:case 3:var K=3;break;default:K=g}var nt=g;g=K;try{return U()}finally{g=nt}},r.unstable_requestPaint=function(){T=!0},r.unstable_runWithPriority=function(U,K){switch(U){case 1:case 2:case 3:case 4:case 5:break;default:U=3}var nt=g;g=U;try{return K()}finally{g=nt}},r.unstable_scheduleCallback=function(U,K,nt){var ht=r.unstable_now();switch(typeof nt=="object"&&nt!==null?(nt=nt.delay,nt=typeof nt=="number"&&0<nt?ht+nt:ht):nt=ht,U){case 1:var _t=-1;break;case 2:_t=250;break;case 5:_t=1073741823;break;case 4:_t=1e4;break;default:_t=5e3}return _t=nt+_t,U={id:f++,callback:K,priorityLevel:U,startTime:nt,expirationTime:_t,sortIndex:-1},nt>ht?(U.sortIndex=nt,t(d,U),e(u)===null&&U===e(d)&&(S?(N(D),D=-1):S=!0,ft(R,nt-ht))):(U.sortIndex=_t,t(u,U),x||y||(x=!0,F||(F=!0,j()))),U},r.unstable_shouldYield=z,r.unstable_wrapCallback=function(U){var K=g;return function(){var nt=g;g=K;try{return U.apply(this,arguments)}finally{g=nt}}}})(Zb)),Zb}var pN;function _F(){return pN||(pN=1,Kb.exports=TF()),Kb.exports}var Qb={exports:{}},Se={};var mN;function MF(){if(mN)return Se;mN=1;var r=Symbol.for("react.transitional.element"),t=Symbol.for("react.portal"),e=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),a=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),g=Symbol.iterator;function y(P){return P===null||typeof P!="object"?null:(P=g&&P[g]||P["@@iterator"],typeof P=="function"?P:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,T={};function M(P,q,L){this.props=P,this.context=q,this.refs=T,this.updater=L||x}M.prototype.isReactComponent={},M.prototype.setState=function(P,q){if(typeof P!="object"&&typeof P!="function"&&P!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,P,q,"setState")},M.prototype.forceUpdate=function(P){this.updater.enqueueForceUpdate(this,P,"forceUpdate")};function N(){}N.prototype=M.prototype;function v(P,q,L){this.props=P,this.context=q,this.refs=T,this.updater=L||x}var A=v.prototype=new N;A.constructor=v,S(A,M.prototype),A.isPureReactComponent=!0;var R=Array.isArray;function F(){}var D={H:null,A:null,T:null,S:null},O=Object.prototype.hasOwnProperty;function B(P,q,L){var I=L.ref;return{$$typeof:r,type:P,key:q,ref:I!==void 0?I:null,props:L}}function z(P,q){return B(P.type,q,P.props)}function tt(P){return typeof P=="object"&&P!==null&&P.$$typeof===r}function j(P){var q={"=":"=0",":":"=2"};return"$"+P.replace(/[=:]/g,function(L){return q[L]})}var dt=/\/+/g;function wt(P,q){return typeof P=="object"&&P!==null&&P.key!=null?j(""+P.key):q.toString(36)}function ft(P){switch(P.status){case"fulfilled":return P.value;case"rejected":throw P.reason;default:switch(typeof P.status=="string"?P.then(F,F):(P.status="pending",P.then(function(q){P.status==="pending"&&(P.status="fulfilled",P.value=q)},function(q){P.status==="pending"&&(P.status="rejected",P.reason=q)})),P.status){case"fulfilled":return P.value;case"rejected":throw P.reason}}throw P}function U(P,q,L,I,H){var W=typeof P;(W==="undefined"||W==="boolean")&&(P=null);var at=!1;if(P===null)at=!0;else switch(W){case"bigint":case"string":case"number":at=!0;break;case"object":switch(P.$$typeof){case r:case t:at=!0;break;case f:return at=P._init,U(at(P._payload),q,L,I,H)}}if(at)return H=H(P),at=I===""?"."+wt(P,0):I,R(H)?(L="",at!=null&&(L=at.replace(dt,"$&/")+"/"),U(H,q,L,"",function(ct){return ct})):H!=null&&(tt(H)&&(H=z(H,L+(H.key==null||P&&P.key===H.key?"":(""+H.key).replace(dt,"$&/")+"/")+at)),q.push(H)),1;at=0;var rt=I===""?".":I+":";if(R(P))for(var et=0;et<P.length;et++)I=P[et],W=rt+wt(I,et),at+=U(I,q,L,W,H);else if(et=y(P),typeof et=="function")for(P=et.call(P),et=0;!(I=P.next()).done;)I=I.value,W=rt+wt(I,et++),at+=U(I,q,L,W,H);else if(W==="object"){if(typeof P.then=="function")return U(ft(P),q,L,I,H);throw q=String(P),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(P).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.")}return at}function K(P,q,L){if(P==null)return P;var I=[],H=0;return U(P,I,"","",function(W){return q.call(L,W,H++)}),I}function nt(P){if(P._status===-1){var q=P._result;q=q(),q.then(function(L){(P._status===0||P._status===-1)&&(P._status=1,P._result=L)},function(L){(P._status===0||P._status===-1)&&(P._status=2,P._result=L)}),P._status===-1&&(P._status=0,P._result=q)}if(P._status===1)return P._result.default;throw P._result}var ht=typeof reportError=="function"?reportError:function(P){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var q=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof P=="object"&&P!==null&&typeof P.message=="string"?String(P.message):String(P),error:P});if(!window.dispatchEvent(q))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",P);return}console.error(P)},_t={map:K,forEach:function(P,q,L){K(P,function(){q.apply(this,arguments)},L)},count:function(P){var q=0;return K(P,function(){q++}),q},toArray:function(P){return K(P,function(q){return q})||[]},only:function(P){if(!tt(P))throw Error("React.Children.only expected to receive a single React element child.");return P}};return Se.Activity=p,Se.Children=_t,Se.Component=M,Se.Fragment=e,Se.Profiler=s,Se.PureComponent=v,Se.StrictMode=n,Se.Suspense=u,Se.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,Se.__COMPILER_RUNTIME={__proto__:null,c:function(P){return D.H.useMemoCache(P)}},Se.cache=function(P){return function(){return P.apply(null,arguments)}},Se.cacheSignal=function(){return null},Se.cloneElement=function(P,q,L){if(P==null)throw Error("The argument must be a React element, but you passed "+P+".");var I=S({},P.props),H=P.key;if(q!=null)for(W in q.key!==void 0&&(H=""+q.key),q)!O.call(q,W)||W==="key"||W==="__self"||W==="__source"||W==="ref"&&q.ref===void 0||(I[W]=q[W]);var W=arguments.length-2;if(W===1)I.children=L;else if(1<W){for(var at=Array(W),rt=0;rt<W;rt++)at[rt]=arguments[rt+2];I.children=at}return B(P.type,H,I)},Se.createContext=function(P){return P={$$typeof:a,_currentValue:P,_currentValue2:P,_threadCount:0,Provider:null,Consumer:null},P.Provider=P,P.Consumer={$$typeof:i,_context:P},P},Se.createElement=function(P,q,L){var I,H={},W=null;if(q!=null)for(I in q.key!==void 0&&(W=""+q.key),q)O.call(q,I)&&I!=="key"&&I!=="__self"&&I!=="__source"&&(H[I]=q[I]);var at=arguments.length-2;if(at===1)H.children=L;else if(1<at){for(var rt=Array(at),et=0;et<at;et++)rt[et]=arguments[et+2];H.children=rt}if(P&&P.defaultProps)for(I in at=P.defaultProps,at)H[I]===void 0&&(H[I]=at[I]);return B(P,W,H)},Se.createRef=function(){return{current:null}},Se.forwardRef=function(P){return{$$typeof:c,render:P}},Se.isValidElement=tt,Se.lazy=function(P){return{$$typeof:f,_payload:{_status:-1,_result:P},_init:nt}},Se.memo=function(P,q){return{$$typeof:d,type:P,compare:q===void 0?null:q}},Se.startTransition=function(P){var q=D.T,L={};D.T=L;try{var I=P(),H=D.S;H!==null&&H(L,I),typeof I=="object"&&I!==null&&typeof I.then=="function"&&I.then(F,ht)}catch(W){ht(W)}finally{q!==null&&L.types!==null&&(q.types=L.types),D.T=q}},Se.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},Se.use=function(P){return D.H.use(P)},Se.useActionState=function(P,q,L){return D.H.useActionState(P,q,L)},Se.useCallback=function(P,q){return D.H.useCallback(P,q)},Se.useContext=function(P){return D.H.useContext(P)},Se.useDebugValue=function(){},Se.useDeferredValue=function(P,q){return D.H.useDeferredValue(P,q)},Se.useEffect=function(P,q){return D.H.useEffect(P,q)},Se.useEffectEvent=function(P){return D.H.useEffectEvent(P)},Se.useId=function(){return D.H.useId()},Se.useImperativeHandle=function(P,q,L){return D.H.useImperativeHandle(P,q,L)},Se.useInsertionEffect=function(P,q){return D.H.useInsertionEffect(P,q)},Se.useLayoutEffect=function(P,q){return D.H.useLayoutEffect(P,q)},Se.useMemo=function(P,q){return D.H.useMemo(P,q)},Se.useOptimistic=function(P,q){return D.H.useOptimistic(P,q)},Se.useReducer=function(P,q,L){return D.H.useReducer(P,q,L)},Se.useRef=function(P){return D.H.useRef(P)},Se.useState=function(P){return D.H.useState(P)},Se.useSyncExternalStore=function(P,q,L){return D.H.useSyncExternalStore(P,q,L)},Se.useTransition=function(){return D.H.useTransition()},Se.version="19.2.4",Se}var gN;function bw(){return gN||(gN=1,Qb.exports=MF()),Qb.exports}var Jb={exports:{}},oi={};var yN;function vF(){if(yN)return oi;yN=1;var r=bw();function t(u){var d="https://react.dev/errors/"+u;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)d+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+u+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function e(){}var n={d:{f:e,r:function(){throw Error(t(522))},D:e,C:e,L:e,m:e,X:e,S:e,M:e},p:0,findDOMNode:null},s=Symbol.for("react.portal");function i(u,d,f){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:p==null?null:""+p,children:u,containerInfo:d,implementation:f}}var a=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(u,d){if(u==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return oi.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,oi.createPortal=function(u,d){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(t(299));return i(u,d,null,f)},oi.flushSync=function(u){var d=a.T,f=n.p;try{if(a.T=null,n.p=2,u)return u()}finally{a.T=d,n.p=f,n.d.f()}},oi.preconnect=function(u,d){typeof u=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,n.d.C(u,d))},oi.prefetchDNS=function(u){typeof u=="string"&&n.d.D(u)},oi.preinit=function(u,d){if(typeof u=="string"&&d&&typeof d.as=="string"){var f=d.as,p=c(f,d.crossOrigin),g=typeof d.integrity=="string"?d.integrity:void 0,y=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;f==="style"?n.d.S(u,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:p,integrity:g,fetchPriority:y}):f==="script"&&n.d.X(u,{crossOrigin:p,integrity:g,fetchPriority:y,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},oi.preinitModule=function(u,d){if(typeof u=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var f=c(d.as,d.crossOrigin);n.d.M(u,{crossOrigin:f,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&n.d.M(u)},oi.preload=function(u,d){if(typeof u=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var f=d.as,p=c(f,d.crossOrigin);n.d.L(u,f,{crossOrigin:p,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},oi.preloadModule=function(u,d){if(typeof u=="string")if(d){var f=c(d.as,d.crossOrigin);n.d.m(u,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:f,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else n.d.m(u)},oi.requestFormReset=function(u){n.d.r(u)},oi.unstable_batchedUpdates=function(u,d){return u(d)},oi.useFormState=function(u,d,f){return a.H.useFormState(u,d,f)},oi.useFormStatus=function(){return a.H.useHostTransitionStatus()},oi.version="19.2.4",oi}var xN;function AF(){if(xN)return Jb.exports;xN=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Jb.exports=vF(),Jb.exports}var bN;function NF(){if(bN)return Nf;bN=1;var r=_F(),t=bw(),e=AF();function n(o){var l="https://react.dev/errors/"+o;if(1<arguments.length){l+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)l+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+o+"; visit "+l+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function i(o){var l=o,h=o;if(o.alternate)for(;l.return;)l=l.return;else{o=l;do l=o,(l.flags&4098)!==0&&(h=l.return),o=l.return;while(o)}return l.tag===3?h:null}function a(o){if(o.tag===13){var l=o.memoizedState;if(l===null&&(o=o.alternate,o!==null&&(l=o.memoizedState)),l!==null)return l.dehydrated}return null}function c(o){if(o.tag===31){var l=o.memoizedState;if(l===null&&(o=o.alternate,o!==null&&(l=o.memoizedState)),l!==null)return l.dehydrated}return null}function u(o){if(i(o)!==o)throw Error(n(188))}function d(o){var l=o.alternate;if(!l){if(l=i(o),l===null)throw Error(n(188));return l!==o?null:o}for(var h=o,m=l;;){var b=h.return;if(b===null)break;var w=b.alternate;if(w===null){if(m=b.return,m!==null){h=m;continue}break}if(b.child===w.child){for(w=b.child;w;){if(w===h)return u(b),o;if(w===m)return u(b),l;w=w.sibling}throw Error(n(188))}if(h.return!==m.return)h=b,m=w;else{for(var E=!1,V=b.child;V;){if(V===h){E=!0,h=b,m=w;break}if(V===m){E=!0,m=b,h=w;break}V=V.sibling}if(!E){for(V=w.child;V;){if(V===h){E=!0,h=w,m=b;break}if(V===m){E=!0,m=w,h=b;break}V=V.sibling}if(!E)throw Error(n(189))}}if(h.alternate!==m)throw Error(n(190))}if(h.tag!==3)throw Error(n(188));return h.stateNode.current===h?o:l}function f(o){var l=o.tag;if(l===5||l===26||l===27||l===6)return o;for(o=o.child;o!==null;){if(l=f(o),l!==null)return l;o=o.sibling}return null}var p=Object.assign,g=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),T=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),N=Symbol.for("react.consumer"),v=Symbol.for("react.context"),A=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),z=Symbol.for("react.memo_cache_sentinel"),tt=Symbol.iterator;function j(o){return o===null||typeof o!="object"?null:(o=tt&&o[tt]||o["@@iterator"],typeof o=="function"?o:null)}var dt=Symbol.for("react.client.reference");function wt(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===dt?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case S:return"Fragment";case M:return"Profiler";case T:return"StrictMode";case R:return"Suspense";case F:return"SuspenseList";case B:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case x:return"Portal";case v:return o.displayName||"Context";case N:return(o._context.displayName||"Context")+".Consumer";case A:var l=o.render;return o=o.displayName,o||(o=l.displayName||l.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case D:return l=o.displayName||null,l!==null?l:wt(o.type)||"Memo";case O:l=o._payload,o=o._init;try{return wt(o(l))}catch{}}return null}var ft=Array.isArray,U=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=e.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,nt={pending:!1,data:null,method:null,action:null},ht=[],_t=-1;function P(o){return{current:o}}function q(o){0>_t||(o.current=ht[_t],ht[_t]=null,_t--)}function L(o,l){_t++,ht[_t]=o.current,o.current=l}var I=P(null),H=P(null),W=P(null),at=P(null);function rt(o,l){switch(L(W,l),L(H,o),L(I,null),l.nodeType){case 9:case 11:o=(o=l.documentElement)&&(o=o.namespaceURI)?OA(o):0;break;default:if(o=l.tagName,l=l.namespaceURI)l=OA(l),o=FA(l,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}q(I),L(I,o)}function et(){q(I),q(H),q(W)}function ct(o){o.memoizedState!==null&&L(at,o);var l=I.current,h=FA(l,o.type);l!==h&&(L(H,o),L(I,h))}function st(o){H.current===o&&(q(I),q(H)),at.current===o&&(q(at),Tf._currentValue=nt)}var Z,Q;function $(o){if(Z===void 0)try{throw Error()}catch(h){var l=h.stack.trim().match(/\n( *(at )?)/);Z=l&&l[1]||"",Q=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Z+o+Q}var mt=!1;function yt(o,l){if(!o||mt)return"";mt=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var m={DetermineComponentFrameRoot:function(){try{if(l){var Pt=function(){throw Error()};if(Object.defineProperty(Pt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Pt,[])}catch(Et){var Rt=Et}Reflect.construct(o,[],Pt)}else{try{Pt.call()}catch(Et){Rt=Et}o.call(Pt.prototype)}}else{try{throw Error()}catch(Et){Rt=Et}(Pt=o())&&typeof Pt.catch=="function"&&Pt.catch(function(){})}}catch(Et){if(Et&&Rt&&typeof Et.stack=="string")return[Et.stack,Rt.stack]}return[null,null]}};m.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(m.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(m.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var w=m.DetermineComponentFrameRoot(),E=w[0],V=w[1];if(E&&V){var ot=E.split(`
`),Nt=V.split(`
`);for(b=m=0;m<ot.length&&!ot[m].includes("DetermineComponentFrameRoot");)m++;for(;b<Nt.length&&!Nt[b].includes("DetermineComponentFrameRoot");)b++;if(m===ot.length||b===Nt.length)for(m=ot.length-1,b=Nt.length-1;1<=m&&0<=b&&ot[m]!==Nt[b];)b--;for(;1<=m&&0<=b;m--,b--)if(ot[m]!==Nt[b]){if(m!==1||b!==1)do if(m--,b--,0>b||ot[m]!==Nt[b]){var Lt=`
`+ot[m].replace(" at new "," at ");return o.displayName&&Lt.includes("<anonymous>")&&(Lt=Lt.replace("<anonymous>",o.displayName)),Lt}while(1<=m&&0<=b);break}}}finally{mt=!1,Error.prepareStackTrace=h}return(h=o?o.displayName||o.name:"")?$(h):""}function Tt(o,l){switch(o.tag){case 26:case 27:case 5:return $(o.type);case 16:return $("Lazy");case 13:return o.child!==l&&l!==null?$("Suspense Fallback"):$("Suspense");case 19:return $("SuspenseList");case 0:case 15:return yt(o.type,!1);case 11:return yt(o.type.render,!1);case 1:return yt(o.type,!0);case 31:return $("Activity");default:return""}}function Mt(o){try{var l="",h=null;do l+=Tt(o,h),h=o,o=o.return;while(o);return l}catch(m){return`
Error generating stack: `+m.message+`
`+m.stack}}var Vt=Object.prototype.hasOwnProperty,zt=r.unstable_scheduleCallback,kt=r.unstable_cancelCallback,Qt=r.unstable_shouldYield,ie=r.unstable_requestPaint,Yt=r.unstable_now,Ne=r.unstable_getCurrentPriorityLevel,ce=r.unstable_ImmediatePriority,We=r.unstable_UserBlockingPriority,Sn=r.unstable_NormalPriority,vn=r.unstable_LowPriority,rs=r.unstable_IdlePriority,zn=r.log,$n=r.unstable_setDisableYieldValue,be=null,Ze=null;function An(o){if(typeof zn=="function"&&$n(o),Ze&&typeof Ze.setStrictMode=="function")try{Ze.setStrictMode(be,o)}catch{}}var Ue=Math.clz32?Math.clz32:oe,Xn=Math.log,le=Math.LN2;function oe(o){return o>>>=0,o===0?32:31-(Xn(o)/le|0)|0}var Ve=256,pn=262144,jn=4194304;function Yn(o){var l=o&42;if(l!==0)return l;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return o&261888;case 262144:case 524288:case 1048576:case 2097152:return o&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function Oi(o,l,h){var m=o.pendingLanes;if(m===0)return 0;var b=0,w=o.suspendedLanes,E=o.pingedLanes;o=o.warmLanes;var V=m&134217727;return V!==0?(m=V&~w,m!==0?b=Yn(m):(E&=V,E!==0?b=Yn(E):h||(h=V&~o,h!==0&&(b=Yn(h))))):(V=m&~w,V!==0?b=Yn(V):E!==0?b=Yn(E):h||(h=m&~o,h!==0&&(b=Yn(h)))),b===0?0:l!==0&&l!==b&&(l&w)===0&&(w=b&-b,h=l&-l,w>=h||w===32&&(h&4194048)!==0)?l:b}function bs(o,l){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&l)===0}function Uc(o,l){switch(o){case 1:case 2:case 4:case 8:case 64:return l+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function io(){var o=jn;return jn<<=1,(jn&62914560)===0&&(jn=4194304),o}function Nr(o){for(var l=[],h=0;31>h;h++)l.push(o);return l}function Fi(o,l){o.pendingLanes|=l,l!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function Eo(o,l,h,m,b,w){var E=o.pendingLanes;o.pendingLanes=h,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=h,o.entangledLanes&=h,o.errorRecoveryDisabledLanes&=h,o.shellSuspendCounter=0;var V=o.entanglements,ot=o.expirationTimes,Nt=o.hiddenUpdates;for(h=E&~h;0<h;){var Lt=31-Ue(h),Pt=1<<Lt;V[Lt]=0,ot[Lt]=-1;var Rt=Nt[Lt];if(Rt!==null)for(Nt[Lt]=null,Lt=0;Lt<Rt.length;Lt++){var Et=Rt[Lt];Et!==null&&(Et.lane&=-536870913)}h&=~Pt}m!==0&&ro(o,m,0),w!==0&&b===0&&o.tag!==0&&(o.suspendedLanes|=w&~(E&~l))}function ro(o,l,h){o.pendingLanes|=l,o.suspendedLanes&=~l;var m=31-Ue(l);o.entangledLanes|=l,o.entanglements[m]=o.entanglements[m]|1073741824|h&261930}function Pd(o,l){var h=o.entangledLanes|=l;for(o=o.entanglements;h;){var m=31-Ue(h),b=1<<m;b&l|o[m]&l&&(o[m]|=l),h&=~b}}function Xs(o,l){var h=l&-l;return h=(h&42)!==0?1:Si(h),(h&(o.suspendedLanes|l))!==0?0:h}function Si(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function pa(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function oo(){var o=K.p;return o!==0?o:(o=window.event,o===void 0?32:iN(o.type))}function dl(o,l){var h=K.p;try{return K.p=o,l()}finally{K.p=h}}var Ui=Math.random().toString(36).slice(2),Kn="__reactFiber$"+Ui,Ss="__reactProps$"+Ui,wi="__reactContainer$"+Ui,Rr="__reactEvents$"+Ui,Co="__reactListeners$"+Ui,Pc="__reactHandles$"+Ui,fl="__reactResources$"+Ui,ao="__reactMarker$"+Ui;function ma(o){delete o[Kn],delete o[Ss],delete o[Rr],delete o[Co],delete o[Pc]}function Er(o){var l=o[Kn];if(l)return l;for(var h=o.parentNode;h;){if(l=h[wi]||h[Kn]){if(h=l.alternate,l.child!==null||h!==null&&h.child!==null)for(o=kA(o);o!==null;){if(h=o[Kn])return h;o=kA(o)}return l}o=h,h=o.parentNode}return null}function Cr(o){if(o=o[Kn]||o[wi]){var l=o.tag;if(l===5||l===6||l===13||l===31||l===26||l===27||l===3)return o}return null}function lo(o){var l=o.tag;if(l===5||l===26||l===27||l===6)return o.stateNode;throw Error(n(33))}function Ti(o){var l=o[fl];return l||(l=o[fl]={hoistableStyles:new Map,hoistableScripts:new Map}),l}function wn(o){o[ao]=!0}var Pi=new Set,js={};function rr(o,l){Is(o,l),Is(o+"Capture",l)}function Is(o,l){for(js[o]=l,o=0;o<l.length;o++)Pi.add(l[o])}var zc=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),pl={},v_={};function dL(o){return Vt.call(v_,o)?!0:Vt.call(pl,o)?!1:zc.test(o)?v_[o]=!0:(pl[o]=!0,!1)}function e0(o,l,h){if(dL(l))if(h===null)o.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":o.removeAttribute(l);return;case"boolean":var m=l.toLowerCase().slice(0,5);if(m!=="data-"&&m!=="aria-"){o.removeAttribute(l);return}}o.setAttribute(l,""+h)}}function n0(o,l,h){if(h===null)o.removeAttribute(l);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(l);return}o.setAttribute(l,""+h)}}function ga(o,l,h,m){if(m===null)o.removeAttribute(h);else{switch(typeof m){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(h);return}o.setAttributeNS(l,h,""+m)}}function Br(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function A_(o){var l=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(l==="checkbox"||l==="radio")}function fL(o,l,h){var m=Object.getOwnPropertyDescriptor(o.constructor.prototype,l);if(!o.hasOwnProperty(l)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var b=m.get,w=m.set;return Object.defineProperty(o,l,{configurable:!0,get:function(){return b.call(this)},set:function(E){h=""+E,w.call(this,E)}}),Object.defineProperty(o,l,{enumerable:m.enumerable}),{getValue:function(){return h},setValue:function(E){h=""+E},stopTracking:function(){o._valueTracker=null,delete o[l]}}}}function Gx(o){if(!o._valueTracker){var l=A_(o)?"checked":"value";o._valueTracker=fL(o,l,""+o[l])}}function N_(o){if(!o)return!1;var l=o._valueTracker;if(!l)return!0;var h=l.getValue(),m="";return o&&(m=A_(o)?o.checked?"true":"false":o.value),o=m,o!==h?(l.setValue(o),!0):!1}function s0(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var pL=/[\n"\\]/g;function Dr(o){return o.replace(pL,function(l){return"\\"+l.charCodeAt(0).toString(16)+" "})}function kx(o,l,h,m,b,w,E,V){o.name="",E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"?o.type=E:o.removeAttribute("type"),l!=null?E==="number"?(l===0&&o.value===""||o.value!=l)&&(o.value=""+Br(l)):o.value!==""+Br(l)&&(o.value=""+Br(l)):E!=="submit"&&E!=="reset"||o.removeAttribute("value"),l!=null?Hx(o,E,Br(l)):h!=null?Hx(o,E,Br(h)):m!=null&&o.removeAttribute("value"),b==null&&w!=null&&(o.defaultChecked=!!w),b!=null&&(o.checked=b&&typeof b!="function"&&typeof b!="symbol"),V!=null&&typeof V!="function"&&typeof V!="symbol"&&typeof V!="boolean"?o.name=""+Br(V):o.removeAttribute("name")}function R_(o,l,h,m,b,w,E,V){if(w!=null&&typeof w!="function"&&typeof w!="symbol"&&typeof w!="boolean"&&(o.type=w),l!=null||h!=null){if(!(w!=="submit"&&w!=="reset"||l!=null)){Gx(o);return}h=h!=null?""+Br(h):"",l=l!=null?""+Br(l):h,V||l===o.value||(o.value=l),o.defaultValue=l}m=m??b,m=typeof m!="function"&&typeof m!="symbol"&&!!m,o.checked=V?o.checked:!!m,o.defaultChecked=!!m,E!=null&&typeof E!="function"&&typeof E!="symbol"&&typeof E!="boolean"&&(o.name=E),Gx(o)}function Hx(o,l,h){l==="number"&&s0(o.ownerDocument)===o||o.defaultValue===""+h||(o.defaultValue=""+h)}function Xu(o,l,h,m){if(o=o.options,l){l={};for(var b=0;b<h.length;b++)l["$"+h[b]]=!0;for(h=0;h<o.length;h++)b=l.hasOwnProperty("$"+o[h].value),o[h].selected!==b&&(o[h].selected=b),b&&m&&(o[h].defaultSelected=!0)}else{for(h=""+Br(h),l=null,b=0;b<o.length;b++){if(o[b].value===h){o[b].selected=!0,m&&(o[b].defaultSelected=!0);return}l!==null||o[b].disabled||(l=o[b])}l!==null&&(l.selected=!0)}}function E_(o,l,h){if(l!=null&&(l=""+Br(l),l!==o.value&&(o.value=l),h==null)){o.defaultValue!==l&&(o.defaultValue=l);return}o.defaultValue=h!=null?""+Br(h):""}function C_(o,l,h,m){if(l==null){if(m!=null){if(h!=null)throw Error(n(92));if(ft(m)){if(1<m.length)throw Error(n(93));m=m[0]}h=m}h==null&&(h=""),l=h}h=Br(l),o.defaultValue=h,m=o.textContent,m===h&&m!==""&&m!==null&&(o.value=m),Gx(o)}function ju(o,l){if(l){var h=o.firstChild;if(h&&h===o.lastChild&&h.nodeType===3){h.nodeValue=l;return}}o.textContent=l}var mL=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function B_(o,l,h){var m=l.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?m?o.setProperty(l,""):l==="float"?o.cssFloat="":o[l]="":m?o.setProperty(l,h):typeof h!="number"||h===0||mL.has(l)?l==="float"?o.cssFloat=h:o[l]=(""+h).trim():o[l]=h+"px"}function D_(o,l,h){if(l!=null&&typeof l!="object")throw Error(n(62));if(o=o.style,h!=null){for(var m in h)!h.hasOwnProperty(m)||l!=null&&l.hasOwnProperty(m)||(m.indexOf("--")===0?o.setProperty(m,""):m==="float"?o.cssFloat="":o[m]="");for(var b in l)m=l[b],l.hasOwnProperty(b)&&h[b]!==m&&B_(o,b,m)}else for(var w in l)l.hasOwnProperty(w)&&B_(o,w,l[w])}function Wx(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var gL=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),yL=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function i0(o){return yL.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}function ya(){}var qx=null;function $x(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Yu=null,Ku=null;function L_(o){var l=Cr(o);if(l&&(o=l.stateNode)){var h=o[Ss]||null;t:switch(o=l.stateNode,l.type){case"input":if(kx(o,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),l=h.name,h.type==="radio"&&l!=null){for(h=o;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+Dr(""+l)+'"][type="radio"]'),l=0;l<h.length;l++){var m=h[l];if(m!==o&&m.form===o.form){var b=m[Ss]||null;if(!b)throw Error(n(90));kx(m,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(l=0;l<h.length;l++)m=h[l],m.form===o.form&&N_(m)}break t;case"textarea":E_(o,h.value,h.defaultValue);break t;case"select":l=h.value,l!=null&&Xu(o,!!h.multiple,l,!1)}}}var Xx=!1;function O_(o,l,h){if(Xx)return o(l,h);Xx=!0;try{var m=o(l);return m}finally{if(Xx=!1,(Yu!==null||Ku!==null)&&(q0(),Yu&&(l=Yu,o=Ku,Ku=Yu=null,L_(l),o)))for(l=0;l<o.length;l++)L_(o[l])}}function zd(o,l){var h=o.stateNode;if(h===null)return null;var m=h[Ss]||null;if(m===null)return null;h=m[l];t:switch(l){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(m=!m.disabled)||(o=o.type,m=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!m;break t;default:o=!1}if(o)return null;if(h&&typeof h!="function")throw Error(n(231,l,typeof h));return h}var xa=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jx=!1;if(xa)try{var Id={};Object.defineProperty(Id,"passive",{get:function(){jx=!0}}),window.addEventListener("test",Id,Id),window.removeEventListener("test",Id,Id)}catch{jx=!1}var ml=null,Yx=null,r0=null;function F_(){if(r0)return r0;var o,l=Yx,h=l.length,m,b="value"in ml?ml.value:ml.textContent,w=b.length;for(o=0;o<h&&l[o]===b[o];o++);var E=h-o;for(m=1;m<=E&&l[h-m]===b[w-m];m++);return r0=b.slice(o,1<m?1-m:void 0)}function o0(o){var l=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&l===13&&(o=13)):o=l,o===10&&(o=13),32<=o||o===13?o:0}function a0(){return!0}function U_(){return!1}function zi(o){function l(h,m,b,w,E){this._reactName=h,this._targetInst=b,this.type=m,this.nativeEvent=w,this.target=E,this.currentTarget=null;for(var V in o)o.hasOwnProperty(V)&&(h=o[V],this[V]=h?h(w):w[V]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?a0:U_,this.isPropagationStopped=U_,this}return p(l.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=a0)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=a0)},persist:function(){},isPersistent:a0}),l}var Ic={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},l0=zi(Ic),Vd=p({},Ic,{view:0,detail:0}),xL=zi(Vd),Kx,Zx,Gd,c0=p({},Vd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Jx,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Gd&&(Gd&&o.type==="mousemove"?(Kx=o.screenX-Gd.screenX,Zx=o.screenY-Gd.screenY):Zx=Kx=0,Gd=o),Kx)},movementY:function(o){return"movementY"in o?o.movementY:Zx}}),P_=zi(c0),bL=p({},c0,{dataTransfer:0}),SL=zi(bL),wL=p({},Vd,{relatedTarget:0}),Qx=zi(wL),TL=p({},Ic,{animationName:0,elapsedTime:0,pseudoElement:0}),_L=zi(TL),ML=p({},Ic,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),vL=zi(ML),AL=p({},Ic,{data:0}),z_=zi(AL),NL={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RL={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},EL={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function CL(o){var l=this.nativeEvent;return l.getModifierState?l.getModifierState(o):(o=EL[o])?!!l[o]:!1}function Jx(){return CL}var BL=p({},Vd,{key:function(o){if(o.key){var l=NL[o.key]||o.key;if(l!=="Unidentified")return l}return o.type==="keypress"?(o=o0(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?RL[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Jx,charCode:function(o){return o.type==="keypress"?o0(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?o0(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),DL=zi(BL),LL=p({},c0,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),I_=zi(LL),OL=p({},Vd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Jx}),FL=zi(OL),UL=p({},Ic,{propertyName:0,elapsedTime:0,pseudoElement:0}),PL=zi(UL),zL=p({},c0,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),IL=zi(zL),VL=p({},Ic,{newState:0,oldState:0}),GL=zi(VL),kL=[9,13,27,32],t1=xa&&"CompositionEvent"in window,kd=null;xa&&"documentMode"in document&&(kd=document.documentMode);var HL=xa&&"TextEvent"in window&&!kd,V_=xa&&(!t1||kd&&8<kd&&11>=kd),G_=" ",k_=!1;function H_(o,l){switch(o){case"keyup":return kL.indexOf(l.keyCode)!==-1;case"keydown":return l.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function W_(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Zu=!1;function WL(o,l){switch(o){case"compositionend":return W_(l);case"keypress":return l.which!==32?null:(k_=!0,G_);case"textInput":return o=l.data,o===G_&&k_?null:o;default:return null}}function qL(o,l){if(Zu)return o==="compositionend"||!t1&&H_(o,l)?(o=F_(),r0=Yx=ml=null,Zu=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(l.ctrlKey||l.altKey||l.metaKey)||l.ctrlKey&&l.altKey){if(l.char&&1<l.char.length)return l.char;if(l.which)return String.fromCharCode(l.which)}return null;case"compositionend":return V_&&l.locale!=="ko"?null:l.data;default:return null}}var $L={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function q_(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l==="input"?!!$L[o.type]:l==="textarea"}function $_(o,l,h,m){Yu?Ku?Ku.push(m):Ku=[m]:Yu=m,l=Q0(l,"onChange"),0<l.length&&(h=new l0("onChange","change",null,h,m),o.push({event:h,listeners:l}))}var Hd=null,Wd=null;function XL(o){RA(o,0)}function u0(o){var l=lo(o);if(N_(l))return o}function X_(o,l){if(o==="change")return l}var j_=!1;if(xa){var e1;if(xa){var n1="oninput"in document;if(!n1){var Y_=document.createElement("div");Y_.setAttribute("oninput","return;"),n1=typeof Y_.oninput=="function"}e1=n1}else e1=!1;j_=e1&&(!document.documentMode||9<document.documentMode)}function K_(){Hd&&(Hd.detachEvent("onpropertychange",Z_),Wd=Hd=null)}function Z_(o){if(o.propertyName==="value"&&u0(Wd)){var l=[];$_(l,Wd,o,$x(o)),O_(XL,l)}}function jL(o,l,h){o==="focusin"?(K_(),Hd=l,Wd=h,Hd.attachEvent("onpropertychange",Z_)):o==="focusout"&&K_()}function YL(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return u0(Wd)}function KL(o,l){if(o==="click")return u0(l)}function ZL(o,l){if(o==="input"||o==="change")return u0(l)}function QL(o,l){return o===l&&(o!==0||1/o===1/l)||o!==o&&l!==l}var or=typeof Object.is=="function"?Object.is:QL;function qd(o,l){if(or(o,l))return!0;if(typeof o!="object"||o===null||typeof l!="object"||l===null)return!1;var h=Object.keys(o),m=Object.keys(l);if(h.length!==m.length)return!1;for(m=0;m<h.length;m++){var b=h[m];if(!Vt.call(l,b)||!or(o[b],l[b]))return!1}return!0}function Q_(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function J_(o,l){var h=Q_(o);o=0;for(var m;h;){if(h.nodeType===3){if(m=o+h.textContent.length,o<=l&&m>=l)return{node:h,offset:l-o};o=m}t:{for(;h;){if(h.nextSibling){h=h.nextSibling;break t}h=h.parentNode}h=void 0}h=Q_(h)}}function tM(o,l){return o&&l?o===l?!0:o&&o.nodeType===3?!1:l&&l.nodeType===3?tM(o,l.parentNode):"contains"in o?o.contains(l):o.compareDocumentPosition?!!(o.compareDocumentPosition(l)&16):!1:!1}function eM(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var l=s0(o.document);l instanceof o.HTMLIFrameElement;){try{var h=typeof l.contentWindow.location.href=="string"}catch{h=!1}if(h)o=l.contentWindow;else break;l=s0(o.document)}return l}function s1(o){var l=o&&o.nodeName&&o.nodeName.toLowerCase();return l&&(l==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||l==="textarea"||o.contentEditable==="true")}var JL=xa&&"documentMode"in document&&11>=document.documentMode,Qu=null,i1=null,$d=null,r1=!1;function nM(o,l,h){var m=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;r1||Qu==null||Qu!==s0(m)||(m=Qu,"selectionStart"in m&&s1(m)?m={start:m.selectionStart,end:m.selectionEnd}:(m=(m.ownerDocument&&m.ownerDocument.defaultView||window).getSelection(),m={anchorNode:m.anchorNode,anchorOffset:m.anchorOffset,focusNode:m.focusNode,focusOffset:m.focusOffset}),$d&&qd($d,m)||($d=m,m=Q0(i1,"onSelect"),0<m.length&&(l=new l0("onSelect","select",null,l,h),o.push({event:l,listeners:m}),l.target=Qu)))}function Vc(o,l){var h={};return h[o.toLowerCase()]=l.toLowerCase(),h["Webkit"+o]="webkit"+l,h["Moz"+o]="moz"+l,h}var Ju={animationend:Vc("Animation","AnimationEnd"),animationiteration:Vc("Animation","AnimationIteration"),animationstart:Vc("Animation","AnimationStart"),transitionrun:Vc("Transition","TransitionRun"),transitionstart:Vc("Transition","TransitionStart"),transitioncancel:Vc("Transition","TransitionCancel"),transitionend:Vc("Transition","TransitionEnd")},o1={},sM={};xa&&(sM=document.createElement("div").style,"AnimationEvent"in window||(delete Ju.animationend.animation,delete Ju.animationiteration.animation,delete Ju.animationstart.animation),"TransitionEvent"in window||delete Ju.transitionend.transition);function Gc(o){if(o1[o])return o1[o];if(!Ju[o])return o;var l=Ju[o],h;for(h in l)if(l.hasOwnProperty(h)&&h in sM)return o1[o]=l[h];return o}var iM=Gc("animationend"),rM=Gc("animationiteration"),oM=Gc("animationstart"),tO=Gc("transitionrun"),eO=Gc("transitionstart"),nO=Gc("transitioncancel"),aM=Gc("transitionend"),lM=new Map,a1="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");a1.push("scrollEnd");function co(o,l){lM.set(o,l),rr(l,[o])}var h0=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var l=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(l))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)},Lr=[],th=0,l1=0;function d0(){for(var o=th,l=l1=th=0;l<o;){var h=Lr[l];Lr[l++]=null;var m=Lr[l];Lr[l++]=null;var b=Lr[l];Lr[l++]=null;var w=Lr[l];if(Lr[l++]=null,m!==null&&b!==null){var E=m.pending;E===null?b.next=b:(b.next=E.next,E.next=b),m.pending=b}w!==0&&cM(h,b,w)}}function f0(o,l,h,m){Lr[th++]=o,Lr[th++]=l,Lr[th++]=h,Lr[th++]=m,l1|=m,o.lanes|=m,o=o.alternate,o!==null&&(o.lanes|=m)}function c1(o,l,h,m){return f0(o,l,h,m),p0(o)}function kc(o,l){return f0(o,null,null,l),p0(o)}function cM(o,l,h){o.lanes|=h;var m=o.alternate;m!==null&&(m.lanes|=h);for(var b=!1,w=o.return;w!==null;)w.childLanes|=h,m=w.alternate,m!==null&&(m.childLanes|=h),w.tag===22&&(o=w.stateNode,o===null||o._visibility&1||(b=!0)),o=w,w=w.return;return o.tag===3?(w=o.stateNode,b&&l!==null&&(b=31-Ue(h),o=w.hiddenUpdates,m=o[b],m===null?o[b]=[l]:m.push(l),l.lane=h|536870912),w):null}function p0(o){if(50<mf)throw mf=0,xb=null,Error(n(185));for(var l=o.return;l!==null;)o=l,l=o.return;return o.tag===3?o.stateNode:null}var eh={};function sO(o,l,h,m){this.tag=o,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=l,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=m,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ar(o,l,h,m){return new sO(o,l,h,m)}function u1(o){return o=o.prototype,!(!o||!o.isReactComponent)}function ba(o,l){var h=o.alternate;return h===null?(h=ar(o.tag,l,o.key,o.mode),h.elementType=o.elementType,h.type=o.type,h.stateNode=o.stateNode,h.alternate=o,o.alternate=h):(h.pendingProps=l,h.type=o.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=o.flags&65011712,h.childLanes=o.childLanes,h.lanes=o.lanes,h.child=o.child,h.memoizedProps=o.memoizedProps,h.memoizedState=o.memoizedState,h.updateQueue=o.updateQueue,l=o.dependencies,h.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext},h.sibling=o.sibling,h.index=o.index,h.ref=o.ref,h.refCleanup=o.refCleanup,h}function uM(o,l){o.flags&=65011714;var h=o.alternate;return h===null?(o.childLanes=0,o.lanes=l,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=h.childLanes,o.lanes=h.lanes,o.child=h.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=h.memoizedProps,o.memoizedState=h.memoizedState,o.updateQueue=h.updateQueue,o.type=h.type,l=h.dependencies,o.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),o}function m0(o,l,h,m,b,w){var E=0;if(m=o,typeof o=="function")u1(o)&&(E=1);else if(typeof o=="string")E=lF(o,h,I.current)?26:o==="html"||o==="head"||o==="body"?27:5;else t:switch(o){case B:return o=ar(31,h,l,b),o.elementType=B,o.lanes=w,o;case S:return Hc(h.children,b,w,l);case T:E=8,b|=24;break;case M:return o=ar(12,h,l,b|2),o.elementType=M,o.lanes=w,o;case R:return o=ar(13,h,l,b),o.elementType=R,o.lanes=w,o;case F:return o=ar(19,h,l,b),o.elementType=F,o.lanes=w,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case v:E=10;break t;case N:E=9;break t;case A:E=11;break t;case D:E=14;break t;case O:E=16,m=null;break t}E=29,h=Error(n(130,o===null?"null":typeof o,"")),m=null}return l=ar(E,h,l,b),l.elementType=o,l.type=m,l.lanes=w,l}function Hc(o,l,h,m){return o=ar(7,o,m,l),o.lanes=h,o}function h1(o,l,h){return o=ar(6,o,null,l),o.lanes=h,o}function hM(o){var l=ar(18,null,null,0);return l.stateNode=o,l}function d1(o,l,h){return l=ar(4,o.children!==null?o.children:[],o.key,l),l.lanes=h,l.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},l}var dM=new WeakMap;function Or(o,l){if(typeof o=="object"&&o!==null){var h=dM.get(o);return h!==void 0?h:(l={value:o,source:l,stack:Mt(l)},dM.set(o,l),l)}return{value:o,source:l,stack:Mt(l)}}var nh=[],sh=0,g0=null,Xd=0,Fr=[],Ur=0,gl=null,Bo=1,Do="";function Sa(o,l){nh[sh++]=Xd,nh[sh++]=g0,g0=o,Xd=l}function fM(o,l,h){Fr[Ur++]=Bo,Fr[Ur++]=Do,Fr[Ur++]=gl,gl=o;var m=Bo;o=Do;var b=32-Ue(m)-1;m&=~(1<<b),h+=1;var w=32-Ue(l)+b;if(30<w){var E=b-b%5;w=(m&(1<<E)-1).toString(32),m>>=E,b-=E,Bo=1<<32-Ue(l)+b|h<<b|m,Do=w+o}else Bo=1<<w|h<<b|m,Do=o}function f1(o){o.return!==null&&(Sa(o,1),fM(o,1,0))}function p1(o){for(;o===g0;)g0=nh[--sh],nh[sh]=null,Xd=nh[--sh],nh[sh]=null;for(;o===gl;)gl=Fr[--Ur],Fr[Ur]=null,Do=Fr[--Ur],Fr[Ur]=null,Bo=Fr[--Ur],Fr[Ur]=null}function pM(o,l){Fr[Ur++]=Bo,Fr[Ur++]=Do,Fr[Ur++]=gl,Bo=l.id,Do=l.overflow,gl=o}var Ys=null,Dn=null,Ge=!1,yl=null,Pr=!1,m1=Error(n(519));function xl(o){var l=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw jd(Or(l,o)),m1}function mM(o){var l=o.stateNode,h=o.type,m=o.memoizedProps;switch(l[Kn]=o,l[Ss]=m,h){case"dialog":Oe("cancel",l),Oe("close",l);break;case"iframe":case"object":case"embed":Oe("load",l);break;case"video":case"audio":for(h=0;h<yf.length;h++)Oe(yf[h],l);break;case"source":Oe("error",l);break;case"img":case"image":case"link":Oe("error",l),Oe("load",l);break;case"details":Oe("toggle",l);break;case"input":Oe("invalid",l),R_(l,m.value,m.defaultValue,m.checked,m.defaultChecked,m.type,m.name,!0);break;case"select":Oe("invalid",l);break;case"textarea":Oe("invalid",l),C_(l,m.value,m.defaultValue,m.children)}h=m.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||l.textContent===""+h||m.suppressHydrationWarning===!0||DA(l.textContent,h)?(m.popover!=null&&(Oe("beforetoggle",l),Oe("toggle",l)),m.onScroll!=null&&Oe("scroll",l),m.onScrollEnd!=null&&Oe("scrollend",l),m.onClick!=null&&(l.onclick=ya),l=!0):l=!1,l||xl(o,!0)}function gM(o){for(Ys=o.return;Ys;)switch(Ys.tag){case 5:case 31:case 13:Pr=!1;return;case 27:case 3:Pr=!0;return;default:Ys=Ys.return}}function ih(o){if(o!==Ys)return!1;if(!Ge)return gM(o),Ge=!0,!1;var l=o.tag,h;if((h=l!==3&&l!==27)&&((h=l===5)&&(h=o.type,h=!(h!=="form"&&h!=="button")||Lb(o.type,o.memoizedProps)),h=!h),h&&Dn&&xl(o),gM(o),l===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));Dn=GA(o)}else if(l===31){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));Dn=GA(o)}else l===27?(l=Dn,Dl(o.type)?(o=zb,zb=null,Dn=o):Dn=l):Dn=Ys?Ir(o.stateNode.nextSibling):null;return!0}function Wc(){Dn=Ys=null,Ge=!1}function g1(){var o=yl;return o!==null&&(ki===null?ki=o:ki.push.apply(ki,o),yl=null),o}function jd(o){yl===null?yl=[o]:yl.push(o)}var y1=P(null),qc=null,wa=null;function bl(o,l,h){L(y1,l._currentValue),l._currentValue=h}function Ta(o){o._currentValue=y1.current,q(y1)}function x1(o,l,h){for(;o!==null;){var m=o.alternate;if((o.childLanes&l)!==l?(o.childLanes|=l,m!==null&&(m.childLanes|=l)):m!==null&&(m.childLanes&l)!==l&&(m.childLanes|=l),o===h)break;o=o.return}}function b1(o,l,h,m){var b=o.child;for(b!==null&&(b.return=o);b!==null;){var w=b.dependencies;if(w!==null){var E=b.child;w=w.firstContext;t:for(;w!==null;){var V=w;w=b;for(var ot=0;ot<l.length;ot++)if(V.context===l[ot]){w.lanes|=h,V=w.alternate,V!==null&&(V.lanes|=h),x1(w.return,h,o),m||(E=null);break t}w=V.next}}else if(b.tag===18){if(E=b.return,E===null)throw Error(n(341));E.lanes|=h,w=E.alternate,w!==null&&(w.lanes|=h),x1(E,h,o),E=null}else E=b.child;if(E!==null)E.return=b;else for(E=b;E!==null;){if(E===o){E=null;break}if(b=E.sibling,b!==null){b.return=E.return,E=b;break}E=E.return}b=E}}function rh(o,l,h,m){o=null;for(var b=l,w=!1;b!==null;){if(!w){if((b.flags&524288)!==0)w=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var E=b.alternate;if(E===null)throw Error(n(387));if(E=E.memoizedProps,E!==null){var V=b.type;or(b.pendingProps.value,E.value)||(o!==null?o.push(V):o=[V])}}else if(b===at.current){if(E=b.alternate,E===null)throw Error(n(387));E.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(o!==null?o.push(Tf):o=[Tf])}b=b.return}o!==null&&b1(l,o,h,m),l.flags|=262144}function y0(o){for(o=o.firstContext;o!==null;){if(!or(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function $c(o){qc=o,wa=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function Ks(o){return yM(qc,o)}function x0(o,l){return qc===null&&$c(o),yM(o,l)}function yM(o,l){var h=l._currentValue;if(l={context:l,memoizedValue:h,next:null},wa===null){if(o===null)throw Error(n(308));wa=l,o.dependencies={lanes:0,firstContext:l},o.flags|=524288}else wa=wa.next=l;return h}var iO=typeof AbortController<"u"?AbortController:function(){var o=[],l=this.signal={aborted:!1,addEventListener:function(h,m){o.push(m)}};this.abort=function(){l.aborted=!0,o.forEach(function(h){return h()})}},rO=r.unstable_scheduleCallback,oO=r.unstable_NormalPriority,ws={$$typeof:v,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function S1(){return{controller:new iO,data:new Map,refCount:0}}function Yd(o){o.refCount--,o.refCount===0&&rO(oO,function(){o.controller.abort()})}var Kd=null,w1=0,oh=0,ah=null;function aO(o,l){if(Kd===null){var h=Kd=[];w1=0,oh=Mb(),ah={status:"pending",value:void 0,then:function(m){h.push(m)}}}return w1++,l.then(xM,xM),l}function xM(){if(--w1===0&&Kd!==null){ah!==null&&(ah.status="fulfilled");var o=Kd;Kd=null,oh=0,ah=null;for(var l=0;l<o.length;l++)(0,o[l])()}}function lO(o,l){var h=[],m={status:"pending",value:null,reason:null,then:function(b){h.push(b)}};return o.then(function(){m.status="fulfilled",m.value=l;for(var b=0;b<h.length;b++)(0,h[b])(l)},function(b){for(m.status="rejected",m.reason=b,b=0;b<h.length;b++)(0,h[b])(void 0)}),m}var bM=U.S;U.S=function(o,l){nA=Yt(),typeof l=="object"&&l!==null&&typeof l.then=="function"&&aO(o,l),bM!==null&&bM(o,l)};var Xc=P(null);function T1(){var o=Xc.current;return o!==null?o:Tn.pooledCache}function b0(o,l){l===null?L(Xc,Xc.current):L(Xc,l.pool)}function SM(){var o=T1();return o===null?null:{parent:ws._currentValue,pool:o}}var lh=Error(n(460)),_1=Error(n(474)),S0=Error(n(542)),w0={then:function(){}};function wM(o){return o=o.status,o==="fulfilled"||o==="rejected"}function TM(o,l,h){switch(h=o[h],h===void 0?o.push(l):h!==l&&(l.then(ya,ya),l=h),l.status){case"fulfilled":return l.value;case"rejected":throw o=l.reason,MM(o),o;default:if(typeof l.status=="string")l.then(ya,ya);else{if(o=Tn,o!==null&&100<o.shellSuspendCounter)throw Error(n(482));o=l,o.status="pending",o.then(function(m){if(l.status==="pending"){var b=l;b.status="fulfilled",b.value=m}},function(m){if(l.status==="pending"){var b=l;b.status="rejected",b.reason=m}})}switch(l.status){case"fulfilled":return l.value;case"rejected":throw o=l.reason,MM(o),o}throw Yc=l,lh}}function jc(o){try{var l=o._init;return l(o._payload)}catch(h){throw h!==null&&typeof h=="object"&&typeof h.then=="function"?(Yc=h,lh):h}}var Yc=null;function _M(){if(Yc===null)throw Error(n(459));var o=Yc;return Yc=null,o}function MM(o){if(o===lh||o===S0)throw Error(n(483))}var ch=null,Zd=0;function T0(o){var l=Zd;return Zd+=1,ch===null&&(ch=[]),TM(ch,o,l)}function Qd(o,l){l=l.props.ref,o.ref=l!==void 0?l:null}function _0(o,l){throw l.$$typeof===g?Error(n(525)):(o=Object.prototype.toString.call(l),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(l).join(", ")+"}":o)))}function vM(o){function l(bt,pt){if(o){var At=bt.deletions;At===null?(bt.deletions=[pt],bt.flags|=16):At.push(pt)}}function h(bt,pt){if(!o)return null;for(;pt!==null;)l(bt,pt),pt=pt.sibling;return null}function m(bt){for(var pt=new Map;bt!==null;)bt.key!==null?pt.set(bt.key,bt):pt.set(bt.index,bt),bt=bt.sibling;return pt}function b(bt,pt){return bt=ba(bt,pt),bt.index=0,bt.sibling=null,bt}function w(bt,pt,At){return bt.index=At,o?(At=bt.alternate,At!==null?(At=At.index,At<pt?(bt.flags|=67108866,pt):At):(bt.flags|=67108866,pt)):(bt.flags|=1048576,pt)}function E(bt){return o&&bt.alternate===null&&(bt.flags|=67108866),bt}function V(bt,pt,At,Ft){return pt===null||pt.tag!==6?(pt=h1(At,bt.mode,Ft),pt.return=bt,pt):(pt=b(pt,At),pt.return=bt,pt)}function ot(bt,pt,At,Ft){var he=At.type;return he===S?Lt(bt,pt,At.props.children,Ft,At.key):pt!==null&&(pt.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===O&&jc(he)===pt.type)?(pt=b(pt,At.props),Qd(pt,At),pt.return=bt,pt):(pt=m0(At.type,At.key,At.props,null,bt.mode,Ft),Qd(pt,At),pt.return=bt,pt)}function Nt(bt,pt,At,Ft){return pt===null||pt.tag!==4||pt.stateNode.containerInfo!==At.containerInfo||pt.stateNode.implementation!==At.implementation?(pt=d1(At,bt.mode,Ft),pt.return=bt,pt):(pt=b(pt,At.children||[]),pt.return=bt,pt)}function Lt(bt,pt,At,Ft,he){return pt===null||pt.tag!==7?(pt=Hc(At,bt.mode,Ft,he),pt.return=bt,pt):(pt=b(pt,At),pt.return=bt,pt)}function Pt(bt,pt,At){if(typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint")return pt=h1(""+pt,bt.mode,At),pt.return=bt,pt;if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case y:return At=m0(pt.type,pt.key,pt.props,null,bt.mode,At),Qd(At,pt),At.return=bt,At;case x:return pt=d1(pt,bt.mode,At),pt.return=bt,pt;case O:return pt=jc(pt),Pt(bt,pt,At)}if(ft(pt)||j(pt))return pt=Hc(pt,bt.mode,At,null),pt.return=bt,pt;if(typeof pt.then=="function")return Pt(bt,T0(pt),At);if(pt.$$typeof===v)return Pt(bt,x0(bt,pt),At);_0(bt,pt)}return null}function Rt(bt,pt,At,Ft){var he=pt!==null?pt.key:null;if(typeof At=="string"&&At!==""||typeof At=="number"||typeof At=="bigint")return he!==null?null:V(bt,pt,""+At,Ft);if(typeof At=="object"&&At!==null){switch(At.$$typeof){case y:return At.key===he?ot(bt,pt,At,Ft):null;case x:return At.key===he?Nt(bt,pt,At,Ft):null;case O:return At=jc(At),Rt(bt,pt,At,Ft)}if(ft(At)||j(At))return he!==null?null:Lt(bt,pt,At,Ft,null);if(typeof At.then=="function")return Rt(bt,pt,T0(At),Ft);if(At.$$typeof===v)return Rt(bt,pt,x0(bt,At),Ft);_0(bt,At)}return null}function Et(bt,pt,At,Ft,he){if(typeof Ft=="string"&&Ft!==""||typeof Ft=="number"||typeof Ft=="bigint")return bt=bt.get(At)||null,V(pt,bt,""+Ft,he);if(typeof Ft=="object"&&Ft!==null){switch(Ft.$$typeof){case y:return bt=bt.get(Ft.key===null?At:Ft.key)||null,ot(pt,bt,Ft,he);case x:return bt=bt.get(Ft.key===null?At:Ft.key)||null,Nt(pt,bt,Ft,he);case O:return Ft=jc(Ft),Et(bt,pt,At,Ft,he)}if(ft(Ft)||j(Ft))return bt=bt.get(At)||null,Lt(pt,bt,Ft,he,null);if(typeof Ft.then=="function")return Et(bt,pt,At,T0(Ft),he);if(Ft.$$typeof===v)return Et(bt,pt,At,x0(pt,Ft),he);_0(pt,Ft)}return null}function ne(bt,pt,At,Ft){for(var he=null,Qe=null,ae=pt,Re=pt=0,ze=null;ae!==null&&Re<At.length;Re++){ae.index>Re?(ze=ae,ae=null):ze=ae.sibling;var Je=Rt(bt,ae,At[Re],Ft);if(Je===null){ae===null&&(ae=ze);break}o&&ae&&Je.alternate===null&&l(bt,ae),pt=w(Je,pt,Re),Qe===null?he=Je:Qe.sibling=Je,Qe=Je,ae=ze}if(Re===At.length)return h(bt,ae),Ge&&Sa(bt,Re),he;if(ae===null){for(;Re<At.length;Re++)ae=Pt(bt,At[Re],Ft),ae!==null&&(pt=w(ae,pt,Re),Qe===null?he=ae:Qe.sibling=ae,Qe=ae);return Ge&&Sa(bt,Re),he}for(ae=m(ae);Re<At.length;Re++)ze=Et(ae,bt,Re,At[Re],Ft),ze!==null&&(o&&ze.alternate!==null&&ae.delete(ze.key===null?Re:ze.key),pt=w(ze,pt,Re),Qe===null?he=ze:Qe.sibling=ze,Qe=ze);return o&&ae.forEach(function(Pl){return l(bt,Pl)}),Ge&&Sa(bt,Re),he}function pe(bt,pt,At,Ft){if(At==null)throw Error(n(151));for(var he=null,Qe=null,ae=pt,Re=pt=0,ze=null,Je=At.next();ae!==null&&!Je.done;Re++,Je=At.next()){ae.index>Re?(ze=ae,ae=null):ze=ae.sibling;var Pl=Rt(bt,ae,Je.value,Ft);if(Pl===null){ae===null&&(ae=ze);break}o&&ae&&Pl.alternate===null&&l(bt,ae),pt=w(Pl,pt,Re),Qe===null?he=Pl:Qe.sibling=Pl,Qe=Pl,ae=ze}if(Je.done)return h(bt,ae),Ge&&Sa(bt,Re),he;if(ae===null){for(;!Je.done;Re++,Je=At.next())Je=Pt(bt,Je.value,Ft),Je!==null&&(pt=w(Je,pt,Re),Qe===null?he=Je:Qe.sibling=Je,Qe=Je);return Ge&&Sa(bt,Re),he}for(ae=m(ae);!Je.done;Re++,Je=At.next())Je=Et(ae,bt,Re,Je.value,Ft),Je!==null&&(o&&Je.alternate!==null&&ae.delete(Je.key===null?Re:Je.key),pt=w(Je,pt,Re),Qe===null?he=Je:Qe.sibling=Je,Qe=Je);return o&&ae.forEach(function(bF){return l(bt,bF)}),Ge&&Sa(bt,Re),he}function yn(bt,pt,At,Ft){if(typeof At=="object"&&At!==null&&At.type===S&&At.key===null&&(At=At.props.children),typeof At=="object"&&At!==null){switch(At.$$typeof){case y:t:{for(var he=At.key;pt!==null;){if(pt.key===he){if(he=At.type,he===S){if(pt.tag===7){h(bt,pt.sibling),Ft=b(pt,At.props.children),Ft.return=bt,bt=Ft;break t}}else if(pt.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===O&&jc(he)===pt.type){h(bt,pt.sibling),Ft=b(pt,At.props),Qd(Ft,At),Ft.return=bt,bt=Ft;break t}h(bt,pt);break}else l(bt,pt);pt=pt.sibling}At.type===S?(Ft=Hc(At.props.children,bt.mode,Ft,At.key),Ft.return=bt,bt=Ft):(Ft=m0(At.type,At.key,At.props,null,bt.mode,Ft),Qd(Ft,At),Ft.return=bt,bt=Ft)}return E(bt);case x:t:{for(he=At.key;pt!==null;){if(pt.key===he)if(pt.tag===4&&pt.stateNode.containerInfo===At.containerInfo&&pt.stateNode.implementation===At.implementation){h(bt,pt.sibling),Ft=b(pt,At.children||[]),Ft.return=bt,bt=Ft;break t}else{h(bt,pt);break}else l(bt,pt);pt=pt.sibling}Ft=d1(At,bt.mode,Ft),Ft.return=bt,bt=Ft}return E(bt);case O:return At=jc(At),yn(bt,pt,At,Ft)}if(ft(At))return ne(bt,pt,At,Ft);if(j(At)){if(he=j(At),typeof he!="function")throw Error(n(150));return At=he.call(At),pe(bt,pt,At,Ft)}if(typeof At.then=="function")return yn(bt,pt,T0(At),Ft);if(At.$$typeof===v)return yn(bt,pt,x0(bt,At),Ft);_0(bt,At)}return typeof At=="string"&&At!==""||typeof At=="number"||typeof At=="bigint"?(At=""+At,pt!==null&&pt.tag===6?(h(bt,pt.sibling),Ft=b(pt,At),Ft.return=bt,bt=Ft):(h(bt,pt),Ft=h1(At,bt.mode,Ft),Ft.return=bt,bt=Ft),E(bt)):h(bt,pt)}return function(bt,pt,At,Ft){try{Zd=0;var he=yn(bt,pt,At,Ft);return ch=null,he}catch(ae){if(ae===lh||ae===S0)throw ae;var Qe=ar(29,ae,null,bt.mode);return Qe.lanes=Ft,Qe.return=bt,Qe}}}var Kc=vM(!0),AM=vM(!1),Sl=!1;function M1(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function v1(o,l){o=o.updateQueue,l.updateQueue===o&&(l.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function wl(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function Tl(o,l,h){var m=o.updateQueue;if(m===null)return null;if(m=m.shared,(en&2)!==0){var b=m.pending;return b===null?l.next=l:(l.next=b.next,b.next=l),m.pending=l,l=p0(o),cM(o,null,h),l}return f0(o,m,l,h),p0(o)}function Jd(o,l,h){if(l=l.updateQueue,l!==null&&(l=l.shared,(h&4194048)!==0)){var m=l.lanes;m&=o.pendingLanes,h|=m,l.lanes=h,Pd(o,h)}}function A1(o,l){var h=o.updateQueue,m=o.alternate;if(m!==null&&(m=m.updateQueue,h===m)){var b=null,w=null;if(h=h.firstBaseUpdate,h!==null){do{var E={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};w===null?b=w=E:w=w.next=E,h=h.next}while(h!==null);w===null?b=w=l:w=w.next=l}else b=w=l;h={baseState:m.baseState,firstBaseUpdate:b,lastBaseUpdate:w,shared:m.shared,callbacks:m.callbacks},o.updateQueue=h;return}o=h.lastBaseUpdate,o===null?h.firstBaseUpdate=l:o.next=l,h.lastBaseUpdate=l}var N1=!1;function tf(){if(N1){var o=ah;if(o!==null)throw o}}function ef(o,l,h,m){N1=!1;var b=o.updateQueue;Sl=!1;var w=b.firstBaseUpdate,E=b.lastBaseUpdate,V=b.shared.pending;if(V!==null){b.shared.pending=null;var ot=V,Nt=ot.next;ot.next=null,E===null?w=Nt:E.next=Nt,E=ot;var Lt=o.alternate;Lt!==null&&(Lt=Lt.updateQueue,V=Lt.lastBaseUpdate,V!==E&&(V===null?Lt.firstBaseUpdate=Nt:V.next=Nt,Lt.lastBaseUpdate=ot))}if(w!==null){var Pt=b.baseState;E=0,Lt=Nt=ot=null,V=w;do{var Rt=V.lane&-536870913,Et=Rt!==V.lane;if(Et?(Pe&Rt)===Rt:(m&Rt)===Rt){Rt!==0&&Rt===oh&&(N1=!0),Lt!==null&&(Lt=Lt.next={lane:0,tag:V.tag,payload:V.payload,callback:null,next:null});t:{var ne=o,pe=V;Rt=l;var yn=h;switch(pe.tag){case 1:if(ne=pe.payload,typeof ne=="function"){Pt=ne.call(yn,Pt,Rt);break t}Pt=ne;break t;case 3:ne.flags=ne.flags&-65537|128;case 0:if(ne=pe.payload,Rt=typeof ne=="function"?ne.call(yn,Pt,Rt):ne,Rt==null)break t;Pt=p({},Pt,Rt);break t;case 2:Sl=!0}}Rt=V.callback,Rt!==null&&(o.flags|=64,Et&&(o.flags|=8192),Et=b.callbacks,Et===null?b.callbacks=[Rt]:Et.push(Rt))}else Et={lane:Rt,tag:V.tag,payload:V.payload,callback:V.callback,next:null},Lt===null?(Nt=Lt=Et,ot=Pt):Lt=Lt.next=Et,E|=Rt;if(V=V.next,V===null){if(V=b.shared.pending,V===null)break;Et=V,V=Et.next,Et.next=null,b.lastBaseUpdate=Et,b.shared.pending=null}}while(!0);Lt===null&&(ot=Pt),b.baseState=ot,b.firstBaseUpdate=Nt,b.lastBaseUpdate=Lt,w===null&&(b.shared.lanes=0),Nl|=E,o.lanes=E,o.memoizedState=Pt}}function NM(o,l){if(typeof o!="function")throw Error(n(191,o));o.call(l)}function RM(o,l){var h=o.callbacks;if(h!==null)for(o.callbacks=null,o=0;o<h.length;o++)NM(h[o],l)}var uh=P(null),M0=P(0);function EM(o,l){o=Ba,L(M0,o),L(uh,l),Ba=o|l.baseLanes}function R1(){L(M0,Ba),L(uh,uh.current)}function E1(){Ba=M0.current,q(uh),q(M0)}var lr=P(null),zr=null;function _l(o){var l=o.alternate;L(fs,fs.current&1),L(lr,o),zr===null&&(l===null||uh.current!==null||l.memoizedState!==null)&&(zr=o)}function C1(o){L(fs,fs.current),L(lr,o),zr===null&&(zr=o)}function CM(o){o.tag===22?(L(fs,fs.current),L(lr,o),zr===null&&(zr=o)):Ml()}function Ml(){L(fs,fs.current),L(lr,lr.current)}function cr(o){q(lr),zr===o&&(zr=null),q(fs)}var fs=P(0);function v0(o){for(var l=o;l!==null;){if(l.tag===13){var h=l.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||Ub(h)||Pb(h)))return l}else if(l.tag===19&&(l.memoizedProps.revealOrder==="forwards"||l.memoizedProps.revealOrder==="backwards"||l.memoizedProps.revealOrder==="unstable_legacy-backwards"||l.memoizedProps.revealOrder==="together")){if((l.flags&128)!==0)return l}else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return null;l=l.return}l.sibling.return=l.return,l=l.sibling}return null}var _a=0,_e=null,mn=null,Ts=null,A0=!1,hh=!1,Zc=!1,N0=0,nf=0,dh=null,cO=0;function os(){throw Error(n(321))}function B1(o,l){if(l===null)return!1;for(var h=0;h<l.length&&h<o.length;h++)if(!or(o[h],l[h]))return!1;return!0}function D1(o,l,h,m,b,w){return _a=w,_e=l,l.memoizedState=null,l.updateQueue=null,l.lanes=0,U.H=o===null||o.memoizedState===null?fv:X1,Zc=!1,w=h(m,b),Zc=!1,hh&&(w=DM(l,h,m,b)),BM(o),w}function BM(o){U.H=of;var l=mn!==null&&mn.next!==null;if(_a=0,Ts=mn=_e=null,A0=!1,nf=0,dh=null,l)throw Error(n(300));o===null||_s||(o=o.dependencies,o!==null&&y0(o)&&(_s=!0))}function DM(o,l,h,m){_e=o;var b=0;do{if(hh&&(dh=null),nf=0,hh=!1,25<=b)throw Error(n(301));if(b+=1,Ts=mn=null,o.updateQueue!=null){var w=o.updateQueue;w.lastEffect=null,w.events=null,w.stores=null,w.memoCache!=null&&(w.memoCache.index=0)}U.H=pv,w=l(h,m)}while(hh);return w}function uO(){var o=U.H,l=o.useState()[0];return l=typeof l.then=="function"?sf(l):l,o=o.useState()[0],(mn!==null?mn.memoizedState:null)!==o&&(_e.flags|=1024),l}function L1(){var o=N0!==0;return N0=0,o}function O1(o,l,h){l.updateQueue=o.updateQueue,l.flags&=-2053,o.lanes&=~h}function F1(o){if(A0){for(o=o.memoizedState;o!==null;){var l=o.queue;l!==null&&(l.pending=null),o=o.next}A0=!1}_a=0,Ts=mn=_e=null,hh=!1,nf=N0=0,dh=null}function _i(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ts===null?_e.memoizedState=Ts=o:Ts=Ts.next=o,Ts}function ps(){if(mn===null){var o=_e.alternate;o=o!==null?o.memoizedState:null}else o=mn.next;var l=Ts===null?_e.memoizedState:Ts.next;if(l!==null)Ts=l,mn=o;else{if(o===null)throw _e.alternate===null?Error(n(467)):Error(n(310));mn=o,o={memoizedState:mn.memoizedState,baseState:mn.baseState,baseQueue:mn.baseQueue,queue:mn.queue,next:null},Ts===null?_e.memoizedState=Ts=o:Ts=Ts.next=o}return Ts}function R0(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function sf(o){var l=nf;return nf+=1,dh===null&&(dh=[]),o=TM(dh,o,l),l=_e,(Ts===null?l.memoizedState:Ts.next)===null&&(l=l.alternate,U.H=l===null||l.memoizedState===null?fv:X1),o}function E0(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return sf(o);if(o.$$typeof===v)return Ks(o)}throw Error(n(438,String(o)))}function U1(o){var l=null,h=_e.updateQueue;if(h!==null&&(l=h.memoCache),l==null){var m=_e.alternate;m!==null&&(m=m.updateQueue,m!==null&&(m=m.memoCache,m!=null&&(l={data:m.data.map(function(b){return b.slice()}),index:0})))}if(l==null&&(l={data:[],index:0}),h===null&&(h=R0(),_e.updateQueue=h),h.memoCache=l,h=l.data[l.index],h===void 0)for(h=l.data[l.index]=Array(o),m=0;m<o;m++)h[m]=z;return l.index++,h}function Ma(o,l){return typeof l=="function"?l(o):l}function C0(o){var l=ps();return P1(l,mn,o)}function P1(o,l,h){var m=o.queue;if(m===null)throw Error(n(311));m.lastRenderedReducer=h;var b=o.baseQueue,w=m.pending;if(w!==null){if(b!==null){var E=b.next;b.next=w.next,w.next=E}l.baseQueue=b=w,m.pending=null}if(w=o.baseState,b===null)o.memoizedState=w;else{l=b.next;var V=E=null,ot=null,Nt=l,Lt=!1;do{var Pt=Nt.lane&-536870913;if(Pt!==Nt.lane?(Pe&Pt)===Pt:(_a&Pt)===Pt){var Rt=Nt.revertLane;if(Rt===0)ot!==null&&(ot=ot.next={lane:0,revertLane:0,gesture:null,action:Nt.action,hasEagerState:Nt.hasEagerState,eagerState:Nt.eagerState,next:null}),Pt===oh&&(Lt=!0);else if((_a&Rt)===Rt){Nt=Nt.next,Rt===oh&&(Lt=!0);continue}else Pt={lane:0,revertLane:Nt.revertLane,gesture:null,action:Nt.action,hasEagerState:Nt.hasEagerState,eagerState:Nt.eagerState,next:null},ot===null?(V=ot=Pt,E=w):ot=ot.next=Pt,_e.lanes|=Rt,Nl|=Rt;Pt=Nt.action,Zc&&h(w,Pt),w=Nt.hasEagerState?Nt.eagerState:h(w,Pt)}else Rt={lane:Pt,revertLane:Nt.revertLane,gesture:Nt.gesture,action:Nt.action,hasEagerState:Nt.hasEagerState,eagerState:Nt.eagerState,next:null},ot===null?(V=ot=Rt,E=w):ot=ot.next=Rt,_e.lanes|=Pt,Nl|=Pt;Nt=Nt.next}while(Nt!==null&&Nt!==l);if(ot===null?E=w:ot.next=V,!or(w,o.memoizedState)&&(_s=!0,Lt&&(h=ah,h!==null)))throw h;o.memoizedState=w,o.baseState=E,o.baseQueue=ot,m.lastRenderedState=w}return b===null&&(m.lanes=0),[o.memoizedState,m.dispatch]}function z1(o){var l=ps(),h=l.queue;if(h===null)throw Error(n(311));h.lastRenderedReducer=o;var m=h.dispatch,b=h.pending,w=l.memoizedState;if(b!==null){h.pending=null;var E=b=b.next;do w=o(w,E.action),E=E.next;while(E!==b);or(w,l.memoizedState)||(_s=!0),l.memoizedState=w,l.baseQueue===null&&(l.baseState=w),h.lastRenderedState=w}return[w,m]}function LM(o,l,h){var m=_e,b=ps(),w=Ge;if(w){if(h===void 0)throw Error(n(407));h=h()}else h=l();var E=!or((mn||b).memoizedState,h);if(E&&(b.memoizedState=h,_s=!0),b=b.queue,G1(UM.bind(null,m,b,o),[o]),b.getSnapshot!==l||E||Ts!==null&&Ts.memoizedState.tag&1){if(m.flags|=2048,fh(9,{destroy:void 0},FM.bind(null,m,b,h,l),null),Tn===null)throw Error(n(349));w||(_a&127)!==0||OM(m,l,h)}return h}function OM(o,l,h){o.flags|=16384,o={getSnapshot:l,value:h},l=_e.updateQueue,l===null?(l=R0(),_e.updateQueue=l,l.stores=[o]):(h=l.stores,h===null?l.stores=[o]:h.push(o))}function FM(o,l,h,m){l.value=h,l.getSnapshot=m,PM(l)&&zM(o)}function UM(o,l,h){return h(function(){PM(l)&&zM(o)})}function PM(o){var l=o.getSnapshot;o=o.value;try{var h=l();return!or(o,h)}catch{return!0}}function zM(o){var l=kc(o,2);l!==null&&Hi(l,o,2)}function I1(o){var l=_i();if(typeof o=="function"){var h=o;if(o=h(),Zc){An(!0);try{h()}finally{An(!1)}}}return l.memoizedState=l.baseState=o,l.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:o},l}function IM(o,l,h,m){return o.baseState=h,P1(o,mn,typeof m=="function"?m:Ma)}function hO(o,l,h,m,b){if(L0(o))throw Error(n(485));if(o=l.action,o!==null){var w={payload:b,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(E){w.listeners.push(E)}};U.T!==null?h(!0):w.isTransition=!1,m(w),h=l.pending,h===null?(w.next=l.pending=w,VM(l,w)):(w.next=h.next,l.pending=h.next=w)}}function VM(o,l){var h=l.action,m=l.payload,b=o.state;if(l.isTransition){var w=U.T,E={};U.T=E;try{var V=h(b,m),ot=U.S;ot!==null&&ot(E,V),GM(o,l,V)}catch(Nt){V1(o,l,Nt)}finally{w!==null&&E.types!==null&&(w.types=E.types),U.T=w}}else try{w=h(b,m),GM(o,l,w)}catch(Nt){V1(o,l,Nt)}}function GM(o,l,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(m){kM(o,l,m)},function(m){return V1(o,l,m)}):kM(o,l,h)}function kM(o,l,h){l.status="fulfilled",l.value=h,HM(l),o.state=h,l=o.pending,l!==null&&(h=l.next,h===l?o.pending=null:(h=h.next,l.next=h,VM(o,h)))}function V1(o,l,h){var m=o.pending;if(o.pending=null,m!==null){m=m.next;do l.status="rejected",l.reason=h,HM(l),l=l.next;while(l!==m)}o.action=null}function HM(o){o=o.listeners;for(var l=0;l<o.length;l++)(0,o[l])()}function WM(o,l){return l}function qM(o,l){if(Ge){var h=Tn.formState;if(h!==null){t:{var m=_e;if(Ge){if(Dn){e:{for(var b=Dn,w=Pr;b.nodeType!==8;){if(!w){b=null;break e}if(b=Ir(b.nextSibling),b===null){b=null;break e}}w=b.data,b=w==="F!"||w==="F"?b:null}if(b){Dn=Ir(b.nextSibling),m=b.data==="F!";break t}}xl(m)}m=!1}m&&(l=h[0])}}return h=_i(),h.memoizedState=h.baseState=l,m={pending:null,lanes:0,dispatch:null,lastRenderedReducer:WM,lastRenderedState:l},h.queue=m,h=uv.bind(null,_e,m),m.dispatch=h,m=I1(!1),w=$1.bind(null,_e,!1,m.queue),m=_i(),b={state:l,dispatch:null,action:o,pending:null},m.queue=b,h=hO.bind(null,_e,b,w,h),b.dispatch=h,m.memoizedState=o,[l,h,!1]}function $M(o){var l=ps();return XM(l,mn,o)}function XM(o,l,h){if(l=P1(o,l,WM)[0],o=C0(Ma)[0],typeof l=="object"&&l!==null&&typeof l.then=="function")try{var m=sf(l)}catch(E){throw E===lh?S0:E}else m=l;l=ps();var b=l.queue,w=b.dispatch;return h!==l.memoizedState&&(_e.flags|=2048,fh(9,{destroy:void 0},dO.bind(null,b,h),null)),[m,w,o]}function dO(o,l){o.action=l}function jM(o){var l=ps(),h=mn;if(h!==null)return XM(l,h,o);ps(),l=l.memoizedState,h=ps();var m=h.queue.dispatch;return h.memoizedState=o,[l,m,!1]}function fh(o,l,h,m){return o={tag:o,create:h,deps:m,inst:l,next:null},l=_e.updateQueue,l===null&&(l=R0(),_e.updateQueue=l),h=l.lastEffect,h===null?l.lastEffect=o.next=o:(m=h.next,h.next=o,o.next=m,l.lastEffect=o),o}function YM(){return ps().memoizedState}function B0(o,l,h,m){var b=_i();_e.flags|=o,b.memoizedState=fh(1|l,{destroy:void 0},h,m===void 0?null:m)}function D0(o,l,h,m){var b=ps();m=m===void 0?null:m;var w=b.memoizedState.inst;mn!==null&&m!==null&&B1(m,mn.memoizedState.deps)?b.memoizedState=fh(l,w,h,m):(_e.flags|=o,b.memoizedState=fh(1|l,w,h,m))}function KM(o,l){B0(8390656,8,o,l)}function G1(o,l){D0(2048,8,o,l)}function fO(o){_e.flags|=4;var l=_e.updateQueue;if(l===null)l=R0(),_e.updateQueue=l,l.events=[o];else{var h=l.events;h===null?l.events=[o]:h.push(o)}}function ZM(o){var l=ps().memoizedState;return fO({ref:l,nextImpl:o}),function(){if((en&2)!==0)throw Error(n(440));return l.impl.apply(void 0,arguments)}}function QM(o,l){return D0(4,2,o,l)}function JM(o,l){return D0(4,4,o,l)}function tv(o,l){if(typeof l=="function"){o=o();var h=l(o);return function(){typeof h=="function"?h():l(null)}}if(l!=null)return o=o(),l.current=o,function(){l.current=null}}function ev(o,l,h){h=h!=null?h.concat([o]):null,D0(4,4,tv.bind(null,l,o),h)}function k1(){}function nv(o,l){var h=ps();l=l===void 0?null:l;var m=h.memoizedState;return l!==null&&B1(l,m[1])?m[0]:(h.memoizedState=[o,l],o)}function sv(o,l){var h=ps();l=l===void 0?null:l;var m=h.memoizedState;if(l!==null&&B1(l,m[1]))return m[0];if(m=o(),Zc){An(!0);try{o()}finally{An(!1)}}return h.memoizedState=[m,l],m}function H1(o,l,h){return h===void 0||(_a&1073741824)!==0&&(Pe&261930)===0?o.memoizedState=l:(o.memoizedState=h,o=iA(),_e.lanes|=o,Nl|=o,h)}function iv(o,l,h,m){return or(h,l)?h:uh.current!==null?(o=H1(o,h,m),or(o,l)||(_s=!0),o):(_a&42)===0||(_a&1073741824)!==0&&(Pe&261930)===0?(_s=!0,o.memoizedState=h):(o=iA(),_e.lanes|=o,Nl|=o,l)}function rv(o,l,h,m,b){var w=K.p;K.p=w!==0&&8>w?w:8;var E=U.T,V={};U.T=V,$1(o,!1,l,h);try{var ot=b(),Nt=U.S;if(Nt!==null&&Nt(V,ot),ot!==null&&typeof ot=="object"&&typeof ot.then=="function"){var Lt=lO(ot,m);rf(o,l,Lt,dr(o))}else rf(o,l,m,dr(o))}catch(Pt){rf(o,l,{then:function(){},status:"rejected",reason:Pt},dr())}finally{K.p=w,E!==null&&V.types!==null&&(E.types=V.types),U.T=E}}function pO(){}function W1(o,l,h,m){if(o.tag!==5)throw Error(n(476));var b=ov(o).queue;rv(o,b,l,nt,h===null?pO:function(){return av(o),h(m)})}function ov(o){var l=o.memoizedState;if(l!==null)return l;l={memoizedState:nt,baseState:nt,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:nt},next:null};var h={};return l.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ma,lastRenderedState:h},next:null},o.memoizedState=l,o=o.alternate,o!==null&&(o.memoizedState=l),l}function av(o){var l=ov(o);l.next===null&&(l=o.alternate.memoizedState),rf(o,l.next.queue,{},dr())}function q1(){return Ks(Tf)}function lv(){return ps().memoizedState}function cv(){return ps().memoizedState}function mO(o){for(var l=o.return;l!==null;){switch(l.tag){case 24:case 3:var h=dr();o=wl(h);var m=Tl(l,o,h);m!==null&&(Hi(m,l,h),Jd(m,l,h)),l={cache:S1()},o.payload=l;return}l=l.return}}function gO(o,l,h){var m=dr();h={lane:m,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},L0(o)?hv(l,h):(h=c1(o,l,h,m),h!==null&&(Hi(h,o,m),dv(h,l,m)))}function uv(o,l,h){var m=dr();rf(o,l,h,m)}function rf(o,l,h,m){var b={lane:m,revertLane:0,gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null};if(L0(o))hv(l,b);else{var w=o.alternate;if(o.lanes===0&&(w===null||w.lanes===0)&&(w=l.lastRenderedReducer,w!==null))try{var E=l.lastRenderedState,V=w(E,h);if(b.hasEagerState=!0,b.eagerState=V,or(V,E))return f0(o,l,b,0),Tn===null&&d0(),!1}catch{}if(h=c1(o,l,b,m),h!==null)return Hi(h,o,m),dv(h,l,m),!0}return!1}function $1(o,l,h,m){if(m={lane:2,revertLane:Mb(),gesture:null,action:m,hasEagerState:!1,eagerState:null,next:null},L0(o)){if(l)throw Error(n(479))}else l=c1(o,h,m,2),l!==null&&Hi(l,o,2)}function L0(o){var l=o.alternate;return o===_e||l!==null&&l===_e}function hv(o,l){hh=A0=!0;var h=o.pending;h===null?l.next=l:(l.next=h.next,h.next=l),o.pending=l}function dv(o,l,h){if((h&4194048)!==0){var m=l.lanes;m&=o.pendingLanes,h|=m,l.lanes=h,Pd(o,h)}}var of={readContext:Ks,use:E0,useCallback:os,useContext:os,useEffect:os,useImperativeHandle:os,useLayoutEffect:os,useInsertionEffect:os,useMemo:os,useReducer:os,useRef:os,useState:os,useDebugValue:os,useDeferredValue:os,useTransition:os,useSyncExternalStore:os,useId:os,useHostTransitionStatus:os,useFormState:os,useActionState:os,useOptimistic:os,useMemoCache:os,useCacheRefresh:os};of.useEffectEvent=os;var fv={readContext:Ks,use:E0,useCallback:function(o,l){return _i().memoizedState=[o,l===void 0?null:l],o},useContext:Ks,useEffect:KM,useImperativeHandle:function(o,l,h){h=h!=null?h.concat([o]):null,B0(4194308,4,tv.bind(null,l,o),h)},useLayoutEffect:function(o,l){return B0(4194308,4,o,l)},useInsertionEffect:function(o,l){B0(4,2,o,l)},useMemo:function(o,l){var h=_i();l=l===void 0?null:l;var m=o();if(Zc){An(!0);try{o()}finally{An(!1)}}return h.memoizedState=[m,l],m},useReducer:function(o,l,h){var m=_i();if(h!==void 0){var b=h(l);if(Zc){An(!0);try{h(l)}finally{An(!1)}}}else b=l;return m.memoizedState=m.baseState=b,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:b},m.queue=o,o=o.dispatch=gO.bind(null,_e,o),[m.memoizedState,o]},useRef:function(o){var l=_i();return o={current:o},l.memoizedState=o},useState:function(o){o=I1(o);var l=o.queue,h=uv.bind(null,_e,l);return l.dispatch=h,[o.memoizedState,h]},useDebugValue:k1,useDeferredValue:function(o,l){var h=_i();return H1(h,o,l)},useTransition:function(){var o=I1(!1);return o=rv.bind(null,_e,o.queue,!0,!1),_i().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,l,h){var m=_e,b=_i();if(Ge){if(h===void 0)throw Error(n(407));h=h()}else{if(h=l(),Tn===null)throw Error(n(349));(Pe&127)!==0||OM(m,l,h)}b.memoizedState=h;var w={value:h,getSnapshot:l};return b.queue=w,KM(UM.bind(null,m,w,o),[o]),m.flags|=2048,fh(9,{destroy:void 0},FM.bind(null,m,w,h,l),null),h},useId:function(){var o=_i(),l=Tn.identifierPrefix;if(Ge){var h=Do,m=Bo;h=(m&~(1<<32-Ue(m)-1)).toString(32)+h,l="_"+l+"R_"+h,h=N0++,0<h&&(l+="H"+h.toString(32)),l+="_"}else h=cO++,l="_"+l+"r_"+h.toString(32)+"_";return o.memoizedState=l},useHostTransitionStatus:q1,useFormState:qM,useActionState:qM,useOptimistic:function(o){var l=_i();l.memoizedState=l.baseState=o;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return l.queue=h,l=$1.bind(null,_e,!0,h),h.dispatch=l,[o,l]},useMemoCache:U1,useCacheRefresh:function(){return _i().memoizedState=mO.bind(null,_e)},useEffectEvent:function(o){var l=_i(),h={impl:o};return l.memoizedState=h,function(){if((en&2)!==0)throw Error(n(440));return h.impl.apply(void 0,arguments)}}},X1={readContext:Ks,use:E0,useCallback:nv,useContext:Ks,useEffect:G1,useImperativeHandle:ev,useInsertionEffect:QM,useLayoutEffect:JM,useMemo:sv,useReducer:C0,useRef:YM,useState:function(){return C0(Ma)},useDebugValue:k1,useDeferredValue:function(o,l){var h=ps();return iv(h,mn.memoizedState,o,l)},useTransition:function(){var o=C0(Ma)[0],l=ps().memoizedState;return[typeof o=="boolean"?o:sf(o),l]},useSyncExternalStore:LM,useId:lv,useHostTransitionStatus:q1,useFormState:$M,useActionState:$M,useOptimistic:function(o,l){var h=ps();return IM(h,mn,o,l)},useMemoCache:U1,useCacheRefresh:cv};X1.useEffectEvent=ZM;var pv={readContext:Ks,use:E0,useCallback:nv,useContext:Ks,useEffect:G1,useImperativeHandle:ev,useInsertionEffect:QM,useLayoutEffect:JM,useMemo:sv,useReducer:z1,useRef:YM,useState:function(){return z1(Ma)},useDebugValue:k1,useDeferredValue:function(o,l){var h=ps();return mn===null?H1(h,o,l):iv(h,mn.memoizedState,o,l)},useTransition:function(){var o=z1(Ma)[0],l=ps().memoizedState;return[typeof o=="boolean"?o:sf(o),l]},useSyncExternalStore:LM,useId:lv,useHostTransitionStatus:q1,useFormState:jM,useActionState:jM,useOptimistic:function(o,l){var h=ps();return mn!==null?IM(h,mn,o,l):(h.baseState=o,[o,h.queue.dispatch])},useMemoCache:U1,useCacheRefresh:cv};pv.useEffectEvent=ZM;function j1(o,l,h,m){l=o.memoizedState,h=h(m,l),h=h==null?l:p({},l,h),o.memoizedState=h,o.lanes===0&&(o.updateQueue.baseState=h)}var Y1={enqueueSetState:function(o,l,h){o=o._reactInternals;var m=dr(),b=wl(m);b.payload=l,h!=null&&(b.callback=h),l=Tl(o,b,m),l!==null&&(Hi(l,o,m),Jd(l,o,m))},enqueueReplaceState:function(o,l,h){o=o._reactInternals;var m=dr(),b=wl(m);b.tag=1,b.payload=l,h!=null&&(b.callback=h),l=Tl(o,b,m),l!==null&&(Hi(l,o,m),Jd(l,o,m))},enqueueForceUpdate:function(o,l){o=o._reactInternals;var h=dr(),m=wl(h);m.tag=2,l!=null&&(m.callback=l),l=Tl(o,m,h),l!==null&&(Hi(l,o,h),Jd(l,o,h))}};function mv(o,l,h,m,b,w,E){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(m,w,E):l.prototype&&l.prototype.isPureReactComponent?!qd(h,m)||!qd(b,w):!0}function gv(o,l,h,m){o=l.state,typeof l.componentWillReceiveProps=="function"&&l.componentWillReceiveProps(h,m),typeof l.UNSAFE_componentWillReceiveProps=="function"&&l.UNSAFE_componentWillReceiveProps(h,m),l.state!==o&&Y1.enqueueReplaceState(l,l.state,null)}function Qc(o,l){var h=l;if("ref"in l){h={};for(var m in l)m!=="ref"&&(h[m]=l[m])}if(o=o.defaultProps){h===l&&(h=p({},h));for(var b in o)h[b]===void 0&&(h[b]=o[b])}return h}function yv(o){h0(o)}function xv(o){console.error(o)}function bv(o){h0(o)}function O0(o,l){try{var h=o.onUncaughtError;h(l.value,{componentStack:l.stack})}catch(m){setTimeout(function(){throw m})}}function Sv(o,l,h){try{var m=o.onCaughtError;m(h.value,{componentStack:h.stack,errorBoundary:l.tag===1?l.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function K1(o,l,h){return h=wl(h),h.tag=3,h.payload={element:null},h.callback=function(){O0(o,l)},h}function wv(o){return o=wl(o),o.tag=3,o}function Tv(o,l,h,m){var b=h.type.getDerivedStateFromError;if(typeof b=="function"){var w=m.value;o.payload=function(){return b(w)},o.callback=function(){Sv(l,h,m)}}var E=h.stateNode;E!==null&&typeof E.componentDidCatch=="function"&&(o.callback=function(){Sv(l,h,m),typeof b!="function"&&(Rl===null?Rl=new Set([this]):Rl.add(this));var V=m.stack;this.componentDidCatch(m.value,{componentStack:V!==null?V:""})})}function yO(o,l,h,m,b){if(h.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){if(l=h.alternate,l!==null&&rh(l,h,b,!0),h=lr.current,h!==null){switch(h.tag){case 31:case 13:return zr===null?$0():h.alternate===null&&as===0&&(as=3),h.flags&=-257,h.flags|=65536,h.lanes=b,m===w0?h.flags|=16384:(l=h.updateQueue,l===null?h.updateQueue=new Set([m]):l.add(m),wb(o,m,b)),!1;case 22:return h.flags|=65536,m===w0?h.flags|=16384:(l=h.updateQueue,l===null?(l={transitions:null,markerInstances:null,retryQueue:new Set([m])},h.updateQueue=l):(h=l.retryQueue,h===null?l.retryQueue=new Set([m]):h.add(m)),wb(o,m,b)),!1}throw Error(n(435,h.tag))}return wb(o,m,b),$0(),!1}if(Ge)return l=lr.current,l!==null?((l.flags&65536)===0&&(l.flags|=256),l.flags|=65536,l.lanes=b,m!==m1&&(o=Error(n(422),{cause:m}),jd(Or(o,h)))):(m!==m1&&(l=Error(n(423),{cause:m}),jd(Or(l,h))),o=o.current.alternate,o.flags|=65536,b&=-b,o.lanes|=b,m=Or(m,h),b=K1(o.stateNode,m,b),A1(o,b),as!==4&&(as=2)),!1;var w=Error(n(520),{cause:m});if(w=Or(w,h),pf===null?pf=[w]:pf.push(w),as!==4&&(as=2),l===null)return!0;m=Or(m,h),h=l;do{switch(h.tag){case 3:return h.flags|=65536,o=b&-b,h.lanes|=o,o=K1(h.stateNode,m,o),A1(h,o),!1;case 1:if(l=h.type,w=h.stateNode,(h.flags&128)===0&&(typeof l.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Rl===null||!Rl.has(w))))return h.flags|=65536,b&=-b,h.lanes|=b,b=wv(b),Tv(b,o,h,m),A1(h,b),!1}h=h.return}while(h!==null);return!1}var Z1=Error(n(461)),_s=!1;function Zs(o,l,h,m){l.child=o===null?AM(l,null,h,m):Kc(l,o.child,h,m)}function _v(o,l,h,m,b){h=h.render;var w=l.ref;if("ref"in m){var E={};for(var V in m)V!=="ref"&&(E[V]=m[V])}else E=m;return $c(l),m=D1(o,l,h,E,w,b),V=L1(),o!==null&&!_s?(O1(o,l,b),va(o,l,b)):(Ge&&V&&f1(l),l.flags|=1,Zs(o,l,m,b),l.child)}function Mv(o,l,h,m,b){if(o===null){var w=h.type;return typeof w=="function"&&!u1(w)&&w.defaultProps===void 0&&h.compare===null?(l.tag=15,l.type=w,vv(o,l,w,m,b)):(o=m0(h.type,null,m,l,l.mode,b),o.ref=l.ref,o.return=l,l.child=o)}if(w=o.child,!rb(o,b)){var E=w.memoizedProps;if(h=h.compare,h=h!==null?h:qd,h(E,m)&&o.ref===l.ref)return va(o,l,b)}return l.flags|=1,o=ba(w,m),o.ref=l.ref,o.return=l,l.child=o}function vv(o,l,h,m,b){if(o!==null){var w=o.memoizedProps;if(qd(w,m)&&o.ref===l.ref)if(_s=!1,l.pendingProps=m=w,rb(o,b))(o.flags&131072)!==0&&(_s=!0);else return l.lanes=o.lanes,va(o,l,b)}return Q1(o,l,h,m,b)}function Av(o,l,h,m){var b=m.children,w=o!==null?o.memoizedState:null;if(o===null&&l.stateNode===null&&(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.mode==="hidden"){if((l.flags&128)!==0){if(w=w!==null?w.baseLanes|h:h,o!==null){for(m=l.child=o.child,b=0;m!==null;)b=b|m.lanes|m.childLanes,m=m.sibling;m=b&~w}else m=0,l.child=null;return Nv(o,l,w,h,m)}if((h&536870912)!==0)l.memoizedState={baseLanes:0,cachePool:null},o!==null&&b0(l,w!==null?w.cachePool:null),w!==null?EM(l,w):R1(),CM(l);else return m=l.lanes=536870912,Nv(o,l,w!==null?w.baseLanes|h:h,h,m)}else w!==null?(b0(l,w.cachePool),EM(l,w),Ml(),l.memoizedState=null):(o!==null&&b0(l,null),R1(),Ml());return Zs(o,l,b,h),l.child}function af(o,l){return o!==null&&o.tag===22||l.stateNode!==null||(l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),l.sibling}function Nv(o,l,h,m,b){var w=T1();return w=w===null?null:{parent:ws._currentValue,pool:w},l.memoizedState={baseLanes:h,cachePool:w},o!==null&&b0(l,null),R1(),CM(l),o!==null&&rh(o,l,m,!0),l.childLanes=b,null}function F0(o,l){return l=P0({mode:l.mode,children:l.children},o.mode),l.ref=o.ref,o.child=l,l.return=o,l}function Rv(o,l,h){return Kc(l,o.child,null,h),o=F0(l,l.pendingProps),o.flags|=2,cr(l),l.memoizedState=null,o}function xO(o,l,h){var m=l.pendingProps,b=(l.flags&128)!==0;if(l.flags&=-129,o===null){if(Ge){if(m.mode==="hidden")return o=F0(l,m),l.lanes=536870912,af(null,o);if(C1(l),(o=Dn)?(o=VA(o,Pr),o=o!==null&&o.data==="&"?o:null,o!==null&&(l.memoizedState={dehydrated:o,treeContext:gl!==null?{id:Bo,overflow:Do}:null,retryLane:536870912,hydrationErrors:null},h=hM(o),h.return=l,l.child=h,Ys=l,Dn=null)):o=null,o===null)throw xl(l);return l.lanes=536870912,null}return F0(l,m)}var w=o.memoizedState;if(w!==null){var E=w.dehydrated;if(C1(l),b)if(l.flags&256)l.flags&=-257,l=Rv(o,l,h);else if(l.memoizedState!==null)l.child=o.child,l.flags|=128,l=null;else throw Error(n(558));else if(_s||rh(o,l,h,!1),b=(h&o.childLanes)!==0,_s||b){if(m=Tn,m!==null&&(E=Xs(m,h),E!==0&&E!==w.retryLane))throw w.retryLane=E,kc(o,E),Hi(m,o,E),Z1;$0(),l=Rv(o,l,h)}else o=w.treeContext,Dn=Ir(E.nextSibling),Ys=l,Ge=!0,yl=null,Pr=!1,o!==null&&pM(l,o),l=F0(l,m),l.flags|=4096;return l}return o=ba(o.child,{mode:m.mode,children:m.children}),o.ref=l.ref,l.child=o,o.return=l,o}function U0(o,l){var h=l.ref;if(h===null)o!==null&&o.ref!==null&&(l.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(n(284));(o===null||o.ref!==h)&&(l.flags|=4194816)}}function Q1(o,l,h,m,b){return $c(l),h=D1(o,l,h,m,void 0,b),m=L1(),o!==null&&!_s?(O1(o,l,b),va(o,l,b)):(Ge&&m&&f1(l),l.flags|=1,Zs(o,l,h,b),l.child)}function Ev(o,l,h,m,b,w){return $c(l),l.updateQueue=null,h=DM(l,m,h,b),BM(o),m=L1(),o!==null&&!_s?(O1(o,l,w),va(o,l,w)):(Ge&&m&&f1(l),l.flags|=1,Zs(o,l,h,w),l.child)}function Cv(o,l,h,m,b){if($c(l),l.stateNode===null){var w=eh,E=h.contextType;typeof E=="object"&&E!==null&&(w=Ks(E)),w=new h(m,w),l.memoizedState=w.state!==null&&w.state!==void 0?w.state:null,w.updater=Y1,l.stateNode=w,w._reactInternals=l,w=l.stateNode,w.props=m,w.state=l.memoizedState,w.refs={},M1(l),E=h.contextType,w.context=typeof E=="object"&&E!==null?Ks(E):eh,w.state=l.memoizedState,E=h.getDerivedStateFromProps,typeof E=="function"&&(j1(l,h,E,m),w.state=l.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof w.getSnapshotBeforeUpdate=="function"||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(E=w.state,typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount(),E!==w.state&&Y1.enqueueReplaceState(w,w.state,null),ef(l,m,w,b),tf(),w.state=l.memoizedState),typeof w.componentDidMount=="function"&&(l.flags|=4194308),m=!0}else if(o===null){w=l.stateNode;var V=l.memoizedProps,ot=Qc(h,V);w.props=ot;var Nt=w.context,Lt=h.contextType;E=eh,typeof Lt=="object"&&Lt!==null&&(E=Ks(Lt));var Pt=h.getDerivedStateFromProps;Lt=typeof Pt=="function"||typeof w.getSnapshotBeforeUpdate=="function",V=l.pendingProps!==V,Lt||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(V||Nt!==E)&&gv(l,w,m,E),Sl=!1;var Rt=l.memoizedState;w.state=Rt,ef(l,m,w,b),tf(),Nt=l.memoizedState,V||Rt!==Nt||Sl?(typeof Pt=="function"&&(j1(l,h,Pt,m),Nt=l.memoizedState),(ot=Sl||mv(l,h,ot,m,Rt,Nt,E))?(Lt||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(l.flags|=4194308)):(typeof w.componentDidMount=="function"&&(l.flags|=4194308),l.memoizedProps=m,l.memoizedState=Nt),w.props=m,w.state=Nt,w.context=E,m=ot):(typeof w.componentDidMount=="function"&&(l.flags|=4194308),m=!1)}else{w=l.stateNode,v1(o,l),E=l.memoizedProps,Lt=Qc(h,E),w.props=Lt,Pt=l.pendingProps,Rt=w.context,Nt=h.contextType,ot=eh,typeof Nt=="object"&&Nt!==null&&(ot=Ks(Nt)),V=h.getDerivedStateFromProps,(Nt=typeof V=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(E!==Pt||Rt!==ot)&&gv(l,w,m,ot),Sl=!1,Rt=l.memoizedState,w.state=Rt,ef(l,m,w,b),tf();var Et=l.memoizedState;E!==Pt||Rt!==Et||Sl||o!==null&&o.dependencies!==null&&y0(o.dependencies)?(typeof V=="function"&&(j1(l,h,V,m),Et=l.memoizedState),(Lt=Sl||mv(l,h,Lt,m,Rt,Et,ot)||o!==null&&o.dependencies!==null&&y0(o.dependencies))?(Nt||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(m,Et,ot),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(m,Et,ot)),typeof w.componentDidUpdate=="function"&&(l.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(l.flags|=1024)):(typeof w.componentDidUpdate!="function"||E===o.memoizedProps&&Rt===o.memoizedState||(l.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||E===o.memoizedProps&&Rt===o.memoizedState||(l.flags|=1024),l.memoizedProps=m,l.memoizedState=Et),w.props=m,w.state=Et,w.context=ot,m=Lt):(typeof w.componentDidUpdate!="function"||E===o.memoizedProps&&Rt===o.memoizedState||(l.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||E===o.memoizedProps&&Rt===o.memoizedState||(l.flags|=1024),m=!1)}return w=m,U0(o,l),m=(l.flags&128)!==0,w||m?(w=l.stateNode,h=m&&typeof h.getDerivedStateFromError!="function"?null:w.render(),l.flags|=1,o!==null&&m?(l.child=Kc(l,o.child,null,b),l.child=Kc(l,null,h,b)):Zs(o,l,h,b),l.memoizedState=w.state,o=l.child):o=va(o,l,b),o}function Bv(o,l,h,m){return Wc(),l.flags|=256,Zs(o,l,h,m),l.child}var J1={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function tb(o){return{baseLanes:o,cachePool:SM()}}function eb(o,l,h){return o=o!==null?o.childLanes&~h:0,l&&(o|=hr),o}function Dv(o,l,h){var m=l.pendingProps,b=!1,w=(l.flags&128)!==0,E;if((E=w)||(E=o!==null&&o.memoizedState===null?!1:(fs.current&2)!==0),E&&(b=!0,l.flags&=-129),E=(l.flags&32)!==0,l.flags&=-33,o===null){if(Ge){if(b?_l(l):Ml(),(o=Dn)?(o=VA(o,Pr),o=o!==null&&o.data!=="&"?o:null,o!==null&&(l.memoizedState={dehydrated:o,treeContext:gl!==null?{id:Bo,overflow:Do}:null,retryLane:536870912,hydrationErrors:null},h=hM(o),h.return=l,l.child=h,Ys=l,Dn=null)):o=null,o===null)throw xl(l);return Pb(o)?l.lanes=32:l.lanes=536870912,null}var V=m.children;return m=m.fallback,b?(Ml(),b=l.mode,V=P0({mode:"hidden",children:V},b),m=Hc(m,b,h,null),V.return=l,m.return=l,V.sibling=m,l.child=V,m=l.child,m.memoizedState=tb(h),m.childLanes=eb(o,E,h),l.memoizedState=J1,af(null,m)):(_l(l),nb(l,V))}var ot=o.memoizedState;if(ot!==null&&(V=ot.dehydrated,V!==null)){if(w)l.flags&256?(_l(l),l.flags&=-257,l=sb(o,l,h)):l.memoizedState!==null?(Ml(),l.child=o.child,l.flags|=128,l=null):(Ml(),V=m.fallback,b=l.mode,m=P0({mode:"visible",children:m.children},b),V=Hc(V,b,h,null),V.flags|=2,m.return=l,V.return=l,m.sibling=V,l.child=m,Kc(l,o.child,null,h),m=l.child,m.memoizedState=tb(h),m.childLanes=eb(o,E,h),l.memoizedState=J1,l=af(null,m));else if(_l(l),Pb(V)){if(E=V.nextSibling&&V.nextSibling.dataset,E)var Nt=E.dgst;E=Nt,m=Error(n(419)),m.stack="",m.digest=E,jd({value:m,source:null,stack:null}),l=sb(o,l,h)}else if(_s||rh(o,l,h,!1),E=(h&o.childLanes)!==0,_s||E){if(E=Tn,E!==null&&(m=Xs(E,h),m!==0&&m!==ot.retryLane))throw ot.retryLane=m,kc(o,m),Hi(E,o,m),Z1;Ub(V)||$0(),l=sb(o,l,h)}else Ub(V)?(l.flags|=192,l.child=o.child,l=null):(o=ot.treeContext,Dn=Ir(V.nextSibling),Ys=l,Ge=!0,yl=null,Pr=!1,o!==null&&pM(l,o),l=nb(l,m.children),l.flags|=4096);return l}return b?(Ml(),V=m.fallback,b=l.mode,ot=o.child,Nt=ot.sibling,m=ba(ot,{mode:"hidden",children:m.children}),m.subtreeFlags=ot.subtreeFlags&65011712,Nt!==null?V=ba(Nt,V):(V=Hc(V,b,h,null),V.flags|=2),V.return=l,m.return=l,m.sibling=V,l.child=m,af(null,m),m=l.child,V=o.child.memoizedState,V===null?V=tb(h):(b=V.cachePool,b!==null?(ot=ws._currentValue,b=b.parent!==ot?{parent:ot,pool:ot}:b):b=SM(),V={baseLanes:V.baseLanes|h,cachePool:b}),m.memoizedState=V,m.childLanes=eb(o,E,h),l.memoizedState=J1,af(o.child,m)):(_l(l),h=o.child,o=h.sibling,h=ba(h,{mode:"visible",children:m.children}),h.return=l,h.sibling=null,o!==null&&(E=l.deletions,E===null?(l.deletions=[o],l.flags|=16):E.push(o)),l.child=h,l.memoizedState=null,h)}function nb(o,l){return l=P0({mode:"visible",children:l},o.mode),l.return=o,o.child=l}function P0(o,l){return o=ar(22,o,null,l),o.lanes=0,o}function sb(o,l,h){return Kc(l,o.child,null,h),o=nb(l,l.pendingProps.children),o.flags|=2,l.memoizedState=null,o}function Lv(o,l,h){o.lanes|=l;var m=o.alternate;m!==null&&(m.lanes|=l),x1(o.return,l,h)}function ib(o,l,h,m,b,w){var E=o.memoizedState;E===null?o.memoizedState={isBackwards:l,rendering:null,renderingStartTime:0,last:m,tail:h,tailMode:b,treeForkCount:w}:(E.isBackwards=l,E.rendering=null,E.renderingStartTime=0,E.last=m,E.tail=h,E.tailMode=b,E.treeForkCount=w)}function Ov(o,l,h){var m=l.pendingProps,b=m.revealOrder,w=m.tail;m=m.children;var E=fs.current,V=(E&2)!==0;if(V?(E=E&1|2,l.flags|=128):E&=1,L(fs,E),Zs(o,l,m,h),m=Ge?Xd:0,!V&&o!==null&&(o.flags&128)!==0)t:for(o=l.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&Lv(o,h,l);else if(o.tag===19)Lv(o,h,l);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===l)break t;for(;o.sibling===null;){if(o.return===null||o.return===l)break t;o=o.return}o.sibling.return=o.return,o=o.sibling}switch(b){case"forwards":for(h=l.child,b=null;h!==null;)o=h.alternate,o!==null&&v0(o)===null&&(b=h),h=h.sibling;h=b,h===null?(b=l.child,l.child=null):(b=h.sibling,h.sibling=null),ib(l,!1,b,h,w,m);break;case"backwards":case"unstable_legacy-backwards":for(h=null,b=l.child,l.child=null;b!==null;){if(o=b.alternate,o!==null&&v0(o)===null){l.child=b;break}o=b.sibling,b.sibling=h,h=b,b=o}ib(l,!0,h,null,w,m);break;case"together":ib(l,!1,null,null,void 0,m);break;default:l.memoizedState=null}return l.child}function va(o,l,h){if(o!==null&&(l.dependencies=o.dependencies),Nl|=l.lanes,(h&l.childLanes)===0)if(o!==null){if(rh(o,l,h,!1),(h&l.childLanes)===0)return null}else return null;if(o!==null&&l.child!==o.child)throw Error(n(153));if(l.child!==null){for(o=l.child,h=ba(o,o.pendingProps),l.child=h,h.return=l;o.sibling!==null;)o=o.sibling,h=h.sibling=ba(o,o.pendingProps),h.return=l;h.sibling=null}return l.child}function rb(o,l){return(o.lanes&l)!==0?!0:(o=o.dependencies,!!(o!==null&&y0(o)))}function bO(o,l,h){switch(l.tag){case 3:rt(l,l.stateNode.containerInfo),bl(l,ws,o.memoizedState.cache),Wc();break;case 27:case 5:ct(l);break;case 4:rt(l,l.stateNode.containerInfo);break;case 10:bl(l,l.type,l.memoizedProps.value);break;case 31:if(l.memoizedState!==null)return l.flags|=128,C1(l),null;break;case 13:var m=l.memoizedState;if(m!==null)return m.dehydrated!==null?(_l(l),l.flags|=128,null):(h&l.child.childLanes)!==0?Dv(o,l,h):(_l(l),o=va(o,l,h),o!==null?o.sibling:null);_l(l);break;case 19:var b=(o.flags&128)!==0;if(m=(h&l.childLanes)!==0,m||(rh(o,l,h,!1),m=(h&l.childLanes)!==0),b){if(m)return Ov(o,l,h);l.flags|=128}if(b=l.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),L(fs,fs.current),m)break;return null;case 22:return l.lanes=0,Av(o,l,h,l.pendingProps);case 24:bl(l,ws,o.memoizedState.cache)}return va(o,l,h)}function Fv(o,l,h){if(o!==null)if(o.memoizedProps!==l.pendingProps)_s=!0;else{if(!rb(o,h)&&(l.flags&128)===0)return _s=!1,bO(o,l,h);_s=(o.flags&131072)!==0}else _s=!1,Ge&&(l.flags&1048576)!==0&&fM(l,Xd,l.index);switch(l.lanes=0,l.tag){case 16:t:{var m=l.pendingProps;if(o=jc(l.elementType),l.type=o,typeof o=="function")u1(o)?(m=Qc(o,m),l.tag=1,l=Cv(null,l,o,m,h)):(l.tag=0,l=Q1(null,l,o,m,h));else{if(o!=null){var b=o.$$typeof;if(b===A){l.tag=11,l=_v(null,l,o,m,h);break t}else if(b===D){l.tag=14,l=Mv(null,l,o,m,h);break t}}throw l=wt(o)||o,Error(n(306,l,""))}}return l;case 0:return Q1(o,l,l.type,l.pendingProps,h);case 1:return m=l.type,b=Qc(m,l.pendingProps),Cv(o,l,m,b,h);case 3:t:{if(rt(l,l.stateNode.containerInfo),o===null)throw Error(n(387));m=l.pendingProps;var w=l.memoizedState;b=w.element,v1(o,l),ef(l,m,null,h);var E=l.memoizedState;if(m=E.cache,bl(l,ws,m),m!==w.cache&&b1(l,[ws],h,!0),tf(),m=E.element,w.isDehydrated)if(w={element:m,isDehydrated:!1,cache:E.cache},l.updateQueue.baseState=w,l.memoizedState=w,l.flags&256){l=Bv(o,l,m,h);break t}else if(m!==b){b=Or(Error(n(424)),l),jd(b),l=Bv(o,l,m,h);break t}else for(o=l.stateNode.containerInfo,o.nodeType===9?o=o.body:o=o.nodeName==="HTML"?o.ownerDocument.body:o,Dn=Ir(o.firstChild),Ys=l,Ge=!0,yl=null,Pr=!0,h=AM(l,null,m,h),l.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling;else{if(Wc(),m===b){l=va(o,l,h);break t}Zs(o,l,m,h)}l=l.child}return l;case 26:return U0(o,l),o===null?(h=$A(l.type,null,l.pendingProps,null))?l.memoizedState=h:Ge||(h=l.type,o=l.pendingProps,m=J0(W.current).createElement(h),m[Kn]=l,m[Ss]=o,Qs(m,h,o),wn(m),l.stateNode=m):l.memoizedState=$A(l.type,o.memoizedProps,l.pendingProps,o.memoizedState),null;case 27:return ct(l),o===null&&Ge&&(m=l.stateNode=HA(l.type,l.pendingProps,W.current),Ys=l,Pr=!0,b=Dn,Dl(l.type)?(zb=b,Dn=Ir(m.firstChild)):Dn=b),Zs(o,l,l.pendingProps.children,h),U0(o,l),o===null&&(l.flags|=4194304),l.child;case 5:return o===null&&Ge&&((b=m=Dn)&&(m=YO(m,l.type,l.pendingProps,Pr),m!==null?(l.stateNode=m,Ys=l,Dn=Ir(m.firstChild),Pr=!1,b=!0):b=!1),b||xl(l)),ct(l),b=l.type,w=l.pendingProps,E=o!==null?o.memoizedProps:null,m=w.children,Lb(b,w)?m=null:E!==null&&Lb(b,E)&&(l.flags|=32),l.memoizedState!==null&&(b=D1(o,l,uO,null,null,h),Tf._currentValue=b),U0(o,l),Zs(o,l,m,h),l.child;case 6:return o===null&&Ge&&((o=h=Dn)&&(h=KO(h,l.pendingProps,Pr),h!==null?(l.stateNode=h,Ys=l,Dn=null,o=!0):o=!1),o||xl(l)),null;case 13:return Dv(o,l,h);case 4:return rt(l,l.stateNode.containerInfo),m=l.pendingProps,o===null?l.child=Kc(l,null,m,h):Zs(o,l,m,h),l.child;case 11:return _v(o,l,l.type,l.pendingProps,h);case 7:return Zs(o,l,l.pendingProps,h),l.child;case 8:return Zs(o,l,l.pendingProps.children,h),l.child;case 12:return Zs(o,l,l.pendingProps.children,h),l.child;case 10:return m=l.pendingProps,bl(l,l.type,m.value),Zs(o,l,m.children,h),l.child;case 9:return b=l.type._context,m=l.pendingProps.children,$c(l),b=Ks(b),m=m(b),l.flags|=1,Zs(o,l,m,h),l.child;case 14:return Mv(o,l,l.type,l.pendingProps,h);case 15:return vv(o,l,l.type,l.pendingProps,h);case 19:return Ov(o,l,h);case 31:return xO(o,l,h);case 22:return Av(o,l,h,l.pendingProps);case 24:return $c(l),m=Ks(ws),o===null?(b=T1(),b===null&&(b=Tn,w=S1(),b.pooledCache=w,w.refCount++,w!==null&&(b.pooledCacheLanes|=h),b=w),l.memoizedState={parent:m,cache:b},M1(l),bl(l,ws,b)):((o.lanes&h)!==0&&(v1(o,l),ef(l,null,null,h),tf()),b=o.memoizedState,w=l.memoizedState,b.parent!==m?(b={parent:m,cache:m},l.memoizedState=b,l.lanes===0&&(l.memoizedState=l.updateQueue.baseState=b),bl(l,ws,m)):(m=w.cache,bl(l,ws,m),m!==b.cache&&b1(l,[ws],h,!0))),Zs(o,l,l.pendingProps.children,h),l.child;case 29:throw l.pendingProps}throw Error(n(156,l.tag))}function Aa(o){o.flags|=4}function ob(o,l,h,m,b){if((l=(o.mode&32)!==0)&&(l=!1),l){if(o.flags|=16777216,(b&335544128)===b)if(o.stateNode.complete)o.flags|=8192;else if(lA())o.flags|=8192;else throw Yc=w0,_1}else o.flags&=-16777217}function Uv(o,l){if(l.type!=="stylesheet"||(l.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!ZA(l))if(lA())o.flags|=8192;else throw Yc=w0,_1}function z0(o,l){l!==null&&(o.flags|=4),o.flags&16384&&(l=o.tag!==22?io():536870912,o.lanes|=l,yh|=l)}function lf(o,l){if(!Ge)switch(o.tailMode){case"hidden":l=o.tail;for(var h=null;l!==null;)l.alternate!==null&&(h=l),l=l.sibling;h===null?o.tail=null:h.sibling=null;break;case"collapsed":h=o.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?l||o.tail===null?o.tail=null:o.tail.sibling=null:m.sibling=null}}function Ln(o){var l=o.alternate!==null&&o.alternate.child===o.child,h=0,m=0;if(l)for(var b=o.child;b!==null;)h|=b.lanes|b.childLanes,m|=b.subtreeFlags&65011712,m|=b.flags&65011712,b.return=o,b=b.sibling;else for(b=o.child;b!==null;)h|=b.lanes|b.childLanes,m|=b.subtreeFlags,m|=b.flags,b.return=o,b=b.sibling;return o.subtreeFlags|=m,o.childLanes=h,l}function SO(o,l,h){var m=l.pendingProps;switch(p1(l),l.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ln(l),null;case 1:return Ln(l),null;case 3:return h=l.stateNode,m=null,o!==null&&(m=o.memoizedState.cache),l.memoizedState.cache!==m&&(l.flags|=2048),Ta(ws),et(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(ih(l)?Aa(l):o===null||o.memoizedState.isDehydrated&&(l.flags&256)===0||(l.flags|=1024,g1())),Ln(l),null;case 26:var b=l.type,w=l.memoizedState;return o===null?(Aa(l),w!==null?(Ln(l),Uv(l,w)):(Ln(l),ob(l,b,null,m,h))):w?w!==o.memoizedState?(Aa(l),Ln(l),Uv(l,w)):(Ln(l),l.flags&=-16777217):(o=o.memoizedProps,o!==m&&Aa(l),Ln(l),ob(l,b,o,m,h)),null;case 27:if(st(l),h=W.current,b=l.type,o!==null&&l.stateNode!=null)o.memoizedProps!==m&&Aa(l);else{if(!m){if(l.stateNode===null)throw Error(n(166));return Ln(l),null}o=I.current,ih(l)?mM(l):(o=HA(b,m,h),l.stateNode=o,Aa(l))}return Ln(l),null;case 5:if(st(l),b=l.type,o!==null&&l.stateNode!=null)o.memoizedProps!==m&&Aa(l);else{if(!m){if(l.stateNode===null)throw Error(n(166));return Ln(l),null}if(w=I.current,ih(l))mM(l);else{var E=J0(W.current);switch(w){case 1:w=E.createElementNS("http://www.w3.org/2000/svg",b);break;case 2:w=E.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;default:switch(b){case"svg":w=E.createElementNS("http://www.w3.org/2000/svg",b);break;case"math":w=E.createElementNS("http://www.w3.org/1998/Math/MathML",b);break;case"script":w=E.createElement("div"),w.innerHTML="<script><\/script>",w=w.removeChild(w.firstChild);break;case"select":w=typeof m.is=="string"?E.createElement("select",{is:m.is}):E.createElement("select"),m.multiple?w.multiple=!0:m.size&&(w.size=m.size);break;default:w=typeof m.is=="string"?E.createElement(b,{is:m.is}):E.createElement(b)}}w[Kn]=l,w[Ss]=m;t:for(E=l.child;E!==null;){if(E.tag===5||E.tag===6)w.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===l)break t;for(;E.sibling===null;){if(E.return===null||E.return===l)break t;E=E.return}E.sibling.return=E.return,E=E.sibling}l.stateNode=w;t:switch(Qs(w,b,m),b){case"button":case"input":case"select":case"textarea":m=!!m.autoFocus;break t;case"img":m=!0;break t;default:m=!1}m&&Aa(l)}}return Ln(l),ob(l,l.type,o===null?null:o.memoizedProps,l.pendingProps,h),null;case 6:if(o&&l.stateNode!=null)o.memoizedProps!==m&&Aa(l);else{if(typeof m!="string"&&l.stateNode===null)throw Error(n(166));if(o=W.current,ih(l)){if(o=l.stateNode,h=l.memoizedProps,m=null,b=Ys,b!==null)switch(b.tag){case 27:case 5:m=b.memoizedProps}o[Kn]=l,o=!!(o.nodeValue===h||m!==null&&m.suppressHydrationWarning===!0||DA(o.nodeValue,h)),o||xl(l,!0)}else o=J0(o).createTextNode(m),o[Kn]=l,l.stateNode=o}return Ln(l),null;case 31:if(h=l.memoizedState,o===null||o.memoizedState!==null){if(m=ih(l),h!==null){if(o===null){if(!m)throw Error(n(318));if(o=l.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(557));o[Kn]=l}else Wc(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Ln(l),o=!1}else h=g1(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=h),o=!0;if(!o)return l.flags&256?(cr(l),l):(cr(l),null);if((l.flags&128)!==0)throw Error(n(558))}return Ln(l),null;case 13:if(m=l.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(b=ih(l),m!==null&&m.dehydrated!==null){if(o===null){if(!b)throw Error(n(318));if(b=l.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(n(317));b[Kn]=l}else Wc(),(l.flags&128)===0&&(l.memoizedState=null),l.flags|=4;Ln(l),b=!1}else b=g1(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=b),b=!0;if(!b)return l.flags&256?(cr(l),l):(cr(l),null)}return cr(l),(l.flags&128)!==0?(l.lanes=h,l):(h=m!==null,o=o!==null&&o.memoizedState!==null,h&&(m=l.child,b=null,m.alternate!==null&&m.alternate.memoizedState!==null&&m.alternate.memoizedState.cachePool!==null&&(b=m.alternate.memoizedState.cachePool.pool),w=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(w=m.memoizedState.cachePool.pool),w!==b&&(m.flags|=2048)),h!==o&&h&&(l.child.flags|=8192),z0(l,l.updateQueue),Ln(l),null);case 4:return et(),o===null&&Rb(l.stateNode.containerInfo),Ln(l),null;case 10:return Ta(l.type),Ln(l),null;case 19:if(q(fs),m=l.memoizedState,m===null)return Ln(l),null;if(b=(l.flags&128)!==0,w=m.rendering,w===null)if(b)lf(m,!1);else{if(as!==0||o!==null&&(o.flags&128)!==0)for(o=l.child;o!==null;){if(w=v0(o),w!==null){for(l.flags|=128,lf(m,!1),o=w.updateQueue,l.updateQueue=o,z0(l,o),l.subtreeFlags=0,o=h,h=l.child;h!==null;)uM(h,o),h=h.sibling;return L(fs,fs.current&1|2),Ge&&Sa(l,m.treeForkCount),l.child}o=o.sibling}m.tail!==null&&Yt()>H0&&(l.flags|=128,b=!0,lf(m,!1),l.lanes=4194304)}else{if(!b)if(o=v0(w),o!==null){if(l.flags|=128,b=!0,o=o.updateQueue,l.updateQueue=o,z0(l,o),lf(m,!0),m.tail===null&&m.tailMode==="hidden"&&!w.alternate&&!Ge)return Ln(l),null}else 2*Yt()-m.renderingStartTime>H0&&h!==536870912&&(l.flags|=128,b=!0,lf(m,!1),l.lanes=4194304);m.isBackwards?(w.sibling=l.child,l.child=w):(o=m.last,o!==null?o.sibling=w:l.child=w,m.last=w)}return m.tail!==null?(o=m.tail,m.rendering=o,m.tail=o.sibling,m.renderingStartTime=Yt(),o.sibling=null,h=fs.current,L(fs,b?h&1|2:h&1),Ge&&Sa(l,m.treeForkCount),o):(Ln(l),null);case 22:case 23:return cr(l),E1(),m=l.memoizedState!==null,o!==null?o.memoizedState!==null!==m&&(l.flags|=8192):m&&(l.flags|=8192),m?(h&536870912)!==0&&(l.flags&128)===0&&(Ln(l),l.subtreeFlags&6&&(l.flags|=8192)):Ln(l),h=l.updateQueue,h!==null&&z0(l,h.retryQueue),h=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),m=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(m=l.memoizedState.cachePool.pool),m!==h&&(l.flags|=2048),o!==null&&q(Xc),null;case 24:return h=null,o!==null&&(h=o.memoizedState.cache),l.memoizedState.cache!==h&&(l.flags|=2048),Ta(ws),Ln(l),null;case 25:return null;case 30:return null}throw Error(n(156,l.tag))}function wO(o,l){switch(p1(l),l.tag){case 1:return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 3:return Ta(ws),et(),o=l.flags,(o&65536)!==0&&(o&128)===0?(l.flags=o&-65537|128,l):null;case 26:case 27:case 5:return st(l),null;case 31:if(l.memoizedState!==null){if(cr(l),l.alternate===null)throw Error(n(340));Wc()}return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 13:if(cr(l),o=l.memoizedState,o!==null&&o.dehydrated!==null){if(l.alternate===null)throw Error(n(340));Wc()}return o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 19:return q(fs),null;case 4:return et(),null;case 10:return Ta(l.type),null;case 22:case 23:return cr(l),E1(),o!==null&&q(Xc),o=l.flags,o&65536?(l.flags=o&-65537|128,l):null;case 24:return Ta(ws),null;case 25:return null;default:return null}}function Pv(o,l){switch(p1(l),l.tag){case 3:Ta(ws),et();break;case 26:case 27:case 5:st(l);break;case 4:et();break;case 31:l.memoizedState!==null&&cr(l);break;case 13:cr(l);break;case 19:q(fs);break;case 10:Ta(l.type);break;case 22:case 23:cr(l),E1(),o!==null&&q(Xc);break;case 24:Ta(ws)}}function cf(o,l){try{var h=l.updateQueue,m=h!==null?h.lastEffect:null;if(m!==null){var b=m.next;h=b;do{if((h.tag&o)===o){m=void 0;var w=h.create,E=h.inst;m=w(),E.destroy=m}h=h.next}while(h!==b)}}catch(V){hn(l,l.return,V)}}function vl(o,l,h){try{var m=l.updateQueue,b=m!==null?m.lastEffect:null;if(b!==null){var w=b.next;m=w;do{if((m.tag&o)===o){var E=m.inst,V=E.destroy;if(V!==void 0){E.destroy=void 0,b=l;var ot=h,Nt=V;try{Nt()}catch(Lt){hn(b,ot,Lt)}}}m=m.next}while(m!==w)}}catch(Lt){hn(l,l.return,Lt)}}function zv(o){var l=o.updateQueue;if(l!==null){var h=o.stateNode;try{RM(l,h)}catch(m){hn(o,o.return,m)}}}function Iv(o,l,h){h.props=Qc(o.type,o.memoizedProps),h.state=o.memoizedState;try{h.componentWillUnmount()}catch(m){hn(o,l,m)}}function uf(o,l){try{var h=o.ref;if(h!==null){switch(o.tag){case 26:case 27:case 5:var m=o.stateNode;break;case 30:m=o.stateNode;break;default:m=o.stateNode}typeof h=="function"?o.refCleanup=h(m):h.current=m}}catch(b){hn(o,l,b)}}function Lo(o,l){var h=o.ref,m=o.refCleanup;if(h!==null)if(typeof m=="function")try{m()}catch(b){hn(o,l,b)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(b){hn(o,l,b)}else h.current=null}function Vv(o){var l=o.type,h=o.memoizedProps,m=o.stateNode;try{t:switch(l){case"button":case"input":case"select":case"textarea":h.autoFocus&&m.focus();break t;case"img":h.src?m.src=h.src:h.srcSet&&(m.srcset=h.srcSet)}}catch(b){hn(o,o.return,b)}}function ab(o,l,h){try{var m=o.stateNode;HO(m,o.type,h,l),m[Ss]=l}catch(b){hn(o,o.return,b)}}function Gv(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&Dl(o.type)||o.tag===4}function lb(o){t:for(;;){for(;o.sibling===null;){if(o.return===null||Gv(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&Dl(o.type)||o.flags&2||o.child===null||o.tag===4)continue t;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function cb(o,l,h){var m=o.tag;if(m===5||m===6)o=o.stateNode,l?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(o,l):(l=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,l.appendChild(o),h=h._reactRootContainer,h!=null||l.onclick!==null||(l.onclick=ya));else if(m!==4&&(m===27&&Dl(o.type)&&(h=o.stateNode,l=null),o=o.child,o!==null))for(cb(o,l,h),o=o.sibling;o!==null;)cb(o,l,h),o=o.sibling}function I0(o,l,h){var m=o.tag;if(m===5||m===6)o=o.stateNode,l?h.insertBefore(o,l):h.appendChild(o);else if(m!==4&&(m===27&&Dl(o.type)&&(h=o.stateNode),o=o.child,o!==null))for(I0(o,l,h),o=o.sibling;o!==null;)I0(o,l,h),o=o.sibling}function kv(o){var l=o.stateNode,h=o.memoizedProps;try{for(var m=o.type,b=l.attributes;b.length;)l.removeAttributeNode(b[0]);Qs(l,m,h),l[Kn]=o,l[Ss]=h}catch(w){hn(o,o.return,w)}}var Na=!1,Ms=!1,ub=!1,Hv=typeof WeakSet=="function"?WeakSet:Set,Vs=null;function TO(o,l){if(o=o.containerInfo,Bb=om,o=eM(o),s1(o)){if("selectionStart"in o)var h={start:o.selectionStart,end:o.selectionEnd};else t:{h=(h=o.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&m.rangeCount!==0){h=m.anchorNode;var b=m.anchorOffset,w=m.focusNode;m=m.focusOffset;try{h.nodeType,w.nodeType}catch{h=null;break t}var E=0,V=-1,ot=-1,Nt=0,Lt=0,Pt=o,Rt=null;e:for(;;){for(var Et;Pt!==h||b!==0&&Pt.nodeType!==3||(V=E+b),Pt!==w||m!==0&&Pt.nodeType!==3||(ot=E+m),Pt.nodeType===3&&(E+=Pt.nodeValue.length),(Et=Pt.firstChild)!==null;)Rt=Pt,Pt=Et;for(;;){if(Pt===o)break e;if(Rt===h&&++Nt===b&&(V=E),Rt===w&&++Lt===m&&(ot=E),(Et=Pt.nextSibling)!==null)break;Pt=Rt,Rt=Pt.parentNode}Pt=Et}h=V===-1||ot===-1?null:{start:V,end:ot}}else h=null}h=h||{start:0,end:0}}else h=null;for(Db={focusedElem:o,selectionRange:h},om=!1,Vs=l;Vs!==null;)if(l=Vs,o=l.child,(l.subtreeFlags&1028)!==0&&o!==null)o.return=l,Vs=o;else for(;Vs!==null;){switch(l=Vs,w=l.alternate,o=l.flags,l.tag){case 0:if((o&4)!==0&&(o=l.updateQueue,o=o!==null?o.events:null,o!==null))for(h=0;h<o.length;h++)b=o[h],b.ref.impl=b.nextImpl;break;case 11:case 15:break;case 1:if((o&1024)!==0&&w!==null){o=void 0,h=l,b=w.memoizedProps,w=w.memoizedState,m=h.stateNode;try{var ne=Qc(h.type,b);o=m.getSnapshotBeforeUpdate(ne,w),m.__reactInternalSnapshotBeforeUpdate=o}catch(pe){hn(h,h.return,pe)}}break;case 3:if((o&1024)!==0){if(o=l.stateNode.containerInfo,h=o.nodeType,h===9)Fb(o);else if(h===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":Fb(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(n(163))}if(o=l.sibling,o!==null){o.return=l.return,Vs=o;break}Vs=l.return}}function Wv(o,l,h){var m=h.flags;switch(h.tag){case 0:case 11:case 15:Ea(o,h),m&4&&cf(5,h);break;case 1:if(Ea(o,h),m&4)if(o=h.stateNode,l===null)try{o.componentDidMount()}catch(E){hn(h,h.return,E)}else{var b=Qc(h.type,l.memoizedProps);l=l.memoizedState;try{o.componentDidUpdate(b,l,o.__reactInternalSnapshotBeforeUpdate)}catch(E){hn(h,h.return,E)}}m&64&&zv(h),m&512&&uf(h,h.return);break;case 3:if(Ea(o,h),m&64&&(o=h.updateQueue,o!==null)){if(l=null,h.child!==null)switch(h.child.tag){case 27:case 5:l=h.child.stateNode;break;case 1:l=h.child.stateNode}try{RM(o,l)}catch(E){hn(h,h.return,E)}}break;case 27:l===null&&m&4&&kv(h);case 26:case 5:Ea(o,h),l===null&&m&4&&Vv(h),m&512&&uf(h,h.return);break;case 12:Ea(o,h);break;case 31:Ea(o,h),m&4&&Xv(o,h);break;case 13:Ea(o,h),m&4&&jv(o,h),m&64&&(o=h.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(h=BO.bind(null,h),ZO(o,h))));break;case 22:if(m=h.memoizedState!==null||Na,!m){l=l!==null&&l.memoizedState!==null||Ms,b=Na;var w=Ms;Na=m,(Ms=l)&&!w?Ca(o,h,(h.subtreeFlags&8772)!==0):Ea(o,h),Na=b,Ms=w}break;case 30:break;default:Ea(o,h)}}function qv(o){var l=o.alternate;l!==null&&(o.alternate=null,qv(l)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(l=o.stateNode,l!==null&&ma(l)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var In=null,Ii=!1;function Ra(o,l,h){for(h=h.child;h!==null;)$v(o,l,h),h=h.sibling}function $v(o,l,h){if(Ze&&typeof Ze.onCommitFiberUnmount=="function")try{Ze.onCommitFiberUnmount(be,h)}catch{}switch(h.tag){case 26:Ms||Lo(h,l),Ra(o,l,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:Ms||Lo(h,l);var m=In,b=Ii;Dl(h.type)&&(In=h.stateNode,Ii=!1),Ra(o,l,h),bf(h.stateNode),In=m,Ii=b;break;case 5:Ms||Lo(h,l);case 6:if(m=In,b=Ii,In=null,Ra(o,l,h),In=m,Ii=b,In!==null)if(Ii)try{(In.nodeType===9?In.body:In.nodeName==="HTML"?In.ownerDocument.body:In).removeChild(h.stateNode)}catch(w){hn(h,l,w)}else try{In.removeChild(h.stateNode)}catch(w){hn(h,l,w)}break;case 18:In!==null&&(Ii?(o=In,zA(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,h.stateNode),vh(o)):zA(In,h.stateNode));break;case 4:m=In,b=Ii,In=h.stateNode.containerInfo,Ii=!0,Ra(o,l,h),In=m,Ii=b;break;case 0:case 11:case 14:case 15:vl(2,h,l),Ms||vl(4,h,l),Ra(o,l,h);break;case 1:Ms||(Lo(h,l),m=h.stateNode,typeof m.componentWillUnmount=="function"&&Iv(h,l,m)),Ra(o,l,h);break;case 21:Ra(o,l,h);break;case 22:Ms=(m=Ms)||h.memoizedState!==null,Ra(o,l,h),Ms=m;break;default:Ra(o,l,h)}}function Xv(o,l){if(l.memoizedState===null&&(o=l.alternate,o!==null&&(o=o.memoizedState,o!==null))){o=o.dehydrated;try{vh(o)}catch(h){hn(l,l.return,h)}}}function jv(o,l){if(l.memoizedState===null&&(o=l.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{vh(o)}catch(h){hn(l,l.return,h)}}function _O(o){switch(o.tag){case 31:case 13:case 19:var l=o.stateNode;return l===null&&(l=o.stateNode=new Hv),l;case 22:return o=o.stateNode,l=o._retryCache,l===null&&(l=o._retryCache=new Hv),l;default:throw Error(n(435,o.tag))}}function V0(o,l){var h=_O(o);l.forEach(function(m){if(!h.has(m)){h.add(m);var b=DO.bind(null,o,m);m.then(b,b)}})}function Vi(o,l){var h=l.deletions;if(h!==null)for(var m=0;m<h.length;m++){var b=h[m],w=o,E=l,V=E;t:for(;V!==null;){switch(V.tag){case 27:if(Dl(V.type)){In=V.stateNode,Ii=!1;break t}break;case 5:In=V.stateNode,Ii=!1;break t;case 3:case 4:In=V.stateNode.containerInfo,Ii=!0;break t}V=V.return}if(In===null)throw Error(n(160));$v(w,E,b),In=null,Ii=!1,w=b.alternate,w!==null&&(w.return=null),b.return=null}if(l.subtreeFlags&13886)for(l=l.child;l!==null;)Yv(l,o),l=l.sibling}var uo=null;function Yv(o,l){var h=o.alternate,m=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:Vi(l,o),Gi(o),m&4&&(vl(3,o,o.return),cf(3,o),vl(5,o,o.return));break;case 1:Vi(l,o),Gi(o),m&512&&(Ms||h===null||Lo(h,h.return)),m&64&&Na&&(o=o.updateQueue,o!==null&&(m=o.callbacks,m!==null&&(h=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=h===null?m:h.concat(m))));break;case 26:var b=uo;if(Vi(l,o),Gi(o),m&512&&(Ms||h===null||Lo(h,h.return)),m&4){var w=h!==null?h.memoizedState:null;if(m=o.memoizedState,h===null)if(m===null)if(o.stateNode===null){t:{m=o.type,h=o.memoizedProps,b=b.ownerDocument||b;e:switch(m){case"title":w=b.getElementsByTagName("title")[0],(!w||w[ao]||w[Kn]||w.namespaceURI==="http://www.w3.org/2000/svg"||w.hasAttribute("itemprop"))&&(w=b.createElement(m),b.head.insertBefore(w,b.querySelector("head > title"))),Qs(w,m,h),w[Kn]=o,wn(w),m=w;break t;case"link":var E=YA("link","href",b).get(m+(h.href||""));if(E){for(var V=0;V<E.length;V++)if(w=E[V],w.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&w.getAttribute("rel")===(h.rel==null?null:h.rel)&&w.getAttribute("title")===(h.title==null?null:h.title)&&w.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){E.splice(V,1);break e}}w=b.createElement(m),Qs(w,m,h),b.head.appendChild(w);break;case"meta":if(E=YA("meta","content",b).get(m+(h.content||""))){for(V=0;V<E.length;V++)if(w=E[V],w.getAttribute("content")===(h.content==null?null:""+h.content)&&w.getAttribute("name")===(h.name==null?null:h.name)&&w.getAttribute("property")===(h.property==null?null:h.property)&&w.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&w.getAttribute("charset")===(h.charSet==null?null:h.charSet)){E.splice(V,1);break e}}w=b.createElement(m),Qs(w,m,h),b.head.appendChild(w);break;default:throw Error(n(468,m))}w[Kn]=o,wn(w),m=w}o.stateNode=m}else KA(b,o.type,o.stateNode);else o.stateNode=jA(b,m,o.memoizedProps);else w!==m?(w===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):w.count--,m===null?KA(b,o.type,o.stateNode):jA(b,m,o.memoizedProps)):m===null&&o.stateNode!==null&&ab(o,o.memoizedProps,h.memoizedProps)}break;case 27:Vi(l,o),Gi(o),m&512&&(Ms||h===null||Lo(h,h.return)),h!==null&&m&4&&ab(o,o.memoizedProps,h.memoizedProps);break;case 5:if(Vi(l,o),Gi(o),m&512&&(Ms||h===null||Lo(h,h.return)),o.flags&32){b=o.stateNode;try{ju(b,"")}catch(ne){hn(o,o.return,ne)}}m&4&&o.stateNode!=null&&(b=o.memoizedProps,ab(o,b,h!==null?h.memoizedProps:b)),m&1024&&(ub=!0);break;case 6:if(Vi(l,o),Gi(o),m&4){if(o.stateNode===null)throw Error(n(162));m=o.memoizedProps,h=o.stateNode;try{h.nodeValue=m}catch(ne){hn(o,o.return,ne)}}break;case 3:if(nm=null,b=uo,uo=tm(l.containerInfo),Vi(l,o),uo=b,Gi(o),m&4&&h!==null&&h.memoizedState.isDehydrated)try{vh(l.containerInfo)}catch(ne){hn(o,o.return,ne)}ub&&(ub=!1,Kv(o));break;case 4:m=uo,uo=tm(o.stateNode.containerInfo),Vi(l,o),Gi(o),uo=m;break;case 12:Vi(l,o),Gi(o);break;case 31:Vi(l,o),Gi(o),m&4&&(m=o.updateQueue,m!==null&&(o.updateQueue=null,V0(o,m)));break;case 13:Vi(l,o),Gi(o),o.child.flags&8192&&o.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(k0=Yt()),m&4&&(m=o.updateQueue,m!==null&&(o.updateQueue=null,V0(o,m)));break;case 22:b=o.memoizedState!==null;var ot=h!==null&&h.memoizedState!==null,Nt=Na,Lt=Ms;if(Na=Nt||b,Ms=Lt||ot,Vi(l,o),Ms=Lt,Na=Nt,Gi(o),m&8192)t:for(l=o.stateNode,l._visibility=b?l._visibility&-2:l._visibility|1,b&&(h===null||ot||Na||Ms||Jc(o)),h=null,l=o;;){if(l.tag===5||l.tag===26){if(h===null){ot=h=l;try{if(w=ot.stateNode,b)E=w.style,typeof E.setProperty=="function"?E.setProperty("display","none","important"):E.display="none";else{V=ot.stateNode;var Pt=ot.memoizedProps.style,Rt=Pt!=null&&Pt.hasOwnProperty("display")?Pt.display:null;V.style.display=Rt==null||typeof Rt=="boolean"?"":(""+Rt).trim()}}catch(ne){hn(ot,ot.return,ne)}}}else if(l.tag===6){if(h===null){ot=l;try{ot.stateNode.nodeValue=b?"":ot.memoizedProps}catch(ne){hn(ot,ot.return,ne)}}}else if(l.tag===18){if(h===null){ot=l;try{var Et=ot.stateNode;b?IA(Et,!0):IA(ot.stateNode,!1)}catch(ne){hn(ot,ot.return,ne)}}}else if((l.tag!==22&&l.tag!==23||l.memoizedState===null||l===o)&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break t;for(;l.sibling===null;){if(l.return===null||l.return===o)break t;h===l&&(h=null),l=l.return}h===l&&(h=null),l.sibling.return=l.return,l=l.sibling}m&4&&(m=o.updateQueue,m!==null&&(h=m.retryQueue,h!==null&&(m.retryQueue=null,V0(o,h))));break;case 19:Vi(l,o),Gi(o),m&4&&(m=o.updateQueue,m!==null&&(o.updateQueue=null,V0(o,m)));break;case 30:break;case 21:break;default:Vi(l,o),Gi(o)}}function Gi(o){var l=o.flags;if(l&2){try{for(var h,m=o.return;m!==null;){if(Gv(m)){h=m;break}m=m.return}if(h==null)throw Error(n(160));switch(h.tag){case 27:var b=h.stateNode,w=lb(o);I0(o,w,b);break;case 5:var E=h.stateNode;h.flags&32&&(ju(E,""),h.flags&=-33);var V=lb(o);I0(o,V,E);break;case 3:case 4:var ot=h.stateNode.containerInfo,Nt=lb(o);cb(o,Nt,ot);break;default:throw Error(n(161))}}catch(Lt){hn(o,o.return,Lt)}o.flags&=-3}l&4096&&(o.flags&=-4097)}function Kv(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var l=o;Kv(l),l.tag===5&&l.flags&1024&&l.stateNode.reset(),o=o.sibling}}function Ea(o,l){if(l.subtreeFlags&8772)for(l=l.child;l!==null;)Wv(o,l.alternate,l),l=l.sibling}function Jc(o){for(o=o.child;o!==null;){var l=o;switch(l.tag){case 0:case 11:case 14:case 15:vl(4,l,l.return),Jc(l);break;case 1:Lo(l,l.return);var h=l.stateNode;typeof h.componentWillUnmount=="function"&&Iv(l,l.return,h),Jc(l);break;case 27:bf(l.stateNode);case 26:case 5:Lo(l,l.return),Jc(l);break;case 22:l.memoizedState===null&&Jc(l);break;case 30:Jc(l);break;default:Jc(l)}o=o.sibling}}function Ca(o,l,h){for(h=h&&(l.subtreeFlags&8772)!==0,l=l.child;l!==null;){var m=l.alternate,b=o,w=l,E=w.flags;switch(w.tag){case 0:case 11:case 15:Ca(b,w,h),cf(4,w);break;case 1:if(Ca(b,w,h),m=w,b=m.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Nt){hn(m,m.return,Nt)}if(m=w,b=m.updateQueue,b!==null){var V=m.stateNode;try{var ot=b.shared.hiddenCallbacks;if(ot!==null)for(b.shared.hiddenCallbacks=null,b=0;b<ot.length;b++)NM(ot[b],V)}catch(Nt){hn(m,m.return,Nt)}}h&&E&64&&zv(w),uf(w,w.return);break;case 27:kv(w);case 26:case 5:Ca(b,w,h),h&&m===null&&E&4&&Vv(w),uf(w,w.return);break;case 12:Ca(b,w,h);break;case 31:Ca(b,w,h),h&&E&4&&Xv(b,w);break;case 13:Ca(b,w,h),h&&E&4&&jv(b,w);break;case 22:w.memoizedState===null&&Ca(b,w,h),uf(w,w.return);break;case 30:break;default:Ca(b,w,h)}l=l.sibling}}function hb(o,l){var h=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(h=o.memoizedState.cachePool.pool),o=null,l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(o=l.memoizedState.cachePool.pool),o!==h&&(o!=null&&o.refCount++,h!=null&&Yd(h))}function db(o,l){o=null,l.alternate!==null&&(o=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==o&&(l.refCount++,o!=null&&Yd(o))}function ho(o,l,h,m){if(l.subtreeFlags&10256)for(l=l.child;l!==null;)Zv(o,l,h,m),l=l.sibling}function Zv(o,l,h,m){var b=l.flags;switch(l.tag){case 0:case 11:case 15:ho(o,l,h,m),b&2048&&cf(9,l);break;case 1:ho(o,l,h,m);break;case 3:ho(o,l,h,m),b&2048&&(o=null,l.alternate!==null&&(o=l.alternate.memoizedState.cache),l=l.memoizedState.cache,l!==o&&(l.refCount++,o!=null&&Yd(o)));break;case 12:if(b&2048){ho(o,l,h,m),o=l.stateNode;try{var w=l.memoizedProps,E=w.id,V=w.onPostCommit;typeof V=="function"&&V(E,l.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch(ot){hn(l,l.return,ot)}}else ho(o,l,h,m);break;case 31:ho(o,l,h,m);break;case 13:ho(o,l,h,m);break;case 23:break;case 22:w=l.stateNode,E=l.alternate,l.memoizedState!==null?w._visibility&2?ho(o,l,h,m):hf(o,l):w._visibility&2?ho(o,l,h,m):(w._visibility|=2,ph(o,l,h,m,(l.subtreeFlags&10256)!==0||!1)),b&2048&&hb(E,l);break;case 24:ho(o,l,h,m),b&2048&&db(l.alternate,l);break;default:ho(o,l,h,m)}}function ph(o,l,h,m,b){for(b=b&&((l.subtreeFlags&10256)!==0||!1),l=l.child;l!==null;){var w=o,E=l,V=h,ot=m,Nt=E.flags;switch(E.tag){case 0:case 11:case 15:ph(w,E,V,ot,b),cf(8,E);break;case 23:break;case 22:var Lt=E.stateNode;E.memoizedState!==null?Lt._visibility&2?ph(w,E,V,ot,b):hf(w,E):(Lt._visibility|=2,ph(w,E,V,ot,b)),b&&Nt&2048&&hb(E.alternate,E);break;case 24:ph(w,E,V,ot,b),b&&Nt&2048&&db(E.alternate,E);break;default:ph(w,E,V,ot,b)}l=l.sibling}}function hf(o,l){if(l.subtreeFlags&10256)for(l=l.child;l!==null;){var h=o,m=l,b=m.flags;switch(m.tag){case 22:hf(h,m),b&2048&&hb(m.alternate,m);break;case 24:hf(h,m),b&2048&&db(m.alternate,m);break;default:hf(h,m)}l=l.sibling}}var df=8192;function mh(o,l,h){if(o.subtreeFlags&df)for(o=o.child;o!==null;)Qv(o,l,h),o=o.sibling}function Qv(o,l,h){switch(o.tag){case 26:mh(o,l,h),o.flags&df&&o.memoizedState!==null&&cF(h,uo,o.memoizedState,o.memoizedProps);break;case 5:mh(o,l,h);break;case 3:case 4:var m=uo;uo=tm(o.stateNode.containerInfo),mh(o,l,h),uo=m;break;case 22:o.memoizedState===null&&(m=o.alternate,m!==null&&m.memoizedState!==null?(m=df,df=16777216,mh(o,l,h),df=m):mh(o,l,h));break;default:mh(o,l,h)}}function Jv(o){var l=o.alternate;if(l!==null&&(o=l.child,o!==null)){l.child=null;do l=o.sibling,o.sibling=null,o=l;while(o!==null)}}function ff(o){var l=o.deletions;if((o.flags&16)!==0){if(l!==null)for(var h=0;h<l.length;h++){var m=l[h];Vs=m,eA(m,o)}Jv(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)tA(o),o=o.sibling}function tA(o){switch(o.tag){case 0:case 11:case 15:ff(o),o.flags&2048&&vl(9,o,o.return);break;case 3:ff(o);break;case 12:ff(o);break;case 22:var l=o.stateNode;o.memoizedState!==null&&l._visibility&2&&(o.return===null||o.return.tag!==13)?(l._visibility&=-3,G0(o)):ff(o);break;default:ff(o)}}function G0(o){var l=o.deletions;if((o.flags&16)!==0){if(l!==null)for(var h=0;h<l.length;h++){var m=l[h];Vs=m,eA(m,o)}Jv(o)}for(o=o.child;o!==null;){switch(l=o,l.tag){case 0:case 11:case 15:vl(8,l,l.return),G0(l);break;case 22:h=l.stateNode,h._visibility&2&&(h._visibility&=-3,G0(l));break;default:G0(l)}o=o.sibling}}function eA(o,l){for(;Vs!==null;){var h=Vs;switch(h.tag){case 0:case 11:case 15:vl(8,h,l);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var m=h.memoizedState.cachePool.pool;m!=null&&m.refCount++}break;case 24:Yd(h.memoizedState.cache)}if(m=h.child,m!==null)m.return=h,Vs=m;else t:for(h=o;Vs!==null;){m=Vs;var b=m.sibling,w=m.return;if(qv(m),m===h){Vs=null;break t}if(b!==null){b.return=w,Vs=b;break t}Vs=w}}}var MO={getCacheForType:function(o){var l=Ks(ws),h=l.data.get(o);return h===void 0&&(h=o(),l.data.set(o,h)),h},cacheSignal:function(){return Ks(ws).controller.signal}},vO=typeof WeakMap=="function"?WeakMap:Map,en=0,Tn=null,Le=null,Pe=0,un=0,ur=null,Al=!1,gh=!1,fb=!1,Ba=0,as=0,Nl=0,tu=0,pb=0,hr=0,yh=0,pf=null,ki=null,mb=!1,k0=0,nA=0,H0=1/0,W0=null,Rl=null,Cs=0,El=null,xh=null,Da=0,gb=0,yb=null,sA=null,mf=0,xb=null;function dr(){return(en&2)!==0&&Pe!==0?Pe&-Pe:U.T!==null?Mb():oo()}function iA(){if(hr===0)if((Pe&536870912)===0||Ge){var o=pn;pn<<=1,(pn&3932160)===0&&(pn=262144),hr=o}else hr=536870912;return o=lr.current,o!==null&&(o.flags|=32),hr}function Hi(o,l,h){(o===Tn&&(un===2||un===9)||o.cancelPendingCommit!==null)&&(bh(o,0),Cl(o,Pe,hr,!1)),Fi(o,h),((en&2)===0||o!==Tn)&&(o===Tn&&((en&2)===0&&(tu|=h),as===4&&Cl(o,Pe,hr,!1)),Oo(o))}function rA(o,l,h){if((en&6)!==0)throw Error(n(327));var m=!h&&(l&127)===0&&(l&o.expiredLanes)===0||bs(o,l),b=m?RO(o,l):Sb(o,l,!0),w=m;do{if(b===0){gh&&!m&&Cl(o,l,0,!1);break}else{if(h=o.current.alternate,w&&!AO(h)){b=Sb(o,l,!1),w=!1;continue}if(b===2){if(w=l,o.errorRecoveryDisabledLanes&w)var E=0;else E=o.pendingLanes&-536870913,E=E!==0?E:E&536870912?536870912:0;if(E!==0){l=E;t:{var V=o;b=pf;var ot=V.current.memoizedState.isDehydrated;if(ot&&(bh(V,E).flags|=256),E=Sb(V,E,!1),E!==2){if(fb&&!ot){V.errorRecoveryDisabledLanes|=w,tu|=w,b=4;break t}w=ki,ki=b,w!==null&&(ki===null?ki=w:ki.push.apply(ki,w))}b=E}if(w=!1,b!==2)continue}}if(b===1){bh(o,0),Cl(o,l,0,!0);break}t:{switch(m=o,w=b,w){case 0:case 1:throw Error(n(345));case 4:if((l&4194048)!==l)break;case 6:Cl(m,l,hr,!Al);break t;case 2:ki=null;break;case 3:case 5:break;default:throw Error(n(329))}if((l&62914560)===l&&(b=k0+300-Yt(),10<b)){if(Cl(m,l,hr,!Al),Oi(m,0,!0)!==0)break t;Da=l,m.timeoutHandle=UA(oA.bind(null,m,h,ki,W0,mb,l,hr,tu,yh,Al,w,"Throttled",-0,0),b);break t}oA(m,h,ki,W0,mb,l,hr,tu,yh,Al,w,null,-0,0)}}break}while(!0);Oo(o)}function oA(o,l,h,m,b,w,E,V,ot,Nt,Lt,Pt,Rt,Et){if(o.timeoutHandle=-1,Pt=l.subtreeFlags,Pt&8192||(Pt&16785408)===16785408){Pt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:ya},Qv(l,w,Pt);var ne=(w&62914560)===w?k0-Yt():(w&4194048)===w?nA-Yt():0;if(ne=uF(Pt,ne),ne!==null){Da=w,o.cancelPendingCommit=ne(pA.bind(null,o,l,w,h,m,b,E,V,ot,Lt,Pt,null,Rt,Et)),Cl(o,w,E,!Nt);return}}pA(o,l,w,h,m,b,E,V,ot)}function AO(o){for(var l=o;;){var h=l.tag;if((h===0||h===11||h===15)&&l.flags&16384&&(h=l.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var m=0;m<h.length;m++){var b=h[m],w=b.getSnapshot;b=b.value;try{if(!or(w(),b))return!1}catch{return!1}}if(h=l.child,l.subtreeFlags&16384&&h!==null)h.return=l,l=h;else{if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return!0;l=l.return}l.sibling.return=l.return,l=l.sibling}}return!0}function Cl(o,l,h,m){l&=~pb,l&=~tu,o.suspendedLanes|=l,o.pingedLanes&=~l,m&&(o.warmLanes|=l),m=o.expirationTimes;for(var b=l;0<b;){var w=31-Ue(b),E=1<<w;m[w]=-1,b&=~E}h!==0&&ro(o,h,l)}function q0(){return(en&6)===0?(gf(0),!1):!0}function bb(){if(Le!==null){if(un===0)var o=Le.return;else o=Le,wa=qc=null,F1(o),ch=null,Zd=0,o=Le;for(;o!==null;)Pv(o.alternate,o),o=o.return;Le=null}}function bh(o,l){var h=o.timeoutHandle;h!==-1&&(o.timeoutHandle=-1,$O(h)),h=o.cancelPendingCommit,h!==null&&(o.cancelPendingCommit=null,h()),Da=0,bb(),Tn=o,Le=h=ba(o.current,null),Pe=l,un=0,ur=null,Al=!1,gh=bs(o,l),fb=!1,yh=hr=pb=tu=Nl=as=0,ki=pf=null,mb=!1,(l&8)!==0&&(l|=l&32);var m=o.entangledLanes;if(m!==0)for(o=o.entanglements,m&=l;0<m;){var b=31-Ue(m),w=1<<b;l|=o[b],m&=~w}return Ba=l,d0(),h}function aA(o,l){_e=null,U.H=of,l===lh||l===S0?(l=_M(),un=3):l===_1?(l=_M(),un=4):un=l===Z1?8:l!==null&&typeof l=="object"&&typeof l.then=="function"?6:1,ur=l,Le===null&&(as=1,O0(o,Or(l,o.current)))}function lA(){var o=lr.current;return o===null?!0:(Pe&4194048)===Pe?zr===null:(Pe&62914560)===Pe||(Pe&536870912)!==0?o===zr:!1}function cA(){var o=U.H;return U.H=of,o===null?of:o}function uA(){var o=U.A;return U.A=MO,o}function $0(){as=4,Al||(Pe&4194048)!==Pe&&lr.current!==null||(gh=!0),(Nl&134217727)===0&&(tu&134217727)===0||Tn===null||Cl(Tn,Pe,hr,!1)}function Sb(o,l,h){var m=en;en|=2;var b=cA(),w=uA();(Tn!==o||Pe!==l)&&(W0=null,bh(o,l)),l=!1;var E=as;t:do try{if(un!==0&&Le!==null){var V=Le,ot=ur;switch(un){case 8:bb(),E=6;break t;case 3:case 2:case 9:case 6:lr.current===null&&(l=!0);var Nt=un;if(un=0,ur=null,Sh(o,V,ot,Nt),h&&gh){E=0;break t}break;default:Nt=un,un=0,ur=null,Sh(o,V,ot,Nt)}}NO(),E=as;break}catch(Lt){aA(o,Lt)}while(!0);return l&&o.shellSuspendCounter++,wa=qc=null,en=m,U.H=b,U.A=w,Le===null&&(Tn=null,Pe=0,d0()),E}function NO(){for(;Le!==null;)hA(Le)}function RO(o,l){var h=en;en|=2;var m=cA(),b=uA();Tn!==o||Pe!==l?(W0=null,H0=Yt()+500,bh(o,l)):gh=bs(o,l);t:do try{if(un!==0&&Le!==null){l=Le;var w=ur;e:switch(un){case 1:un=0,ur=null,Sh(o,l,w,1);break;case 2:case 9:if(wM(w)){un=0,ur=null,dA(l);break}l=function(){un!==2&&un!==9||Tn!==o||(un=7),Oo(o)},w.then(l,l);break t;case 3:un=7;break t;case 4:un=5;break t;case 7:wM(w)?(un=0,ur=null,dA(l)):(un=0,ur=null,Sh(o,l,w,7));break;case 5:var E=null;switch(Le.tag){case 26:E=Le.memoizedState;case 5:case 27:var V=Le;if(E?ZA(E):V.stateNode.complete){un=0,ur=null;var ot=V.sibling;if(ot!==null)Le=ot;else{var Nt=V.return;Nt!==null?(Le=Nt,X0(Nt)):Le=null}break e}}un=0,ur=null,Sh(o,l,w,5);break;case 6:un=0,ur=null,Sh(o,l,w,6);break;case 8:bb(),as=6;break t;default:throw Error(n(462))}}EO();break}catch(Lt){aA(o,Lt)}while(!0);return wa=qc=null,U.H=m,U.A=b,en=h,Le!==null?0:(Tn=null,Pe=0,d0(),as)}function EO(){for(;Le!==null&&!Qt();)hA(Le)}function hA(o){var l=Fv(o.alternate,o,Ba);o.memoizedProps=o.pendingProps,l===null?X0(o):Le=l}function dA(o){var l=o,h=l.alternate;switch(l.tag){case 15:case 0:l=Ev(h,l,l.pendingProps,l.type,void 0,Pe);break;case 11:l=Ev(h,l,l.pendingProps,l.type.render,l.ref,Pe);break;case 5:F1(l);default:Pv(h,l),l=Le=uM(l,Ba),l=Fv(h,l,Ba)}o.memoizedProps=o.pendingProps,l===null?X0(o):Le=l}function Sh(o,l,h,m){wa=qc=null,F1(l),ch=null,Zd=0;var b=l.return;try{if(yO(o,b,l,h,Pe)){as=1,O0(o,Or(h,o.current)),Le=null;return}}catch(w){if(b!==null)throw Le=b,w;as=1,O0(o,Or(h,o.current)),Le=null;return}l.flags&32768?(Ge||m===1?o=!0:gh||(Pe&536870912)!==0?o=!1:(Al=o=!0,(m===2||m===9||m===3||m===6)&&(m=lr.current,m!==null&&m.tag===13&&(m.flags|=16384))),fA(l,o)):X0(l)}function X0(o){var l=o;do{if((l.flags&32768)!==0){fA(l,Al);return}o=l.return;var h=SO(l.alternate,l,Ba);if(h!==null){Le=h;return}if(l=l.sibling,l!==null){Le=l;return}Le=l=o}while(l!==null);as===0&&(as=5)}function fA(o,l){do{var h=wO(o.alternate,o);if(h!==null){h.flags&=32767,Le=h;return}if(h=o.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!l&&(o=o.sibling,o!==null)){Le=o;return}Le=o=h}while(o!==null);as=6,Le=null}function pA(o,l,h,m,b,w,E,V,ot){o.cancelPendingCommit=null;do j0();while(Cs!==0);if((en&6)!==0)throw Error(n(327));if(l!==null){if(l===o.current)throw Error(n(177));if(w=l.lanes|l.childLanes,w|=l1,Eo(o,h,w,E,V,ot),o===Tn&&(Le=Tn=null,Pe=0),xh=l,El=o,Da=h,gb=w,yb=b,sA=m,(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,LO(Sn,function(){return bA(),null})):(o.callbackNode=null,o.callbackPriority=0),m=(l.flags&13878)!==0,(l.subtreeFlags&13878)!==0||m){m=U.T,U.T=null,b=K.p,K.p=2,E=en,en|=4;try{TO(o,l,h)}finally{en=E,K.p=b,U.T=m}}Cs=1,mA(),gA(),yA()}}function mA(){if(Cs===1){Cs=0;var o=El,l=xh,h=(l.flags&13878)!==0;if((l.subtreeFlags&13878)!==0||h){h=U.T,U.T=null;var m=K.p;K.p=2;var b=en;en|=4;try{Yv(l,o);var w=Db,E=eM(o.containerInfo),V=w.focusedElem,ot=w.selectionRange;if(E!==V&&V&&V.ownerDocument&&tM(V.ownerDocument.documentElement,V)){if(ot!==null&&s1(V)){var Nt=ot.start,Lt=ot.end;if(Lt===void 0&&(Lt=Nt),"selectionStart"in V)V.selectionStart=Nt,V.selectionEnd=Math.min(Lt,V.value.length);else{var Pt=V.ownerDocument||document,Rt=Pt&&Pt.defaultView||window;if(Rt.getSelection){var Et=Rt.getSelection(),ne=V.textContent.length,pe=Math.min(ot.start,ne),yn=ot.end===void 0?pe:Math.min(ot.end,ne);!Et.extend&&pe>yn&&(E=yn,yn=pe,pe=E);var bt=J_(V,pe),pt=J_(V,yn);if(bt&&pt&&(Et.rangeCount!==1||Et.anchorNode!==bt.node||Et.anchorOffset!==bt.offset||Et.focusNode!==pt.node||Et.focusOffset!==pt.offset)){var At=Pt.createRange();At.setStart(bt.node,bt.offset),Et.removeAllRanges(),pe>yn?(Et.addRange(At),Et.extend(pt.node,pt.offset)):(At.setEnd(pt.node,pt.offset),Et.addRange(At))}}}}for(Pt=[],Et=V;Et=Et.parentNode;)Et.nodeType===1&&Pt.push({element:Et,left:Et.scrollLeft,top:Et.scrollTop});for(typeof V.focus=="function"&&V.focus(),V=0;V<Pt.length;V++){var Ft=Pt[V];Ft.element.scrollLeft=Ft.left,Ft.element.scrollTop=Ft.top}}om=!!Bb,Db=Bb=null}finally{en=b,K.p=m,U.T=h}}o.current=l,Cs=2}}function gA(){if(Cs===2){Cs=0;var o=El,l=xh,h=(l.flags&8772)!==0;if((l.subtreeFlags&8772)!==0||h){h=U.T,U.T=null;var m=K.p;K.p=2;var b=en;en|=4;try{Wv(o,l.alternate,l)}finally{en=b,K.p=m,U.T=h}}Cs=3}}function yA(){if(Cs===4||Cs===3){Cs=0,ie();var o=El,l=xh,h=Da,m=sA;(l.subtreeFlags&10256)!==0||(l.flags&10256)!==0?Cs=5:(Cs=0,xh=El=null,xA(o,o.pendingLanes));var b=o.pendingLanes;if(b===0&&(Rl=null),pa(h),l=l.stateNode,Ze&&typeof Ze.onCommitFiberRoot=="function")try{Ze.onCommitFiberRoot(be,l,void 0,(l.current.flags&128)===128)}catch{}if(m!==null){l=U.T,b=K.p,K.p=2,U.T=null;try{for(var w=o.onRecoverableError,E=0;E<m.length;E++){var V=m[E];w(V.value,{componentStack:V.stack})}}finally{U.T=l,K.p=b}}(Da&3)!==0&&j0(),Oo(o),b=o.pendingLanes,(h&261930)!==0&&(b&42)!==0?o===xb?mf++:(mf=0,xb=o):mf=0,gf(0)}}function xA(o,l){(o.pooledCacheLanes&=l)===0&&(l=o.pooledCache,l!=null&&(o.pooledCache=null,Yd(l)))}function j0(){return mA(),gA(),yA(),bA()}function bA(){if(Cs!==5)return!1;var o=El,l=gb;gb=0;var h=pa(Da),m=U.T,b=K.p;try{K.p=32>h?32:h,U.T=null,h=yb,yb=null;var w=El,E=Da;if(Cs=0,xh=El=null,Da=0,(en&6)!==0)throw Error(n(331));var V=en;if(en|=4,tA(w.current),Zv(w,w.current,E,h),en=V,gf(0,!1),Ze&&typeof Ze.onPostCommitFiberRoot=="function")try{Ze.onPostCommitFiberRoot(be,w)}catch{}return!0}finally{K.p=b,U.T=m,xA(o,l)}}function SA(o,l,h){l=Or(h,l),l=K1(o.stateNode,l,2),o=Tl(o,l,2),o!==null&&(Fi(o,2),Oo(o))}function hn(o,l,h){if(o.tag===3)SA(o,o,h);else for(;l!==null;){if(l.tag===3){SA(l,o,h);break}else if(l.tag===1){var m=l.stateNode;if(typeof l.type.getDerivedStateFromError=="function"||typeof m.componentDidCatch=="function"&&(Rl===null||!Rl.has(m))){o=Or(h,o),h=wv(2),m=Tl(l,h,2),m!==null&&(Tv(h,m,l,o),Fi(m,2),Oo(m));break}}l=l.return}}function wb(o,l,h){var m=o.pingCache;if(m===null){m=o.pingCache=new vO;var b=new Set;m.set(l,b)}else b=m.get(l),b===void 0&&(b=new Set,m.set(l,b));b.has(h)||(fb=!0,b.add(h),o=CO.bind(null,o,l,h),l.then(o,o))}function CO(o,l,h){var m=o.pingCache;m!==null&&m.delete(l),o.pingedLanes|=o.suspendedLanes&h,o.warmLanes&=~h,Tn===o&&(Pe&h)===h&&(as===4||as===3&&(Pe&62914560)===Pe&&300>Yt()-k0?(en&2)===0&&bh(o,0):pb|=h,yh===Pe&&(yh=0)),Oo(o)}function wA(o,l){l===0&&(l=io()),o=kc(o,l),o!==null&&(Fi(o,l),Oo(o))}function BO(o){var l=o.memoizedState,h=0;l!==null&&(h=l.retryLane),wA(o,h)}function DO(o,l){var h=0;switch(o.tag){case 31:case 13:var m=o.stateNode,b=o.memoizedState;b!==null&&(h=b.retryLane);break;case 19:m=o.stateNode;break;case 22:m=o.stateNode._retryCache;break;default:throw Error(n(314))}m!==null&&m.delete(l),wA(o,h)}function LO(o,l){return zt(o,l)}var Y0=null,wh=null,Tb=!1,K0=!1,_b=!1,Bl=0;function Oo(o){o!==wh&&o.next===null&&(wh===null?Y0=wh=o:wh=wh.next=o),K0=!0,Tb||(Tb=!0,FO())}function gf(o,l){if(!_b&&K0){_b=!0;do for(var h=!1,m=Y0;m!==null;){if(o!==0){var b=m.pendingLanes;if(b===0)var w=0;else{var E=m.suspendedLanes,V=m.pingedLanes;w=(1<<31-Ue(42|o)+1)-1,w&=b&~(E&~V),w=w&201326741?w&201326741|1:w?w|2:0}w!==0&&(h=!0,vA(m,w))}else w=Pe,w=Oi(m,m===Tn?w:0,m.cancelPendingCommit!==null||m.timeoutHandle!==-1),(w&3)===0||bs(m,w)||(h=!0,vA(m,w));m=m.next}while(h);_b=!1}}function OO(){TA()}function TA(){K0=Tb=!1;var o=0;Bl!==0&&qO()&&(o=Bl);for(var l=Yt(),h=null,m=Y0;m!==null;){var b=m.next,w=_A(m,l);w===0?(m.next=null,h===null?Y0=b:h.next=b,b===null&&(wh=h)):(h=m,(o!==0||(w&3)!==0)&&(K0=!0)),m=b}Cs!==0&&Cs!==5||gf(o),Bl!==0&&(Bl=0)}function _A(o,l){for(var h=o.suspendedLanes,m=o.pingedLanes,b=o.expirationTimes,w=o.pendingLanes&-62914561;0<w;){var E=31-Ue(w),V=1<<E,ot=b[E];ot===-1?((V&h)===0||(V&m)!==0)&&(b[E]=Uc(V,l)):ot<=l&&(o.expiredLanes|=V),w&=~V}if(l=Tn,h=Pe,h=Oi(o,o===l?h:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),m=o.callbackNode,h===0||o===l&&(un===2||un===9)||o.cancelPendingCommit!==null)return m!==null&&m!==null&&kt(m),o.callbackNode=null,o.callbackPriority=0;if((h&3)===0||bs(o,h)){if(l=h&-h,l===o.callbackPriority)return l;switch(m!==null&&kt(m),pa(h)){case 2:case 8:h=We;break;case 32:h=Sn;break;case 268435456:h=rs;break;default:h=Sn}return m=MA.bind(null,o),h=zt(h,m),o.callbackPriority=l,o.callbackNode=h,l}return m!==null&&m!==null&&kt(m),o.callbackPriority=2,o.callbackNode=null,2}function MA(o,l){if(Cs!==0&&Cs!==5)return o.callbackNode=null,o.callbackPriority=0,null;var h=o.callbackNode;if(j0()&&o.callbackNode!==h)return null;var m=Pe;return m=Oi(o,o===Tn?m:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),m===0?null:(rA(o,m,l),_A(o,Yt()),o.callbackNode!=null&&o.callbackNode===h?MA.bind(null,o):null)}function vA(o,l){if(j0())return null;rA(o,l,!0)}function FO(){XO(function(){(en&6)!==0?zt(ce,OO):TA()})}function Mb(){if(Bl===0){var o=oh;o===0&&(o=Ve,Ve<<=1,(Ve&261888)===0&&(Ve=256)),Bl=o}return Bl}function AA(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:i0(""+o)}function NA(o,l){var h=l.ownerDocument.createElement("input");return h.name=l.name,h.value=l.value,o.id&&h.setAttribute("form",o.id),l.parentNode.insertBefore(h,l),o=new FormData(o),h.parentNode.removeChild(h),o}function UO(o,l,h,m,b){if(l==="submit"&&h&&h.stateNode===b){var w=AA((b[Ss]||null).action),E=m.submitter;E&&(l=(l=E[Ss]||null)?AA(l.formAction):E.getAttribute("formAction"),l!==null&&(w=l,E=null));var V=new l0("action","action",null,m,b);o.push({event:V,listeners:[{instance:null,listener:function(){if(m.defaultPrevented){if(Bl!==0){var ot=E?NA(b,E):new FormData(b);W1(h,{pending:!0,data:ot,method:b.method,action:w},null,ot)}}else typeof w=="function"&&(V.preventDefault(),ot=E?NA(b,E):new FormData(b),W1(h,{pending:!0,data:ot,method:b.method,action:w},w,ot))},currentTarget:b}]})}}for(var vb=0;vb<a1.length;vb++){var Ab=a1[vb],PO=Ab.toLowerCase(),zO=Ab[0].toUpperCase()+Ab.slice(1);co(PO,"on"+zO)}co(iM,"onAnimationEnd"),co(rM,"onAnimationIteration"),co(oM,"onAnimationStart"),co("dblclick","onDoubleClick"),co("focusin","onFocus"),co("focusout","onBlur"),co(tO,"onTransitionRun"),co(eO,"onTransitionStart"),co(nO,"onTransitionCancel"),co(aM,"onTransitionEnd"),Is("onMouseEnter",["mouseout","mouseover"]),Is("onMouseLeave",["mouseout","mouseover"]),Is("onPointerEnter",["pointerout","pointerover"]),Is("onPointerLeave",["pointerout","pointerover"]),rr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),rr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),rr("onBeforeInput",["compositionend","keypress","textInput","paste"]),rr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),rr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),rr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var yf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),IO=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(yf));function RA(o,l){l=(l&4)!==0;for(var h=0;h<o.length;h++){var m=o[h],b=m.event;m=m.listeners;t:{var w=void 0;if(l)for(var E=m.length-1;0<=E;E--){var V=m[E],ot=V.instance,Nt=V.currentTarget;if(V=V.listener,ot!==w&&b.isPropagationStopped())break t;w=V,b.currentTarget=Nt;try{w(b)}catch(Lt){h0(Lt)}b.currentTarget=null,w=ot}else for(E=0;E<m.length;E++){if(V=m[E],ot=V.instance,Nt=V.currentTarget,V=V.listener,ot!==w&&b.isPropagationStopped())break t;w=V,b.currentTarget=Nt;try{w(b)}catch(Lt){h0(Lt)}b.currentTarget=null,w=ot}}}}function Oe(o,l){var h=l[Rr];h===void 0&&(h=l[Rr]=new Set);var m=o+"__bubble";h.has(m)||(EA(l,o,2,!1),h.add(m))}function Nb(o,l,h){var m=0;l&&(m|=4),EA(h,o,m,l)}var Z0="_reactListening"+Math.random().toString(36).slice(2);function Rb(o){if(!o[Z0]){o[Z0]=!0,Pi.forEach(function(h){h!=="selectionchange"&&(IO.has(h)||Nb(h,!1,o),Nb(h,!0,o))});var l=o.nodeType===9?o:o.ownerDocument;l===null||l[Z0]||(l[Z0]=!0,Nb("selectionchange",!1,l))}}function EA(o,l,h,m){switch(iN(l)){case 2:var b=fF;break;case 8:b=pF;break;default:b=Hb}h=b.bind(null,l,h,o),b=void 0,!jx||l!=="touchstart"&&l!=="touchmove"&&l!=="wheel"||(b=!0),m?b!==void 0?o.addEventListener(l,h,{capture:!0,passive:b}):o.addEventListener(l,h,!0):b!==void 0?o.addEventListener(l,h,{passive:b}):o.addEventListener(l,h,!1)}function Eb(o,l,h,m,b){var w=m;if((l&1)===0&&(l&2)===0&&m!==null)t:for(;;){if(m===null)return;var E=m.tag;if(E===3||E===4){var V=m.stateNode.containerInfo;if(V===b)break;if(E===4)for(E=m.return;E!==null;){var ot=E.tag;if((ot===3||ot===4)&&E.stateNode.containerInfo===b)return;E=E.return}for(;V!==null;){if(E=Er(V),E===null)return;if(ot=E.tag,ot===5||ot===6||ot===26||ot===27){m=w=E;continue t}V=V.parentNode}}m=m.return}O_(function(){var Nt=w,Lt=$x(h),Pt=[];t:{var Rt=lM.get(o);if(Rt!==void 0){var Et=l0,ne=o;switch(o){case"keypress":if(o0(h)===0)break t;case"keydown":case"keyup":Et=DL;break;case"focusin":ne="focus",Et=Qx;break;case"focusout":ne="blur",Et=Qx;break;case"beforeblur":case"afterblur":Et=Qx;break;case"click":if(h.button===2)break t;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Et=P_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Et=SL;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Et=FL;break;case iM:case rM:case oM:Et=_L;break;case aM:Et=PL;break;case"scroll":case"scrollend":Et=xL;break;case"wheel":Et=IL;break;case"copy":case"cut":case"paste":Et=vL;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Et=I_;break;case"toggle":case"beforetoggle":Et=GL}var pe=(l&4)!==0,yn=!pe&&(o==="scroll"||o==="scrollend"),bt=pe?Rt!==null?Rt+"Capture":null:Rt;pe=[];for(var pt=Nt,At;pt!==null;){var Ft=pt;if(At=Ft.stateNode,Ft=Ft.tag,Ft!==5&&Ft!==26&&Ft!==27||At===null||bt===null||(Ft=zd(pt,bt),Ft!=null&&pe.push(xf(pt,Ft,At))),yn)break;pt=pt.return}0<pe.length&&(Rt=new Et(Rt,ne,null,h,Lt),Pt.push({event:Rt,listeners:pe}))}}if((l&7)===0){t:{if(Rt=o==="mouseover"||o==="pointerover",Et=o==="mouseout"||o==="pointerout",Rt&&h!==qx&&(ne=h.relatedTarget||h.fromElement)&&(Er(ne)||ne[wi]))break t;if((Et||Rt)&&(Rt=Lt.window===Lt?Lt:(Rt=Lt.ownerDocument)?Rt.defaultView||Rt.parentWindow:window,Et?(ne=h.relatedTarget||h.toElement,Et=Nt,ne=ne?Er(ne):null,ne!==null&&(yn=i(ne),pe=ne.tag,ne!==yn||pe!==5&&pe!==27&&pe!==6)&&(ne=null)):(Et=null,ne=Nt),Et!==ne)){if(pe=P_,Ft="onMouseLeave",bt="onMouseEnter",pt="mouse",(o==="pointerout"||o==="pointerover")&&(pe=I_,Ft="onPointerLeave",bt="onPointerEnter",pt="pointer"),yn=Et==null?Rt:lo(Et),At=ne==null?Rt:lo(ne),Rt=new pe(Ft,pt+"leave",Et,h,Lt),Rt.target=yn,Rt.relatedTarget=At,Ft=null,Er(Lt)===Nt&&(pe=new pe(bt,pt+"enter",ne,h,Lt),pe.target=At,pe.relatedTarget=yn,Ft=pe),yn=Ft,Et&&ne)e:{for(pe=VO,bt=Et,pt=ne,At=0,Ft=bt;Ft;Ft=pe(Ft))At++;Ft=0;for(var he=pt;he;he=pe(he))Ft++;for(;0<At-Ft;)bt=pe(bt),At--;for(;0<Ft-At;)pt=pe(pt),Ft--;for(;At--;){if(bt===pt||pt!==null&&bt===pt.alternate){pe=bt;break e}bt=pe(bt),pt=pe(pt)}pe=null}else pe=null;Et!==null&&CA(Pt,Rt,Et,pe,!1),ne!==null&&yn!==null&&CA(Pt,yn,ne,pe,!0)}}t:{if(Rt=Nt?lo(Nt):window,Et=Rt.nodeName&&Rt.nodeName.toLowerCase(),Et==="select"||Et==="input"&&Rt.type==="file")var Qe=X_;else if(q_(Rt))if(j_)Qe=ZL;else{Qe=YL;var ae=jL}else Et=Rt.nodeName,!Et||Et.toLowerCase()!=="input"||Rt.type!=="checkbox"&&Rt.type!=="radio"?Nt&&Wx(Nt.elementType)&&(Qe=X_):Qe=KL;if(Qe&&(Qe=Qe(o,Nt))){$_(Pt,Qe,h,Lt);break t}ae&&ae(o,Rt,Nt),o==="focusout"&&Nt&&Rt.type==="number"&&Nt.memoizedProps.value!=null&&Hx(Rt,"number",Rt.value)}switch(ae=Nt?lo(Nt):window,o){case"focusin":(q_(ae)||ae.contentEditable==="true")&&(Qu=ae,i1=Nt,$d=null);break;case"focusout":$d=i1=Qu=null;break;case"mousedown":r1=!0;break;case"contextmenu":case"mouseup":case"dragend":r1=!1,nM(Pt,h,Lt);break;case"selectionchange":if(JL)break;case"keydown":case"keyup":nM(Pt,h,Lt)}var Re;if(t1)t:{switch(o){case"compositionstart":var ze="onCompositionStart";break t;case"compositionend":ze="onCompositionEnd";break t;case"compositionupdate":ze="onCompositionUpdate";break t}ze=void 0}else Zu?H_(o,h)&&(ze="onCompositionEnd"):o==="keydown"&&h.keyCode===229&&(ze="onCompositionStart");ze&&(V_&&h.locale!=="ko"&&(Zu||ze!=="onCompositionStart"?ze==="onCompositionEnd"&&Zu&&(Re=F_()):(ml=Lt,Yx="value"in ml?ml.value:ml.textContent,Zu=!0)),ae=Q0(Nt,ze),0<ae.length&&(ze=new z_(ze,o,null,h,Lt),Pt.push({event:ze,listeners:ae}),Re?ze.data=Re:(Re=W_(h),Re!==null&&(ze.data=Re)))),(Re=HL?WL(o,h):qL(o,h))&&(ze=Q0(Nt,"onBeforeInput"),0<ze.length&&(ae=new z_("onBeforeInput","beforeinput",null,h,Lt),Pt.push({event:ae,listeners:ze}),ae.data=Re)),UO(Pt,o,Nt,h,Lt)}RA(Pt,l)})}function xf(o,l,h){return{instance:o,listener:l,currentTarget:h}}function Q0(o,l){for(var h=l+"Capture",m=[];o!==null;){var b=o,w=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||w===null||(b=zd(o,h),b!=null&&m.unshift(xf(o,b,w)),b=zd(o,l),b!=null&&m.push(xf(o,b,w))),o.tag===3)return m;o=o.return}return[]}function VO(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function CA(o,l,h,m,b){for(var w=l._reactName,E=[];h!==null&&h!==m;){var V=h,ot=V.alternate,Nt=V.stateNode;if(V=V.tag,ot!==null&&ot===m)break;V!==5&&V!==26&&V!==27||Nt===null||(ot=Nt,b?(Nt=zd(h,w),Nt!=null&&E.unshift(xf(h,Nt,ot))):b||(Nt=zd(h,w),Nt!=null&&E.push(xf(h,Nt,ot)))),h=h.return}E.length!==0&&o.push({event:l,listeners:E})}var GO=/\r\n?/g,kO=/\u0000|\uFFFD/g;function BA(o){return(typeof o=="string"?o:""+o).replace(GO,`
`).replace(kO,"")}function DA(o,l){return l=BA(l),BA(o)===l}function gn(o,l,h,m,b,w){switch(h){case"children":typeof m=="string"?l==="body"||l==="textarea"&&m===""||ju(o,m):(typeof m=="number"||typeof m=="bigint")&&l!=="body"&&ju(o,""+m);break;case"className":n0(o,"class",m);break;case"tabIndex":n0(o,"tabindex",m);break;case"dir":case"role":case"viewBox":case"width":case"height":n0(o,h,m);break;case"style":D_(o,m,w);break;case"data":if(l!=="object"){n0(o,"data",m);break}case"src":case"href":if(m===""&&(l!=="a"||h!=="href")){o.removeAttribute(h);break}if(m==null||typeof m=="function"||typeof m=="symbol"||typeof m=="boolean"){o.removeAttribute(h);break}m=i0(""+m),o.setAttribute(h,m);break;case"action":case"formAction":if(typeof m=="function"){o.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof w=="function"&&(h==="formAction"?(l!=="input"&&gn(o,l,"name",b.name,b,null),gn(o,l,"formEncType",b.formEncType,b,null),gn(o,l,"formMethod",b.formMethod,b,null),gn(o,l,"formTarget",b.formTarget,b,null)):(gn(o,l,"encType",b.encType,b,null),gn(o,l,"method",b.method,b,null),gn(o,l,"target",b.target,b,null)));if(m==null||typeof m=="symbol"||typeof m=="boolean"){o.removeAttribute(h);break}m=i0(""+m),o.setAttribute(h,m);break;case"onClick":m!=null&&(o.onclick=ya);break;case"onScroll":m!=null&&Oe("scroll",o);break;case"onScrollEnd":m!=null&&Oe("scrollend",o);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(h=m.__html,h!=null){if(b.children!=null)throw Error(n(60));o.innerHTML=h}}break;case"multiple":o.multiple=m&&typeof m!="function"&&typeof m!="symbol";break;case"muted":o.muted=m&&typeof m!="function"&&typeof m!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(m==null||typeof m=="function"||typeof m=="boolean"||typeof m=="symbol"){o.removeAttribute("xlink:href");break}h=i0(""+m),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":m!=null&&typeof m!="function"&&typeof m!="symbol"?o.setAttribute(h,""+m):o.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":m&&typeof m!="function"&&typeof m!="symbol"?o.setAttribute(h,""):o.removeAttribute(h);break;case"capture":case"download":m===!0?o.setAttribute(h,""):m!==!1&&m!=null&&typeof m!="function"&&typeof m!="symbol"?o.setAttribute(h,m):o.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":m!=null&&typeof m!="function"&&typeof m!="symbol"&&!isNaN(m)&&1<=m?o.setAttribute(h,m):o.removeAttribute(h);break;case"rowSpan":case"start":m==null||typeof m=="function"||typeof m=="symbol"||isNaN(m)?o.removeAttribute(h):o.setAttribute(h,m);break;case"popover":Oe("beforetoggle",o),Oe("toggle",o),e0(o,"popover",m);break;case"xlinkActuate":ga(o,"http://www.w3.org/1999/xlink","xlink:actuate",m);break;case"xlinkArcrole":ga(o,"http://www.w3.org/1999/xlink","xlink:arcrole",m);break;case"xlinkRole":ga(o,"http://www.w3.org/1999/xlink","xlink:role",m);break;case"xlinkShow":ga(o,"http://www.w3.org/1999/xlink","xlink:show",m);break;case"xlinkTitle":ga(o,"http://www.w3.org/1999/xlink","xlink:title",m);break;case"xlinkType":ga(o,"http://www.w3.org/1999/xlink","xlink:type",m);break;case"xmlBase":ga(o,"http://www.w3.org/XML/1998/namespace","xml:base",m);break;case"xmlLang":ga(o,"http://www.w3.org/XML/1998/namespace","xml:lang",m);break;case"xmlSpace":ga(o,"http://www.w3.org/XML/1998/namespace","xml:space",m);break;case"is":e0(o,"is",m);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=gL.get(h)||h,e0(o,h,m))}}function Cb(o,l,h,m,b,w){switch(h){case"style":D_(o,m,w);break;case"dangerouslySetInnerHTML":if(m!=null){if(typeof m!="object"||!("__html"in m))throw Error(n(61));if(h=m.__html,h!=null){if(b.children!=null)throw Error(n(60));o.innerHTML=h}}break;case"children":typeof m=="string"?ju(o,m):(typeof m=="number"||typeof m=="bigint")&&ju(o,""+m);break;case"onScroll":m!=null&&Oe("scroll",o);break;case"onScrollEnd":m!=null&&Oe("scrollend",o);break;case"onClick":m!=null&&(o.onclick=ya);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!js.hasOwnProperty(h))t:{if(h[0]==="o"&&h[1]==="n"&&(b=h.endsWith("Capture"),l=h.slice(2,b?h.length-7:void 0),w=o[Ss]||null,w=w!=null?w[h]:null,typeof w=="function"&&o.removeEventListener(l,w,b),typeof m=="function")){typeof w!="function"&&w!==null&&(h in o?o[h]=null:o.hasAttribute(h)&&o.removeAttribute(h)),o.addEventListener(l,m,b);break t}h in o?o[h]=m:m===!0?o.setAttribute(h,""):e0(o,h,m)}}}function Qs(o,l,h){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Oe("error",o),Oe("load",o);var m=!1,b=!1,w;for(w in h)if(h.hasOwnProperty(w)){var E=h[w];if(E!=null)switch(w){case"src":m=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:gn(o,l,w,E,h,null)}}b&&gn(o,l,"srcSet",h.srcSet,h,null),m&&gn(o,l,"src",h.src,h,null);return;case"input":Oe("invalid",o);var V=w=E=b=null,ot=null,Nt=null;for(m in h)if(h.hasOwnProperty(m)){var Lt=h[m];if(Lt!=null)switch(m){case"name":b=Lt;break;case"type":E=Lt;break;case"checked":ot=Lt;break;case"defaultChecked":Nt=Lt;break;case"value":w=Lt;break;case"defaultValue":V=Lt;break;case"children":case"dangerouslySetInnerHTML":if(Lt!=null)throw Error(n(137,l));break;default:gn(o,l,m,Lt,h,null)}}R_(o,w,V,ot,Nt,E,b,!1);return;case"select":Oe("invalid",o),m=E=w=null;for(b in h)if(h.hasOwnProperty(b)&&(V=h[b],V!=null))switch(b){case"value":w=V;break;case"defaultValue":E=V;break;case"multiple":m=V;default:gn(o,l,b,V,h,null)}l=w,h=E,o.multiple=!!m,l!=null?Xu(o,!!m,l,!1):h!=null&&Xu(o,!!m,h,!0);return;case"textarea":Oe("invalid",o),w=b=m=null;for(E in h)if(h.hasOwnProperty(E)&&(V=h[E],V!=null))switch(E){case"value":m=V;break;case"defaultValue":b=V;break;case"children":w=V;break;case"dangerouslySetInnerHTML":if(V!=null)throw Error(n(91));break;default:gn(o,l,E,V,h,null)}C_(o,m,b,w);return;case"option":for(ot in h)h.hasOwnProperty(ot)&&(m=h[ot],m!=null)&&(ot==="selected"?o.selected=m&&typeof m!="function"&&typeof m!="symbol":gn(o,l,ot,m,h,null));return;case"dialog":Oe("beforetoggle",o),Oe("toggle",o),Oe("cancel",o),Oe("close",o);break;case"iframe":case"object":Oe("load",o);break;case"video":case"audio":for(m=0;m<yf.length;m++)Oe(yf[m],o);break;case"image":Oe("error",o),Oe("load",o);break;case"details":Oe("toggle",o);break;case"embed":case"source":case"link":Oe("error",o),Oe("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Nt in h)if(h.hasOwnProperty(Nt)&&(m=h[Nt],m!=null))switch(Nt){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,l));default:gn(o,l,Nt,m,h,null)}return;default:if(Wx(l)){for(Lt in h)h.hasOwnProperty(Lt)&&(m=h[Lt],m!==void 0&&Cb(o,l,Lt,m,h,void 0));return}}for(V in h)h.hasOwnProperty(V)&&(m=h[V],m!=null&&gn(o,l,V,m,h,null))}function HO(o,l,h,m){switch(l){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,w=null,E=null,V=null,ot=null,Nt=null,Lt=null;for(Et in h){var Pt=h[Et];if(h.hasOwnProperty(Et)&&Pt!=null)switch(Et){case"checked":break;case"value":break;case"defaultValue":ot=Pt;default:m.hasOwnProperty(Et)||gn(o,l,Et,null,m,Pt)}}for(var Rt in m){var Et=m[Rt];if(Pt=h[Rt],m.hasOwnProperty(Rt)&&(Et!=null||Pt!=null))switch(Rt){case"type":w=Et;break;case"name":b=Et;break;case"checked":Nt=Et;break;case"defaultChecked":Lt=Et;break;case"value":E=Et;break;case"defaultValue":V=Et;break;case"children":case"dangerouslySetInnerHTML":if(Et!=null)throw Error(n(137,l));break;default:Et!==Pt&&gn(o,l,Rt,Et,m,Pt)}}kx(o,E,V,ot,Nt,Lt,w,b);return;case"select":Et=E=V=Rt=null;for(w in h)if(ot=h[w],h.hasOwnProperty(w)&&ot!=null)switch(w){case"value":break;case"multiple":Et=ot;default:m.hasOwnProperty(w)||gn(o,l,w,null,m,ot)}for(b in m)if(w=m[b],ot=h[b],m.hasOwnProperty(b)&&(w!=null||ot!=null))switch(b){case"value":Rt=w;break;case"defaultValue":V=w;break;case"multiple":E=w;default:w!==ot&&gn(o,l,b,w,m,ot)}l=V,h=E,m=Et,Rt!=null?Xu(o,!!h,Rt,!1):!!m!=!!h&&(l!=null?Xu(o,!!h,l,!0):Xu(o,!!h,h?[]:"",!1));return;case"textarea":Et=Rt=null;for(V in h)if(b=h[V],h.hasOwnProperty(V)&&b!=null&&!m.hasOwnProperty(V))switch(V){case"value":break;case"children":break;default:gn(o,l,V,null,m,b)}for(E in m)if(b=m[E],w=h[E],m.hasOwnProperty(E)&&(b!=null||w!=null))switch(E){case"value":Rt=b;break;case"defaultValue":Et=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(n(91));break;default:b!==w&&gn(o,l,E,b,m,w)}E_(o,Rt,Et);return;case"option":for(var ne in h)Rt=h[ne],h.hasOwnProperty(ne)&&Rt!=null&&!m.hasOwnProperty(ne)&&(ne==="selected"?o.selected=!1:gn(o,l,ne,null,m,Rt));for(ot in m)Rt=m[ot],Et=h[ot],m.hasOwnProperty(ot)&&Rt!==Et&&(Rt!=null||Et!=null)&&(ot==="selected"?o.selected=Rt&&typeof Rt!="function"&&typeof Rt!="symbol":gn(o,l,ot,Rt,m,Et));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var pe in h)Rt=h[pe],h.hasOwnProperty(pe)&&Rt!=null&&!m.hasOwnProperty(pe)&&gn(o,l,pe,null,m,Rt);for(Nt in m)if(Rt=m[Nt],Et=h[Nt],m.hasOwnProperty(Nt)&&Rt!==Et&&(Rt!=null||Et!=null))switch(Nt){case"children":case"dangerouslySetInnerHTML":if(Rt!=null)throw Error(n(137,l));break;default:gn(o,l,Nt,Rt,m,Et)}return;default:if(Wx(l)){for(var yn in h)Rt=h[yn],h.hasOwnProperty(yn)&&Rt!==void 0&&!m.hasOwnProperty(yn)&&Cb(o,l,yn,void 0,m,Rt);for(Lt in m)Rt=m[Lt],Et=h[Lt],!m.hasOwnProperty(Lt)||Rt===Et||Rt===void 0&&Et===void 0||Cb(o,l,Lt,Rt,m,Et);return}}for(var bt in h)Rt=h[bt],h.hasOwnProperty(bt)&&Rt!=null&&!m.hasOwnProperty(bt)&&gn(o,l,bt,null,m,Rt);for(Pt in m)Rt=m[Pt],Et=h[Pt],!m.hasOwnProperty(Pt)||Rt===Et||Rt==null&&Et==null||gn(o,l,Pt,Rt,m,Et)}function LA(o){switch(o){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function WO(){if(typeof performance.getEntriesByType=="function"){for(var o=0,l=0,h=performance.getEntriesByType("resource"),m=0;m<h.length;m++){var b=h[m],w=b.transferSize,E=b.initiatorType,V=b.duration;if(w&&V&&LA(E)){for(E=0,V=b.responseEnd,m+=1;m<h.length;m++){var ot=h[m],Nt=ot.startTime;if(Nt>V)break;var Lt=ot.transferSize,Pt=ot.initiatorType;Lt&&LA(Pt)&&(ot=ot.responseEnd,E+=Lt*(ot<V?1:(V-Nt)/(ot-Nt)))}if(--m,l+=8*(w+E)/(b.duration/1e3),o++,10<o)break}}if(0<o)return l/o/1e6}return navigator.connection&&(o=navigator.connection.downlink,typeof o=="number")?o:5}var Bb=null,Db=null;function J0(o){return o.nodeType===9?o:o.ownerDocument}function OA(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function FA(o,l){if(o===0)switch(l){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&l==="foreignObject"?0:o}function Lb(o,l){return o==="textarea"||o==="noscript"||typeof l.children=="string"||typeof l.children=="number"||typeof l.children=="bigint"||typeof l.dangerouslySetInnerHTML=="object"&&l.dangerouslySetInnerHTML!==null&&l.dangerouslySetInnerHTML.__html!=null}var Ob=null;function qO(){var o=window.event;return o&&o.type==="popstate"?o===Ob?!1:(Ob=o,!0):(Ob=null,!1)}var UA=typeof setTimeout=="function"?setTimeout:void 0,$O=typeof clearTimeout=="function"?clearTimeout:void 0,PA=typeof Promise=="function"?Promise:void 0,XO=typeof queueMicrotask=="function"?queueMicrotask:typeof PA<"u"?function(o){return PA.resolve(null).then(o).catch(jO)}:UA;function jO(o){setTimeout(function(){throw o})}function Dl(o){return o==="head"}function zA(o,l){var h=l,m=0;do{var b=h.nextSibling;if(o.removeChild(h),b&&b.nodeType===8)if(h=b.data,h==="/$"||h==="/&"){if(m===0){o.removeChild(b),vh(l);return}m--}else if(h==="$"||h==="$?"||h==="$~"||h==="$!"||h==="&")m++;else if(h==="html")bf(o.ownerDocument.documentElement);else if(h==="head"){h=o.ownerDocument.head,bf(h);for(var w=h.firstChild;w;){var E=w.nextSibling,V=w.nodeName;w[ao]||V==="SCRIPT"||V==="STYLE"||V==="LINK"&&w.rel.toLowerCase()==="stylesheet"||h.removeChild(w),w=E}}else h==="body"&&bf(o.ownerDocument.body);h=b}while(h);vh(l)}function IA(o,l){var h=o;o=0;do{var m=h.nextSibling;if(h.nodeType===1?l?(h._stashedDisplay=h.style.display,h.style.display="none"):(h.style.display=h._stashedDisplay||"",h.getAttribute("style")===""&&h.removeAttribute("style")):h.nodeType===3&&(l?(h._stashedText=h.nodeValue,h.nodeValue=""):h.nodeValue=h._stashedText||""),m&&m.nodeType===8)if(h=m.data,h==="/$"){if(o===0)break;o--}else h!=="$"&&h!=="$?"&&h!=="$~"&&h!=="$!"||o++;h=m}while(h)}function Fb(o){var l=o.firstChild;for(l&&l.nodeType===10&&(l=l.nextSibling);l;){var h=l;switch(l=l.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":Fb(h),ma(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}o.removeChild(h)}}function YO(o,l,h,m){for(;o.nodeType===1;){var b=h;if(o.nodeName.toLowerCase()!==l.toLowerCase()){if(!m&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(m){if(!o[ao])switch(l){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(w=o.getAttribute("rel"),w==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(w!==b.rel||o.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||o.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||o.getAttribute("title")!==(b.title==null?null:b.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(w=o.getAttribute("src"),(w!==(b.src==null?null:b.src)||o.getAttribute("type")!==(b.type==null?null:b.type)||o.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&w&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(l==="input"&&o.type==="hidden"){var w=b.name==null?null:""+b.name;if(b.type==="hidden"&&o.getAttribute("name")===w)return o}else return o;if(o=Ir(o.nextSibling),o===null)break}return null}function KO(o,l,h){if(l==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!h||(o=Ir(o.nextSibling),o===null))return null;return o}function VA(o,l){for(;o.nodeType!==8;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!l||(o=Ir(o.nextSibling),o===null))return null;return o}function Ub(o){return o.data==="$?"||o.data==="$~"}function Pb(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState!=="loading"}function ZO(o,l){var h=o.ownerDocument;if(o.data==="$~")o._reactRetry=l;else if(o.data!=="$?"||h.readyState!=="loading")l();else{var m=function(){l(),h.removeEventListener("DOMContentLoaded",m)};h.addEventListener("DOMContentLoaded",m),o._reactRetry=m}}function Ir(o){for(;o!=null;o=o.nextSibling){var l=o.nodeType;if(l===1||l===3)break;if(l===8){if(l=o.data,l==="$"||l==="$!"||l==="$?"||l==="$~"||l==="&"||l==="F!"||l==="F")break;if(l==="/$"||l==="/&")return null}}return o}var zb=null;function GA(o){o=o.nextSibling;for(var l=0;o;){if(o.nodeType===8){var h=o.data;if(h==="/$"||h==="/&"){if(l===0)return Ir(o.nextSibling);l--}else h!=="$"&&h!=="$!"&&h!=="$?"&&h!=="$~"&&h!=="&"||l++}o=o.nextSibling}return null}function kA(o){o=o.previousSibling;for(var l=0;o;){if(o.nodeType===8){var h=o.data;if(h==="$"||h==="$!"||h==="$?"||h==="$~"||h==="&"){if(l===0)return o;l--}else h!=="/$"&&h!=="/&"||l++}o=o.previousSibling}return null}function HA(o,l,h){switch(l=J0(h),o){case"html":if(o=l.documentElement,!o)throw Error(n(452));return o;case"head":if(o=l.head,!o)throw Error(n(453));return o;case"body":if(o=l.body,!o)throw Error(n(454));return o;default:throw Error(n(451))}}function bf(o){for(var l=o.attributes;l.length;)o.removeAttributeNode(l[0]);ma(o)}var Vr=new Map,WA=new Set;function tm(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var La=K.d;K.d={f:QO,r:JO,D:tF,C:eF,L:nF,m:sF,X:rF,S:iF,M:oF};function QO(){var o=La.f(),l=q0();return o||l}function JO(o){var l=Cr(o);l!==null&&l.tag===5&&l.type==="form"?av(l):La.r(o)}var Th=typeof document>"u"?null:document;function qA(o,l,h){var m=Th;if(m&&typeof l=="string"&&l){var b=Dr(l);b='link[rel="'+o+'"][href="'+b+'"]',typeof h=="string"&&(b+='[crossorigin="'+h+'"]'),WA.has(b)||(WA.add(b),o={rel:o,crossOrigin:h,href:l},m.querySelector(b)===null&&(l=m.createElement("link"),Qs(l,"link",o),wn(l),m.head.appendChild(l)))}}function tF(o){La.D(o),qA("dns-prefetch",o,null)}function eF(o,l){La.C(o,l),qA("preconnect",o,l)}function nF(o,l,h){La.L(o,l,h);var m=Th;if(m&&o&&l){var b='link[rel="preload"][as="'+Dr(l)+'"]';l==="image"&&h&&h.imageSrcSet?(b+='[imagesrcset="'+Dr(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(b+='[imagesizes="'+Dr(h.imageSizes)+'"]')):b+='[href="'+Dr(o)+'"]';var w=b;switch(l){case"style":w=_h(o);break;case"script":w=Mh(o)}Vr.has(w)||(o=p({rel:"preload",href:l==="image"&&h&&h.imageSrcSet?void 0:o,as:l},h),Vr.set(w,o),m.querySelector(b)!==null||l==="style"&&m.querySelector(Sf(w))||l==="script"&&m.querySelector(wf(w))||(l=m.createElement("link"),Qs(l,"link",o),wn(l),m.head.appendChild(l)))}}function sF(o,l){La.m(o,l);var h=Th;if(h&&o){var m=l&&typeof l.as=="string"?l.as:"script",b='link[rel="modulepreload"][as="'+Dr(m)+'"][href="'+Dr(o)+'"]',w=b;switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":w=Mh(o)}if(!Vr.has(w)&&(o=p({rel:"modulepreload",href:o},l),Vr.set(w,o),h.querySelector(b)===null)){switch(m){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(wf(w)))return}m=h.createElement("link"),Qs(m,"link",o),wn(m),h.head.appendChild(m)}}}function iF(o,l,h){La.S(o,l,h);var m=Th;if(m&&o){var b=Ti(m).hoistableStyles,w=_h(o);l=l||"default";var E=b.get(w);if(!E){var V={loading:0,preload:null};if(E=m.querySelector(Sf(w)))V.loading=5;else{o=p({rel:"stylesheet",href:o,"data-precedence":l},h),(h=Vr.get(w))&&Ib(o,h);var ot=E=m.createElement("link");wn(ot),Qs(ot,"link",o),ot._p=new Promise(function(Nt,Lt){ot.onload=Nt,ot.onerror=Lt}),ot.addEventListener("load",function(){V.loading|=1}),ot.addEventListener("error",function(){V.loading|=2}),V.loading|=4,em(E,l,m)}E={type:"stylesheet",instance:E,count:1,state:V},b.set(w,E)}}}function rF(o,l){La.X(o,l);var h=Th;if(h&&o){var m=Ti(h).hoistableScripts,b=Mh(o),w=m.get(b);w||(w=h.querySelector(wf(b)),w||(o=p({src:o,async:!0},l),(l=Vr.get(b))&&Vb(o,l),w=h.createElement("script"),wn(w),Qs(w,"link",o),h.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},m.set(b,w))}}function oF(o,l){La.M(o,l);var h=Th;if(h&&o){var m=Ti(h).hoistableScripts,b=Mh(o),w=m.get(b);w||(w=h.querySelector(wf(b)),w||(o=p({src:o,async:!0,type:"module"},l),(l=Vr.get(b))&&Vb(o,l),w=h.createElement("script"),wn(w),Qs(w,"link",o),h.head.appendChild(w)),w={type:"script",instance:w,count:1,state:null},m.set(b,w))}}function $A(o,l,h,m){var b=(b=W.current)?tm(b):null;if(!b)throw Error(n(446));switch(o){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(l=_h(h.href),h=Ti(b).hoistableStyles,m=h.get(l),m||(m={type:"style",instance:null,count:0,state:null},h.set(l,m)),m):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){o=_h(h.href);var w=Ti(b).hoistableStyles,E=w.get(o);if(E||(b=b.ownerDocument||b,E={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},w.set(o,E),(w=b.querySelector(Sf(o)))&&!w._p&&(E.instance=w,E.state.loading=5),Vr.has(o)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},Vr.set(o,h),w||aF(b,o,h,E.state))),l&&m===null)throw Error(n(528,""));return E}if(l&&m!==null)throw Error(n(529,""));return null;case"script":return l=h.async,h=h.src,typeof h=="string"&&l&&typeof l!="function"&&typeof l!="symbol"?(l=Mh(h),h=Ti(b).hoistableScripts,m=h.get(l),m||(m={type:"script",instance:null,count:0,state:null},h.set(l,m)),m):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,o))}}function _h(o){return'href="'+Dr(o)+'"'}function Sf(o){return'link[rel="stylesheet"]['+o+"]"}function XA(o){return p({},o,{"data-precedence":o.precedence,precedence:null})}function aF(o,l,h,m){o.querySelector('link[rel="preload"][as="style"]['+l+"]")?m.loading=1:(l=o.createElement("link"),m.preload=l,l.addEventListener("load",function(){return m.loading|=1}),l.addEventListener("error",function(){return m.loading|=2}),Qs(l,"link",h),wn(l),o.head.appendChild(l))}function Mh(o){return'[src="'+Dr(o)+'"]'}function wf(o){return"script[async]"+o}function jA(o,l,h){if(l.count++,l.instance===null)switch(l.type){case"style":var m=o.querySelector('style[data-href~="'+Dr(h.href)+'"]');if(m)return l.instance=m,wn(m),m;var b=p({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return m=(o.ownerDocument||o).createElement("style"),wn(m),Qs(m,"style",b),em(m,h.precedence,o),l.instance=m;case"stylesheet":b=_h(h.href);var w=o.querySelector(Sf(b));if(w)return l.state.loading|=4,l.instance=w,wn(w),w;m=XA(h),(b=Vr.get(b))&&Ib(m,b),w=(o.ownerDocument||o).createElement("link"),wn(w);var E=w;return E._p=new Promise(function(V,ot){E.onload=V,E.onerror=ot}),Qs(w,"link",m),l.state.loading|=4,em(w,h.precedence,o),l.instance=w;case"script":return w=Mh(h.src),(b=o.querySelector(wf(w)))?(l.instance=b,wn(b),b):(m=h,(b=Vr.get(w))&&(m=p({},h),Vb(m,b)),o=o.ownerDocument||o,b=o.createElement("script"),wn(b),Qs(b,"link",m),o.head.appendChild(b),l.instance=b);case"void":return null;default:throw Error(n(443,l.type))}else l.type==="stylesheet"&&(l.state.loading&4)===0&&(m=l.instance,l.state.loading|=4,em(m,h.precedence,o));return l.instance}function em(o,l,h){for(var m=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=m.length?m[m.length-1]:null,w=b,E=0;E<m.length;E++){var V=m[E];if(V.dataset.precedence===l)w=V;else if(w!==b)break}w?w.parentNode.insertBefore(o,w.nextSibling):(l=h.nodeType===9?h.head:h,l.insertBefore(o,l.firstChild))}function Ib(o,l){o.crossOrigin==null&&(o.crossOrigin=l.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=l.referrerPolicy),o.title==null&&(o.title=l.title)}function Vb(o,l){o.crossOrigin==null&&(o.crossOrigin=l.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=l.referrerPolicy),o.integrity==null&&(o.integrity=l.integrity)}var nm=null;function YA(o,l,h){if(nm===null){var m=new Map,b=nm=new Map;b.set(h,m)}else b=nm,m=b.get(h),m||(m=new Map,b.set(h,m));if(m.has(o))return m;for(m.set(o,null),h=h.getElementsByTagName(o),b=0;b<h.length;b++){var w=h[b];if(!(w[ao]||w[Kn]||o==="link"&&w.getAttribute("rel")==="stylesheet")&&w.namespaceURI!=="http://www.w3.org/2000/svg"){var E=w.getAttribute(l)||"";E=o+E;var V=m.get(E);V?V.push(w):m.set(E,[w])}}return m}function KA(o,l,h){o=o.ownerDocument||o,o.head.insertBefore(h,l==="title"?o.querySelector("head > title"):null)}function lF(o,l,h){if(h===1||l.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof l.precedence!="string"||typeof l.href!="string"||l.href==="")break;return!0;case"link":if(typeof l.rel!="string"||typeof l.href!="string"||l.href===""||l.onLoad||l.onError)break;return l.rel==="stylesheet"?(o=l.disabled,typeof l.precedence=="string"&&o==null):!0;case"script":if(l.async&&typeof l.async!="function"&&typeof l.async!="symbol"&&!l.onLoad&&!l.onError&&l.src&&typeof l.src=="string")return!0}return!1}function ZA(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}function cF(o,l,h,m){if(h.type==="stylesheet"&&(typeof m.media!="string"||matchMedia(m.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var b=_h(m.href),w=l.querySelector(Sf(b));if(w){l=w._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(o.count++,o=sm.bind(o),l.then(o,o)),h.state.loading|=4,h.instance=w,wn(w);return}w=l.ownerDocument||l,m=XA(m),(b=Vr.get(b))&&Ib(m,b),w=w.createElement("link"),wn(w);var E=w;E._p=new Promise(function(V,ot){E.onload=V,E.onerror=ot}),Qs(w,"link",m),h.instance=w}o.stylesheets===null&&(o.stylesheets=new Map),o.stylesheets.set(h,l),(l=h.state.preload)&&(h.state.loading&3)===0&&(o.count++,h=sm.bind(o),l.addEventListener("load",h),l.addEventListener("error",h))}}var Gb=0;function uF(o,l){return o.stylesheets&&o.count===0&&rm(o,o.stylesheets),0<o.count||0<o.imgCount?function(h){var m=setTimeout(function(){if(o.stylesheets&&rm(o,o.stylesheets),o.unsuspend){var w=o.unsuspend;o.unsuspend=null,w()}},6e4+l);0<o.imgBytes&&Gb===0&&(Gb=62500*WO());var b=setTimeout(function(){if(o.waitingForImages=!1,o.count===0&&(o.stylesheets&&rm(o,o.stylesheets),o.unsuspend)){var w=o.unsuspend;o.unsuspend=null,w()}},(o.imgBytes>Gb?50:800)+l);return o.unsuspend=h,function(){o.unsuspend=null,clearTimeout(m),clearTimeout(b)}}:null}function sm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)rm(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var im=null;function rm(o,l){o.stylesheets=null,o.unsuspend!==null&&(o.count++,im=new Map,l.forEach(hF,o),im=null,sm.call(o))}function hF(o,l){if(!(l.state.loading&4)){var h=im.get(o);if(h)var m=h.get(null);else{h=new Map,im.set(o,h);for(var b=o.querySelectorAll("link[data-precedence],style[data-precedence]"),w=0;w<b.length;w++){var E=b[w];(E.nodeName==="LINK"||E.getAttribute("media")!=="not all")&&(h.set(E.dataset.precedence,E),m=E)}m&&h.set(null,m)}b=l.instance,E=b.getAttribute("data-precedence"),w=h.get(E)||m,w===m&&h.set(null,b),h.set(E,b),this.count++,m=sm.bind(this),b.addEventListener("load",m),b.addEventListener("error",m),w?w.parentNode.insertBefore(b,w.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(b,o.firstChild)),l.state.loading|=4}}var Tf={$$typeof:v,Provider:null,Consumer:null,_currentValue:nt,_currentValue2:nt,_threadCount:0};function dF(o,l,h,m,b,w,E,V,ot){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Nr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Nr(0),this.hiddenUpdates=Nr(null),this.identifierPrefix=m,this.onUncaughtError=b,this.onCaughtError=w,this.onRecoverableError=E,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ot,this.incompleteTransitions=new Map}function QA(o,l,h,m,b,w,E,V,ot,Nt,Lt,Pt){return o=new dF(o,l,h,E,ot,Nt,Lt,Pt,V),l=1,w===!0&&(l|=24),w=ar(3,null,null,l),o.current=w,w.stateNode=o,l=S1(),l.refCount++,o.pooledCache=l,l.refCount++,w.memoizedState={element:m,isDehydrated:h,cache:l},M1(w),o}function JA(o){return o?(o=eh,o):eh}function tN(o,l,h,m,b,w){b=JA(b),m.context===null?m.context=b:m.pendingContext=b,m=wl(l),m.payload={element:h},w=w===void 0?null:w,w!==null&&(m.callback=w),h=Tl(o,m,l),h!==null&&(Hi(h,o,l),Jd(h,o,l))}function eN(o,l){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var h=o.retryLane;o.retryLane=h!==0&&h<l?h:l}}function kb(o,l){eN(o,l),(o=o.alternate)&&eN(o,l)}function nN(o){if(o.tag===13||o.tag===31){var l=kc(o,67108864);l!==null&&Hi(l,o,67108864),kb(o,67108864)}}function sN(o){if(o.tag===13||o.tag===31){var l=dr();l=Si(l);var h=kc(o,l);h!==null&&Hi(h,o,l),kb(o,l)}}var om=!0;function fF(o,l,h,m){var b=U.T;U.T=null;var w=K.p;try{K.p=2,Hb(o,l,h,m)}finally{K.p=w,U.T=b}}function pF(o,l,h,m){var b=U.T;U.T=null;var w=K.p;try{K.p=8,Hb(o,l,h,m)}finally{K.p=w,U.T=b}}function Hb(o,l,h,m){if(om){var b=Wb(m);if(b===null)Eb(o,l,m,am,h),rN(o,m);else if(gF(b,o,l,h,m))m.stopPropagation();else if(rN(o,m),l&4&&-1<mF.indexOf(o)){for(;b!==null;){var w=Cr(b);if(w!==null)switch(w.tag){case 3:if(w=w.stateNode,w.current.memoizedState.isDehydrated){var E=Yn(w.pendingLanes);if(E!==0){var V=w;for(V.pendingLanes|=2,V.entangledLanes|=2;E;){var ot=1<<31-Ue(E);V.entanglements[1]|=ot,E&=~ot}Oo(w),(en&6)===0&&(H0=Yt()+500,gf(0))}}break;case 31:case 13:V=kc(w,2),V!==null&&Hi(V,w,2),q0(),kb(w,2)}if(w=Wb(m),w===null&&Eb(o,l,m,am,h),w===b)break;b=w}b!==null&&m.stopPropagation()}else Eb(o,l,m,null,h)}}function Wb(o){return o=$x(o),qb(o)}var am=null;function qb(o){if(am=null,o=Er(o),o!==null){var l=i(o);if(l===null)o=null;else{var h=l.tag;if(h===13){if(o=a(l),o!==null)return o;o=null}else if(h===31){if(o=c(l),o!==null)return o;o=null}else if(h===3){if(l.stateNode.current.memoizedState.isDehydrated)return l.tag===3?l.stateNode.containerInfo:null;o=null}else l!==o&&(o=null)}}return am=o,null}function iN(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ne()){case ce:return 2;case We:return 8;case Sn:case vn:return 32;case rs:return 268435456;default:return 32}default:return 32}}var $b=!1,Ll=null,Ol=null,Fl=null,_f=new Map,Mf=new Map,Ul=[],mF="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function rN(o,l){switch(o){case"focusin":case"focusout":Ll=null;break;case"dragenter":case"dragleave":Ol=null;break;case"mouseover":case"mouseout":Fl=null;break;case"pointerover":case"pointerout":_f.delete(l.pointerId);break;case"gotpointercapture":case"lostpointercapture":Mf.delete(l.pointerId)}}function vf(o,l,h,m,b,w){return o===null||o.nativeEvent!==w?(o={blockedOn:l,domEventName:h,eventSystemFlags:m,nativeEvent:w,targetContainers:[b]},l!==null&&(l=Cr(l),l!==null&&nN(l)),o):(o.eventSystemFlags|=m,l=o.targetContainers,b!==null&&l.indexOf(b)===-1&&l.push(b),o)}function gF(o,l,h,m,b){switch(l){case"focusin":return Ll=vf(Ll,o,l,h,m,b),!0;case"dragenter":return Ol=vf(Ol,o,l,h,m,b),!0;case"mouseover":return Fl=vf(Fl,o,l,h,m,b),!0;case"pointerover":var w=b.pointerId;return _f.set(w,vf(_f.get(w)||null,o,l,h,m,b)),!0;case"gotpointercapture":return w=b.pointerId,Mf.set(w,vf(Mf.get(w)||null,o,l,h,m,b)),!0}return!1}function oN(o){var l=Er(o.target);if(l!==null){var h=i(l);if(h!==null){if(l=h.tag,l===13){if(l=a(h),l!==null){o.blockedOn=l,dl(o.priority,function(){sN(h)});return}}else if(l===31){if(l=c(h),l!==null){o.blockedOn=l,dl(o.priority,function(){sN(h)});return}}else if(l===3&&h.stateNode.current.memoizedState.isDehydrated){o.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}o.blockedOn=null}function lm(o){if(o.blockedOn!==null)return!1;for(var l=o.targetContainers;0<l.length;){var h=Wb(o.nativeEvent);if(h===null){h=o.nativeEvent;var m=new h.constructor(h.type,h);qx=m,h.target.dispatchEvent(m),qx=null}else return l=Cr(h),l!==null&&nN(l),o.blockedOn=h,!1;l.shift()}return!0}function aN(o,l,h){lm(o)&&h.delete(l)}function yF(){$b=!1,Ll!==null&&lm(Ll)&&(Ll=null),Ol!==null&&lm(Ol)&&(Ol=null),Fl!==null&&lm(Fl)&&(Fl=null),_f.forEach(aN),Mf.forEach(aN)}function cm(o,l){o.blockedOn===l&&(o.blockedOn=null,$b||($b=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,yF)))}var um=null;function lN(o){um!==o&&(um=o,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){um===o&&(um=null);for(var l=0;l<o.length;l+=3){var h=o[l],m=o[l+1],b=o[l+2];if(typeof m!="function"){if(qb(m||h)===null)continue;break}var w=Cr(h);w!==null&&(o.splice(l,3),l-=3,W1(w,{pending:!0,data:b,method:h.method,action:m},m,b))}}))}function vh(o){function l(ot){return cm(ot,o)}Ll!==null&&cm(Ll,o),Ol!==null&&cm(Ol,o),Fl!==null&&cm(Fl,o),_f.forEach(l),Mf.forEach(l);for(var h=0;h<Ul.length;h++){var m=Ul[h];m.blockedOn===o&&(m.blockedOn=null)}for(;0<Ul.length&&(h=Ul[0],h.blockedOn===null);)oN(h),h.blockedOn===null&&Ul.shift();if(h=(o.ownerDocument||o).$$reactFormReplay,h!=null)for(m=0;m<h.length;m+=3){var b=h[m],w=h[m+1],E=b[Ss]||null;if(typeof w=="function")E||lN(h);else if(E){var V=null;if(w&&w.hasAttribute("formAction")){if(b=w,E=w[Ss]||null)V=E.formAction;else if(qb(b)!==null)continue}else V=E.action;typeof V=="function"?h[m+1]=V:(h.splice(m,3),m-=3),lN(h)}}}function cN(){function o(w){w.canIntercept&&w.info==="react-transition"&&w.intercept({handler:function(){return new Promise(function(E){return b=E})},focusReset:"manual",scroll:"manual"})}function l(){b!==null&&(b(),b=null),m||setTimeout(h,20)}function h(){if(!m&&!navigation.transition){var w=navigation.currentEntry;w&&w.url!=null&&navigation.navigate(w.url,{state:w.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var m=!1,b=null;return navigation.addEventListener("navigate",o),navigation.addEventListener("navigatesuccess",l),navigation.addEventListener("navigateerror",l),setTimeout(h,100),function(){m=!0,navigation.removeEventListener("navigate",o),navigation.removeEventListener("navigatesuccess",l),navigation.removeEventListener("navigateerror",l),b!==null&&(b(),b=null)}}}function Xb(o){this._internalRoot=o}hm.prototype.render=Xb.prototype.render=function(o){var l=this._internalRoot;if(l===null)throw Error(n(409));var h=l.current,m=dr();tN(h,m,o,l,null,null)},hm.prototype.unmount=Xb.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var l=o.containerInfo;tN(o.current,2,null,o,null,null),q0(),l[wi]=null}};function hm(o){this._internalRoot=o}hm.prototype.unstable_scheduleHydration=function(o){if(o){var l=oo();o={blockedOn:null,target:o,priority:l};for(var h=0;h<Ul.length&&l!==0&&l<Ul[h].priority;h++);Ul.splice(h,0,o),h===0&&oN(o)}};var uN=t.version;if(uN!=="19.2.4")throw Error(n(527,uN,"19.2.4"));K.findDOMNode=function(o){var l=o._reactInternals;if(l===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=d(l),o=o!==null?f(o):null,o=o===null?null:o.stateNode,o};var xF={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:U,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var dm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!dm.isDisabled&&dm.supportsFiber)try{be=dm.inject(xF),Ze=dm}catch{}}return Nf.createRoot=function(o,l){if(!s(o))throw Error(n(299));var h=!1,m="",b=yv,w=xv,E=bv;return l!=null&&(l.unstable_strictMode===!0&&(h=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onUncaughtError!==void 0&&(b=l.onUncaughtError),l.onCaughtError!==void 0&&(w=l.onCaughtError),l.onRecoverableError!==void 0&&(E=l.onRecoverableError)),l=QA(o,1,!1,null,null,h,m,null,b,w,E,cN),o[wi]=l.current,Rb(o),new Xb(l)},Nf.hydrateRoot=function(o,l,h){if(!s(o))throw Error(n(299));var m=!1,b="",w=yv,E=xv,V=bv,ot=null;return h!=null&&(h.unstable_strictMode===!0&&(m=!0),h.identifierPrefix!==void 0&&(b=h.identifierPrefix),h.onUncaughtError!==void 0&&(w=h.onUncaughtError),h.onCaughtError!==void 0&&(E=h.onCaughtError),h.onRecoverableError!==void 0&&(V=h.onRecoverableError),h.formState!==void 0&&(ot=h.formState)),l=QA(o,1,!0,l,h??null,m,b,ot,w,E,V,cN),l.context=JA(null),h=l.current,m=dr(),m=Si(m),b=wl(m),b.callback=null,Tl(h,b,m),h=m,l.current.lanes=h,Fi(l,h),Oo(l),o[wi]=l.current,Rb(o),new hm(l)},Nf.version="19.2.4",Nf}var SN;function RF(){if(SN)return Yb.exports;SN=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(t){console.error(t)}}return r(),Yb.exports=NF(),Yb.exports}var EF=RF(),ms=bw();const kp="183",CF=0,BF=1,DF=2,LF=0,R3=1,OF=2,cp=3,Qo=0,us=1,En=2,tl=0,fi=1,Sr=2,sd=3,id=4,ld=5,Sw=6,qr=100,E3=101,C3=102,FF=103,UF=104,ic=200,B3=201,D3=202,L3=203,Np=204,Rp=205,O3=206,F3=207,U3=208,P3=209,z3=210,qg=0,$g=1,Xg=2,xd=3,jg=4,Yg=5,Kg=6,Zg=7,Yy=0,PF=1,zF=2,_u=0,IF=1,VF=2,GF=3,ww=4,kF=6,HF=7,Tw=300,bd=301,Qg=302,Ky=303,_w=304,R2=306,Bn=1e3,ji=1001,Sd=1002,ts=1003,I3=1004,Ep=1005,qs=1006,E2=1007,Jo=1008,WF=1008,gi=1009,cd=1010,ud=1011,Mu=1012,di=1013,Qn=1014,Ri=1015,ni=1016,V3=1017,G3=1018,yc=1020,Mw=35902,vw=35899,k3=1021,Zy=1022,Yi=1023,To=1026,el=1027,Hp=1028,Qy=1029,jo=1030,Jy=1031,qF=1032,tx=1033,up=33776,hp=33777,dp=33778,fp=33779,C2=35840,B2=35841,D2=35842,L2=35843,Jg=36196,ty=37492,ey=37496,ny=37488,sy=37489,Cp=37490,iy=37491,ry=37808,oy=37809,ay=37810,ly=37811,cy=37812,uy=37813,hy=37814,dy=37815,fy=37816,py=37817,my=37818,gy=37819,yy=37820,xy=37821,by=36492,$F=36494,XF=36495,Sy=36283,wy=36284,Bp=36285,Ty=36286,nl=0,jF=1,_c="",fn="srgb",_y="srgb-linear",My="linear",ye="srgb",tS="",H3="rg",YF="ga",KF=0,bu=7680,ZF=7681,QF=7682,JF=7683,tU=34055,eU=34056,nU=5386,sU=512,iU=513,rU=514,oU=515,aU=516,lU=517,cU=518,O2=519,W3=512,Aw=513,q3=514,ex=515,$3=516,X3=517,nx=518,j3=519,wd=35044,Dp=35048,wr=2e3,Zr=2001,Yo={COMPUTE:"compute",RENDER:"render"},xc={TEXTURE_COMPARE:"depthTextureCompare"};function uU(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}function vy(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function Ay(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function hU(){const r=Ay("canvas");return r.style.display="block",r}const wN={};function F2(...r){const t="THREE."+r.shift();console.log(t,...r)}function Y3(r){const t=r[0];if(typeof t=="string"&&t.startsWith("TSL:")){const e=r[1];e&&e.isStackTrace?r[0]+=" "+e.getLocation():r[1]='Stack trace not available. Enable "THREE.Node.captureStackTrace" to capture stack traces.'}return r}function Wt(...r){r=Y3(r);const t="THREE."+r.shift();{const e=r[0];e&&e.isStackTrace?console.warn(e.getError(t)):console.warn(t,...r)}}function Ht(...r){r=Y3(r);const t="THREE."+r.shift();{const e=r[0];e&&e.isStackTrace?console.error(e.getError(t)):console.error(t,...r)}}function rn(...r){const t=r.join(" ");t in wN||(wN[t]=!0,Wt(...r))}const K3={[qg]:$g,[Xg]:Kg,[jg]:Zg,[xd]:Yg,[$g]:qg,[Kg]:Xg,[Zg]:jg,[Yg]:xd};class Rc{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[t]===void 0&&(n[t]=[]),n[t].indexOf(e)===-1&&n[t].push(e)}hasEventListener(t,e){const n=this._listeners;return n===void 0?!1:n[t]!==void 0&&n[t].indexOf(e)!==-1}removeEventListener(t,e){const n=this._listeners;if(n===void 0)return;const s=n[t];if(s!==void 0){const i=s.indexOf(e);i!==-1&&s.splice(i,1)}}dispatchEvent(t){const e=this._listeners;if(e===void 0)return;const n=e[t.type];if(n!==void 0){t.target=this;const s=n.slice(0);for(let i=0,a=s.length;i<a;i++)s[i].call(this,t);t.target=null}}}const ai=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let TN=1234567;const pp=Math.PI/180,Td=180/Math.PI;function ta(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(ai[r&255]+ai[r>>8&255]+ai[r>>16&255]+ai[r>>24&255]+"-"+ai[t&255]+ai[t>>8&255]+"-"+ai[t>>16&15|64]+ai[t>>24&255]+"-"+ai[e&63|128]+ai[e>>8&255]+"-"+ai[e>>16&255]+ai[e>>24&255]+ai[n&255]+ai[n>>8&255]+ai[n>>16&255]+ai[n>>24&255]).toLowerCase()}function Ee(r,t,e){return Math.max(t,Math.min(e,r))}function Nw(r,t){return(r%t+t)%t}function dU(r,t,e,n,s){return n+(r-t)*(s-n)/(e-t)}function fU(r,t,e){return r!==t?(e-r)/(t-r):0}function mp(r,t,e){return(1-e)*r+e*t}function pU(r,t,e,n){return mp(r,t,1-Math.exp(-e*n))}function mU(r,t=1){return t-Math.abs(Nw(r,t*2)-t)}function gU(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*(3-2*r))}function yU(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*r*(r*(r*6-15)+10))}function xU(r,t){return r+Math.floor(Math.random()*(t-r+1))}function bU(r,t){return r+Math.random()*(t-r)}function SU(r){return r*(.5-Math.random())}function wU(r){r!==void 0&&(TN=r);let t=TN+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function TU(r){return r*pp}function _U(r){return r*Td}function MU(r){return(r&r-1)===0&&r!==0}function vU(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function AU(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function NU(r,t,e,n,s){const i=Math.cos,a=Math.sin,c=i(e/2),u=a(e/2),d=i((t+n)/2),f=a((t+n)/2),p=i((t-n)/2),g=a((t-n)/2),y=i((n-t)/2),x=a((n-t)/2);switch(s){case"XYX":r.set(c*f,u*p,u*g,c*d);break;case"YZY":r.set(u*g,c*f,u*p,c*d);break;case"ZXZ":r.set(u*p,u*g,c*f,c*d);break;case"XZX":r.set(c*f,u*x,u*y,c*d);break;case"YXY":r.set(u*y,c*f,u*x,c*d);break;case"ZYZ":r.set(u*x,u*y,c*f,c*d);break;default:Wt("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Ei(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function ve(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const xt={DEG2RAD:pp,RAD2DEG:Td,generateUUID:ta,clamp:Ee,euclideanModulo:Nw,mapLinear:dU,inverseLerp:fU,lerp:mp,damp:pU,pingpong:mU,smoothstep:gU,smootherstep:yU,randInt:xU,randFloat:bU,randFloatSpread:SU,seededRandom:wU,degToRad:TU,radToDeg:_U,isPowerOfTwo:MU,ceilPowerOfTwo:vU,floorPowerOfTwo:AU,setQuaternionFromProperEuler:NU,normalize:ve,denormalize:Ei};class Ot{constructor(t=0,e=0){Ot.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,s=t.elements;return this.x=s[0]*e+s[3]*n+s[6],this.y=s[1]*e+s[4]*n+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Ee(this.x,t.x,e.x),this.y=Ee(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=Ee(this.x,t,e),this.y=Ee(this.y,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Ee(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Ee(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),s=Math.sin(e),i=this.x-t.x,a=this.y-t.y;return this.x=i*n-a*s+t.x,this.y=i*s+a*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Us{constructor(t=0,e=0,n=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=n,this._w=s}static slerpFlat(t,e,n,s,i,a,c){let u=n[s+0],d=n[s+1],f=n[s+2],p=n[s+3],g=i[a+0],y=i[a+1],x=i[a+2],S=i[a+3];if(p!==S||u!==g||d!==y||f!==x){let T=u*g+d*y+f*x+p*S;T<0&&(g=-g,y=-y,x=-x,S=-S,T=-T);let M=1-c;if(T<.9995){const N=Math.acos(T),v=Math.sin(N);M=Math.sin(M*N)/v,c=Math.sin(c*N)/v,u=u*M+g*c,d=d*M+y*c,f=f*M+x*c,p=p*M+S*c}else{u=u*M+g*c,d=d*M+y*c,f=f*M+x*c,p=p*M+S*c;const N=1/Math.sqrt(u*u+d*d+f*f+p*p);u*=N,d*=N,f*=N,p*=N}}t[e]=u,t[e+1]=d,t[e+2]=f,t[e+3]=p}static multiplyQuaternionsFlat(t,e,n,s,i,a){const c=n[s],u=n[s+1],d=n[s+2],f=n[s+3],p=i[a],g=i[a+1],y=i[a+2],x=i[a+3];return t[e]=c*x+f*p+u*y-d*g,t[e+1]=u*x+f*g+d*p-c*y,t[e+2]=d*x+f*y+c*g-u*p,t[e+3]=f*x-c*p-u*g-d*y,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,s){return this._x=t,this._y=e,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const n=t._x,s=t._y,i=t._z,a=t._order,c=Math.cos,u=Math.sin,d=c(n/2),f=c(s/2),p=c(i/2),g=u(n/2),y=u(s/2),x=u(i/2);switch(a){case"XYZ":this._x=g*f*p+d*y*x,this._y=d*y*p-g*f*x,this._z=d*f*x+g*y*p,this._w=d*f*p-g*y*x;break;case"YXZ":this._x=g*f*p+d*y*x,this._y=d*y*p-g*f*x,this._z=d*f*x-g*y*p,this._w=d*f*p+g*y*x;break;case"ZXY":this._x=g*f*p-d*y*x,this._y=d*y*p+g*f*x,this._z=d*f*x+g*y*p,this._w=d*f*p-g*y*x;break;case"ZYX":this._x=g*f*p-d*y*x,this._y=d*y*p+g*f*x,this._z=d*f*x-g*y*p,this._w=d*f*p+g*y*x;break;case"YZX":this._x=g*f*p+d*y*x,this._y=d*y*p+g*f*x,this._z=d*f*x-g*y*p,this._w=d*f*p-g*y*x;break;case"XZY":this._x=g*f*p-d*y*x,this._y=d*y*p-g*f*x,this._z=d*f*x+g*y*p,this._w=d*f*p+g*y*x;break;default:Wt("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,s=Math.sin(n);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],s=e[4],i=e[8],a=e[1],c=e[5],u=e[9],d=e[2],f=e[6],p=e[10],g=n+c+p;if(g>0){const y=.5/Math.sqrt(g+1);this._w=.25/y,this._x=(f-u)*y,this._y=(i-d)*y,this._z=(a-s)*y}else if(n>c&&n>p){const y=2*Math.sqrt(1+n-c-p);this._w=(f-u)/y,this._x=.25*y,this._y=(s+a)/y,this._z=(i+d)/y}else if(c>p){const y=2*Math.sqrt(1+c-n-p);this._w=(i-d)/y,this._x=(s+a)/y,this._y=.25*y,this._z=(u+f)/y}else{const y=2*Math.sqrt(1+p-n-c);this._w=(a-s)/y,this._x=(i+d)/y,this._y=(u+f)/y,this._z=.25*y}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<1e-8?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(Ee(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(n===0)return this;const s=Math.min(1,e/n);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,s=t._y,i=t._z,a=t._w,c=e._x,u=e._y,d=e._z,f=e._w;return this._x=n*f+a*c+s*d-i*u,this._y=s*f+a*u+i*c-n*d,this._z=i*f+a*d+n*u-s*c,this._w=a*f-n*c-s*u-i*d,this._onChangeCallback(),this}slerp(t,e){let n=t._x,s=t._y,i=t._z,a=t._w,c=this.dot(t);c<0&&(n=-n,s=-s,i=-i,a=-a,c=-c);let u=1-e;if(c<.9995){const d=Math.acos(c),f=Math.sin(d);u=Math.sin(u*d)/f,e=Math.sin(e*d)/f,this._x=this._x*u+n*e,this._y=this._y*u+s*e,this._z=this._z*u+i*e,this._w=this._w*u+a*e,this._onChangeCallback()}else this._x=this._x*u+n*e,this._y=this._y*u+s*e,this._z=this._z*u+i*e,this._w=this._w*u+a*e,this.normalize();return this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),n=Math.random(),s=Math.sqrt(1-n),i=Math.sqrt(n);return this.set(s*Math.sin(t),s*Math.cos(t),i*Math.sin(e),i*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class G{constructor(t=0,e=0,n=0){G.prototype.isVector3=!0,this.x=t,this.y=e,this.z=n}set(t,e,n){return n===void 0&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(_N.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(_N.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,s=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*s,this.y=i[1]*e+i[4]*n+i[7]*s,this.z=i[2]*e+i[5]*n+i[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,s=this.z,i=t.elements,a=1/(i[3]*e+i[7]*n+i[11]*s+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*s+i[12])*a,this.y=(i[1]*e+i[5]*n+i[9]*s+i[13])*a,this.z=(i[2]*e+i[6]*n+i[10]*s+i[14])*a,this}applyQuaternion(t){const e=this.x,n=this.y,s=this.z,i=t.x,a=t.y,c=t.z,u=t.w,d=2*(a*s-c*n),f=2*(c*e-i*s),p=2*(i*n-a*e);return this.x=e+u*d+a*p-c*f,this.y=n+u*f+c*d-i*p,this.z=s+u*p+i*f-a*d,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,s=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*s,this.y=i[1]*e+i[5]*n+i[9]*s,this.z=i[2]*e+i[6]*n+i[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Ee(this.x,t.x,e.x),this.y=Ee(this.y,t.y,e.y),this.z=Ee(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=Ee(this.x,t,e),this.y=Ee(this.y,t,e),this.z=Ee(this.z,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Ee(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,s=t.y,i=t.z,a=e.x,c=e.y,u=e.z;return this.x=s*u-i*c,this.y=i*a-n*u,this.z=n*c-s*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return eS.copy(this).projectOnVector(t),this.sub(eS)}reflect(t){return this.sub(eS.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(Ee(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,s=this.z-t.z;return e*e+n*n+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const s=Math.sin(e)*t;return this.x=s*Math.sin(n),this.y=Math.cos(e)*t,this.z=s*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,n=Math.sqrt(1-e*e);return this.x=n*Math.cos(t),this.y=e,this.z=n*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const eS=new G,_N=new Us;class sr{constructor(t,e,n,s,i,a,c,u,d){sr.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,n,s,i,a,c,u,d)}set(t,e,n,s,i,a,c,u,d){const f=this.elements;return f[0]=t,f[1]=s,f[2]=c,f[3]=e,f[4]=i,f[5]=u,f[6]=n,f[7]=a,f[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,s=e.elements,i=this.elements,a=n[0],c=n[3],u=n[6],d=n[1],f=n[4],p=n[7],g=n[2],y=n[5],x=n[8],S=s[0],T=s[3],M=s[6],N=s[1],v=s[4],A=s[7],R=s[2],F=s[5],D=s[8];return i[0]=a*S+c*N+u*R,i[3]=a*T+c*v+u*F,i[6]=a*M+c*A+u*D,i[1]=d*S+f*N+p*R,i[4]=d*T+f*v+p*F,i[7]=d*M+f*A+p*D,i[2]=g*S+y*N+x*R,i[5]=g*T+y*v+x*F,i[8]=g*M+y*A+x*D,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],s=t[2],i=t[3],a=t[4],c=t[5],u=t[6],d=t[7],f=t[8];return e*a*f-e*c*d-n*i*f+n*c*u+s*i*d-s*a*u}invert(){const t=this.elements,e=t[0],n=t[1],s=t[2],i=t[3],a=t[4],c=t[5],u=t[6],d=t[7],f=t[8],p=f*a-c*d,g=c*u-f*i,y=d*i-a*u,x=e*p+n*g+s*y;if(x===0)return this.set(0,0,0,0,0,0,0,0,0);const S=1/x;return t[0]=p*S,t[1]=(s*d-f*n)*S,t[2]=(c*n-s*a)*S,t[3]=g*S,t[4]=(f*e-s*u)*S,t[5]=(s*i-c*e)*S,t[6]=y*S,t[7]=(n*u-d*e)*S,t[8]=(a*e-n*i)*S,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,s,i,a,c){const u=Math.cos(i),d=Math.sin(i);return this.set(n*u,n*d,-n*(u*a+d*c)+a+t,-s*d,s*u,-s*(-d*a+u*c)+c+e,0,0,1),this}scale(t,e){return this.premultiply(nS.makeScale(t,e)),this}rotate(t){return this.premultiply(nS.makeRotation(-t)),this}translate(t,e){return this.premultiply(nS.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,n,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,n=t.elements;for(let s=0;s<9;s++)if(e[s]!==n[s])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const nS=new sr,MN=new sr().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),vN=new sr().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function RU(){const r={enabled:!0,workingColorSpace:_y,spaces:{},convert:function(s,i,a){return this.enabled===!1||i===a||!i||!a||(this.spaces[i].transfer===ye&&(s.r=sl(s.r),s.g=sl(s.g),s.b=sl(s.b)),this.spaces[i].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[i].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===ye&&(s.r=hd(s.r),s.g=hd(s.g),s.b=hd(s.b))),s},workingToColorSpace:function(s,i){return this.convert(s,this.workingColorSpace,i)},colorSpaceToWorking:function(s,i){return this.convert(s,i,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===_c?My:this.spaces[s].transfer},getToneMappingMode:function(s){return this.spaces[s].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(s,i=this.workingColorSpace){return s.fromArray(this.spaces[i].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,i,a){return s.copy(this.spaces[i].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,i){return rn("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),r.workingToColorSpace(s,i)},toWorkingColorSpace:function(s,i){return rn("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),r.colorSpaceToWorking(s,i)}},t=[.64,.33,.3,.6,.15,.06],e=[.2126,.7152,.0722],n=[.3127,.329];return r.define({[_y]:{primaries:t,whitePoint:n,transfer:My,toXYZ:MN,fromXYZ:vN,luminanceCoefficients:e,workingColorSpaceConfig:{unpackColorSpace:fn},outputColorSpaceConfig:{drawingBufferColorSpace:fn}},[fn]:{primaries:t,whitePoint:n,transfer:ye,toXYZ:MN,fromXYZ:vN,luminanceCoefficients:e,outputColorSpaceConfig:{drawingBufferColorSpace:fn}}}),r}const qe=RU();function sl(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function hd(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let Ah;class EU{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let n;if(t instanceof HTMLCanvasElement)n=t;else{Ah===void 0&&(Ah=Ay("canvas")),Ah.width=t.width,Ah.height=t.height;const s=Ah.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),n=Ah}return n.toDataURL(e)}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Ay("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const s=n.getImageData(0,0,t.width,t.height),i=s.data;for(let a=0;a<i.length;a++)i[a]=sl(i[a]/255)*255;return n.putImageData(s,0,0),e}else if(t.data){const e=t.data.slice(0);for(let n=0;n<e.length;n++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[n]=Math.floor(sl(e[n]/255)*255):e[n]=sl(e[n]);return{data:e,width:t.width,height:t.height}}else return Wt("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let CU=0;class Rw{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:CU++}),this.uuid=ta(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):typeof VideoFrame<"u"&&e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):e!==null?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let i;if(Array.isArray(s)){i=[];for(let a=0,c=s.length;a<c;a++)s[a].isDataTexture?i.push(sS(s[a].image)):i.push(sS(s[a]))}else i=sS(s);n.url=i}return e||(t.images[this.uuid]=n),n}}function sS(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?EU.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(Wt("Texture: Unable to serialize Texture."),{})}let BU=0;const iS=new G;class ns extends Rc{constructor(t=ns.DEFAULT_IMAGE,e=ns.DEFAULT_MAPPING,n=ji,s=ji,i=qs,a=Jo,c=Yi,u=gi,d=ns.DEFAULT_ANISOTROPY,f=_c){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:BU++}),this.uuid=ta(),this.name="",this.source=new Rw(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=n,this.wrapT=s,this.magFilter=i,this.minFilter=a,this.anisotropy=d,this.format=c,this.internalFormat=null,this.type=u,this.offset=new Ot(0,0),this.repeat=new Ot(1,1),this.center=new Ot(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new sr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=f,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(iS).x}get height(){return this.source.getSize(iS).y}get depth(){return this.source.getSize(iS).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const n=t[e];if(n===void 0){Wt(`Texture.setValues(): parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){Wt(`Texture.setValues(): property '${e}' does not exist.`);continue}s&&n&&s.isVector2&&n.isVector2||s&&n&&s.isVector3&&n.isVector3||s&&n&&s.isMatrix3&&n.isMatrix3?s.copy(n):this[e]=n}}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Tw)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Bn:t.x=t.x-Math.floor(t.x);break;case ji:t.x=t.x<0?0:1;break;case Sd:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Bn:t.y=t.y-Math.floor(t.y);break;case ji:t.y=t.y<0?0:1;break;case Sd:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}ns.DEFAULT_IMAGE=null;ns.DEFAULT_MAPPING=Tw;ns.DEFAULT_ANISOTROPY=1;class je{constructor(t=0,e=0,n=0,s=1){je.prototype.isVector4=!0,this.x=t,this.y=e,this.z=n,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,s){return this.x=t,this.y=e,this.z=n,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,s=this.z,i=this.w,a=t.elements;return this.x=a[0]*e+a[4]*n+a[8]*s+a[12]*i,this.y=a[1]*e+a[5]*n+a[9]*s+a[13]*i,this.z=a[2]*e+a[6]*n+a[10]*s+a[14]*i,this.w=a[3]*e+a[7]*n+a[11]*s+a[15]*i,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,s,i;const u=t.elements,d=u[0],f=u[4],p=u[8],g=u[1],y=u[5],x=u[9],S=u[2],T=u[6],M=u[10];if(Math.abs(f-g)<.01&&Math.abs(p-S)<.01&&Math.abs(x-T)<.01){if(Math.abs(f+g)<.1&&Math.abs(p+S)<.1&&Math.abs(x+T)<.1&&Math.abs(d+y+M-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const v=(d+1)/2,A=(y+1)/2,R=(M+1)/2,F=(f+g)/4,D=(p+S)/4,O=(x+T)/4;return v>A&&v>R?v<.01?(n=0,s=.707106781,i=.707106781):(n=Math.sqrt(v),s=F/n,i=D/n):A>R?A<.01?(n=.707106781,s=0,i=.707106781):(s=Math.sqrt(A),n=F/s,i=O/s):R<.01?(n=.707106781,s=.707106781,i=0):(i=Math.sqrt(R),n=D/i,s=O/i),this.set(n,s,i,e),this}let N=Math.sqrt((T-x)*(T-x)+(p-S)*(p-S)+(g-f)*(g-f));return Math.abs(N)<.001&&(N=1),this.x=(T-x)/N,this.y=(p-S)/N,this.z=(g-f)/N,this.w=Math.acos((d+y+M-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Ee(this.x,t.x,e.x),this.y=Ee(this.y,t.y,e.y),this.z=Ee(this.z,t.z,e.z),this.w=Ee(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=Ee(this.x,t,e),this.y=Ee(this.y,t,e),this.z=Ee(this.z,t,e),this.w=Ee(this.w,t,e),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Ee(n,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class cl extends Rc{constructor(t=1,e=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:qs,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=n.depth,this.scissor=new je(0,0,t,e),this.scissorTest=!1,this.viewport=new je(0,0,t,e),this.textures=[];const s={width:t,height:e,depth:n.depth},i=new ns(s),a=n.count;for(let c=0;c<a;c++)this.textures[c]=i.clone(),this.textures[c].isRenderTargetTexture=!0,this.textures[c].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(t={}){const e={minFilter:qs,generateMipmaps:!1,flipY:!1,internalFormat:null};t.mapping!==void 0&&(e.mapping=t.mapping),t.wrapS!==void 0&&(e.wrapS=t.wrapS),t.wrapT!==void 0&&(e.wrapT=t.wrapT),t.wrapR!==void 0&&(e.wrapR=t.wrapR),t.magFilter!==void 0&&(e.magFilter=t.magFilter),t.minFilter!==void 0&&(e.minFilter=t.minFilter),t.format!==void 0&&(e.format=t.format),t.type!==void 0&&(e.type=t.type),t.anisotropy!==void 0&&(e.anisotropy=t.anisotropy),t.colorSpace!==void 0&&(e.colorSpace=t.colorSpace),t.flipY!==void 0&&(e.flipY=t.flipY),t.generateMipmaps!==void 0&&(e.generateMipmaps=t.generateMipmaps),t.internalFormat!==void 0&&(e.internalFormat=t.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(e)}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),t!==null&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let s=0,i=this.textures.length;s<i;s++)this.textures[s].image.width=t,this.textures[s].image.height=e,this.textures[s].image.depth=n,this.textures[s].isData3DTexture!==!0&&(this.textures[s].isArrayTexture=this.textures[s].image.depth>1);this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,n=t.textures.length;e<n;e++){this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;const s=Object.assign({},t.textures[e].image);this.textures[e].source=new Rw(s)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class DU extends ns{constructor(t=null,e=1,n=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:n,depth:s},this.magFilter=ts,this.minFilter=ts,this.wrapR=ji,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class Te{constructor(t,e,n,s,i,a,c,u,d,f,p,g,y,x,S,T){Te.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,n,s,i,a,c,u,d,f,p,g,y,x,S,T)}set(t,e,n,s,i,a,c,u,d,f,p,g,y,x,S,T){const M=this.elements;return M[0]=t,M[4]=e,M[8]=n,M[12]=s,M[1]=i,M[5]=a,M[9]=c,M[13]=u,M[2]=d,M[6]=f,M[10]=p,M[14]=g,M[3]=y,M[7]=x,M[11]=S,M[15]=T,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Te().fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return this.determinant()===0?(t.set(1,0,0),e.set(0,1,0),n.set(0,0,1),this):(t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this)}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){if(t.determinant()===0)return this.identity();const e=this.elements,n=t.elements,s=1/Nh.setFromMatrixColumn(t,0).length(),i=1/Nh.setFromMatrixColumn(t,1).length(),a=1/Nh.setFromMatrixColumn(t,2).length();return e[0]=n[0]*s,e[1]=n[1]*s,e[2]=n[2]*s,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,n=t.x,s=t.y,i=t.z,a=Math.cos(n),c=Math.sin(n),u=Math.cos(s),d=Math.sin(s),f=Math.cos(i),p=Math.sin(i);if(t.order==="XYZ"){const g=a*f,y=a*p,x=c*f,S=c*p;e[0]=u*f,e[4]=-u*p,e[8]=d,e[1]=y+x*d,e[5]=g-S*d,e[9]=-c*u,e[2]=S-g*d,e[6]=x+y*d,e[10]=a*u}else if(t.order==="YXZ"){const g=u*f,y=u*p,x=d*f,S=d*p;e[0]=g+S*c,e[4]=x*c-y,e[8]=a*d,e[1]=a*p,e[5]=a*f,e[9]=-c,e[2]=y*c-x,e[6]=S+g*c,e[10]=a*u}else if(t.order==="ZXY"){const g=u*f,y=u*p,x=d*f,S=d*p;e[0]=g-S*c,e[4]=-a*p,e[8]=x+y*c,e[1]=y+x*c,e[5]=a*f,e[9]=S-g*c,e[2]=-a*d,e[6]=c,e[10]=a*u}else if(t.order==="ZYX"){const g=a*f,y=a*p,x=c*f,S=c*p;e[0]=u*f,e[4]=x*d-y,e[8]=g*d+S,e[1]=u*p,e[5]=S*d+g,e[9]=y*d-x,e[2]=-d,e[6]=c*u,e[10]=a*u}else if(t.order==="YZX"){const g=a*u,y=a*d,x=c*u,S=c*d;e[0]=u*f,e[4]=S-g*p,e[8]=x*p+y,e[1]=p,e[5]=a*f,e[9]=-c*f,e[2]=-d*f,e[6]=y*p+x,e[10]=g-S*p}else if(t.order==="XZY"){const g=a*u,y=a*d,x=c*u,S=c*d;e[0]=u*f,e[4]=-p,e[8]=d*f,e[1]=g*p+S,e[5]=a*f,e[9]=y*p-x,e[2]=x*p-y,e[6]=c*f,e[10]=S*p+g}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(LU,t,OU)}lookAt(t,e,n){const s=this.elements;return fr.subVectors(t,e),fr.lengthSq()===0&&(fr.z=1),fr.normalize(),zl.crossVectors(n,fr),zl.lengthSq()===0&&(Math.abs(n.z)===1?fr.x+=1e-4:fr.z+=1e-4,fr.normalize(),zl.crossVectors(n,fr)),zl.normalize(),fm.crossVectors(fr,zl),s[0]=zl.x,s[4]=fm.x,s[8]=fr.x,s[1]=zl.y,s[5]=fm.y,s[9]=fr.y,s[2]=zl.z,s[6]=fm.z,s[10]=fr.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,s=e.elements,i=this.elements,a=n[0],c=n[4],u=n[8],d=n[12],f=n[1],p=n[5],g=n[9],y=n[13],x=n[2],S=n[6],T=n[10],M=n[14],N=n[3],v=n[7],A=n[11],R=n[15],F=s[0],D=s[4],O=s[8],B=s[12],z=s[1],tt=s[5],j=s[9],dt=s[13],wt=s[2],ft=s[6],U=s[10],K=s[14],nt=s[3],ht=s[7],_t=s[11],P=s[15];return i[0]=a*F+c*z+u*wt+d*nt,i[4]=a*D+c*tt+u*ft+d*ht,i[8]=a*O+c*j+u*U+d*_t,i[12]=a*B+c*dt+u*K+d*P,i[1]=f*F+p*z+g*wt+y*nt,i[5]=f*D+p*tt+g*ft+y*ht,i[9]=f*O+p*j+g*U+y*_t,i[13]=f*B+p*dt+g*K+y*P,i[2]=x*F+S*z+T*wt+M*nt,i[6]=x*D+S*tt+T*ft+M*ht,i[10]=x*O+S*j+T*U+M*_t,i[14]=x*B+S*dt+T*K+M*P,i[3]=N*F+v*z+A*wt+R*nt,i[7]=N*D+v*tt+A*ft+R*ht,i[11]=N*O+v*j+A*U+R*_t,i[15]=N*B+v*dt+A*K+R*P,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],s=t[8],i=t[12],a=t[1],c=t[5],u=t[9],d=t[13],f=t[2],p=t[6],g=t[10],y=t[14],x=t[3],S=t[7],T=t[11],M=t[15],N=u*y-d*g,v=c*y-d*p,A=c*g-u*p,R=a*y-d*f,F=a*g-u*f,D=a*p-c*f;return e*(S*N-T*v+M*A)-n*(x*N-T*R+M*F)+s*(x*v-S*R+M*D)-i*(x*A-S*F+T*D)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],s=t[2],i=t[3],a=t[4],c=t[5],u=t[6],d=t[7],f=t[8],p=t[9],g=t[10],y=t[11],x=t[12],S=t[13],T=t[14],M=t[15],N=e*c-n*a,v=e*u-s*a,A=e*d-i*a,R=n*u-s*c,F=n*d-i*c,D=s*d-i*u,O=f*S-p*x,B=f*T-g*x,z=f*M-y*x,tt=p*T-g*S,j=p*M-y*S,dt=g*M-y*T,wt=N*dt-v*j+A*tt+R*z-F*B+D*O;if(wt===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ft=1/wt;return t[0]=(c*dt-u*j+d*tt)*ft,t[1]=(s*j-n*dt-i*tt)*ft,t[2]=(S*D-T*F+M*R)*ft,t[3]=(g*F-p*D-y*R)*ft,t[4]=(u*z-a*dt-d*B)*ft,t[5]=(e*dt-s*z+i*B)*ft,t[6]=(T*A-x*D-M*v)*ft,t[7]=(f*D-g*A+y*v)*ft,t[8]=(a*j-c*z+d*O)*ft,t[9]=(n*z-e*j-i*O)*ft,t[10]=(x*F-S*A+M*N)*ft,t[11]=(p*A-f*F-y*N)*ft,t[12]=(c*B-a*tt-u*O)*ft,t[13]=(e*tt-n*B+s*O)*ft,t[14]=(S*v-x*R-T*N)*ft,t[15]=(f*R-p*v+g*N)*ft,this}scale(t){const e=this.elements,n=t.x,s=t.y,i=t.z;return e[0]*=n,e[4]*=s,e[8]*=i,e[1]*=n,e[5]*=s,e[9]*=i,e[2]*=n,e[6]*=s,e[10]*=i,e[3]*=n,e[7]*=s,e[11]*=i,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,s))}makeTranslation(t,e,n){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),s=Math.sin(e),i=1-n,a=t.x,c=t.y,u=t.z,d=i*a,f=i*c;return this.set(d*a+n,d*c-s*u,d*u+s*c,0,d*c+s*u,f*c+n,f*u-s*a,0,d*u-s*c,f*u+s*a,i*u*u+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,s,i,a){return this.set(1,n,i,0,t,1,a,0,e,s,1,0,0,0,0,1),this}compose(t,e,n){const s=this.elements,i=e._x,a=e._y,c=e._z,u=e._w,d=i+i,f=a+a,p=c+c,g=i*d,y=i*f,x=i*p,S=a*f,T=a*p,M=c*p,N=u*d,v=u*f,A=u*p,R=n.x,F=n.y,D=n.z;return s[0]=(1-(S+M))*R,s[1]=(y+A)*R,s[2]=(x-v)*R,s[3]=0,s[4]=(y-A)*F,s[5]=(1-(g+M))*F,s[6]=(T+N)*F,s[7]=0,s[8]=(x+v)*D,s[9]=(T-N)*D,s[10]=(1-(g+S))*D,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,n){const s=this.elements;t.x=s[12],t.y=s[13],t.z=s[14];const i=this.determinant();if(i===0)return n.set(1,1,1),e.identity(),this;let a=Nh.set(s[0],s[1],s[2]).length();const c=Nh.set(s[4],s[5],s[6]).length(),u=Nh.set(s[8],s[9],s[10]).length();i<0&&(a=-a),fo.copy(this);const d=1/a,f=1/c,p=1/u;return fo.elements[0]*=d,fo.elements[1]*=d,fo.elements[2]*=d,fo.elements[4]*=f,fo.elements[5]*=f,fo.elements[6]*=f,fo.elements[8]*=p,fo.elements[9]*=p,fo.elements[10]*=p,e.setFromRotationMatrix(fo),n.x=a,n.y=c,n.z=u,this}makePerspective(t,e,n,s,i,a,c=wr,u=!1){const d=this.elements,f=2*i/(e-t),p=2*i/(n-s),g=(e+t)/(e-t),y=(n+s)/(n-s);let x,S;if(u)x=i/(a-i),S=a*i/(a-i);else if(c===wr)x=-(a+i)/(a-i),S=-2*a*i/(a-i);else if(c===Zr)x=-a/(a-i),S=-a*i/(a-i);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+c);return d[0]=f,d[4]=0,d[8]=g,d[12]=0,d[1]=0,d[5]=p,d[9]=y,d[13]=0,d[2]=0,d[6]=0,d[10]=x,d[14]=S,d[3]=0,d[7]=0,d[11]=-1,d[15]=0,this}makeOrthographic(t,e,n,s,i,a,c=wr,u=!1){const d=this.elements,f=2/(e-t),p=2/(n-s),g=-(e+t)/(e-t),y=-(n+s)/(n-s);let x,S;if(u)x=1/(a-i),S=a/(a-i);else if(c===wr)x=-2/(a-i),S=-(a+i)/(a-i);else if(c===Zr)x=-1/(a-i),S=-i/(a-i);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+c);return d[0]=f,d[4]=0,d[8]=0,d[12]=g,d[1]=0,d[5]=p,d[9]=0,d[13]=y,d[2]=0,d[6]=0,d[10]=x,d[14]=S,d[3]=0,d[7]=0,d[11]=0,d[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let s=0;s<16;s++)if(e[s]!==n[s])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}const Nh=new G,fo=new Te,LU=new G(0,0,0),OU=new G(1,1,1),zl=new G,fm=new G,fr=new G,AN=new Te,NN=new Us;class Ji{constructor(t=0,e=0,n=0,s=Ji.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=n,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,s=this._order){return this._x=t,this._y=e,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const s=t.elements,i=s[0],a=s[4],c=s[8],u=s[1],d=s[5],f=s[9],p=s[2],g=s[6],y=s[10];switch(e){case"XYZ":this._y=Math.asin(Ee(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-f,y),this._z=Math.atan2(-a,i)):(this._x=Math.atan2(g,d),this._z=0);break;case"YXZ":this._x=Math.asin(-Ee(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(c,y),this._z=Math.atan2(u,d)):(this._y=Math.atan2(-p,i),this._z=0);break;case"ZXY":this._x=Math.asin(Ee(g,-1,1)),Math.abs(g)<.9999999?(this._y=Math.atan2(-p,y),this._z=Math.atan2(-a,d)):(this._y=0,this._z=Math.atan2(u,i));break;case"ZYX":this._y=Math.asin(-Ee(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(g,y),this._z=Math.atan2(u,i)):(this._x=0,this._z=Math.atan2(-a,d));break;case"YZX":this._z=Math.asin(Ee(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-f,d),this._y=Math.atan2(-p,i)):(this._x=0,this._y=Math.atan2(c,y));break;case"XZY":this._z=Math.asin(-Ee(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(g,d),this._y=Math.atan2(c,i)):(this._x=Math.atan2(-f,y),this._y=0);break;default:Wt("Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,n===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return AN.makeRotationFromQuaternion(t),this.setFromRotationMatrix(AN,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return NN.setFromEuler(this),this.setFromQuaternion(NN,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ji.DEFAULT_ORDER="XYZ";class FU{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let UU=0;const RN=new G,Rh=new Us,Oa=new Te,pm=new G,Rf=new G,PU=new G,zU=new Us,EN=new G(1,0,0),CN=new G(0,1,0),BN=new G(0,0,1),DN={type:"added"},IU={type:"removed"},Eh={type:"childadded",child:null},rS={type:"childremoved",child:null};class Cn extends Rc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:UU++}),this.uuid=ta(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Cn.DEFAULT_UP.clone();const t=new G,e=new Ji,n=new Us,s=new G(1,1,1);function i(){n.setFromEuler(e,!1)}function a(){e.setFromQuaternion(n,void 0,!1)}e._onChange(i),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Te},normalMatrix:{value:new sr}}),this.matrix=new Te,this.matrixWorld=new Te,this.matrixAutoUpdate=Cn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Cn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new FU,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.static=!1,this.userData={},this.pivot=null}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Rh.setFromAxisAngle(t,e),this.quaternion.multiply(Rh),this}rotateOnWorldAxis(t,e){return Rh.setFromAxisAngle(t,e),this.quaternion.premultiply(Rh),this}rotateX(t){return this.rotateOnAxis(EN,t)}rotateY(t){return this.rotateOnAxis(CN,t)}rotateZ(t){return this.rotateOnAxis(BN,t)}translateOnAxis(t,e){return RN.copy(t).applyQuaternion(this.quaternion),this.position.add(RN.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(EN,t)}translateY(t){return this.translateOnAxis(CN,t)}translateZ(t){return this.translateOnAxis(BN,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Oa.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?pm.copy(t):pm.set(t,e,n);const s=this.parent;this.updateWorldMatrix(!0,!1),Rf.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Oa.lookAt(Rf,pm,this.up):Oa.lookAt(pm,Rf,this.up),this.quaternion.setFromRotationMatrix(Oa),s&&(Oa.extractRotation(s.matrixWorld),Rh.setFromRotationMatrix(Oa),this.quaternion.premultiply(Rh.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(Ht("Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(DN),Eh.child=t,this.dispatchEvent(Eh),Eh.child=null):Ht("Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(IU),rS.child=t,this.dispatchEvent(rS),rS.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Oa.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Oa.multiply(t.parent.matrixWorld)),t.applyMatrix4(Oa),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(DN),Eh.child=t,this.dispatchEvent(Eh),Eh.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,s=this.children.length;n<s;n++){const a=this.children[n].getObjectByProperty(t,e);if(a!==void 0)return a}}getObjectsByProperty(t,e,n=[]){this[t]===e&&n.push(this);const s=this.children;for(let i=0,a=s.length;i<a;i++)s[i].getObjectsByProperty(t,e,n);return n}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rf,t,PU),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Rf,zU,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,s=e.length;n<s;n++)e[n].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let n=0,s=e.length;n<s;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);const t=this.pivot;if(t!==null){const e=t.x,n=t.y,s=t.z,i=this.matrix.elements;i[12]+=e-i[0]*e-i[4]*n-i[8]*s,i[13]+=n-i[1]*e-i[5]*n-i[9]*s,i[14]+=s-i[2]*e-i[6]*n-i[10]*s}this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,s=e.length;n<s;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(t===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const s=this.children;for(let i=0,a=s.length;i<a;i++)s[i].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),this.static!==!1&&(s.static=this.static),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.pivot!==null&&(s.pivot=this.pivot.toArray()),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.morphTargetDictionary!==void 0&&(s.morphTargetDictionary=Object.assign({},this.morphTargetDictionary)),this.morphTargetInfluences!==void 0&&(s.morphTargetInfluences=this.morphTargetInfluences.slice()),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(c=>({...c,boundingBox:c.boundingBox?c.boundingBox.toJSON():void 0,boundingSphere:c.boundingSphere?c.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(c=>({...c})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(t),s.indirectTexture=this._indirectTexture.toJSON(t),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON()));function i(c,u){return c[u.uuid]===void 0&&(c[u.uuid]=u.toJSON(t)),u.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=i(t.geometries,this.geometry);const c=this.geometry.parameters;if(c!==void 0&&c.shapes!==void 0){const u=c.shapes;if(Array.isArray(u))for(let d=0,f=u.length;d<f;d++){const p=u[d];i(t.shapes,p)}else i(t.shapes,u)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(i(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const c=[];for(let u=0,d=this.material.length;u<d;u++)c.push(i(t.materials,this.material[u]));s.material=c}else s.material=i(t.materials,this.material);if(this.children.length>0){s.children=[];for(let c=0;c<this.children.length;c++)s.children.push(this.children[c].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let c=0;c<this.animations.length;c++){const u=this.animations[c];s.animations.push(i(t.animations,u))}}if(e){const c=a(t.geometries),u=a(t.materials),d=a(t.textures),f=a(t.images),p=a(t.shapes),g=a(t.skeletons),y=a(t.animations),x=a(t.nodes);c.length>0&&(n.geometries=c),u.length>0&&(n.materials=u),d.length>0&&(n.textures=d),f.length>0&&(n.images=f),p.length>0&&(n.shapes=p),g.length>0&&(n.skeletons=g),y.length>0&&(n.animations=y),x.length>0&&(n.nodes=x)}return n.object=s,n;function a(c){const u=[];for(const d in c){const f=c[d];delete f.metadata,u.push(f)}return u}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),t.pivot!==null&&(this.pivot=t.pivot.clone()),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.static=t.static,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let n=0;n<t.children.length;n++){const s=t.children[n];this.add(s.clone())}return this}}Cn.DEFAULT_UP=new G(0,1,0);Cn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Cn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;class vt extends Cn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const VU={type:"move"};class GU{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new vt,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new vt,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new G,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new G),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new vt,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new G,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new G),this._grip}dispatchEvent(t){return this._targetRay!==null&&this._targetRay.dispatchEvent(t),this._grip!==null&&this._grip.dispatchEvent(t),this._hand!==null&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const n of t.hand.values())this._getHandJoint(e,n)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(t,e,n){let s=null,i=null,a=null;const c=this._targetRay,u=this._grip,d=this._hand;if(t&&e.session.visibilityState!=="visible-blurred"){if(d&&t.hand){a=!0;for(const S of t.hand.values()){const T=e.getJointPose(S,n),M=this._getHandJoint(d,S);T!==null&&(M.matrix.fromArray(T.transform.matrix),M.matrix.decompose(M.position,M.rotation,M.scale),M.matrixWorldNeedsUpdate=!0,M.jointRadius=T.radius),M.visible=T!==null}const f=d.joints["index-finger-tip"],p=d.joints["thumb-tip"],g=f.position.distanceTo(p.position),y=.02,x=.005;d.inputState.pinching&&g>y+x?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!d.inputState.pinching&&g<=y-x&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else u!==null&&t.gripSpace&&(i=e.getPose(t.gripSpace,n),i!==null&&(u.matrix.fromArray(i.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,i.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(i.linearVelocity)):u.hasLinearVelocity=!1,i.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(i.angularVelocity)):u.hasAngularVelocity=!1));c!==null&&(s=e.getPose(t.targetRaySpace,n),s===null&&i!==null&&(s=i),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1,this.dispatchEvent(VU)))}return c!==null&&(c.visible=s!==null),u!==null&&(u.visible=i!==null),d!==null&&(d.visible=a!==null),this}_getHandJoint(t,e){if(t.joints[e.jointName]===void 0){const n=new vt;n.matrixAutoUpdate=!1,n.visible=!1,t.joints[e.jointName]=n,t.add(n)}return t.joints[e.jointName]}}const Z3={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Il={h:0,s:0,l:0},mm={h:0,s:0,l:0};function oS(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*6*(2/3-e):r}class qt{constructor(t,e,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,n)}set(t,e,n){if(e===void 0&&n===void 0){const s=t;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(t,e,n);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=fn){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,qe.colorSpaceToWorking(this,e),this}setRGB(t,e,n,s=qe.workingColorSpace){return this.r=t,this.g=e,this.b=n,qe.colorSpaceToWorking(this,s),this}setHSL(t,e,n,s=qe.workingColorSpace){if(t=Nw(t,1),e=Ee(e,0,1),n=Ee(n,0,1),e===0)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,a=2*n-i;this.r=oS(a,i,t+1/3),this.g=oS(a,i,t),this.b=oS(a,i,t-1/3)}return qe.colorSpaceToWorking(this,s),this}setStyle(t,e=fn){function n(i){i!==void 0&&parseFloat(i)<1&&Wt("Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(t)){let i;const a=s[1],c=s[2];switch(a){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return n(i[4]),this.setRGB(Math.min(255,parseInt(i[1],10))/255,Math.min(255,parseInt(i[2],10))/255,Math.min(255,parseInt(i[3],10))/255,e);if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return n(i[4]),this.setRGB(Math.min(100,parseInt(i[1],10))/100,Math.min(100,parseInt(i[2],10))/100,Math.min(100,parseInt(i[3],10))/100,e);break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return n(i[4]),this.setHSL(parseFloat(i[1])/360,parseFloat(i[2])/100,parseFloat(i[3])/100,e);break;default:Wt("Color: Unknown color model "+t)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const i=s[1],a=i.length;if(a===3)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(i,16),e);Wt("Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=fn){const n=Z3[t.toLowerCase()];return n!==void 0?this.setHex(n,e):Wt("Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=sl(t.r),this.g=sl(t.g),this.b=sl(t.b),this}copyLinearToSRGB(t){return this.r=hd(t.r),this.g=hd(t.g),this.b=hd(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=fn){return qe.workingToColorSpace(li.copy(this),t),Math.round(Ee(li.r*255,0,255))*65536+Math.round(Ee(li.g*255,0,255))*256+Math.round(Ee(li.b*255,0,255))}getHexString(t=fn){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=qe.workingColorSpace){qe.workingToColorSpace(li.copy(this),e);const n=li.r,s=li.g,i=li.b,a=Math.max(n,s,i),c=Math.min(n,s,i);let u,d;const f=(c+a)/2;if(c===a)u=0,d=0;else{const p=a-c;switch(d=f<=.5?p/(a+c):p/(2-a-c),a){case n:u=(s-i)/p+(s<i?6:0);break;case s:u=(i-n)/p+2;break;case i:u=(n-s)/p+4;break}u/=6}return t.h=u,t.s=d,t.l=f,t}getRGB(t,e=qe.workingColorSpace){return qe.workingToColorSpace(li.copy(this),e),t.r=li.r,t.g=li.g,t.b=li.b,t}getStyle(t=fn){qe.workingToColorSpace(li.copy(this),t);const e=li.r,n=li.g,s=li.b;return t!==fn?`color(${t} ${e.toFixed(3)} ${n.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(n*255)},${Math.round(s*255)})`}offsetHSL(t,e,n){return this.getHSL(Il),this.setHSL(Il.h+t,Il.s+e,Il.l+n)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Il),t.getHSL(mm);const n=mp(Il.h,mm.h,e),s=mp(Il.s,mm.s,e),i=mp(Il.l,mm.l,e);return this.setHSL(n,s,i),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,n=this.g,s=this.b,i=t.elements;return this.r=i[0]*e+i[3]*n+i[6]*s,this.g=i[1]*e+i[4]*n+i[7]*s,this.b=i[2]*e+i[5]*n+i[8]*s,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const li=new qt;qt.NAMES=Z3;class zu{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new qt(t),this.density=e}clone(){return new zu(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Wp{constructor(t,e=1,n=1e3){this.isFog=!0,this.name="",this.color=new qt(t),this.near=e,this.far=n}clone(){return new Wp(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Ew extends Cn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ji,this.environmentIntensity=1,this.environmentRotation=new Ji,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}const po=new G,Fa=new G,aS=new G,Ua=new G,Ch=new G,Bh=new G,LN=new G,lS=new G,cS=new G,uS=new G,hS=new je,dS=new je,fS=new je;class So{constructor(t=new G,e=new G,n=new G){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,s){s.subVectors(n,e),po.subVectors(t,e),s.cross(po);const i=s.lengthSq();return i>0?s.multiplyScalar(1/Math.sqrt(i)):s.set(0,0,0)}static getBarycoord(t,e,n,s,i){po.subVectors(s,e),Fa.subVectors(n,e),aS.subVectors(t,e);const a=po.dot(po),c=po.dot(Fa),u=po.dot(aS),d=Fa.dot(Fa),f=Fa.dot(aS),p=a*d-c*c;if(p===0)return i.set(0,0,0),null;const g=1/p,y=(d*u-c*f)*g,x=(a*f-c*u)*g;return i.set(1-y-x,x,y)}static containsPoint(t,e,n,s){return this.getBarycoord(t,e,n,s,Ua)===null?!1:Ua.x>=0&&Ua.y>=0&&Ua.x+Ua.y<=1}static getInterpolation(t,e,n,s,i,a,c,u){return this.getBarycoord(t,e,n,s,Ua)===null?(u.x=0,u.y=0,"z"in u&&(u.z=0),"w"in u&&(u.w=0),null):(u.setScalar(0),u.addScaledVector(i,Ua.x),u.addScaledVector(a,Ua.y),u.addScaledVector(c,Ua.z),u)}static getInterpolatedAttribute(t,e,n,s,i,a){return hS.setScalar(0),dS.setScalar(0),fS.setScalar(0),hS.fromBufferAttribute(t,e),dS.fromBufferAttribute(t,n),fS.fromBufferAttribute(t,s),a.setScalar(0),a.addScaledVector(hS,i.x),a.addScaledVector(dS,i.y),a.addScaledVector(fS,i.z),a}static isFrontFacing(t,e,n,s){return po.subVectors(n,e),Fa.subVectors(t,e),po.cross(Fa).dot(s)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,s){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,n,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return po.subVectors(this.c,this.b),Fa.subVectors(this.a,this.b),po.cross(Fa).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return So.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return So.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,n,s,i){return So.getInterpolation(t,this.a,this.b,this.c,e,n,s,i)}containsPoint(t){return So.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return So.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,s=this.b,i=this.c;let a,c;Ch.subVectors(s,n),Bh.subVectors(i,n),lS.subVectors(t,n);const u=Ch.dot(lS),d=Bh.dot(lS);if(u<=0&&d<=0)return e.copy(n);cS.subVectors(t,s);const f=Ch.dot(cS),p=Bh.dot(cS);if(f>=0&&p<=f)return e.copy(s);const g=u*p-f*d;if(g<=0&&u>=0&&f<=0)return a=u/(u-f),e.copy(n).addScaledVector(Ch,a);uS.subVectors(t,i);const y=Ch.dot(uS),x=Bh.dot(uS);if(x>=0&&y<=x)return e.copy(i);const S=y*d-u*x;if(S<=0&&d>=0&&x<=0)return c=d/(d-x),e.copy(n).addScaledVector(Bh,c);const T=f*x-y*p;if(T<=0&&p-f>=0&&y-x>=0)return LN.subVectors(i,s),c=(p-f)/(p-f+(y-x)),e.copy(s).addScaledVector(LN,c);const M=1/(T+S+g);return a=S*M,c=g*M,e.copy(n).addScaledVector(Ch,a).addScaledVector(Bh,c)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}class ha{constructor(t=new G(1/0,1/0,1/0),e=new G(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e+=3)this.expandByPoint(mo.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,n=t.count;e<n;e++)this.expandByPoint(mo.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=mo.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(n!==void 0){const i=n.getAttribute("position");if(e===!0&&i!==void 0&&t.isInstancedMesh!==!0)for(let a=0,c=i.count;a<c;a++)t.isMesh===!0?t.getVertexPosition(a,mo):mo.fromBufferAttribute(i,a),mo.applyMatrix4(t.matrixWorld),this.expandByPoint(mo);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),gm.copy(t.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),gm.copy(n.boundingBox)),gm.applyMatrix4(t.matrixWorld),this.union(gm)}const s=t.children;for(let i=0,a=s.length;i<a;i++)this.expandByObject(s[i],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,mo),mo.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ef),ym.subVectors(this.max,Ef),Dh.subVectors(t.a,Ef),Lh.subVectors(t.b,Ef),Oh.subVectors(t.c,Ef),Vl.subVectors(Lh,Dh),Gl.subVectors(Oh,Lh),eu.subVectors(Dh,Oh);let e=[0,-Vl.z,Vl.y,0,-Gl.z,Gl.y,0,-eu.z,eu.y,Vl.z,0,-Vl.x,Gl.z,0,-Gl.x,eu.z,0,-eu.x,-Vl.y,Vl.x,0,-Gl.y,Gl.x,0,-eu.y,eu.x,0];return!pS(e,Dh,Lh,Oh,ym)||(e=[1,0,0,0,1,0,0,0,1],!pS(e,Dh,Lh,Oh,ym))?!1:(xm.crossVectors(Vl,Gl),e=[xm.x,xm.y,xm.z],pS(e,Dh,Lh,Oh,ym))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,mo).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(mo).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Pa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Pa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Pa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Pa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Pa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Pa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Pa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Pa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Pa),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}}const Pa=[new G,new G,new G,new G,new G,new G,new G,new G],mo=new G,gm=new ha,Dh=new G,Lh=new G,Oh=new G,Vl=new G,Gl=new G,eu=new G,Ef=new G,ym=new G,xm=new G,nu=new G;function pS(r,t,e,n,s){for(let i=0,a=r.length-3;i<=a;i+=3){nu.fromArray(r,i);const c=s.x*Math.abs(nu.x)+s.y*Math.abs(nu.y)+s.z*Math.abs(nu.z),u=t.dot(nu),d=e.dot(nu),f=n.dot(nu);if(Math.max(-Math.max(u,d,f),Math.min(u,d,f))>c)return!1}return!0}const Ya=kU();function kU(){const r=new ArrayBuffer(4),t=new Float32Array(r),e=new Uint32Array(r),n=new Uint32Array(512),s=new Uint32Array(512);for(let u=0;u<256;++u){const d=u-127;d<-27?(n[u]=0,n[u|256]=32768,s[u]=24,s[u|256]=24):d<-14?(n[u]=1024>>-d-14,n[u|256]=1024>>-d-14|32768,s[u]=-d-1,s[u|256]=-d-1):d<=15?(n[u]=d+15<<10,n[u|256]=d+15<<10|32768,s[u]=13,s[u|256]=13):d<128?(n[u]=31744,n[u|256]=64512,s[u]=24,s[u|256]=24):(n[u]=31744,n[u|256]=64512,s[u]=13,s[u|256]=13)}const i=new Uint32Array(2048),a=new Uint32Array(64),c=new Uint32Array(64);for(let u=1;u<1024;++u){let d=u<<13,f=0;for(;(d&8388608)===0;)d<<=1,f-=8388608;d&=-8388609,f+=947912704,i[u]=d|f}for(let u=1024;u<2048;++u)i[u]=939524096+(u-1024<<13);for(let u=1;u<31;++u)a[u]=u<<23;a[31]=1199570944,a[32]=2147483648;for(let u=33;u<63;++u)a[u]=2147483648+(u-32<<23);a[63]=3347054592;for(let u=1;u<64;++u)u!==32&&(c[u]=1024);return{floatView:t,uint32View:e,baseTable:n,shiftTable:s,mantissaTable:i,exponentTable:a,offsetTable:c}}function pr(r){Math.abs(r)>65504&&Wt("DataUtils.toHalfFloat(): Value out of range."),r=Ee(r,-65504,65504),Ya.floatView[0]=r;const t=Ya.uint32View[0],e=t>>23&511;return Ya.baseTable[e]+((t&8388607)>>Ya.shiftTable[e])}function bm(r){const t=r>>10;return Ya.uint32View[0]=Ya.mantissaTable[Ya.offsetTable[t]+(r&1023)]+Ya.exponentTable[t],Ya.floatView[0]}const vs=new G,Sm=new Ot;let HU=0;class hs{constructor(t,e,n=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:HU++}),this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=n,this.usage=wd,this.updateRanges=[],this.gpuType=Ri,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let s=0,i=this.itemSize;s<i;s++)this.array[t+s]=e.array[n+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,n=this.count;e<n;e++)Sm.fromBufferAttribute(this,e),Sm.applyMatrix3(t),this.setXY(e,Sm.x,Sm.y);else if(this.itemSize===3)for(let e=0,n=this.count;e<n;e++)vs.fromBufferAttribute(this,e),vs.applyMatrix3(t),this.setXYZ(e,vs.x,vs.y,vs.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)vs.fromBufferAttribute(this,e),vs.applyMatrix4(t),this.setXYZ(e,vs.x,vs.y,vs.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)vs.fromBufferAttribute(this,e),vs.applyNormalMatrix(t),this.setXYZ(e,vs.x,vs.y,vs.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)vs.fromBufferAttribute(this,e),vs.transformDirection(t),this.setXYZ(e,vs.x,vs.y,vs.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let n=this.array[t*this.itemSize+e];return this.normalized&&(n=Ei(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=ve(n,this.array)),this.array[t*this.itemSize+e]=n,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Ei(e,this.array)),e}setX(t,e){return this.normalized&&(e=ve(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Ei(e,this.array)),e}setY(t,e){return this.normalized&&(e=ve(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Ei(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ve(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Ei(e,this.array)),e}setW(t,e){return this.normalized&&(e=ve(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=ve(e,this.array),n=ve(n,this.array)),this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,s){return t*=this.itemSize,this.normalized&&(e=ve(e,this.array),n=ve(n,this.array),s=ve(s,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=s,this}setXYZW(t,e,n,s,i){return t*=this.itemSize,this.normalized&&(e=ve(e,this.array),n=ve(n,this.array),s=ve(s,this.array),i=ve(i,this.array)),this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=s,this.array[t+3]=i,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==wd&&(t.usage=this.usage),t}}class Q3 extends hs{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class J3 extends hs{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class tC extends hs{constructor(t,e,n){super(new Uint16Array(t),e,n),this.isFloat16BufferAttribute=!0}getX(t){let e=bm(this.array[t*this.itemSize]);return this.normalized&&(e=Ei(e,this.array)),e}setX(t,e){return this.normalized&&(e=ve(e,this.array)),this.array[t*this.itemSize]=pr(e),this}getY(t){let e=bm(this.array[t*this.itemSize+1]);return this.normalized&&(e=Ei(e,this.array)),e}setY(t,e){return this.normalized&&(e=ve(e,this.array)),this.array[t*this.itemSize+1]=pr(e),this}getZ(t){let e=bm(this.array[t*this.itemSize+2]);return this.normalized&&(e=Ei(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ve(e,this.array)),this.array[t*this.itemSize+2]=pr(e),this}getW(t){let e=bm(this.array[t*this.itemSize+3]);return this.normalized&&(e=Ei(e,this.array)),e}setW(t,e){return this.normalized&&(e=ve(e,this.array)),this.array[t*this.itemSize+3]=pr(e),this}setXY(t,e,n){return t*=this.itemSize,this.normalized&&(e=ve(e,this.array),n=ve(n,this.array)),this.array[t+0]=pr(e),this.array[t+1]=pr(n),this}setXYZ(t,e,n,s){return t*=this.itemSize,this.normalized&&(e=ve(e,this.array),n=ve(n,this.array),s=ve(s,this.array)),this.array[t+0]=pr(e),this.array[t+1]=pr(n),this.array[t+2]=pr(s),this}setXYZW(t,e,n,s,i){return t*=this.itemSize,this.normalized&&(e=ve(e,this.array),n=ve(n,this.array),s=ve(s,this.array),i=ve(i,this.array)),this.array[t+0]=pr(e),this.array[t+1]=pr(n),this.array[t+2]=pr(s),this.array[t+3]=pr(i),this}}class ge extends hs{constructor(t,e,n){super(new Float32Array(t),e,n)}}const WU=new ha,Cf=new G,mS=new G;class Ec{constructor(t=new G,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;e!==void 0?n.copy(e):WU.setFromPoints(t).getCenter(n);let s=0;for(let i=0,a=t.length;i<a;i++)s=Math.max(s,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Cf.subVectors(t,this.center);const e=Cf.lengthSq();if(e>this.radius*this.radius){const n=Math.sqrt(e),s=(n-this.radius)*.5;this.center.addScaledVector(Cf,s/n),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(mS.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Cf.copy(t.center).add(mS)),this.expandByPoint(Cf.copy(t.center).sub(mS))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}let qU=0;const Gr=new Te,gS=new Cn,Fh=new G,mr=new ha,Bf=new ha,Gs=new G;class Ye extends Rc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:qU++}),this.uuid=ta(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(uU(t)?J3:Q3)(t,1):this.index=t,this}setIndirect(t,e=0){return this.indirect=t,this.indirectOffset=e,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const i=new sr().getNormalMatrix(t);n.applyNormalMatrix(i),n.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Gr.makeRotationFromQuaternion(t),this.applyMatrix4(Gr),this}rotateX(t){return Gr.makeRotationX(t),this.applyMatrix4(Gr),this}rotateY(t){return Gr.makeRotationY(t),this.applyMatrix4(Gr),this}rotateZ(t){return Gr.makeRotationZ(t),this.applyMatrix4(Gr),this}translate(t,e,n){return Gr.makeTranslation(t,e,n),this.applyMatrix4(Gr),this}scale(t,e,n){return Gr.makeScale(t,e,n),this.applyMatrix4(Gr),this}lookAt(t){return gS.lookAt(t),gS.updateMatrix(),this.applyMatrix4(gS.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Fh).negate(),this.translate(Fh.x,Fh.y,Fh.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const n=[];for(let s=0,i=t.length;s<i;s++){const a=t[s];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new ge(n,3))}else{const n=Math.min(t.length,e.count);for(let s=0;s<n;s++){const i=t[s];e.setXYZ(s,i.x,i.y,i.z||0)}t.length>e.count&&Wt("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ha);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){Ht("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new G(-1/0,-1/0,-1/0),new G(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let n=0,s=e.length;n<s;n++){const i=e[n];mr.setFromBufferAttribute(i),this.morphTargetsRelative?(Gs.addVectors(this.boundingBox.min,mr.min),this.boundingBox.expandByPoint(Gs),Gs.addVectors(this.boundingBox.max,mr.max),this.boundingBox.expandByPoint(Gs)):(this.boundingBox.expandByPoint(mr.min),this.boundingBox.expandByPoint(mr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Ht('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ec);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){Ht("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new G,1/0);return}if(t){const n=this.boundingSphere.center;if(mr.setFromBufferAttribute(t),e)for(let i=0,a=e.length;i<a;i++){const c=e[i];Bf.setFromBufferAttribute(c),this.morphTargetsRelative?(Gs.addVectors(mr.min,Bf.min),mr.expandByPoint(Gs),Gs.addVectors(mr.max,Bf.max),mr.expandByPoint(Gs)):(mr.expandByPoint(Bf.min),mr.expandByPoint(Bf.max))}mr.getCenter(n);let s=0;for(let i=0,a=t.count;i<a;i++)Gs.fromBufferAttribute(t,i),s=Math.max(s,n.distanceToSquared(Gs));if(e)for(let i=0,a=e.length;i<a;i++){const c=e[i],u=this.morphTargetsRelative;for(let d=0,f=c.count;d<f;d++)Gs.fromBufferAttribute(c,d),u&&(Fh.fromBufferAttribute(t,d),Gs.add(Fh)),s=Math.max(s,n.distanceToSquared(Gs))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&Ht('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){Ht("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=e.position,s=e.normal,i=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new hs(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),c=[],u=[];for(let O=0;O<n.count;O++)c[O]=new G,u[O]=new G;const d=new G,f=new G,p=new G,g=new Ot,y=new Ot,x=new Ot,S=new G,T=new G;function M(O,B,z){d.fromBufferAttribute(n,O),f.fromBufferAttribute(n,B),p.fromBufferAttribute(n,z),g.fromBufferAttribute(i,O),y.fromBufferAttribute(i,B),x.fromBufferAttribute(i,z),f.sub(d),p.sub(d),y.sub(g),x.sub(g);const tt=1/(y.x*x.y-x.x*y.y);isFinite(tt)&&(S.copy(f).multiplyScalar(x.y).addScaledVector(p,-y.y).multiplyScalar(tt),T.copy(p).multiplyScalar(y.x).addScaledVector(f,-x.x).multiplyScalar(tt),c[O].add(S),c[B].add(S),c[z].add(S),u[O].add(T),u[B].add(T),u[z].add(T))}let N=this.groups;N.length===0&&(N=[{start:0,count:t.count}]);for(let O=0,B=N.length;O<B;++O){const z=N[O],tt=z.start,j=z.count;for(let dt=tt,wt=tt+j;dt<wt;dt+=3)M(t.getX(dt+0),t.getX(dt+1),t.getX(dt+2))}const v=new G,A=new G,R=new G,F=new G;function D(O){R.fromBufferAttribute(s,O),F.copy(R);const B=c[O];v.copy(B),v.sub(R.multiplyScalar(R.dot(B))).normalize(),A.crossVectors(F,B);const tt=A.dot(u[O])<0?-1:1;a.setXYZW(O,v.x,v.y,v.z,tt)}for(let O=0,B=N.length;O<B;++O){const z=N[O],tt=z.start,j=z.count;for(let dt=tt,wt=tt+j;dt<wt;dt+=3)D(t.getX(dt+0)),D(t.getX(dt+1)),D(t.getX(dt+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new hs(new Float32Array(e.count*3),3),this.setAttribute("normal",n);else for(let g=0,y=n.count;g<y;g++)n.setXYZ(g,0,0,0);const s=new G,i=new G,a=new G,c=new G,u=new G,d=new G,f=new G,p=new G;if(t)for(let g=0,y=t.count;g<y;g+=3){const x=t.getX(g+0),S=t.getX(g+1),T=t.getX(g+2);s.fromBufferAttribute(e,x),i.fromBufferAttribute(e,S),a.fromBufferAttribute(e,T),f.subVectors(a,i),p.subVectors(s,i),f.cross(p),c.fromBufferAttribute(n,x),u.fromBufferAttribute(n,S),d.fromBufferAttribute(n,T),c.add(f),u.add(f),d.add(f),n.setXYZ(x,c.x,c.y,c.z),n.setXYZ(S,u.x,u.y,u.z),n.setXYZ(T,d.x,d.y,d.z)}else for(let g=0,y=e.count;g<y;g+=3)s.fromBufferAttribute(e,g+0),i.fromBufferAttribute(e,g+1),a.fromBufferAttribute(e,g+2),f.subVectors(a,i),p.subVectors(s,i),f.cross(p),n.setXYZ(g+0,f.x,f.y,f.z),n.setXYZ(g+1,f.x,f.y,f.z),n.setXYZ(g+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Gs.fromBufferAttribute(t,e),Gs.normalize(),t.setXYZ(e,Gs.x,Gs.y,Gs.z)}toNonIndexed(){function t(c,u){const d=c.array,f=c.itemSize,p=c.normalized,g=new d.constructor(u.length*f);let y=0,x=0;for(let S=0,T=u.length;S<T;S++){c.isInterleavedBufferAttribute?y=u[S]*c.data.stride+c.offset:y=u[S]*f;for(let M=0;M<f;M++)g[x++]=d[y++]}return new hs(g,f,p)}if(this.index===null)return Wt("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Ye,n=this.index.array,s=this.attributes;for(const c in s){const u=s[c],d=t(u,n);e.setAttribute(c,d)}const i=this.morphAttributes;for(const c in i){const u=[],d=i[c];for(let f=0,p=d.length;f<p;f++){const g=d[f],y=t(g,n);u.push(y)}e.morphAttributes[c]=u}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let c=0,u=a.length;c<u;c++){const d=a[c];e.addGroup(d.start,d.count,d.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const u=this.parameters;for(const d in u)u[d]!==void 0&&(t[d]=u[d]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const u in n){const d=n[u];t.data.attributes[u]=d.toJSON(t.data)}const s={};let i=!1;for(const u in this.morphAttributes){const d=this.morphAttributes[u],f=[];for(let p=0,g=d.length;p<g;p++){const y=d[p];f.push(y.toJSON(t.data))}f.length>0&&(s[u]=f,i=!0)}i&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const c=this.boundingSphere;return c!==null&&(t.data.boundingSphere=c.toJSON()),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;n!==null&&this.setIndex(n.clone());const s=t.attributes;for(const d in s){const f=s[d];this.setAttribute(d,f.clone(e))}const i=t.morphAttributes;for(const d in i){const f=[],p=i[d];for(let g=0,y=p.length;g<y;g++)f.push(p[g].clone(e));this.morphAttributes[d]=f}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let d=0,f=a.length;d<f;d++){const p=a[d];this.addGroup(p.start,p.count,p.materialIndex)}const c=t.boundingBox;c!==null&&(this.boundingBox=c.clone());const u=t.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}class eC{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=wd,this.updateRanges=[],this.version=0,this.uuid=ta()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let s=0,i=this.stride;s<i;s++)this.array[t+s]=e.array[n+s];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ta()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ta()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Mi=new G;class Cw{constructor(t,e,n,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)Mi.fromBufferAttribute(this,e),Mi.applyMatrix4(t),this.setXYZ(e,Mi.x,Mi.y,Mi.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)Mi.fromBufferAttribute(this,e),Mi.applyNormalMatrix(t),this.setXYZ(e,Mi.x,Mi.y,Mi.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)Mi.fromBufferAttribute(this,e),Mi.transformDirection(t),this.setXYZ(e,Mi.x,Mi.y,Mi.z);return this}getComponent(t,e){let n=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(n=Ei(n,this.array)),n}setComponent(t,e,n){return this.normalized&&(n=ve(n,this.array)),this.data.array[t*this.data.stride+this.offset+e]=n,this}setX(t,e){return this.normalized&&(e=ve(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=ve(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=ve(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=ve(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Ei(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Ei(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Ei(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Ei(e,this.array)),e}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=ve(e,this.array),n=ve(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=ve(e,this.array),n=ve(n,this.array),s=ve(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=s,this}setXYZW(t,e,n,s,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=ve(e,this.array),n=ve(n,this.array),s=ve(s,this.array),i=ve(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=s,this.data.array[t+3]=i,this}clone(t){if(t===void 0){F2("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)e.push(this.data.array[s+i])}return new hs(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Cw(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){F2("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let n=0;n<this.count;n++){const s=n*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)e.push(this.data.array[s+i])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}let $U=0;class Mr extends Rc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:$U++}),this.uuid=ta(),this.name="",this.type="Material",this.blending=fi,this.side=Qo,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Np,this.blendDst=Rp,this.blendEquation=qr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new qt(0,0,0),this.blendAlpha=0,this.depthFunc=xd,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=O2,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=bu,this.stencilZFail=bu,this.stencilZPass=bu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const n=t[e];if(n===void 0){Wt(`Material: parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){Wt(`Material: '${e}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[e]=n}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(t).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(t).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==fi&&(n.blending=this.blending),this.side!==Qo&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==Np&&(n.blendSrc=this.blendSrc),this.blendDst!==Rp&&(n.blendDst=this.blendDst),this.blendEquation!==qr&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==xd&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==O2&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==bu&&(n.stencilFail=this.stencilFail),this.stencilZFail!==bu&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==bu&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.allowOverride===!1&&(n.allowOverride=!1),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function s(i){const a=[];for(const c in i){const u=i[c];delete u.metadata,a.push(u)}return a}if(e){const i=s(t.textures),a=s(t.images);i.length>0&&(n.textures=i),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(e!==null){const s=e.length;n=new Array(s);for(let i=0;i!==s;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.allowOverride=t.allowOverride,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class XU extends Mr{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new qt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const za=new G,yS=new G,wm=new G,kl=new G,xS=new G,Tm=new G,bS=new G;class nC{constructor(t=new G,e=new G(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,za)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=za.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(za.copy(this.origin).addScaledVector(this.direction,e),za.distanceToSquared(t))}distanceSqToSegment(t,e,n,s){yS.copy(t).add(e).multiplyScalar(.5),wm.copy(e).sub(t).normalize(),kl.copy(this.origin).sub(yS);const i=t.distanceTo(e)*.5,a=-this.direction.dot(wm),c=kl.dot(this.direction),u=-kl.dot(wm),d=kl.lengthSq(),f=Math.abs(1-a*a);let p,g,y,x;if(f>0)if(p=a*u-c,g=a*c-u,x=i*f,p>=0)if(g>=-x)if(g<=x){const S=1/f;p*=S,g*=S,y=p*(p+a*g+2*c)+g*(a*p+g+2*u)+d}else g=i,p=Math.max(0,-(a*g+c)),y=-p*p+g*(g+2*u)+d;else g=-i,p=Math.max(0,-(a*g+c)),y=-p*p+g*(g+2*u)+d;else g<=-x?(p=Math.max(0,-(-a*i+c)),g=p>0?-i:Math.min(Math.max(-i,-u),i),y=-p*p+g*(g+2*u)+d):g<=x?(p=0,g=Math.min(Math.max(-i,-u),i),y=g*(g+2*u)+d):(p=Math.max(0,-(a*i+c)),g=p>0?i:Math.min(Math.max(-i,-u),i),y=-p*p+g*(g+2*u)+d);else g=a>0?-i:i,p=Math.max(0,-(a*g+c)),y=-p*p+g*(g+2*u)+d;return n&&n.copy(this.origin).addScaledVector(this.direction,p),s&&s.copy(yS).addScaledVector(wm,g),y}intersectSphere(t,e){za.subVectors(t.center,this.origin);const n=za.dot(this.direction),s=za.dot(za)-n*n,i=t.radius*t.radius;if(s>i)return null;const a=Math.sqrt(i-s),c=n-a,u=n+a;return u<0?null:c<0?this.at(u,e):this.at(c,e)}intersectsSphere(t){return t.radius<0?!1:this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return n===null?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,s,i,a,c,u;const d=1/this.direction.x,f=1/this.direction.y,p=1/this.direction.z,g=this.origin;return d>=0?(n=(t.min.x-g.x)*d,s=(t.max.x-g.x)*d):(n=(t.max.x-g.x)*d,s=(t.min.x-g.x)*d),f>=0?(i=(t.min.y-g.y)*f,a=(t.max.y-g.y)*f):(i=(t.max.y-g.y)*f,a=(t.min.y-g.y)*f),n>a||i>s||((i>n||isNaN(n))&&(n=i),(a<s||isNaN(s))&&(s=a),p>=0?(c=(t.min.z-g.z)*p,u=(t.max.z-g.z)*p):(c=(t.max.z-g.z)*p,u=(t.min.z-g.z)*p),n>u||c>s)||((c>n||n!==n)&&(n=c),(u<s||s!==s)&&(s=u),s<0)?null:this.at(n>=0?n:s,e)}intersectsBox(t){return this.intersectBox(t,za)!==null}intersectTriangle(t,e,n,s,i){xS.subVectors(e,t),Tm.subVectors(n,t),bS.crossVectors(xS,Tm);let a=this.direction.dot(bS),c;if(a>0){if(s)return null;c=1}else if(a<0)c=-1,a=-a;else return null;kl.subVectors(this.origin,t);const u=c*this.direction.dot(Tm.crossVectors(kl,Tm));if(u<0)return null;const d=c*this.direction.dot(xS.cross(kl));if(d<0||u+d>a)return null;const f=-c*kl.dot(bS);return f<0?null:this.at(f/a,i)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class $e extends Mr{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new qt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ji,this.combine=Yy,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const ON=new Te,su=new nC,_m=new Ec,FN=new G,Mm=new G,vm=new G,Am=new G,SS=new G,Nm=new G,UN=new G,Rm=new G;class C extends Cn{constructor(t=new Ye,e=new $e){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const s=e[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,a=s.length;i<a;i++){const c=s[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=i}}}}getVertexPosition(t,e){const n=this.geometry,s=n.attributes.position,i=n.morphAttributes.position,a=n.morphTargetsRelative;e.fromBufferAttribute(s,t);const c=this.morphTargetInfluences;if(i&&c){Nm.set(0,0,0);for(let u=0,d=i.length;u<d;u++){const f=c[u],p=i[u];f!==0&&(SS.fromBufferAttribute(p,t),a?Nm.addScaledVector(SS,f):Nm.addScaledVector(SS.sub(e),f))}e.add(Nm)}return e}raycast(t,e){const n=this.geometry,s=this.material,i=this.matrixWorld;s!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),_m.copy(n.boundingSphere),_m.applyMatrix4(i),su.copy(t.ray).recast(t.near),!(_m.containsPoint(su.origin)===!1&&(su.intersectSphere(_m,FN)===null||su.origin.distanceToSquared(FN)>(t.far-t.near)**2))&&(ON.copy(i).invert(),su.copy(t.ray).applyMatrix4(ON),!(n.boundingBox!==null&&su.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(t,e,su)))}_computeIntersections(t,e,n){let s;const i=this.geometry,a=this.material,c=i.index,u=i.attributes.position,d=i.attributes.uv,f=i.attributes.uv1,p=i.attributes.normal,g=i.groups,y=i.drawRange;if(c!==null)if(Array.isArray(a))for(let x=0,S=g.length;x<S;x++){const T=g[x],M=a[T.materialIndex],N=Math.max(T.start,y.start),v=Math.min(c.count,Math.min(T.start+T.count,y.start+y.count));for(let A=N,R=v;A<R;A+=3){const F=c.getX(A),D=c.getX(A+1),O=c.getX(A+2);s=Em(this,M,t,n,d,f,p,F,D,O),s&&(s.faceIndex=Math.floor(A/3),s.face.materialIndex=T.materialIndex,e.push(s))}}else{const x=Math.max(0,y.start),S=Math.min(c.count,y.start+y.count);for(let T=x,M=S;T<M;T+=3){const N=c.getX(T),v=c.getX(T+1),A=c.getX(T+2);s=Em(this,a,t,n,d,f,p,N,v,A),s&&(s.faceIndex=Math.floor(T/3),e.push(s))}}else if(u!==void 0)if(Array.isArray(a))for(let x=0,S=g.length;x<S;x++){const T=g[x],M=a[T.materialIndex],N=Math.max(T.start,y.start),v=Math.min(u.count,Math.min(T.start+T.count,y.start+y.count));for(let A=N,R=v;A<R;A+=3){const F=A,D=A+1,O=A+2;s=Em(this,M,t,n,d,f,p,F,D,O),s&&(s.faceIndex=Math.floor(A/3),s.face.materialIndex=T.materialIndex,e.push(s))}}else{const x=Math.max(0,y.start),S=Math.min(u.count,y.start+y.count);for(let T=x,M=S;T<M;T+=3){const N=T,v=T+1,A=T+2;s=Em(this,a,t,n,d,f,p,N,v,A),s&&(s.faceIndex=Math.floor(T/3),e.push(s))}}}}function jU(r,t,e,n,s,i,a,c){let u;if(t.side===us?u=n.intersectTriangle(a,i,s,!0,c):u=n.intersectTriangle(s,i,a,t.side===Qo,c),u===null)return null;Rm.copy(c),Rm.applyMatrix4(r.matrixWorld);const d=e.ray.origin.distanceTo(Rm);return d<e.near||d>e.far?null:{distance:d,point:Rm.clone(),object:r}}function Em(r,t,e,n,s,i,a,c,u,d){r.getVertexPosition(c,Mm),r.getVertexPosition(u,vm),r.getVertexPosition(d,Am);const f=jU(r,t,e,n,Mm,vm,Am,UN);if(f){const p=new G;So.getBarycoord(UN,Mm,vm,Am,p),s&&(f.uv=So.getInterpolatedAttribute(s,c,u,d,p,new Ot)),i&&(f.uv1=So.getInterpolatedAttribute(i,c,u,d,p,new Ot)),a&&(f.normal=So.getInterpolatedAttribute(a,c,u,d,p,new G),f.normal.dot(n.direction)>0&&f.normal.multiplyScalar(-1));const g={a:c,b:u,c:d,normal:new G,materialIndex:0};So.getNormal(Mm,vm,Am,g.normal),f.face=g,f.barycoord=p}return f}class sx extends ns{constructor(t=null,e=1,n=1,s,i,a,c,u,d=ts,f=ts,p,g){super(null,a,c,u,d,f,s,i,p,g),this.isDataTexture=!0,this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bc extends hs{constructor(t,e,n,s=1){super(t,e,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Uh=new Te,PN=new Te,Cm=[],zN=new ha,YU=new Te,Df=new C,Lf=new Ec;class vu extends C{constructor(t,e,n){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new bc(new Float32Array(n*16),16),this.previousInstanceMatrix=null,this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<n;s++)this.setMatrixAt(s,YU)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new ha),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Uh),zN.copy(t.boundingBox).applyMatrix4(Uh),this.boundingBox.union(zN)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ec),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<e;n++)this.getMatrixAt(n,Uh),Lf.copy(t.boundingSphere).applyMatrix4(Uh),this.boundingSphere.union(Lf)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.previousInstanceMatrix!==null&&(this.previousInstanceMatrix=t.previousInstanceMatrix.clone()),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,e){const n=e.morphTargetInfluences,s=this.morphTexture.source.data.data,i=n.length+1,a=t*i+1;for(let c=0;c<n.length;c++)n[c]=s[a+c]}raycast(t,e){const n=this.matrixWorld,s=this.count;if(Df.geometry=this.geometry,Df.material=this.material,Df.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Lf.copy(this.boundingSphere),Lf.applyMatrix4(n),t.ray.intersectsSphere(Lf)!==!1))for(let i=0;i<s;i++){this.getMatrixAt(i,Uh),PN.multiplyMatrices(n,Uh),Df.matrixWorld=PN,Df.raycast(t,Cm);for(let a=0,c=Cm.length;a<c;a++){const u=Cm[a];u.instanceId=i,u.object=this,e.push(u)}Cm.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new bc(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,e){const n=e.morphTargetInfluences,s=n.length+1;this.morphTexture===null&&(this.morphTexture=new sx(new Float32Array(s*this.count),s,this.count,Hp,Ri));const i=this.morphTexture.source.data.data;let a=0;for(let d=0;d<n.length;d++)a+=n[d];const c=this.geometry.morphTargetsRelative?1:1-a,u=s*t;i[u]=c,i.set(n,u+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const wS=new G,KU=new G,ZU=new sr;class rc{constructor(t=new G(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,s){return this.normal.set(t,e,n),this.constant=s,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const s=wS.subVectors(n,e).cross(KU.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const n=t.delta(wS),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const i=-(t.start.dot(this.normal)+this.constant)/s;return i<0||i>1?null:e.copy(t.start).addScaledVector(n,i)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||ZU.getNormalMatrix(t),s=this.coplanarPoint(wS).applyMatrix4(t),i=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(i),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const iu=new Ec,QU=new Ot(.5,.5),Bm=new G;class ix{constructor(t=new rc,e=new rc,n=new rc,s=new rc,i=new rc,a=new rc){this.planes=[t,e,n,s,i,a]}set(t,e,n,s,i,a){const c=this.planes;return c[0].copy(t),c[1].copy(e),c[2].copy(n),c[3].copy(s),c[4].copy(i),c[5].copy(a),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t,e=wr,n=!1){const s=this.planes,i=t.elements,a=i[0],c=i[1],u=i[2],d=i[3],f=i[4],p=i[5],g=i[6],y=i[7],x=i[8],S=i[9],T=i[10],M=i[11],N=i[12],v=i[13],A=i[14],R=i[15];if(s[0].setComponents(d-a,y-f,M-x,R-N).normalize(),s[1].setComponents(d+a,y+f,M+x,R+N).normalize(),s[2].setComponents(d+c,y+p,M+S,R+v).normalize(),s[3].setComponents(d-c,y-p,M-S,R-v).normalize(),n)s[4].setComponents(u,g,T,A).normalize(),s[5].setComponents(d-u,y-g,M-T,R-A).normalize();else if(s[4].setComponents(d-u,y-g,M-T,R-A).normalize(),e===wr)s[5].setComponents(d+u,y+g,M+T,R+A).normalize();else if(e===Zr)s[5].setComponents(u,g,T,A).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),iu.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),iu.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(iu)}intersectsSprite(t){iu.center.set(0,0,0);const e=QU.distanceTo(t.center);return iu.radius=.7071067811865476+e,iu.applyMatrix4(t.matrixWorld),this.intersectsSphere(iu)}intersectsSphere(t){const e=this.planes,n=t.center,s=-t.radius;for(let i=0;i<6;i++)if(e[i].distanceToPoint(n)<s)return!1;return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const s=e[n];if(Bm.x=s.normal.x>0?t.max.x:t.min.x,Bm.y=s.normal.y>0?t.max.y:t.min.y,Bm.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(Bm)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const Fo=new Te,Uo=new ix;class Bw{constructor(){this.coordinateSystem=wr}intersectsObject(t,e){if(!e.isArrayCamera||e.cameras.length===0)return!1;for(let n=0;n<e.cameras.length;n++){const s=e.cameras[n];if(Fo.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Uo.setFromProjectionMatrix(Fo,s.coordinateSystem,s.reversedDepth),Uo.intersectsObject(t))return!0}return!1}intersectsSprite(t,e){if(!e||!e.cameras||e.cameras.length===0)return!1;for(let n=0;n<e.cameras.length;n++){const s=e.cameras[n];if(Fo.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Uo.setFromProjectionMatrix(Fo,s.coordinateSystem,s.reversedDepth),Uo.intersectsSprite(t))return!0}return!1}intersectsSphere(t,e){if(!e||!e.cameras||e.cameras.length===0)return!1;for(let n=0;n<e.cameras.length;n++){const s=e.cameras[n];if(Fo.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Uo.setFromProjectionMatrix(Fo,s.coordinateSystem,s.reversedDepth),Uo.intersectsSphere(t))return!0}return!1}intersectsBox(t,e){if(!e||!e.cameras||e.cameras.length===0)return!1;for(let n=0;n<e.cameras.length;n++){const s=e.cameras[n];if(Fo.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Uo.setFromProjectionMatrix(Fo,s.coordinateSystem,s.reversedDepth),Uo.intersectsBox(t))return!0}return!1}containsPoint(t,e){if(!e||!e.cameras||e.cameras.length===0)return!1;for(let n=0;n<e.cameras.length;n++){const s=e.cameras[n];if(Fo.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),Uo.setFromProjectionMatrix(Fo,s.coordinateSystem,s.reversedDepth),Uo.containsPoint(t))return!0}return!1}clone(){return new Bw}}class sC extends Mr{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new qt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}class tr extends Mr{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new qt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const IN=new Te,U2=new nC,Dm=new Ec,Lm=new G;class Qr extends Cn{constructor(t=new Ye,e=new tr){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,s=this.matrixWorld,i=t.params.Points.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Dm.copy(n.boundingSphere),Dm.applyMatrix4(s),Dm.radius+=i,t.ray.intersectsSphere(Dm)===!1)return;IN.copy(s).invert(),U2.copy(t.ray).applyMatrix4(IN);const c=i/((this.scale.x+this.scale.y+this.scale.z)/3),u=c*c,d=n.index,p=n.attributes.position;if(d!==null){const g=Math.max(0,a.start),y=Math.min(d.count,a.start+a.count);for(let x=g,S=y;x<S;x++){const T=d.getX(x);Lm.fromBufferAttribute(p,T),VN(Lm,T,u,s,t,e,this)}}else{const g=Math.max(0,a.start),y=Math.min(p.count,a.start+a.count);for(let x=g,S=y;x<S;x++)Lm.fromBufferAttribute(p,x),VN(Lm,x,u,s,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,n=Object.keys(e);if(n.length>0){const s=e[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,a=s.length;i<a;i++){const c=s[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=i}}}}}function VN(r,t,e,n,s,i,a){const c=U2.distanceSqToPoint(r);if(c<e){const u=new G;U2.closestPointToPoint(r,u),u.applyMatrix4(n);const d=s.ray.origin.distanceTo(u);if(d<s.near||d>s.far)return;i.push({distance:d,distanceToRay:Math.sqrt(c),point:u,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}class Dw extends ns{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=ts,this.minFilter=ts,this.generateMipmaps=!1,this.needsUpdate=!0}}class rx extends ns{constructor(t=[],e=bd,n,s,i,a,c,u,d,f){super(t,e,n,s,i,a,c,u,d,f),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class bi extends ns{constructor(t,e,n,s,i,a,c,u,d){super(t,e,n,s,i,a,c,u,d),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Yr extends ns{constructor(t,e,n=Qn,s,i,a,c=ts,u=ts,d,f=To,p=1){if(f!==To&&f!==el)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const g={width:t,height:e,depth:p};super(g,s,i,a,c,u,f,n,d),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new Rw(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}class JU extends Yr{constructor(t,e=Qn,n=bd,s,i,a=ts,c=ts,u,d=To){const f={width:t,height:t,depth:1},p=[f,f,f,f,f,f];super(t,t,e,n,s,i,a,c,u,d),this.image=p,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(t){this.image=t}}class Y extends Ye{constructor(t=1,e=1,n=1,s=1,i=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:s,heightSegments:i,depthSegments:a};const c=this;s=Math.floor(s),i=Math.floor(i),a=Math.floor(a);const u=[],d=[],f=[],p=[];let g=0,y=0;x("z","y","x",-1,-1,n,e,t,a,i,0),x("z","y","x",1,-1,n,e,-t,a,i,1),x("x","z","y",1,1,t,n,e,s,a,2),x("x","z","y",1,-1,t,n,-e,s,a,3),x("x","y","z",1,-1,t,e,n,s,i,4),x("x","y","z",-1,-1,t,e,-n,s,i,5),this.setIndex(u),this.setAttribute("position",new ge(d,3)),this.setAttribute("normal",new ge(f,3)),this.setAttribute("uv",new ge(p,2));function x(S,T,M,N,v,A,R,F,D,O,B){const z=A/D,tt=R/O,j=A/2,dt=R/2,wt=F/2,ft=D+1,U=O+1;let K=0,nt=0;const ht=new G;for(let _t=0;_t<U;_t++){const P=_t*tt-dt;for(let q=0;q<ft;q++){const L=q*z-j;ht[S]=L*N,ht[T]=P*v,ht[M]=wt,d.push(ht.x,ht.y,ht.z),ht[S]=0,ht[T]=0,ht[M]=F>0?1:-1,f.push(ht.x,ht.y,ht.z),p.push(q/D),p.push(1-_t/O),K+=1}}for(let _t=0;_t<O;_t++)for(let P=0;P<D;P++){const q=g+P+ft*_t,L=g+P+ft*(_t+1),I=g+(P+1)+ft*(_t+1),H=g+(P+1)+ft*_t;u.push(q,L,H),u.push(L,I,H),nt+=6}c.addGroup(y,nt,B),y+=nt,g+=K}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Y(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}class Eu extends Ye{constructor(t=1,e=1,n=4,s=8,i=1){super(),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:n,radialSegments:s,heightSegments:i},e=Math.max(0,e),n=Math.max(1,Math.floor(n)),s=Math.max(3,Math.floor(s)),i=Math.max(1,Math.floor(i));const a=[],c=[],u=[],d=[],f=e/2,p=Math.PI/2*t,g=e,y=2*p+g,x=n*2+i,S=s+1,T=new G,M=new G;for(let N=0;N<=x;N++){let v=0,A=0,R=0,F=0;if(N<=n){const B=N/n,z=B*Math.PI/2;A=-f-t*Math.cos(z),R=t*Math.sin(z),F=-t*Math.cos(z),v=B*p}else if(N<=n+i){const B=(N-n)/i;A=-f+B*e,R=t,F=0,v=p+B*g}else{const B=(N-n-i)/n,z=B*Math.PI/2;A=f+t*Math.sin(z),R=t*Math.cos(z),F=t*Math.sin(z),v=p+g+B*p}const D=Math.max(0,Math.min(1,v/y));let O=0;N===0?O=.5/s:N===x&&(O=-.5/s);for(let B=0;B<=s;B++){const z=B/s,tt=z*Math.PI*2,j=Math.sin(tt),dt=Math.cos(tt);M.x=-R*dt,M.y=A,M.z=R*j,c.push(M.x,M.y,M.z),T.set(-R*dt,F,R*j),T.normalize(),u.push(T.x,T.y,T.z),d.push(z+O,D)}if(N>0){const B=(N-1)*S;for(let z=0;z<s;z++){const tt=B+z,j=B+z+1,dt=N*S+z,wt=N*S+z+1;a.push(tt,j,dt),a.push(j,wt,dt)}}}this.setIndex(a),this.setAttribute("position",new ge(c,3)),this.setAttribute("normal",new ge(u,3)),this.setAttribute("uv",new ge(d,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Eu(t.radius,t.height,t.capSegments,t.radialSegments,t.heightSegments)}}class qi extends Ye{constructor(t=1,e=32,n=0,s=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:s},e=Math.max(3,e);const i=[],a=[],c=[],u=[],d=new G,f=new Ot;a.push(0,0,0),c.push(0,0,1),u.push(.5,.5);for(let p=0,g=3;p<=e;p++,g+=3){const y=n+p/e*s;d.x=t*Math.cos(y),d.y=t*Math.sin(y),a.push(d.x,d.y,d.z),c.push(0,0,1),f.x=(a[g]/t+1)/2,f.y=(a[g+1]/t+1)/2,u.push(f.x,f.y)}for(let p=1;p<=e;p++)i.push(p,p+1,0);this.setIndex(i),this.setAttribute("position",new ge(a,3)),this.setAttribute("normal",new ge(c,3)),this.setAttribute("uv",new ge(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new qi(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class $t extends Ye{constructor(t=1,e=1,n=1,s=32,i=1,a=!1,c=0,u=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:s,heightSegments:i,openEnded:a,thetaStart:c,thetaLength:u};const d=this;s=Math.floor(s),i=Math.floor(i);const f=[],p=[],g=[],y=[];let x=0;const S=[],T=n/2;let M=0;N(),a===!1&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(f),this.setAttribute("position",new ge(p,3)),this.setAttribute("normal",new ge(g,3)),this.setAttribute("uv",new ge(y,2));function N(){const A=new G,R=new G;let F=0;const D=(e-t)/n;for(let O=0;O<=i;O++){const B=[],z=O/i,tt=z*(e-t)+t;for(let j=0;j<=s;j++){const dt=j/s,wt=dt*u+c,ft=Math.sin(wt),U=Math.cos(wt);R.x=tt*ft,R.y=-z*n+T,R.z=tt*U,p.push(R.x,R.y,R.z),A.set(ft,D,U).normalize(),g.push(A.x,A.y,A.z),y.push(dt,1-z),B.push(x++)}S.push(B)}for(let O=0;O<s;O++)for(let B=0;B<i;B++){const z=S[B][O],tt=S[B+1][O],j=S[B+1][O+1],dt=S[B][O+1];(t>0||B!==0)&&(f.push(z,tt,dt),F+=3),(e>0||B!==i-1)&&(f.push(tt,j,dt),F+=3)}d.addGroup(M,F,0),M+=F}function v(A){const R=x,F=new Ot,D=new G;let O=0;const B=A===!0?t:e,z=A===!0?1:-1;for(let j=1;j<=s;j++)p.push(0,T*z,0),g.push(0,z,0),y.push(.5,.5),x++;const tt=x;for(let j=0;j<=s;j++){const wt=j/s*u+c,ft=Math.cos(wt),U=Math.sin(wt);D.x=B*U,D.y=T*z,D.z=B*ft,p.push(D.x,D.y,D.z),g.push(0,z,0),F.x=ft*.5+.5,F.y=U*.5*z+.5,y.push(F.x,F.y),x++}for(let j=0;j<s;j++){const dt=R+j,wt=tt+j;A===!0?f.push(wt,wt+1,dt):f.push(wt+1,wt,dt),O+=3}d.addGroup(M,O,A===!0?1:2),M+=O}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new $t(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class pi extends $t{constructor(t=1,e=1,n=32,s=1,i=!1,a=0,c=Math.PI*2){super(0,t,e,n,s,i,a,c),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:s,openEnded:i,thetaStart:a,thetaLength:c}}static fromJSON(t){return new pi(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Lw extends Ye{constructor(t=[],e=[],n=1,s=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:s};const i=[],a=[];c(s),d(n),f(),this.setAttribute("position",new ge(i,3)),this.setAttribute("normal",new ge(i.slice(),3)),this.setAttribute("uv",new ge(a,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function c(N){const v=new G,A=new G,R=new G;for(let F=0;F<e.length;F+=3)y(e[F+0],v),y(e[F+1],A),y(e[F+2],R),u(v,A,R,N)}function u(N,v,A,R){const F=R+1,D=[];for(let O=0;O<=F;O++){D[O]=[];const B=N.clone().lerp(A,O/F),z=v.clone().lerp(A,O/F),tt=F-O;for(let j=0;j<=tt;j++)j===0&&O===F?D[O][j]=B:D[O][j]=B.clone().lerp(z,j/tt)}for(let O=0;O<F;O++)for(let B=0;B<2*(F-O)-1;B++){const z=Math.floor(B/2);B%2===0?(g(D[O][z+1]),g(D[O+1][z]),g(D[O][z])):(g(D[O][z+1]),g(D[O+1][z+1]),g(D[O+1][z]))}}function d(N){const v=new G;for(let A=0;A<i.length;A+=3)v.x=i[A+0],v.y=i[A+1],v.z=i[A+2],v.normalize().multiplyScalar(N),i[A+0]=v.x,i[A+1]=v.y,i[A+2]=v.z}function f(){const N=new G;for(let v=0;v<i.length;v+=3){N.x=i[v+0],N.y=i[v+1],N.z=i[v+2];const A=T(N)/2/Math.PI+.5,R=M(N)/Math.PI+.5;a.push(A,1-R)}x(),p()}function p(){for(let N=0;N<a.length;N+=6){const v=a[N+0],A=a[N+2],R=a[N+4],F=Math.max(v,A,R),D=Math.min(v,A,R);F>.9&&D<.1&&(v<.2&&(a[N+0]+=1),A<.2&&(a[N+2]+=1),R<.2&&(a[N+4]+=1))}}function g(N){i.push(N.x,N.y,N.z)}function y(N,v){const A=N*3;v.x=t[A+0],v.y=t[A+1],v.z=t[A+2]}function x(){const N=new G,v=new G,A=new G,R=new G,F=new Ot,D=new Ot,O=new Ot;for(let B=0,z=0;B<i.length;B+=9,z+=6){N.set(i[B+0],i[B+1],i[B+2]),v.set(i[B+3],i[B+4],i[B+5]),A.set(i[B+6],i[B+7],i[B+8]),F.set(a[z+0],a[z+1]),D.set(a[z+2],a[z+3]),O.set(a[z+4],a[z+5]),R.copy(N).add(v).add(A).divideScalar(3);const tt=T(R);S(F,z+0,N,tt),S(D,z+2,v,tt),S(O,z+4,A,tt)}}function S(N,v,A,R){R<0&&N.x===1&&(a[v]=N.x-1),A.x===0&&A.z===0&&(a[v]=R/2/Math.PI+.5)}function T(N){return Math.atan2(N.z,-N.x)}function M(N){return Math.atan2(-N.y,Math.sqrt(N.x*N.x+N.z*N.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Lw(t.vertices,t.indices,t.radius,t.detail)}}class da{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){Wt("Curve: .getPoint() not implemented.")}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,s=this.getPoint(0),i=0;e.push(0);for(let a=1;a<=t;a++)n=this.getPoint(a/t),i+=n.distanceTo(s),e.push(i),s=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e=null){const n=this.getLengths();let s=0;const i=n.length;let a;e?a=e:a=t*n[i-1];let c=0,u=i-1,d;for(;c<=u;)if(s=Math.floor(c+(u-c)/2),d=n[s]-a,d<0)c=s+1;else if(d>0)u=s-1;else{u=s;break}if(s=u,n[s]===a)return s/(i-1);const f=n[s],g=n[s+1]-f,y=(a-f)/g;return(s+y)/(i-1)}getTangent(t,e){let s=t-1e-4,i=t+1e-4;s<0&&(s=0),i>1&&(i=1);const a=this.getPoint(s),c=this.getPoint(i),u=e||(a.isVector2?new Ot:new G);return u.copy(c).sub(a).normalize(),u}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e=!1){const n=new G,s=[],i=[],a=[],c=new G,u=new Te;for(let y=0;y<=t;y++){const x=y/t;s[y]=this.getTangentAt(x,new G)}i[0]=new G,a[0]=new G;let d=Number.MAX_VALUE;const f=Math.abs(s[0].x),p=Math.abs(s[0].y),g=Math.abs(s[0].z);f<=d&&(d=f,n.set(1,0,0)),p<=d&&(d=p,n.set(0,1,0)),g<=d&&n.set(0,0,1),c.crossVectors(s[0],n).normalize(),i[0].crossVectors(s[0],c),a[0].crossVectors(s[0],i[0]);for(let y=1;y<=t;y++){if(i[y]=i[y-1].clone(),a[y]=a[y-1].clone(),c.crossVectors(s[y-1],s[y]),c.length()>Number.EPSILON){c.normalize();const x=Math.acos(Ee(s[y-1].dot(s[y]),-1,1));i[y].applyMatrix4(u.makeRotationAxis(c,x))}a[y].crossVectors(s[y],i[y])}if(e===!0){let y=Math.acos(Ee(i[0].dot(i[t]),-1,1));y/=t,s[0].dot(c.crossVectors(i[0],i[t]))>0&&(y=-y);for(let x=1;x<=t;x++)i[x].applyMatrix4(u.makeRotationAxis(s[x],y*x)),a[x].crossVectors(s[x],i[x])}return{tangents:s,normals:i,binormals:a}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Ow extends da{constructor(t=0,e=0,n=1,s=1,i=0,a=Math.PI*2,c=!1,u=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=s,this.aStartAngle=i,this.aEndAngle=a,this.aClockwise=c,this.aRotation=u}getPoint(t,e=new Ot){const n=e,s=Math.PI*2;let i=this.aEndAngle-this.aStartAngle;const a=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=s;for(;i>s;)i-=s;i<Number.EPSILON&&(a?i=0:i=s),this.aClockwise===!0&&!a&&(i===s?i=-s:i=i-s);const c=this.aStartAngle+t*i;let u=this.aX+this.xRadius*Math.cos(c),d=this.aY+this.yRadius*Math.sin(c);if(this.aRotation!==0){const f=Math.cos(this.aRotation),p=Math.sin(this.aRotation),g=u-this.aX,y=d-this.aY;u=g*f-y*p+this.aX,d=g*p+y*f+this.aY}return n.set(u,d)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class t8 extends Ow{constructor(t,e,n,s,i,a){super(t,e,n,n,s,i,a),this.isArcCurve=!0,this.type="ArcCurve"}}function Fw(){let r=0,t=0,e=0,n=0;function s(i,a,c,u){r=i,t=c,e=-3*i+3*a-2*c-u,n=2*i-2*a+c+u}return{initCatmullRom:function(i,a,c,u,d){s(a,c,d*(c-i),d*(u-a))},initNonuniformCatmullRom:function(i,a,c,u,d,f,p){let g=(a-i)/d-(c-i)/(d+f)+(c-a)/f,y=(c-a)/f-(u-a)/(f+p)+(u-c)/p;g*=f,y*=f,s(a,c,g,y)},calc:function(i){const a=i*i,c=a*i;return r+t*i+e*a+n*c}}}const Om=new G,TS=new Fw,_S=new Fw,MS=new Fw;class iC extends da{constructor(t=[],e=!1,n="centripetal",s=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=s}getPoint(t,e=new G){const n=e,s=this.points,i=s.length,a=(i-(this.closed?0:1))*t;let c=Math.floor(a),u=a-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/i)+1)*i:u===0&&c===i-1&&(c=i-2,u=1);let d,f;this.closed||c>0?d=s[(c-1)%i]:(Om.subVectors(s[0],s[1]).add(s[0]),d=Om);const p=s[c%i],g=s[(c+1)%i];if(this.closed||c+2<i?f=s[(c+2)%i]:(Om.subVectors(s[i-1],s[i-2]).add(s[i-1]),f=Om),this.curveType==="centripetal"||this.curveType==="chordal"){const y=this.curveType==="chordal"?.5:.25;let x=Math.pow(d.distanceToSquared(p),y),S=Math.pow(p.distanceToSquared(g),y),T=Math.pow(g.distanceToSquared(f),y);S<1e-4&&(S=1),x<1e-4&&(x=S),T<1e-4&&(T=S),TS.initNonuniformCatmullRom(d.x,p.x,g.x,f.x,x,S,T),_S.initNonuniformCatmullRom(d.y,p.y,g.y,f.y,x,S,T),MS.initNonuniformCatmullRom(d.z,p.z,g.z,f.z,x,S,T)}else this.curveType==="catmullrom"&&(TS.initCatmullRom(d.x,p.x,g.x,f.x,this.tension),_S.initCatmullRom(d.y,p.y,g.y,f.y,this.tension),MS.initCatmullRom(d.z,p.z,g.z,f.z,this.tension));return n.set(TS.calc(u),_S.calc(u),MS.calc(u)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const s=t.points[e];this.points.push(s.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const s=this.points[e];t.points.push(s.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const s=t.points[e];this.points.push(new G().fromArray(s))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function GN(r,t,e,n,s){const i=(n-t)*.5,a=(s-e)*.5,c=r*r,u=r*c;return(2*e-2*n+i+a)*u+(-3*e+3*n-2*i-a)*c+i*r+e}function e8(r,t){const e=1-r;return e*e*t}function n8(r,t){return 2*(1-r)*r*t}function s8(r,t){return r*r*t}function gp(r,t,e,n){return e8(r,t)+n8(r,e)+s8(r,n)}function i8(r,t){const e=1-r;return e*e*e*t}function r8(r,t){const e=1-r;return 3*e*e*r*t}function o8(r,t){return 3*(1-r)*r*r*t}function a8(r,t){return r*r*r*t}function yp(r,t,e,n,s){return i8(r,t)+r8(r,e)+o8(r,n)+a8(r,s)}class rC extends da{constructor(t=new Ot,e=new Ot,n=new Ot,s=new Ot){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=s}getPoint(t,e=new Ot){const n=e,s=this.v0,i=this.v1,a=this.v2,c=this.v3;return n.set(yp(t,s.x,i.x,a.x,c.x),yp(t,s.y,i.y,a.y,c.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class l8 extends da{constructor(t=new G,e=new G,n=new G,s=new G){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=s}getPoint(t,e=new G){const n=e,s=this.v0,i=this.v1,a=this.v2,c=this.v3;return n.set(yp(t,s.x,i.x,a.x,c.x),yp(t,s.y,i.y,a.y,c.y),yp(t,s.z,i.z,a.z,c.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class oC extends da{constructor(t=new Ot,e=new Ot){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Ot){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Ot){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class c8 extends da{constructor(t=new G,e=new G){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new G){const n=e;return t===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new G){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class aC extends da{constructor(t=new Ot,e=new Ot,n=new Ot){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Ot){const n=e,s=this.v0,i=this.v1,a=this.v2;return n.set(gp(t,s.x,i.x,a.x),gp(t,s.y,i.y,a.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class lC extends da{constructor(t=new G,e=new G,n=new G){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new G){const n=e,s=this.v0,i=this.v1,a=this.v2;return n.set(gp(t,s.x,i.x,a.x),gp(t,s.y,i.y,a.y),gp(t,s.z,i.z,a.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class cC extends da{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Ot){const n=e,s=this.points,i=(s.length-1)*t,a=Math.floor(i),c=i-a,u=s[a===0?a:a-1],d=s[a],f=s[a>s.length-2?s.length-1:a+1],p=s[a>s.length-3?s.length-1:a+2];return n.set(GN(c,u.x,d.x,f.x,p.x),GN(c,u.y,d.y,f.y,p.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const s=t.points[e];this.points.push(s.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const s=this.points[e];t.points.push(s.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const s=t.points[e];this.points.push(new Ot().fromArray(s))}return this}}var Ny=Object.freeze({__proto__:null,ArcCurve:t8,CatmullRomCurve3:iC,CubicBezierCurve:rC,CubicBezierCurve3:l8,EllipseCurve:Ow,LineCurve:oC,LineCurve3:c8,QuadraticBezierCurve:aC,QuadraticBezierCurve3:lC,SplineCurve:cC});class u8 extends da{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const n=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Ny[n](e,t))}return this}getPoint(t,e){const n=t*this.getLength(),s=this.getCurveLengths();let i=0;for(;i<s.length;){if(s[i]>=n){const a=s[i]-n,c=this.curves[i],u=c.getLength(),d=u===0?0:1-a/u;return c.getPointAt(d,e)}i++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,s=this.curves.length;n<s;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let s=0,i=this.curves;s<i.length;s++){const a=i[s],c=a.isEllipseCurve?t*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?t*a.points.length:t,u=a.getPoints(c);for(let d=0;d<u.length;d++){const f=u[d];n&&n.equals(f)||(e.push(f),n=f)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const s=t.curves[e];this.curves.push(s.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const s=this.curves[e];t.curves.push(s.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const s=t.curves[e];this.curves.push(new Ny[s.type]().fromJSON(s))}return this}}class P2 extends u8{constructor(t){super(),this.type="Path",this.currentPoint=new Ot,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new oC(this.currentPoint.clone(),new Ot(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,s){const i=new aC(this.currentPoint.clone(),new Ot(t,e),new Ot(n,s));return this.curves.push(i),this.currentPoint.set(n,s),this}bezierCurveTo(t,e,n,s,i,a){const c=new rC(this.currentPoint.clone(),new Ot(t,e),new Ot(n,s),new Ot(i,a));return this.curves.push(c),this.currentPoint.set(i,a),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new cC(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,s,i,a){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absarc(t+c,e+u,n,s,i,a),this}absarc(t,e,n,s,i,a){return this.absellipse(t,e,n,n,s,i,a),this}ellipse(t,e,n,s,i,a,c,u){const d=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(t+d,e+f,n,s,i,a,c,u),this}absellipse(t,e,n,s,i,a,c,u){const d=new Ow(t,e,n,s,i,a,c,u);if(this.curves.length>0){const p=d.getPoint(0);p.equals(this.currentPoint)||this.lineTo(p.x,p.y)}this.curves.push(d);const f=d.getPoint(1);return this.currentPoint.copy(f),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class rd extends P2{constructor(t){super(t),this.uuid=ta(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,s=this.holes.length;n<s;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const s=t.holes[e];this.holes.push(s.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const s=this.holes[e];t.holes.push(s.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const s=t.holes[e];this.holes.push(new P2().fromJSON(s))}return this}}function h8(r,t,e=2){const n=t&&t.length,s=n?t[0]*e:r.length;let i=uC(r,0,s,e,!0);const a=[];if(!i||i.next===i.prev)return a;let c,u,d;if(n&&(i=g8(r,t,i,e)),r.length>80*e){c=r[0],u=r[1];let f=c,p=u;for(let g=e;g<s;g+=e){const y=r[g],x=r[g+1];y<c&&(c=y),x<u&&(u=x),y>f&&(f=y),x>p&&(p=x)}d=Math.max(f-c,p-u),d=d!==0?32767/d:0}return Lp(i,a,e,c,u,d,0),a}function uC(r,t,e,n,s){let i;if(s===N8(r,t,e,n)>0)for(let a=t;a<e;a+=n)i=kN(a/n|0,r[a],r[a+1],i);else for(let a=e-n;a>=t;a-=n)i=kN(a/n|0,r[a],r[a+1],i);return i&&_d(i,i.next)&&(Fp(i),i=i.next),i}function Fu(r,t){if(!r)return r;t||(t=r);let e=r,n;do if(n=!1,!e.steiner&&(_d(e,e.next)||es(e.prev,e,e.next)===0)){if(Fp(e),e=t=e.prev,e===e.next)break;n=!0}else e=e.next;while(n||e!==t);return t}function Lp(r,t,e,n,s,i,a){if(!r)return;!a&&i&&w8(r,n,s,i);let c=r;for(;r.prev!==r.next;){const u=r.prev,d=r.next;if(i?f8(r,n,s,i):d8(r)){t.push(u.i,r.i,d.i),Fp(r),r=d.next,c=d.next;continue}if(r=d,r===c){a?a===1?(r=p8(Fu(r),t),Lp(r,t,e,n,s,i,2)):a===2&&m8(r,t,e,n,s,i):Lp(Fu(r),t,e,n,s,i,1);break}}}function d8(r){const t=r.prev,e=r,n=r.next;if(es(t,e,n)>=0)return!1;const s=t.x,i=e.x,a=n.x,c=t.y,u=e.y,d=n.y,f=Math.min(s,i,a),p=Math.min(c,u,d),g=Math.max(s,i,a),y=Math.max(c,u,d);let x=n.next;for(;x!==t;){if(x.x>=f&&x.x<=g&&x.y>=p&&x.y<=y&&np(s,c,i,u,a,d,x.x,x.y)&&es(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function f8(r,t,e,n){const s=r.prev,i=r,a=r.next;if(es(s,i,a)>=0)return!1;const c=s.x,u=i.x,d=a.x,f=s.y,p=i.y,g=a.y,y=Math.min(c,u,d),x=Math.min(f,p,g),S=Math.max(c,u,d),T=Math.max(f,p,g),M=z2(y,x,t,e,n),N=z2(S,T,t,e,n);let v=r.prevZ,A=r.nextZ;for(;v&&v.z>=M&&A&&A.z<=N;){if(v.x>=y&&v.x<=S&&v.y>=x&&v.y<=T&&v!==s&&v!==a&&np(c,f,u,p,d,g,v.x,v.y)&&es(v.prev,v,v.next)>=0||(v=v.prevZ,A.x>=y&&A.x<=S&&A.y>=x&&A.y<=T&&A!==s&&A!==a&&np(c,f,u,p,d,g,A.x,A.y)&&es(A.prev,A,A.next)>=0))return!1;A=A.nextZ}for(;v&&v.z>=M;){if(v.x>=y&&v.x<=S&&v.y>=x&&v.y<=T&&v!==s&&v!==a&&np(c,f,u,p,d,g,v.x,v.y)&&es(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;A&&A.z<=N;){if(A.x>=y&&A.x<=S&&A.y>=x&&A.y<=T&&A!==s&&A!==a&&np(c,f,u,p,d,g,A.x,A.y)&&es(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function p8(r,t){let e=r;do{const n=e.prev,s=e.next.next;!_d(n,s)&&dC(n,e,e.next,s)&&Op(n,s)&&Op(s,n)&&(t.push(n.i,e.i,s.i),Fp(e),Fp(e.next),e=r=s),e=e.next}while(e!==r);return Fu(e)}function m8(r,t,e,n,s,i){let a=r;do{let c=a.next.next;for(;c!==a.prev;){if(a.i!==c.i&&M8(a,c)){let u=fC(a,c);a=Fu(a,a.next),u=Fu(u,u.next),Lp(a,t,e,n,s,i,0),Lp(u,t,e,n,s,i,0);return}c=c.next}a=a.next}while(a!==r)}function g8(r,t,e,n){const s=[];for(let i=0,a=t.length;i<a;i++){const c=t[i]*n,u=i<a-1?t[i+1]*n:r.length,d=uC(r,c,u,n,!1);d===d.next&&(d.steiner=!0),s.push(_8(d))}s.sort(y8);for(let i=0;i<s.length;i++)e=x8(s[i],e);return e}function y8(r,t){let e=r.x-t.x;if(e===0&&(e=r.y-t.y,e===0)){const n=(r.next.y-r.y)/(r.next.x-r.x),s=(t.next.y-t.y)/(t.next.x-t.x);e=n-s}return e}function x8(r,t){const e=b8(r,t);if(!e)return t;const n=fC(e,r);return Fu(n,n.next),Fu(e,e.next)}function b8(r,t){let e=t;const n=r.x,s=r.y;let i=-1/0,a;if(_d(r,e))return e;do{if(_d(r,e.next))return e.next;if(s<=e.y&&s>=e.next.y&&e.next.y!==e.y){const p=e.x+(s-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(p<=n&&p>i&&(i=p,a=e.x<e.next.x?e:e.next,p===n))return a}e=e.next}while(e!==t);if(!a)return null;const c=a,u=a.x,d=a.y;let f=1/0;e=a;do{if(n>=e.x&&e.x>=u&&n!==e.x&&hC(s<d?n:i,s,u,d,s<d?i:n,s,e.x,e.y)){const p=Math.abs(s-e.y)/(n-e.x);Op(e,r)&&(p<f||p===f&&(e.x>a.x||e.x===a.x&&S8(a,e)))&&(a=e,f=p)}e=e.next}while(e!==c);return a}function S8(r,t){return es(r.prev,r,t.prev)<0&&es(t.next,r,r.next)<0}function w8(r,t,e,n){let s=r;do s.z===0&&(s.z=z2(s.x,s.y,t,e,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,T8(s)}function T8(r){let t,e=1;do{let n=r,s;r=null;let i=null;for(t=0;n;){t++;let a=n,c=0;for(let d=0;d<e&&(c++,a=a.nextZ,!!a);d++);let u=e;for(;c>0||u>0&&a;)c!==0&&(u===0||!a||n.z<=a.z)?(s=n,n=n.nextZ,c--):(s=a,a=a.nextZ,u--),i?i.nextZ=s:r=s,s.prevZ=i,i=s;n=a}i.nextZ=null,e*=2}while(t>1);return r}function z2(r,t,e,n,s){return r=(r-e)*s|0,t=(t-n)*s|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function _8(r){let t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function hC(r,t,e,n,s,i,a,c){return(s-a)*(t-c)>=(r-a)*(i-c)&&(r-a)*(n-c)>=(e-a)*(t-c)&&(e-a)*(i-c)>=(s-a)*(n-c)}function np(r,t,e,n,s,i,a,c){return!(r===a&&t===c)&&hC(r,t,e,n,s,i,a,c)}function M8(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!v8(r,t)&&(Op(r,t)&&Op(t,r)&&A8(r,t)&&(es(r.prev,r,t.prev)||es(r,t.prev,t))||_d(r,t)&&es(r.prev,r,r.next)>0&&es(t.prev,t,t.next)>0)}function es(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function _d(r,t){return r.x===t.x&&r.y===t.y}function dC(r,t,e,n){const s=Um(es(r,t,e)),i=Um(es(r,t,n)),a=Um(es(e,n,r)),c=Um(es(e,n,t));return!!(s!==i&&a!==c||s===0&&Fm(r,e,t)||i===0&&Fm(r,n,t)||a===0&&Fm(e,r,n)||c===0&&Fm(e,t,n))}function Fm(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function Um(r){return r>0?1:r<0?-1:0}function v8(r,t){let e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&dC(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function Op(r,t){return es(r.prev,r,r.next)<0?es(r,t,r.next)>=0&&es(r,r.prev,t)>=0:es(r,t,r.prev)<0||es(r,r.next,t)<0}function A8(r,t){let e=r,n=!1;const s=(r.x+t.x)/2,i=(r.y+t.y)/2;do e.y>i!=e.next.y>i&&e.next.y!==e.y&&s<(e.next.x-e.x)*(i-e.y)/(e.next.y-e.y)+e.x&&(n=!n),e=e.next;while(e!==r);return n}function fC(r,t){const e=I2(r.i,r.x,r.y),n=I2(t.i,t.x,t.y),s=r.next,i=t.prev;return r.next=t,t.prev=r,e.next=s,s.prev=e,n.next=e,e.prev=n,i.next=n,n.prev=i,n}function kN(r,t,e,n){const s=I2(r,t,e);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function Fp(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function I2(r,t,e){return{i:r,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function N8(r,t,e,n){let s=0;for(let i=t,a=e-n;i<e;i+=n)s+=(r[a]-r[i])*(r[i+1]+r[a+1]),a=i;return s}class R8{static triangulate(t,e,n=2){return h8(t,e,n)}}class Qa{static area(t){const e=t.length;let n=0;for(let s=e-1,i=0;i<e;s=i++)n+=t[s].x*t[i].y-t[i].x*t[s].y;return n*.5}static isClockWise(t){return Qa.area(t)<0}static triangulateShape(t,e){const n=[],s=[],i=[];HN(t),WN(n,t);let a=t.length;e.forEach(HN);for(let u=0;u<e.length;u++)s.push(a),a+=e[u].length,WN(n,e[u]);const c=R8.triangulate(n,s);for(let u=0;u<c.length;u+=3)i.push(c.slice(u,u+3));return i}}function HN(r){const t=r.length;t>2&&r[t-1].equals(r[0])&&r.pop()}function WN(r,t){for(let e=0;e<t.length;e++)r.push(t[e].x),r.push(t[e].y)}class xp extends Ye{constructor(t=new rd([new Ot(.5,.5),new Ot(-.5,.5),new Ot(-.5,-.5),new Ot(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,s=[],i=[];for(let c=0,u=t.length;c<u;c++){const d=t[c];a(d)}this.setAttribute("position",new ge(s,3)),this.setAttribute("uv",new ge(i,2)),this.computeVertexNormals();function a(c){const u=[],d=e.curveSegments!==void 0?e.curveSegments:12,f=e.steps!==void 0?e.steps:1,p=e.depth!==void 0?e.depth:1;let g=e.bevelEnabled!==void 0?e.bevelEnabled:!0,y=e.bevelThickness!==void 0?e.bevelThickness:.2,x=e.bevelSize!==void 0?e.bevelSize:y-.1,S=e.bevelOffset!==void 0?e.bevelOffset:0,T=e.bevelSegments!==void 0?e.bevelSegments:3;const M=e.extrudePath,N=e.UVGenerator!==void 0?e.UVGenerator:E8;let v,A=!1,R,F,D,O;if(M){v=M.getSpacedPoints(f),A=!0,g=!1;const $=M.isCatmullRomCurve3?M.closed:!1;R=M.computeFrenetFrames(f,$),F=new G,D=new G,O=new G}g||(T=0,y=0,x=0,S=0);const B=c.extractPoints(d);let z=B.shape;const tt=B.holes;if(!Qa.isClockWise(z)){z=z.reverse();for(let $=0,mt=tt.length;$<mt;$++){const yt=tt[$];Qa.isClockWise(yt)&&(tt[$]=yt.reverse())}}function dt($){const yt=10000000000000001e-36;let Tt=$[0];for(let Mt=1;Mt<=$.length;Mt++){const Vt=Mt%$.length,zt=$[Vt],kt=zt.x-Tt.x,Qt=zt.y-Tt.y,ie=kt*kt+Qt*Qt,Yt=Math.max(Math.abs(zt.x),Math.abs(zt.y),Math.abs(Tt.x),Math.abs(Tt.y)),Ne=yt*Yt*Yt;if(ie<=Ne){$.splice(Vt,1),Mt--;continue}Tt=zt}}dt(z),tt.forEach(dt);const wt=tt.length,ft=z;for(let $=0;$<wt;$++){const mt=tt[$];z=z.concat(mt)}function U($,mt,yt){return mt||Ht("ExtrudeGeometry: vec does not exist"),$.clone().addScaledVector(mt,yt)}const K=z.length;function nt($,mt,yt){let Tt,Mt,Vt;const zt=$.x-mt.x,kt=$.y-mt.y,Qt=yt.x-$.x,ie=yt.y-$.y,Yt=zt*zt+kt*kt,Ne=zt*ie-kt*Qt;if(Math.abs(Ne)>Number.EPSILON){const ce=Math.sqrt(Yt),We=Math.sqrt(Qt*Qt+ie*ie),Sn=mt.x-kt/ce,vn=mt.y+zt/ce,rs=yt.x-ie/We,zn=yt.y+Qt/We,$n=((rs-Sn)*ie-(zn-vn)*Qt)/(zt*ie-kt*Qt);Tt=Sn+zt*$n-$.x,Mt=vn+kt*$n-$.y;const be=Tt*Tt+Mt*Mt;if(be<=2)return new Ot(Tt,Mt);Vt=Math.sqrt(be/2)}else{let ce=!1;zt>Number.EPSILON?Qt>Number.EPSILON&&(ce=!0):zt<-Number.EPSILON?Qt<-Number.EPSILON&&(ce=!0):Math.sign(kt)===Math.sign(ie)&&(ce=!0),ce?(Tt=-kt,Mt=zt,Vt=Math.sqrt(Yt)):(Tt=zt,Mt=kt,Vt=Math.sqrt(Yt/2))}return new Ot(Tt/Vt,Mt/Vt)}const ht=[];for(let $=0,mt=ft.length,yt=mt-1,Tt=$+1;$<mt;$++,yt++,Tt++)yt===mt&&(yt=0),Tt===mt&&(Tt=0),ht[$]=nt(ft[$],ft[yt],ft[Tt]);const _t=[];let P,q=ht.concat();for(let $=0,mt=wt;$<mt;$++){const yt=tt[$];P=[];for(let Tt=0,Mt=yt.length,Vt=Mt-1,zt=Tt+1;Tt<Mt;Tt++,Vt++,zt++)Vt===Mt&&(Vt=0),zt===Mt&&(zt=0),P[Tt]=nt(yt[Tt],yt[Vt],yt[zt]);_t.push(P),q=q.concat(P)}let L;if(T===0)L=Qa.triangulateShape(ft,tt);else{const $=[],mt=[];for(let yt=0;yt<T;yt++){const Tt=yt/T,Mt=y*Math.cos(Tt*Math.PI/2),Vt=x*Math.sin(Tt*Math.PI/2)+S;for(let zt=0,kt=ft.length;zt<kt;zt++){const Qt=U(ft[zt],ht[zt],Vt);et(Qt.x,Qt.y,-Mt),Tt===0&&$.push(Qt)}for(let zt=0,kt=wt;zt<kt;zt++){const Qt=tt[zt];P=_t[zt];const ie=[];for(let Yt=0,Ne=Qt.length;Yt<Ne;Yt++){const ce=U(Qt[Yt],P[Yt],Vt);et(ce.x,ce.y,-Mt),Tt===0&&ie.push(ce)}Tt===0&&mt.push(ie)}}L=Qa.triangulateShape($,mt)}const I=L.length,H=x+S;for(let $=0;$<K;$++){const mt=g?U(z[$],q[$],H):z[$];A?(D.copy(R.normals[0]).multiplyScalar(mt.x),F.copy(R.binormals[0]).multiplyScalar(mt.y),O.copy(v[0]).add(D).add(F),et(O.x,O.y,O.z)):et(mt.x,mt.y,0)}for(let $=1;$<=f;$++)for(let mt=0;mt<K;mt++){const yt=g?U(z[mt],q[mt],H):z[mt];A?(D.copy(R.normals[$]).multiplyScalar(yt.x),F.copy(R.binormals[$]).multiplyScalar(yt.y),O.copy(v[$]).add(D).add(F),et(O.x,O.y,O.z)):et(yt.x,yt.y,p/f*$)}for(let $=T-1;$>=0;$--){const mt=$/T,yt=y*Math.cos(mt*Math.PI/2),Tt=x*Math.sin(mt*Math.PI/2)+S;for(let Mt=0,Vt=ft.length;Mt<Vt;Mt++){const zt=U(ft[Mt],ht[Mt],Tt);et(zt.x,zt.y,p+yt)}for(let Mt=0,Vt=tt.length;Mt<Vt;Mt++){const zt=tt[Mt];P=_t[Mt];for(let kt=0,Qt=zt.length;kt<Qt;kt++){const ie=U(zt[kt],P[kt],Tt);A?et(ie.x,ie.y+v[f-1].y,v[f-1].x+yt):et(ie.x,ie.y,p+yt)}}}W(),at();function W(){const $=s.length/3;if(g){let mt=0,yt=K*mt;for(let Tt=0;Tt<I;Tt++){const Mt=L[Tt];ct(Mt[2]+yt,Mt[1]+yt,Mt[0]+yt)}mt=f+T*2,yt=K*mt;for(let Tt=0;Tt<I;Tt++){const Mt=L[Tt];ct(Mt[0]+yt,Mt[1]+yt,Mt[2]+yt)}}else{for(let mt=0;mt<I;mt++){const yt=L[mt];ct(yt[2],yt[1],yt[0])}for(let mt=0;mt<I;mt++){const yt=L[mt];ct(yt[0]+K*f,yt[1]+K*f,yt[2]+K*f)}}n.addGroup($,s.length/3-$,0)}function at(){const $=s.length/3;let mt=0;rt(ft,mt),mt+=ft.length;for(let yt=0,Tt=tt.length;yt<Tt;yt++){const Mt=tt[yt];rt(Mt,mt),mt+=Mt.length}n.addGroup($,s.length/3-$,1)}function rt($,mt){let yt=$.length;for(;--yt>=0;){const Tt=yt;let Mt=yt-1;Mt<0&&(Mt=$.length-1);for(let Vt=0,zt=f+T*2;Vt<zt;Vt++){const kt=K*Vt,Qt=K*(Vt+1),ie=mt+Tt+kt,Yt=mt+Mt+kt,Ne=mt+Mt+Qt,ce=mt+Tt+Qt;st(ie,Yt,Ne,ce)}}}function et($,mt,yt){u.push($),u.push(mt),u.push(yt)}function ct($,mt,yt){Z($),Z(mt),Z(yt);const Tt=s.length/3,Mt=N.generateTopUV(n,s,Tt-3,Tt-2,Tt-1);Q(Mt[0]),Q(Mt[1]),Q(Mt[2])}function st($,mt,yt,Tt){Z($),Z(mt),Z(Tt),Z(mt),Z(yt),Z(Tt);const Mt=s.length/3,Vt=N.generateSideWallUV(n,s,Mt-6,Mt-3,Mt-2,Mt-1);Q(Vt[0]),Q(Vt[1]),Q(Vt[3]),Q(Vt[1]),Q(Vt[2]),Q(Vt[3])}function Z($){s.push(u[$*3+0]),s.push(u[$*3+1]),s.push(u[$*3+2])}function Q($){i.push($.x),i.push($.y)}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes,n=this.parameters.options;return C8(e,n,t)}static fromJSON(t,e){const n=[];for(let i=0,a=t.shapes.length;i<a;i++){const c=e[t.shapes[i]];n.push(c)}const s=t.options.extrudePath;return s!==void 0&&(t.options.extrudePath=new Ny[s.type]().fromJSON(s)),new xp(n,t.options)}}const E8={generateTopUV:function(r,t,e,n,s){const i=t[e*3],a=t[e*3+1],c=t[n*3],u=t[n*3+1],d=t[s*3],f=t[s*3+1];return[new Ot(i,a),new Ot(c,u),new Ot(d,f)]},generateSideWallUV:function(r,t,e,n,s,i){const a=t[e*3],c=t[e*3+1],u=t[e*3+2],d=t[n*3],f=t[n*3+1],p=t[n*3+2],g=t[s*3],y=t[s*3+1],x=t[s*3+2],S=t[i*3],T=t[i*3+1],M=t[i*3+2];return Math.abs(c-f)<Math.abs(a-d)?[new Ot(a,1-u),new Ot(d,1-p),new Ot(g,1-x),new Ot(S,1-M)]:[new Ot(c,1-u),new Ot(f,1-p),new Ot(y,1-x),new Ot(T,1-M)]}};function C8(r,t,e){if(e.shapes=[],Array.isArray(r))for(let n=0,s=r.length;n<s;n++){const i=r[n];e.shapes.push(i.uuid)}else e.shapes.push(r.uuid);return e.options=Object.assign({},t),t.extrudePath!==void 0&&(e.options.extrudePath=t.extrudePath.toJSON()),e}class Rn extends Ye{constructor(t=1,e=1,n=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:s};const i=t/2,a=e/2,c=Math.floor(n),u=Math.floor(s),d=c+1,f=u+1,p=t/c,g=e/u,y=[],x=[],S=[],T=[];for(let M=0;M<f;M++){const N=M*g-a;for(let v=0;v<d;v++){const A=v*p-i;x.push(A,-N,0),S.push(0,0,1),T.push(v/c),T.push(1-M/u)}}for(let M=0;M<u;M++)for(let N=0;N<c;N++){const v=N+d*M,A=N+d*(M+1),R=N+1+d*(M+1),F=N+1+d*M;y.push(v,A,F),y.push(A,R,F)}this.setIndex(y),this.setAttribute("position",new ge(x,3)),this.setAttribute("normal",new ge(S,3)),this.setAttribute("uv",new ge(T,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Rn(t.width,t.height,t.widthSegments,t.heightSegments)}}class ox extends Ye{constructor(t=.5,e=1,n=32,s=1,i=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:s,thetaStart:i,thetaLength:a},n=Math.max(3,n),s=Math.max(1,s);const c=[],u=[],d=[],f=[];let p=t;const g=(e-t)/s,y=new G,x=new Ot;for(let S=0;S<=s;S++){for(let T=0;T<=n;T++){const M=i+T/n*a;y.x=p*Math.cos(M),y.y=p*Math.sin(M),u.push(y.x,y.y,y.z),d.push(0,0,1),x.x=(y.x/e+1)/2,x.y=(y.y/e+1)/2,f.push(x.x,x.y)}p+=g}for(let S=0;S<s;S++){const T=S*(n+1);for(let M=0;M<n;M++){const N=M+T,v=N,A=N+n+1,R=N+n+2,F=N+1;c.push(v,A,F),c.push(A,R,F)}}this.setIndex(c),this.setAttribute("position",new ge(u,3)),this.setAttribute("normal",new ge(d,3)),this.setAttribute("uv",new ge(f,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ox(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Uw extends Ye{constructor(t=new rd([new Ot(0,.5),new Ot(-.5,-.5),new Ot(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],s=[],i=[],a=[];let c=0,u=0;if(Array.isArray(t)===!1)d(t);else for(let f=0;f<t.length;f++)d(t[f]),this.addGroup(c,u,f),c+=u,u=0;this.setIndex(n),this.setAttribute("position",new ge(s,3)),this.setAttribute("normal",new ge(i,3)),this.setAttribute("uv",new ge(a,2));function d(f){const p=s.length/3,g=f.extractPoints(e);let y=g.shape;const x=g.holes;Qa.isClockWise(y)===!1&&(y=y.reverse());for(let T=0,M=x.length;T<M;T++){const N=x[T];Qa.isClockWise(N)===!0&&(x[T]=N.reverse())}const S=Qa.triangulateShape(y,x);for(let T=0,M=x.length;T<M;T++){const N=x[T];y=y.concat(N)}for(let T=0,M=y.length;T<M;T++){const N=y[T];s.push(N.x,N.y,0),i.push(0,0,1),a.push(N.x,N.y)}for(let T=0,M=S.length;T<M;T++){const N=S[T],v=N[0]+p,A=N[1]+p,R=N[2]+p;n.push(v,A,R),u+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return B8(e,t)}static fromJSON(t,e){const n=[];for(let s=0,i=t.shapes.length;s<i;s++){const a=e[t.shapes[s]];n.push(a)}return new Uw(n,t.curveSegments)}}function B8(r,t){if(t.shapes=[],Array.isArray(r))for(let e=0,n=r.length;e<n;e++){const s=r[e];t.shapes.push(s.uuid)}else t.shapes.push(r.uuid);return t}class ke extends Ye{constructor(t=1,e=32,n=16,s=0,i=Math.PI*2,a=0,c=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:s,phiLength:i,thetaStart:a,thetaLength:c},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const u=Math.min(a+c,Math.PI);let d=0;const f=[],p=new G,g=new G,y=[],x=[],S=[],T=[];for(let M=0;M<=n;M++){const N=[],v=M/n;let A=0;M===0&&a===0?A=.5/e:M===n&&u===Math.PI&&(A=-.5/e);for(let R=0;R<=e;R++){const F=R/e;p.x=-t*Math.cos(s+F*i)*Math.sin(a+v*c),p.y=t*Math.cos(a+v*c),p.z=t*Math.sin(s+F*i)*Math.sin(a+v*c),x.push(p.x,p.y,p.z),g.copy(p).normalize(),S.push(g.x,g.y,g.z),T.push(F+A,1-v),N.push(d++)}f.push(N)}for(let M=0;M<n;M++)for(let N=0;N<e;N++){const v=f[M][N+1],A=f[M][N],R=f[M+1][N],F=f[M+1][N+1];(M!==0||a>0)&&y.push(v,A,F),(M!==n-1||u<Math.PI)&&y.push(A,R,F)}this.setIndex(y),this.setAttribute("position",new ge(x,3)),this.setAttribute("normal",new ge(S,3)),this.setAttribute("uv",new ge(T,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ke(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Pw extends Lw{constructor(t=1,e=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],s=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,s,t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Pw(t.radius,t.detail)}}class la extends Ye{constructor(t=1,e=.4,n=12,s=48,i=Math.PI*2,a=0,c=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:s,arc:i,thetaStart:a,thetaLength:c},n=Math.floor(n),s=Math.floor(s);const u=[],d=[],f=[],p=[],g=new G,y=new G,x=new G;for(let S=0;S<=n;S++){const T=a+S/n*c;for(let M=0;M<=s;M++){const N=M/s*i;y.x=(t+e*Math.cos(T))*Math.cos(N),y.y=(t+e*Math.cos(T))*Math.sin(N),y.z=e*Math.sin(T),d.push(y.x,y.y,y.z),g.x=t*Math.cos(N),g.y=t*Math.sin(N),x.subVectors(y,g).normalize(),f.push(x.x,x.y,x.z),p.push(M/s),p.push(S/n)}}for(let S=1;S<=n;S++)for(let T=1;T<=s;T++){const M=(s+1)*S+T-1,N=(s+1)*(S-1)+T-1,v=(s+1)*(S-1)+T,A=(s+1)*S+T;u.push(M,N,A),u.push(N,v,A)}this.setIndex(u),this.setAttribute("position",new ge(d,3)),this.setAttribute("normal",new ge(f,3)),this.setAttribute("uv",new ge(p,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new la(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class zw extends Ye{constructor(t=new lC(new G(-1,-1,0),new G(-1,1,0),new G(1,1,0)),e=64,n=1,s=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:s,closed:i};const a=t.computeFrenetFrames(e,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const c=new G,u=new G,d=new Ot;let f=new G;const p=[],g=[],y=[],x=[];S(),this.setIndex(x),this.setAttribute("position",new ge(p,3)),this.setAttribute("normal",new ge(g,3)),this.setAttribute("uv",new ge(y,2));function S(){for(let v=0;v<e;v++)T(v);T(i===!1?e:0),N(),M()}function T(v){f=t.getPointAt(v/e,f);const A=a.normals[v],R=a.binormals[v];for(let F=0;F<=s;F++){const D=F/s*Math.PI*2,O=Math.sin(D),B=-Math.cos(D);u.x=B*A.x+O*R.x,u.y=B*A.y+O*R.y,u.z=B*A.z+O*R.z,u.normalize(),g.push(u.x,u.y,u.z),c.x=f.x+n*u.x,c.y=f.y+n*u.y,c.z=f.z+n*u.z,p.push(c.x,c.y,c.z)}}function M(){for(let v=1;v<=e;v++)for(let A=1;A<=s;A++){const R=(s+1)*(v-1)+(A-1),F=(s+1)*v+(A-1),D=(s+1)*v+A,O=(s+1)*(v-1)+A;x.push(R,F,O),x.push(F,D,O)}}function N(){for(let v=0;v<=e;v++)for(let A=0;A<=s;A++)d.x=v/e,d.y=A/s,y.push(d.x,d.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new zw(new Ny[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class D8 extends Mr{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new qt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class gt extends Mr{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new qt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nl,this.normalScale=new Ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ji,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Ry extends gt{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Ot(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Ee(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new qt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new qt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new qt(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class L8 extends Mr{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new qt(16777215),this.specular=new qt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nl,this.normalScale=new Ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ji,this.combine=Yy,this.reflectivity=1,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class O8 extends Mr{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new qt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nl,this.normalScale=new Ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class F8 extends Mr{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nl,this.normalScale=new Ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class U8 extends Mr{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new qt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nl,this.normalScale=new Ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ji,this.combine=Yy,this.reflectivity=1,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class P8 extends Mr{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new qt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=nl,this.normalScale=new Ot(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this.fog=t.fog,this}}class z8 extends sC{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}const vS={enabled:!1,files:{},add:function(r,t){this.enabled!==!1&&(qN(r)||(this.files[r]=t))},get:function(r){if(this.enabled!==!1&&!qN(r))return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};function qN(r){try{const t=r.slice(r.indexOf(":")+1);return new URL(t).protocol==="blob:"}catch{return!1}}class I8{constructor(t,e,n){const s=this;let i=!1,a=0,c=0,u;const d=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this._abortController=null,this.itemStart=function(f){c++,i===!1&&s.onStart!==void 0&&s.onStart(f,a,c),i=!0},this.itemEnd=function(f){a++,s.onProgress!==void 0&&s.onProgress(f,a,c),a===c&&(i=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(f){s.onError!==void 0&&s.onError(f)},this.resolveURL=function(f){return u?u(f):f},this.setURLModifier=function(f){return u=f,this},this.addHandler=function(f,p){return d.push(f,p),this},this.removeHandler=function(f){const p=d.indexOf(f);return p!==-1&&d.splice(p,2),this},this.getHandler=function(f){for(let p=0,g=d.length;p<g;p+=2){const y=d[p],x=d[p+1];if(y.global&&(y.lastIndex=0),y.test(f))return x}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const V8=new I8;class Iw{constructor(t){this.manager=t!==void 0?t:V8,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}load(){}loadAsync(t,e){const n=this;return new Promise(function(s,i){n.load(t,s,e,i)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}}Iw.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ph=new WeakMap;class G8 extends Iw{constructor(t){super(t)}load(t,e,n,s){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const i=this,a=vS.get(`image:${t}`);if(a!==void 0){if(a.complete===!0)i.manager.itemStart(t),setTimeout(function(){e&&e(a),i.manager.itemEnd(t)},0);else{let p=Ph.get(a);p===void 0&&(p=[],Ph.set(a,p)),p.push({onLoad:e,onError:s})}return a}const c=Ay("img");function u(){f(),e&&e(this);const p=Ph.get(this)||[];for(let g=0;g<p.length;g++){const y=p[g];y.onLoad&&y.onLoad(this)}Ph.delete(this),i.manager.itemEnd(t)}function d(p){f(),s&&s(p),vS.remove(`image:${t}`);const g=Ph.get(this)||[];for(let y=0;y<g.length;y++){const x=g[y];x.onError&&x.onError(p)}Ph.delete(this),i.manager.itemError(t),i.manager.itemEnd(t)}function f(){c.removeEventListener("load",u,!1),c.removeEventListener("error",d,!1)}return c.addEventListener("load",u,!1),c.addEventListener("error",d,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(c.crossOrigin=this.crossOrigin),vS.add(`image:${t}`,c),i.manager.itemStart(t),c.src=t,c}}class Vw extends Iw{constructor(t){super(t)}load(t,e,n,s){const i=new ns,a=new G8(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(c){i.image=c,i.needsUpdate=!0,e!==void 0&&e(i)},n,s),i}}class Iu extends Cn{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new qt(t),this.intensity=e}dispose(){this.dispatchEvent({type:"dispose"})}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,e}}class Vu extends Iu{constructor(t,e,n){super(t,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Cn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new qt(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}toJSON(t){const e=super.toJSON(t);return e.object.groundColor=this.groundColor.getHex(),e}}const AS=new Te,$N=new G,XN=new G;class Gw{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.biasNode=null,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Ot(512,512),this.mapType=gi,this.map=null,this.mapPass=null,this.matrix=new Te,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ix,this._frameExtents=new Ot(1,1),this._viewportCount=1,this._viewports=[new je(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;$N.setFromMatrixPosition(t.matrixWorld),e.position.copy($N),XN.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(XN),e.updateMatrixWorld(),AS.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(AS,e.coordinateSystem,e.reversedDepth),e.coordinateSystem===Zr||e.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(AS)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.autoUpdate=t.autoUpdate,this.needsUpdate=t.needsUpdate,this.normalBias=t.normalBias,this.blurSamples=t.blurSamples,this.mapSize.copy(t.mapSize),this.biasNode=t.biasNode,this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}const Pm=new G,zm=new Us,Po=new G;class pC extends Cn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Te,this.projectionMatrix=new Te,this.projectionMatrixInverse=new Te,this.coordinateSystem=wr,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorld.decompose(Pm,zm,Po),Po.x===1&&Po.y===1&&Po.z===1?this.matrixWorldInverse.copy(this.matrixWorld).invert():this.matrixWorldInverse.compose(Pm,zm,Po.set(1,1,1)).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorld.decompose(Pm,zm,Po),Po.x===1&&Po.y===1&&Po.z===1?this.matrixWorldInverse.copy(this.matrixWorld).invert():this.matrixWorldInverse.compose(Pm,zm,Po.set(1,1,1)).invert()}clone(){return new this.constructor().copy(this)}}const Hl=new G,jN=new Ot,YN=new Ot;class $i extends pC{constructor(t=50,e=1,n=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=Td*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(pp*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Td*2*Math.atan(Math.tan(pp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,n){Hl.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Hl.x,Hl.y).multiplyScalar(-t/Hl.z),Hl.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Hl.x,Hl.y).multiplyScalar(-t/Hl.z)}getViewSize(t,e){return this.getViewBounds(t,jN,YN),e.subVectors(YN,jN)}setViewOffset(t,e,n,s,i,a){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=s,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(pp*.5*this.fov)/this.zoom,n=2*e,s=this.aspect*n,i=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const u=a.fullWidth,d=a.fullHeight;i+=a.offsetX*s/u,e-=a.offsetY*n/d,s*=a.width/u,n*=a.height/d}const c=this.filmOffset;c!==0&&(i+=t*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+s,e,e-n,t,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}class k8 extends Gw{constructor(){super(new $i(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(t){const e=this.camera,n=Td*2*t.angle*this.focus,s=this.mapSize.width/this.mapSize.height*this.aspect,i=t.distance||e.far;(n!==e.fov||s!==e.aspect||i!==e.far)&&(e.fov=n,e.aspect=s,e.far=i,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class ax extends Iu{constructor(t,e,n=0,s=Math.PI/3,i=0,a=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Cn.DEFAULT_UP),this.updateMatrix(),this.target=new Cn,this.distance=n,this.angle=s,this.penumbra=i,this.decay=a,this.map=null,this.shadow=new k8}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.map=t.map,this.shadow=t.shadow.clone(),this}toJSON(t){const e=super.toJSON(t);return e.object.distance=this.distance,e.object.angle=this.angle,e.object.decay=this.decay,e.object.penumbra=this.penumbra,e.object.target=this.target.uuid,this.map&&this.map.isTexture&&(e.object.map=this.map.toJSON(t).uuid),e.object.shadow=this.shadow.toJSON(),e}}class H8 extends Gw{constructor(){super(new $i(90,1,.5,500)),this.isPointLightShadow=!0}}class ls extends Iu{constructor(t,e,n=0,s=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new H8}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}toJSON(t){const e=super.toJSON(t);return e.object.distance=this.distance,e.object.decay=this.decay,e.object.shadow=this.shadow.toJSON(),e}}class kw extends pC{constructor(t=-1,e=1,n=1,s=-1,i=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=s,this.near=i,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,n,s,i,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=s,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let i=n-t,a=n+t,c=s+e,u=s-e;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,f=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=d*this.view.offsetX,a=i+d*this.view.width,c-=f*this.view.offsetY,u=c-f*this.view.height}this.projectionMatrix.makeOrthographic(i,a,c,u,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}class W8 extends Gw{constructor(){super(new kw(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Fs extends Iu{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Cn.DEFAULT_UP),this.updateMatrix(),this.target=new Cn,this.shadow=new W8}dispose(){super.dispose(),this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}toJSON(t){const e=super.toJSON(t);return e.object.shadow=this.shadow.toJSON(),e.object.target=this.target.uuid,e}}class Ro extends Iu{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class q8 extends Iu{constructor(t,e,n=10,s=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class $8{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new G)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,s=t.y,i=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.282095),e.addScaledVector(a[1],.488603*s),e.addScaledVector(a[2],.488603*i),e.addScaledVector(a[3],.488603*n),e.addScaledVector(a[4],1.092548*(n*s)),e.addScaledVector(a[5],1.092548*(s*i)),e.addScaledVector(a[6],.315392*(3*i*i-1)),e.addScaledVector(a[7],1.092548*(n*i)),e.addScaledVector(a[8],.546274*(n*n-s*s)),e}getIrradianceAt(t,e){const n=t.x,s=t.y,i=t.z,a=this.coefficients;return e.copy(a[0]).multiplyScalar(.886227),e.addScaledVector(a[1],2*.511664*s),e.addScaledVector(a[2],2*.511664*i),e.addScaledVector(a[3],2*.511664*n),e.addScaledVector(a[4],2*.429043*n*s),e.addScaledVector(a[5],2*.429043*s*i),e.addScaledVector(a[6],.743125*i*i-.247708),e.addScaledVector(a[7],2*.429043*n*i),e.addScaledVector(a[8],.429043*(n*n-s*s)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(t,e+s*3);return this}toArray(t=[],e=0){const n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(t,e+s*3);return t}static getBasisAt(t,e){const n=t.x,s=t.y,i=t.z;e[0]=.282095,e[1]=.488603*s,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*s,e[5]=1.092548*s*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-s*s)}}class X8 extends Iu{constructor(t=new $8,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}const zh=-90,Ih=1;class j8 extends Cn{constructor(t,e,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new $i(zh,Ih,t,e);s.layers=this.layers,this.add(s);const i=new $i(zh,Ih,t,e);i.layers=this.layers,this.add(i);const a=new $i(zh,Ih,t,e);a.layers=this.layers,this.add(a);const c=new $i(zh,Ih,t,e);c.layers=this.layers,this.add(c);const u=new $i(zh,Ih,t,e);u.layers=this.layers,this.add(u);const d=new $i(zh,Ih,t,e);d.layers=this.layers,this.add(d)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[n,s,i,a,c,u]=e;for(const d of e)this.remove(d);if(t===wr)n.up.set(0,1,0),n.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),i.up.set(0,0,-1),i.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),c.up.set(0,1,0),c.lookAt(0,0,1),u.up.set(0,1,0),u.lookAt(0,0,-1);else if(t===Zr)n.up.set(0,-1,0),n.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),i.up.set(0,0,1),i.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),c.up.set(0,-1,0),c.lookAt(0,0,1),u.up.set(0,-1,0),u.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const d of e)this.add(d),d.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:s}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[i,a,c,u,d,f]=this.children,p=t.getRenderTarget(),g=t.getActiveCubeFace(),y=t.getActiveMipmapLevel(),x=t.xr.enabled;t.xr.enabled=!1;const S=n.texture.generateMipmaps;n.texture.generateMipmaps=!1;let T=!1;t.isWebGLRenderer===!0?T=t.state.buffers.depth.getReversed():T=t.reversedDepthBuffer,t.setRenderTarget(n,0,s),T&&t.autoClear===!1&&t.clearDepth(),t.render(e,i),t.setRenderTarget(n,1,s),T&&t.autoClear===!1&&t.clearDepth(),t.render(e,a),t.setRenderTarget(n,2,s),T&&t.autoClear===!1&&t.clearDepth(),t.render(e,c),t.setRenderTarget(n,3,s),T&&t.autoClear===!1&&t.clearDepth(),t.render(e,u),t.setRenderTarget(n,4,s),T&&t.autoClear===!1&&t.clearDepth(),t.render(e,d),n.texture.generateMipmaps=S,t.setRenderTarget(n,5,s),T&&t.autoClear===!1&&t.clearDepth(),t.render(e,f),t.setRenderTarget(p,g,y),t.xr.enabled=x,n.texture.needsPMREMUpdate=!0}}class Y8 extends $i{constructor(t=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=t}}class K8{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1,Wt("THREE.Clock: This module has been deprecated. Please use THREE.Timer instead.")}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=performance.now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}class Z8 extends eC{constructor(t,e,n=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class lx{constructor(t,e,n,s){lx.prototype.isMatrix2=!0,this.elements=[1,0,0,1],t!==void 0&&this.set(t,e,n,s)}identity(){return this.set(1,0,0,1),this}fromArray(t,e=0){for(let n=0;n<4;n++)this.elements[n]=t[n+e];return this}set(t,e,n,s){const i=this.elements;return i[0]=t,i[2]=e,i[1]=n,i[3]=s,this}}function Q8(r,t,e,n){const s=J8(n);switch(e){case k3:return r*t;case Hp:return r*t/s.components*s.byteLength;case Qy:return r*t/s.components*s.byteLength;case jo:return r*t*2/s.components*s.byteLength;case Jy:return r*t*2/s.components*s.byteLength;case Zy:return r*t*3/s.components*s.byteLength;case Yi:return r*t*4/s.components*s.byteLength;case tx:return r*t*4/s.components*s.byteLength;case up:case hp:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*8;case dp:case fp:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*16;case B2:case L2:return Math.max(r,16)*Math.max(t,8)/4;case C2:case D2:return Math.max(r,8)*Math.max(t,8)/2;case Jg:case ty:case ny:case sy:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*8;case ey:case Cp:case iy:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*16;case ry:return Math.floor((r+3)/4)*Math.floor((t+3)/4)*16;case oy:return Math.floor((r+4)/5)*Math.floor((t+3)/4)*16;case ay:return Math.floor((r+4)/5)*Math.floor((t+4)/5)*16;case ly:return Math.floor((r+5)/6)*Math.floor((t+4)/5)*16;case cy:return Math.floor((r+5)/6)*Math.floor((t+5)/6)*16;case uy:return Math.floor((r+7)/8)*Math.floor((t+4)/5)*16;case hy:return Math.floor((r+7)/8)*Math.floor((t+5)/6)*16;case dy:return Math.floor((r+7)/8)*Math.floor((t+7)/8)*16;case fy:return Math.floor((r+9)/10)*Math.floor((t+4)/5)*16;case py:return Math.floor((r+9)/10)*Math.floor((t+5)/6)*16;case my:return Math.floor((r+9)/10)*Math.floor((t+7)/8)*16;case gy:return Math.floor((r+9)/10)*Math.floor((t+9)/10)*16;case yy:return Math.floor((r+11)/12)*Math.floor((t+9)/10)*16;case xy:return Math.floor((r+11)/12)*Math.floor((t+11)/12)*16;case by:case $F:case XF:return Math.ceil(r/4)*Math.ceil(t/4)*16;case Sy:case wy:return Math.ceil(r/4)*Math.ceil(t/4)*8;case Bp:case Ty:return Math.ceil(r/4)*Math.ceil(t/4)*16}throw new Error(`Unable to determine texture byte length for ${e} format.`)}function J8(r){switch(r){case gi:case cd:return{byteLength:1,components:1};case Mu:case ud:case ni:return{byteLength:2,components:1};case V3:case G3:return{byteLength:2,components:4};case Qn:case di:case Ri:return{byteLength:4,components:1};case Mw:case vw:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:kp}}));typeof window<"u"&&(window.__THREE__?Wt("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=kp);const tP=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],NS=new WeakMap;class eP{constructor(t){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(t),this.hasAnimation=t.object.isSkinnedMesh===!0,this.refreshUniforms=tP,this.renderId=0}firstInitialization(t){return this.renderObjects.has(t)===!1?(this.getRenderObjectData(t),!0):!1}needsVelocity(t){const e=t.getMRT();return e!==null&&e.has("velocity")}getRenderObjectData(t){let e=this.renderObjects.get(t);if(e===void 0){const{geometry:n,material:s,object:i}=t;if(e={material:this.getMaterialData(s),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexId:n.index?n.index.id:null,indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:i.matrixWorld.clone()},i.center&&(e.center=i.center.clone()),i.morphTargetInfluences&&(e.morphTargetInfluences=i.morphTargetInfluences.slice()),t.bundle!==null&&(e.version=t.bundle.version),e.material.transmission>0){const{width:a,height:c}=t.context;e.bufferWidth=a,e.bufferHeight=c}e.lights=this.getLightsData(t.lightsNode.getLights()),this.renderObjects.set(t,e)}return e}getAttributesData(t){const e={};for(const n in t){const s=t[n];e[n]={id:s.id,version:s.version}}return e}containsNode(t){const e=t.material;for(const n in e)if(e[n]&&e[n].isNode)return!0;return!!(t.context.modelViewMatrix||t.context.modelNormalViewMatrix||t.context.getAO||t.context.getShadow)}getMaterialData(t){const e={};for(const n of this.refreshUniforms){const s=t[n];s!=null&&(typeof s=="object"&&s.clone!==void 0?s.isTexture===!0?e[n]={id:s.id,version:s.version}:e[n]=s.clone():e[n]=s)}return e}equals(t,e){const{object:n,material:s,geometry:i}=t,a=this.getRenderObjectData(t);if(a.worldMatrix.equals(n.matrixWorld)!==!0)return a.worldMatrix.copy(n.matrixWorld),!1;const c=a.material;for(const N in c){const v=c[N],A=s[N];if(v.equals!==void 0){if(v.equals(A)===!1)return v.copy(A),!1}else if(A.isTexture===!0){if(v.id!==A.id||v.version!==A.version)return v.id=A.id,v.version=A.version,!1}else if(v!==A)return c[N]=A,!1}if(c.transmission>0){const{width:N,height:v}=t.context;if(a.bufferWidth!==N||a.bufferHeight!==v)return a.bufferWidth=N,a.bufferHeight=v,!1}const u=a.geometry,d=i.attributes,f=u.attributes,p=Object.keys(f),g=Object.keys(d);if(u.id!==i.id)return u.id=i.id,!1;if(p.length!==g.length)return a.geometry.attributes=this.getAttributesData(d),!1;for(const N of p){const v=f[N],A=d[N];if(A===void 0)return delete f[N],!1;if(v.id!==A.id||v.version!==A.version)return v.id=A.id,v.version=A.version,!1}const y=i.index,x=u.id,S=u.indexVersion,T=y?y.id:null,M=y?y.version:null;if(x!==T||S!==M)return u.id=T,u.indexVersion=M,!1;if(u.drawRange.start!==i.drawRange.start||u.drawRange.count!==i.drawRange.count)return u.drawRange.start=i.drawRange.start,u.drawRange.count=i.drawRange.count,!1;if(a.morphTargetInfluences){let N=!1;for(let v=0;v<a.morphTargetInfluences.length;v++)a.morphTargetInfluences[v]!==n.morphTargetInfluences[v]&&(a.morphTargetInfluences[v]=n.morphTargetInfluences[v],N=!0);if(N)return!1}if(a.lights){for(let N=0;N<e.length;N++)if(a.lights[N].map!==e[N].map)return!1}return a.center&&a.center.equals(n.center)===!1?(a.center.copy(n.center),!0):(t.bundle!==null&&(a.version=t.bundle.version),!0)}getLightsData(t){const e=[];for(const n of t)n.isSpotLight===!0&&n.map!==null&&e.push({map:n.map.version});return e}getLights(t,e){if(NS.has(t)){const s=NS.get(t);if(s.renderId===e)return s.lightsData}const n=this.getLightsData(t.getLights());return NS.set(t,{renderId:e,lightsData:n}),n}needsRefresh(t,e){if(this.hasNode||this.hasAnimation||this.firstInitialization(t)||this.needsVelocity(e.renderer))return!0;const{renderId:n}=e;if(this.renderId!==n)return this.renderId=n,!0;const s=t.object.static===!0,i=t.bundle!==null&&t.bundle.static===!0&&this.getRenderObjectData(t).version===t.bundle.version;if(s||i)return!1;const a=this.getLights(t.lightsNode,n);return this.equals(t,a)!==!0}}const nP=[/^StackTrace\.js$/,/^TSLCore\.js$/,/^.*Node\.js$/,/^three\.webgpu.*\.js$/];function sP(r){const t=/(?:at\s+(.+?)\s+\()?(?:(.+?)@)?([^@\s()]+):(\d+):(\d+)/;return r.split(`
`).map(e=>{const n=e.match(t);if(!n)return null;const s=n[1]||n[2]||"",i=n[3].split("?")[0],a=parseInt(n[4],10),c=parseInt(n[5],10),u=i.split("/").pop();return{fn:s,file:u,line:a,column:c}}).filter(e=>e&&!nP.some(n=>n.test(e.file)))}class ds{constructor(t=null){this.isStackTrace=!0,this.stack=sP(t||new Error().stack)}getLocation(){if(this.stack.length===0)return"[Unknown location]";const t=this.stack[0],e=t.fn;return`${e?`"${e}()" at `:""}"${t.file}:${t.line}"`}getError(t){if(this.stack.length===0)return t;const e=this.stack.map(n=>{const s=`${n.file}:${n.line}:${n.column}`;return n.fn?`    at ${n.fn} (${s})`:`    at ${s}`}).join(`
`);return`${t}
${e}`}}function Hw(r,t=0){let e=3735928559^t,n=1103547991^t;if(r instanceof Array)for(let s=0,i;s<r.length;s++)i=r[s],e=Math.imul(e^i,2654435761),n=Math.imul(n^i,1597334677);else for(let s=0,i;s<r.length;s++)i=r.charCodeAt(s),e=Math.imul(e^i,2654435761),n=Math.imul(n^i,1597334677);return e=Math.imul(e^e>>>16,2246822507),e^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(e^e>>>13,3266489909),4294967296*(2097151&n)+(e>>>0)}const Bd=r=>Hw(r),qp=r=>Hw(r),bp=(...r)=>Hw(r),iP=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),KN=new WeakMap;function mC(r){return iP.get(r)}function Ey(r){if(/[iu]?vec\d/.test(r))return r.startsWith("ivec")?Int32Array:r.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(r)||/float/.test(r))return Float32Array;if(/uint/.test(r))return Uint32Array;if(/int/.test(r))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${r}`)}function gC(r){if(/float|int|uint/.test(r))return 1;if(/vec2/.test(r))return 2;if(/vec3/.test(r))return 3;if(/vec4/.test(r)||/mat2/.test(r))return 4;if(/mat3/.test(r))return 9;if(/mat4/.test(r))return 16;Ht(`TSL: Unsupported type: ${r}`,new ds)}function rP(r){if(/float|int|uint/.test(r))return 1;if(/vec2/.test(r))return 2;if(/vec3/.test(r))return 3;if(/vec4/.test(r)||/mat2/.test(r))return 4;if(/mat3/.test(r))return 12;if(/mat4/.test(r))return 16;Ht(`TSL: Unsupported type: ${r}`,new ds)}function oP(r){if(/float|int|uint/.test(r))return 4;if(/vec2/.test(r))return 8;if(/vec3/.test(r)||/vec4/.test(r))return 16;if(/mat2/.test(r))return 8;if(/mat3/.test(r)||/mat4/.test(r))return 16;Ht(`TSL: Unsupported type: ${r}`,new ds)}function fc(r){if(r==null)return null;const t=typeof r;return r.isNode===!0?"node":t==="number"?"float":t==="boolean"?"bool":t==="string"?"string":t==="function"?"shader":r.isVector2===!0?"vec2":r.isVector3===!0?"vec3":r.isVector4===!0?"vec4":r.isMatrix2===!0?"mat2":r.isMatrix3===!0?"mat3":r.isMatrix4===!0?"mat4":r.isColor===!0?"color":r instanceof ArrayBuffer?"ArrayBuffer":null}function Ww(r,...t){const e=r?r.slice(-4):void 0;return t.length===1&&(e==="vec2"?t=[t[0],t[0]]:e==="vec3"?t=[t[0],t[0],t[0]]:e==="vec4"&&(t=[t[0],t[0],t[0],t[0]])),r==="color"?new qt(...t):e==="vec2"?new Ot(...t):e==="vec3"?new G(...t):e==="vec4"?new je(...t):e==="mat2"?new lx(...t):e==="mat3"?new sr(...t):e==="mat4"?new Te(...t):r==="bool"?t[0]||!1:r==="float"||r==="int"||r==="uint"?t[0]||0:r==="string"?t[0]||"":r==="ArrayBuffer"?lP(t[0]):null}function yC(r){let t=KN.get(r);return t===void 0&&(t={},KN.set(r,t)),t}function aP(r){let t="";const e=new Uint8Array(r);for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}function lP(r){return Uint8Array.from(atob(r),t=>t.charCodeAt(0)).buffer}const sp={VERTEX:"vertex",FRAGMENT:"fragment"},de={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},cP={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},si={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},xC=["fragment","vertex"],V2=["setup","analyze","generate"],G2=[...xC,"compute"],Gu=["x","y","z","w"],uP={analyze:"setup",generate:"analyze"};let hP=0;class Zt extends Rc{static get type(){return"Node"}constructor(t=null){super(),this.nodeType=t,this.updateType=de.NONE,this.updateBeforeType=de.NONE,this.updateAfterType=de.NONE,this.uuid=xt.generateUUID(),this.version=0,this.name="",this.global=!1,this.parents=!1,this.isNode=!0,this._beforeNodes=null,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:hP++}),this.stackTrace=null,Zt.captureStackTrace===!0&&(this.stackTrace=new ds)}set needsUpdate(t){t===!0&&this.version++}get type(){return this.constructor.type}onUpdate(t,e){return this.updateType=e,this.update=t.bind(this),this}onFrameUpdate(t){return this.onUpdate(t,de.FRAME)}onRenderUpdate(t){return this.onUpdate(t,de.RENDER)}onObjectUpdate(t){return this.onUpdate(t,de.OBJECT)}onReference(t){return this.updateReference=t.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:t}of this._getChildren())yield t}dispose(){this.dispatchEvent({type:"dispose"})}traverse(t){t(this);for(const e of this.getChildren())e.traverse(t)}_getChildren(t=new Set){const e=[];t.add(this);for(const n of Object.getOwnPropertyNames(this)){const s=this[n];if(!(n.startsWith("_")===!0||t.has(s))){if(Array.isArray(s)===!0)for(let i=0;i<s.length;i++){const a=s[i];a&&a.isNode===!0&&e.push({property:n,index:i,childNode:a})}else if(s&&s.isNode===!0)e.push({property:n,childNode:s});else if(s&&Object.getPrototypeOf(s)===Object.prototype)for(const i in s){if(i.startsWith("_")===!0)continue;const a=s[i];a&&a.isNode===!0&&e.push({property:n,index:i,childNode:a})}}}return e}getCacheKey(t=!1,e=null){if(t=t||this.version!==this._cacheKeyVersion,t===!0||this._cacheKey===null){e===null&&(e=new Set);const n=[];for(const{property:s,childNode:i}of this._getChildren(e))n.push(Bd(s.slice(0,-4)),i.getCacheKey(t,e));this._cacheKey=bp(qp(n),this.customCacheKey()),this._cacheKeyVersion=this.version}return this._cacheKey}customCacheKey(){return this.id}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(t){const e=this.getNodeType(t);return t.getElementType(e)}getMemberType(){return"void"}getNodeType(t){const e=t.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(t):this.nodeType}getShared(t){const e=this.getHash(t);return t.getNodeFromHash(e)||this}getArrayCount(){return null}setup(t){const e=t.getNodeProperties(this);let n=0;for(const s of this.getChildren())e["node"+n++]=s;return e.outputNode||null}analyze(t,e=null){const n=t.increaseUsage(this);if(this.parents===!0){const s=t.getDataFromNode(this,"any");s.stages=s.stages||{},s.stages[t.shaderStage]=s.stages[t.shaderStage]||[],s.stages[t.shaderStage].push(e)}if(n===1){const s=t.getNodeProperties(this);for(const i of Object.values(s))i&&i.isNode===!0&&i.build(t,this)}}generate(t,e){const{outputNode:n}=t.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(t,e)}updateBefore(){Wt("Abstract function.")}updateAfter(){Wt("Abstract function.")}update(){Wt("Abstract function.")}before(t){return this._beforeNodes===null&&(this._beforeNodes=[]),this._beforeNodes.push(t),this}build(t,e=null){const n=this.getShared(t);if(this!==n)return n.build(t,e);if(this._beforeNodes!==null){const u=this._beforeNodes;this._beforeNodes=null;for(const d of u)d.build(t,e);this._beforeNodes=u}const s=t.getDataFromNode(this);s.buildStages=s.buildStages||{},s.buildStages[t.buildStage]=!0;const i=uP[t.buildStage];if(i&&s.buildStages[i]!==!0){const u=t.getBuildStage();t.setBuildStage(i),this.build(t),t.setBuildStage(u)}t.addChain(this);let a=null;const c=t.getBuildStage();if(c==="setup"){t.addNode(this),this.updateReference(t);const u=t.getNodeProperties(this);if(u.initialized!==!0){u.initialized=!0,u.outputNode=this.setup(t)||u.outputNode||null;for(const d of Object.values(u))if(d&&d.isNode===!0){if(d.parents===!0){const f=t.getNodeProperties(d);f.parents=f.parents||[],f.parents.push(this)}d.build(t)}t.addSequentialNode(this)}a=u.outputNode}else if(c==="analyze")this.analyze(t,e);else if(c==="generate"){if(this.generate.length<2){const d=this.getNodeType(t),f=t.getDataFromNode(this);a=f.snippet,a===void 0?f.generated===void 0?(f.generated=!0,a=this.generate(t)||"",f.snippet=a):(Wt("Node: Recursion detected.",this),a="/* Recursion detected. */"):f.flowCodes!==void 0&&t.context.nodeBlock!==void 0&&t.addFlowCodeHierarchy(this,t.context.nodeBlock),a=t.format(a,d,e)}else a=this.generate(t,e)||"";a===""&&e!==null&&e!=="void"&&e!=="OutputType"&&(Ht(`TSL: Invalid generated code, expected a "${e}".`),a=t.generateConst(e))}return t.removeChain(this),a}getSerializeChildren(){return this._getChildren()}serialize(t){const e=this.getSerializeChildren(),n={};for(const{property:s,index:i,childNode:a}of e)i!==void 0?(n[s]===void 0&&(n[s]=Number.isInteger(i)?[]:{}),n[s][i]=a.toJSON(t.meta).uuid):n[s]=a.toJSON(t.meta).uuid;Object.keys(n).length>0&&(t.inputNodes=n)}deserialize(t){if(t.inputNodes!==void 0){const e=t.meta.nodes;for(const n in t.inputNodes)if(Array.isArray(t.inputNodes[n])){const s=[];for(const i of t.inputNodes[n])s.push(e[i]);this[n]=s}else if(typeof t.inputNodes[n]=="object"){const s={};for(const i in t.inputNodes[n]){const a=t.inputNodes[n][i];s[i]=e[a]}this[n]=s}else{const s=t.inputNodes[n];this[n]=e[s]}}}toJSON(t){const{uuid:e,type:n}=this,s=t===void 0||typeof t=="string";s&&(t={textures:{},images:{},nodes:{}});let i=t.nodes[e];i===void 0&&(i={uuid:e,type:n,meta:t,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},s!==!0&&(t.nodes[i.uuid]=i),this.serialize(i),delete i.meta);function a(c){const u=[];for(const d in c){const f=c[d];delete f.metadata,u.push(f)}return u}if(s){const c=a(t.textures),u=a(t.images),d=a(t.nodes);c.length>0&&(i.textures=c),u.length>0&&(i.images=u),d.length>0&&(i.nodes=d)}return i}}Zt.captureStackTrace=!1;class ku extends Zt{static get type(){return"ArrayElementNode"}constructor(t,e){super(),this.node=t,this.indexNode=e,this.isArrayElementNode=!0}getNodeType(t){return this.node.getElementType(t)}getMemberType(t,e){return this.node.getMemberType(t,e)}generate(t){const e=this.indexNode.getNodeType(t),n=this.node.build(t),s=this.indexNode.build(t,!t.isVector(e)&&t.isInteger(e)?e:"uint");return`${n}[ ${s} ]`}}class bC extends Zt{static get type(){return"ConvertNode"}constructor(t,e){super(),this.node=t,this.convertTo=e}getNodeType(t){const e=this.node.getNodeType(t);let n=null;for(const s of this.convertTo.split("|"))(n===null||t.getTypeLength(e)===t.getTypeLength(s))&&(n=s);return n}serialize(t){super.serialize(t),t.convertTo=this.convertTo}deserialize(t){super.deserialize(t),this.convertTo=t.convertTo}generate(t,e){const n=this.node,s=this.getNodeType(t),i=n.build(t,s);return t.format(i,s,e)}}class is extends Zt{static get type(){return"TempNode"}constructor(t=null){super(t),this.isTempNode=!0}hasDependencies(t){return t.getDataFromNode(this).usageCount>1}build(t,e){if(t.getBuildStage()==="generate"){const s=t.getVectorType(this.getNodeType(t,e)),i=t.getDataFromNode(this);if(i.propertyName!==void 0)return t.format(i.propertyName,s,e);if(s!=="void"&&e!=="void"&&this.hasDependencies(t)){const a=super.build(t,s),c=t.getVarFromNode(this,null,s),u=t.getPropertyName(c);return t.addLineFlowCode(`${u} = ${a}`,this),i.snippet=a,i.propertyName=u,t.format(i.propertyName,s,e)}}return super.build(t,e)}}class dP extends is{static get type(){return"JoinNode"}constructor(t=[],e=null){super(e),this.nodes=t}getNodeType(t){return this.nodeType!==null?t.getVectorType(this.nodeType):t.getTypeFromLength(this.nodes.reduce((e,n)=>e+t.getTypeLength(n.getNodeType(t)),0))}generate(t,e){const n=this.getNodeType(t),s=t.getTypeLength(n),i=this.nodes,a=t.getComponentType(n),c=[];let u=0;for(const f of i){if(u>=s){Ht(`TSL: Length of parameters exceeds maximum length of function '${n}()' type.`,this.stackTrace);break}let p=f.getNodeType(t),g=t.getTypeLength(p),y;if(u+g>s&&(Ht(`TSL: Length of '${n}()' data exceeds maximum length of output type.`,this.stackTrace),g=s-u,p=t.getTypeFromLength(g)),u+=g,y=f.build(t,p),t.getComponentType(p)!==a){const S=t.getTypeFromLength(g,a);y=t.format(y,p,S)}c.push(y)}const d=`${t.getType(n)}( ${c.join(", ")} )`;return t.format(d,n,e)}}const fP=Gu.join("");class SC extends Zt{static get type(){return"SplitNode"}constructor(t,e="x"){super(),this.node=t,this.components=e,this.isSplitNode=!0}getVectorLength(){let t=this.components.length;for(const e of this.components)t=Math.max(Gu.indexOf(e)+1,t);return t}getComponentType(t){return t.getComponentType(this.node.getNodeType(t))}getNodeType(t){return t.getTypeFromLength(this.components.length,this.getComponentType(t))}getScope(){return this.node.getScope()}generate(t,e){const n=this.node,s=t.getTypeLength(n.getNodeType(t));let i=null;if(s>1){let a=null;this.getVectorLength()>=s&&(a=t.getTypeFromLength(this.getVectorLength(),this.getComponentType(t)));const u=n.build(t,a);this.components.length===s&&this.components===fP.slice(0,this.components.length)?i=t.format(u,a,e):i=t.format(`${u}.${this.components}`,this.getNodeType(t),e)}else i=n.build(t,e);return i}serialize(t){super.serialize(t),t.components=this.components}deserialize(t){super.deserialize(t),this.components=t.components}}class pP extends is{static get type(){return"SetNode"}constructor(t,e,n){super(),this.sourceNode=t,this.components=e,this.targetNode=n}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{sourceNode:e,components:n,targetNode:s}=this,i=this.getNodeType(t),a=t.getComponentType(s.getNodeType(t)),c=t.getTypeFromLength(n.length,a),u=s.build(t,c),d=e.build(t,i),f=t.getTypeLength(i),p=[];for(let g=0;g<f;g++){const y=Gu[g];y===n[0]?(p.push(u),g+=n.length-1):p.push(d+"."+y)}return`${t.getType(i)}( ${p.join(", ")} )`}}class mP extends is{static get type(){return"FlipNode"}constructor(t,e){super(),this.sourceNode=t,this.components=e}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{components:e,sourceNode:n}=this,s=this.getNodeType(t),i=n.build(t),a=t.getVarFromNode(this),c=t.getPropertyName(a);t.addLineFlowCode(c+" = "+i,this);const u=t.getTypeLength(s),d=[];let f=0;for(let p=0;p<u;p++){const g=Gu[p];g===e[f]?(d.push("1.0 - "+(c+"."+g)),f++):d.push(c+"."+g)}return`${t.getType(s)}( ${d.join(", ")} )`}}class qw extends Zt{static get type(){return"InputNode"}constructor(t,e=null){super(e),this.isInputNode=!0,this.value=t,this.precision=null}getNodeType(){return this.nodeType===null?fc(this.value):this.nodeType}getInputType(t){return this.getNodeType(t)}setPrecision(t){return this.precision=t,this}serialize(t){super.serialize(t),t.value=this.value,this.value&&this.value.toArray&&(t.value=this.value.toArray()),t.valueType=fc(this.value),t.nodeType=this.nodeType,t.valueType==="ArrayBuffer"&&(t.value=aP(t.value)),t.precision=this.precision}deserialize(t){super.deserialize(t),this.nodeType=t.nodeType,this.value=Array.isArray(t.value)?Ww(t.valueType,...t.value):t.value,this.precision=t.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(t.value))}generate(){Wt("Abstract function.")}}const ZN=/float|u?int/;class no extends qw{static get type(){return"ConstNode"}constructor(t,e=null){super(t,e),this.isConstNode=!0}generateConst(t){return t.generateConst(this.getNodeType(t),this.value)}generate(t,e){const n=this.getNodeType(t);return ZN.test(n)&&ZN.test(e)?t.generateConst(e,this.value):t.format(this.generateConst(t),n,e)}}class gP extends Zt{static get type(){return"MemberNode"}constructor(t,e){super(),this.structNode=t,this.property=e,this.isMemberNode=!0}hasMember(t){return this.structNode.isMemberNode&&this.structNode.hasMember(t)===!1?!1:this.structNode.getMemberType(t,this.property)!=="void"}getNodeType(t){return this.hasMember(t)===!1?"float":this.structNode.getMemberType(t,this.property)}getMemberType(t,e){if(this.hasMember(t)===!1)return"float";const n=this.getNodeType(t);return t.getStructTypeNode(n).getMemberType(t,e)}generate(t){if(this.hasMember(t)===!1){Wt(`TSL: Member "${this.property}" does not exist in struct.`,this.stackTrace);const n=this.getNodeType(t);return t.generateConst(n)}return this.structNode.build(t)+"."+this.property}}let Mc=null;const k2=new Map;function Ct(r,t){if(k2.has(r)){Wt(`TSL: Redefinition of method chaining '${r}'.`);return}if(typeof t!="function")throw new Error(`THREE.TSL: Node element ${r} is not a function`);k2.set(r,t),r!=="assign"&&(Zt.prototype[r]=function(...e){return this.isStackNode?this.addToStack(t(...e)):t(this,...e)},Zt.prototype[r+"Assign"]=function(...e){return this.isStackNode?this.assign(e[0],t(...e)):this.assign(t(this,...e))})}const yP=r=>r.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),QN=r=>yP(r).split("").sort().join("");Zt.prototype.assign=function(...r){if(this.isStackNode!==!0)return Mc!==null?Mc.assign(this,...r):Ht("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn().",new ds),this;{const t=k2.get("assign");return this.addToStack(t(...r))}};Zt.prototype.toVarIntent=function(){return this};Zt.prototype.get=function(r){return new gP(this,r)};const Sp={};function Im(r,t,e){Sp[r]=Sp[t]=Sp[e]={get(){this._cache=this._cache||{};let a=this._cache[r];return a===void 0&&(a=new SC(this,r),this._cache[r]=a),a},set(a){this[r].assign(Kt(a))}};const n=r.toUpperCase(),s=t.toUpperCase(),i=e.toUpperCase();Zt.prototype["set"+n]=Zt.prototype["set"+s]=Zt.prototype["set"+i]=function(a){const c=QN(r);return new pP(this,c,Kt(a))},Zt.prototype["flip"+n]=Zt.prototype["flip"+s]=Zt.prototype["flip"+i]=function(){const a=QN(r);return new mP(this,a)}}const zo=["x","y","z","w"],Io=["r","g","b","a"],Vo=["s","t","p","q"];for(let r=0;r<4;r++){let t=zo[r],e=Io[r],n=Vo[r];Im(t,e,n);for(let s=0;s<4;s++){t=zo[r]+zo[s],e=Io[r]+Io[s],n=Vo[r]+Vo[s],Im(t,e,n);for(let i=0;i<4;i++){t=zo[r]+zo[s]+zo[i],e=Io[r]+Io[s]+Io[i],n=Vo[r]+Vo[s]+Vo[i],Im(t,e,n);for(let a=0;a<4;a++)t=zo[r]+zo[s]+zo[i]+zo[a],e=Io[r]+Io[s]+Io[i]+Io[a],n=Vo[r]+Vo[s]+Vo[i]+Vo[a],Im(t,e,n)}}}for(let r=0;r<32;r++)Sp[r]={get(){this._cache=this._cache||{};let t=this._cache[r];return t===void 0&&(t=new ku(this,new no(r,"uint")),this._cache[r]=t),t},set(t){this[r].assign(Kt(t))}};Object.defineProperties(Zt.prototype,Sp);const JN=new WeakMap,xP=function(r,t=null){const e=fc(r);return e==="node"?r:t===null&&(e==="float"||e==="boolean")||e&&e!=="shader"&&e!=="string"?Kt(H2(r,t)):e==="shader"?r.isFn?r:ut(r):r},bP=function(r,t=null){for(const e in r)r[e]=Kt(r[e],t);return r},SP=function(r,t=null){const e=r.length;for(let n=0;n<e;n++)r[n]=Kt(r[n],t);return r},wC=function(r,t=null,e=null,n=null){function s(f){return n!==null?(f=Kt(Object.assign(f,n)),n.intent===!0&&(f=f.toVarIntent())):f=Kt(f),f}let i,a=t,c,u;function d(f){let p;return a?p=/[a-z]/i.test(a)?a+"()":a:p=r.type,c!==void 0&&f.length<c?(Ht(`TSL: "${p}" parameter length is less than minimum required.`,new ds),f.concat(new Array(c-f.length).fill(0))):u!==void 0&&f.length>u?(Ht(`TSL: "${p}" parameter length exceeds limit.`,new ds),f.slice(0,u)):f}return t===null?i=(...f)=>s(new r(...Cu(d(f)))):e!==null?(e=Kt(e),i=(...f)=>s(new r(t,...Cu(d(f)),e))):i=(...f)=>s(new r(t,...Cu(d(f)))),i.setParameterLength=(...f)=>(f.length===1?c=u=f[0]:f.length===2&&([c,u]=f),i),i.setName=f=>(a=f,i),i},wP=function(r,...t){return new r(...Cu(t))};class TP extends Zt{constructor(t,e){super(),this.shaderNode=t,this.rawInputs=e,this.isShaderCallNodeInternal=!0}getNodeType(t){return this.shaderNode.nodeType||this.getOutputNode(t).getNodeType(t)}getElementType(t){return this.getOutputNode(t).getElementType(t)}getMemberType(t,e){return this.getOutputNode(t).getMemberType(t,e)}call(t){const{shaderNode:e,rawInputs:n}=this,s=t.getNodeProperties(e),i=t.getClosestSubBuild(e.subBuilds)||"",a=i||"default";if(s[a])return s[a];const c=t.subBuildFn,u=t.fnCall;t.subBuildFn=i,t.fnCall=this;let d=null;if(e.layout){let f=JN.get(t.constructor);f===void 0&&(f=new WeakMap,JN.set(t.constructor,f));let p=f.get(e);p===void 0&&(p=Kt(t.buildFunctionNode(e)),f.set(e,p)),t.addInclude(p);const g=n?_P(n):null;d=Kt(p.call(g))}else{const f=new Proxy(t,{get:(S,T,M)=>{let N;return Symbol.iterator===T?N=function*(){yield void 0}:N=Reflect.get(S,T,M),N}}),p=n?MP(n):null,g=Array.isArray(n)?n.length>0:n!==null,y=e.jsFunc,x=g||y.length>1?y(p,f):y(f);d=Kt(x)}return t.subBuildFn=c,t.fnCall=u,e.once&&(s[a]=d),d}setupOutput(t){return t.addStack(),t.stack.outputNode=this.call(t),t.removeStack()}getOutputNode(t){const e=t.getNodeProperties(this),n=t.getSubBuildOutput(this);return e[n]=e[n]||this.setupOutput(t),e[n].subBuild=t.getClosestSubBuild(this),e[n]}build(t,e=null){let n=null;const s=t.getBuildStage(),i=t.getNodeProperties(this),a=t.getSubBuildOutput(this),c=this.getOutputNode(t),u=t.fnCall;if(t.fnCall=this,s==="setup"){const d=t.getSubBuildProperty("initialized",this);if(i[d]!==!0&&(i[d]=!0,i[a]=this.getOutputNode(t),i[a].build(t),this.shaderNode.subBuilds))for(const f of t.chaining){const p=t.getDataFromNode(f,"any");p.subBuilds=p.subBuilds||new Set;for(const g of this.shaderNode.subBuilds)p.subBuilds.add(g)}n=i[a]}else s==="analyze"?c.build(t,e):s==="generate"&&(n=c.build(t,e)||"");return t.fnCall=u,n}}function _P(r){let t;return hx(r),r[0]&&(r[0].isNode||Object.getPrototypeOf(r[0])!==Object.prototype)?t=[...r]:t=r[0],t}function MP(r){let t=0;return hx(r),new Proxy(r,{get:(e,n,s)=>{let i;if(n==="length")return i=r.length,i;if(Symbol.iterator===n)i=function*(){for(const a of r)yield Kt(a)};else{if(r.length>0)if(Object.getPrototypeOf(r[0])===Object.prototype){const a=r[0];a[n]===void 0?i=a[t++]:i=Reflect.get(a,n,s)}else r[0]instanceof Zt&&(r[n]===void 0?i=r[t++]:i=Reflect.get(r,n,s));else i=Reflect.get(e,n,s);i=Kt(i)}return i}})}class vP extends Zt{constructor(t,e){super(e),this.jsFunc=t,this.layout=null,this.global=!0,this.once=!1}setLayout(t){return this.layout=t,this}getLayout(){return this.layout}call(t=null){return new TP(this,t)}setup(){return this.call()}}const AP=[!1,!0],NP=[0,1,2,3],RP=[-1,-2],TC=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],$w=new Map;for(const r of AP)$w.set(r,new no(r));const Xw=new Map;for(const r of NP)Xw.set(r,new no(r,"uint"));const jw=new Map([...Xw].map(r=>new no(r.value,"int")));for(const r of RP)jw.set(r,new no(r,"int"));const cx=new Map([...jw].map(r=>new no(r.value)));for(const r of TC)cx.set(r,new no(r));for(const r of TC)cx.set(-r,new no(-r));const ux={bool:$w,uint:Xw,ints:jw,float:cx},tR=new Map([...$w,...cx]),H2=(r,t)=>tR.has(r)?tR.get(r):r.isNode===!0?r:new no(r,t),Es=function(r,t=null){return(...e)=>{for(const s of e)if(s===void 0)return Ht(`TSL: Invalid parameter for the type "${r}".`,new ds),new no(0,r);if((e.length===0||!["bool","float","int","uint"].includes(r)&&e.every(s=>{const i=typeof s;return i!=="object"&&i!=="function"}))&&(e=[Ww(r,...e)]),e.length===1&&t!==null&&t.has(e[0]))return ip(t.get(e[0]));if(e.length===1){const s=H2(e[0],r);return s.nodeType===r?ip(s):ip(new bC(s,r))}const n=e.map(s=>H2(s));return ip(new dP(n,r))}},Up=r=>typeof r=="object"&&r!==null?r.value:r,_C=r=>r!=null?r.nodeType||r.convertTo||(typeof r=="string"?r:null):null;function od(r,t){return new vP(r,t)}const Kt=(r,t=null)=>xP(r,t),ip=(r,t=null)=>Kt(r,t).toVarIntent(),hx=(r,t=null)=>new bP(r,t),Cu=(r,t=null)=>new SP(r,t),xe=(r,t=null,e=null,n=null)=>new wC(r,t,e,n),Xt=(r,...t)=>new wP(r,...t),Gt=(r,t=null,e=null,n={})=>new wC(r,t,e,{...n,intent:!0});let EP=0;class CP extends Zt{constructor(t,e=null){super();let n=null;e!==null&&(typeof e=="object"?n=e.return:(typeof e=="string"?n=e:Ht("TSL: Invalid layout type.",new ds),e=null)),this.shaderNode=new od(t,n),e!==null&&this.setLayout(e),this.isFn=!0}setLayout(t){const e=this.shaderNode.nodeType;if(typeof t.inputs!="object"){const n={name:"fn"+EP++,type:e,inputs:[]};for(const s in t)s!=="return"&&n.inputs.push({name:s,type:t[s]});t=n}return this.shaderNode.setLayout(t),this}getNodeType(t){return this.shaderNode.getNodeType(t)||"float"}call(...t){const e=this.shaderNode.call(t);return this.shaderNode.nodeType==="void"&&e.toStack(),e.toVarIntent()}once(t=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=t,this}generate(t){const e=this.getNodeType(t);return Ht('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".',this.stackTrace),t.generateConst(e)}}function ut(r,t=null){const e=new CP(r,t);return new Proxy(()=>{},{apply(n,s,i){return e.call(...i)},get(n,s,i){return Reflect.get(e,s,i)},set(n,s,i,a){return Reflect.set(e,s,i,a)}})}const Pp=r=>{Mc=r},Yw=()=>Mc,re=(...r)=>Mc.If(...r),BP=(...r)=>Mc.Switch(...r);function dx(r){return Mc&&Mc.addToStack(r),r}Ct("toStack",dx);const MC=new Es("color"),k=new Es("float",ux.float),J=new Es("int",ux.ints),Ut=new Es("uint",ux.uint),Jr=new Es("bool",ux.bool),It=new Es("vec2"),Rs=new Es("ivec2"),Kw=new Es("uvec2"),vC=new Es("bvec2"),it=new Es("vec3"),Zw=new Es("ivec3"),Hu=new Es("uvec3"),Qw=new Es("bvec3"),se=new Es("vec4"),Jw=new Es("ivec4"),tT=new Es("uvec4"),AC=new Es("bvec4"),fx=new Es("mat2"),Ws=new Es("mat3"),Sc=new Es("mat4"),DP=(r="")=>new no(r,"string"),LP=r=>new no(r,"ArrayBuffer");Ct("toColor",MC);Ct("toFloat",k);Ct("toInt",J);Ct("toUint",Ut);Ct("toBool",Jr);Ct("toVec2",It);Ct("toIVec2",Rs);Ct("toUVec2",Kw);Ct("toBVec2",vC);Ct("toVec3",it);Ct("toIVec3",Zw);Ct("toUVec3",Hu);Ct("toBVec3",Qw);Ct("toVec4",se);Ct("toIVec4",Jw);Ct("toUVec4",tT);Ct("toBVec4",AC);Ct("toMat2",fx);Ct("toMat3",Ws);Ct("toMat4",Sc);const NC=xe(ku).setParameterLength(2),RC=(r,t)=>new bC(Kt(r),t),OP=(r,t)=>new SC(Kt(r),t);Ct("element",NC);Ct("convert",RC);const FP=r=>(Wt("TSL: append() has been renamed to Stack().",new ds),dx(r));Ct("append",r=>(Wt("TSL: .append() has been renamed to .toStack().",new ds),dx(r)));class Ke extends Zt{static get type(){return"PropertyNode"}constructor(t,e=null,n=!1){super(t),this.name=e,this.varying=n,this.isPropertyNode=!0,this.global=!0}customCacheKey(){return Bd(this.type+":"+(this.name||"")+":"+(this.varying?"1":"0"))}getHash(t){return this.name||super.getHash(t)}generate(t){let e;return this.varying===!0?(e=t.getVaryingFromNode(this,this.name),e.needsInterpolation=!0):e=t.getVarFromNode(this,this.name),t.getPropertyName(e)}}const il=(r,t)=>new Ke(r,t),zp=(r,t)=>new Ke(r,t,!0),sn=Xt(Ke,"vec4","DiffuseColor"),wu=Xt(Ke,"vec3","DiffuseContribution"),W2=Xt(Ke,"vec3","EmissiveColor"),Xo=Xt(Ke,"float","Roughness"),Ja=Xt(Ke,"float","Metalness"),Cy=Xt(Ke,"float","Clearcoat"),dd=Xt(Ke,"float","ClearcoatRoughness"),yr=Xt(Ke,"vec3","Sheen"),lc=Xt(Ke,"float","SheenRoughness"),px=Xt(Ke,"float","Iridescence"),By=Xt(Ke,"float","IridescenceIOR"),Dy=Xt(Ke,"float","IridescenceThickness"),Ly=Xt(Ke,"float","AlphaT"),oc=Xt(Ke,"float","Anisotropy"),wp=Xt(Ke,"vec3","AnisotropyT"),Bu=Xt(Ke,"vec3","AnisotropyB"),vc=Xt(Ke,"color","SpecularColor"),Au=Xt(Ke,"color","SpecularColorBlended"),Nu=Xt(Ke,"float","SpecularF90"),Oy=Xt(Ke,"float","Shininess"),fd=Xt(Ke,"vec4","Output"),Ug=Xt(Ke,"float","dashSize"),q2=Xt(Ke,"float","gapSize"),UP=Xt(Ke,"float","pointWidth"),Tp=Xt(Ke,"float","IOR"),Fy=Xt(Ke,"float","Transmission"),eT=Xt(Ke,"float","Thickness"),nT=Xt(Ke,"float","AttenuationDistance"),sT=Xt(Ke,"color","AttenuationColor"),iT=Xt(Ke,"float","Dispersion");class EC extends Zt{static get type(){return"UniformGroupNode"}constructor(t,e=!1,n=1){super("string"),this.name=t,this.shared=e,this.order=n,this.isUniformGroup=!0}serialize(t){super.serialize(t),t.name=this.name,t.version=this.version,t.shared=this.shared}deserialize(t){super.deserialize(t),this.name=t.name,this.version=t.version,this.shared=t.shared}}const CC=r=>new EC(r),mx=(r,t=0)=>new EC(r,!0,t),BC=mx("frame"),ee=mx("render"),rT=CC("object");class $p extends qw{static get type(){return"UniformNode"}constructor(t,e=null){super(t,e),this.isUniformNode=!0,this.name="",this.groupNode=rT}setName(t){return this.name=t,this}label(t){return Wt('TSL: "label()" has been deprecated. Use "setName()" instead.',new ds),this.setName(t)}setGroup(t){return this.groupNode=t,this}getGroup(){return this.groupNode}getUniformHash(t){return this.getHash(t)}onUpdate(t,e){return t=t.bind(this),super.onUpdate(n=>{const s=t(n,this);s!==void 0&&(this.value=s)},e)}getInputType(t){let e=super.getInputType(t);return e==="bool"&&(e="uint"),e}generate(t,e){const n=this.getNodeType(t),s=this.getUniformHash(t);let i=t.getNodeFromHash(s);i===void 0&&(t.setHashNode(this,s),i=this);const a=i.getInputType(t),c=t.getUniformFromNode(i,a,t.shaderStage,this.name||t.context.nodeName),u=t.getPropertyName(c);t.context.nodeName!==void 0&&delete t.context.nodeName;let d=u;if(n==="bool"){const f=t.getDataFromNode(this);let p=f.propertyName;if(p===void 0){const g=t.getVarFromNode(this,null,"bool");p=t.getPropertyName(g),f.propertyName=p,d=t.format(u,a,n),t.addLineFlowCode(`${p} = ${d}`,this)}d=p}return t.format(d,n,e)}}const Jt=(r,t)=>{const e=_C(t||r);if(e===r&&(r=Ww(e)),r&&r.isNode===!0){let n=r.value;r.traverse(s=>{s.isConstNode===!0&&(n=s.value)}),r=n}return new $p(r,e)};class eR extends is{static get type(){return"ArrayNode"}constructor(t,e,n=null){super(t),this.count=e,this.values=n,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(t){return this.nodeType===null?this.values[0].getNodeType(t):this.nodeType}getElementType(t){return this.getNodeType(t)}getMemberType(t,e){return this.nodeType===null?this.values[0].getMemberType(t,e):super.getMemberType(t,e)}generate(t){const e=this.getNodeType(t);return t.generateArray(e,this.count,this.values)}}const DC=(...r)=>{let t;if(r.length===1){const e=r[0];t=new eR(null,e.length,e)}else{const e=r[0],n=r[1];t=new eR(e,n)}return Kt(t)};Ct("toArray",(r,t)=>DC(Array(t).fill(r)));class PP extends is{static get type(){return"AssignNode"}constructor(t,e){super(),this.targetNode=t,this.sourceNode=e,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(t,e){return e!=="void"?this.targetNode.getNodeType(t):"void"}needsSplitAssign(t){const{targetNode:e}=this;if(t.isAvailable("swizzleAssign")===!1&&e.isSplitNode&&e.components.length>1){const n=t.getTypeLength(e.node.getNodeType(t));return Gu.join("").slice(0,n)!==e.components}return!1}setup(t){const{targetNode:e,sourceNode:n}=this,s=e.getScope(),i=t.getDataFromNode(s);i.assign=!0;const a=t.getNodeProperties(this);a.sourceNode=n,a.targetNode=e.context({assign:!0})}generate(t,e){const{targetNode:n,sourceNode:s}=t.getNodeProperties(this),i=this.needsSplitAssign(t),a=n.build(t),c=n.getNodeType(t),u=s.build(t,c),d=s.getNodeType(t),f=t.getDataFromNode(this);let p;if(f.initialized===!0)e!=="void"&&(p=a);else if(i){const g=t.getVarFromNode(this,null,c),y=t.getPropertyName(g);t.addLineFlowCode(`${y} = ${u}`,this);const x=n.node,T=x.node.context({assign:!0}).build(t);for(let M=0;M<x.components.length;M++){const N=x.components[M];t.addLineFlowCode(`${T}.${N} = ${y}[ ${M} ]`,this)}e!=="void"&&(p=a)}else p=`${a} = ${u}`,(e==="void"||d==="void")&&(t.addLineFlowCode(p,this),e!=="void"&&(p=a));return f.initialized=!0,t.format(p,c,e)}}const LC=xe(PP).setParameterLength(2);Ct("assign",LC);class zP extends is{static get type(){return"FunctionCallNode"}constructor(t=null,e={}){super(),this.functionNode=t,this.parameters=e}setParameters(t){return this.parameters=t,this}getParameters(){return this.parameters}getNodeType(t){return this.functionNode.getNodeType(t)}getMemberType(t,e){return this.functionNode.getMemberType(t,e)}generate(t){const e=[],n=this.functionNode,s=n.getInputs(t),i=this.parameters,a=(u,d)=>{const f=d.type,p=f==="pointer";let g;return p?g="&"+u.build(t):g=u.build(t,f),g};if(Array.isArray(i)){if(i.length>s.length)Ht("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),i.length=s.length;else if(i.length<s.length)for(Ht("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");i.length<s.length;)i.push(k(0));for(let u=0;u<i.length;u++)e.push(a(i[u],s[u]))}else for(const u of s){const d=i[u.name];d!==void 0?e.push(a(d,u)):(Ht(`TSL: Input '${u.name}' not found in 'Fn()'.`),e.push(a(k(0),u)))}return`${n.build(t,"property")}( ${e.join(", ")} )`}}const OC=(r,...t)=>(t=t.length>1||t[0]&&t[0].isNode===!0?Cu(t):hx(t[0]),new zP(Kt(r),t));Ct("call",OC);const IP={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class Wn extends is{static get type(){return"OperatorNode"}constructor(t,e,n,...s){if(super(),s.length>0){let i=new Wn(t,e,n);for(let a=0;a<s.length-1;a++)i=new Wn(t,i,s[a]);e=i,n=s[s.length-1]}this.op=t,this.aNode=e,this.bNode=n,this.isOperatorNode=!0}getOperatorMethod(t,e){return t.getMethod(IP[this.op],e)}getNodeType(t,e=null){const n=this.op,s=this.aNode,i=this.bNode,a=s.getNodeType(t),c=i?i.getNodeType(t):null;if(a==="void"||c==="void")return e||"void";if(n==="%")return a;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return t.getIntegerType(a);if(n==="!"||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">="){const u=Math.max(t.getTypeLength(a),t.getTypeLength(c));return u>1?`bvec${u}`:"bool"}else{if(t.isMatrix(a)){if(c==="float")return a;if(t.isVector(c))return t.getVectorFromMatrix(a);if(t.isMatrix(c))return a}else if(t.isMatrix(c)){if(a==="float")return c;if(t.isVector(a))return t.getVectorFromMatrix(c)}return t.getTypeLength(c)>t.getTypeLength(a)?c:a}}generate(t,e){const n=this.op,{aNode:s,bNode:i}=this,a=this.getNodeType(t,e);let c=null,u=null;a!=="void"?(c=s.getNodeType(t),u=i?i.getNodeType(t):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?t.isVector(c)?u=c:t.isVector(u)?c=u:c!==u&&(c=u="float"):n===">>"||n==="<<"?(c=a,u=t.changeComponentType(u,"uint")):n==="%"?(c=a,u=t.isInteger(c)&&t.isInteger(u)?u:c):t.isMatrix(c)?u==="float"?u="float":t.isVector(u)?u=t.getVectorFromMatrix(c):t.isMatrix(u)||(c=u=a):t.isMatrix(u)?c==="float"?c="float":t.isVector(c)?c=t.getVectorFromMatrix(u):c=u=a:c=u=a):c=u=a;const d=s.build(t,c),f=i?i.build(t,u):null,p=t.getFunctionOperator(n);if(e!=="void"){const g=t.renderer.coordinateSystem===wr;if(n==="=="||n==="!="||n==="<"||n===">"||n==="<="||n===">=")return g?t.isVector(c)?t.format(`${this.getOperatorMethod(t,e)}( ${d}, ${f} )`,a,e):t.format(`( ${d} ${n} ${f} )`,a,e):t.format(`( ${d} ${n} ${f} )`,a,e);if(n==="%")return t.isInteger(u)?t.format(`( ${d} % ${f} )`,a,e):t.format(`${this.getOperatorMethod(t,a)}( ${d}, ${f} )`,a,e);if(n==="!"||n==="~")return t.format(`(${n}${d})`,c,e);if(p)return t.format(`${p}( ${d}, ${f} )`,a,e);if(t.isMatrix(c)&&u==="float")return t.format(`( ${f} ${n} ${d} )`,a,e);if(c==="float"&&t.isMatrix(u))return t.format(`${d} ${n} ${f}`,a,e);{let y=`( ${d} ${n} ${f} )`;return!g&&a==="bool"&&t.isVector(c)&&t.isVector(u)&&(y=`all${y}`),t.format(y,a,e)}}else if(c!=="void")return p?t.format(`${p}( ${d}, ${f} )`,a,e):t.isMatrix(c)&&u==="float"?t.format(`${f} ${n} ${d}`,a,e):t.format(`${d} ${n} ${f}`,a,e)}serialize(t){super.serialize(t),t.op=this.op}deserialize(t){super.deserialize(t),this.op=t.op}}const xs=Gt(Wn,"+").setParameterLength(2,1/0).setName("add"),De=Gt(Wn,"-").setParameterLength(2,1/0).setName("sub"),fe=Gt(Wn,"*").setParameterLength(2,1/0).setName("mul"),vr=Gt(Wn,"/").setParameterLength(2,1/0).setName("div"),Xp=Gt(Wn,"%").setParameterLength(2).setName("mod"),FC=Gt(Wn,"==").setParameterLength(2).setName("equal"),UC=Gt(Wn,"!=").setParameterLength(2).setName("notEqual"),PC=Gt(Wn,"<").setParameterLength(2).setName("lessThan"),oT=Gt(Wn,">").setParameterLength(2).setName("greaterThan"),zC=Gt(Wn,"<=").setParameterLength(2).setName("lessThanEqual"),IC=Gt(Wn,">=").setParameterLength(2).setName("greaterThanEqual"),VC=Gt(Wn,"&&").setParameterLength(2,1/0).setName("and"),GC=Gt(Wn,"||").setParameterLength(2,1/0).setName("or"),kC=Gt(Wn,"!").setParameterLength(1).setName("not"),HC=Gt(Wn,"^^").setParameterLength(2).setName("xor"),WC=Gt(Wn,"&").setParameterLength(2).setName("bitAnd"),qC=Gt(Wn,"~").setParameterLength(1).setName("bitNot"),$C=Gt(Wn,"|").setParameterLength(2).setName("bitOr"),XC=Gt(Wn,"^").setParameterLength(2).setName("bitXor"),jC=Gt(Wn,"<<").setParameterLength(2).setName("shiftLeft"),YC=Gt(Wn,">>").setParameterLength(2).setName("shiftRight"),KC=ut(([r])=>(r.addAssign(1),r)),ZC=ut(([r])=>(r.subAssign(1),r)),QC=ut(([r])=>{const t=J(r).toConst();return r.addAssign(1),t}),JC=ut(([r])=>{const t=J(r).toConst();return r.subAssign(1),t});Ct("add",xs);Ct("sub",De);Ct("mul",fe);Ct("div",vr);Ct("mod",Xp);Ct("equal",FC);Ct("notEqual",UC);Ct("lessThan",PC);Ct("greaterThan",oT);Ct("lessThanEqual",zC);Ct("greaterThanEqual",IC);Ct("and",VC);Ct("or",GC);Ct("not",kC);Ct("xor",HC);Ct("bitAnd",WC);Ct("bitNot",qC);Ct("bitOr",$C);Ct("bitXor",XC);Ct("shiftLeft",jC);Ct("shiftRight",YC);Ct("incrementBefore",KC);Ct("decrementBefore",ZC);Ct("increment",QC);Ct("decrement",JC);const t5=(r,t)=>(Wt('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.',new ds),Xp(J(r),J(t)));Ct("modInt",t5);class St extends is{static get type(){return"MathNode"}constructor(t,e,n=null,s=null){if(super(),(t===St.MAX||t===St.MIN)&&arguments.length>3){let i=new St(t,e,n);for(let a=2;a<arguments.length-1;a++)i=new St(t,i,arguments[a]);e=i,n=arguments[arguments.length-1],s=null}this.method=t,this.aNode=e,this.bNode=n,this.cNode=s,this.isMathNode=!0}getInputType(t){const e=this.aNode.getNodeType(t),n=this.bNode?this.bNode.getNodeType(t):null,s=this.cNode?this.cNode.getNodeType(t):null,i=t.isMatrix(e)?0:t.getTypeLength(e),a=t.isMatrix(n)?0:t.getTypeLength(n),c=t.isMatrix(s)?0:t.getTypeLength(s);return i>a&&i>c?e:a>c?n:c>i?s:e}getNodeType(t){const e=this.method;return e===St.LENGTH||e===St.DISTANCE||e===St.DOT?"float":e===St.CROSS?"vec3":e===St.ALL||e===St.ANY?"bool":e===St.EQUALS?t.changeComponentType(this.aNode.getNodeType(t),"bool"):this.getInputType(t)}setup(t){const{aNode:e,bNode:n,method:s}=this;let i=null;if(s===St.ONE_MINUS)i=De(1,e);else if(s===St.RECIPROCAL)i=vr(1,e);else if(s===St.DIFFERENCE)i=xn(De(e,n));else if(s===St.TRANSFORM_DIRECTION){let a=e,c=n;t.isMatrix(a.getNodeType(t))?c=se(it(c),0):a=se(it(a),0);const u=fe(a,c).xyz;i=Qi(u)}return i!==null?i:super.setup(t)}generate(t,e){if(t.getNodeProperties(this).outputNode)return super.generate(t,e);let s=this.method;const i=this.getNodeType(t),a=this.getInputType(t),c=this.aNode,u=this.bNode,d=this.cNode,f=t.renderer.coordinateSystem;if(s===St.NEGATE)return t.format("( - "+c.build(t,a)+" )",i,e);{const p=[];return s===St.CROSS?p.push(c.build(t,i),u.build(t,i)):f===wr&&s===St.STEP?p.push(c.build(t,t.getTypeLength(c.getNodeType(t))===1?"float":a),u.build(t,a)):f===wr&&(s===St.MIN||s===St.MAX)?p.push(c.build(t,a),u.build(t,t.getTypeLength(u.getNodeType(t))===1?"float":a)):s===St.REFRACT?p.push(c.build(t,a),u.build(t,a),d.build(t,"float")):s===St.MIX?p.push(c.build(t,a),u.build(t,a),d.build(t,t.getTypeLength(d.getNodeType(t))===1?"float":a)):(f===Zr&&s===St.ATAN&&u!==null&&(s="atan2"),t.shaderStage!=="fragment"&&(s===St.DFDX||s===St.DFDY)&&(Wt(`TSL: '${s}' is not supported in the ${t.shaderStage} stage.`,this.stackTrace),s="/*"+s+"*/"),p.push(c.build(t,a)),u!==null&&p.push(u.build(t,a)),d!==null&&p.push(d.build(t,a))),t.format(`${t.getMethod(s,i)}( ${p.join(", ")} )`,i,e)}}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}St.ALL="all";St.ANY="any";St.RADIANS="radians";St.DEGREES="degrees";St.EXP="exp";St.EXP2="exp2";St.LOG="log";St.LOG2="log2";St.SQRT="sqrt";St.INVERSE_SQRT="inversesqrt";St.FLOOR="floor";St.CEIL="ceil";St.NORMALIZE="normalize";St.FRACT="fract";St.SIN="sin";St.COS="cos";St.TAN="tan";St.ASIN="asin";St.ACOS="acos";St.ATAN="atan";St.ABS="abs";St.SIGN="sign";St.LENGTH="length";St.NEGATE="negate";St.ONE_MINUS="oneMinus";St.DFDX="dFdx";St.DFDY="dFdy";St.ROUND="round";St.RECIPROCAL="reciprocal";St.TRUNC="trunc";St.FWIDTH="fwidth";St.TRANSPOSE="transpose";St.DETERMINANT="determinant";St.INVERSE="inverse";St.EQUALS="equals";St.MIN="min";St.MAX="max";St.STEP="step";St.REFLECT="reflect";St.DISTANCE="distance";St.DIFFERENCE="difference";St.DOT="dot";St.CROSS="cross";St.POW="pow";St.TRANSFORM_DIRECTION="transformDirection";St.MIX="mix";St.CLAMP="clamp";St.REFRACT="refract";St.SMOOTHSTEP="smoothstep";St.FACEFORWARD="faceforward";const aT=k(1e-6),VP=k(1e6),Uy=k(Math.PI),GP=k(Math.PI*2),kP=k(Math.PI*2),HP=k(Math.PI*.5),e5=Gt(St,St.ALL).setParameterLength(1),n5=Gt(St,St.ANY).setParameterLength(1),s5=Gt(St,St.RADIANS).setParameterLength(1),i5=Gt(St,St.DEGREES).setParameterLength(1),lT=Gt(St,St.EXP).setParameterLength(1),Md=Gt(St,St.EXP2).setParameterLength(1),gx=Gt(St,St.LOG).setParameterLength(1),ea=Gt(St,St.LOG2).setParameterLength(1),Di=Gt(St,St.SQRT).setParameterLength(1),cT=Gt(St,St.INVERSE_SQRT).setParameterLength(1),na=Gt(St,St.FLOOR).setParameterLength(1),yx=Gt(St,St.CEIL).setParameterLength(1),Qi=Gt(St,St.NORMALIZE).setParameterLength(1),vo=Gt(St,St.FRACT).setParameterLength(1),Ni=Gt(St,St.SIN).setParameterLength(1),bo=Gt(St,St.COS).setParameterLength(1),r5=Gt(St,St.TAN).setParameterLength(1),o5=Gt(St,St.ASIN).setParameterLength(1),uT=Gt(St,St.ACOS).setParameterLength(1),hT=Gt(St,St.ATAN).setParameterLength(1,2),xn=Gt(St,St.ABS).setParameterLength(1),dT=Gt(St,St.SIGN).setParameterLength(1),sa=Gt(St,St.LENGTH).setParameterLength(1),fT=Gt(St,St.NEGATE).setParameterLength(1),a5=Gt(St,St.ONE_MINUS).setParameterLength(1),pT=Gt(St,St.DFDX).setParameterLength(1),mT=Gt(St,St.DFDY).setParameterLength(1),l5=Gt(St,St.ROUND).setParameterLength(1),c5=Gt(St,St.RECIPROCAL).setParameterLength(1),gT=Gt(St,St.TRUNC).setParameterLength(1),yT=Gt(St,St.FWIDTH).setParameterLength(1),u5=Gt(St,St.TRANSPOSE).setParameterLength(1),h5=Gt(St,St.DETERMINANT).setParameterLength(1),d5=Gt(St,St.INVERSE).setParameterLength(1),er=Gt(St,St.MIN).setParameterLength(2,1/0),qn=Gt(St,St.MAX).setParameterLength(2,1/0),vd=Gt(St,St.STEP).setParameterLength(2),f5=Gt(St,St.REFLECT).setParameterLength(2),p5=Gt(St,St.DISTANCE).setParameterLength(2),m5=Gt(St,St.DIFFERENCE).setParameterLength(2),to=Gt(St,St.DOT).setParameterLength(2),ol=Gt(St,St.CROSS).setParameterLength(2),$r=Gt(St,St.POW).setParameterLength(2),xT=r=>fe(r,r),g5=r=>fe(r,r,r),bT=r=>fe(r,r,r,r),y5=Gt(St,St.TRANSFORM_DIRECTION).setParameterLength(2),x5=r=>fe(dT(r),$r(xn(r),1/3)),ST=r=>to(r,r),Ce=Gt(St,St.MIX).setParameterLength(3),Ao=(r,t=0,e=1)=>new St(St.CLAMP,Kt(r),Kt(t),Kt(e)),xx=r=>Ao(r),wT=Gt(St,St.REFRACT).setParameterLength(3),No=Gt(St,St.SMOOTHSTEP).setParameterLength(3),TT=Gt(St,St.FACEFORWARD).setParameterLength(3),b5=ut(([r])=>{const n=43758.5453,s=to(r.xy,It(12.9898,78.233)),i=Xp(s,Uy);return vo(Ni(i).mul(n))}),S5=(r,t,e)=>Ce(t,e,r),w5=(r,t,e)=>No(t,e,r),T5=(r,t)=>vd(t,r),WP=TT,qP=cT;Ct("all",e5);Ct("any",n5);Ct("radians",s5);Ct("degrees",i5);Ct("exp",lT);Ct("exp2",Md);Ct("log",gx);Ct("log2",ea);Ct("sqrt",Di);Ct("inverseSqrt",cT);Ct("floor",na);Ct("ceil",yx);Ct("normalize",Qi);Ct("fract",vo);Ct("sin",Ni);Ct("cos",bo);Ct("tan",r5);Ct("asin",o5);Ct("acos",uT);Ct("atan",hT);Ct("abs",xn);Ct("sign",dT);Ct("length",sa);Ct("lengthSq",ST);Ct("negate",fT);Ct("oneMinus",a5);Ct("dFdx",pT);Ct("dFdy",mT);Ct("round",l5);Ct("reciprocal",c5);Ct("trunc",gT);Ct("fwidth",yT);Ct("min",er);Ct("max",qn);Ct("step",T5);Ct("reflect",f5);Ct("distance",p5);Ct("dot",to);Ct("cross",ol);Ct("pow",$r);Ct("pow2",xT);Ct("pow3",g5);Ct("pow4",bT);Ct("transformDirection",y5);Ct("mix",S5);Ct("clamp",Ao);Ct("refract",wT);Ct("smoothstep",w5);Ct("faceForward",TT);Ct("difference",m5);Ct("saturate",xx);Ct("cbrt",x5);Ct("transpose",u5);Ct("determinant",h5);Ct("inverse",d5);Ct("rand",b5);class $P extends Zt{static get type(){return"ConditionalNode"}constructor(t,e,n=null){super(),this.condNode=t,this.ifNode=e,this.elseNode=n}getNodeType(t){const{ifNode:e,elseNode:n}=t.getNodeProperties(this);if(e===void 0)return t.flowBuildStage(this,"setup"),this.getNodeType(t);const s=e.getNodeType(t);if(n!==null){const i=n.getNodeType(t);if(t.getTypeLength(i)>t.getTypeLength(s))return i}return s}setup(t){const e=this.condNode,n=this.ifNode.isolate(),s=this.elseNode?this.elseNode.isolate():null,i=t.context.nodeBlock;t.getDataFromNode(n).parentNodeBlock=i,s!==null&&(t.getDataFromNode(s).parentNodeBlock=i);const a=t.context.uniformFlow,c=t.getNodeProperties(this);c.condNode=e,c.ifNode=a?n:n.context({nodeBlock:n}),c.elseNode=s?a?s:s.context({nodeBlock:s}):null}generate(t,e){const n=this.getNodeType(t),s=t.getDataFromNode(this);if(s.nodeProperty!==void 0)return s.nodeProperty;const{condNode:i,ifNode:a,elseNode:c}=t.getNodeProperties(this),u=t.currentFunctionNode,d=e!=="void",f=d?il(n).build(t):"";s.nodeProperty=f;const p=i.build(t,"bool");if(t.context.uniformFlow&&c!==null){const x=a.build(t,n),S=c.build(t,n),T=t.getTernary(p,x,S);return t.format(T,n,e)}t.addFlowCode(`
${t.tab}if ( ${p} ) {

`).addFlowTab();let y=a.build(t,n);if(y&&(d?y=f+" = "+y+";":(y="return "+y+";",u===null&&(Wt("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values.",this.stackTrace),y="// "+y))),t.removeFlowTab().addFlowCode(t.tab+"	"+y+`

`+t.tab+"}"),c!==null){t.addFlowCode(` else {

`).addFlowTab();let x=c.build(t,n);x&&(d?x=f+" = "+x+";":(x="return "+x+";",u===null&&(Wt("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values.",this.stackTrace),x="// "+x))),t.removeFlowTab().addFlowCode(t.tab+"	"+x+`

`+t.tab+`}

`)}else t.addFlowCode(`

`);return t.format(f,n,e)}}const yi=xe($P).setParameterLength(2,3);Ct("select",yi);class _5 extends Zt{static get type(){return"ContextNode"}constructor(t=null,e={}){super(),this.isContextNode=!0,this.node=t,this.value=e}getScope(){return this.node.getScope()}getNodeType(t){return this.node.getNodeType(t)}getFlowContextData(){const t=[];return this.traverse(e=>{e.isContextNode===!0&&t.push(e.value)}),Object.assign({},...t)}getMemberType(t,e){return this.node.getMemberType(t,e)}analyze(t){const e=t.addContext(this.value);this.node.build(t),t.setContext(e)}setup(t){const e=t.addContext(this.value);this.node.build(t),t.setContext(e)}generate(t,e){const n=t.addContext(this.value),s=this.node.build(t,e);return t.setContext(n),s}}const ul=(r=null,t={})=>{let e=r;return(e===null||e.isNode!==!0)&&(t=e||t,e=null),new _5(e,t)},M5=r=>ul(r,{uniformFlow:!0}),_T=(r,t)=>ul(r,{nodeName:t});function v5(r,t,e=null){return ul(e,{getShadow:({light:n,shadowColorNode:s})=>t===n?s.mul(r):s})}function A5(r,t=null){return ul(t,{getAO:(e,{material:n})=>n.transparent===!0?e:e!==null?e.mul(r):r})}function N5(r,t){return Wt('TSL: "label()" has been deprecated. Use "setName()" instead.'),_T(r,t)}Ct("context",ul);Ct("label",N5);Ct("uniformFlow",M5);Ct("setName",_T);Ct("builtinShadowContext",(r,t,e)=>v5(t,e,r));Ct("builtinAOContext",(r,t)=>A5(t,r));class Pg extends Zt{static get type(){return"VarNode"}constructor(t,e=null,n=!1){super(),this.node=t,this.name=e,this.global=!0,this.isVarNode=!0,this.readOnly=n,this.parents=!0,this.intent=!1}setIntent(t){return this.intent=t,this}isIntent(t){return t.getDataFromNode(this).forceDeclaration===!0?!1:this.intent}getIntent(){return this.intent}getMemberType(t,e){return this.node.getMemberType(t,e)}getElementType(t){return this.node.getElementType(t)}getNodeType(t){return this.node.getNodeType(t)}getArrayCount(t){return this.node.getArrayCount(t)}isAssign(t){return t.getDataFromNode(this).assign}build(...t){const e=t[0];if(this._hasStack(e)===!1&&e.buildStage==="setup"&&(e.context.nodeLoop||e.context.nodeBlock)){let n=!1;if(this.node.isShaderCallNodeInternal&&this.node.shaderNode.getLayout()===null&&e.fnCall&&e.fnCall.shaderNode&&e.getDataFromNode(this.node.shaderNode).hasLoop){const a=e.getDataFromNode(this);a.forceDeclaration=!0,n=!0}const s=e.getBaseStack();n?s.addToStackBefore(this):s.addToStack(this)}return this.isIntent(e)&&this.isAssign(e)!==!0?this.node.build(...t):super.build(...t)}generate(t){const{node:e,name:n,readOnly:s}=this,{renderer:i}=t,a=i.backend.isWebGPUBackend===!0;let c=!1,u=!1;s&&(c=t.isDeterministic(e),u=a?s:c);const d=this.getNodeType(t);if(d=="void")return this.isIntent(t)!==!0&&Ht('TSL: ".toVar()" can not be used with void type.',this.stackTrace),e.build(t);const f=t.getVectorType(d),p=e.build(t,f),g=t.getVarFromNode(this,n,f,void 0,u),y=t.getPropertyName(g);let x=y;if(u)if(a)x=c?`const ${y}`:`let ${y}`;else{const S=e.getArrayCount(t);x=`const ${t.getVar(g.type,y,S)}`}return t.addLineFlowCode(`${x} = ${p}`,this),y}_hasStack(t){return t.getDataFromNode(this).stack!==void 0}}const MT=xe(Pg),R5=(r,t=null)=>MT(r,t).toStack(),E5=(r,t=null)=>MT(r,t,!0).toStack(),C5=r=>MT(r).setIntent(!0).toStack();Ct("toVar",R5);Ct("toConst",E5);Ct("toVarIntent",C5);class XP extends Zt{static get type(){return"SubBuild"}constructor(t,e,n=null){super(n),this.node=t,this.name=e,this.isSubBuildNode=!0}getNodeType(t){if(this.nodeType!==null)return this.nodeType;t.addSubBuild(this.name);const e=this.node.getNodeType(t);return t.removeSubBuild(),e}build(t,...e){t.addSubBuild(this.name);const n=this.node.build(t,...e);return t.removeSubBuild(),n}}const Du=(r,t,e=null)=>new XP(Kt(r),t,e);class jP extends Zt{static get type(){return"VaryingNode"}constructor(t,e=null){super(),this.node=Du(t,"VERTEX"),this.name=e,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(t,e=null){return this.interpolationType=t,this.interpolationSampling=e,this}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}setupVarying(t){const e=t.getNodeProperties(this);let n=e.varying;if(n===void 0){const s=this.name,i=this.getNodeType(t),a=this.interpolationType,c=this.interpolationSampling;e.varying=n=t.getVaryingFromNode(this,s,i,a,c),e.node=Du(this.node,"VERTEX")}return n.needsInterpolation||(n.needsInterpolation=t.shaderStage==="fragment"),n}setup(t){this.setupVarying(t),t.flowNodeFromShaderStage(sp.VERTEX,this.node)}analyze(t){this.setupVarying(t),t.flowNodeFromShaderStage(sp.VERTEX,this.node)}generate(t){const e=t.getSubBuildProperty("property",t.currentStack),n=t.getNodeProperties(this),s=this.setupVarying(t);if(n[e]===void 0){const i=this.getNodeType(t),a=t.getPropertyName(s,sp.VERTEX);t.flowNodeFromShaderStage(sp.VERTEX,n.node,i,a),n[e]=a}return t.getPropertyName(s)}}const Cc=xe(jP).setParameterLength(1,2),B5=r=>Cc(r);Ct("toVarying",Cc);Ct("toVertexStage",B5);const D5=ut(([r])=>{const t=r.mul(.9478672986).add(.0521327014).pow(2.4),e=r.mul(.0773993808),n=r.lessThanEqual(.04045);return Ce(t,e,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),L5=ut(([r])=>{const t=r.pow(.41666).mul(1.055).sub(.055),e=r.mul(12.92),n=r.lessThanEqual(.0031308);return Ce(t,e,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),vT="WorkingColorSpace",YP="OutputColorSpace";class AT extends is{static get type(){return"ColorSpaceNode"}constructor(t,e,n){super("vec4"),this.colorNode=t,this.source=e,this.target=n}resolveColorSpace(t,e){return e===vT?qe.workingColorSpace:e===YP?t.context.outputColorSpace||t.renderer.outputColorSpace:e}setup(t){const{colorNode:e}=this,n=this.resolveColorSpace(t,this.source),s=this.resolveColorSpace(t,this.target);let i=e;return qe.enabled===!1||n===s||!n||!s||(qe.getTransfer(n)===ye&&(i=se(D5(i.rgb),i.a)),qe.getPrimaries(n)!==qe.getPrimaries(s)&&(i=se(Ws(qe._getMatrix(new sr,n,s)).mul(i.rgb),i.a)),qe.getTransfer(s)===ye&&(i=se(L5(i.rgb),i.a))),i}}const O5=(r,t)=>new AT(Kt(r),vT,t),bx=(r,t)=>new AT(Kt(r),t,vT),KP=(r,t,e)=>new AT(Kt(r),t,e);Ct("workingToColorSpace",O5);Ct("colorSpaceToWorking",bx);let ZP=class extends ku{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),n=this.referenceNode.getNodeType(),s=this.getNodeType();return t.format(e,n,s)}};class F5 extends Zt{static get type(){return"ReferenceBaseNode"}constructor(t,e,n=null,s=null){super(),this.property=t,this.uniformType=e,this.object=n,this.count=s,this.properties=t.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=de.OBJECT}setGroup(t){return this.group=t,this}element(t){return new ZP(this,Kt(t))}setNodeType(t){const e=Jt(null,t);this.group!==null&&e.setGroup(this.group),this.node=e}getNodeType(t){return this.node===null&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let n=t[e[0]];for(let s=1;s<e.length;s++)n=n[e[s]];return n}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const QP=(r,t,e)=>new F5(r,t,e);class JP extends F5{static get type(){return"RendererReferenceNode"}constructor(t,e,n=null){super(t,e,n),this.renderer=n,this.setGroup(ee)}updateReference(t){return this.reference=this.renderer!==null?this.renderer:t.renderer,this.reference}}const U5=(r,t,e=null)=>new JP(r,t,e);class tz extends is{static get type(){return"ToneMappingNode"}constructor(t,e=z5,n=null){super("vec3"),this._toneMapping=t,this.exposureNode=e,this.colorNode=n}customCacheKey(){return bp(this._toneMapping)}setToneMapping(t){return this._toneMapping=t,this}getToneMapping(){return this._toneMapping}setup(t){const e=this.colorNode||t.context.color,n=this._toneMapping;if(n===_u)return e;let s=null;const i=t.renderer.library.getToneMappingFunction(n);return i!==null?s=se(i(e.rgb,this.exposureNode),e.a):(Ht("ToneMappingNode: Unsupported Tone Mapping configuration.",n),s=e),s}}const P5=(r,t,e)=>new tz(r,Kt(t),Kt(e)),z5=U5("toneMappingExposure","float");Ct("toneMapping",(r,t,e)=>P5(t,e,r));const nR=new WeakMap;function sR(r,t){let e=nR.get(r);return e===void 0&&(e=new eC(r,t),nR.set(r,e)),e}class Wl extends qw{static get type(){return"BufferAttributeNode"}constructor(t,e=null,n=0,s=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferStride=n,this.bufferOffset=s,this.usage=wd,this.instanced=!1,this.attribute=null,this.global=!0,t&&t.isBufferAttribute===!0&&t.itemSize<=4&&(this.attribute=t,this.usage=t.usage,this.instanced=t.isInstancedBufferAttribute)}getHash(t){if(this.bufferStride===0&&this.bufferOffset===0){let e=t.globalCache.getData(this.value);return e===void 0&&(e={node:this},t.globalCache.setData(this.value,e)),e.node.uuid}return this.uuid}getNodeType(t){return this.bufferType===null&&(this.bufferType=t.getTypeFromAttribute(this.attribute)),this.bufferType}setup(t){if(this.attribute!==null)return;const e=this.getNodeType(t),n=t.getTypeLength(e),s=this.value,i=this.bufferStride||n,a=this.bufferOffset;let c;s.isInterleavedBuffer===!0?c=s:s.isBufferAttribute===!0?c=sR(s.array,i):c=sR(s,i);const u=new Cw(c,n,a);c.setUsage(this.usage),this.attribute=u,this.attribute.isInstancedBufferAttribute=this.instanced}generate(t){const e=this.getNodeType(t),n=t.getBufferAttributeFromNode(this,e),s=t.getPropertyName(n);let i=null;return t.shaderStage==="vertex"||t.shaderStage==="compute"?(this.name=s,i=s):i=Cc(this).build(t,e),i}getInputType(){return"bufferAttribute"}setUsage(t){return this.usage=t,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=t),this}setInstanced(t){return this.instanced=t,this}}function Sx(r,t=null,e=0,n=0,s=wd,i=!1){return t==="mat3"||t===null&&r.itemSize===9?Ws(new Wl(r,"vec3",9,0).setUsage(s).setInstanced(i),new Wl(r,"vec3",9,3).setUsage(s).setInstanced(i),new Wl(r,"vec3",9,6).setUsage(s).setInstanced(i)):t==="mat4"||t===null&&r.itemSize===16?Sc(new Wl(r,"vec4",16,0).setUsage(s).setInstanced(i),new Wl(r,"vec4",16,4).setUsage(s).setInstanced(i),new Wl(r,"vec4",16,8).setUsage(s).setInstanced(i),new Wl(r,"vec4",16,12).setUsage(s).setInstanced(i)):new Wl(r,t,e,n).setUsage(s)}const NT=(r,t=null,e=0,n=0)=>Sx(r,t,e,n),ez=(r,t=null,e=0,n=0)=>Sx(r,t,e,n,Dp),Py=(r,t=null,e=0,n=0)=>Sx(r,t,e,n,wd,!0),$2=(r,t=null,e=0,n=0)=>Sx(r,t,e,n,Dp,!0);Ct("toAttribute",r=>NT(r.value));class nz extends Zt{static get type(){return"ComputeNode"}constructor(t,e){super("void"),this.isComputeNode=!0,this.computeNode=t,this.workgroupSize=e,this.count=null,this.version=1,this.name="",this.updateBeforeType=de.OBJECT,this.onInitFunction=null}setCount(t){return this.count=t,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(t){return this.name=t,this}label(t){return Wt('TSL: "label()" has been deprecated. Use "setName()" instead.',new ds),this.setName(t)}onInit(t){return this.onInitFunction=t,this}updateBefore({renderer:t}){t.compute(this)}setup(t){const e=this.computeNode.build(t);if(e){const n=t.getNodeProperties(this);n.outputComputeNode=e.outputNode,e.outputNode=null}return e}generate(t,e){const{shaderStage:n}=t;if(n==="compute"){const s=this.computeNode.build(t,"void");s!==""&&t.addLineFlowCode(s,this)}else{const i=t.getNodeProperties(this).outputComputeNode;if(i)return i.build(t,e)}}}const RT=(r,t=[64])=>{(t.length===0||t.length>3)&&Ht("TSL: compute() workgroupSize must have 1, 2, or 3 elements",new ds);for(let e=0;e<t.length;e++){const n=t[e];(typeof n!="number"||n<=0||!Number.isInteger(n))&&Ht(`TSL: compute() workgroupSize element at index [ ${e} ] must be a positive integer`,new ds)}for(;t.length<3;)t.push(1);return new nz(Kt(r),t)},I5=(r,t,e)=>RT(r,e).setCount(t);Ct("compute",I5);Ct("computeKernel",RT);class sz extends Zt{static get type(){return"IsolateNode"}constructor(t,e=!0){super(),this.node=t,this.parent=e,this.isIsolateNode=!0}getNodeType(t){const e=t.getCache(),n=t.getCacheFromNode(this,this.parent);t.setCache(n);const s=this.node.getNodeType(t);return t.setCache(e),s}build(t,...e){const n=t.getCache(),s=t.getCacheFromNode(this,this.parent);t.setCache(s);const i=this.node.build(t,...e);return t.setCache(n),i}setParent(t){return this.parent=t,this}getParent(){return this.parent}}const pd=r=>new sz(Kt(r));function V5(r,t=!0){return Wt('TSL: "cache()" has been deprecated. Use "isolate()" instead.'),pd(r).setParent(t)}Ct("cache",V5);Ct("isolate",pd);class iz extends Zt{static get type(){return"BypassNode"}constructor(t,e){super(),this.isBypassNode=!0,this.outputNode=t,this.callNode=e}getNodeType(t){return this.outputNode.getNodeType(t)}generate(t){const e=this.callNode.build(t,"void");return e!==""&&t.addLineFlowCode(e,this),this.outputNode.build(t)}}const G5=xe(iz).setParameterLength(2);Ct("bypass",G5);class k5 extends Zt{static get type(){return"RemapNode"}constructor(t,e,n,s=k(0),i=k(1)){super(),this.node=t,this.inLowNode=e,this.inHighNode=n,this.outLowNode=s,this.outHighNode=i,this.doClamp=!0}setup(){const{node:t,inLowNode:e,inHighNode:n,outLowNode:s,outHighNode:i,doClamp:a}=this;let c=t.sub(e).div(n.sub(e));return a===!0&&(c=c.clamp()),c.mul(i.sub(s)).add(s)}}const H5=xe(k5,null,null,{doClamp:!1}).setParameterLength(3,5),W5=xe(k5).setParameterLength(3,5);Ct("remap",H5);Ct("remapClamp",W5);class zg extends Zt{static get type(){return"ExpressionNode"}constructor(t="",e="void"){super(e),this.snippet=t}generate(t,e){const n=this.getNodeType(t),s=this.snippet;if(n==="void")t.addLineFlowCode(s,this);else return t.format(s,n,e)}}const _o=xe(zg).setParameterLength(1,2),q5=r=>(r?yi(r,_o("discard")):_o("discard")).toStack(),rz=()=>_o("return").toStack();Ct("discard",q5);class oz extends is{static get type(){return"RenderOutputNode"}constructor(t,e,n){super("vec4"),this.colorNode=t,this._toneMapping=e,this.outputColorSpace=n,this.isRenderOutputNode=!0}setToneMapping(t){return this._toneMapping=t,this}getToneMapping(){return this._toneMapping}setup({context:t}){let e=this.colorNode||t.color;const n=(this._toneMapping!==null?this._toneMapping:t.toneMapping)||_u,s=(this.outputColorSpace!==null?this.outputColorSpace:t.outputColorSpace)||_c;return n!==_u&&(e=e.toneMapping(n)),s!==_c&&s!==qe.workingColorSpace&&(e=e.workingToColorSpace(s)),e}}const $5=(r,t=null,e=null)=>new oz(Kt(r),t,e);Ct("renderOutput",$5);class az extends is{static get type(){return"DebugNode"}constructor(t,e=null){super(),this.node=t,this.callback=e}getNodeType(t){return this.node.getNodeType(t)}setup(t){return this.node.build(t)}analyze(t){return this.node.build(t)}generate(t){const e=this.callback,n=this.node.build(t);if(e!==null)e(t,n);else{const s="--- TSL debug - "+t.shaderStage+" shader ---",i="-".repeat(s.length);let a="";a+="// #"+s+`#
`,a+=t.flow.code.replace(/^\t/mg,"")+`
`,a+="/* ... */ "+n+` /* ... */
`,a+="// #"+i+`#
`,F2(a)}return n}}const X5=(r,t=null)=>new az(Kt(r),t).toStack();Ct("debug",X5);class j5{constructor(){this._renderer=null,this.currentFrame=null}get nodeFrame(){return this._renderer._nodes.nodeFrame}setRenderer(t){return this._renderer=t,this}getRenderer(){return this._renderer}init(){}begin(){}finish(){}inspect(){}computeAsync(){}beginCompute(){}finishCompute(){}beginRender(){}finishRender(){}copyTextureToTexture(){}copyFramebufferToTexture(){}}class lz extends Zt{static get type(){return"InspectorNode"}constructor(t,e="",n=null){super(),this.node=t,this.name=e,this.callback=n,this.updateType=de.FRAME,this.isInspectorNode=!0}getName(){return this.name||this.node.name}update(t){t.renderer.inspector.inspect(this)}getNodeType(t){return this.node.getNodeType(t)}setup(t){let e=this.node;return t.context.inspector===!0&&this.callback!==null&&(e=this.callback(e)),t.renderer.backend.isWebGPUBackend!==!0&&t.renderer.inspector.constructor!==j5&&rn('TSL: ".toInspector()" is only available with WebGPU.'),e}}function Y5(r,t="",e=null){return r=Kt(r),r.before(new lz(r,t,e))}Ct("toInspector",Y5);function cz(r){Wt("TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",r)}class K5 extends Zt{static get type(){return"AttributeNode"}constructor(t,e=null){super(e),this.global=!0,this._attributeName=t}getHash(t){return this.getAttributeName(t)}getNodeType(t){let e=this.nodeType;if(e===null){const n=this.getAttributeName(t);if(t.hasGeometryAttribute(n)){const s=t.geometry.getAttribute(n);e=t.getTypeFromAttribute(s)}else e="float"}return e}setAttributeName(t){return this._attributeName=t,this}getAttributeName(){return this._attributeName}generate(t){const e=this.getAttributeName(t),n=this.getNodeType(t);if(t.hasGeometryAttribute(e)===!0){const i=t.geometry.getAttribute(e),a=t.getTypeFromAttribute(i),c=t.getAttribute(e,a);return t.shaderStage==="vertex"?t.format(c.name,a,n):Cc(this).build(t,n)}else return Wt(`AttributeNode: Vertex attribute "${e}" not found on geometry.`),t.generateConst(n)}serialize(t){super.serialize(t),t.global=this.global,t._attributeName=this._attributeName}deserialize(t){super.deserialize(t),this.global=t.global,this._attributeName=t._attributeName}}const al=(r,t=null)=>new K5(r,t),cn=(r=0)=>al("uv"+(r>0?r:""),"vec2");class uz extends Zt{static get type(){return"TextureSizeNode"}constructor(t,e=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=t,this.levelNode=e}generate(t,e){const n=this.textureNode.build(t,"property"),s=this.levelNode===null?"0":this.levelNode.build(t,"int");return t.format(`${t.getMethod("textureDimensions")}( ${n}, ${s} )`,this.getNodeType(t),e)}}const wc=xe(uz).setParameterLength(1,2);class hz extends $p{static get type(){return"MaxMipLevelNode"}constructor(t){super(0),this._textureNode=t,this.updateType=de.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const t=this.texture,e=t.images,n=e&&e.length>0?e[0]&&e[0].image||e[0]:t.image;if(n&&n.width!==void 0){const{width:s,height:i}=n;this.value=Math.log2(Math.max(s,i))}}}const ET=xe(hz).setParameterLength(1);class Z5 extends Error{constructor(t,e=null){super(t),this.name="NodeError",this.stackTrace=e}}const CT=new ns;class ca extends $p{static get type(){return"TextureNode"}constructor(t=CT,e=null,n=null,s=null){super(t),this.isTextureNode=!0,this.uvNode=e,this.levelNode=n,this.biasNode=s,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=de.NONE,this.referenceNode=null,this._value=t,this._matrixUniform=null,this._flipYUniform=null,this.setUpdateMatrix(e===null)}set value(t){this.referenceNode?this.referenceNode.value=t:this._value=t}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Qn?"uvec4":this.value.type===di?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return cn(this.value.channel)}updateReference(){return this.value}getTransformedUV(t){return this._matrixUniform===null&&(this._matrixUniform=Jt(this.value.matrix)),this._matrixUniform.mul(it(t,1)).xy}setUpdateMatrix(t){return this.updateMatrix=t,this}setupUV(t,e){return t.isFlipY()&&(this._flipYUniform===null&&(this._flipYUniform=Jt(!1)),e=e.toVar(),this.sampler?e=this._flipYUniform.select(e.flipY(),e):e=this._flipYUniform.select(e.setY(J(wc(this,this.levelNode).y).sub(e.y).sub(1)),e)),e}setup(t){const e=t.getNodeProperties(this);e.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Z5("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().",this.stackTrace);const s=ut(()=>{let u=this.uvNode;return(u===null||t.context.forceUVContext===!0)&&t.context.getUV&&(u=t.context.getUV(this,t)),u||(u=this.getDefaultUV()),this.updateMatrix===!0&&(u=this.getTransformedUV(u)),u=this.setupUV(t,u),this.updateType=this._matrixUniform!==null||this._flipYUniform!==null?de.OBJECT:de.NONE,u})();let i=this.levelNode;i===null&&t.context.getTextureLevel&&(i=t.context.getTextureLevel(this));let a=null,c=null;this.compareNode!==null&&(t.renderer.hasCompatibility(xc.TEXTURE_COMPARE)?a=this.compareNode:this.value.compareFunction===null||this.value.compareFunction===Aw?c=this.compareNode:(a=this.compareNode,rn('TSL: Only "LessCompare" is supported for depth texture comparison fallback.'))),e.uvNode=s,e.levelNode=i,e.biasNode=this.biasNode,e.compareNode=a,e.compareStepNode=c,e.gradNode=this.gradNode,e.depthNode=this.depthNode,e.offsetNode=this.offsetNode}generateUV(t,e){return e.build(t,this.sampler===!0?"vec2":"ivec2")}generateOffset(t,e){return e.build(t,"ivec2")}generateSnippet(t,e,n,s,i,a,c,u,d){const f=this.value;let p;return i?p=t.generateTextureBias(f,e,n,i,a,d):u?p=t.generateTextureGrad(f,e,n,u,a,d):c?p=t.generateTextureCompare(f,e,n,c,a,d):this.sampler===!1?p=t.generateTextureLoad(f,e,n,s,a,d):s?p=t.generateTextureLevel(f,e,n,s,a,d):p=t.generateTexture(f,e,n,a,d),p}generate(t,e){const n=this.value,s=t.getNodeProperties(this),i=super.generate(t,"property");if(/^sampler/.test(e))return i+"_sampler";if(t.isReference(e))return i;{const a=t.getDataFromNode(this),c=this.getNodeType(t);let u=a.propertyName;if(u===void 0){const{uvNode:f,levelNode:p,biasNode:g,compareNode:y,compareStepNode:x,depthNode:S,gradNode:T,offsetNode:M}=s,N=this.generateUV(t,f),v=p?p.build(t,"float"):null,A=g?g.build(t,"float"):null,R=S?S.build(t,"int"):null,F=y?y.build(t,"float"):null,D=x?x.build(t,"float"):null,O=T?[T[0].build(t,"vec2"),T[1].build(t,"vec2")]:null,B=M?this.generateOffset(t,M):null,z=t.getVarFromNode(this);u=t.getPropertyName(z);let tt=this.generateSnippet(t,i,N,v,A,R,F,O,B);D!==null&&(tt=vd(_o(D,"float"),_o(tt,c)).build(t,c)),t.addLineFlowCode(`${u} = ${tt}`,this),a.snippet=tt,a.propertyName=u}let d=u;return t.needsToWorkingColorSpace(n)&&(d=bx(_o(d,c),n.colorSpace).setup(t).build(t,c)),t.format(d,c,e)}}setSampler(t){return this.sampler=t,this}getSampler(){return this.sampler}sample(t){const e=this.clone();return e.uvNode=Kt(t),e.referenceNode=this.getBase(),Kt(e)}load(t){return this.sample(t).setSampler(!1)}blur(t){const e=this.clone();e.biasNode=Kt(t).mul(ET(e)),e.referenceNode=this.getBase();const n=e.value;return e.generateMipmaps===!1&&(n&&n.generateMipmaps===!1||n.minFilter===ts||n.magFilter===ts)&&(Wt("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),e.biasNode=null),Kt(e)}level(t){const e=this.clone();return e.levelNode=Kt(t),e.referenceNode=this.getBase(),Kt(e)}size(t){return wc(this,t)}bias(t){const e=this.clone();return e.biasNode=Kt(t),e.referenceNode=this.getBase(),Kt(e)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(t){const e=this.clone();return e.compareNode=Kt(t),e.referenceNode=this.getBase(),Kt(e)}grad(t,e){const n=this.clone();return n.gradNode=[Kt(t),Kt(e)],n.referenceNode=this.getBase(),Kt(n)}depth(t){const e=this.clone();return e.depthNode=Kt(t),e.referenceNode=this.getBase(),Kt(e)}offset(t){const e=this.clone();return e.offsetNode=Kt(t),e.referenceNode=this.getBase(),Kt(e)}serialize(t){super.serialize(t),t.value=this.value.toJSON(t.meta).uuid,t.sampler=this.sampler,t.updateMatrix=this.updateMatrix,t.updateType=this.updateType}deserialize(t){super.deserialize(t),this.value=t.meta.textures[t.value],this.sampler=t.sampler,this.updateMatrix=t.updateMatrix,this.updateType=t.updateType}update(){const t=this.value,e=this._matrixUniform;e!==null&&(e.value=t.matrix),t.matrixAutoUpdate===!0&&t.updateMatrix();const n=this._flipYUniform;n!==null&&(n.value=t.image instanceof ImageBitmap&&t.flipY===!0||t.isRenderTargetTexture===!0||t.isFramebufferTexture===!0||t.isDepthTexture===!0)}clone(){const t=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return t.sampler=this.sampler,t.depthNode=this.depthNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.offsetNode=this.offsetNode,t}}const dz=xe(ca).setParameterLength(1,4).setName("texture"),He=(r=CT,t=null,e=null,n=null)=>{let s;return r&&r.isTextureNode===!0?(s=Kt(r.clone()),s.referenceNode=r.getBase(),t!==null&&(s.uvNode=Kt(t)),e!==null&&(s.levelNode=Kt(e)),n!==null&&(s.biasNode=Kt(n))):s=dz(r,t,e,n),s},fz=(r=CT)=>He(r),Zn=(...r)=>He(...r).setSampler(!1),pz=(r,t,e)=>He(r,t).level(e),mz=r=>(r.isNode===!0?r:He(r)).convert("sampler"),gz=r=>(r.isNode===!0?r:He(r)).convert("samplerComparison");class BT extends $p{static get type(){return"BufferNode"}constructor(t,e,n=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferCount=n,this.updateRanges=[]}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}getElementType(t){return this.getNodeType(t)}getInputType(){return"buffer"}}const jp=(r,t,e)=>new BT(r,t,e);class yz extends ku{static get type(){return"UniformArrayElementNode"}constructor(t,e){super(t,e),this.isArrayBufferElementNode=!0}generate(t){const e=super.generate(t),n=this.getNodeType(),s=this.node.getPaddedType();return t.format(e,s,n)}}class xz extends BT{static get type(){return"UniformArrayNode"}constructor(t,e=null){super(null),this.array=t,this.elementType=e===null?fc(t[0]):e,this.paddedType=this.getPaddedType(),this.updateType=de.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const t=this.elementType;let e="vec4";return t==="mat2"?e="mat2":/mat/.test(t)===!0?e="mat4":t.charAt(0)==="i"?e="ivec4":t.charAt(0)==="u"&&(e="uvec4"),e}update(){const{array:t,value:e}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let s=0;s<t.length;s++){const i=s*4;e[i]=t[s]}else if(n==="color")for(let s=0;s<t.length;s++){const i=s*4,a=t[s];e[i]=a.r,e[i+1]=a.g,e[i+2]=a.b||0}else if(n==="mat2")for(let s=0;s<t.length;s++){const i=s*4,a=t[s];e[i]=a.elements[0],e[i+1]=a.elements[1],e[i+2]=a.elements[2],e[i+3]=a.elements[3]}else if(n==="mat3")for(let s=0;s<t.length;s++){const i=s*16,a=t[s];e[i]=a.elements[0],e[i+1]=a.elements[1],e[i+2]=a.elements[2],e[i+4]=a.elements[3],e[i+5]=a.elements[4],e[i+6]=a.elements[5],e[i+8]=a.elements[6],e[i+9]=a.elements[7],e[i+10]=a.elements[8],e[i+15]=1}else if(n==="mat4")for(let s=0;s<t.length;s++){const i=s*16,a=t[s];for(let c=0;c<a.elements.length;c++)e[i+c]=a.elements[c]}else for(let s=0;s<t.length;s++){const i=s*4,a=t[s];e[i]=a.x,e[i+1]=a.y,e[i+2]=a.z||0,e[i+3]=a.w||0}}setup(t){const e=this.array.length,n=this.elementType;let s=Float32Array;const i=this.paddedType,a=t.getTypeLength(i);return n.charAt(0)==="i"&&(s=Int32Array),n.charAt(0)==="u"&&(s=Uint32Array),this.value=new s(e*a),this.bufferCount=e,this.bufferType=i,this.update(),super.setup(t)}element(t){return new yz(this,Kt(t))}}const mi=(r,t)=>new xz(r,t);class bz extends Zt{constructor(t){super("float"),this.name=t,this.isBuiltinNode=!0}generate(){return this.name}}const hl=xe(bz).setParameterLength(1);let Of,Ff;class Mn extends Zt{static get type(){return"ScreenNode"}constructor(t){super(),this.scope=t,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===Mn.DPR?"float":this.scope===Mn.VIEWPORT?"vec4":"vec2"}getUpdateType(){let t=de.NONE;return(this.scope===Mn.SIZE||this.scope===Mn.VIEWPORT||this.scope===Mn.DPR)&&(t=de.RENDER),this.updateType=t,t}update({renderer:t}){const e=t.getRenderTarget();this.scope===Mn.VIEWPORT?e!==null?Ff.copy(e.viewport):(t.getViewport(Ff),Ff.multiplyScalar(t.getPixelRatio())):this.scope===Mn.DPR?this._output.value=t.getPixelRatio():e!==null?(Of.width=e.width,Of.height=e.height):t.getDrawingBufferSize(Of)}setup(){const t=this.scope;let e=null;return t===Mn.SIZE?e=Jt(Of||(Of=new Ot)):t===Mn.VIEWPORT?e=Jt(Ff||(Ff=new je)):t===Mn.DPR?e=Jt(1):e=It(Wu.div(Uu)),this._output=e,e}generate(t){if(this.scope===Mn.COORDINATE){let e=t.getFragCoord();if(t.isFlipY()){const n=t.getNodeProperties(Uu).outputNode.build(t);e=`${t.getType("vec2")}( ${e}.x, ${n}.y - ${e}.y )`}return e}return super.generate(t)}}Mn.COORDINATE="coordinate";Mn.VIEWPORT="viewport";Mn.SIZE="size";Mn.UV="uv";Mn.DPR="dpr";const Q5=Xt(Mn,Mn.DPR),ia=Xt(Mn,Mn.UV),Uu=Xt(Mn,Mn.SIZE),Wu=Xt(Mn,Mn.COORDINATE),DT=Xt(Mn,Mn.VIEWPORT),LT=DT.zw,J5=Wu.sub(DT.xy),Sz=J5.div(LT),wz=ut(()=>(Wt('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.',new ds),Uu),"vec2").once()();let RS=null,Vm=null,ES=null,Gm=null,CS=null,km=null,BS=null,Hm=null,DS=null,Wm=null,LS=null,qm=null,OS=null,$m=null;const Bc=Jt(0,"uint").setName("u_cameraIndex").setGroup(mx("cameraIndex")).toVarying("v_cameraIndex"),cc=Jt("float").setName("cameraNear").setGroup(ee).onRenderUpdate(({camera:r})=>r.near),uc=Jt("float").setName("cameraFar").setGroup(ee).onRenderUpdate(({camera:r})=>r.far),rl=ut(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const n of r.cameras)e.push(n.projectionMatrix);Vm===null?Vm=mi(e).setGroup(ee).setName("cameraProjectionMatrices"):Vm.array=e,t=Vm.element(r.isMultiViewCamera?hl("gl_ViewID_OVR"):Bc).toConst("cameraProjectionMatrix")}else RS===null&&(RS=Jt(r.projectionMatrix).setName("cameraProjectionMatrix").setGroup(ee).onRenderUpdate(({camera:e})=>e.projectionMatrix)),t=RS;return t}).once()(),t4=ut(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const n of r.cameras)e.push(n.projectionMatrixInverse);Gm===null?Gm=mi(e).setGroup(ee).setName("cameraProjectionMatricesInverse"):Gm.array=e,t=Gm.element(r.isMultiViewCamera?hl("gl_ViewID_OVR"):Bc).toConst("cameraProjectionMatrixInverse")}else ES===null&&(ES=Jt(r.projectionMatrixInverse).setName("cameraProjectionMatrixInverse").setGroup(ee).onRenderUpdate(({camera:e})=>e.projectionMatrixInverse)),t=ES;return t}).once()(),so=ut(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const n of r.cameras)e.push(n.matrixWorldInverse);km===null?km=mi(e).setGroup(ee).setName("cameraViewMatrices"):km.array=e,t=km.element(r.isMultiViewCamera?hl("gl_ViewID_OVR"):Bc).toConst("cameraViewMatrix")}else CS===null&&(CS=Jt(r.matrixWorldInverse).setName("cameraViewMatrix").setGroup(ee).onRenderUpdate(({camera:e})=>e.matrixWorldInverse)),t=CS;return t}).once()(),Tz=ut(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const n of r.cameras)e.push(n.matrixWorld);Hm===null?Hm=mi(e).setGroup(ee).setName("cameraWorldMatrices"):Hm.array=e,t=Hm.element(r.isMultiViewCamera?hl("gl_ViewID_OVR"):Bc).toConst("cameraWorldMatrix")}else BS===null&&(BS=Jt(r.matrixWorld).setName("cameraWorldMatrix").setGroup(ee).onRenderUpdate(({camera:e})=>e.matrixWorld)),t=BS;return t}).once()(),_z=ut(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const n of r.cameras)e.push(n.normalMatrix);Wm===null?Wm=mi(e).setGroup(ee).setName("cameraNormalMatrices"):Wm.array=e,t=Wm.element(r.isMultiViewCamera?hl("gl_ViewID_OVR"):Bc).toConst("cameraNormalMatrix")}else DS===null&&(DS=Jt(r.normalMatrix).setName("cameraNormalMatrix").setGroup(ee).onRenderUpdate(({camera:e})=>e.normalMatrix)),t=DS;return t}).once()(),e4=ut(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(let n=0,s=r.cameras.length;n<s;n++)e.push(new G);qm===null?qm=mi(e).setGroup(ee).setName("cameraPositions").onRenderUpdate(({camera:n},s)=>{const i=n.cameras,a=s.array;for(let c=0,u=i.length;c<u;c++)a[c].setFromMatrixPosition(i[c].matrixWorld)}):qm.array=e,t=qm.element(r.isMultiViewCamera?hl("gl_ViewID_OVR"):Bc).toConst("cameraPosition")}else LS===null&&(LS=Jt(new G).setName("cameraPosition").setGroup(ee).onRenderUpdate(({camera:e},n)=>n.value.setFromMatrixPosition(e.matrixWorld))),t=LS;return t}).once()(),Mz=ut(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const n of r.cameras)e.push(n.viewport);$m===null?$m=mi(e,"vec4").setGroup(ee).setName("cameraViewports"):$m.array=e,t=$m.element(Bc).toConst("cameraViewport")}else OS===null&&(OS=se(0,0,Uu.x,Uu.y).toConst("cameraViewport")),t=OS;return t}).once()(),iR=new Ec;class Be extends Zt{static get type(){return"Object3DNode"}constructor(t,e=null){super(),this.scope=t,this.object3d=e,this.updateType=de.OBJECT,this.uniformNode=new $p(null)}getNodeType(){const t=this.scope;if(t===Be.WORLD_MATRIX)return"mat4";if(t===Be.POSITION||t===Be.VIEW_POSITION||t===Be.DIRECTION||t===Be.SCALE)return"vec3";if(t===Be.RADIUS)return"float"}update(t){const e=this.object3d,n=this.uniformNode,s=this.scope;if(s===Be.WORLD_MATRIX)n.value=e.matrixWorld;else if(s===Be.POSITION)n.value=n.value||new G,n.value.setFromMatrixPosition(e.matrixWorld);else if(s===Be.SCALE)n.value=n.value||new G,n.value.setFromMatrixScale(e.matrixWorld);else if(s===Be.DIRECTION)n.value=n.value||new G,e.getWorldDirection(n.value);else if(s===Be.VIEW_POSITION){const i=t.camera;n.value=n.value||new G,n.value.setFromMatrixPosition(e.matrixWorld),n.value.applyMatrix4(i.matrixWorldInverse)}else if(s===Be.RADIUS){const i=t.object.geometry;i.boundingSphere===null&&i.computeBoundingSphere(),iR.copy(i.boundingSphere).applyMatrix4(e.matrixWorld),n.value=iR.radius}}generate(t){const e=this.scope;return e===Be.WORLD_MATRIX?this.uniformNode.nodeType="mat4":e===Be.POSITION||e===Be.VIEW_POSITION||e===Be.DIRECTION||e===Be.SCALE?this.uniformNode.nodeType="vec3":e===Be.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(t)}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}Be.WORLD_MATRIX="worldMatrix";Be.POSITION="position";Be.SCALE="scale";Be.VIEW_POSITION="viewPosition";Be.DIRECTION="direction";Be.RADIUS="radius";const vz=xe(Be,Be.DIRECTION).setParameterLength(1),Az=xe(Be,Be.WORLD_MATRIX).setParameterLength(1),Nz=xe(Be,Be.POSITION).setParameterLength(1),Rz=xe(Be,Be.SCALE).setParameterLength(1),Ez=xe(Be,Be.VIEW_POSITION).setParameterLength(1),Cz=xe(Be,Be.RADIUS).setParameterLength(1);class eo extends Be{static get type(){return"ModelNode"}constructor(t){super(t)}update(t){this.object3d=t.object,super.update(t)}}const Bz=Xt(eo,eo.DIRECTION),Xr=Xt(eo,eo.WORLD_MATRIX),Dz=Xt(eo,eo.POSITION),Lz=Xt(eo,eo.SCALE),Oz=Xt(eo,eo.VIEW_POSITION),Fz=Xt(eo,eo.RADIUS),n4=Jt(new sr).onObjectUpdate(({object:r},t)=>t.value.getNormalMatrix(r.matrixWorld)),Uz=Jt(new Te).onObjectUpdate(({object:r},t)=>t.value.copy(r.matrixWorld).invert()),Dc=ut(r=>r.context.modelViewMatrix||s4).once()().toVar("modelViewMatrix"),s4=so.mul(Xr),X2=ut(r=>(r.context.isHighPrecisionModelViewMatrix=!0,Jt("mat4").onObjectUpdate(({object:t,camera:e})=>t.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld)))).once()().toVar("highpModelViewMatrix"),j2=ut(r=>{const t=r.context.isHighPrecisionModelViewMatrix;return Jt("mat3").onObjectUpdate(({object:e,camera:n})=>(t!==!0&&e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),i4=ut(r=>r.shaderStage!=="fragment"?(rn("TSL: `clipSpace` is only available in fragment stage."),se()):r.context.clipSpace.toVarying("v_clipSpace")).once()(),Yp=al("position","vec3"),kn=Yp.toVarying("positionLocal"),Ad=Yp.toVarying("positionPrevious"),ra=ut(r=>Xr.mul(kn).xyz.toVarying(r.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),OT=ut(()=>kn.transformDirection(Xr).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),cs=ut(r=>{if(r.shaderStage==="fragment"&&r.material.vertexNode){const t=t4.mul(i4);return t.xyz.div(t.w).toVar("positionView")}return r.context.setupPositionView().toVarying("v_positionView")},"vec3").once(["POSITION","VERTEX"])(),dn=ut(r=>{let t;return r.camera.isOrthographicCamera?t=it(0,0,1):t=cs.negate().toVarying("v_positionViewDirection").normalize(),t.toVar("positionViewDirection")},"vec3").once(["POSITION"])();class Pz extends Zt{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(t){if(t.shaderStage!=="fragment")return"true";const{material:e}=t;return e.side===us?"false":t.getFrontFacing()}}const r4=Xt(Pz),FT=k(r4).mul(2).sub(1),Dd=ut(([r],{material:t})=>{const e=t.side;return e===us?r=r.mul(-1):e===En&&(r=r.mul(FT)),r}),wx=al("normal","vec3"),nr=ut(r=>r.geometry.hasAttribute("normal")===!1?(Wt('TSL: Vertex attribute "normal" not found on geometry.'),it(0,1,0)):wx,"vec3").once()().toVar("normalLocal"),o4=cs.dFdx().cross(cs.dFdy()).normalize().toVar("normalFlat"),Nd=ut(r=>{let t;return r.isFlatShading()?t=o4:t=UT(nr).toVarying("v_normalViewGeometry").normalize(),t},"vec3").once()().toVar("normalViewGeometry"),a4=ut(r=>{let t=Nd.transformDirection(so);return r.isFlatShading()!==!0&&(t=t.toVarying("v_normalWorldGeometry")),t.normalize().toVar("normalWorldGeometry")},"vec3").once()(),Ie=ut(r=>{let t;return r.subBuildFn==="NORMAL"||r.subBuildFn==="VERTEX"?(t=Nd,r.isFlatShading()!==!0&&(t=Dd(t))):t=r.context.setupNormal().context({getUV:null,getTextureLevel:null}),t},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),Lc=Ie.transformDirection(so).toVar("normalWorld"),hc=ut(({subBuildFn:r,context:t})=>{let e;return r==="NORMAL"||r==="VERTEX"?e=Ie:e=t.setupClearcoatNormal().context({getUV:null,getTextureLevel:null}),e},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),l4=ut(([r,t=Xr])=>{const e=Ws(t),n=r.div(it(e[0].dot(e[0]),e[1].dot(e[1]),e[2].dot(e[2])));return e.mul(n).xyz}),UT=ut(([r],t)=>{const e=t.context.modelNormalViewMatrix;if(e)return e.transformDirection(r);const n=n4.mul(r);return so.transformDirection(n)}),zz=ut(()=>(Wt('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),Ie)).once(["NORMAL","VERTEX"])(),Iz=ut(()=>(Wt('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),Lc)).once(["NORMAL","VERTEX"])(),Vz=ut(()=>(Wt('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),hc)).once(["NORMAL","VERTEX"])(),rR=new Ji,FS=new Te,c4=Jt(0).onReference(({material:r})=>r).onObjectUpdate(({material:r})=>r.refractionRatio),Ig=Jt(1).onReference(({material:r})=>r).onObjectUpdate(function({material:r,scene:t}){return r.envMap?r.envMapIntensity:t.environmentIntensity}),PT=Jt(new Te).onReference(function(r){return r.material}).onObjectUpdate(function({material:r,scene:t}){const e=t.environment!==null&&r.envMap===null?t.environmentRotation:r.envMapRotation;return e?(rR.copy(e),FS.makeRotationFromEuler(rR)):FS.identity(),FS}),u4=dn.negate().reflect(Ie),h4=dn.negate().refract(Ie,c4),d4=u4.transformDirection(so).toVar("reflectVector"),f4=h4.transformDirection(so).toVar("reflectVector"),p4=new rx;class Gz extends ca{static get type(){return"CubeTextureNode"}constructor(t,e=null,n=null,s=null){super(t,e,n,s),this.isCubeTextureNode=!0}getInputType(){return this.value.isDepthTexture===!0?"cubeDepthTexture":"cubeTexture"}getDefaultUV(){const t=this.value;return t.mapping===bd?d4:t.mapping===Qg?f4:(Ht('CubeTextureNode: Mapping "%s" not supported.',t.mapping),it(0,0,0))}setUpdateMatrix(){}setupUV(t,e){const n=this.value;return n.isDepthTexture===!0?t.renderer.coordinateSystem===Zr?it(e.x,e.y.negate(),e.z):e:((t.renderer.coordinateSystem===Zr||!n.isRenderTargetTexture)&&(e=it(e.x.negate(),e.yz)),PT.mul(e))}generateUV(t,e){return e.build(t,this.sampler===!0?"vec3":"ivec3")}}const zT=xe(Gz).setParameterLength(1,4).setName("cubeTexture"),Ci=(r=p4,t=null,e=null,n=null)=>{let s;return r&&r.isCubeTextureNode===!0?(s=Kt(r.clone()),s.referenceNode=r,t!==null&&(s.uvNode=Kt(t)),e!==null&&(s.levelNode=Kt(e)),n!==null&&(s.biasNode=Kt(n))):s=zT(r,t,e,n),s},kz=(r=p4)=>zT(r);class Hz extends ku{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),n=this.referenceNode.getNodeType(),s=this.getNodeType();return t.format(e,n,s)}}class Tx extends Zt{static get type(){return"ReferenceNode"}constructor(t,e,n=null,s=null){super(),this.property=t,this.uniformType=e,this.object=n,this.count=s,this.properties=t.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=de.OBJECT}element(t){return new Hz(this,Kt(t))}setGroup(t){return this.group=t,this}setName(t){return this.name=t,this}label(t){return Wt('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(t)}setNodeType(t){let e=null;this.count!==null?e=jp(null,t,this.count):Array.isArray(this.getValueFromReference())?e=mi(null,t):t==="texture"?e=He(null):t==="cubeTexture"?e=Ci(null):e=Jt(null,t),this.group!==null&&e.setGroup(this.group),this.name!==null&&e.setName(this.name),this.node=e}getNodeType(t){return this.node===null&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let n=t[e[0]];for(let s=1;s<e.length;s++)n=n[e[s]];return n}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const Nn=(r,t,e)=>new Tx(r,t,e),Y2=(r,t,e,n)=>new Tx(r,t,n,e);class Wz extends Tx{static get type(){return"MaterialReferenceNode"}constructor(t,e,n=null){super(t,e,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(t){return this.reference=this.material!==null?this.material:t.material,this.reference}}const Ka=(r,t,e=null)=>new Wz(r,t,e),m4=cn(),qz=cs.dFdx(),$z=cs.dFdy(),g4=m4.dFdx(),y4=m4.dFdy(),x4=Ie,b4=$z.cross(x4),S4=x4.cross(qz),K2=b4.mul(g4.x).add(S4.mul(y4.x)),Z2=b4.mul(g4.y).add(S4.mul(y4.y)),oR=K2.dot(K2).max(Z2.dot(Z2)),w4=oR.equal(0).select(0,oR.inverseSqrt()),Xz=K2.mul(w4).toVar("tangentViewFrame"),jz=Z2.mul(w4).toVar("bitangentViewFrame"),_x=al("tangent","vec4"),Rd=_x.xyz.toVar("tangentLocal"),Mx=ut(r=>{let t;return r.subBuildFn==="VERTEX"||r.geometry.hasAttribute("tangent")?t=Dc.mul(se(Rd,0)).xyz.toVarying("v_tangentView").normalize():t=Xz,r.isFlatShading()!==!0&&(t=Dd(t)),t},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),T4=Mx.transformDirection(so).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),vx=ut(([r,t],e)=>{let n=r.mul(_x.w).xyz;return e.subBuildFn==="NORMAL"&&e.isFlatShading()!==!0&&(n=n.toVarying(t)),n}).once(["NORMAL"]),Yz=vx(wx.cross(_x),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),Kz=vx(nr.cross(Rd),"v_bitangentLocal").normalize().toVar("bitangentLocal"),_4=ut(r=>{let t;return r.subBuildFn==="VERTEX"||r.geometry.hasAttribute("tangent")?t=vx(Ie.cross(Mx),"v_bitangentView").normalize():t=jz,r.isFlatShading()!==!0&&(t=Dd(t)),t},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView"),Zz=vx(Lc.cross(T4),"v_bitangentWorld").normalize().toVar("bitangentWorld"),Ru=Ws(Mx,_4,Ie).toVar("TBNViewMatrix"),M4=dn.mul(Ru),Qz=(r,t)=>r.sub(M4.mul(t)),v4=ut(()=>{let r=Bu.cross(dn);return r=r.cross(Bu).normalize(),r=Ce(r,Ie,oc.mul(Xo.oneMinus()).oneMinus().pow2().pow2()).normalize(),r}).once()(),A4=r=>Kt(r).mul(.5).add(.5),Jz=r=>Kt(r).mul(2).sub(1),Q2=r=>it(r,Di(xx(k(1).sub(to(r,r)))));class t6 extends is{static get type(){return"NormalMapNode"}constructor(t,e=null){super("vec3"),this.node=t,this.scaleNode=e,this.normalMapType=nl,this.unpackNormalMode=tS}setup(t){const{normalMapType:e,scaleNode:n,unpackNormalMode:s}=this;let i=this.node.mul(2).sub(1);if(e===nl?s===H3?i=Q2(i.xy):s===YF?i=Q2(i.yw):s!==tS&&console.error(`THREE.NodeMaterial: Unexpected unpack normal mode: ${s}`):s!==tS&&console.error(`THREE.NodeMaterial: Normal map type '${e}' is not compatible with unpack normal mode '${s}'`),n!==null){let c=n;t.isFlatShading()===!0&&(c=Dd(c)),i=it(i.xy.mul(c),i.z)}let a=null;return e===jF?a=UT(i):e===nl?a=Ru.mul(i).normalize():(Ht(`NodeMaterial: Unsupported normal map type: ${e}`),a=Ie),a}}const J2=xe(t6).setParameterLength(1,2),e6=ut(({textureNode:r,bumpScale:t})=>{const e=s=>r.isolate().context({getUV:i=>s(i.uvNode||cn()),forceUVContext:!0}),n=k(e(s=>s));return It(k(e(s=>s.add(s.dFdx()))).sub(n),k(e(s=>s.add(s.dFdy()))).sub(n)).mul(t)}),n6=ut(r=>{const{surf_pos:t,surf_norm:e,dHdxy:n}=r,s=t.dFdx().normalize(),i=t.dFdy().normalize(),a=e,c=i.cross(a),u=a.cross(s),d=s.dot(c).mul(FT),f=d.sign().mul(n.x.mul(c).add(n.y.mul(u)));return d.abs().mul(e).sub(f).normalize()});class s6 extends is{static get type(){return"BumpMapNode"}constructor(t,e=null){super("vec3"),this.textureNode=t,this.scaleNode=e}setup(){const t=this.scaleNode!==null?this.scaleNode:1,e=e6({textureNode:this.textureNode,bumpScale:t});return n6({surf_pos:cs,surf_norm:Ie,dHdxy:e})}}const IT=xe(s6).setParameterLength(1,2),aR=new Map;class Bt extends Zt{static get type(){return"MaterialNode"}constructor(t){super(),this.scope=t}getCache(t,e){let n=aR.get(t);return n===void 0&&(n=Ka(t,e),aR.set(t,n)),n}getFloat(t){return this.getCache(t,"float")}getColor(t){return this.getCache(t,"color")}getTexture(t){return this.getCache(t==="map"?"map":t+"Map","texture")}setup(t){const e=t.context.material,n=this.scope;let s=null;if(n===Bt.COLOR){const i=e.color!==void 0?this.getColor(n):it();e.map&&e.map.isTexture===!0?s=i.mul(this.getTexture("map")):s=i}else if(n===Bt.OPACITY){const i=this.getFloat(n);e.alphaMap&&e.alphaMap.isTexture===!0?s=i.mul(this.getTexture("alpha")):s=i}else if(n===Bt.SPECULAR_STRENGTH)e.specularMap&&e.specularMap.isTexture===!0?s=this.getTexture("specular").r:s=k(1);else if(n===Bt.SPECULAR_INTENSITY){const i=this.getFloat(n);e.specularIntensityMap&&e.specularIntensityMap.isTexture===!0?s=i.mul(this.getTexture(n).a):s=i}else if(n===Bt.SPECULAR_COLOR){const i=this.getColor(n);e.specularColorMap&&e.specularColorMap.isTexture===!0?s=i.mul(this.getTexture(n).rgb):s=i}else if(n===Bt.ROUGHNESS){const i=this.getFloat(n);e.roughnessMap&&e.roughnessMap.isTexture===!0?s=i.mul(this.getTexture(n).g):s=i}else if(n===Bt.METALNESS){const i=this.getFloat(n);e.metalnessMap&&e.metalnessMap.isTexture===!0?s=i.mul(this.getTexture(n).b):s=i}else if(n===Bt.EMISSIVE){const i=this.getFloat("emissiveIntensity"),a=this.getColor(n).mul(i);e.emissiveMap&&e.emissiveMap.isTexture===!0?s=a.mul(this.getTexture(n)):s=a}else if(n===Bt.NORMAL)e.normalMap?(s=J2(this.getTexture("normal"),this.getCache("normalScale","vec2")),s.normalMapType=e.normalMapType,(e.normalMap.format==jo||e.normalMap.format==Bp||e.normalMap.format==Cp)&&(s.unpackNormalMode=H3)):e.bumpMap?s=IT(this.getTexture("bump").r,this.getFloat("bumpScale")):s=Ie;else if(n===Bt.CLEARCOAT){const i=this.getFloat(n);e.clearcoatMap&&e.clearcoatMap.isTexture===!0?s=i.mul(this.getTexture(n).r):s=i}else if(n===Bt.CLEARCOAT_ROUGHNESS){const i=this.getFloat(n);e.clearcoatRoughnessMap&&e.clearcoatRoughnessMap.isTexture===!0?s=i.mul(this.getTexture(n).r):s=i}else if(n===Bt.CLEARCOAT_NORMAL)e.clearcoatNormalMap?s=J2(this.getTexture(n),this.getCache(n+"Scale","vec2")):s=Ie;else if(n===Bt.SHEEN){const i=this.getColor("sheenColor").mul(this.getFloat("sheen"));e.sheenColorMap&&e.sheenColorMap.isTexture===!0?s=i.mul(this.getTexture("sheenColor").rgb):s=i}else if(n===Bt.SHEEN_ROUGHNESS){const i=this.getFloat(n);e.sheenRoughnessMap&&e.sheenRoughnessMap.isTexture===!0?s=i.mul(this.getTexture(n).a):s=i,s=s.clamp(1e-4,1)}else if(n===Bt.ANISOTROPY)if(e.anisotropyMap&&e.anisotropyMap.isTexture===!0){const i=this.getTexture(n);s=fx(ed.x,ed.y,ed.y.negate(),ed.x).mul(i.rg.mul(2).sub(It(1)).normalize().mul(i.b))}else s=ed;else if(n===Bt.IRIDESCENCE_THICKNESS){const i=Nn("1","float",e.iridescenceThicknessRange);if(e.iridescenceThicknessMap){const a=Nn("0","float",e.iridescenceThicknessRange);s=i.sub(a).mul(this.getTexture(n).g).add(a)}else s=i}else if(n===Bt.TRANSMISSION){const i=this.getFloat(n);e.transmissionMap?s=i.mul(this.getTexture(n).r):s=i}else if(n===Bt.THICKNESS){const i=this.getFloat(n);e.thicknessMap?s=i.mul(this.getTexture(n).g):s=i}else if(n===Bt.IOR)s=this.getFloat(n);else if(n===Bt.LIGHT_MAP)s=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===Bt.AO)s=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(n===Bt.LINE_DASH_OFFSET)s=e.dashOffset?this.getFloat(n):k(0);else{const i=this.getNodeType(t);s=this.getCache(n,i)}return s}}Bt.ALPHA_TEST="alphaTest";Bt.COLOR="color";Bt.OPACITY="opacity";Bt.SHININESS="shininess";Bt.SPECULAR="specular";Bt.SPECULAR_STRENGTH="specularStrength";Bt.SPECULAR_INTENSITY="specularIntensity";Bt.SPECULAR_COLOR="specularColor";Bt.REFLECTIVITY="reflectivity";Bt.ROUGHNESS="roughness";Bt.METALNESS="metalness";Bt.NORMAL="normal";Bt.CLEARCOAT="clearcoat";Bt.CLEARCOAT_ROUGHNESS="clearcoatRoughness";Bt.CLEARCOAT_NORMAL="clearcoatNormal";Bt.EMISSIVE="emissive";Bt.ROTATION="rotation";Bt.SHEEN="sheen";Bt.SHEEN_ROUGHNESS="sheenRoughness";Bt.ANISOTROPY="anisotropy";Bt.IRIDESCENCE="iridescence";Bt.IRIDESCENCE_IOR="iridescenceIOR";Bt.IRIDESCENCE_THICKNESS="iridescenceThickness";Bt.IOR="ior";Bt.TRANSMISSION="transmission";Bt.THICKNESS="thickness";Bt.ATTENUATION_DISTANCE="attenuationDistance";Bt.ATTENUATION_COLOR="attenuationColor";Bt.LINE_SCALE="scale";Bt.LINE_DASH_SIZE="dashSize";Bt.LINE_GAP_SIZE="gapSize";Bt.LINE_WIDTH="linewidth";Bt.LINE_DASH_OFFSET="dashOffset";Bt.POINT_SIZE="size";Bt.DISPERSION="dispersion";Bt.LIGHT_MAP="light";Bt.AO="ao";const N4=Xt(Bt,Bt.ALPHA_TEST),R4=Xt(Bt,Bt.COLOR),E4=Xt(Bt,Bt.SHININESS),C4=Xt(Bt,Bt.EMISSIVE),VT=Xt(Bt,Bt.OPACITY),B4=Xt(Bt,Bt.SPECULAR),tw=Xt(Bt,Bt.SPECULAR_INTENSITY),D4=Xt(Bt,Bt.SPECULAR_COLOR),_p=Xt(Bt,Bt.SPECULAR_STRENGTH),Vg=Xt(Bt,Bt.REFLECTIVITY),L4=Xt(Bt,Bt.ROUGHNESS),O4=Xt(Bt,Bt.METALNESS),F4=Xt(Bt,Bt.NORMAL),U4=Xt(Bt,Bt.CLEARCOAT),P4=Xt(Bt,Bt.CLEARCOAT_ROUGHNESS),z4=Xt(Bt,Bt.CLEARCOAT_NORMAL),I4=Xt(Bt,Bt.ROTATION),V4=Xt(Bt,Bt.SHEEN),G4=Xt(Bt,Bt.SHEEN_ROUGHNESS),k4=Xt(Bt,Bt.ANISOTROPY),H4=Xt(Bt,Bt.IRIDESCENCE),W4=Xt(Bt,Bt.IRIDESCENCE_IOR),q4=Xt(Bt,Bt.IRIDESCENCE_THICKNESS),$4=Xt(Bt,Bt.TRANSMISSION),X4=Xt(Bt,Bt.THICKNESS),j4=Xt(Bt,Bt.IOR),Y4=Xt(Bt,Bt.ATTENUATION_DISTANCE),K4=Xt(Bt,Bt.ATTENUATION_COLOR),Z4=Xt(Bt,Bt.LINE_SCALE),Q4=Xt(Bt,Bt.LINE_DASH_SIZE),J4=Xt(Bt,Bt.LINE_GAP_SIZE),i6=Xt(Bt,Bt.LINE_WIDTH),tB=Xt(Bt,Bt.LINE_DASH_OFFSET),eB=Xt(Bt,Bt.POINT_SIZE),nB=Xt(Bt,Bt.DISPERSION),GT=Xt(Bt,Bt.LIGHT_MAP),sB=Xt(Bt,Bt.AO),ed=Jt(new Ot).onReference(function(r){return r.material}).onRenderUpdate(function({material:r}){this.value.set(r.anisotropy*Math.cos(r.anisotropyRotation),r.anisotropy*Math.sin(r.anisotropyRotation))}),iB=ut(r=>r.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class r6 extends ku{static get type(){return"StorageArrayElementNode"}constructor(t,e){super(t,e),this.isStorageArrayElementNode=!0}set storageBufferNode(t){this.node=t}get storageBufferNode(){return this.node}getMemberType(t,e){const n=this.storageBufferNode.structTypeNode;return n?n.getMemberType(t,e):"void"}setup(t){return t.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&t.setupPBO(this.node),super.setup(t)}generate(t,e){let n;const s=t.context.assign;if(t.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&s!==!0&&(this.node.value.isInstancedBufferAttribute||t.shaderStage!=="compute")?n=t.generatePBO(this):n=this.node.build(t):n=super.generate(t),s!==!0){const i=this.getNodeType(t);n=t.format(n,i,e)}return n}}const o6=xe(r6).setParameterLength(2);class a6 extends BT{static get type(){return"StorageBufferNode"}constructor(t,e=null,n=0){let s,i=null;e&&e.isStruct?(s="struct",i=e.layout,(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute)&&(n=t.count)):e===null&&(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute)?(s=mC(t.itemSize),n=t.count):s=e,super(t,s,n),this.isStorageBufferNode=!0,this.structTypeNode=i,this.access=si.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,t.isStorageBufferAttribute!==!0&&t.isStorageInstancedBufferAttribute!==!0&&(t.isInstancedBufferAttribute?t.isStorageInstancedBufferAttribute=!0:t.isStorageBufferAttribute=!0)}getHash(t){if(this.bufferCount===0){let e=t.globalCache.getData(this.value);return e===void 0&&(e={node:this},t.globalCache.setData(this.value,e)),e.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(t){return o6(this,t)}setPBO(t){return this.isPBO=t,this}getPBO(){return this.isPBO}setAccess(t){return this.access=t,this}toReadOnly(){return this.setAccess(si.READ_ONLY)}setAtomic(t){return this.isAtomic=t,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=NT(this.value),this._varying=Cc(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(t){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(t);if(t.isAvailable("storageBuffer")||t.isAvailable("indirectStorageBuffer"))return super.getNodeType(t);const{attribute:e}=this.getAttributeData();return e.getNodeType(t)}getMemberType(t,e){return this.structTypeNode!==null?this.structTypeNode.getMemberType(t,e):"void"}generate(t){if(this.structTypeNode!==null&&this.structTypeNode.build(t),t.isAvailable("storageBuffer")||t.isAvailable("indirectStorageBuffer"))return super.generate(t);const{attribute:e,varying:n}=this.getAttributeData(),s=n.build(t);return t.registerTransform(s,e),s}}const Tc=(r,t=null,e=0)=>new a6(r,t,e);class Un extends Zt{static get type(){return"IndexNode"}constructor(t){super("uint"),this.scope=t,this.isIndexNode=!0}generate(t){const e=this.getNodeType(t),n=this.scope;let s;if(n===Un.VERTEX)s=t.getVertexIndex();else if(n===Un.INSTANCE)s=t.getInstanceIndex();else if(n===Un.DRAW)s=t.getDrawIndex();else if(n===Un.INVOCATION_LOCAL)s=t.getInvocationLocalIndex();else if(n===Un.INVOCATION_SUBGROUP)s=t.getInvocationSubgroupIndex();else if(n===Un.SUBGROUP)s=t.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let i;return t.shaderStage==="vertex"||t.shaderStage==="compute"?i=s:i=Cc(this).build(t,e),i}}Un.VERTEX="vertex";Un.INSTANCE="instance";Un.SUBGROUP="subgroup";Un.INVOCATION_LOCAL="invocationLocal";Un.INVOCATION_SUBGROUP="invocationSubgroup";Un.DRAW="draw";const rB=Xt(Un,Un.VERTEX),oa=Xt(Un,Un.INSTANCE),l6=Xt(Un,Un.SUBGROUP),c6=Xt(Un,Un.INVOCATION_SUBGROUP),u6=Xt(Un,Un.INVOCATION_LOCAL),oB=Xt(Un,Un.DRAW);class aB extends Zt{static get type(){return"InstanceNode"}constructor(t,e,n=null){super("void"),this.count=t,this.instanceMatrix=e,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=de.FRAME,this.buffer=null,this.bufferColor=null,this.previousInstanceMatrixNode=null}get isStorageMatrix(){const{instanceMatrix:t}=this;return t&&t.isStorageInstancedBufferAttribute===!0}get isStorageColor(){const{instanceColor:t}=this;return t&&t.isStorageInstancedBufferAttribute===!0}setup(t){let{instanceMatrixNode:e,instanceColorNode:n}=this;e===null&&(e=this._createInstanceMatrixNode(!0,t),this.instanceMatrixNode=e);const{instanceColor:s,isStorageColor:i}=this;if(s&&n===null){if(i)n=Tc(s,"vec3",Math.max(s.count,1)).element(oa);else{const c=new bc(s.array,3),u=s.usage===Dp?$2:Py;this.bufferColor=c,n=it(u(c,"vec3",3,0))}this.instanceColorNode=n}const a=e.mul(kn).xyz;if(kn.assign(a),t.needsPreviousData()&&Ad.assign(this.getPreviousInstancedPosition(t)),t.hasGeometryAttribute("normal")){const c=l4(nr,e);nr.assign(c)}this.instanceColorNode!==null&&zp("vec3","vInstanceColor").assign(this.instanceColorNode)}update(t){this.buffer!==null&&this.isStorageMatrix!==!0&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&this.isStorageColor!==!0&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)),this.previousInstanceMatrixNode!==null&&t.object.previousInstanceMatrix.array.set(this.instanceMatrix.array)}getPreviousInstancedPosition(t){const e=t.object;return this.previousInstanceMatrixNode===null&&(e.previousInstanceMatrix=this.instanceMatrix.clone(),this.previousInstanceMatrixNode=this._createInstanceMatrixNode(!1,t)),this.previousInstanceMatrixNode.mul(Ad).xyz}_createInstanceMatrixNode(t,e){let n;const{instanceMatrix:s}=this,{count:i}=s;if(this.isStorageMatrix)n=Tc(s,"mat4",Math.max(i,1)).element(oa);else if(i*16*4<=e.getUniformBufferLimit())n=jp(s.array,"mat4",Math.max(i,1)).element(oa);else{const c=new Z8(s.array,16,1);t===!0&&(this.buffer=c);const u=s.usage===Dp?$2:Py,d=[u(c,"vec4",16,0),u(c,"vec4",16,4),u(c,"vec4",16,8),u(c,"vec4",16,12)];n=Sc(...d)}return n}}const h6=xe(aB).setParameterLength(2,3);class d6 extends aB{static get type(){return"InstancedMeshNode"}constructor(t){const{count:e,instanceMatrix:n,instanceColor:s}=t;super(e,n,s),this.instancedMesh=t}}const lB=xe(d6).setParameterLength(1);class f6 extends Zt{static get type(){return"BatchNode"}constructor(t){super("void"),this.batchMesh=t,this.batchingIdNode=null}setup(t){this.batchingIdNode===null&&(t.getDrawIndex()===null?this.batchingIdNode=oa:this.batchingIdNode=oB);const n=ut(([x])=>{const S=J(wc(Zn(this.batchMesh._indirectTexture),0).x).toConst(),T=J(x).mod(S).toConst(),M=J(x).div(S).toConst();return Zn(this.batchMesh._indirectTexture,Rs(T,M)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(J(this.batchingIdNode)),s=this.batchMesh._matricesTexture,i=J(wc(Zn(s),0).x).toConst(),a=k(n).mul(4).toInt().toConst(),c=a.mod(i).toConst(),u=a.div(i).toConst(),d=Sc(Zn(s,Rs(c,u)),Zn(s,Rs(c.add(1),u)),Zn(s,Rs(c.add(2),u)),Zn(s,Rs(c.add(3),u))),f=this.batchMesh._colorsTexture;if(f!==null){const S=ut(([T])=>{const M=J(wc(Zn(f),0).x).toConst(),N=T,v=N.mod(M).toConst(),A=N.div(M).toConst();return Zn(f,Rs(v,A)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);zp("vec3","vBatchColor").assign(S)}const p=Ws(d);kn.assign(d.mul(kn));const g=nr.div(it(p[0].dot(p[0]),p[1].dot(p[1]),p[2].dot(p[2]))),y=p.mul(g).xyz;nr.assign(y),t.hasGeometryAttribute("tangent")&&Rd.mulAssign(p)}}const cB=xe(f6).setParameterLength(1),lR=new WeakMap;class uB extends Zt{static get type(){return"SkinningNode"}constructor(t){super("void"),this.skinnedMesh=t,this.updateType=de.OBJECT,this.skinIndexNode=al("skinIndex","uvec4"),this.skinWeightNode=al("skinWeight","vec4"),this.bindMatrixNode=Nn("bindMatrix","mat4"),this.bindMatrixInverseNode=Nn("bindMatrixInverse","mat4"),this.boneMatricesNode=Y2("skeleton.boneMatrices","mat4",t.skeleton.bones.length),this.positionNode=kn,this.toPositionNode=kn,this.previousBoneMatricesNode=null}getSkinnedPosition(t=this.boneMatricesNode,e=this.positionNode){const{skinIndexNode:n,skinWeightNode:s,bindMatrixNode:i,bindMatrixInverseNode:a}=this,c=t.element(n.x),u=t.element(n.y),d=t.element(n.z),f=t.element(n.w),p=i.mul(e),g=xs(c.mul(s.x).mul(p),u.mul(s.y).mul(p),d.mul(s.z).mul(p),f.mul(s.w).mul(p));return a.mul(g).xyz}getSkinnedNormalAndTangent(t=this.boneMatricesNode,e=nr,n=Rd){const{skinIndexNode:s,skinWeightNode:i,bindMatrixNode:a,bindMatrixInverseNode:c}=this,u=t.element(s.x),d=t.element(s.y),f=t.element(s.z),p=t.element(s.w);let g=xs(i.x.mul(u),i.y.mul(d),i.z.mul(f),i.w.mul(p));g=c.mul(g).mul(a);const y=g.transformDirection(e).xyz,x=g.transformDirection(n).xyz;return{skinNormal:y,skinTangent:x}}getPreviousSkinnedPosition(t){const e=t.object;return this.previousBoneMatricesNode===null&&(e.skeleton.previousBoneMatrices=new Float32Array(e.skeleton.boneMatrices),this.previousBoneMatricesNode=Y2("skeleton.previousBoneMatrices","mat4",e.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,Ad)}setup(t){t.needsPreviousData()&&Ad.assign(this.getPreviousSkinnedPosition(t));const e=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(e),t.hasGeometryAttribute("normal")){const{skinNormal:n,skinTangent:s}=this.getSkinnedNormalAndTangent();nr.assign(n),t.hasGeometryAttribute("tangent")&&Rd.assign(s)}return e}generate(t,e){if(e!=="void")return super.generate(t,e)}update(t){const e=t.object&&t.object.skeleton?t.object.skeleton:this.skinnedMesh.skeleton;lR.get(e)!==t.frameId&&(lR.set(e,t.frameId),this.previousBoneMatricesNode!==null&&(e.previousBoneMatrices===null&&(e.previousBoneMatrices=new Float32Array(e.boneMatrices)),e.previousBoneMatrices.set(e.boneMatrices)),e.update())}}const hB=r=>new uB(r),p6=(r,t=null)=>{const e=new uB(r);return e.positionNode=Tc(new bc(r.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(oa).toVar(),e.skinIndexNode=Tc(new bc(new Uint32Array(r.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(oa).toVar(),e.skinWeightNode=Tc(new bc(r.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(oa).toVar(),e.bindMatrixNode=Jt(r.bindMatrix,"mat4"),e.bindMatrixInverseNode=Jt(r.bindMatrixInverse,"mat4"),e.boneMatricesNode=jp(r.skeleton.boneMatrices,"mat4",r.skeleton.bones.length),e.toPositionNode=t,Kt(e)};class m6 extends Zt{static get type(){return"LoopNode"}constructor(t=[]){super("void"),this.params=t}getVarName(t){return String.fromCharCode(105+t)}getProperties(t){const e=t.getNodeProperties(this);if(e.stackNode!==void 0)return e;const n={};for(let c=0,u=this.params.length-1;c<u;c++){const d=this.params[c],f=d.isNode!==!0&&d.name||this.getVarName(c),p=d.isNode!==!0&&d.type||"int";n[f]=_o(f,p)}const s=t.addStack(),i=this.params[this.params.length-1](n);e.returnsNode=i.context({nodeLoop:i}),e.stackNode=s;const a=this.params[0];if(a.isNode!==!0&&typeof a.update=="function"){const c=ut(this.params[0].update)(n);e.updateNode=c.context({nodeLoop:c})}return t.removeStack(),e}setup(t){if(this.getProperties(t),t.fnCall){const e=t.getDataFromNode(t.fnCall.shaderNode);e.hasLoop=!0}}generate(t){const e=this.getProperties(t),n=this.params,s=e.stackNode;for(let a=0,c=n.length-1;a<c;a++){const u=n[a];let d=!1,f=null,p=null,g=null,y=null,x=null,S=null;u.isNode?u.getNodeType(t)==="bool"?(d=!0,y="bool",p=u.build(t,y)):(y="int",g=this.getVarName(a),f="0",p=u.build(t,y),x="<"):(y=u.type||"int",g=u.name||this.getVarName(a),f=u.start,p=u.end,x=u.condition,S=u.update,typeof f=="number"?f=t.generateConst(y,f):f&&f.isNode&&(f=f.build(t,y)),typeof p=="number"?p=t.generateConst(y,p):p&&p.isNode&&(p=p.build(t,y)),f!==void 0&&p===void 0?(f=f+" - 1",p="0",x=">="):p!==void 0&&f===void 0&&(f="0",x="<"),x===void 0&&(Number(f)>Number(p)?x=">=":x="<"));let T;if(d)T=`while ( ${p} )`;else{const M={start:f,end:p},N=M.start,v=M.end;let A;const R=()=>x.includes("<")?"+=":"-=";if(S!=null)switch(typeof S){case"function":A=t.flowStagesNode(e.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":A=g+" "+R()+" "+t.generateConst(y,S);break;case"string":A=g+" "+S;break;default:S.isNode?A=g+" "+R()+" "+S.build(t):(Ht("TSL: 'Loop( { update: ... } )' is not a function, string or number.",this.stackTrace),A="break /* invalid update */")}else y==="int"||y==="uint"?S=x.includes("<")?"++":"--":S=R()+" 1.",A=g+" "+S;const F=t.getVar(y,g)+" = "+N,D=g+" "+x+" "+v;T=`for ( ${F}; ${D}; ${A} )`}t.addFlowCode((a===0?`
`:"")+t.tab+T+` {

`).addFlowTab()}const i=s.build(t,"void");e.returnsNode.build(t,"void"),t.removeFlowTab().addFlowCode(`
`+t.tab+i);for(let a=0,c=this.params.length-1;a<c;a++)t.addFlowCode((a===0?"":t.tab)+`}

`).removeFlowTab();t.addFlowTab()}}const on=(...r)=>new m6(Cu(r,"int")).toStack(),g6=()=>_o("continue").toStack(),dB=()=>_o("break").toStack(),US=new WeakMap,gr=new je,cR=ut(({bufferMap:r,influence:t,stride:e,width:n,depth:s,offset:i})=>{const a=J(rB).mul(e).add(i),c=a.div(n),u=a.sub(c.mul(n));return Zn(r,Rs(u,c)).depth(s).xyz.mul(t)});function y6(r){const t=r.morphAttributes.position!==void 0,e=r.morphAttributes.normal!==void 0,n=r.morphAttributes.color!==void 0,s=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,i=s!==void 0?s.length:0;let a=US.get(r);if(a===void 0||a.count!==i){let N=function(){T.dispose(),US.delete(r),r.removeEventListener("dispose",N)};var c=N;a!==void 0&&a.texture.dispose();const u=r.morphAttributes.position||[],d=r.morphAttributes.normal||[],f=r.morphAttributes.color||[];let p=0;t===!0&&(p=1),e===!0&&(p=2),n===!0&&(p=3);let g=r.attributes.position.count*p,y=1;const x=4096;g>x&&(y=Math.ceil(g/x),g=x);const S=new Float32Array(g*y*4*i),T=new DU(S,g,y,i);T.type=Ri,T.needsUpdate=!0;const M=p*4;for(let v=0;v<i;v++){const A=u[v],R=d[v],F=f[v],D=g*y*4*v;for(let O=0;O<A.count;O++){const B=O*M;t===!0&&(gr.fromBufferAttribute(A,O),S[D+B+0]=gr.x,S[D+B+1]=gr.y,S[D+B+2]=gr.z,S[D+B+3]=0),e===!0&&(gr.fromBufferAttribute(R,O),S[D+B+4]=gr.x,S[D+B+5]=gr.y,S[D+B+6]=gr.z,S[D+B+7]=0),n===!0&&(gr.fromBufferAttribute(F,O),S[D+B+8]=gr.x,S[D+B+9]=gr.y,S[D+B+10]=gr.z,S[D+B+11]=F.itemSize===4?gr.w:1)}}a={count:i,texture:T,stride:p,size:new Ot(g,y)},US.set(r,a),r.addEventListener("dispose",N)}return a}class x6 extends Zt{static get type(){return"MorphNode"}constructor(t){super("void"),this.mesh=t,this.morphBaseInfluence=Jt(1),this.updateType=de.OBJECT}setup(t){const{geometry:e}=t,n=e.morphAttributes.position!==void 0,s=e.hasAttribute("normal")&&e.morphAttributes.normal!==void 0,i=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,a=i!==void 0?i.length:0,{texture:c,stride:u,size:d}=y6(e);n===!0&&kn.mulAssign(this.morphBaseInfluence),s===!0&&nr.mulAssign(this.morphBaseInfluence);const f=J(d.width);on(a,({i:p})=>{const g=k(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?g.assign(Zn(this.mesh.morphTexture,Rs(J(p).add(1),J(oa))).r):g.assign(Nn("morphTargetInfluences","float").element(p).toVar()),re(g.notEqual(0),()=>{n===!0&&kn.addAssign(cR({bufferMap:c,influence:g,stride:u,width:f,depth:p,offset:J(0)})),s===!0&&nr.addAssign(cR({bufferMap:c,influence:g,stride:u,width:f,depth:p,offset:J(1)}))})})}update(){const t=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?t.value=1:t.value=1-this.mesh.morphTargetInfluences.reduce((e,n)=>e+n,0)}}const fB=xe(x6).setParameterLength(1);class Ld extends Zt{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class b6 extends Ld{static get type(){return"AONode"}constructor(t=null){super(),this.aoNode=t}setup(t){t.context.ambientOcclusion.mulAssign(this.aoNode)}}class S6 extends _5{static get type(){return"LightingContextNode"}constructor(t,e=null,n=null,s=null){super(t),this.lightingModel=e,this.backdropNode=n,this.backdropAlphaNode=s,this._value=null}getContext(){const{backdropNode:t,backdropAlphaNode:e}=this,n=it().toVar("directDiffuse"),s=it().toVar("directSpecular"),i=it().toVar("indirectDiffuse"),a=it().toVar("indirectSpecular"),c={directDiffuse:n,directSpecular:s,indirectDiffuse:i,indirectSpecular:a};return{radiance:it().toVar("radiance"),irradiance:it().toVar("irradiance"),iblIrradiance:it().toVar("iblIrradiance"),ambientOcclusion:k(1).toVar("ambientOcclusion"),reflectedLight:c,backdrop:t,backdropAlpha:e}}setup(t){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||t.context.lightingModel,super.setup(t)}}const pB=xe(S6);class w6 extends Ld{static get type(){return"IrradianceNode"}constructor(t){super(),this.node=t}setup(t){t.context.irradiance.addAssign(this.node)}}const Vh=new Ot;class Ax extends ca{static get type(){return"ViewportTextureNode"}constructor(t=ia,e=null,n=null){let s=null;n===null?(s=new Dw,s.minFilter=Jo,n=s):s=n,super(n,t,e),this.generateMipmaps=!1,this.defaultFramebuffer=s,this.isOutputTextureNode=!0,this.updateBeforeType=de.RENDER,this._cacheTextures=new WeakMap}getTextureForReference(t=null){let e,n;if(this.referenceNode?(e=this.referenceNode.defaultFramebuffer,n=this.referenceNode._cacheTextures):(e=this.defaultFramebuffer,n=this._cacheTextures),t===null)return e;if(n.has(t)===!1){const s=e.clone();n.set(t,s)}return n.get(t)}updateReference(t){const e=t.renderer.getRenderTarget();return this.value=this.getTextureForReference(e),this.value}updateBefore(t){const e=t.renderer,n=e.getRenderTarget();n===null?e.getDrawingBufferSize(Vh):Vh.set(n.width,n.height);const s=this.getTextureForReference(n);(s.image.width!==Vh.width||s.image.height!==Vh.height)&&(s.image.width=Vh.width,s.image.height=Vh.height,s.needsUpdate=!0);const i=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,e.copyFramebufferToTexture(s),s.generateMipmaps=i}clone(){const t=new this.constructor(this.uvNode,this.levelNode,this.value);return t.generateMipmaps=this.generateMipmaps,t}}const T6=xe(Ax).setParameterLength(0,3),kT=xe(Ax,null,null,{generateMipmaps:!0}).setParameterLength(0,3),_6=kT(),mB=(r=ia,t=null)=>_6.sample(r,t);let Xm=null;class M6 extends Ax{static get type(){return"ViewportDepthTextureNode"}constructor(t=ia,e=null){Xm===null&&(Xm=new Yr),super(t,e,Xm)}getTextureForReference(){return Xm}}const HT=xe(M6).setParameterLength(0,2);class Ki extends Zt{static get type(){return"ViewportDepthNode"}constructor(t,e=null){super("float"),this.scope=t,this.valueNode=e,this.isViewportDepthNode=!0}generate(t){const{scope:e}=this;return e===Ki.DEPTH_BASE?t.getFragDepth():super.generate(t)}setup({camera:t}){const{scope:e}=this,n=this.valueNode;let s=null;if(e===Ki.DEPTH_BASE)n!==null&&(s=yB().assign(n));else if(e===Ki.DEPTH)t.isPerspectiveCamera?s=WT(cs.z,cc,uc):s=md(cs.z,cc,uc);else if(e===Ki.LINEAR_DEPTH)if(n!==null)if(t.isPerspectiveCamera){const i=qT(n,cc,uc);s=md(i,cc,uc)}else s=n;else s=md(cs.z,cc,uc);return s}}Ki.DEPTH_BASE="depthBase";Ki.DEPTH="depth";Ki.LINEAR_DEPTH="linearDepth";const md=(r,t,e)=>r.add(t).div(t.sub(e)),v6=(r,t,e)=>r.add(e).div(e.sub(t)),A6=ut(([r,t,e],n)=>n.renderer.reversedDepthBuffer===!0?e.sub(t).mul(r).sub(e):t.sub(e).mul(r).sub(t)),WT=(r,t,e)=>t.add(r).mul(e).div(e.sub(t).mul(r)),gB=(r,t,e)=>t.mul(r.add(e)).div(r.mul(t.sub(e))),qT=ut(([r,t,e],n)=>n.renderer.reversedDepthBuffer===!0?t.mul(e).div(t.sub(e).mul(r).sub(t)):t.mul(e).div(e.sub(t).mul(r).sub(e))),$T=(r,t,e)=>{t=t.max(1e-6).toVar();const n=ea(r.negate().div(t)),s=ea(e.div(t));return n.div(s)},N6=(r,t,e)=>{const n=r.mul(gx(e.div(t)));return k(Math.E).pow(n).mul(t).negate()},yB=xe(Ki,Ki.DEPTH_BASE),XT=Xt(Ki,Ki.DEPTH),zy=xe(Ki,Ki.LINEAR_DEPTH).setParameterLength(0,1),R6=zy(HT());XT.assign=r=>yB(r);class Kr extends Zt{static get type(){return"ClippingNode"}constructor(t=Kr.DEFAULT){super(),this.scope=t}setup(t){super.setup(t);const e=t.clippingContext,{intersectionPlanes:n,unionPlanes:s}=e;return this.hardwareClipping=t.material.hardwareClipping,this.scope===Kr.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,s):this.scope===Kr.HARDWARE?this.setupHardwareClipping(s,t):this.setupDefault(n,s)}setupAlphaToCoverage(t,e){return ut(()=>{const n=k().toVar("distanceToPlane"),s=k().toVar("distanceToGradient"),i=k(1).toVar("clipOpacity"),a=e.length;if(this.hardwareClipping===!1&&a>0){const u=mi(e).setGroup(ee);on(a,({i:d})=>{const f=u.element(d);n.assign(cs.dot(f.xyz).negate().add(f.w)),s.assign(n.fwidth().div(2)),i.mulAssign(No(s.negate(),s,n))})}const c=t.length;if(c>0){const u=mi(t).setGroup(ee),d=k(1).toVar("intersectionClipOpacity");on(c,({i:f})=>{const p=u.element(f);n.assign(cs.dot(p.xyz).negate().add(p.w)),s.assign(n.fwidth().div(2)),d.mulAssign(No(s.negate(),s,n).oneMinus())}),i.mulAssign(d.oneMinus())}sn.a.mulAssign(i),sn.a.equal(0).discard()})()}setupDefault(t,e){return ut(()=>{const n=e.length;if(this.hardwareClipping===!1&&n>0){const i=mi(e).setGroup(ee);on(n,({i:a})=>{const c=i.element(a);cs.dot(c.xyz).greaterThan(c.w).discard()})}const s=t.length;if(s>0){const i=mi(t).setGroup(ee),a=Jr(!0).toVar("clipped");on(s,({i:c})=>{const u=i.element(c);a.assign(cs.dot(u.xyz).greaterThan(u.w).and(a))}),a.discard()}})()}setupHardwareClipping(t,e){const n=t.length;return e.enableHardwareClipping(n),ut(()=>{const s=mi(t).setGroup(ee),i=hl(e.getClipDistance());on(n,({i:a})=>{const c=s.element(a),u=cs.dot(c.xyz).sub(c.w).negate();i.element(a).assign(u)})})()}}Kr.ALPHA_TO_COVERAGE="alphaToCoverage";Kr.DEFAULT="default";Kr.HARDWARE="hardware";const E6=()=>new Kr,C6=()=>new Kr(Kr.ALPHA_TO_COVERAGE),B6=()=>new Kr(Kr.HARDWARE),D6=.05,uR=ut(([r])=>vo(fe(1e4,Ni(fe(17,r.x).add(fe(.1,r.y)))).mul(xs(.1,xn(Ni(fe(13,r.y).add(r.x))))))),hR=ut(([r])=>uR(It(uR(r.xy),r.z))),L6=ut(([r])=>{const t=qn(sa(pT(r.xyz)),sa(mT(r.xyz))),e=k(1).div(k(D6).mul(t)).toVar("pixScale"),n=It(Md(na(ea(e))),Md(yx(ea(e)))),s=It(hR(na(n.x.mul(r.xyz))),hR(na(n.y.mul(r.xyz)))),i=vo(ea(e)),a=xs(fe(i.oneMinus(),s.x),fe(i,s.y)),c=er(i,i.oneMinus()),u=it(a.mul(a).div(fe(2,c).mul(De(1,c))),a.sub(fe(.5,c)).div(De(1,c)),De(1,De(1,a).mul(De(1,a)).div(fe(2,c).mul(De(1,c))))),d=a.lessThan(c.oneMinus()).select(a.lessThan(c).select(u.x,u.y),u.z);return Ao(d,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class O6 extends K5{static get type(){return"VertexColorNode"}constructor(t){super(null,"vec4"),this.isVertexColorNode=!0,this.index=t}getAttributeName(){const t=this.index;return"color"+(t>0?t:"")}generate(t){const e=this.getAttributeName(t),n=t.hasGeometryAttribute(e);let s;return n===!0?s=super.generate(t):s=t.generateConst(this.nodeType,new je(1,1,1,1)),s}serialize(t){super.serialize(t),t.index=this.index}deserialize(t){super.deserialize(t),this.index=t.index}}const xB=(r=0)=>new O6(r),F6=ut(([r,t])=>er(1,r.oneMinus().div(t)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),U6=ut(([r,t])=>er(r.div(t.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),P6=ut(([r,t])=>r.oneMinus().mul(t.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),z6=ut(([r,t])=>Ce(r.mul(2).mul(t),r.oneMinus().mul(2).mul(t.oneMinus()).oneMinus(),vd(.5,r))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),I6=ut(([r,t])=>{const e=t.a.add(r.a.mul(t.a.oneMinus()));return se(t.rgb.mul(t.a).add(r.rgb.mul(r.a).mul(t.a.oneMinus())).div(e),e)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),bB=ut(([r])=>se(r.rgb.mul(r.a),r.a),{color:"vec4",return:"vec4"}),V6=ut(([r])=>(re(r.a.equal(0),()=>se(0)),se(r.rgb.div(r.a),r.a)),{color:"vec4",return:"vec4"});class ss extends Mr{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.maskShadowNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,this.contextNode=null}_getNodeChildren(){const t=[];for(const e of Object.getOwnPropertyNames(this)){if(e.startsWith("_")===!0)continue;const n=this[e];n&&n.isNode===!0&&t.push({property:e,childNode:n})}return t}customProgramCacheKey(){const t=[];for(const{property:e,childNode:n}of this._getNodeChildren())t.push(Bd(e.slice(0,-4)),n.getCacheKey());return this.type+qp(t)}build(t){this.setup(t)}setupObserver(t){return new eP(t)}setup(t){t.context.setupNormal=()=>Du(this.setupNormal(t),"NORMAL","vec3"),t.context.setupPositionView=()=>this.setupPositionView(t),t.context.setupModelViewProjection=()=>this.setupModelViewProjection(t);const e=t.renderer,n=e.getRenderTarget();e.contextNode.isContextNode===!0?t.context={...t.context,...e.contextNode.getFlowContextData()}:Ht('NodeMaterial: "renderer.contextNode" must be an instance of `context()`.'),this.contextNode!==null&&(this.contextNode.isContextNode===!0?t.context={...t.context,...this.contextNode.getFlowContextData()}:Ht('NodeMaterial: "material.contextNode" must be an instance of `context()`.')),t.addStack();const s=this.setupVertex(t),i=Du(this.vertexNode||s,"VERTEX");t.context.clipSpace=i,t.stack.outputNode=i,this.setupHardwareClipping(t),this.geometryNode!==null&&(t.stack.outputNode=t.stack.outputNode.bypass(this.geometryNode)),t.addFlow("vertex",t.removeStack()),t.addStack();let a;const c=this.setupClipping(t);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(t):e.depth===!0&&this.setupDepth(t)),this.fragmentNode===null){this.setupDiffuseColor(t),this.setupVariants(t);const u=this.setupLighting(t);c!==null&&t.stack.addToStack(c);const d=se(u,sn.a).max(0);a=this.setupOutput(t,d),fd.assign(a);const f=this.outputNode!==null;if(f&&(a=this.outputNode),t.context.getOutput&&(a=t.context.getOutput(a,t)),n!==null){const p=e.getMRT(),g=this.mrtNode;p!==null?(f&&fd.assign(a),a=p,g!==null&&(a=p.merge(g))):g!==null&&(a=g)}}else{let u=this.fragmentNode;u.isOutputStructNode!==!0&&(u=se(u)),a=this.setupOutput(t,u)}t.stack.outputNode=a,t.addFlow("fragment",t.removeStack()),t.observer=this.setupObserver(t)}setupClipping(t){if(t.clippingContext===null)return null;const{unionPlanes:e,intersectionPlanes:n}=t.clippingContext;let s=null;if(e.length>0||n.length>0){const i=t.renderer.currentSamples;this.alphaToCoverage&&i>1?s=C6():t.stack.addToStack(E6())}return s}setupHardwareClipping(t){if(this.hardwareClipping=!1,t.clippingContext===null)return;const e=t.clippingContext.unionPlanes.length;e>0&&e<=8&&t.isAvailable("clipDistance")&&(t.stack.addToStack(B6()),this.hardwareClipping=!0)}setupDepth(t){const{renderer:e,camera:n}=t;let s=this.depthNode;if(s===null){const i=e.getMRT();i&&i.has("depth")?s=i.get("depth"):e.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?s=$T(cs.z,cc,uc):s=md(cs.z,cc,uc))}s!==null&&XT.assign(s).toStack()}setupPositionView(){return Dc.mul(kn).xyz}setupModelViewProjection(){return rl.mul(cs)}setupVertex(t){return t.addStack(),this.setupPosition(t),t.context.position=t.removeStack(),iB}setupPosition(t){const{object:e,geometry:n}=t;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&fB(e).toStack(),e.isSkinnedMesh===!0&&hB(e).toStack(),this.displacementMap){const s=Ka("displacementMap","texture"),i=Ka("displacementScale","float"),a=Ka("displacementBias","float");kn.addAssign(nr.normalize().mul(s.x.mul(i).add(a)))}return e.isBatchedMesh&&cB(e).toStack(),e.isInstancedMesh&&e.instanceMatrix&&e.instanceMatrix.isInstancedBufferAttribute===!0&&lB(e).toStack(),this.positionNode!==null&&kn.assign(Du(this.positionNode,"POSITION","vec3")),kn}setupDiffuseColor(t){const{object:e,geometry:n}=t;this.maskNode!==null&&Jr(this.maskNode).not().discard();let s=this.colorNode?se(this.colorNode):R4;this.vertexColors===!0&&n.hasAttribute("color")&&(s=s.mul(xB())),e.instanceColor&&(s=zp("vec3","vInstanceColor").mul(s)),e.isBatchedMesh&&e._colorsTexture&&(s=zp("vec3","vBatchColor").mul(s)),sn.assign(s);const i=this.opacityNode?k(this.opacityNode):VT;sn.a.assign(sn.a.mul(i));let a=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(a=this.alphaTestNode!==null?k(this.alphaTestNode):N4,this.alphaToCoverage===!0?(sn.a=No(a,a.add(yT(sn.a)),sn.a),sn.a.lessThanEqual(0).discard()):sn.a.lessThanEqual(a).discard()),this.alphaHash===!0&&sn.a.lessThan(L6(kn)).discard(),t.isOpaque()&&sn.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?it(0):sn.rgb}setupNormal(){return this.normalNode?it(this.normalNode):F4}setupEnvironment(){let t=null;return this.envNode?t=this.envNode:this.envMap&&(t=this.envMap.isCubeTexture?Ka("envMap","cubeTexture"):Ka("envMap","texture")),t}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new w6(GT)),e}setupLights(t){const e=[],n=this.setupEnvironment(t);n&&n.isLightingNode&&e.push(n);const s=this.setupLightMap(t);s&&s.isLightingNode&&e.push(s);let i=this.aoNode;i===null&&t.material.aoMap&&(i=sB),t.context.getAO&&(i=t.context.getAO(i,t)),i&&e.push(new b6(i));let a=this.lightsNode||t.lightsNode;return e.length>0&&(a=t.renderer.lighting.createNode([...a.getLights(),...e])),a}setupLightingModel(){}setupLighting(t){const{material:e}=t,{backdropNode:n,backdropAlphaNode:s,emissiveNode:i}=this,c=this.lights===!0||this.lightsNode!==null?this.setupLights(t):null;let u=this.setupOutgoingLight(t);if(c&&c.getScope().hasLights){const d=this.setupLightingModel(t)||null;u=pB(c,d,n,s)}else n!==null&&(u=it(s!==null?Ce(u,n,s):n));return(i&&i.isNode===!0||e.emissive&&e.emissive.isColor===!0)&&(W2.assign(it(i||C4)),u=u.add(W2)),u}setupFog(t,e){const n=t.fogNode;return n&&(fd.assign(e),e=se(n.toVar())),e}setupPremultipliedAlpha(t,e){return bB(e)}setupOutput(t,e){return this.fog===!0&&(e=this.setupFog(t,e)),this.premultipliedAlpha===!0&&(e=this.setupPremultipliedAlpha(t,e)),e}setDefaultValues(t){for(const n in t){const s=t[n];this[n]===void 0&&(this[n]=s,s&&s.clone&&(this[n]=s.clone()))}const e=Object.getOwnPropertyDescriptors(t.constructor.prototype);for(const n in e)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&e[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,e[n])}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{},nodes:{}});const n=Mr.prototype.toJSON.call(this,t);n.inputNodes={};for(const{property:i,childNode:a}of this._getNodeChildren())n.inputNodes[i]=a.toJSON(t).uuid;function s(i){const a=[];for(const c in i){const u=i[c];delete u.metadata,a.push(u)}return a}if(e){const i=s(t.textures),a=s(t.images),c=s(t.nodes);i.length>0&&(n.textures=i),a.length>0&&(n.images=a),c.length>0&&(n.nodes=c)}return n}copy(t){return this.lightsNode=t.lightsNode,this.envNode=t.envNode,this.aoNode=t.aoNode,this.colorNode=t.colorNode,this.normalNode=t.normalNode,this.opacityNode=t.opacityNode,this.backdropNode=t.backdropNode,this.backdropAlphaNode=t.backdropAlphaNode,this.alphaTestNode=t.alphaTestNode,this.maskNode=t.maskNode,this.maskShadowNode=t.maskShadowNode,this.positionNode=t.positionNode,this.geometryNode=t.geometryNode,this.depthNode=t.depthNode,this.receivedShadowPositionNode=t.receivedShadowPositionNode,this.castShadowPositionNode=t.castShadowPositionNode,this.receivedShadowNode=t.receivedShadowNode,this.castShadowNode=t.castShadowNode,this.outputNode=t.outputNode,this.mrtNode=t.mrtNode,this.fragmentNode=t.fragmentNode,this.vertexNode=t.vertexNode,this.contextNode=t.contextNode,super.copy(t)}}const G6=new sC;class k6 extends ss{static get type(){return"LineBasicNodeMaterial"}constructor(t){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(G6),this.setValues(t)}}const H6=new z8;class W6 extends ss{static get type(){return"LineDashedNodeMaterial"}constructor(t){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(H6),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(t)}setupVariants(){const t=this.offsetNode?k(this.offsetNode):tB,e=this.dashScaleNode?k(this.dashScaleNode):Z4,n=this.dashSizeNode?k(this.dashSizeNode):Q4,s=this.gapSizeNode?k(this.gapSizeNode):J4;Ug.assign(n),q2.assign(s);const i=Cc(al("lineDistance").mul(e));(t?i.add(t):i).mod(Ug.add(q2)).greaterThan(Ug).discard()}}const q6=new F8;class $6 extends ss{static get type(){return"MeshNormalNodeMaterial"}constructor(t){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(q6),this.setValues(t)}setupDiffuseColor(){const t=this.opacityNode?k(this.opacityNode):VT;sn.assign(bx(se(A4(Ie),t),fn))}}const jT=ut(([r=OT])=>{const t=r.z.atan(r.x).mul(1/(Math.PI*2)).add(.5),e=r.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return It(t,e)});class SB extends cl{constructor(t=1,e={}){super(t,t,e),this.isCubeRenderTarget=!0;const n={width:t,height:t,depth:1},s=[n,n,n,n,n,n];this.texture=new rx(s),this._setTextureOptions(e),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(t,e){const n=e.minFilter,s=e.generateMipmaps;e.generateMipmaps=!0,this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i=new Y(5,5,5),a=jT(OT),c=new ss;c.colorNode=He(e,a,0),c.side=us,c.blending=tl;const u=new C(i,c),d=new Ew;d.add(u),e.minFilter===Jo&&(e.minFilter=qs);const f=new j8(1,10,this),p=t.getMRT();return t.setMRT(null),f.update(t,d),t.setMRT(p),e.minFilter=n,e.currentGenerateMipmaps=s,u.geometry.dispose(),u.material.dispose(),this}clear(t,e=!0,n=!0,s=!0){const i=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,n,s);t.setRenderTarget(i)}}const Mp=new WeakMap;class X6 extends is{static get type(){return"CubeMapNode"}constructor(t){super("vec3"),this.envNode=t,this._cubeTexture=null,this._cubeTextureNode=Ci(null);const e=new rx;e.isRenderTargetTexture=!0,this._defaultTexture=e,this.updateBeforeType=de.RENDER}updateBefore(t){const{renderer:e,material:n}=t,s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const i=s.isTextureNode?s.value:n[s.property];if(i&&i.isTexture){const a=i.mapping;if(a===Ky||a===_w){if(Mp.has(i)){const c=Mp.get(i);dR(c,i.mapping),this._cubeTexture=c}else{const c=i.image;if(j6(c)){const u=new SB(c.height);u.fromEquirectangularTexture(e,i),dR(u.texture,i.mapping),this._cubeTexture=u.texture,Mp.set(i,u.texture),i.addEventListener("dispose",wB)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(t){return this.updateBefore(t),this._cubeTextureNode}}function j6(r){return r==null?!1:r.height>0}function wB(r){const t=r.target;t.removeEventListener("dispose",wB);const e=Mp.get(t);e!==void 0&&(Mp.delete(t),e.dispose())}function dR(r,t){t===Ky?r.mapping=bd:t===_w&&(r.mapping=Qg)}const TB=xe(X6).setParameterLength(1);class YT extends Ld{static get type(){return"BasicEnvironmentNode"}constructor(t=null){super(),this.envNode=t}setup(t){t.context.environment=TB(this.envNode)}}class Y6 extends Ld{static get type(){return"BasicLightMapNode"}constructor(t=null){super(),this.lightMapNode=t}setup(t){const e=k(1/Math.PI);t.context.irradianceLightMap=this.lightMapNode.mul(e)}}class Nx{start(t){t.lightsNode.setupLights(t,t.lightsNode.getLightNodes(t)),this.indirect(t)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class _B extends Nx{constructor(){super()}indirect({context:t}){const e=t.ambientOcclusion,n=t.reflectedLight,s=t.irradianceLightMap;n.indirectDiffuse.assign(se(0)),s?n.indirectDiffuse.addAssign(s):n.indirectDiffuse.addAssign(se(1,1,1,0)),n.indirectDiffuse.mulAssign(e),n.indirectDiffuse.mulAssign(sn.rgb)}finish(t){const{material:e,context:n}=t,s=n.outgoingLight,i=t.context.environment;if(i)switch(e.combine){case Yy:s.rgb.assign(Ce(s.rgb,s.rgb.mul(i.rgb),_p.mul(Vg)));break;case PF:s.rgb.assign(Ce(s.rgb,i.rgb,_p.mul(Vg)));break;case zF:s.rgb.addAssign(i.rgb.mul(_p.mul(Vg)));break;default:Wt("BasicLightingModel: Unsupported .combine value:",e.combine);break}}}const K6=new $e;class Ac extends ss{static get type(){return"MeshBasicNodeMaterial"}constructor(t){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(K6),this.setValues(t)}setupNormal(){return Dd(Nd)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new YT(e):null}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new Y6(GT)),e}setupOutgoingLight(){return sn.rgb}setupLightingModel(){return new _B}}const Ed=ut(({f0:r,f90:t,dotVH:e})=>{const n=e.mul(-5.55473).sub(6.98316).mul(e).exp2();return r.mul(n.oneMinus()).add(t.mul(n))}),Pu=ut(r=>r.diffuseColor.mul(1/Math.PI)),Z6=()=>k(.25),Q6=ut(({dotNH:r})=>Oy.mul(k(.5)).add(1).mul(k(1/Math.PI)).mul(r.pow(Oy))),J6=ut(({lightDirection:r})=>{const t=r.add(dn).normalize(),e=Ie.dot(t).clamp(),n=dn.dot(t).clamp(),s=Ed({f0:vc,f90:1,dotVH:n}),i=Z6(),a=Q6({dotNH:e});return s.mul(i).mul(a)});class MB extends _B{constructor(t=!0){super(),this.specular=t}direct({lightDirection:t,lightColor:e,reflectedLight:n}){const i=Ie.dot(t).clamp().mul(e);n.directDiffuse.addAssign(i.mul(Pu({diffuseColor:sn.rgb}))),this.specular===!0&&n.directSpecular.addAssign(i.mul(J6({lightDirection:t})).mul(_p))}indirect(t){const{ambientOcclusion:e,irradiance:n,reflectedLight:s}=t.context;s.indirectDiffuse.addAssign(n.mul(Pu({diffuseColor:sn}))),s.indirectDiffuse.mulAssign(e)}}const tI=new U8;class eI extends ss{static get type(){return"MeshLambertNodeMaterial"}constructor(t){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(tI),this.setValues(t)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new YT(e):null}setupLightingModel(){return new MB(!1)}}const nI=new L8;class sI extends ss{static get type(){return"MeshPhongNodeMaterial"}constructor(t){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(nI),this.setValues(t)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new YT(e):null}setupLightingModel(){return new MB}setupVariants(){const t=(this.shininessNode?k(this.shininessNode):E4).max(1e-4);Oy.assign(t);const e=this.specularNode||B4;vc.assign(e)}copy(t){return this.shininessNode=t.shininessNode,this.specularNode=t.specularNode,super.copy(t)}}const vB=ut(r=>{if(r.geometry.hasAttribute("normal")===!1)return k(0);const t=Nd.dFdx().abs().max(Nd.dFdy().abs());return t.x.max(t.y).max(t.z)}),KT=ut(r=>{const{roughness:t}=r,e=vB();let n=t.max(.0525);return n=n.add(e),n=n.min(1),n}),AB=ut(({alpha:r,dotNL:t,dotNV:e})=>{const n=r.pow2(),s=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt()),i=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt());return vr(.5,s.add(i).max(aT))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),iI=ut(({alphaT:r,alphaB:t,dotTV:e,dotBV:n,dotTL:s,dotBL:i,dotNV:a,dotNL:c})=>{const u=c.mul(it(r.mul(e),t.mul(n),a).length()),d=a.mul(it(r.mul(s),t.mul(i),c).length());return vr(.5,u.add(d))}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),NB=ut(({alpha:r,dotNH:t})=>{const e=r.pow2(),n=t.pow2().mul(e.oneMinus()).oneMinus();return e.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),rI=k(1/Math.PI),oI=ut(({alphaT:r,alphaB:t,dotNH:e,dotTH:n,dotBH:s})=>{const i=r.mul(t),a=it(t.mul(n),r.mul(s),i.mul(e)),c=a.dot(a),u=i.div(c);return rI.mul(i.mul(u.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),ZT=ut(({lightDirection:r,f0:t,f90:e,roughness:n,f:s,normalView:i=Ie,USE_IRIDESCENCE:a,USE_ANISOTROPY:c})=>{const u=n.pow2(),d=r.add(dn).normalize(),f=i.dot(r).clamp(),p=i.dot(dn).clamp(),g=i.dot(d).clamp(),y=dn.dot(d).clamp();let x=Ed({f0:t,f90:e,dotVH:y}),S,T;if(Up(a)&&(x=px.mix(x,s)),Up(c)){const M=wp.dot(r),N=wp.dot(dn),v=wp.dot(d),A=Bu.dot(r),R=Bu.dot(dn),F=Bu.dot(d);S=iI({alphaT:Ly,alphaB:u,dotTV:N,dotBV:R,dotTL:M,dotBL:A,dotNV:p,dotNL:f}),T=oI({alphaT:Ly,alphaB:u,dotNH:g,dotTH:v,dotBH:F})}else S=AB({alpha:u,dotNL:f,dotNV:p}),T=NB({alpha:u,dotNH:g});return x.mul(S).mul(T)}),aI=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Go=null;const Ip=ut(({roughness:r,dotNV:t})=>{Go===null&&(Go=new sx(aI,16,16,jo,ni),Go.name="DFG_LUT",Go.minFilter=qs,Go.magFilter=qs,Go.wrapS=ji,Go.wrapT=ji,Go.generateMipmaps=!1,Go.needsUpdate=!0);const e=It(r,t);return He(Go,e).rg}),lI=ut(({lightDirection:r,f0:t,f90:e,roughness:n,f:s,USE_IRIDESCENCE:i,USE_ANISOTROPY:a})=>{const c=ZT({lightDirection:r,f0:t,f90:e,roughness:n,f:s,USE_IRIDESCENCE:i,USE_ANISOTROPY:a}),u=Ie.dot(r).clamp(),d=Ie.dot(dn).clamp(),f=Ip({roughness:n,dotNV:d}),p=Ip({roughness:n,dotNV:u}),g=t.mul(f.x).add(e.mul(f.y)),y=t.mul(p.x).add(e.mul(p.y)),x=f.x.add(f.y),S=p.x.add(p.y),T=k(1).sub(x),M=k(1).sub(S),N=t.add(t.oneMinus().mul(.047619)),v=g.mul(y).mul(N).div(k(1).sub(T.mul(M).mul(N).mul(N)).add(aT)),A=T.mul(M),R=v.mul(A);return c.add(R)}),RB=ut(r=>{const{dotNV:t,specularColor:e,specularF90:n,roughness:s}=r,i=Ip({dotNV:t,roughness:s});return e.mul(i.x).add(n.mul(i.y))}),ew=ut(({f:r,f90:t,dotVH:e})=>{const n=e.oneMinus().saturate(),s=n.mul(n),i=n.mul(s,s).clamp(0,.9999);return r.sub(it(t).mul(i)).div(i.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),cI=ut(({roughness:r,dotNH:t})=>{const e=r.pow2(),n=k(1).div(e),i=t.pow2().oneMinus().max(.0078125);return k(2).add(n).mul(i.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),uI=ut(({dotNV:r,dotNL:t})=>k(1).div(k(4).mul(t.add(r).sub(t.mul(r))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),hI=ut(({lightDirection:r})=>{const t=r.add(dn).normalize(),e=Ie.dot(r).clamp(),n=Ie.dot(dn).clamp(),s=Ie.dot(t).clamp(),i=cI({roughness:lc,dotNH:s}),a=uI({dotNV:n,dotNL:e});return yr.mul(i).mul(a)}),fR=ut(({N:r,V:t,roughness:e})=>{const i=.0078125,a=r.dot(t).saturate(),c=It(e,a.oneMinus().sqrt());return c.assign(c.mul(.984375).add(i)),c}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),dI=ut(({f:r})=>{const t=r.length();return qn(t.mul(t).add(r.z).div(t.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),jm=ut(({v1:r,v2:t})=>{const e=r.dot(t),n=e.abs().toVar(),s=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),i=n.add(4.1616724).mul(n).add(3.417594).toVar(),a=s.div(i),c=e.greaterThan(0).select(a,qn(e.mul(e).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return r.cross(t).mul(c)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),PS=ut(({N:r,V:t,P:e,mInv:n,p0:s,p1:i,p2:a,p3:c})=>{const u=i.sub(s).toVar(),d=c.sub(s).toVar(),f=u.cross(d),p=it().toVar();return re(f.dot(e.sub(s)).greaterThanEqual(0),()=>{const g=t.sub(r.mul(t.dot(r))).normalize(),y=r.cross(g).negate(),x=n.mul(Ws(g,y,r).transpose()).toVar(),S=x.mul(s.sub(e)).normalize().toVar(),T=x.mul(i.sub(e)).normalize().toVar(),M=x.mul(a.sub(e)).normalize().toVar(),N=x.mul(c.sub(e)).normalize().toVar(),v=it(0).toVar();v.addAssign(jm({v1:S,v2:T})),v.addAssign(jm({v1:T,v2:M})),v.addAssign(jm({v1:M,v2:N})),v.addAssign(jm({v1:N,v2:S})),p.assign(it(dI({f:v})))}),p}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Rx=1/6,EB=r=>fe(Rx,fe(r,fe(r,r.negate().add(3)).sub(3)).add(1)),nw=r=>fe(Rx,fe(r,fe(r,fe(3,r).sub(6))).add(4)),CB=r=>fe(Rx,fe(r,fe(r,fe(-3,r).add(3)).add(3)).add(1)),sw=r=>fe(Rx,$r(r,3)),pR=r=>EB(r).add(nw(r)),mR=r=>CB(r).add(sw(r)),gR=r=>xs(-1,nw(r).div(EB(r).add(nw(r)))),yR=r=>xs(1,sw(r).div(CB(r).add(sw(r)))),xR=(r,t,e)=>{const n=r.uvNode,s=fe(n,t.zw).add(.5),i=na(s),a=vo(s),c=pR(a.x),u=mR(a.x),d=gR(a.x),f=yR(a.x),p=gR(a.y),g=yR(a.y),y=It(i.x.add(d),i.y.add(p)).sub(.5).mul(t.xy),x=It(i.x.add(f),i.y.add(p)).sub(.5).mul(t.xy),S=It(i.x.add(d),i.y.add(g)).sub(.5).mul(t.xy),T=It(i.x.add(f),i.y.add(g)).sub(.5).mul(t.xy),M=pR(a.y).mul(xs(c.mul(r.sample(y).level(e)),u.mul(r.sample(x).level(e)))),N=mR(a.y).mul(xs(c.mul(r.sample(S).level(e)),u.mul(r.sample(T).level(e))));return M.add(N)},QT=ut(([r,t])=>{const e=It(r.size(J(t))),n=It(r.size(J(t.add(1)))),s=vr(1,e),i=vr(1,n),a=xR(r,se(s,e),na(t)),c=xR(r,se(i,n),yx(t));return vo(t).mix(a,c)}),fI=ut(([r,t])=>{const e=t.mul(ET(r));return QT(r,e)}),bR=ut(([r,t,e,n,s])=>{const i=it(wT(t.negate(),Qi(r),vr(1,n))),a=it(sa(s[0].xyz),sa(s[1].xyz),sa(s[2].xyz));return Qi(i).mul(e.mul(a))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),pI=ut(([r,t])=>r.mul(Ao(t.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),mI=kT(),gI=mB(),SR=ut(([r,t,e],{material:n})=>{const i=(n.side===us?mI:gI).sample(r),a=ea(Uu.x).mul(pI(t,e));return QT(i,a)}),wR=ut(([r,t,e])=>(re(e.notEqual(0),()=>{const n=gx(t).negate().div(e);return lT(n.negate().mul(r))}),it(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),yI=ut(([r,t,e,n,s,i,a,c,u,d,f,p,g,y,x])=>{let S,T;if(x){S=se().toVar(),T=it().toVar();const R=f.sub(1).mul(x.mul(.025)),F=it(f.sub(R),f,f.add(R));on({start:0,end:3},({i:D})=>{const O=F.element(D),B=bR(r,t,p,O,c),z=a.add(B),tt=d.mul(u.mul(se(z,1))),j=It(tt.xy.div(tt.w)).toVar();j.addAssign(1),j.divAssign(2),j.assign(It(j.x,j.y.oneMinus()));const dt=SR(j,e,O);S.element(D).assign(dt.element(D)),S.a.addAssign(dt.a),T.element(D).assign(n.element(D).mul(wR(sa(B),g,y).element(D)))}),S.a.divAssign(3)}else{const R=bR(r,t,p,f,c),F=a.add(R),D=d.mul(u.mul(se(F,1))),O=It(D.xy.div(D.w)).toVar();O.addAssign(1),O.divAssign(2),O.assign(It(O.x,O.y.oneMinus())),S=SR(O,e,f),T=n.mul(wR(sa(R),g,y))}const M=T.rgb.mul(S.rgb),N=r.dot(t).clamp(),v=it(RB({dotNV:N,specularColor:s,specularF90:i,roughness:e})),A=T.r.add(T.g,T.b).div(3);return se(v.oneMinus().mul(M),S.a.oneMinus().mul(A).oneMinus())}),xI=Ws(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),bI=r=>{const t=r.sqrt();return it(1).add(t).div(it(1).sub(t))},TR=(r,t)=>r.sub(t).div(r.add(t)).pow2(),SI=(r,t)=>{const e=r.mul(2*Math.PI*1e-9),n=it(54856e-17,44201e-17,52481e-17),s=it(1681e3,1795300,2208400),i=it(43278e5,93046e5,66121e5),a=k(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(e.mul(2239900).add(t.x).cos()).mul(e.pow2().mul(-45282e5).exp());let c=n.mul(i.mul(2*Math.PI).sqrt()).mul(s.mul(e).add(t).cos()).mul(e.pow2().negate().mul(i).exp());return c=it(c.x.add(a),c.y,c.z).div(10685e-11),xI.mul(c)},_R=ut(({outsideIOR:r,eta2:t,cosTheta1:e,thinFilmThickness:n,baseF0:s})=>{const i=Ce(r,t,No(0,.03,n)),c=r.div(i).pow2().mul(e.pow2().oneMinus()).oneMinus();re(c.lessThan(0),()=>it(1));const u=c.sqrt(),d=TR(i,r),f=Ed({f0:d,f90:1,dotVH:e}),p=f.oneMinus(),g=i.lessThan(r).select(Math.PI,0),y=k(Math.PI).sub(g),x=bI(s.clamp(0,.9999)),S=TR(x,i.toVec3()),T=Ed({f0:S,f90:1,dotVH:u}),M=it(x.x.lessThan(i).select(Math.PI,0),x.y.lessThan(i).select(Math.PI,0),x.z.lessThan(i).select(Math.PI,0)),N=i.mul(n,u,2),v=it(y).add(M),A=f.mul(T).clamp(1e-5,.9999),R=A.sqrt(),F=p.pow2().mul(T).div(it(1).sub(A)),O=f.add(F).toVar(),B=F.sub(p).toVar();return on({start:1,end:2,condition:"<=",name:"m"},({m:z})=>{B.mulAssign(R);const tt=SI(k(z).mul(N),k(z).mul(v)).mul(2);O.addAssign(B.mul(tt))}),O.max(it(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),Uf=ut(({normal:r,viewDir:t,roughness:e})=>{const n=r.dot(t).saturate(),s=e.mul(e),i=e.add(.1).reciprocal(),a=k(-1.9362).add(e.mul(1.0678)).add(s.mul(.4573)).sub(i.mul(.8469)),c=k(-.6014).add(e.mul(.5538)).sub(s.mul(.467)).sub(i.mul(.1255));return a.mul(n).add(c).exp().saturate()}),Pf=it(.04),Ym=k(1);class BB extends Nx{constructor(t=!1,e=!1,n=!1,s=!1,i=!1,a=!1){super(),this.clearcoat=t,this.sheen=e,this.iridescence=n,this.anisotropy=s,this.transmission=i,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null,this.iridescenceF0Dielectric=null,this.iridescenceF0Metallic=null}start(t){if(this.clearcoat===!0&&(this.clearcoatRadiance=it().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=it().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=it().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=it().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=it().toVar("sheenSpecularIndirect")),this.iridescence===!0){const e=Ie.dot(dn).clamp(),n=_R({outsideIOR:k(1),eta2:By,cosTheta1:e,thinFilmThickness:Dy,baseF0:vc}),s=_R({outsideIOR:k(1),eta2:By,cosTheta1:e,thinFilmThickness:Dy,baseF0:sn.rgb});this.iridescenceFresnel=Ce(n,s,Ja),this.iridescenceF0Dielectric=ew({f:n,f90:1,dotVH:e}),this.iridescenceF0Metallic=ew({f:s,f90:1,dotVH:e}),this.iridescenceF0=Ce(this.iridescenceF0Dielectric,this.iridescenceF0Metallic,Ja)}if(this.transmission===!0){const e=ra,n=e4.sub(ra).normalize(),s=Lc,i=t.context;i.backdrop=yI(s,n,Xo,wu,Au,Nu,e,Xr,so,rl,Tp,eT,sT,nT,this.dispersion?iT:null),i.backdropAlpha=Fy,sn.a.mulAssign(Ce(1,i.backdrop.a,Fy))}super.start(t)}computeMultiscattering(t,e,n,s,i=null){const a=Ie.dot(dn).clamp(),c=Ip({roughness:Xo,dotNV:a}),u=i?px.mix(s,i):s,d=u.mul(c.x).add(n.mul(c.y)),p=c.x.add(c.y).oneMinus(),g=u.add(u.oneMinus().mul(.047619)),y=d.mul(g).div(p.mul(g).oneMinus());t.addAssign(d),e.addAssign(y.mul(p))}direct({lightDirection:t,lightColor:e,reflectedLight:n}){const i=Ie.dot(t).clamp().mul(e).toVar();if(this.sheen===!0){this.sheenSpecularDirect.addAssign(i.mul(hI({lightDirection:t})));const a=Uf({normal:Ie,viewDir:dn,roughness:lc}),c=Uf({normal:Ie,viewDir:t,roughness:lc}),u=yr.r.max(yr.g).max(yr.b).mul(a.max(c)).oneMinus();i.mulAssign(u)}if(this.clearcoat===!0){const c=hc.dot(t).clamp().mul(e);this.clearcoatSpecularDirect.addAssign(c.mul(ZT({lightDirection:t,f0:Pf,f90:Ym,roughness:dd,normalView:hc})))}n.directDiffuse.addAssign(i.mul(Pu({diffuseColor:wu}))),n.directSpecular.addAssign(i.mul(lI({lightDirection:t,f0:Au,f90:1,roughness:Xo,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:t,lightPosition:e,halfWidth:n,halfHeight:s,reflectedLight:i,ltc_1:a,ltc_2:c}){const u=e.add(n).sub(s),d=e.sub(n).sub(s),f=e.sub(n).add(s),p=e.add(n).add(s),g=Ie,y=dn,x=cs.toVar(),S=fR({N:g,V:y,roughness:Xo}),T=a.sample(S).toVar(),M=c.sample(S).toVar(),N=Ws(it(T.x,0,T.y),it(0,1,0),it(T.z,0,T.w)).toVar(),v=Au.mul(M.x).add(Nu.sub(Au).mul(M.y)).toVar();if(i.directSpecular.addAssign(t.mul(v).mul(PS({N:g,V:y,P:x,mInv:N,p0:u,p1:d,p2:f,p3:p}))),i.directDiffuse.addAssign(t.mul(wu).mul(PS({N:g,V:y,P:x,mInv:Ws(1,0,0,0,1,0,0,0,1),p0:u,p1:d,p2:f,p3:p}))),this.clearcoat===!0){const A=hc,R=fR({N:A,V:y,roughness:dd}),F=a.sample(R),D=c.sample(R),O=Ws(it(F.x,0,F.y),it(0,1,0),it(F.z,0,F.w)),B=Pf.mul(D.x).add(Ym.sub(Pf).mul(D.y));this.clearcoatSpecularDirect.addAssign(t.mul(B).mul(PS({N:A,V:y,P:x,mInv:O,p0:u,p1:d,p2:f,p3:p})))}}indirect(t){this.indirectDiffuse(t),this.indirectSpecular(t),this.ambientOcclusion(t)}indirectDiffuse(t){const{irradiance:e,reflectedLight:n}=t.context,s=e.mul(Pu({diffuseColor:wu})).toVar();if(this.sheen===!0){const i=Uf({normal:Ie,viewDir:dn,roughness:lc}),a=yr.r.max(yr.g).max(yr.b).mul(i).oneMinus();s.mulAssign(a)}n.indirectDiffuse.addAssign(s)}indirectSpecular(t){const{radiance:e,iblIrradiance:n,reflectedLight:s}=t.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(yr,Uf({normal:Ie,viewDir:dn,roughness:lc}))),this.clearcoat===!0){const T=hc.dot(dn).clamp(),M=RB({dotNV:T,specularColor:Pf,specularF90:Ym,roughness:dd});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(M))}const i=it().toVar("singleScatteringDielectric"),a=it().toVar("multiScatteringDielectric"),c=it().toVar("singleScatteringMetallic"),u=it().toVar("multiScatteringMetallic");this.computeMultiscattering(i,a,Nu,vc,this.iridescenceF0Dielectric),this.computeMultiscattering(c,u,Nu,sn.rgb,this.iridescenceF0Metallic);const d=Ce(i,c,Ja),f=Ce(a,u,Ja),p=i.add(a),g=wu.mul(p.oneMinus()),y=n.mul(1/Math.PI),x=e.mul(d).add(f.mul(y)).toVar(),S=g.mul(y).toVar();if(this.sheen===!0){const T=Uf({normal:Ie,viewDir:dn,roughness:lc}),M=yr.r.max(yr.g).max(yr.b).mul(T).oneMinus();x.mulAssign(M),S.mulAssign(M)}s.indirectSpecular.addAssign(x),s.indirectDiffuse.addAssign(S)}ambientOcclusion(t){const{ambientOcclusion:e,reflectedLight:n}=t.context,i=Ie.dot(dn).clamp().add(e),a=Xo.mul(-16).oneMinus().negate().exp2(),c=e.sub(i.pow(a).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(e),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(e),n.indirectDiffuse.mulAssign(e),n.indirectSpecular.mulAssign(c)}finish({context:t}){const{outgoingLight:e}=t;if(this.clearcoat===!0){const n=hc.dot(dn).clamp(),s=Ed({dotVH:n,f0:Pf,f90:Ym}),i=e.mul(Cy.mul(s).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Cy));e.assign(i)}if(this.sheen===!0){const n=e.add(this.sheenSpecularDirect,this.sheenSpecularIndirect.mul(1/Math.PI));e.assign(n)}}}const MR=k(1),iw=k(-2),Km=k(.8),zS=k(-1),Zm=k(.4),IS=k(2),Qm=k(.305),VS=k(3),vR=k(.21),wI=k(4),AR=k(4),TI=k(16),_I=ut(([r])=>{const t=it(xn(r)).toVar(),e=k(-1).toVar();return re(t.x.greaterThan(t.z),()=>{re(t.x.greaterThan(t.y),()=>{e.assign(yi(r.x.greaterThan(0),0,3))}).Else(()=>{e.assign(yi(r.y.greaterThan(0),1,4))})}).Else(()=>{re(t.z.greaterThan(t.y),()=>{e.assign(yi(r.z.greaterThan(0),2,5))}).Else(()=>{e.assign(yi(r.y.greaterThan(0),1,4))})}),e}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),MI=ut(([r,t])=>{const e=It().toVar();return re(t.equal(0),()=>{e.assign(It(r.z,r.y).div(xn(r.x)))}).ElseIf(t.equal(1),()=>{e.assign(It(r.x.negate(),r.z.negate()).div(xn(r.y)))}).ElseIf(t.equal(2),()=>{e.assign(It(r.x.negate(),r.y).div(xn(r.z)))}).ElseIf(t.equal(3),()=>{e.assign(It(r.z.negate(),r.y).div(xn(r.x)))}).ElseIf(t.equal(4),()=>{e.assign(It(r.x.negate(),r.z).div(xn(r.y)))}).Else(()=>{e.assign(It(r.x,r.y).div(xn(r.z)))}),fe(.5,e.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),vI=ut(([r])=>{const t=k(0).toVar();return re(r.greaterThanEqual(Km),()=>{t.assign(MR.sub(r).mul(zS.sub(iw)).div(MR.sub(Km)).add(iw))}).ElseIf(r.greaterThanEqual(Zm),()=>{t.assign(Km.sub(r).mul(IS.sub(zS)).div(Km.sub(Zm)).add(zS))}).ElseIf(r.greaterThanEqual(Qm),()=>{t.assign(Zm.sub(r).mul(VS.sub(IS)).div(Zm.sub(Qm)).add(IS))}).ElseIf(r.greaterThanEqual(vR),()=>{t.assign(Qm.sub(r).mul(wI.sub(VS)).div(Qm.sub(vR)).add(VS))}).Else(()=>{t.assign(k(-2).mul(ea(fe(1.16,r))))}),t}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),DB=ut(([r,t])=>{const e=r.toVar();e.assign(fe(2,e).sub(1));const n=it(e,1).toVar();return re(t.equal(0),()=>{n.assign(n.zyx)}).ElseIf(t.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(t.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(t.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(t.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(t.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),LB=ut(([r,t,e,n,s,i])=>{const a=k(e),c=it(t),u=Ao(vI(a),iw,i),d=vo(u),f=na(u),p=it(Vp(r,c,f,n,s,i)).toVar();return re(d.notEqual(0),()=>{const g=it(Vp(r,c,f.add(1),n,s,i)).toVar();p.assign(Ce(p,g,d))}),p}),Vp=ut(([r,t,e,n,s,i])=>{const a=k(e).toVar(),c=it(t),u=k(_I(c)).toVar(),d=k(qn(AR.sub(a),0)).toVar();a.assign(qn(a,AR));const f=k(Md(a)).toVar(),p=It(MI(c,u).mul(f.sub(2)).add(1)).toVar();return re(u.greaterThan(2),()=>{p.y.addAssign(f),u.subAssign(3)}),p.x.addAssign(u.mul(f)),p.x.addAssign(d.mul(fe(3,TI))),p.y.addAssign(fe(4,Md(i).sub(f))),p.x.mulAssign(n),p.y.mulAssign(s),r.sample(p).grad(It(),It())}),GS=ut(({envMap:r,mipInt:t,outputDirection:e,theta:n,axis:s,CUBEUV_TEXEL_WIDTH:i,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:c})=>{const u=bo(n),d=e.mul(u).add(s.cross(e).mul(Ni(n))).add(s.mul(s.dot(e).mul(u.oneMinus())));return Vp(r,d,t,i,a,c)}),OB=ut(({n:r,latitudinal:t,poleAxis:e,outputDirection:n,weights:s,samples:i,dTheta:a,mipInt:c,envMap:u,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p})=>{const g=it(yi(t,e,ol(e,n))).toVar();re(g.equal(it(0)),()=>{g.assign(it(n.z,0,n.x.negate()))}),g.assign(Qi(g));const y=it().toVar();return y.addAssign(s.element(0).mul(GS({theta:0,axis:g,outputDirection:n,mipInt:c,envMap:u,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p}))),on({start:J(1),end:r},({i:x})=>{re(x.greaterThanEqual(i),()=>{dB()});const S=k(a.mul(k(x))).toVar();y.addAssign(s.element(x).mul(GS({theta:S.mul(-1),axis:g,outputDirection:n,mipInt:c,envMap:u,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p}))),y.addAssign(s.element(x).mul(GS({theta:S,axis:g,outputDirection:n,mipInt:c,envMap:u,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:p})))}),se(y,1)}),AI=ut(([r])=>{const t=Ut(r).toVar();return t.assign(t.shiftLeft(Ut(16)).bitOr(t.shiftRight(Ut(16)))),t.assign(t.bitAnd(Ut(1431655765)).shiftLeft(Ut(1)).bitOr(t.bitAnd(Ut(2863311530)).shiftRight(Ut(1)))),t.assign(t.bitAnd(Ut(858993459)).shiftLeft(Ut(2)).bitOr(t.bitAnd(Ut(3435973836)).shiftRight(Ut(2)))),t.assign(t.bitAnd(Ut(252645135)).shiftLeft(Ut(4)).bitOr(t.bitAnd(Ut(4042322160)).shiftRight(Ut(4)))),t.assign(t.bitAnd(Ut(16711935)).shiftLeft(Ut(8)).bitOr(t.bitAnd(Ut(4278255360)).shiftRight(Ut(8)))),k(t).mul(23283064365386963e-26)}),NI=ut(([r,t])=>It(k(r).div(k(t)),AI(r))),RI=ut(([r,t,e])=>{const n=e.mul(e).toConst(),s=it(1,0,0).toConst(),i=ol(t,s).toConst(),a=Di(r.x).toConst(),c=fe(2,3.14159265359).mul(r.y).toConst(),u=a.mul(bo(c)).toConst(),d=a.mul(Ni(c)).toVar(),f=fe(.5,t.z.add(1)).toConst();d.assign(f.oneMinus().mul(Di(u.mul(u).oneMinus())).add(f.mul(d)));const p=s.mul(u).add(i.mul(d)).add(t.mul(Di(qn(0,u.mul(u).add(d.mul(d)).oneMinus()))));return Qi(it(n.mul(p.x),n.mul(p.y),qn(0,p.z)))}),FB=ut(({roughness:r,mipInt:t,envMap:e,N_immutable:n,GGX_SAMPLES:s,CUBEUV_TEXEL_WIDTH:i,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:c})=>{const u=it(n).toVar(),d=it(0).toVar(),f=k(0).toVar();return re(r.lessThan(.001),()=>{d.assign(Vp(e,u,t,i,a,c))}).Else(()=>{const p=yi(xn(u.z).lessThan(.999),it(0,0,1),it(1,0,0)),g=Qi(ol(p,u)).toVar(),y=ol(u,g).toVar();on({start:Ut(0),end:s},({i:x})=>{const S=NI(x,s),T=RI(S,it(0,0,1),r),M=Qi(g.mul(T.x).add(y.mul(T.y)).add(u.mul(T.z))),N=Qi(M.mul(to(u,M).mul(2)).sub(u)),v=qn(to(u,N),0);re(v.greaterThan(0),()=>{const A=Vp(e,N,t,i,a,c);d.addAssign(A.mul(v)),f.addAssign(v)})}),re(f.greaterThan(0),()=>{d.assign(d.div(f))})}),se(d,1)}),pc=4,NR=[.125,.215,.35,.446,.526,.582],Tu=20,EI=512,zf=new kw(-1,1,1,-1,0,1),CI=new $i(90,1),RR=new qt;let kS=null,HS=0,WS=0;const BI=new G,Iy=new WeakMap,DI=[3,1,5,0,4,2],qS=DB(cn(),al("faceIndex")).normalize(),Ex=it(qS.x,qS.y,qS.z);class LI{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._ggxMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(t,e=0,n=.1,s=100,i={}){const{size:a=256,position:c=BI,renderTarget:u=null}=i;if(this._setSize(a),this._hasInitialized===!1){Wt('PMREMGenerator: ".fromScene()" called before the backend is initialized. Try using "await renderer.init()" instead.');const f=u||this._allocateTarget();return i.renderTarget=f,this.fromSceneAsync(t,e,n,s,i),f}kS=this._renderer.getRenderTarget(),HS=this._renderer.getActiveCubeFace(),WS=this._renderer.getActiveMipmapLevel();const d=u||this._allocateTarget();return d.depthBuffer=!0,this._init(d),this._sceneToCubeUV(t,n,s,d,c),e>0&&this._blur(d,0,0,e),this._applyPMREM(d),this._cleanup(d),d}async fromSceneAsync(t,e=0,n=.1,s=100,i={}){return rn('PMREMGenerator: ".fromSceneAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this.fromScene(t,e,n,s,i)}fromEquirectangular(t,e=null){if(this._hasInitialized===!1){Wt('PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using "await renderer.init()" instead.'),this._setSizeFromTexture(t);const n=e||this._allocateTarget();return this.fromEquirectangularAsync(t,n),n}return this._fromTexture(t,e)}async fromEquirectangularAsync(t,e=null){return rn('PMREMGenerator: ".fromEquirectangularAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(t,e)}fromCubemap(t,e=null){if(this._hasInitialized===!1){Wt("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(t);const n=e||this._allocateTarget();return this.fromCubemapAsync(t,e),n}return this._fromTexture(t,e)}async fromCubemapAsync(t,e=null){return rn('PMREMGenerator: ".fromCubemapAsync()" is deprecated. Use "await renderer.init()" instead.'),await this._renderer.init(),this._fromTexture(t,e)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=CR(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=BR(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(t){t.mapping===bd||t.mapping===Qg?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4)}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodMeshes.length;t++)this._lodMeshes[t].geometry.dispose()}_cleanup(t){this._renderer.setRenderTarget(kS,HS,WS),t.scissorTest=!1,Gh(t,0,0,t.width,t.height)}_fromTexture(t,e){this._setSizeFromTexture(t),kS=this._renderer.getRenderTarget(),HS=this._renderer.getActiveCubeFace(),WS=this._renderer.getActiveMipmapLevel();const n=e||this._allocateTarget();return this._init(n),this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTarget(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize;return ER(t,e)}_init(t){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t.width||this._pingPongRenderTarget.height!==t.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=ER(t.width,t.height);const{_lodMax:e}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=OI(e)),this._blurMaterial=FI(e,t.width,t.height),this._ggxMaterial=UI(e,t.width,t.height)}}async _compileMaterial(t){const e=new C(new Ye,t);await this._renderer.compile(e,zf)}_sceneToCubeUV(t,e,n,s,i){const a=CI;a.near=e,a.far=n;const c=[1,1,1,1,-1,1],u=[1,-1,1,-1,1,-1],d=this._renderer,f=d.autoClear;d.getClearColor(RR),d.autoClear=!1,this._backgroundBox===null&&(this._backgroundBox=new C(new Y,new $e({name:"PMREM.Background",side:us,depthWrite:!1,depthTest:!1})));const p=this._backgroundBox,g=p.material;let y=!1;const x=t.background;x?x.isColor&&(g.color.copy(x),t.background=null,y=!0):(g.color.copy(RR),y=!0),d.setRenderTarget(s),d.clear(),y&&d.render(p,a);for(let S=0;S<6;S++){const T=S%3;T===0?(a.up.set(0,c[S],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x+u[S],i.y,i.z)):T===1?(a.up.set(0,0,c[S]),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y+u[S],i.z)):(a.up.set(0,c[S],0),a.position.set(i.x,i.y,i.z),a.lookAt(i.x,i.y,i.z+u[S]));const M=this._cubeSize;Gh(s,T*M,S>2?M:0,M,M),d.render(t,a)}d.autoClear=f,t.background=x}_textureToCubeUV(t,e){const n=this._renderer,s=t.mapping===bd||t.mapping===Qg;s?this._cubemapMaterial===null&&(this._cubemapMaterial=CR(t)):this._equirectMaterial===null&&(this._equirectMaterial=BR(t));const i=s?this._cubemapMaterial:this._equirectMaterial;i.fragmentNode.value=t;const a=this._lodMeshes[0];a.material=i;const c=this._cubeSize;Gh(e,0,0,3*c,2*c),n.setRenderTarget(e),n.render(a,zf)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;const s=this._lodMeshes.length;for(let i=1;i<s;i++)this._applyGGXFilter(t,i-1,i);e.autoClear=n}_applyGGXFilter(t,e,n){const s=this._renderer,i=this._pingPongRenderTarget,a=this._ggxMaterial,c=this._lodMeshes[n];c.material=a;const u=Iy.get(a),d=n/(this._lodMeshes.length-1),f=e/(this._lodMeshes.length-1),p=Math.sqrt(d*d-f*f),g=0+d*1.25,y=p*g,{_lodMax:x}=this,S=this._sizeLods[n],T=3*S*(n>x-pc?n-x+pc:0),M=4*(this._cubeSize-S);t.texture.frame=(t.texture.frame||0)+1,u.envMap.value=t.texture,u.roughness.value=y,u.mipInt.value=x-e,Gh(i,T,M,3*S,2*S),s.setRenderTarget(i),s.render(c,zf),i.texture.frame=(i.texture.frame||0)+1,u.envMap.value=i.texture,u.roughness.value=0,u.mipInt.value=x-n,Gh(t,T,M,3*S,2*S),s.setRenderTarget(t),s.render(c,zf)}_blur(t,e,n,s,i){const a=this._pingPongRenderTarget;this._halfBlur(t,a,e,n,s,"latitudinal",i),this._halfBlur(a,t,n,n,s,"longitudinal",i)}_halfBlur(t,e,n,s,i,a,c){const u=this._renderer,d=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&Ht("blur direction must be either latitudinal or longitudinal!");const f=3,p=this._lodMeshes[s];p.material=d;const g=Iy.get(d),y=this._sizeLods[n]-1,x=isFinite(i)?Math.PI/(2*y):2*Math.PI/(2*Tu-1),S=i/x,T=isFinite(i)?1+Math.floor(f*S):Tu;T>Tu&&Wt(`sigmaRadians, ${i}, is too large and will clip, as it requested ${T} samples when the maximum is set to ${Tu}`);const M=[];let N=0;for(let D=0;D<Tu;++D){const O=D/S,B=Math.exp(-O*O/2);M.push(B),D===0?N+=B:D<T&&(N+=2*B)}for(let D=0;D<M.length;D++)M[D]=M[D]/N;t.texture.frame=(t.texture.frame||0)+1,g.envMap.value=t.texture,g.samples.value=T,g.weights.array=M,g.latitudinal.value=a==="latitudinal"?1:0,c&&(g.poleAxis.value=c);const{_lodMax:v}=this;g.dTheta.value=x,g.mipInt.value=v-n;const A=this._sizeLods[s],R=3*A*(s>v-pc?s-v+pc:0),F=4*(this._cubeSize-A);Gh(e,R,F,3*A,2*A),u.setRenderTarget(e),u.render(p,zf)}}function OI(r){const t=[],e=[],n=[];let s=r;const i=r-pc+1+NR.length;for(let a=0;a<i;a++){const c=Math.pow(2,s);t.push(c);let u=1/c;a>r-pc?u=NR[a-r+pc-1]:a===0&&(u=0),e.push(u);const d=1/(c-2),f=-d,p=1+d,g=[f,f,p,f,p,p,f,f,p,p,f,p],y=6,x=6,S=3,T=2,M=1,N=new Float32Array(S*x*y),v=new Float32Array(T*x*y),A=new Float32Array(M*x*y);for(let F=0;F<y;F++){const D=F%3*2/3-1,O=F>2?0:-1,B=[D,O,0,D+2/3,O,0,D+2/3,O+1,0,D,O,0,D+2/3,O+1,0,D,O+1,0],z=DI[F];N.set(B,S*x*z),v.set(g,T*x*z);const tt=[z,z,z,z,z,z];A.set(tt,M*x*z)}const R=new Ye;R.setAttribute("position",new hs(N,S)),R.setAttribute("uv",new hs(v,T)),R.setAttribute("faceIndex",new hs(A,M)),n.push(new C(R,null)),s>pc&&s--}return{lodMeshes:n,sizeLods:t,sigmas:e}}function ER(r,t){const e={magFilter:qs,minFilter:qs,generateMipmaps:!1,type:ni,format:Yi,colorSpace:_y},n=new cl(r,t,e);return n.texture.mapping=R2,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function Gh(r,t,e,n,s){r.viewport.set(t,e,n,s),r.scissor.set(t,e,n,s)}function Cx(r){const t=new ss;return t.depthTest=!1,t.depthWrite=!1,t.blending=tl,t.name=`PMREM_${r}`,t}function FI(r,t,e){const n=mi(new Array(Tu).fill(0)),s=Jt(new G(0,1,0)),i=Jt(0),a=k(Tu),c=Jt(0),u=Jt(1),d=He(),f=Jt(0),p=k(1/t),g=k(1/e),y=k(r),x={n:a,latitudinal:c,weights:n,poleAxis:s,outputDirection:Ex,dTheta:i,samples:u,envMap:d,mipInt:f,CUBEUV_TEXEL_WIDTH:p,CUBEUV_TEXEL_HEIGHT:g,CUBEUV_MAX_MIP:y},S=Cx("blur");return S.fragmentNode=OB({...x,latitudinal:c.equal(1)}),Iy.set(S,x),S}function UI(r,t,e){const n=He(),s=Jt(0),i=Jt(0),a=k(1/t),c=k(1/e),u=k(r),d={envMap:n,roughness:s,mipInt:i,CUBEUV_TEXEL_WIDTH:a,CUBEUV_TEXEL_HEIGHT:c,CUBEUV_MAX_MIP:u},f=Cx("ggx");return f.fragmentNode=FB({...d,N_immutable:Ex,GGX_SAMPLES:Ut(EI)}),Iy.set(f,d),f}function CR(r){const t=Cx("cubemap");return t.fragmentNode=Ci(r,Ex),t}function BR(r){const t=Cx("equirect");return t.fragmentNode=He(r,jT(Ex),0),t}const DR=new WeakMap;function PI(r){const t=Math.log2(r)-2,e=1/r;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:e,maxMip:t}}function zI(r,t,e){const n=II(t);let s=n.get(r);if((s!==void 0?s.pmremVersion:-1)!==r.pmremVersion){const a=r.image;if(r.isCubeTexture)if(GI(a))s=e.fromCubemap(r,s);else return null;else if(kI(a))s=e.fromEquirectangular(r,s);else return null;s.pmremVersion=r.pmremVersion,n.set(r,s)}return s.texture}function II(r){let t=DR.get(r);return t===void 0&&(t=new WeakMap,DR.set(r,t)),t}class VI extends is{static get type(){return"PMREMNode"}constructor(t,e=null,n=null){super("vec3"),this._value=t,this._pmrem=null,this.uvNode=e,this.levelNode=n,this._generator=null;const s=new ns;s.isRenderTargetTexture=!0,this._texture=He(s),this._width=Jt(0),this._height=Jt(0),this._maxMip=Jt(0),this.updateBeforeType=de.RENDER}set value(t){this._value=t,this._pmrem=null}get value(){return this._value}updateFromTexture(t){const e=PI(t.image.height);this._texture.value=t,this._width.value=e.texelWidth,this._height.value=e.texelHeight,this._maxMip.value=e.maxMip}updateBefore(t){let e=this._pmrem;const n=e?e.pmremVersion:-1,s=this._value;n!==s.pmremVersion&&(s.isPMREMTexture===!0?e=s:e=zI(s,t.renderer,this._generator),e!==null&&(this._pmrem=e,this.updateFromTexture(e)))}setup(t){this._generator===null&&(this._generator=new LI(t.renderer)),this.updateBefore(t);let e=this.uvNode;e===null&&t.context.getUV&&(e=t.context.getUV(this,t)),e=PT.mul(it(e.x,e.y.negate(),e.z));let n=this.levelNode;return n===null&&t.context.getTextureLevel&&(n=t.context.getTextureLevel(this)),LB(this._texture,e,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function GI(r){if(r==null)return!1;let t=0;const e=6;for(let n=0;n<e;n++)r[n]!==void 0&&t++;return t===e}function kI(r){return r==null?!1:r.height>0}const JT=xe(VI).setParameterLength(1,3),LR=new WeakMap;class HI extends Ld{static get type(){return"EnvironmentNode"}constructor(t=null){super(),this.envNode=t}setup(t){const{material:e}=t;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const p=n.isTextureNode?n.value:e[n.property],g=this._getPMREMNodeCache(t.renderer);let y=g.get(p);y===void 0&&(y=JT(p),g.set(p,y)),n=y}const i=e.useAnisotropy===!0||e.anisotropy>0?v4:Ie,a=n.context(OR(Xo,i)).mul(Ig),c=n.context(WI(Lc)).mul(Math.PI).mul(Ig),u=pd(a),d=pd(c);t.context.radiance.addAssign(u),t.context.iblIrradiance.addAssign(d);const f=t.context.lightingModel.clearcoatRadiance;if(f){const p=n.context(OR(dd,hc)).mul(Ig),g=pd(p);f.addAssign(g)}}_getPMREMNodeCache(t){let e=LR.get(t);return e===void 0&&(e=new WeakMap,LR.set(t,e)),e}}const OR=(r,t)=>{let e=null;return{getUV:()=>(e===null&&(e=dn.negate().reflect(t),e=bT(r).mix(e,t).normalize(),e=e.transformDirection(so)),e),getTextureLevel:()=>r}},WI=r=>({getUV:()=>r,getTextureLevel:()=>k(1)}),qI=new gt;class $s extends ss{static get type(){return"MeshStandardNodeMaterial"}constructor(t){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(qI),this.setValues(t)}setupEnvironment(t){let e=super.setupEnvironment(t);return e===null&&t.environmentNode&&(e=t.environmentNode),e?new HI(e):null}setupLightingModel(){return new BB}setupSpecular(){const t=Ce(it(.04),sn.rgb,Ja);vc.assign(it(.04)),Au.assign(t),Nu.assign(1)}setupVariants(){const t=this.metalnessNode?k(this.metalnessNode):O4;Ja.assign(t);let e=this.roughnessNode?k(this.roughnessNode):L4;e=KT({roughness:e}),Xo.assign(e),this.setupSpecular(),wu.assign(sn.rgb.mul(t.oneMinus()))}copy(t){return this.emissiveNode=t.emissiveNode,this.metalnessNode=t.metalnessNode,this.roughnessNode=t.roughnessNode,super.copy(t)}}const $I=new Ry;class XI extends $s{static get type(){return"MeshPhysicalNodeMaterial"}constructor(t){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues($I),this.setValues(t)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const t=this.iorNode?k(this.iorNode):j4;Tp.assign(t),vc.assign(er(xT(Tp.sub(1).div(Tp.add(1))).mul(D4),it(1)).mul(tw)),Au.assign(Ce(vc,sn.rgb,Ja)),Nu.assign(Ce(tw,1,Ja))}setupLightingModel(){return new BB(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(t){if(super.setupVariants(t),this.useClearcoat){const e=this.clearcoatNode?k(this.clearcoatNode):U4,n=this.clearcoatRoughnessNode?k(this.clearcoatRoughnessNode):P4;Cy.assign(e),dd.assign(KT({roughness:n}))}if(this.useSheen){const e=this.sheenNode?it(this.sheenNode):V4,n=this.sheenRoughnessNode?k(this.sheenRoughnessNode):G4;yr.assign(e),lc.assign(n)}if(this.useIridescence){const e=this.iridescenceNode?k(this.iridescenceNode):H4,n=this.iridescenceIORNode?k(this.iridescenceIORNode):W4,s=this.iridescenceThicknessNode?k(this.iridescenceThicknessNode):q4;px.assign(e),By.assign(n),Dy.assign(s)}if(this.useAnisotropy){const e=(this.anisotropyNode?It(this.anisotropyNode):k4).toVar();oc.assign(e.length()),re(oc.equal(0),()=>{e.assign(It(1,0))}).Else(()=>{e.divAssign(It(oc)),oc.assign(oc.saturate())}),Ly.assign(oc.pow2().mix(Xo.pow2(),1)),wp.assign(Ru[0].mul(e.x).add(Ru[1].mul(e.y))),Bu.assign(Ru[1].mul(e.x).sub(Ru[0].mul(e.y)))}if(this.useTransmission){const e=this.transmissionNode?k(this.transmissionNode):$4,n=this.thicknessNode?k(this.thicknessNode):X4,s=this.attenuationDistanceNode?k(this.attenuationDistanceNode):Y4,i=this.attenuationColorNode?it(this.attenuationColorNode):K4;if(Fy.assign(e),eT.assign(n),nT.assign(s),sT.assign(i),this.useDispersion){const a=this.dispersionNode?k(this.dispersionNode):nB;iT.assign(a)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?it(this.clearcoatNormalNode):z4}setup(t){t.context.setupClearcoatNormal=()=>Du(this.setupClearcoatNormal(t),"NORMAL","vec3"),super.setup(t)}copy(t){return this.clearcoatNode=t.clearcoatNode,this.clearcoatRoughnessNode=t.clearcoatRoughnessNode,this.clearcoatNormalNode=t.clearcoatNormalNode,this.sheenNode=t.sheenNode,this.sheenRoughnessNode=t.sheenRoughnessNode,this.iridescenceNode=t.iridescenceNode,this.iridescenceIORNode=t.iridescenceIORNode,this.iridescenceThicknessNode=t.iridescenceThicknessNode,this.specularIntensityNode=t.specularIntensityNode,this.specularColorNode=t.specularColorNode,this.iorNode=t.iorNode,this.transmissionNode=t.transmissionNode,this.thicknessNode=t.thicknessNode,this.attenuationDistanceNode=t.attenuationDistanceNode,this.attenuationColorNode=t.attenuationColorNode,this.dispersionNode=t.dispersionNode,this.anisotropyNode=t.anisotropyNode,super.copy(t)}}const jI=ut(({normal:r,lightDirection:t,builder:e})=>{const n=r.dot(t),s=It(n.mul(.5).add(.5),0);if(e.material.gradientMap){const i=Ka("gradientMap","texture").context({getUV:()=>s});return it(i.r)}else{const i=s.fwidth().mul(.5);return Ce(it(.7),it(1),No(k(.7).sub(i.x),k(.7).add(i.x),s.x))}});class YI extends Nx{direct({lightDirection:t,lightColor:e,reflectedLight:n},s){const i=jI({normal:wx,lightDirection:t,builder:s}).mul(e);n.directDiffuse.addAssign(i.mul(Pu({diffuseColor:sn.rgb})))}indirect(t){const{ambientOcclusion:e,irradiance:n,reflectedLight:s}=t.context;s.indirectDiffuse.addAssign(n.mul(Pu({diffuseColor:sn}))),s.indirectDiffuse.mulAssign(e)}}const KI=new O8;class ZI extends ss{static get type(){return"MeshToonNodeMaterial"}constructor(t){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(KI),this.setValues(t)}setupLightingModel(){return new YI}}const UB=ut(()=>{const r=it(dn.z,0,dn.x.negate()).normalize(),t=dn.cross(r);return It(r.dot(Ie),t.dot(Ie)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),QI=new P8;class JI extends ss{static get type(){return"MeshMatcapNodeMaterial"}constructor(t){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(QI),this.setValues(t)}setupVariants(t){const e=UB;let n;t.material.matcap?n=Ka("matcap","texture").context({getUV:()=>e}):n=it(Ce(.2,.8,e.y)),sn.rgb.mulAssign(n.rgb)}}class tV extends is{static get type(){return"RotateNode"}constructor(t,e){super(),this.positionNode=t,this.rotationNode=e}getNodeType(t){return this.positionNode.getNodeType(t)}setup(t){const{rotationNode:e,positionNode:n}=this;if(this.getNodeType(t)==="vec2"){const i=e.cos(),a=e.sin();return fx(i,a,a.negate(),i).mul(n)}else{const i=e,a=Sc(se(1,0,0,0),se(0,bo(i.x),Ni(i.x).negate(),0),se(0,Ni(i.x),bo(i.x),0),se(0,0,0,1)),c=Sc(se(bo(i.y),0,Ni(i.y),0),se(0,1,0,0),se(Ni(i.y).negate(),0,bo(i.y),0),se(0,0,0,1)),u=Sc(se(bo(i.z),Ni(i.z).negate(),0,0),se(Ni(i.z),bo(i.z),0,0),se(0,0,1,0),se(0,0,0,1));return a.mul(c).mul(u).mul(se(n,1)).xyz}}}const Kp=xe(tV).setParameterLength(2),eV=new XU;class PB extends ss{static get type(){return"SpriteNodeMaterial"}constructor(t){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(eV),this.setValues(t)}setupPositionView(t){const{object:e,camera:n}=t,{positionNode:s,rotationNode:i,scaleNode:a,sizeAttenuation:c}=this,u=Dc.mul(it(s||0));let d=It(Xr[0].xyz.length(),Xr[1].xyz.length());a!==null&&(d=d.mul(It(a))),n.isPerspectiveCamera&&c===!1&&(d=d.mul(u.z.negate()));let f=Yp.xy;if(e.center&&e.center.isVector2===!0){const y=QP("center","vec2",e);f=f.sub(y.sub(.5))}f=f.mul(d);const p=k(i||I4),g=Kp(f,p);return se(u.xy.add(g),u.zw)}copy(t){return this.positionNode=t.positionNode,this.rotationNode=t.rotationNode,this.scaleNode=t.scaleNode,super.copy(t)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(t){this._useSizeAttenuation!==t&&(this._useSizeAttenuation=t,this.needsUpdate=!0)}}const nV=new tr,sV=new Ot;class iV extends PB{static get type(){return"PointsNodeMaterial"}constructor(t){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(nV),this.setValues(t)}setupPositionView(){const{positionNode:t}=this;return Dc.mul(it(t||kn)).xyz}setupVertexSprite(t){const{material:e,camera:n}=t,{rotationNode:s,scaleNode:i,sizeNode:a,sizeAttenuation:c}=this;let u=super.setupVertex(t);if(e.isNodeMaterial!==!0)return u;let d=a!==null?It(a):eB;d=d.mul(Q5),n.isPerspectiveCamera&&c===!0&&(d=d.mul(rV.div(cs.z.negate()))),i&&i.isNode&&(d=d.mul(It(i)));let f=Yp.xy;if(s&&s.isNode){const p=k(s);f=Kp(f,p)}return f=f.mul(d),f=f.div(LT.div(2)),f=f.mul(u.w),u=u.add(se(f,0,0)),u}setupVertex(t){return t.object.isPoints?super.setupVertex(t):this.setupVertexSprite(t)}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(t){this._useAlphaToCoverage!==t&&(this._useAlphaToCoverage=t,this.needsUpdate=!0)}}const rV=Jt(1).onFrameUpdate(function({renderer:r}){const t=r.getSize(sV);this.value=.5*t.y});class oV extends Nx{constructor(){super(),this.shadowNode=k(1).toVar("shadowMask")}direct({lightNode:t}){t.shadowNode!==null&&this.shadowNode.mulAssign(t.shadowNode)}finish({context:t}){sn.a.mulAssign(this.shadowNode.oneMinus()),t.outgoingLight.rgb.assign(sn.rgb)}}const aV=new D8;class lV extends ss{static get type(){return"ShadowNodeMaterial"}constructor(t){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(aV),this.setValues(t)}setupLightingModel(){return new oV}}il("vec3");il("vec3");il("vec3");class cV{constructor(t,e,n){this.renderer=t,this.nodes=e,this.info=n,this._context=typeof self<"u"?self:null,this._animationLoop=null,this._requestId=null}start(){const t=(e,n)=>{this._requestId=this._context.requestAnimationFrame(t),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this.renderer._inspector.begin(),this._animationLoop!==null&&this._animationLoop(e,n),this.renderer._inspector.finish()};t()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(t){this._animationLoop=t}getContext(){return this._context}setContext(t){this._context=t}dispose(){this.stop()}}class Nc{constructor(){this.weakMaps={}}_getWeakMap(t){const e=t.length;let n=this.weakMaps[e];return n===void 0&&(n=new WeakMap,this.weakMaps[e]=n),n}get(t){let e=this._getWeakMap(t);for(let n=0;n<t.length-1;n++)if(e=e.get(t[n]),e===void 0)return;return e.get(t[t.length-1])}set(t,e){let n=this._getWeakMap(t);for(let s=0;s<t.length-1;s++){const i=t[s];n.has(i)===!1&&n.set(i,new WeakMap),n=n.get(i)}return n.set(t[t.length-1],e),this}delete(t){let e=this._getWeakMap(t);for(let n=0;n<t.length-1;n++)if(e=e.get(t[n]),e===void 0)return!1;return e.delete(t[t.length-1])}}let uV=0;function hV(r){const t=Object.keys(r);let e=Object.getPrototypeOf(r);for(;e;){const n=Object.getOwnPropertyDescriptors(e);for(const s in n)if(n[s]!==void 0){const i=n[s];i&&typeof i.get=="function"&&t.push(s)}e=Object.getPrototypeOf(e)}return t}class dV{constructor(t,e,n,s,i,a,c,u,d,f){this.id=uV++,this._nodes=t,this._geometries=e,this.renderer=n,this.object=s,this.material=i,this.scene=a,this.camera=c,this.lightsNode=u,this.context=d,this.geometry=s.geometry,this.version=i.version,this.drawRange=null,this.attributes=null,this.attributesId=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=f,this.clippingContextCacheKey=f!==null?f.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.onGeometryDispose=()=>{this.attributes=null,this.attributesId=null},this.material.addEventListener("dispose",this.onMaterialDispose),this.geometry.addEventListener("dispose",this.onGeometryDispose)}updateClipping(t){this.clippingContext=t}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(t){for(const e of this.getBindings())if(e.name===t)return e}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getIndirectOffset(){return this._geometries.getIndirectOffset(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(t){this.geometry=t,this.attributes=null,this.attributesId=null}getAttributes(){if(this.attributes!==null)return this.attributes;const t=this.getNodeBuilderState().nodeAttributes,e=this.geometry,n=[],s=new Set,i={};for(const a of t){let c;if(a.node&&a.node.attribute?c=a.node.attribute:(c=e.getAttribute(a.name),i[a.name]=c.id),c===void 0)continue;n.push(c);const u=c.isInterleavedBufferAttribute?c.data:c;s.add(u)}return this.attributes=n,this.attributesId=i,this.vertexBuffers=Array.from(s.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:t,material:e,geometry:n,group:s,drawRange:i}=this,a=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),c=this.getIndex(),u=c!==null;let d=1;if(n.isInstancedBufferGeometry===!0?d=n.instanceCount:t.count!==void 0&&(d=Math.max(0,t.count)),d===0)return null;if(a.instanceCount=d,t.isBatchedMesh===!0)return a;let f=1;e.wireframe===!0&&!t.isPoints&&!t.isLineSegments&&!t.isLine&&!t.isLineLoop&&(f=2);let p=i.start*f,g=(i.start+i.count)*f;s!==null&&(p=Math.max(p,s.start*f),g=Math.min(g,(s.start+s.count)*f));const y=n.attributes.position;let x=1/0;u?x=c.count:y!=null&&(x=y.count),p=Math.max(p,0),g=Math.min(g,x);const S=g-p;return S<0||S===1/0?null:(a.vertexCount=S,a.firstVertex=p,a)}getGeometryCacheKey(){const{geometry:t}=this;let e="";for(const n of Object.keys(t.attributes).sort()){const s=t.attributes[n];e+=n+",",s.data&&(e+=s.data.stride+","),s.offset&&(e+=s.offset+","),s.itemSize&&(e+=s.itemSize+","),s.normalized&&(e+="n,")}for(const n of Object.keys(t.morphAttributes).sort()){const s=t.morphAttributes[n];e+="morph-"+n+",";for(let i=0,a=s.length;i<a;i++){const c=s[i];e+=c.id+","}}return t.index&&(e+="index,"),e}getMaterialCacheKey(){const{object:t,material:e,renderer:n}=this;let s=e.customProgramCacheKey();for(const i of hV(e)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(i))continue;const a=e[i];let c;if(a!==null){const u=typeof a;u==="number"?c=a!==0?"1":"0":u==="object"?(c="{",a.isTexture&&(c+=a.mapping,n.backend.isWebGPUBackend===!0&&(c+=a.magFilter,c+=a.minFilter,c+=a.wrapS,c+=a.wrapT,c+=a.wrapR)),c+="}"):c=String(a)}else c=String(a);s+=c+","}return s+=this.clippingContextCacheKey+",",t.geometry&&(s+=this.getGeometryCacheKey()),t.skeleton&&(s+=t.skeleton.bones.length+","),t.isBatchedMesh&&(s+=t._matricesTexture.uuid+",",t._colorsTexture!==null&&(s+=t._colorsTexture.uuid+",")),(t.isInstancedMesh||t.count>1||Array.isArray(t.morphTargetInfluences))&&(s+=t.uuid+","),s+=this.context.id+",",s+=t.receiveShadow+",",Bd(s)}get needsGeometryUpdate(){if(this.geometry.id!==this.object.geometry.id)return!0;if(this.attributes!==null){const t=this.attributesId;for(const e in t){const n=this.geometry.getAttribute(e);if(n===void 0||t[e]!==n.id)return!0}}return!1}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let t=0;return this.material.isShadowPassMaterial!==!0&&(t=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(t=bp(t,this.camera.cameras.length)),this.object.receiveShadow&&(t=bp(t,1)),t=bp(t,this.renderer.contextNode.id,this.renderer.contextNode.version),t}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.geometry.removeEventListener("dispose",this.onGeometryDispose),this.onDispose()}}const ko=[];class fV{constructor(t,e,n,s,i,a){this.renderer=t,this.nodes=e,this.geometries=n,this.pipelines=s,this.bindings=i,this.info=a,this.chainMaps={}}get(t,e,n,s,i,a,c,u){const d=this.getChainMap(u);ko[0]=t,ko[1]=e,ko[2]=a,ko[3]=i;let f=d.get(ko);return f===void 0?(f=this.createRenderObject(this.nodes,this.geometries,this.renderer,t,e,n,s,i,a,c,u),d.set(ko,f)):(f.camera=s,f.updateClipping(c),f.needsGeometryUpdate&&f.setGeometry(t.geometry),(f.version!==e.version||f.needsUpdate)&&(f.initialCacheKey!==f.getCacheKey()?(f.dispose(),f=this.get(t,e,n,s,i,a,c,u)):f.version=e.version)),ko[0]=null,ko[1]=null,ko[2]=null,ko[3]=null,f}getChainMap(t="default"){return this.chainMaps[t]||(this.chainMaps[t]=new Nc)}dispose(){this.chainMaps={}}createRenderObject(t,e,n,s,i,a,c,u,d,f,p){const g=this.getChainMap(p),y=new dV(t,e,n,s,i,a,c,u,d,f);return y.onDispose=()=>{this.pipelines.delete(y),this.bindings.deleteForRender(y),this.nodes.delete(y),g.delete(y.getChainArray())},y}}class Oc{constructor(){this.data=new WeakMap}get(t){let e=this.data.get(t);return e===void 0&&(e={},this.data.set(t,e)),e}delete(t){let e=null;return this.data.has(t)&&(e=this.data.get(t),this.data.delete(t)),e}has(t){return this.data.has(t)}dispose(){this.data=new WeakMap}}const jr={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},dc=16,pV=211,mV=212;class gV extends Oc{constructor(t){super(),this.backend=t}delete(t){const e=super.delete(t);return e!==null&&this.backend.destroyAttribute(t),e}update(t,e){const n=this.get(t);if(n.version===void 0)e===jr.VERTEX?this.backend.createAttribute(t):e===jr.INDEX?this.backend.createIndexAttribute(t):e===jr.STORAGE?this.backend.createStorageAttribute(t):e===jr.INDIRECT&&this.backend.createIndirectStorageAttribute(t),n.version=this._getBufferAttribute(t).version;else{const s=this._getBufferAttribute(t);(n.version<s.version||s.usage===Dp)&&(this.backend.updateAttribute(t),n.version=s.version)}}_getBufferAttribute(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}function zB(r){return r.index!==null?r.index.version:r.attributes.position.version}function IB(r){return r.index!==null?r.index.id:r.attributes.position.id}function FR(r){const t=[],e=r.index,n=r.attributes.position;if(e!==null){const i=e.array;for(let a=0,c=i.length;a<c;a+=3){const u=i[a+0],d=i[a+1],f=i[a+2];t.push(u,d,d,f,f,u)}}else{const i=n.array;for(let a=0,c=i.length/3-1;a<c;a+=3){const u=a+0,d=a+1,f=a+2;t.push(u,d,d,f,f,u)}}const s=new(n.count>=65535?J3:Q3)(t,1);return s.version=zB(r),s.__id=IB(r),s}class yV extends Oc{constructor(t,e){super(),this.attributes=t,this.info=e,this.wireframes=new WeakMap,this.attributeCall=new WeakMap,this._geometryDisposeListeners=new Map}has(t){const e=t.geometry;return super.has(e)&&this.get(e).initialized===!0}updateForRender(t){this.has(t)===!1&&this.initGeometry(t),this.updateAttributes(t)}initGeometry(t){const e=t.geometry,n=this.get(e);n.initialized=!0,this.info.memory.geometries++;const s=()=>{this.info.memory.geometries--;const i=e.index,a=t.getAttributes();i!==null&&this.attributes.delete(i);for(const u of a)this.attributes.delete(u);const c=this.wireframes.get(e);c!==void 0&&this.attributes.delete(c),e.removeEventListener("dispose",s),this._geometryDisposeListeners.delete(e)};e.addEventListener("dispose",s),this._geometryDisposeListeners.set(e,s)}updateAttributes(t){const e=t.getAttributes();for(const i of e)i.isStorageBufferAttribute||i.isStorageInstancedBufferAttribute?this.updateAttribute(i,jr.STORAGE):this.updateAttribute(i,jr.VERTEX);const n=this.getIndex(t);n!==null&&this.updateAttribute(n,jr.INDEX);const s=t.geometry.indirect;s!==null&&this.updateAttribute(s,jr.INDIRECT)}updateAttribute(t,e){const n=this.info.render.calls;t.isInterleavedBufferAttribute?this.attributeCall.get(t)===void 0?(this.attributes.update(t,e),this.attributeCall.set(t,n)):this.attributeCall.get(t.data)!==n&&(this.attributes.update(t,e),this.attributeCall.set(t.data,n),this.attributeCall.set(t,n)):this.attributeCall.get(t)!==n&&(this.attributes.update(t,e),this.attributeCall.set(t,n))}getIndirect(t){return t.geometry.indirect}getIndirectOffset(t){return t.geometry.indirectOffset}getIndex(t){const{geometry:e,material:n}=t;let s=e.index;if(n.wireframe===!0){const i=this.wireframes;let a=i.get(e);a===void 0?(a=FR(e),i.set(e,a)):(a.version!==zB(e)||a.__id!==IB(e))&&(this.attributes.delete(a),a=FR(e),i.set(e,a)),s=a}return s}dispose(){for(const[t,e]of this._geometryDisposeListeners.entries())t.removeEventListener("dispose",e);this._geometryDisposeListeners.clear()}}class xV{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(t,e,n){this.render.drawCalls++,t.isMesh||t.isSprite?this.render.triangles+=n*(e/3):t.isPoints?this.render.points+=n*e:t.isLineSegments?this.render.lines+=n*(e/2):t.isLine?this.render.lines+=n*(e-1):Ht("WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class VB{constructor(t){this.cacheKey=t,this.usedTimes=0}}class bV extends VB{constructor(t,e,n){super(t),this.vertexProgram=e,this.fragmentProgram=n}}class SV extends VB{constructor(t,e){super(t),this.computeProgram=e,this.isComputePipeline=!0}}let wV=0;class $S{constructor(t,e,n,s=null,i=null){this.id=wV++,this.code=t,this.stage=e,this.name=n,this.transforms=s,this.attributes=i,this.usedTimes=0}}class TV extends Oc{constructor(t,e){super(),this.backend=t,this.nodes=e,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(t,e){const{backend:n}=this,s=this.get(t);if(this._needsComputeUpdate(t)){const i=s.pipeline;i&&(i.usedTimes--,i.computeProgram.usedTimes--);const a=this.nodes.getForCompute(t);let c=this.programs.compute.get(a.computeShader);c===void 0&&(i&&i.computeProgram.usedTimes===0&&this._releaseProgram(i.computeProgram),c=new $S(a.computeShader,"compute",t.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,c),n.createProgram(c));const u=this._getComputeCacheKey(t,c);let d=this.caches.get(u);d===void 0&&(i&&i.usedTimes===0&&this._releasePipeline(i),d=this._getComputePipeline(t,c,u,e)),d.usedTimes++,c.usedTimes++,s.version=t.version,s.pipeline=d}return s.pipeline}getForRender(t,e=null){const{backend:n}=this,s=this.get(t);if(this._needsRenderUpdate(t)){const i=s.pipeline;i&&(i.usedTimes--,i.vertexProgram.usedTimes--,i.fragmentProgram.usedTimes--);const a=t.getNodeBuilderState(),c=t.material?t.material.name:"";let u=this.programs.vertex.get(a.vertexShader);u===void 0&&(i&&i.vertexProgram.usedTimes===0&&this._releaseProgram(i.vertexProgram),u=new $S(a.vertexShader,"vertex",c),this.programs.vertex.set(a.vertexShader,u),n.createProgram(u));let d=this.programs.fragment.get(a.fragmentShader);d===void 0&&(i&&i.fragmentProgram.usedTimes===0&&this._releaseProgram(i.fragmentProgram),d=new $S(a.fragmentShader,"fragment",c),this.programs.fragment.set(a.fragmentShader,d),n.createProgram(d));const f=this._getRenderCacheKey(t,u,d);let p=this.caches.get(f);p===void 0?(i&&i.usedTimes===0&&this._releasePipeline(i),p=this._getRenderPipeline(t,u,d,f,e)):t.pipeline=p,p.usedTimes++,u.usedTimes++,d.usedTimes++,s.pipeline=p}return s.pipeline}delete(t){const e=this.get(t).pipeline;return e&&(e.usedTimes--,e.usedTimes===0&&this._releasePipeline(e),e.isComputePipeline?(e.computeProgram.usedTimes--,e.computeProgram.usedTimes===0&&this._releaseProgram(e.computeProgram)):(e.fragmentProgram.usedTimes--,e.vertexProgram.usedTimes--,e.vertexProgram.usedTimes===0&&this._releaseProgram(e.vertexProgram),e.fragmentProgram.usedTimes===0&&this._releaseProgram(e.fragmentProgram))),super.delete(t)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(t){this.getForRender(t)}_getComputePipeline(t,e,n,s){n=n||this._getComputeCacheKey(t,e);let i=this.caches.get(n);return i===void 0&&(i=new SV(n,e),this.caches.set(n,i),this.backend.createComputePipeline(i,s)),i}_getRenderPipeline(t,e,n,s,i){s=s||this._getRenderCacheKey(t,e,n);let a=this.caches.get(s);return a===void 0&&(a=new bV(s,e,n),this.caches.set(s,a),t.pipeline=a,this.backend.createRenderPipeline(t,i)),a}_getComputeCacheKey(t,e){return t.id+","+e.id}_getRenderCacheKey(t,e,n){return e.id+","+n.id+","+this.backend.getRenderCacheKey(t)}_releasePipeline(t){this.caches.delete(t.cacheKey)}_releaseProgram(t){const e=t.code,n=t.stage;this.programs[n].delete(e)}_needsComputeUpdate(t){const e=this.get(t);return e.pipeline===void 0||e.version!==t.version}_needsRenderUpdate(t){return this.get(t).pipeline===void 0||this.backend.needsRenderUpdate(t)}}class _V extends Oc{constructor(t,e,n,s,i,a){super(),this.backend=t,this.textures=n,this.pipelines=i,this.attributes=s,this.nodes=e,this.info=a,this.pipelines.bindings=this}getForRender(t){const e=t.getBindings();for(const n of e){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,e,0),s.bindGroup=n)}return e}getForCompute(t){const e=this.nodes.getForCompute(t).bindings;for(const n of e){const s=this.get(n);s.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,e,0),s.bindGroup=n)}return e}updateForCompute(t){this._updateBindings(this.getForCompute(t))}updateForRender(t){this._updateBindings(this.getForRender(t))}deleteForCompute(t){const e=this.nodes.getForCompute(t).bindings;for(const n of e)this.backend.deleteBindGroupData(n),this.delete(n)}deleteForRender(t){const e=t.getBindings();for(const n of e)this.backend.deleteBindGroupData(n),this.delete(n)}_updateBindings(t){for(const e of t)this._update(e,t)}_init(t){for(const e of t.bindings)if(e.isSampledTexture)this.textures.updateTexture(e.texture);else if(e.isSampler)this.textures.updateSampler(e.texture);else if(e.isStorageBuffer){const n=e.attribute,s=n.isIndirectStorageBufferAttribute?jr.INDIRECT:jr.STORAGE;this.attributes.update(n,s)}}_update(t,e){const{backend:n}=this;let s=!1,i=!0,a=0,c=0;for(const u of t.bindings)if(this.nodes.updateGroup(u)!==!1){if(u.isStorageBuffer){const f=u.attribute,p=f.isIndirectStorageBufferAttribute?jr.INDIRECT:jr.STORAGE,g=n.get(u);this.attributes.update(f,p),g.attribute!==f&&(g.attribute=f,s=!0)}if(u.isUniformBuffer)u.update()&&n.updateBinding(u);else if(u.isSampledTexture){const f=u.update(),p=u.texture,g=this.textures.get(p);if(f&&(this.textures.updateTexture(p),u.generation!==g.generation&&(u.generation=g.generation,s=!0),g.bindGroups.add(t)),n.get(p).externalTexture!==void 0||g.isDefaultTexture?i=!1:(a=a*10+p.id,c+=p.version),p.isStorageTexture===!0&&p.mipmapsAutoUpdate===!0){const x=this.get(p);u.store===!0?x.needsMipmap=!0:this.textures.needsMipmaps(p)&&x.needsMipmap===!0&&(this.backend.generateMipmaps(p),x.needsMipmap=!1)}}else if(u.isSampler&&u.update()){const p=this.textures.updateSampler(u.texture);u.samplerKey!==p&&(u.samplerKey=p,s=!0)}u.isBuffer&&u.updateRanges.length>0&&u.clearUpdateRanges()}s===!0&&this.backend.updateBindings(t,e,i?a:0,c)}}function MV(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.z!==t.z?r.z-t.z:r.id-t.id}function UR(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.z!==t.z?t.z-r.z:r.id-t.id}function PR(r){return(r.transmission>0||r.transmissionNode&&r.transmissionNode.isNode)&&r.side===En&&r.forceSinglePass===!1}class vV{constructor(t,e,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=t.getNode(e,n),this.lightsArray=[],this.scene=e,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(t,e,n,s,i,a,c){let u=this.renderItems[this.renderItemsIndex];return u===void 0?(u={id:t.id,object:t,geometry:e,material:n,groupOrder:s,renderOrder:t.renderOrder,z:i,group:a,clippingContext:c},this.renderItems[this.renderItemsIndex]=u):(u.id=t.id,u.object=t,u.geometry=e,u.material=n,u.groupOrder=s,u.renderOrder=t.renderOrder,u.z=i,u.group=a,u.clippingContext=c),this.renderItemsIndex++,u}push(t,e,n,s,i,a,c){const u=this.getNextRenderItem(t,e,n,s,i,a,c);t.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(PR(n)&&this.transparentDoublePass.push(u),this.transparent.push(u)):this.opaque.push(u)}unshift(t,e,n,s,i,a,c){const u=this.getNextRenderItem(t,e,n,s,i,a,c);n.transparent===!0||n.transmission>0||n.transmissionNode&&n.transmissionNode.isNode||n.backdropNode&&n.backdropNode.isNode?(PR(n)&&this.transparentDoublePass.unshift(u),this.transparent.unshift(u)):this.opaque.unshift(u)}pushBundle(t){this.bundles.push(t)}pushLight(t){this.lightsArray.push(t)}sort(t,e){this.opaque.length>1&&this.opaque.sort(t||MV),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(e||UR),this.transparent.length>1&&this.transparent.sort(e||UR)}finish(){this.lightsNode.setLights(this.lightsArray);for(let t=this.renderItemsIndex,e=this.renderItems.length;t<e;t++){const n=this.renderItems[t];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}}const kh=[];class AV{constructor(t){this.lighting=t,this.lists=new Nc}get(t,e){const n=this.lists;kh[0]=t,kh[1]=e;let s=n.get(kh);return s===void 0&&(s=new vV(this.lighting,t,e),n.set(kh,s)),kh[0]=null,kh[1]=null,s}dispose(){this.lists=new Nc}}let NV=0;class RV{constructor(){this.id=NV++,this.mrt=null,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new je,this.scissor=!1,this.scissorValue=new je,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.camera=null,this.isRenderContext=!0}getCacheKey(){return GB(this)}}function GB(r){const{textures:t,activeCubeFace:e,activeMipmapLevel:n}=r,s=[e,n];for(const i of t)s.push(i.id);return qp(s)}class EV{constructor(t){this.renderer=t,this._renderContexts={}}get(t=null,e=null,n=0){let s;if(t===null)s="default";else{const u=t.texture.format,d=t.texture.type;s=`${t.textures.length}:${u}:${d}:${t.samples}:${t.depthBuffer}:${t.stencilBuffer}`}const i=e!==null?e.id:"default",a=s+"-"+i+"-"+n;let c=this._renderContexts[a];return c===void 0&&(c=new RV,c.mrt=e,this._renderContexts[a]=c),t!==null&&(c.sampleCount=t.samples===0?1:t.samples),c.clearDepthValue=this.renderer.getClearDepth(),c.clearStencilValue=this.renderer.getClearStencil(),c}dispose(){this._renderContexts={}}}const CV=new G;class BV extends Oc{constructor(t,e,n){super(),this.renderer=t,this.backend=e,this.info=n}updateRenderTarget(t,e=0){const n=this.get(t),s=t.samples===0?1:t.samples,i=n.depthTextureMips||(n.depthTextureMips={}),a=t.textures,c=this.getSize(a[0]),u=c.width>>e,d=c.height>>e;let f=t.depthTexture||i[e];const p=t.depthBuffer===!0||t.stencilBuffer===!0;let g=!1;f===void 0&&p&&(f=new Yr,f.format=t.stencilBuffer?el:To,f.type=t.stencilBuffer?yc:Qn,f.image.width=u,f.image.height=d,f.image.depth=c.depth,f.renderTarget=t,f.isArrayTexture=t.multiview===!0&&c.depth>1,i[e]=f),(n.width!==c.width||c.height!==n.height)&&(g=!0,f&&(f.needsUpdate=!0,f.image.width=u,f.image.height=d,f.image.depth=f.isArrayTexture?f.image.depth:1)),n.width=c.width,n.height=c.height,n.textures=a,n.depthTexture=f||null,n.depth=t.depthBuffer,n.stencil=t.stencilBuffer,n.renderTarget=t,n.sampleCount!==s&&(g=!0,f&&(f.needsUpdate=!0),n.sampleCount=s);const y={sampleCount:s};if(t.isXRRenderTarget!==!0){for(let x=0;x<a.length;x++){const S=a[x];g&&(S.needsUpdate=!0),this.updateTexture(S,y)}f&&this.updateTexture(f,y)}n.initialized!==!0&&(n.initialized=!0,n.onDispose=()=>{this._destroyRenderTarget(t)},t.addEventListener("dispose",n.onDispose))}updateTexture(t,e={}){const n=this.get(t);if(n.initialized===!0&&n.version===t.version)return;const s=t.isRenderTargetTexture||t.isDepthTexture||t.isFramebufferTexture,i=this.backend;if(s&&n.initialized===!0&&i.destroyTexture(t),t.isFramebufferTexture){const d=this.renderer.getRenderTarget();d?t.type=d.texture.type:t.type=gi}const{width:a,height:c,depth:u}=this.getSize(t);if(e.width=a,e.height=c,e.depth=u,e.needsMipmaps=this.needsMipmaps(t),e.levels=e.needsMipmaps?this.getMipLevels(t,a,c):1,t.isCubeTexture&&t.mipmaps.length>0&&e.levels++,s||t.isStorageTexture===!0||t.isExternalTexture===!0)i.createTexture(t,e),n.generation=t.version;else if(t.version>0){const d=t.image;if(d===void 0)Wt("Renderer: Texture marked for update but image is undefined.");else if(d.complete===!1)Wt("Renderer: Texture marked for update but image is incomplete.");else{if(t.images){const p=[];for(const g of t.images)p.push(g);e.images=p}else e.image=d;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(i.createTexture(t,e),n.isDefaultTexture=!1,n.generation=t.version),t.source.dataReady===!0&&i.updateTexture(t,e);const f=t.isStorageTexture===!0&&t.mipmapsAutoUpdate===!1;e.needsMipmaps&&t.mipmaps.length===0&&!f&&i.generateMipmaps(t),t.onUpdate&&t.onUpdate(t)}}else i.createDefaultTexture(t),n.isDefaultTexture=!0,n.generation=t.version;n.initialized!==!0&&(n.initialized=!0,n.generation=t.version,n.bindGroups=new Set,this.info.memory.textures++,t.isVideoTexture&&qe.enabled===!0&&qe.getTransfer(t.colorSpace)!==ye&&Wt("WebGPURenderer: Video textures must use a color space with a sRGB transfer function, e.g. SRGBColorSpace."),n.onDispose=()=>{this._destroyTexture(t)},t.addEventListener("dispose",n.onDispose)),n.version=t.version}updateSampler(t){return this.backend.updateSampler(t)}getSize(t,e=CV){let n=t.images?t.images[0]:t.image;return n?(n.image!==void 0&&(n=n.image),typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?(e.width=n.videoWidth||1,e.height=n.videoHeight||1,e.depth=1):typeof VideoFrame<"u"&&n instanceof VideoFrame?(e.width=n.displayWidth||1,e.height=n.displayHeight||1,e.depth=1):(e.width=n.width||1,e.height=n.height||1,e.depth=t.isCubeTexture?6:n.depth||1)):e.width=e.height=e.depth=1,e}getMipLevels(t,e,n){let s;return t.mipmaps.length>0?s=t.mipmaps.length:t.isCompressedTexture===!0?s=1:s=Math.floor(Math.log2(Math.max(e,n)))+1,s}needsMipmaps(t){return t.generateMipmaps===!0||t.mipmaps.length>0}_destroyRenderTarget(t){if(this.has(t)===!0){const e=this.get(t),n=e.textures,s=e.depthTexture;t.removeEventListener("dispose",e.onDispose);for(let i=0;i<n.length;i++)this._destroyTexture(n[i]);s&&this._destroyTexture(s),this.delete(t),this.backend.delete(t)}}_destroyTexture(t){if(this.has(t)===!0){const e=this.get(t);t.removeEventListener("dispose",e.onDispose);const n=e.isDefaultTexture;if(this.backend.destroyTexture(t,n),e.bindGroups)for(const s of e.bindGroups){const i=this.backend.get(s);i.groups=void 0,i.versions=void 0}this.delete(t),this.info.memory.textures--}}}class t_ extends qt{constructor(t,e,n,s=1){super(t,e,n),this.a=s}set(t,e,n,s=1){return this.a=s,super.set(t,e,n)}copy(t){return t.a!==void 0&&(this.a=t.a),super.copy(t)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class kB extends Ke{static get type(){return"ParameterNode"}constructor(t,e=null){super(t,e),this.isParameterNode=!0}getMemberType(t,e){const n=this.getNodeType(t),s=t.getStructTypeNode(n);let i;return s!==null?i=s.getMemberType(t,e):(Ht(`TSL: Member "${e}" not found in struct "${n}".`,new ds),i="float"),i}getHash(){return this.uuid}generate(){return this.name}}const DV=(r,t)=>new kB(r,t);class LV extends Zt{static get type(){return"StackNode"}constructor(t=null){super(),this.nodes=[],this.outputNode=null,this.parent=t,this._currentCond=null,this._expressionNode=null,this._currentNode=null,this.isStackNode=!0}getElementType(t){return this.hasOutput(t)?this.outputNode.getElementType(t):"void"}getNodeType(t){return this.hasOutput(t)?this.outputNode.getNodeType(t):"void"}getMemberType(t,e){return this.hasOutput(t)?this.outputNode.getMemberType(t,e):"void"}addToStack(t,e=this.nodes.length){return t.isNode!==!0?(Ht("TSL: Invalid node added to stack.",new ds),this):(this.nodes.splice(e,0,t),this)}addToStackBefore(t){const e=this._currentNode?this.nodes.indexOf(this._currentNode):0;return this.addToStack(t,e)}If(t,e){const n=new od(e);return this._currentCond=yi(t,n),this.addToStack(this._currentCond)}ElseIf(t,e){const n=new od(e),s=yi(t,n);return this._currentCond.elseNode=s,this._currentCond=s,this}Else(t){return this._currentCond.elseNode=new od(t),this}Switch(t){return this._expressionNode=Kt(t),this}Case(...t){const e=[];if(t.length>=2)for(let c=0;c<t.length-1;c++)e.push(this._expressionNode.equal(Kt(t[c])));else Ht("TSL: Invalid parameter length. Case() requires at least two parameters.",new ds);const n=t[t.length-1],s=new od(n);let i=e[0];for(let c=1;c<e.length;c++)i=i.or(e[c]);const a=yi(i,s);return this._currentCond===null?(this._currentCond=a,this.addToStack(this._currentCond)):(this._currentCond.elseNode=a,this._currentCond=a,this)}Default(t){return this.Else(t),this}setup(t){const e=t.getNodeProperties(this);let n=0;for(const s of this.getChildren())s.isVarNode&&s.isIntent(t)&&s.isAssign(t)!==!0||(e["node"+n++]=s);return e.outputNode||null}hasOutput(t){return this.outputNode&&this.outputNode.isNode&&this.outputNode.getNodeType(t)!=="void"}build(t,...e){const n=Yw(),s=t.buildStage;Pp(this),t.setActiveStack(this);const i=d=>{if(this._currentNode=d,!(d.isVarNode&&d.isIntent(t)&&d.isAssign(t)!==!0)){if(s==="setup")d.build(t);else if(s==="analyze")d.build(t,this);else if(s==="generate"){const f=t.getDataFromNode(d,"any").stages,p=f&&f[t.shaderStage];if(d.isVarNode&&p&&p.length===1&&p[0]&&p[0].isStackNode)return;d.build(t,"void")}}},a=[...this.nodes];for(const d of a)i(d);this._currentNode=null;const c=this.nodes.filter(d=>a.indexOf(d)===-1);for(const d of c)i(d);let u;return this.hasOutput(t)?u=this.outputNode.build(t,...e):u=super.build(t,...e),Pp(n),t.removeActiveStack(this),u}}const Gg=xe(LV).setParameterLength(0,1);function OV(r){return Object.entries(r).map(([t,e])=>typeof e=="string"?{name:t,type:e,atomic:!1}:{name:t,type:e.type,atomic:e.atomic||!1})}class FV extends Zt{static get type(){return"StructTypeNode"}constructor(t,e=null){super("struct"),this.membersLayout=OV(t),this.name=e,this.isStructLayoutNode=!0}getLength(){const t=Float32Array.BYTES_PER_ELEMENT;let e=1,n=0;for(const s of this.membersLayout){const i=s.type,a=rP(i),c=oP(i)/t;e=Math.max(e,c);const d=n%e%c;d!==0&&(n+=c-d),n+=a}return Math.ceil(n/e)*e}getMemberType(t,e){const n=this.membersLayout.find(s=>s.name===e);return n?n.type:"void"}getNodeType(t){return t.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(t){t.getStructTypeFromNode(this,this.membersLayout,this.name),t.addInclude(this)}generate(t){return this.getNodeType(t)}}class UV extends Zt{static get type(){return"StructNode"}constructor(t,e){super("vec3"),this.structTypeNode=t,this.values=e,this.isStructNode=!0}getNodeType(t){return this.structTypeNode.getNodeType(t)}getMemberType(t,e){return this.structTypeNode.getMemberType(t,e)}_getChildren(){const t=super._getChildren(),e=t.find(n=>n.childNode===this.structTypeNode);return t.splice(t.indexOf(e),1),t.push(e),t}generate(t){const e=t.getVarFromNode(this),n=e.type,s=t.getPropertyName(e);return t.addLineFlowCode(`${s} = ${t.generateStruct(n,this.structTypeNode.membersLayout,this.values)}`,this),e.name}}const PV=(r,t=null)=>{const e=new FV(r,t),n=(...s)=>{let i=null;if(s.length>0)if(s[0].isNode){i={};const a=Object.keys(r);for(let c=0;c<s.length;c++)i[a[c]]=s[c]}else i=s[0];return new UV(e,i)};return n.layout=e,n.isStruct=!0,n};class HB extends Zt{static get type(){return"OutputStructNode"}constructor(...t){super(),this.members=t,this.isOutputStructNode=!0}getNodeType(){return"OutputType"}generate(t){const e=t.getDataFromNode(this);if(e.membersLayout===void 0){const a=this.members,c=[];for(let u=0;u<a.length;u++){const d="m"+u,f=a[u].getNodeType(t);c.push({name:d,type:f,index:u})}e.membersLayout=c,e.structType=t.getOutputStructTypeFromNode(this,e.membersLayout)}const n=t.getOutputStructName(),s=this.members,i=n!==""?n+".":"";for(let a=0;a<s.length;a++){const c=s[a].build(t);t.addLineFlowCode(`${i}m${a} = ${c}`,this)}return n}}const zV=xe(HB);class WB{constructor(t=fi){this.blending=t,this.blendSrc=Np,this.blendDst=Rp,this.blendEquation=qr,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.premultiplyAlpha=!1}copy(t){return this.blending=t.blending,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.premultiplyAlpha=t.premultiplyAlpha,this}clone(){return new this.constructor().copy(this)}}const IV=new WB(tl),VV=new WB(Sw);function qB(r,t){for(let e=0;e<r.length;e++)if(r[e].name===t)return e;return-1}class GV extends HB{static get type(){return"MRTNode"}constructor(t){super(),this.outputNodes=t,this.blendModes={output:VV},this.isMRTNode=!0}setBlendMode(t,e){return this.blendModes[t]=e,this}getBlendMode(t){return this.blendModes[t]||IV}has(t){return this.outputNodes[t]!==void 0}get(t){return this.outputNodes[t]}merge(t){const e={...this.outputNodes,...t.outputNodes},n={...this.blendModes,...t.blendModes},s=$B(e);return s.blendings=n,s}setup(t){const e=this.outputNodes,n=t.renderer.getRenderTarget(),s=[],i=n.textures;for(const a in e){const c=qB(i,a);s[c]=se(e[a])}return this.members=s,super.setup(t)}}const $B=xe(GV);class Zp extends is{static get type(){return"BitcastNode"}constructor(t,e,n=null){super(),this.valueNode=t,this.conversionType=e,this.inputType=n,this.isBitcastNode=!0}getNodeType(t){if(this.inputType!==null){const e=this.valueNode.getNodeType(t),n=t.getTypeLength(e);return t.getTypeFromLength(n,this.conversionType)}return this.conversionType}generate(t){const e=this.getNodeType(t);let n="";if(this.inputType!==null){const s=this.valueNode.getNodeType(t);n=t.getTypeLength(s)===1?this.inputType:t.changeComponentType(s,this.inputType)}else n=this.valueNode.getNodeType(t);return`${t.getBitcastMethod(e,n)}( ${this.valueNode.build(t,n)} )`}}const XB=Gt(Zp).setParameterLength(2),kV=r=>new Zp(r,"int","float"),jB=r=>new Zp(r,"uint","float"),HV=r=>new Zp(r,"float","int"),WV=r=>new Zp(r,"float","uint"),Jm={};class _r extends St{static get type(){return"BitcountNode"}constructor(t,e){super(t,e),this.isBitcountNode=!0}_resolveElementType(t,e,n){n==="int"?e.assign(XB(t,"uint")):e.assign(t)}_returnDataNode(t){switch(t){case"uint":return Ut;case"int":return J;case"uvec2":return Kw;case"uvec3":return Hu;case"uvec4":return tT;case"ivec2":return Rs;case"ivec3":return Zw;case"ivec4":return Jw}}_createTrailingZerosBaseLayout(t,e){const n=this._returnDataNode(e);return ut(([i])=>{const a=Ut(0);this._resolveElementType(i,a,e);const c=k(a.bitAnd(fT(a))),d=jB(c).shiftRight(23).sub(127);return n(d)}).setLayout({name:t,type:e,inputs:[{name:"value",type:e}]})}_createLeadingZerosBaseLayout(t,e){const n=this._returnDataNode(e);return ut(([i])=>{re(i.equal(Ut(0)),()=>Ut(32));const a=Ut(0),c=Ut(0);return this._resolveElementType(i,a,e),re(a.shiftRight(16).equal(0),()=>{c.addAssign(16),a.shiftLeftAssign(16)}),re(a.shiftRight(24).equal(0),()=>{c.addAssign(8),a.shiftLeftAssign(8)}),re(a.shiftRight(28).equal(0),()=>{c.addAssign(4),a.shiftLeftAssign(4)}),re(a.shiftRight(30).equal(0),()=>{c.addAssign(2),a.shiftLeftAssign(2)}),re(a.shiftRight(31).equal(0),()=>{c.addAssign(1)}),n(c)}).setLayout({name:t,type:e,inputs:[{name:"value",type:e}]})}_createOneBitsBaseLayout(t,e){const n=this._returnDataNode(e);return ut(([i])=>{const a=Ut(0);this._resolveElementType(i,a,e),a.assign(a.sub(a.shiftRight(Ut(1)).bitAnd(Ut(1431655765)))),a.assign(a.bitAnd(Ut(858993459)).add(a.shiftRight(Ut(2)).bitAnd(Ut(858993459))));const c=a.add(a.shiftRight(Ut(4))).bitAnd(Ut(252645135)).mul(Ut(16843009)).shiftRight(Ut(24));return n(c)}).setLayout({name:t,type:e,inputs:[{name:"value",type:e}]})}_createMainLayout(t,e,n,s){const i=this._returnDataNode(e);return ut(([c])=>{if(n===1)return i(s(c));{const u=i(0),d=["x","y","z","w"];for(let f=0;f<n;f++){const p=d[f];u[p].assign(s(c[p]))}return u}}).setLayout({name:t,type:e,inputs:[{name:"value",type:e}]})}setup(t){const{method:e,aNode:n}=this,{renderer:s}=t;if(s.backend.isWebGPUBackend)return super.setup(t);const i=this.getInputType(t),a=t.getElementType(i),c=t.getTypeLength(i),u=`${e}_base_${a}`,d=`${e}_${i}`;let f=Jm[u];if(f===void 0){switch(e){case _r.COUNT_LEADING_ZEROS:{f=this._createLeadingZerosBaseLayout(u,a);break}case _r.COUNT_TRAILING_ZEROS:{f=this._createTrailingZerosBaseLayout(u,a);break}case _r.COUNT_ONE_BITS:{f=this._createOneBitsBaseLayout(u,a);break}}Jm[u]=f}let p=Jm[d];return p===void 0&&(p=this._createMainLayout(d,i,c,f),Jm[d]=p),ut(()=>p(n))()}}_r.COUNT_TRAILING_ZEROS="countTrailingZeros";_r.COUNT_LEADING_ZEROS="countLeadingZeros";_r.COUNT_ONE_BITS="countOneBits";const qV=Gt(_r,_r.COUNT_TRAILING_ZEROS).setParameterLength(1),$V=Gt(_r,_r.COUNT_LEADING_ZEROS).setParameterLength(1),XV=Gt(_r,_r.COUNT_ONE_BITS).setParameterLength(1),jV=ut(([r])=>{const t=r.toUint().mul(747796405).add(2891336453),e=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return e.shiftRight(22).bitXor(e).toFloat().mul(1/2**32)}),rw=(r,t)=>$r(fe(4,r.mul(De(1,r))),t),YV=(r,t)=>r.lessThan(.5)?rw(r.mul(2),t).div(2):De(1,rw(fe(De(1,r),2),t).div(2)),KV=(r,t,e)=>$r(vr($r(r,t),xs($r(r,t),$r(De(1,r),e))),1/t),ZV=(r,t)=>Ni(Uy.mul(t.mul(r).sub(1))).div(Uy.mul(t.mul(r).sub(1)));class e_ extends is{static get type(){return"PackFloatNode"}constructor(t,e){super(),this.vectorNode=e,this.encoding=t,this.isPackFloatNode=!0}getNodeType(){return"uint"}generate(t){const e=this.vectorNode.getNodeType(t);return`${t.getFloatPackingMethod(this.encoding)}(${this.vectorNode.build(t,e)})`}}const QV=Gt(e_,"snorm").setParameterLength(1),JV=Gt(e_,"unorm").setParameterLength(1),tG=Gt(e_,"float16").setParameterLength(1);class n_ extends is{static get type(){return"UnpackFloatNode"}constructor(t,e){super(),this.uintNode=e,this.encoding=t,this.isUnpackFloatNode=!0}getNodeType(){return"vec2"}generate(t){const e=this.uintNode.getNodeType(t);return`${t.getFloatUnpackingMethod(this.encoding)}(${this.uintNode.build(t,e)})`}}const eG=Gt(n_,"snorm").setParameterLength(1),nG=Gt(n_,"unorm").setParameterLength(1),sG=Gt(n_,"float16").setParameterLength(1),ja=ut(([r])=>r.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),iG=ut(([r])=>it(ja(r.z.add(ja(r.y.mul(1)))),ja(r.z.add(ja(r.x.mul(1)))),ja(r.y.add(ja(r.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),rG=ut(([r,t,e])=>{const n=it(r).toVar(),s=k(1.4).toVar(),i=k(0).toVar(),a=it(n).toVar();return on({start:k(0),end:k(3),type:"float",condition:"<="},()=>{const c=it(iG(a.mul(2))).toVar();n.addAssign(c.add(e.mul(k(.1).mul(t)))),a.mulAssign(1.8),s.mulAssign(1.5),n.mulAssign(1.2);const u=k(ja(n.z.add(ja(n.x.add(ja(n.y)))))).toVar();i.addAssign(u.div(s)),a.addAssign(.14)}),i}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class oG extends Zt{static get type(){return"FunctionOverloadingNode"}constructor(t=[],...e){super(),this.functionNodes=t,this.parametersNodes=e,this._candidateFn=null,this.global=!0}getNodeType(t){return this.getCandidateFn(t).shaderNode.layout.type}getCandidateFn(t){const e=this.parametersNodes;let n=this._candidateFn;if(n===null){let s=null,i=-1;for(const a of this.functionNodes){const u=a.shaderNode.layout;if(u===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const d=u.inputs;if(e.length===d.length){let f=0;for(let p=0;p<e.length;p++){const g=e[p],y=d[p];g.getNodeType(t)===y.type&&f++}f>i&&(s=a,i=f)}}this._candidateFn=n=s}return n}setup(t){return this.getCandidateFn(t)(...this.parametersNodes)}}const aG=xe(oG),ri=r=>(...t)=>aG(r,...t),Od=Jt(0).setGroup(ee).onRenderUpdate(r=>r.time),lG=Jt(0).setGroup(ee).onRenderUpdate(r=>r.deltaTime),YB=Jt(0,"uint").setGroup(ee).onRenderUpdate(r=>r.frameId),cG=(r=Od)=>r.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),uG=(r=Od)=>r.fract().round(),hG=(r=Od)=>r.add(.5).fract().mul(2).sub(1).abs(),dG=(r=Od)=>r.fract();function fG(r,t=null){return ul(t,{getUV:typeof r=="function"?r:()=>r})}const pG=ut(([r,t,e=It(.5)])=>Kp(r.sub(e),t).add(e)),mG=ut(([r,t,e=It(.5)])=>{const n=r.sub(e),s=n.dot(n),a=s.mul(s).mul(t);return r.add(n.mul(a))}),gG=ut(({position:r=null,horizontal:t=!0,vertical:e=!1})=>{let n;r!==null?(n=Xr.toVar(),n[3][0]=r.x,n[3][1]=r.y,n[3][2]=r.z):n=Xr;const s=so.mul(n);return Up(t)&&(s[0][0]=Xr[0].length(),s[0][1]=0,s[0][2]=0),Up(e)&&(s[1][0]=0,s[1][1]=Xr[1].length(),s[1][2]=0),s[2][0]=0,s[2][1]=0,s[2][2]=1,rl.mul(s).mul(kn)}),yG=ut(([r=null])=>{const t=zy();return zy(HT(r)).sub(t).lessThan(0).select(ia,r)}),xG=ut(([r,t=cn(),e=k(0)])=>{const n=r.x,s=r.y,i=e.mod(n.mul(s)).floor(),a=i.mod(n),c=s.sub(i.add(1).div(n).ceil()),u=r.reciprocal(),d=It(a,c);return t.add(d).mul(u)}),KB=ut(([r,t=null,e=null,n=k(1),s=kn,i=nr])=>{let a=i.abs().normalize();a=a.div(a.dot(it(1)));const c=s.yz.mul(n),u=s.zx.mul(n),d=s.xy.mul(n),f=r.value,p=t!==null?t.value:f,g=e!==null?e.value:f,y=He(f,c).mul(a.x),x=He(p,u).mul(a.y),S=He(g,d).mul(a.z);return xs(y,x,S)}),bG=(...r)=>KB(...r),Hh=new rc,ru=new G,Wh=new G,XS=new G,If=new Te,tg=new G(0,0,-1),Ho=new je,Vf=new G,eg=new G,Gf=new je,ng=new Ot,Vy=new cl,SG=ia.flipX();Vy.depthTexture=new Yr(1,1);let sg=!1;class s_ extends ca{static get type(){return"ReflectorNode"}constructor(t={}){super(t.defaultTexture||Vy.texture,SG),this._reflectorBaseNode=t.reflector||new wG(this,t),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=new s_({defaultTexture:Vy.depthTexture,reflector:this._reflectorBaseNode})}return this._depthNode}setup(t){return t.object.isQuadMesh||this._reflectorBaseNode.build(t),super.setup(t)}clone(){const t=new this.constructor(this.reflectorNode);return t.uvNode=this.uvNode,t.levelNode=this.levelNode,t.biasNode=this.biasNode,t.sampler=this.sampler,t.depthNode=this.depthNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.offsetNode=this.offsetNode,t._reflectorBaseNode=this._reflectorBaseNode,t}dispose(){super.dispose(),this._reflectorBaseNode.dispose()}}class wG extends Zt{static get type(){return"ReflectorBaseNode"}constructor(t,e={}){super();const{target:n=new Cn,resolutionScale:s=1,generateMipmaps:i=!1,bounces:a=!0,depth:c=!1,samples:u=0}=e;this.textureNode=t,this.target=n,this.resolutionScale=s,e.resolution!==void 0&&(rn('ReflectorNode: The "resolution" parameter has been renamed to "resolutionScale".'),this.resolutionScale=e.resolution),this.generateMipmaps=i,this.bounces=a,this.depth=c,this.samples=u,this.updateBeforeType=a?de.RENDER:de.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new Map,this.forceUpdate=!1,this.hasOutput=!1}_updateResolution(t,e){const n=this.resolutionScale;e.getDrawingBufferSize(ng),t.setSize(Math.round(ng.width*n),Math.round(ng.height*n))}setup(t){return this._updateResolution(Vy,t.renderer),super.setup(t)}dispose(){super.dispose();for(const t of this.renderTargets.values())t.dispose()}getVirtualCamera(t){let e=this.virtualCameras.get(t);return e===void 0&&(e=t.clone(),this.virtualCameras.set(t,e)),e}getRenderTarget(t){let e=this.renderTargets.get(t);return e===void 0&&(e=new cl(0,0,{type:ni,samples:this.samples}),this.generateMipmaps===!0&&(e.texture.minFilter=WF,e.texture.generateMipmaps=!0),this.depth===!0&&(e.depthTexture=new Yr),this.renderTargets.set(t,e)),e}updateBefore(t){if(this.bounces===!1&&sg)return!1;sg=!0;const{scene:e,camera:n,renderer:s,material:i}=t,{target:a}=this,c=this.getVirtualCamera(n),u=this.getRenderTarget(c);s.getDrawingBufferSize(ng),this._updateResolution(u,s),Wh.setFromMatrixPosition(a.matrixWorld),XS.setFromMatrixPosition(n.matrixWorld),If.extractRotation(a.matrixWorld),ru.set(0,0,1),ru.applyMatrix4(If),Vf.subVectors(Wh,XS);const d=Vf.dot(ru)>0;let f=!1;if(d===!0&&this.forceUpdate===!1){if(this.hasOutput===!1){sg=!1;return}f=!0}Vf.reflect(ru).negate(),Vf.add(Wh),If.extractRotation(n.matrixWorld),tg.set(0,0,-1),tg.applyMatrix4(If),tg.add(XS),eg.subVectors(Wh,tg),eg.reflect(ru).negate(),eg.add(Wh),c.coordinateSystem=n.coordinateSystem,c.position.copy(Vf),c.up.set(0,1,0),c.up.applyMatrix4(If),c.up.reflect(ru),c.lookAt(eg),c.near=n.near,c.far=n.far,c.updateMatrixWorld(),c.projectionMatrix.copy(n.projectionMatrix),Hh.setFromNormalAndCoplanarPoint(ru,Wh),Hh.applyMatrix4(c.matrixWorldInverse),Ho.set(Hh.normal.x,Hh.normal.y,Hh.normal.z,Hh.constant);const p=c.projectionMatrix;Gf.x=(Math.sign(Ho.x)+p.elements[8])/p.elements[0],Gf.y=(Math.sign(Ho.y)+p.elements[9])/p.elements[5],Gf.z=-1,Gf.w=(1+p.elements[10])/p.elements[14],Ho.multiplyScalar(1/Ho.dot(Gf));const g=0;p.elements[2]=Ho.x,p.elements[6]=Ho.y,p.elements[10]=s.coordinateSystem===Zr?Ho.z-g:Ho.z+1-g,p.elements[14]=Ho.w,this.textureNode.value=u.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=u.depthTexture),i.visible=!1;const y=s.getRenderTarget(),x=s.getMRT(),S=s.autoClear;s.setMRT(null),s.setRenderTarget(u),s.autoClear=!0;const T=e.name;e.name=(e.name||"Scene")+" [ Reflector ]",f?(s.clear(),this.hasOutput=!1):(s.render(e,c),this.hasOutput=!0),e.name=T,s.setMRT(x),s.setRenderTarget(y),s.autoClear=S,i.visible=!0,sg=!1,this.forceUpdate=!1}get resolution(){return rn('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale}set resolution(t){rn('ReflectorNode: The "resolution" property has been renamed to "resolutionScale".'),this.resolutionScale=t}}const TG=r=>new s_(r),jS=new kw(-1,1,1,-1,0,1);class _G extends Ye{constructor(t=!1){super();const e=t===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new ge([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ge(e,2))}}const MG=new _G;class Bx extends C{constructor(t=null){super(MG,t),this.camera=jS,this.isQuadMesh=!0}async renderAsync(t){rn('QuadMesh: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await t.init(),t.render(this,jS)}render(t){t.render(this,jS)}}const vG=new Ot;class AG extends ca{static get type(){return"RTTNode"}constructor(t,e=null,n=null,s={type:ni}){const i=new cl(e,n,s);super(i.texture,cn()),this.isRTTNode=!0,this.node=t,this.width=e,this.height=n,this.pixelRatio=1,this.renderTarget=i,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new Bx(new ss),this.updateBeforeType=de.RENDER}get autoResize(){return this.width===null}setup(t){return this._rttNode=this.node.context(t.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(t)}setSize(t,e){this.width=t,this.height=e;const n=t*this.pixelRatio,s=e*this.pixelRatio;this.renderTarget.setSize(n,s),this.textureNeedsUpdate=!0}setPixelRatio(t){this.pixelRatio=t,this.setSize(this.width,this.height)}updateBefore({renderer:t}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoResize===!0){const s=t.getPixelRatio(),i=t.getSize(vG),a=Math.floor(i.width*s),c=Math.floor(i.height*s);(a!==this.renderTarget.width||c!==this.renderTarget.height)&&(this.renderTarget.setSize(a,c),this.textureNeedsUpdate=!0)}let e="RTT";this.node.name&&(e=this.node.name+" [ "+e+" ]"),this._quadMesh.material.fragmentNode=this._rttNode,this._quadMesh.name=e;const n=t.getRenderTarget();t.setRenderTarget(this.renderTarget),this._quadMesh.render(t),t.setRenderTarget(n)}clone(){const t=new ca(this.value,this.uvNode,this.levelNode);return t.sampler=this.sampler,t.referenceNode=this,t}}const ZB=(r,...t)=>new AG(Kt(r),...t),NG=(r,...t)=>r.isSampleNode||r.isTextureNode?r:r.isPassNode?r.getTextureNode():ZB(r,...t),nd=ut(([r,t,e],n)=>{let s;n.renderer.coordinateSystem===Zr?(r=It(r.x,r.y.oneMinus()).mul(2).sub(1),s=se(it(r,t),1)):s=se(it(r.x,r.y.oneMinus(),t).mul(2).sub(1),1);const i=se(e.mul(s));return i.xyz.div(i.w)}),RG=ut(([r,t])=>{const e=t.mul(se(r,1)),n=e.xy.div(e.w).mul(.5).add(.5).toVar();return It(n.x,n.y.oneMinus())}),EG=ut(([r,t,e])=>{const n=wc(Zn(t)),s=Rs(r.mul(n)).toVar(),i=Zn(t,s).toVar(),a=Zn(t,s.sub(Rs(2,0))).toVar(),c=Zn(t,s.sub(Rs(1,0))).toVar(),u=Zn(t,s.add(Rs(1,0))).toVar(),d=Zn(t,s.add(Rs(2,0))).toVar(),f=Zn(t,s.add(Rs(0,2))).toVar(),p=Zn(t,s.add(Rs(0,1))).toVar(),g=Zn(t,s.sub(Rs(0,1))).toVar(),y=Zn(t,s.sub(Rs(0,2))).toVar(),x=xn(De(k(2).mul(c).sub(a),i)).toVar(),S=xn(De(k(2).mul(u).sub(d),i)).toVar(),T=xn(De(k(2).mul(p).sub(f),i)).toVar(),M=xn(De(k(2).mul(g).sub(y),i)).toVar(),N=nd(r,i,e).toVar(),v=x.lessThan(S).select(N.sub(nd(r.sub(It(k(1).div(n.x),0)),c,e)),N.negate().add(nd(r.add(It(k(1).div(n.x),0)),u,e))),A=T.lessThan(M).select(N.sub(nd(r.add(It(0,k(1).div(n.y))),p,e)),N.negate().add(nd(r.sub(It(0,k(1).div(n.y))),g,e)));return Qi(ol(v,A))}),i_=ut(([r])=>vo(k(52.9829189).mul(vo(to(r,It(.06711056,.00583715)))))).setLayout({name:"interleavedGradientNoise",type:"float",inputs:[{name:"position",type:"vec2"}]}),wo=ut(([r,t,e])=>{const n=k(2.399963229728653),s=Di(k(r).add(.5).div(k(t))),i=k(r).mul(n).add(e);return It(bo(i),Ni(i)).mul(s)}).setLayout({name:"vogelDiskSample",type:"vec2",inputs:[{name:"sampleIndex",type:"int"},{name:"samplesCount",type:"int"},{name:"phi",type:"float"}]});class CG extends Zt{static get type(){return"SampleNode"}constructor(t,e=null){super(),this.callback=t,this.uvNode=e,this.isSampleNode=!0}setup(){return this.sample(cn())}sample(t){return this.callback(t)}}const BG=(r,t=null)=>new CG(r,Kt(t));class Zi extends Zt{static get type(){return"EventNode"}constructor(t,e){super("void"),this.eventType=t,this.callback=e,t===Zi.OBJECT?this.updateType=de.OBJECT:t===Zi.MATERIAL?this.updateType=de.RENDER:t===Zi.BEFORE_OBJECT?this.updateBeforeType=de.OBJECT:t===Zi.BEFORE_MATERIAL&&(this.updateBeforeType=de.RENDER)}update(t){this.callback(t)}updateBefore(t){this.callback(t)}}Zi.OBJECT="object";Zi.MATERIAL="material";Zi.BEFORE_OBJECT="beforeObject";Zi.BEFORE_MATERIAL="beforeMaterial";const Dx=(r,t)=>new Zi(r,t).toStack(),DG=r=>Dx(Zi.OBJECT,r),LG=r=>Dx(Zi.MATERIAL,r),OG=r=>Dx(Zi.BEFORE_OBJECT,r),FG=r=>Dx(Zi.BEFORE_MATERIAL,r);class UG extends bc{constructor(t,e,n=Float32Array){const s=ArrayBuffer.isView(t)?t:new n(t*e);super(s,e),this.isStorageInstancedBufferAttribute=!0}}class PG extends hs{constructor(t,e,n=Float32Array){const s=ArrayBuffer.isView(t)?t:new n(t*e);super(s,e),this.isStorageBufferAttribute=!0}}const zG=(r,t="float")=>{let e,n;t.isStruct===!0?(e=t.layout.getLength(),n=Ey("float")):(e=gC(t),n=Ey(t));const s=new PG(r,e,n);return Tc(s,t,r)},IG=(r,t="float")=>{let e,n;t.isStruct===!0?(e=t.layout.getLength(),n=Ey("float")):(e=gC(t),n=Ey(t));const s=new UG(r,e,n);return Tc(s,t,s.count)};class VG extends Zt{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const GG=Xt(VG),kf=new Ji,YS=new Te,QB=Jt(0).setGroup(ee).onRenderUpdate(({scene:r})=>r.backgroundBlurriness),ow=Jt(1).setGroup(ee).onRenderUpdate(({scene:r})=>r.backgroundIntensity),JB=Jt(new Te).setGroup(ee).onRenderUpdate(({scene:r})=>{const t=r.background;return t!==null&&t.isTexture&&t.mapping!==Tw?(kf.copy(r.backgroundRotation),kf.x*=-1,kf.y*=-1,kf.z*=-1,YS.makeRotationFromEuler(kf)):YS.identity(),YS});class kG extends ca{static get type(){return"StorageTextureNode"}constructor(t,e,n=null){super(t,e),this.storeNode=n,this.mipLevel=0,this.isStorageTextureNode=!0,this.access=si.WRITE_ONLY}getInputType(){return"storageTexture"}setup(t){super.setup(t);const e=t.getNodeProperties(this);return e.storeNode=this.storeNode,e}setAccess(t){return this.access=t,this}setMipLevel(t){return this.mipLevel=t,this}generate(t,e){let n;return this.storeNode!==null?n=this.generateStore(t):n=super.generate(t,e),n}toReadWrite(){return this.setAccess(si.READ_WRITE)}toReadOnly(){return this.setAccess(si.READ_ONLY)}toWriteOnly(){return this.setAccess(si.WRITE_ONLY)}generateStore(t){const e=t.getNodeProperties(this),{uvNode:n,storeNode:s,depthNode:i}=e,a=super.generate(t,"property"),c=n.build(t,this.value.is3DTexture===!0?"uvec3":"uvec2"),u=s.build(t,"vec4"),d=i?i.build(t,"int"):null,f=t.generateTextureStore(t,a,c,d,u);t.addLineFlowCode(f,this)}clone(){const t=super.clone();return t.storeNode=this.storeNode,t.mipLevel=this.mipLevel,t.access=this.access,t}}const tD=xe(kG).setParameterLength(1,3),HG=(r,t,e)=>{let n;return r.isStorageTextureNode===!0?(n=r.clone(),n.uvNode=t,n.storeNode=e):n=tD(r,t,e),e!==null&&n.toStack(),n},WG=ut(({texture:r,uv:t})=>{const n=it().toVar();return re(t.x.lessThan(1e-4),()=>{n.assign(it(1,0,0))}).ElseIf(t.y.lessThan(1e-4),()=>{n.assign(it(0,1,0))}).ElseIf(t.z.lessThan(1e-4),()=>{n.assign(it(0,0,1))}).ElseIf(t.x.greaterThan(1-1e-4),()=>{n.assign(it(-1,0,0))}).ElseIf(t.y.greaterThan(1-1e-4),()=>{n.assign(it(0,-1,0))}).ElseIf(t.z.greaterThan(1-1e-4),()=>{n.assign(it(0,0,-1))}).Else(()=>{const i=r.sample(t.add(it(-.01,0,0))).r.sub(r.sample(t.add(it(.01,0,0))).r),a=r.sample(t.add(it(0,-.01,0))).r.sub(r.sample(t.add(it(0,.01,0))).r),c=r.sample(t.add(it(0,0,-.01))).r.sub(r.sample(t.add(it(0,0,.01))).r);n.assign(it(i,a,c))}),n.normalize()});class qG extends ca{static get type(){return"Texture3DNode"}constructor(t,e=null,n=null){super(t,e,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return it(.5,.5,.5)}setUpdateMatrix(){}generateUV(t,e){return e.build(t,this.sampler===!0?"vec3":"ivec3")}generateOffset(t,e){return e.build(t,"ivec3")}normal(t){return WG({texture:this,uv:t})}}const Lx=xe(qG).setParameterLength(1,3),$G=(...r)=>Lx(...r).setSampler(!1),XG=(r,t,e)=>Lx(r,t).level(e);class jG extends Tx{static get type(){return"UserDataNode"}constructor(t,e,n=null){super(t,e,n),this.userData=n}updateReference(t){return this.reference=this.userData!==null?this.userData:t.object.userData,this.reference}}const YG=(r,t,e)=>new jG(r,t,e),zR=new WeakMap;class KG extends is{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=de.OBJECT,this.updateAfterType=de.OBJECT,this.previousModelWorldMatrix=Jt(new Te),this.previousProjectionMatrix=Jt(new Te).setGroup(ee),this.previousCameraViewMatrix=Jt(new Te)}setProjectionMatrix(t){this.projectionMatrix=t}update({frameId:t,camera:e,object:n}){const s=IR(n);this.previousModelWorldMatrix.value.copy(s);const i=eD(e);i.frameId!==t&&(i.frameId=t,i.previousProjectionMatrix===void 0?(i.previousProjectionMatrix=new Te,i.previousCameraViewMatrix=new Te,i.currentProjectionMatrix=new Te,i.currentCameraViewMatrix=new Te,i.previousProjectionMatrix.copy(this.projectionMatrix||e.projectionMatrix),i.previousCameraViewMatrix.copy(e.matrixWorldInverse)):(i.previousProjectionMatrix.copy(i.currentProjectionMatrix),i.previousCameraViewMatrix.copy(i.currentCameraViewMatrix)),i.currentProjectionMatrix.copy(this.projectionMatrix||e.projectionMatrix),i.currentCameraViewMatrix.copy(e.matrixWorldInverse),this.previousProjectionMatrix.value.copy(i.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(i.previousCameraViewMatrix))}updateAfter({object:t}){IR(t).copy(t.matrixWorld)}setup(){const t=this.projectionMatrix===null?rl:Jt(this.projectionMatrix),e=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),n=t.mul(Dc).mul(kn),s=this.previousProjectionMatrix.mul(e).mul(Ad),i=n.xy.div(n.w),a=s.xy.div(s.w);return De(i,a)}}function eD(r){let t=zR.get(r);return t===void 0&&(t={},zR.set(r,t)),t}function IR(r,t=0){const e=eD(r);let n=e[t];return n===void 0&&(e[t]=n=new Te,e[t].copy(r.matrixWorld)),n}const ZG=Xt(KG),QG=ut(([r])=>r_(r.rgb)),JG=ut(([r,t=k(1)])=>t.mix(r_(r.rgb),r.rgb)),tk=ut(([r,t=k(1)])=>{const e=xs(r.r,r.g,r.b).div(3),n=r.r.max(r.g.max(r.b)),s=n.sub(e).mul(t).mul(-3);return Ce(r.rgb,n,s)}),ek=ut(([r,t=k(1)])=>{const e=it(.57735,.57735,.57735),n=t.cos();return it(r.rgb.mul(n).add(e.cross(r.rgb).mul(t.sin()).add(e.mul(to(e,r.rgb).mul(n.oneMinus())))))}),r_=(r,t=it(qe.getLuminanceCoefficients(new G)))=>to(r,t),nk=ut(([r,t=it(1),e=it(0),n=it(1),s=k(1),i=it(qe.getLuminanceCoefficients(new G,_y))])=>{const a=r.rgb.dot(it(i)),c=qn(r.rgb.mul(t).add(e),0).toVar(),u=c.pow(n).toVar();return re(c.r.greaterThan(0),()=>{c.r.assign(u.r)}),re(c.g.greaterThan(0),()=>{c.g.assign(u.g)}),re(c.b.greaterThan(0),()=>{c.b.assign(u.b)}),c.assign(a.add(c.sub(a).mul(s))),se(c.rgb,r.a)}),sk=ut(([r,t])=>r.mul(t).floor().div(t));let ig=null;class ik extends Ax{static get type(){return"ViewportSharedTextureNode"}constructor(t=ia,e=null){ig===null&&(ig=new Dw),super(t,e,ig)}getTextureForReference(){return ig}updateReference(){return this}}const rk=xe(ik).setParameterLength(0,2),rg=new Ot;class nD extends ca{static get type(){return"PassTextureNode"}constructor(t,e){super(e),this.passNode=t,this.isPassTextureNode=!0,this.setUpdateMatrix(!1)}setup(t){const e=t.getNodeProperties(this);return e.passNode=this.passNode,super.setup(t)}clone(){return new this.constructor(this.passNode,this.value)}}class VR extends nD{static get type(){return"PassMultipleTextureNode"}constructor(t,e,n=!1){super(t,null),this.textureName=e,this.previousTexture=n,this.isPassMultipleTextureNode=!0}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(t){return this.updateTexture(),super.setup(t)}clone(){const t=new this.constructor(this.passNode,this.textureName,this.previousTexture);return t.uvNode=this.uvNode,t.levelNode=this.levelNode,t.biasNode=this.biasNode,t.sampler=this.sampler,t.depthNode=this.depthNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.offsetNode=this.offsetNode,t}}class ua extends is{static get type(){return"PassNode"}constructor(t,e,n,s={}){super("vec4"),this.scope=t,this.scene=e,this.camera=n,this.options=s,this._pixelRatio=1,this._width=1,this._height=1;const i=new Yr;i.isRenderTargetTexture=!0,i.name="depth";const a=new cl(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:ni,...s});a.texture.name="output",a.depthTexture=i,this.renderTarget=a,this.overrideMaterial=null,this.transparent=!0,this.opaque=!0,this.contextNode=null,this._contextNodeCache=null,this._textures={output:a.texture,depth:i},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Jt(0),this._cameraFar=Jt(0),this._mrt=null,this._layers=null,this._resolutionScale=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=de.FRAME,this.global=!0}setResolutionScale(t){return this._resolutionScale=t,this}getResolutionScale(){return this._resolutionScale}setResolution(t){return Wt("PassNode: .setResolution() is deprecated. Use .setResolutionScale() instead."),this.setResolutionScale(t)}getResolution(){return Wt("PassNode: .getResolution() is deprecated. Use .getResolutionScale() instead."),this.getResolutionScale()}setLayers(t){return this._layers=t,this}getLayers(){return this._layers}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}getTexture(t){let e=this._textures[t];return e===void 0&&(e=this.renderTarget.texture.clone(),e.name=t,this._textures[t]=e,this.renderTarget.textures.push(e)),e}getPreviousTexture(t){let e=this._previousTextures[t];return e===void 0&&(e=this.getTexture(t).clone(),this._previousTextures[t]=e),e}toggleTexture(t){const e=this._previousTextures[t];if(e!==void 0){const n=this._textures[t],s=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[s]=e,this._textures[t]=e,this._previousTextures[t]=n,this._textureNodes[t].updateTexture(),this._previousTextureNodes[t].updateTexture()}}getTextureNode(t="output"){let e=this._textureNodes[t];return e===void 0&&(e=new VR(this,t),e.updateTexture(),this._textureNodes[t]=e),e}getPreviousTextureNode(t="output"){let e=this._previousTextureNodes[t];return e===void 0&&(this._textureNodes[t]===void 0&&this.getTextureNode(t),e=new VR(this,t,!0),e.updateTexture(),this._previousTextureNodes[t]=e),e}getViewZNode(t="depth"){let e=this._viewZNodes[t];if(e===void 0){const n=this._cameraNear,s=this._cameraFar;this._viewZNodes[t]=e=qT(this.getTextureNode(t),n,s)}return e}getLinearDepthNode(t="depth"){let e=this._linearDepthNodes[t];if(e===void 0){const n=this._cameraNear,s=this._cameraFar,i=this.getViewZNode(t);this._linearDepthNodes[t]=e=md(i,n,s)}return e}async compileAsync(t){const e=t.getRenderTarget(),n=t.getMRT();t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),await t.compileAsync(this.scene,this.camera),t.setRenderTarget(e),t.setMRT(n)}setup({renderer:t}){return this.renderTarget.samples=this.options.samples===void 0?t.samples:this.options.samples,this.renderTarget.texture.type=t.getOutputBufferType(),this.scope===ua.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(t){const{renderer:e}=t,{scene:n}=this;let s,i;const a=e.getOutputRenderTarget();a&&a.isXRRenderTarget===!0?(i=1,s=e.xr.getCamera(),e.xr.updateCamera(s),rg.set(a.width,a.height)):(s=this.camera,i=e.getPixelRatio(),e.getSize(rg)),this._pixelRatio=i,this.setSize(rg.width,rg.height);const c=e.getRenderTarget(),u=e.getMRT(),d=e.autoClear,f=e.transparent,p=e.opaque,g=s.layers.mask,y=e.contextNode,x=n.overrideMaterial;this._cameraNear.value=s.near,this._cameraFar.value=s.far,this._layers!==null&&(s.layers.mask=this._layers.mask);for(const T in this._previousTextures)this.toggleTexture(T);this.overrideMaterial!==null&&(n.overrideMaterial=this.overrideMaterial),e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),e.autoClear=!0,e.transparent=this.transparent,e.opaque=this.opaque,this.contextNode!==null&&((this._contextNodeCache===null||this._contextNodeCache.version!==this.version)&&(this._contextNodeCache={version:this.version,context:ul({...e.contextNode.getFlowContextData(),...this.contextNode.getFlowContextData()})}),e.contextNode=this._contextNodeCache.context);const S=n.name;n.name=this.name?this.name:n.name,e.render(n,s),n.name=S,n.overrideMaterial=x,e.setRenderTarget(c),e.setMRT(u),e.autoClear=d,e.transparent=f,e.opaque=p,e.contextNode=y,s.layers.mask=g}setSize(t,e){this._width=t,this._height=e;const n=Math.floor(this._width*this._pixelRatio*this._resolutionScale),s=Math.floor(this._height*this._pixelRatio*this._resolutionScale);this.renderTarget.setSize(n,s),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(t,e,n,s){t===null?this._scissor=null:(this._scissor===null&&(this._scissor=new je),t.isVector4?this._scissor.copy(t):this._scissor.set(t,e,n,s),this._scissor.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setViewport(t,e,n,s){t===null?this._viewport=null:(this._viewport===null&&(this._viewport=new je),t.isVector4?this._viewport.copy(t):this._viewport.set(t,e,n,s),this._viewport.multiplyScalar(this._pixelRatio*this._resolutionScale).floor())}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}ua.COLOR="color";ua.DEPTH="depth";const ok=(r,t,e)=>new ua(ua.COLOR,r,t,e),ak=(r,t)=>new nD(r,t),lk=(r,t,e)=>new ua(ua.DEPTH,r,t,e);class ck extends ua{static get type(){return"ToonOutlinePassNode"}constructor(t,e,n,s,i){super(ua.COLOR,t,e),this.colorNode=n,this.thicknessNode=s,this.alphaNode=i,this._materialCache=new WeakMap,this.name="Outline Pass"}updateBefore(t){const{renderer:e}=t,n=e.getRenderObjectFunction();e.setRenderObjectFunction((s,i,a,c,u,d,f,p)=>{if((u.isMeshToonMaterial||u.isMeshToonNodeMaterial)&&u.wireframe===!1){const g=this._getOutlineMaterial(u);e.renderObject(s,i,a,c,g,d,f,p)}e.renderObject(s,i,a,c,u,d,f,p)}),super.updateBefore(t),e.setRenderObjectFunction(n)}_createMaterial(){const t=new ss;t.isMeshToonOutlineMaterial=!0,t.name="Toon_Outline",t.side=us;const e=nr.negate(),n=rl.mul(Dc),s=k(1),i=n.mul(se(kn,1)),a=n.mul(se(kn.add(e),1)),c=Qi(i.sub(a));return t.vertexNode=i.add(c.mul(this.thicknessNode).mul(i.w).mul(s)),t.colorNode=se(this.colorNode,this.alphaNode),t}_getOutlineMaterial(t){let e=this._materialCache.get(t);return e===void 0&&(e=this._createMaterial(),this._materialCache.set(t,e)),e}}const uk=(r,t,e=new qt(0,0,0),n=.003,s=1)=>new ck(r,t,Kt(e),Kt(n),Kt(s)),sD=ut(([r,t])=>r.mul(t).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),iD=ut(([r,t])=>(r=r.mul(t),r.div(r.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),rD=ut(([r,t])=>{r=r.mul(t),r=r.sub(.004).max(0);const e=r.mul(r.mul(6.2).add(.5)),n=r.mul(r.mul(6.2).add(1.7)).add(.06);return e.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),hk=ut(([r])=>{const t=r.mul(r.add(.0245786)).sub(90537e-9),e=r.mul(r.add(.432951).mul(.983729)).add(.238081);return t.div(e)}),oD=ut(([r,t])=>{const e=Ws(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=Ws(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return r=r.mul(t).div(.6),r=e.mul(r),r=hk(r),r=n.mul(r),r.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),dk=Ws(it(1.6605,-.1246,-.0182),it(-.5876,1.1329,-.1006),it(-.0728,-.0083,1.1187)),fk=Ws(it(.6274,.0691,.0164),it(.3293,.9195,.088),it(.0433,.0113,.8956)),pk=ut(([r])=>{const t=it(r).toVar(),e=it(t.mul(t)).toVar(),n=it(e.mul(e)).toVar();return k(15.5).mul(n.mul(e)).sub(fe(40.14,n.mul(t))).add(fe(31.96,n).sub(fe(6.868,e.mul(t))).add(fe(.4298,e).add(fe(.1191,t).sub(.00232))))}),aD=ut(([r,t])=>{const e=it(r).toVar(),n=Ws(it(.856627153315983,.137318972929847,.11189821299995),it(.0951212405381588,.761241990602591,.0767994186031903),it(.0482516061458583,.101439036467562,.811302368396859)),s=Ws(it(1.1271005818144368,-.1413297634984383,-.14132976349843826),it(-.11060664309660323,1.157823702216272,-.11060664309660294),it(-.016493938717834573,-.016493938717834257,1.2519364065950405)),i=k(-12.47393),a=k(4.026069);return e.mulAssign(t),e.assign(fk.mul(e)),e.assign(n.mul(e)),e.assign(qn(e,1e-10)),e.assign(ea(e)),e.assign(e.sub(i).div(a.sub(i))),e.assign(Ao(e,0,1)),e.assign(pk(e)),e.assign(s.mul(e)),e.assign($r(qn(it(0),e),it(2.2))),e.assign(dk.mul(e)),e.assign(Ao(e,0,1)),e}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),lD=ut(([r,t])=>{const e=k(.76),n=k(.15);r=r.mul(t);const s=er(r.r,er(r.g,r.b)),i=yi(s.lessThan(.08),s.sub(fe(6.25,s.mul(s))),.04);r.subAssign(i);const a=qn(r.r,qn(r.g,r.b));re(a.lessThan(e),()=>r);const c=De(1,e),u=De(1,c.mul(c).div(a.add(c.sub(e))));r.mulAssign(u.div(a));const d=De(1,vr(1,n.mul(a.sub(u)).add(1)));return Ce(r,it(u),d)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Os extends Zt{static get type(){return"CodeNode"}constructor(t="",e=[],n=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=t,this.includes=e,this.language=n}setIncludes(t){return this.includes=t,this}getIncludes(){return this.includes}generate(t){const e=this.getIncludes(t);for(const s of e)s.build(t);const n=t.getCodeFromNode(this,this.getNodeType(t));return n.code=this.code,n.code}serialize(t){super.serialize(t),t.code=this.code,t.language=this.language}deserialize(t){super.deserialize(t),this.code=t.code,this.language=t.language}}const Ox=xe(Os).setParameterLength(1,3),mk=(r,t)=>Ox(r,t,"js"),gk=(r,t)=>Ox(r,t,"wgsl"),yk=(r,t)=>Ox(r,t,"glsl");class cD extends Os{static get type(){return"FunctionNode"}constructor(t="",e=[],n=""){super(t,e,n)}getNodeType(t){return this.getNodeFunction(t).type}getMemberType(t,e){const n=this.getNodeType(t);return t.getStructTypeNode(n).getMemberType(t,e)}getInputs(t){return this.getNodeFunction(t).inputs}getNodeFunction(t){const e=t.getDataFromNode(this);let n=e.nodeFunction;return n===void 0&&(n=t.parser.parseFunction(this.code),e.nodeFunction=n),n}generate(t,e){super.generate(t);const n=this.getNodeFunction(t),s=n.name,i=n.type,a=t.getCodeFromNode(this,i);s!==""&&(a.name=s);const c=t.getPropertyName(a),u=this.getNodeFunction(t).getCode(c);return a.code=u+`
`,e==="property"?c:t.format(`${c}()`,i,e)}}const uD=(r,t=[],e="")=>{for(let i=0;i<t.length;i++){const a=t[i];typeof a=="function"&&(t[i]=a.functionNode)}const n=new cD(r,t,e),s=(...i)=>n.call(...i);return s.functionNode=n,s},xk=(r,t)=>uD(r,t,"glsl"),bk=(r,t)=>uD(r,t,"wgsl");function o_(r){let t;const e=r.context.getViewZ;return e!==void 0&&(t=e(this)),(t||cs.z).negate()}const hD=ut(([r,t],e)=>{const n=o_(e);return No(r,t,n)}),dD=ut(([r],t)=>{const e=o_(t);return r.mul(r,e,e).negate().exp().oneMinus()}),Sk=ut(([r,t],e)=>{const n=o_(e),i=t.sub(ra.y).max(0).toConst().mul(n).toConst();return r.mul(r,i,i).negate().exp().oneMinus()}),aw=ut(([r,t])=>se(t.toFloat().mix(fd.rgb,r.toVec3()),fd.a));let ou=null,au=null;class wk extends Zt{static get type(){return"RangeNode"}constructor(t=k(),e=k()){super(),this.minNode=t,this.maxNode=e}getVectorLength(t){const e=this.getConstNode(this.minNode),n=this.getConstNode(this.maxNode),s=t.getTypeLength(fc(e.value)),i=t.getTypeLength(fc(n.value));return s>i?s:i}getNodeType(t){return t.object.count>1?t.getTypeFromLength(this.getVectorLength(t)):"float"}getConstNode(t){let e=null;if(t.traverse(n=>{n.isConstNode===!0&&(e=n)}),e===null)throw new Z5('THREE.TSL: No "ConstNode" found in node graph.',this.stackTrace);return e}setup(t){const e=t.object;let n=null;if(e.count>1){const s=this.getConstNode(this.minNode),i=this.getConstNode(this.maxNode),a=s.value,c=i.value,u=t.getTypeLength(fc(a)),d=t.getTypeLength(fc(c));ou=ou||new je,au=au||new je,ou.setScalar(0),au.setScalar(0),u===1?ou.setScalar(a):a.isColor?ou.set(a.r,a.g,a.b,1):ou.set(a.x,a.y,a.z||0,a.w||0),d===1?au.setScalar(c):c.isColor?au.set(c.r,c.g,c.b,1):au.set(c.x,c.y,c.z||0,c.w||0);const f=4,p=f*e.count,g=new Float32Array(p);for(let S=0;S<p;S++){const T=S%f,M=ou.getComponent(T),N=au.getComponent(T);g[S]=xt.lerp(M,N,Math.random())}const y=this.getNodeType(t);if(e.count*4*4<=t.getUniformBufferLimit())n=jp(g,"vec4",e.count).element(oa).convert(y);else{const S=new bc(g,4);t.geometry.setAttribute("__range"+this.id,S),n=Py(S).convert(y)}}else n=k(0);return n}}const Tk=xe(wk).setParameterLength(2);class _k extends Zt{static get type(){return"ComputeBuiltinNode"}constructor(t,e){super(e),this._builtinName=t}getHash(t){return this.getBuiltinName(t)}getNodeType(){return this.nodeType}setBuiltinName(t){return this._builtinName=t,this}getBuiltinName(){return this._builtinName}hasBuiltin(t){return t.hasBuiltin(this._builtinName)}generate(t,e){const n=this.getBuiltinName(t),s=this.getNodeType(t);return t.shaderStage==="compute"?t.format(n,s,e):(Wt(`ComputeBuiltinNode: Compute built-in value ${n} can not be accessed in the ${t.shaderStage} stage`),t.generateConst(s))}serialize(t){super.serialize(t),t.global=this.global,t._builtinName=this._builtinName}deserialize(t){super.deserialize(t),this.global=t.global,this._builtinName=t._builtinName}}const Qp=(r,t)=>new _k(r,t),Mk=Qp("numWorkgroups","uvec3"),vk=Qp("workgroupId","uvec3"),Ak=Qp("globalId","uvec3"),Nk=Qp("localId","uvec3"),Rk=Qp("subgroupSize","uint");class Ek extends Zt{constructor(t){super(),this.scope=t}generate(t){const{scope:e}=this,{renderer:n}=t;n.backend.isWebGLBackend===!0?t.addFlowCode(`	// ${e}Barrier 
`):t.addLineFlowCode(`${e}Barrier()`,this)}}const a_=xe(Ek),Ck=()=>a_("workgroup").toStack(),Bk=()=>a_("storage").toStack(),Dk=()=>a_("texture").toStack();class Lk extends ku{constructor(t,e){super(t,e),this.isWorkgroupInfoElementNode=!0}generate(t,e){let n;const s=t.context.assign;if(n=super.generate(t),s!==!0){const i=this.getNodeType(t);n=t.format(n,i,e)}return n}}class Ok extends Zt{constructor(t,e,n=0){super(e),this.bufferType=e,this.bufferCount=n,this.isWorkgroupInfoNode=!0,this.elementType=e,this.scope=t,this.name=""}setName(t){return this.name=t,this}label(t){return Wt('TSL: "label()" has been deprecated. Use "setName()" instead.',new ds),this.setName(t)}setScope(t){return this.scope=t,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(t){return new Lk(this,t)}generate(t){const e=this.name!==""?this.name:`${this.scope}Array_${this.id}`;return t.getScopedArray(e,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const Fk=(r,t)=>new Ok("Workgroup",r,t);class Ps extends Zt{static get type(){return"AtomicFunctionNode"}constructor(t,e,n){super("uint"),this.method=t,this.pointerNode=e,this.valueNode=n,this.parents=!0}getInputType(t){return this.pointerNode.getNodeType(t)}getNodeType(t){return this.getInputType(t)}generate(t){const e=t.getNodeProperties(this),n=e.parents,s=this.method,i=this.getNodeType(t),a=this.getInputType(t),c=this.pointerNode,u=this.valueNode,d=[];d.push(`&${c.build(t,a)}`),u!==null&&d.push(u.build(t,a));const f=`${t.getMethod(s,i)}( ${d.join(", ")} )`;if(n?n.length===1&&n[0].isStackNode===!0:!1)t.addLineFlowCode(f,this);else return e.constNode===void 0&&(e.constNode=_o(f,i).toConst()),e.constNode.build(t)}}Ps.ATOMIC_LOAD="atomicLoad";Ps.ATOMIC_STORE="atomicStore";Ps.ATOMIC_ADD="atomicAdd";Ps.ATOMIC_SUB="atomicSub";Ps.ATOMIC_MAX="atomicMax";Ps.ATOMIC_MIN="atomicMin";Ps.ATOMIC_AND="atomicAnd";Ps.ATOMIC_OR="atomicOr";Ps.ATOMIC_XOR="atomicXor";const Uk=xe(Ps),fa=(r,t,e)=>Uk(r,t,e).toStack(),Pk=r=>fa(Ps.ATOMIC_LOAD,r,null),zk=(r,t)=>fa(Ps.ATOMIC_STORE,r,t),Ik=(r,t)=>fa(Ps.ATOMIC_ADD,r,t),Vk=(r,t)=>fa(Ps.ATOMIC_SUB,r,t),Gk=(r,t)=>fa(Ps.ATOMIC_MAX,r,t),kk=(r,t)=>fa(Ps.ATOMIC_MIN,r,t),Hk=(r,t)=>fa(Ps.ATOMIC_AND,r,t),Wk=(r,t)=>fa(Ps.ATOMIC_OR,r,t),qk=(r,t)=>fa(Ps.ATOMIC_XOR,r,t);class jt extends is{static get type(){return"SubgroupFunctionNode"}constructor(t,e=null,n=null){super(),this.method=t,this.aNode=e,this.bNode=n}getInputType(t){const e=this.aNode?this.aNode.getNodeType(t):null,n=this.bNode?this.bNode.getNodeType(t):null,s=t.isMatrix(e)?0:t.getTypeLength(e),i=t.isMatrix(n)?0:t.getTypeLength(n);return s>i?e:n}getNodeType(t){const e=this.method;return e===jt.SUBGROUP_ELECT?"bool":e===jt.SUBGROUP_BALLOT?"uvec4":this.getInputType(t)}generate(t,e){const n=this.method,s=this.getNodeType(t),i=this.getInputType(t),a=this.aNode,c=this.bNode,u=[];if(n===jt.SUBGROUP_BROADCAST||n===jt.SUBGROUP_SHUFFLE||n===jt.QUAD_BROADCAST){const f=c.getNodeType(t);u.push(a.build(t,s),c.build(t,f==="float"?"int":s))}else n===jt.SUBGROUP_SHUFFLE_XOR||n===jt.SUBGROUP_SHUFFLE_DOWN||n===jt.SUBGROUP_SHUFFLE_UP?u.push(a.build(t,s),c.build(t,"uint")):(a!==null&&u.push(a.build(t,i)),c!==null&&u.push(c.build(t,i)));const d=u.length===0?"()":`( ${u.join(", ")} )`;return t.format(`${t.getMethod(n,s)}${d}`,s,e)}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}jt.SUBGROUP_ELECT="subgroupElect";jt.SUBGROUP_BALLOT="subgroupBallot";jt.SUBGROUP_ADD="subgroupAdd";jt.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd";jt.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd";jt.SUBGROUP_MUL="subgroupMul";jt.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul";jt.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul";jt.SUBGROUP_AND="subgroupAnd";jt.SUBGROUP_OR="subgroupOr";jt.SUBGROUP_XOR="subgroupXor";jt.SUBGROUP_MIN="subgroupMin";jt.SUBGROUP_MAX="subgroupMax";jt.SUBGROUP_ALL="subgroupAll";jt.SUBGROUP_ANY="subgroupAny";jt.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst";jt.QUAD_SWAP_X="quadSwapX";jt.QUAD_SWAP_Y="quadSwapY";jt.QUAD_SWAP_DIAGONAL="quadSwapDiagonal";jt.SUBGROUP_BROADCAST="subgroupBroadcast";jt.SUBGROUP_SHUFFLE="subgroupShuffle";jt.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor";jt.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp";jt.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown";jt.QUAD_BROADCAST="quadBroadcast";const $k=Gt(jt,jt.SUBGROUP_ELECT).setParameterLength(0),Xk=Gt(jt,jt.SUBGROUP_BALLOT).setParameterLength(1),jk=Gt(jt,jt.SUBGROUP_ADD).setParameterLength(1),Yk=Gt(jt,jt.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),Kk=Gt(jt,jt.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),Zk=Gt(jt,jt.SUBGROUP_MUL).setParameterLength(1),Qk=Gt(jt,jt.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),Jk=Gt(jt,jt.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),t9=Gt(jt,jt.SUBGROUP_AND).setParameterLength(1),e9=Gt(jt,jt.SUBGROUP_OR).setParameterLength(1),n9=Gt(jt,jt.SUBGROUP_XOR).setParameterLength(1),s9=Gt(jt,jt.SUBGROUP_MIN).setParameterLength(1),i9=Gt(jt,jt.SUBGROUP_MAX).setParameterLength(1),r9=Gt(jt,jt.SUBGROUP_ALL).setParameterLength(0),o9=Gt(jt,jt.SUBGROUP_ANY).setParameterLength(0),a9=Gt(jt,jt.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),l9=Gt(jt,jt.QUAD_SWAP_X).setParameterLength(1),c9=Gt(jt,jt.QUAD_SWAP_Y).setParameterLength(1),u9=Gt(jt,jt.QUAD_SWAP_DIAGONAL).setParameterLength(1),h9=Gt(jt,jt.SUBGROUP_BROADCAST).setParameterLength(2),d9=Gt(jt,jt.SUBGROUP_SHUFFLE).setParameterLength(2),f9=Gt(jt,jt.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),p9=Gt(jt,jt.SUBGROUP_SHUFFLE_UP).setParameterLength(2),m9=Gt(jt,jt.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),g9=Gt(jt,jt.QUAD_BROADCAST).setParameterLength(1);let og;function Fx(r){og=og||new WeakMap;let t=og.get(r);return t===void 0&&og.set(r,t={}),t}function Ux(r){const t=Fx(r);return t.shadowMatrix||(t.shadowMatrix=Jt("mat4").setGroup(ee).onRenderUpdate(e=>((r.castShadow!==!0||e.renderer.shadowMap.enabled===!1)&&(r.shadow.camera.coordinateSystem!==e.camera.coordinateSystem&&(r.shadow.camera.coordinateSystem=e.camera.coordinateSystem,r.shadow.camera.updateProjectionMatrix()),r.shadow.updateMatrices(r)),r.shadow.matrix)))}function fD(r,t=ra){const e=Ux(r).mul(t);return e.xyz.div(e.w)}function l_(r){const t=Fx(r);return t.position||(t.position=Jt(new G).setGroup(ee).onRenderUpdate((e,n)=>n.value.setFromMatrixPosition(r.matrixWorld)))}function pD(r){const t=Fx(r);return t.targetPosition||(t.targetPosition=Jt(new G).setGroup(ee).onRenderUpdate((e,n)=>n.value.setFromMatrixPosition(r.target.matrixWorld)))}function c_(r){const t=Fx(r);return t.viewPosition||(t.viewPosition=Jt(new G).setGroup(ee).onRenderUpdate(({camera:e},n)=>{n.value=n.value||new G,n.value.setFromMatrixPosition(r.matrixWorld),n.value.applyMatrix4(e.matrixWorldInverse)}))}const u_=r=>so.transformDirection(l_(r).sub(pD(r))),y9=r=>r.sort((t,e)=>t.id-e.id),x9=(r,t)=>{for(const e of t)if(e.isAnalyticLightNode&&e.light.id===r)return e;return null},KS=new WeakMap,Hf=[];class h_ extends Zt{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=il("vec3","totalDiffuse"),this.totalSpecularNode=il("vec3","totalSpecular"),this.outgoingLightNode=il("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const t=this._lights;for(let n=0;n<t.length;n++){const s=t[n];if(Hf.push(s.id),Hf.push(s.castShadow?1:0),s.isSpotLight===!0){const i=s.map!==null?s.map.id:-1,a=s.colorNode?s.colorNode.getCacheKey():-1;Hf.push(i,a)}}const e=qp(Hf);return Hf.length=0,e}getHash(t){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(t);const e=[];for(const n of this._lightNodes)e.push(n.getHash());this._lightNodesHash="lights-"+e.join(",")}return this._lightNodesHash}analyze(t){const e=t.getNodeProperties(this);for(const n of e.nodes)n.build(t);e.outputNode.build(t)}setupLightsNode(t){const e=[],n=this._lightNodes,s=y9(this._lights),i=t.renderer.library;for(const a of s)if(a.isNode)e.push(Kt(a));else{let c=null;if(n!==null&&(c=x9(a.id,n)),c===null){const u=i.getLightNodeClass(a.constructor);if(u===null){Wt(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let d=null;KS.has(a)?d=KS.get(a):(d=new u(a),KS.set(a,d)),e.push(d)}}this._lightNodes=e}setupDirectLight(t,e,n){const{lightingModel:s,reflectedLight:i}=t.context;s.direct({...n,lightNode:e,reflectedLight:i},t)}setupDirectRectAreaLight(t,e,n){const{lightingModel:s,reflectedLight:i}=t.context;s.directRectArea({...n,lightNode:e,reflectedLight:i},t)}setupLights(t,e){for(const n of e)n.build(t)}getLightNodes(t){return this._lightNodes===null&&this.setupLightsNode(t),this._lightNodes}setup(t){const e=t.lightsNode;t.lightsNode=this;let n=this.outgoingLightNode;const s=t.context,i=s.lightingModel,a=t.getNodeProperties(this);if(i){const{totalDiffuseNode:c,totalSpecularNode:u}=this;s.outgoingLight=n;const d=t.addStack();a.nodes=d.nodes,i.start(t);const{backdrop:f,backdropAlpha:p}=s,{directDiffuse:g,directSpecular:y,indirectDiffuse:x,indirectSpecular:S}=s.reflectedLight;let T=g.add(x);f!==null&&(p!==null?T=it(p.mix(T,f)):T=it(f)),c.assign(T),u.assign(y.add(S)),n.assign(c.add(u)),i.finish(t),n=n.bypass(t.removeStack())}else a.nodes=[];return t.lightsNode=e,n}setLights(t){return this._lights=t,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const b9=(r=[])=>new h_().setLights(r);class S9 extends Zt{static get type(){return"ShadowBaseNode"}constructor(t){super(),this.light=t,this.updateBeforeType=de.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:t,material:e}){d_.assign(e.receivedShadowPositionNode||t.shadowPositionWorld||ra)}}const d_=il("vec3","shadowPositionWorld");function w9(r,t={}){return t.toneMapping=r.toneMapping,t.toneMappingExposure=r.toneMappingExposure,t.outputColorSpace=r.outputColorSpace,t.renderTarget=r.getRenderTarget(),t.activeCubeFace=r.getActiveCubeFace(),t.activeMipmapLevel=r.getActiveMipmapLevel(),t.renderObjectFunction=r.getRenderObjectFunction(),t.pixelRatio=r.getPixelRatio(),t.mrt=r.getMRT(),t.clearColor=r.getClearColor(t.clearColor||new qt),t.clearAlpha=r.getClearAlpha(),t.autoClear=r.autoClear,t.scissorTest=r.getScissorTest(),t}function T9(r,t){return t=w9(r,t),r.setMRT(null),r.setRenderObjectFunction(null),r.setClearColor(0,1),r.autoClear=!0,t}function _9(r,t){r.toneMapping=t.toneMapping,r.toneMappingExposure=t.toneMappingExposure,r.outputColorSpace=t.outputColorSpace,r.setRenderTarget(t.renderTarget,t.activeCubeFace,t.activeMipmapLevel),r.setRenderObjectFunction(t.renderObjectFunction),r.setPixelRatio(t.pixelRatio),r.setMRT(t.mrt),r.setClearColor(t.clearColor,t.clearAlpha),r.autoClear=t.autoClear,r.setScissorTest(t.scissorTest)}function M9(r,t={}){return t.background=r.background,t.backgroundNode=r.backgroundNode,t.overrideMaterial=r.overrideMaterial,t}function v9(r,t){return t=M9(r,t),r.background=null,r.backgroundNode=null,r.overrideMaterial=null,t}function A9(r,t){r.background=t.background,r.backgroundNode=t.backgroundNode,r.overrideMaterial=t.overrideMaterial}function N9(r,t,e){return e=T9(r,e),e=v9(t,e),e}function R9(r,t,e){_9(r,e),A9(t,e)}const Gy=new WeakMap,mD=ut(({depthTexture:r,shadowCoord:t,depthLayer:e})=>{let n=He(r,t.xy).setName("t_basic");return r.isArrayTexture&&(n=n.depth(e)),n.compare(t.z)}),gD=ut(({depthTexture:r,shadowCoord:t,shadow:e,depthLayer:n})=>{const s=(f,p)=>{let g=He(r,f);return r.isArrayTexture&&(g=g.depth(n)),g.compare(p)},i=Nn("mapSize","vec2",e).setGroup(ee),a=Nn("radius","float",e).setGroup(ee),c=It(1).div(i),u=a.mul(c.x),d=i_(Wu.xy).mul(6.28318530718);return xs(s(t.xy.add(wo(0,5,d).mul(u)),t.z),s(t.xy.add(wo(1,5,d).mul(u)),t.z),s(t.xy.add(wo(2,5,d).mul(u)),t.z),s(t.xy.add(wo(3,5,d).mul(u)),t.z),s(t.xy.add(wo(4,5,d).mul(u)),t.z)).mul(1/5)}),yD=ut(({depthTexture:r,shadowCoord:t,shadow:e,depthLayer:n})=>{const s=(p,g)=>{let y=He(r,p);return r.isArrayTexture&&(y=y.depth(n)),y.compare(g)},i=Nn("mapSize","vec2",e).setGroup(ee),a=It(1).div(i),c=a.x,u=a.y,d=t.xy,f=vo(d.mul(i).add(.5));return d.subAssign(f.mul(a)),xs(s(d,t.z),s(d.add(It(c,0)),t.z),s(d.add(It(0,u)),t.z),s(d.add(a),t.z),Ce(s(d.add(It(c.negate(),0)),t.z),s(d.add(It(c.mul(2),0)),t.z),f.x),Ce(s(d.add(It(c.negate(),u)),t.z),s(d.add(It(c.mul(2),u)),t.z),f.x),Ce(s(d.add(It(0,u.negate())),t.z),s(d.add(It(0,u.mul(2))),t.z),f.y),Ce(s(d.add(It(c,u.negate())),t.z),s(d.add(It(c,u.mul(2))),t.z),f.y),Ce(Ce(s(d.add(It(c.negate(),u.negate())),t.z),s(d.add(It(c.mul(2),u.negate())),t.z),f.x),Ce(s(d.add(It(c.negate(),u.mul(2))),t.z),s(d.add(It(c.mul(2),u.mul(2))),t.z),f.x),f.y)).mul(1/9)}),xD=ut(({depthTexture:r,shadowCoord:t,depthLayer:e},n)=>{let s=He(r).sample(t.xy);r.isArrayTexture&&(s=s.depth(e)),s=s.rg;const i=s.x,a=qn(1e-7,s.y.mul(s.y)),c=n.renderer.reversedDepthBuffer?vd(i,t.z):vd(t.z,i),u=k(1).toVar();return re(c.notEqual(1),()=>{const d=t.z.sub(i);let f=a.div(a.add(d.mul(d)));f=Ao(De(f,.3).div(.65)),u.assign(qn(c,f))}),u}),bD=r=>{let t=Gy.get(r);return t===void 0&&(t=new ss,t.colorNode=se(0,0,0,1),t.isShadowPassMaterial=!0,t.name="ShadowMaterial",t.blending=tl,t.fog=!1,Gy.set(r,t)),t},SD=r=>{const t=Gy.get(r);t!==void 0&&(t.dispose(),Gy.delete(r))},GR=new Nc,qh=[],wD=(r,t,e,n)=>{qh[0]=r,qh[1]=t;let s=GR.get(qh);return(s===void 0||s.shadowType!==e||s.useVelocity!==n)&&(s=(i,a,c,u,d,f,...p)=>{(i.castShadow===!0||i.receiveShadow&&e===cp)&&(n&&(yC(i).useVelocity=!0),i.onBeforeShadow(r,i,c,t.camera,u,a.overrideMaterial,f),r.renderObject(i,a,c,u,d,f,...p),i.onAfterShadow(r,i,c,t.camera,u,a.overrideMaterial,f))},s.shadowType=e,s.useVelocity=n,GR.set(qh,s)),qh[0]=null,qh[1]=null,s},E9=ut(({samples:r,radius:t,size:e,shadowPass:n,depthLayer:s})=>{const i=k(0).toVar("meanVertical"),a=k(0).toVar("squareMeanVertical"),c=r.lessThanEqual(k(1)).select(k(0),k(2).div(r.sub(1))),u=r.lessThanEqual(k(1)).select(k(0),k(-1));on({start:J(0),end:J(r),type:"int",condition:"<"},({i:f})=>{const p=u.add(k(f).mul(c));let g=n.sample(xs(Wu.xy,It(0,p).mul(t)).div(e));n.value.isArrayTexture&&(g=g.depth(s)),g=g.x,i.addAssign(g),a.addAssign(g.mul(g))}),i.divAssign(r),a.divAssign(r);const d=Di(a.sub(i.mul(i)).max(0));return It(i,d)}),C9=ut(({samples:r,radius:t,size:e,shadowPass:n,depthLayer:s})=>{const i=k(0).toVar("meanHorizontal"),a=k(0).toVar("squareMeanHorizontal"),c=r.lessThanEqual(k(1)).select(k(0),k(2).div(r.sub(1))),u=r.lessThanEqual(k(1)).select(k(0),k(-1));on({start:J(0),end:J(r),type:"int",condition:"<"},({i:f})=>{const p=u.add(k(f).mul(c));let g=n.sample(xs(Wu.xy,It(p,0).mul(t)).div(e));n.value.isArrayTexture&&(g=g.depth(s)),i.addAssign(g.x),a.addAssign(xs(g.y.mul(g.y),g.x.mul(g.x)))}),i.divAssign(r),a.divAssign(r);const d=Di(a.sub(i.mul(i)).max(0));return It(i,d)}),B9=[mD,gD,yD,xD];let ZS;const ag=new Bx;class TD extends S9{static get type(){return"ShadowNode"}constructor(t,e=null){super(t),this.shadow=e||t.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._currentShadowType=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0,this.depthLayer=0}setupShadowFilter(t,{filterFn:e,depthTexture:n,shadowCoord:s,shadow:i,depthLayer:a}){const c=s.x.greaterThanEqual(0).and(s.x.lessThanEqual(1)).and(s.y.greaterThanEqual(0)).and(s.y.lessThanEqual(1)).and(s.z.lessThanEqual(1)),u=e({depthTexture:n,shadowCoord:s,shadow:i,depthLayer:a});return c.select(u,k(1))}setupShadowCoord(t,e){const{shadow:n}=this,{renderer:s}=t,i=n.biasNode||Nn("bias","float",n).setGroup(ee);let a=e,c;if(n.camera.isOrthographicCamera||s.logarithmicDepthBuffer!==!0)a=a.xyz.div(a.w),c=a.z;else{const u=a.w;a=a.xy.div(u);const d=Nn("near","float",n.camera).setGroup(ee),f=Nn("far","float",n.camera).setGroup(ee);c=$T(u.negate(),d,f)}return a=it(a.x,a.y.oneMinus(),s.reversedDepthBuffer?c.sub(i):c.add(i)),a}getShadowFilterFn(t){return B9[t]}setupRenderTarget(t,e){const n=new Yr(t.mapSize.width,t.mapSize.height);n.name="ShadowDepthTexture",n.compareFunction=e.renderer.reversedDepthBuffer?nx:ex;const s=e.createRenderTarget(t.mapSize.width,t.mapSize.height);return s.texture.name="ShadowMap",s.texture.type=t.mapType,s.depthTexture=n,{shadowMap:s,depthTexture:n}}setupShadow(t){const{renderer:e,camera:n}=t,{light:s,shadow:i}=this,{depthTexture:a,shadowMap:c}=this.setupRenderTarget(i,t),u=e.shadowMap.type;if(u===R3||u===OF?(a.minFilter=qs,a.magFilter=qs):(a.minFilter=ts,a.magFilter=ts),i.camera.coordinateSystem=n.coordinateSystem,i.camera.updateProjectionMatrix(),u===cp&&i.isPointLightShadow!==!0){a.compareFunction=null,c.depth>1?(c._vsmShadowMapVertical||(c._vsmShadowMapVertical=t.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:jo,type:ni,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapVertical.texture.name="VSMVertical"),this.vsmShadowMapVertical=c._vsmShadowMapVertical,c._vsmShadowMapHorizontal||(c._vsmShadowMapHorizontal=t.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:jo,type:ni,depth:c.depth,depthBuffer:!1}),c._vsmShadowMapHorizontal.texture.name="VSMHorizontal"),this.vsmShadowMapHorizontal=c._vsmShadowMapHorizontal):(this.vsmShadowMapVertical=t.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:jo,type:ni,depthBuffer:!1}),this.vsmShadowMapHorizontal=t.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:jo,type:ni,depthBuffer:!1}));let v=He(a);a.isArrayTexture&&(v=v.depth(this.depthLayer));let A=He(this.vsmShadowMapVertical.texture);a.isArrayTexture&&(A=A.depth(this.depthLayer));const R=Nn("blurSamples","float",i).setGroup(ee),F=Nn("radius","float",i).setGroup(ee),D=Nn("mapSize","vec2",i).setGroup(ee);let O=this.vsmMaterialVertical||(this.vsmMaterialVertical=new ss);O.fragmentNode=E9({samples:R,radius:F,size:D,shadowPass:v,depthLayer:this.depthLayer}).context(t.getSharedContext()),O.name="VSMVertical",O=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new ss),O.fragmentNode=C9({samples:R,radius:F,size:D,shadowPass:A,depthLayer:this.depthLayer}).context(t.getSharedContext()),O.name="VSMHorizontal"}const d=Nn("intensity","float",i).setGroup(ee),f=Nn("normalBias","float",i).setGroup(ee),p=Ux(s).mul(d_.add(Lc.mul(f))),g=this.setupShadowCoord(t,p),y=i.filterNode||this.getShadowFilterFn(e.shadowMap.type)||null;if(y===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const x=u===cp&&i.isPointLightShadow!==!0?this.vsmShadowMapHorizontal.texture:a,S=this.setupShadowFilter(t,{filterFn:y,shadowTexture:c.texture,depthTexture:x,shadowCoord:g,shadow:i,depthLayer:this.depthLayer});let T;e.shadowMap.transmitted===!0&&(c.texture.isCubeTexture?T=Ci(c.texture,g.xyz):(T=He(c.texture,g),a.isArrayTexture&&(T=T.depth(this.depthLayer))));let M;T?M=Ce(1,S.rgb.mix(T,1),d.mul(T.a)).toVar():M=Ce(1,S,d).toVar(),this.shadowMap=c,this.shadow.map=c;const N=`${this.light.type} Shadow [ ${this.light.name||"ID: "+this.light.id} ]`;return T&&M.toInspector(`${N} / Color`,()=>this.shadowMap.texture.isCubeTexture?Ci(this.shadowMap.texture):He(this.shadowMap.texture)),M.toInspector(`${N} / Depth`,()=>this.shadowMap.texture.isCubeTexture?Ci(this.shadowMap.texture).r.oneMinus():Zn(this.shadowMap.depthTexture,cn().mul(wc(He(this.shadowMap.depthTexture)))).r.oneMinus())}setup(t){if(t.renderer.shadowMap.enabled!==!1)return ut(()=>{const e=t.renderer.shadowMap.type;this._currentShadowType!==e&&(this._reset(),this._node=null);let n=this._node;return this.setupShadowPosition(t),n===null&&(this._node=n=this.setupShadow(t),this._currentShadowType=e),t.material.receivedShadowNode&&(n=t.material.receivedShadowNode(n)),n})()}renderShadow(t){const{shadow:e,shadowMap:n,light:s}=this,{renderer:i,scene:a}=t;e.updateMatrices(s),n.setSize(e.mapSize.width,e.mapSize.height,n.depth);const c=a.name;a.name=`Shadow Map [ ${s.name||"ID: "+s.id} ]`,i.render(a,e.camera),a.name=c}updateShadow(t){const{shadowMap:e,light:n,shadow:s}=this,{renderer:i,scene:a,camera:c}=t,u=i.shadowMap.type,d=e.depthTexture.version;this._depthVersionCached=d;const f=s.camera.layers.mask;(s.camera.layers.mask&4294967294)===0&&(s.camera.layers.mask=c.layers.mask);const p=i.getRenderObjectFunction(),g=i.getMRT(),y=g?g.has("velocity"):!1;ZS=N9(i,a,ZS),a.overrideMaterial=bD(n),i.setRenderObjectFunction(wD(i,s,u,y)),i.setClearColor(0,0),i.setRenderTarget(e),this.renderShadow(t),i.setRenderObjectFunction(p),u===cp&&s.isPointLightShadow!==!0&&this.vsmPass(i),s.camera.layers.mask=f,R9(i,a,ZS)}vsmPass(t){const{shadow:e}=this,n=this.shadowMap.depth;this.vsmShadowMapVertical.setSize(e.mapSize.width,e.mapSize.height,n),this.vsmShadowMapHorizontal.setSize(e.mapSize.width,e.mapSize.height,n),t.setRenderTarget(this.vsmShadowMapVertical),ag.material=this.vsmMaterialVertical,ag.render(t),t.setRenderTarget(this.vsmShadowMapHorizontal),ag.material=this.vsmMaterialHorizontal,ag.render(t)}dispose(){this._reset(),super.dispose()}_reset(){this._currentShadowType=null,SD(this.light),this.shadowMap&&(this.shadowMap.dispose(),this.shadowMap=null),this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null)}updateBefore(t){const{shadow:e}=this;let n=e.needsUpdate||e.autoUpdate;n&&(this._cameraFrameId[t.camera]===t.frameId&&(n=!1),this._cameraFrameId[t.camera]=t.frameId),n&&(this.updateShadow(t),this.shadowMap.depthTexture.version===this._depthVersionCached&&(e.needsUpdate=!1))}}const _D=(r,t)=>new TD(r,t),D9=new qt,kR=new Te,Wf=new G,QS=new G,L9=[new G(1,0,0),new G(-1,0,0),new G(0,-1,0),new G(0,1,0),new G(0,0,1),new G(0,0,-1)],O9=[new G(0,-1,0),new G(0,-1,0),new G(0,0,-1),new G(0,0,1),new G(0,-1,0),new G(0,-1,0)],F9=[new G(1,0,0),new G(-1,0,0),new G(0,1,0),new G(0,-1,0),new G(0,0,1),new G(0,0,-1)],U9=[new G(0,-1,0),new G(0,-1,0),new G(0,0,1),new G(0,0,-1),new G(0,-1,0),new G(0,-1,0)],MD=ut(({depthTexture:r,bd3D:t,dp:e})=>Ci(r,t).compare(e)),vD=ut(({depthTexture:r,bd3D:t,dp:e,shadow:n})=>{const s=Nn("radius","float",n).setGroup(ee),i=Nn("mapSize","vec2",n).setGroup(ee),a=s.div(i.x),c=xn(t),u=Qi(ol(t,c.x.greaterThan(c.z).select(it(0,1,0),it(1,0,0)))),d=ol(t,u),f=i_(Wu.xy).mul(6.28318530718),p=wo(0,5,f),g=wo(1,5,f),y=wo(2,5,f),x=wo(3,5,f),S=wo(4,5,f);return Ci(r,t.add(u.mul(p.x).add(d.mul(p.y)).mul(a))).compare(e).add(Ci(r,t.add(u.mul(g.x).add(d.mul(g.y)).mul(a))).compare(e)).add(Ci(r,t.add(u.mul(y.x).add(d.mul(y.y)).mul(a))).compare(e)).add(Ci(r,t.add(u.mul(x.x).add(d.mul(x.y)).mul(a))).compare(e)).add(Ci(r,t.add(u.mul(S.x).add(d.mul(S.y)).mul(a))).compare(e)).mul(1/5)}),P9=ut(({filterFn:r,depthTexture:t,shadowCoord:e,shadow:n},s)=>{const i=e.xyz.toConst(),a=i.abs().toConst(),c=a.x.max(a.y).max(a.z),u=Jt("float").setGroup(ee).onRenderUpdate(()=>n.camera.near),d=Jt("float").setGroup(ee).onRenderUpdate(()=>n.camera.far),f=Nn("bias","float",n).setGroup(ee),p=k(1).toVar();return re(c.sub(d).lessThanEqual(0).and(c.sub(u).greaterThanEqual(0)),()=>{let g;s.renderer.reversedDepthBuffer?(g=gB(c.negate(),u,d),g.subAssign(f)):(g=WT(c.negate(),u,d),g.addAssign(f));const y=i.normalize();p.assign(r({depthTexture:t,bd3D:y,dp:g,shadow:n}))}),p});class z9 extends TD{static get type(){return"PointShadowNode"}constructor(t,e=null){super(t,e)}getShadowFilterFn(t){return t===LF?MD:vD}setupShadowCoord(t,e){return e}setupShadowFilter(t,{filterFn:e,depthTexture:n,shadowCoord:s,shadow:i}){return P9({filterFn:e,depthTexture:n,shadowCoord:s,shadow:i})}setupRenderTarget(t,e){const n=new JU(t.mapSize.width);n.name="PointShadowDepthTexture",n.compareFunction=e.renderer.reversedDepthBuffer?nx:ex;const s=e.createCubeRenderTarget(t.mapSize.width);return s.texture.name="PointShadowMap",s.depthTexture=n,{shadowMap:s,depthTexture:n}}renderShadow(t){const{shadow:e,shadowMap:n,light:s}=this,{renderer:i,scene:a}=t,c=e.camera,u=e.matrix,d=i.coordinateSystem===Zr,f=d?L9:F9,p=d?O9:U9;n.setSize(e.mapSize.width,e.mapSize.width);const g=i.autoClear,y=i.getClearColor(D9),x=i.getClearAlpha();i.autoClear=!1,i.setClearColor(e.clearColor,e.clearAlpha);for(let S=0;S<6;S++){i.setRenderTarget(n,S),i.clear();const T=s.distance||c.far;T!==c.far&&(c.far=T,c.updateProjectionMatrix()),Wf.setFromMatrixPosition(s.matrixWorld),c.position.copy(Wf),QS.copy(c.position),QS.add(f[S]),c.up.copy(p[S]),c.lookAt(QS),c.updateMatrixWorld(),u.makeTranslation(-Wf.x,-Wf.y,-Wf.z),kR.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),e._frustum.setFromProjectionMatrix(kR,c.coordinateSystem,c.reversedDepth);const M=a.name;a.name=`Point Light Shadow [ ${s.name||"ID: "+s.id} ] - Face ${S+1}`,i.render(a,c),a.name=M}i.autoClear=g,i.setClearColor(y,x)}}const AD=(r,t)=>new z9(r,t);class qu extends Ld{static get type(){return"AnalyticLightNode"}constructor(t=null){super(),this.light=t,this.color=new qt,this.colorNode=t&&t.colorNode||Jt(this.color).setGroup(ee),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=de.FRAME,t&&t.shadow&&(this._shadowDisposeListener=()=>{this.disposeShadow()},t.addEventListener("dispose",this._shadowDisposeListener))}dispose(){this._shadowDisposeListener&&this.light.removeEventListener("dispose",this._shadowDisposeListener),super.dispose()}disposeShadow(){this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null),this.shadowColorNode=null,this.baseColorNode!==null&&(this.colorNode=this.baseColorNode,this.baseColorNode=null)}getHash(){return this.light.uuid}getLightVector(t){return c_(this.light).sub(t.context.positionView||cs)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return _D(this.light)}setupShadow(t){const{renderer:e}=t;if(e.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const s=this.light.shadow.shadowNode;let i;s!==void 0?i=Kt(s):i=this.setupShadowNode(),this.shadowNode=i,this.shadowColorNode=n=this.colorNode.mul(i),this.baseColorNode=this.colorNode}t.context.getShadow&&(n=t.context.getShadow(this,t)),this.colorNode=n}setup(t){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?t.object.receiveShadow&&this.setupShadow(t):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const e=this.setupDirect(t),n=this.setupDirectRectArea(t);e&&t.lightsNode.setupDirectLight(t,this,e),n&&t.lightsNode.setupDirectRectAreaLight(t,this,n)}update(){const{light:t}=this;this.color.copy(t.color).multiplyScalar(t.intensity)}}const f_=ut(({lightDistance:r,cutoffDistance:t,decayExponent:e})=>{const n=r.pow(e).max(.01).reciprocal();return t.greaterThan(0).select(n.mul(r.div(t).pow4().oneMinus().clamp().pow2()),n)}),ND=({color:r,lightVector:t,cutoffDistance:e,decayExponent:n})=>{const s=t.normalize(),i=t.length(),a=f_({lightDistance:i,cutoffDistance:e,decayExponent:n}),c=r.mul(a);return{lightDirection:s,lightColor:c}};class I9 extends qu{static get type(){return"PointLightNode"}constructor(t=null){super(t),this.cutoffDistanceNode=Jt(0).setGroup(ee),this.decayExponentNode=Jt(2).setGroup(ee)}update(t){const{light:e}=this;super.update(t),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}setupShadowNode(){return AD(this.light)}setupDirect(t){return ND({color:this.colorNode,lightVector:this.getLightVector(t),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const V9=ut(([r=cn()])=>{const t=r.mul(2),e=t.x.floor(),n=t.y.floor();return e.add(n).mod(2).sign()}),G9=ut(([r=cn()],{renderer:t,material:e})=>{const n=ST(r.mul(2).sub(1));let s;if(e.alphaToCoverage&&t.currentSamples>0){const i=k(n.fwidth()).toVar();s=No(i.oneMinus(),i.add(1),n).oneMinus()}else s=yi(n.greaterThan(1),0,1);return s}),vp=ut(([r,t,e])=>{const n=k(e).toVar(),s=k(t).toVar(),i=Jr(r).toVar();return yi(i,s,n)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),ky=ut(([r,t])=>{const e=Jr(t).toVar(),n=k(r).toVar();return yi(e,n.negate(),n)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),ys=ut(([r])=>{const t=k(r).toVar();return J(na(t))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),Pn=ut(([r,t])=>{const e=k(r).toVar();return t.assign(ys(e)),e.sub(k(t))}),k9=ut(([r,t,e,n,s,i])=>{const a=k(i).toVar(),c=k(s).toVar(),u=k(n).toVar(),d=k(e).toVar(),f=k(t).toVar(),p=k(r).toVar(),g=k(De(1,c)).toVar();return De(1,a).mul(p.mul(g).add(f.mul(c))).add(a.mul(d.mul(g).add(u.mul(c))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),H9=ut(([r,t,e,n,s,i])=>{const a=k(i).toVar(),c=k(s).toVar(),u=it(n).toVar(),d=it(e).toVar(),f=it(t).toVar(),p=it(r).toVar(),g=k(De(1,c)).toVar();return De(1,a).mul(p.mul(g).add(f.mul(c))).add(a.mul(d.mul(g).add(u.mul(c))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),RD=ri([k9,H9]),W9=ut(([r,t,e,n,s,i,a,c,u,d,f])=>{const p=k(f).toVar(),g=k(d).toVar(),y=k(u).toVar(),x=k(c).toVar(),S=k(a).toVar(),T=k(i).toVar(),M=k(s).toVar(),N=k(n).toVar(),v=k(e).toVar(),A=k(t).toVar(),R=k(r).toVar(),F=k(De(1,y)).toVar(),D=k(De(1,g)).toVar();return k(De(1,p)).toVar().mul(D.mul(R.mul(F).add(A.mul(y))).add(g.mul(v.mul(F).add(N.mul(y))))).add(p.mul(D.mul(M.mul(F).add(T.mul(y))).add(g.mul(S.mul(F).add(x.mul(y))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),q9=ut(([r,t,e,n,s,i,a,c,u,d,f])=>{const p=k(f).toVar(),g=k(d).toVar(),y=k(u).toVar(),x=it(c).toVar(),S=it(a).toVar(),T=it(i).toVar(),M=it(s).toVar(),N=it(n).toVar(),v=it(e).toVar(),A=it(t).toVar(),R=it(r).toVar(),F=k(De(1,y)).toVar(),D=k(De(1,g)).toVar();return k(De(1,p)).toVar().mul(D.mul(R.mul(F).add(A.mul(y))).add(g.mul(v.mul(F).add(N.mul(y))))).add(p.mul(D.mul(M.mul(F).add(T.mul(y))).add(g.mul(S.mul(F).add(x.mul(y))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),ED=ri([W9,q9]),$9=ut(([r,t,e])=>{const n=k(e).toVar(),s=k(t).toVar(),i=Ut(r).toVar(),a=Ut(i.bitAnd(Ut(7))).toVar(),c=k(vp(a.lessThan(Ut(4)),s,n)).toVar(),u=k(fe(2,vp(a.lessThan(Ut(4)),n,s))).toVar();return ky(c,Jr(a.bitAnd(Ut(1)))).add(ky(u,Jr(a.bitAnd(Ut(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),X9=ut(([r,t,e,n])=>{const s=k(n).toVar(),i=k(e).toVar(),a=k(t).toVar(),c=Ut(r).toVar(),u=Ut(c.bitAnd(Ut(15))).toVar(),d=k(vp(u.lessThan(Ut(8)),a,i)).toVar(),f=k(vp(u.lessThan(Ut(4)),i,vp(u.equal(Ut(12)).or(u.equal(Ut(14))),a,s))).toVar();return ky(d,Jr(u.bitAnd(Ut(1)))).add(ky(f,Jr(u.bitAnd(Ut(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Hs=ri([$9,X9]),j9=ut(([r,t,e])=>{const n=k(e).toVar(),s=k(t).toVar(),i=Hu(r).toVar();return it(Hs(i.x,s,n),Hs(i.y,s,n),Hs(i.z,s,n))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),Y9=ut(([r,t,e,n])=>{const s=k(n).toVar(),i=k(e).toVar(),a=k(t).toVar(),c=Hu(r).toVar();return it(Hs(c.x,a,i,s),Hs(c.y,a,i,s),Hs(c.z,a,i,s))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Hr=ri([j9,Y9]),K9=ut(([r])=>{const t=k(r).toVar();return fe(.6616,t)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),Z9=ut(([r])=>{const t=k(r).toVar();return fe(.982,t)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),Q9=ut(([r])=>{const t=it(r).toVar();return fe(.6616,t)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),CD=ri([K9,Q9]),J9=ut(([r])=>{const t=it(r).toVar();return fe(.982,t)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),BD=ri([Z9,J9]),xr=ut(([r,t])=>{const e=J(t).toVar(),n=Ut(r).toVar();return n.shiftLeft(e).bitOr(n.shiftRight(J(32).sub(e)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),DD=ut(([r,t,e])=>{r.subAssign(e),r.bitXorAssign(xr(e,J(4))),e.addAssign(t),t.subAssign(r),t.bitXorAssign(xr(r,J(6))),r.addAssign(e),e.subAssign(t),e.bitXorAssign(xr(t,J(8))),t.addAssign(r),r.subAssign(e),r.bitXorAssign(xr(e,J(16))),e.addAssign(t),t.subAssign(r),t.bitXorAssign(xr(r,J(19))),r.addAssign(e),e.subAssign(t),e.bitXorAssign(xr(t,J(4))),t.addAssign(r)}),Jp=ut(([r,t,e])=>{const n=Ut(e).toVar(),s=Ut(t).toVar(),i=Ut(r).toVar();return n.bitXorAssign(s),n.subAssign(xr(s,J(14))),i.bitXorAssign(n),i.subAssign(xr(n,J(11))),s.bitXorAssign(i),s.subAssign(xr(i,J(25))),n.bitXorAssign(s),n.subAssign(xr(s,J(16))),i.bitXorAssign(n),i.subAssign(xr(n,J(4))),s.bitXorAssign(i),s.subAssign(xr(i,J(14))),n.bitXorAssign(s),n.subAssign(xr(s,J(24))),n}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),xi=ut(([r])=>{const t=Ut(r).toVar();return k(t).div(k(Ut(J(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),aa=ut(([r])=>{const t=k(r).toVar();return t.mul(t).mul(t).mul(t.mul(t.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),t7=ut(([r])=>{const t=J(r).toVar(),e=Ut(Ut(1)).toVar(),n=Ut(Ut(J(3735928559)).add(e.shiftLeft(Ut(2))).add(Ut(13))).toVar();return Jp(n.add(Ut(t)),n,n)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),e7=ut(([r,t])=>{const e=J(t).toVar(),n=J(r).toVar(),s=Ut(Ut(2)).toVar(),i=Ut().toVar(),a=Ut().toVar(),c=Ut().toVar();return i.assign(a.assign(c.assign(Ut(J(3735928559)).add(s.shiftLeft(Ut(2))).add(Ut(13))))),i.addAssign(Ut(n)),a.addAssign(Ut(e)),Jp(i,a,c)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),n7=ut(([r,t,e])=>{const n=J(e).toVar(),s=J(t).toVar(),i=J(r).toVar(),a=Ut(Ut(3)).toVar(),c=Ut().toVar(),u=Ut().toVar(),d=Ut().toVar();return c.assign(u.assign(d.assign(Ut(J(3735928559)).add(a.shiftLeft(Ut(2))).add(Ut(13))))),c.addAssign(Ut(i)),u.addAssign(Ut(s)),d.addAssign(Ut(n)),Jp(c,u,d)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),s7=ut(([r,t,e,n])=>{const s=J(n).toVar(),i=J(e).toVar(),a=J(t).toVar(),c=J(r).toVar(),u=Ut(Ut(4)).toVar(),d=Ut().toVar(),f=Ut().toVar(),p=Ut().toVar();return d.assign(f.assign(p.assign(Ut(J(3735928559)).add(u.shiftLeft(Ut(2))).add(Ut(13))))),d.addAssign(Ut(c)),f.addAssign(Ut(a)),p.addAssign(Ut(i)),DD(d,f,p),d.addAssign(Ut(s)),Jp(d,f,p)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),i7=ut(([r,t,e,n,s])=>{const i=J(s).toVar(),a=J(n).toVar(),c=J(e).toVar(),u=J(t).toVar(),d=J(r).toVar(),f=Ut(Ut(5)).toVar(),p=Ut().toVar(),g=Ut().toVar(),y=Ut().toVar();return p.assign(g.assign(y.assign(Ut(J(3735928559)).add(f.shiftLeft(Ut(2))).add(Ut(13))))),p.addAssign(Ut(d)),g.addAssign(Ut(u)),y.addAssign(Ut(c)),DD(p,g,y),p.addAssign(Ut(a)),g.addAssign(Ut(i)),Jp(p,g,y)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),ln=ri([t7,e7,n7,s7,i7]),r7=ut(([r,t])=>{const e=J(t).toVar(),n=J(r).toVar(),s=Ut(ln(n,e)).toVar(),i=Hu().toVar();return i.x.assign(s.bitAnd(J(255))),i.y.assign(s.shiftRight(J(8)).bitAnd(J(255))),i.z.assign(s.shiftRight(J(16)).bitAnd(J(255))),i}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),o7=ut(([r,t,e])=>{const n=J(e).toVar(),s=J(t).toVar(),i=J(r).toVar(),a=Ut(ln(i,s,n)).toVar(),c=Hu().toVar();return c.x.assign(a.bitAnd(J(255))),c.y.assign(a.shiftRight(J(8)).bitAnd(J(255))),c.z.assign(a.shiftRight(J(16)).bitAnd(J(255))),c}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),Wr=ri([r7,o7]),a7=ut(([r])=>{const t=It(r).toVar(),e=J().toVar(),n=J().toVar(),s=k(Pn(t.x,e)).toVar(),i=k(Pn(t.y,n)).toVar(),a=k(aa(s)).toVar(),c=k(aa(i)).toVar(),u=k(RD(Hs(ln(e,n),s,i),Hs(ln(e.add(J(1)),n),s.sub(1),i),Hs(ln(e,n.add(J(1))),s,i.sub(1)),Hs(ln(e.add(J(1)),n.add(J(1))),s.sub(1),i.sub(1)),a,c)).toVar();return CD(u)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),l7=ut(([r])=>{const t=it(r).toVar(),e=J().toVar(),n=J().toVar(),s=J().toVar(),i=k(Pn(t.x,e)).toVar(),a=k(Pn(t.y,n)).toVar(),c=k(Pn(t.z,s)).toVar(),u=k(aa(i)).toVar(),d=k(aa(a)).toVar(),f=k(aa(c)).toVar(),p=k(ED(Hs(ln(e,n,s),i,a,c),Hs(ln(e.add(J(1)),n,s),i.sub(1),a,c),Hs(ln(e,n.add(J(1)),s),i,a.sub(1),c),Hs(ln(e.add(J(1)),n.add(J(1)),s),i.sub(1),a.sub(1),c),Hs(ln(e,n,s.add(J(1))),i,a,c.sub(1)),Hs(ln(e.add(J(1)),n,s.add(J(1))),i.sub(1),a,c.sub(1)),Hs(ln(e,n.add(J(1)),s.add(J(1))),i,a.sub(1),c.sub(1)),Hs(ln(e.add(J(1)),n.add(J(1)),s.add(J(1))),i.sub(1),a.sub(1),c.sub(1)),u,d,f)).toVar();return BD(p)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),p_=ri([a7,l7]),c7=ut(([r])=>{const t=It(r).toVar(),e=J().toVar(),n=J().toVar(),s=k(Pn(t.x,e)).toVar(),i=k(Pn(t.y,n)).toVar(),a=k(aa(s)).toVar(),c=k(aa(i)).toVar(),u=it(RD(Hr(Wr(e,n),s,i),Hr(Wr(e.add(J(1)),n),s.sub(1),i),Hr(Wr(e,n.add(J(1))),s,i.sub(1)),Hr(Wr(e.add(J(1)),n.add(J(1))),s.sub(1),i.sub(1)),a,c)).toVar();return CD(u)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),u7=ut(([r])=>{const t=it(r).toVar(),e=J().toVar(),n=J().toVar(),s=J().toVar(),i=k(Pn(t.x,e)).toVar(),a=k(Pn(t.y,n)).toVar(),c=k(Pn(t.z,s)).toVar(),u=k(aa(i)).toVar(),d=k(aa(a)).toVar(),f=k(aa(c)).toVar(),p=it(ED(Hr(Wr(e,n,s),i,a,c),Hr(Wr(e.add(J(1)),n,s),i.sub(1),a,c),Hr(Wr(e,n.add(J(1)),s),i,a.sub(1),c),Hr(Wr(e.add(J(1)),n.add(J(1)),s),i.sub(1),a.sub(1),c),Hr(Wr(e,n,s.add(J(1))),i,a,c.sub(1)),Hr(Wr(e.add(J(1)),n,s.add(J(1))),i.sub(1),a,c.sub(1)),Hr(Wr(e,n.add(J(1)),s.add(J(1))),i,a.sub(1),c.sub(1)),Hr(Wr(e.add(J(1)),n.add(J(1)),s.add(J(1))),i.sub(1),a.sub(1),c.sub(1)),u,d,f)).toVar();return BD(p)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),t0=ri([c7,u7]),h7=ut(([r])=>{const t=k(r).toVar(),e=J(ys(t)).toVar();return xi(ln(e))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),d7=ut(([r])=>{const t=It(r).toVar(),e=J(ys(t.x)).toVar(),n=J(ys(t.y)).toVar();return xi(ln(e,n))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),f7=ut(([r])=>{const t=it(r).toVar(),e=J(ys(t.x)).toVar(),n=J(ys(t.y)).toVar(),s=J(ys(t.z)).toVar();return xi(ln(e,n,s))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),p7=ut(([r])=>{const t=se(r).toVar(),e=J(ys(t.x)).toVar(),n=J(ys(t.y)).toVar(),s=J(ys(t.z)).toVar(),i=J(ys(t.w)).toVar();return xi(ln(e,n,s,i))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),m7=ri([h7,d7,f7,p7]),g7=ut(([r])=>{const t=k(r).toVar(),e=J(ys(t)).toVar();return it(xi(ln(e,J(0))),xi(ln(e,J(1))),xi(ln(e,J(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),y7=ut(([r])=>{const t=It(r).toVar(),e=J(ys(t.x)).toVar(),n=J(ys(t.y)).toVar();return it(xi(ln(e,n,J(0))),xi(ln(e,n,J(1))),xi(ln(e,n,J(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),x7=ut(([r])=>{const t=it(r).toVar(),e=J(ys(t.x)).toVar(),n=J(ys(t.y)).toVar(),s=J(ys(t.z)).toVar();return it(xi(ln(e,n,s,J(0))),xi(ln(e,n,s,J(1))),xi(ln(e,n,s,J(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),b7=ut(([r])=>{const t=se(r).toVar(),e=J(ys(t.x)).toVar(),n=J(ys(t.y)).toVar(),s=J(ys(t.z)).toVar(),i=J(ys(t.w)).toVar();return it(xi(ln(e,n,s,i,J(0))),xi(ln(e,n,s,i,J(1))),xi(ln(e,n,s,i,J(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),Px=ri([g7,y7,x7,b7]),Hy=ut(([r,t,e,n])=>{const s=k(n).toVar(),i=k(e).toVar(),a=J(t).toVar(),c=it(r).toVar(),u=k(0).toVar(),d=k(1).toVar();return on(a,()=>{u.addAssign(d.mul(p_(c))),d.mulAssign(s),c.mulAssign(i)}),u}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),zx=ut(([r,t,e,n])=>{const s=k(n).toVar(),i=k(e).toVar(),a=J(t).toVar(),c=it(r).toVar(),u=it(0).toVar(),d=k(1).toVar();return on(a,()=>{u.addAssign(d.mul(t0(c))),d.mulAssign(s),c.mulAssign(i)}),u}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),S7=ut(([r,t,e,n])=>{const s=k(n).toVar(),i=k(e).toVar(),a=J(t).toVar(),c=it(r).toVar();return It(Hy(c,a,i,s),Hy(c.add(it(J(19),J(193),J(17))),a,i,s))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),w7=ut(([r,t,e,n])=>{const s=k(n).toVar(),i=k(e).toVar(),a=J(t).toVar(),c=it(r).toVar(),u=it(zx(c,a,i,s)).toVar(),d=k(Hy(c.add(it(J(19),J(193),J(17))),a,i,s)).toVar();return se(u,d)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),T7=ut(([r,t,e,n,s,i,a])=>{const c=J(a).toVar(),u=k(i).toVar(),d=J(s).toVar(),f=J(n).toVar(),p=J(e).toVar(),g=J(t).toVar(),y=It(r).toVar(),x=it(Px(It(g.add(f),p.add(d)))).toVar(),S=It(x.x,x.y).toVar();S.subAssign(.5),S.mulAssign(u),S.addAssign(.5);const T=It(It(k(g),k(p)).add(S)).toVar(),M=It(T.sub(y)).toVar();return re(c.equal(J(2)),()=>xn(M.x).add(xn(M.y))),re(c.equal(J(3)),()=>qn(xn(M.x),xn(M.y))),to(M,M)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),_7=ut(([r,t,e,n,s,i,a,c,u])=>{const d=J(u).toVar(),f=k(c).toVar(),p=J(a).toVar(),g=J(i).toVar(),y=J(s).toVar(),x=J(n).toVar(),S=J(e).toVar(),T=J(t).toVar(),M=it(r).toVar(),N=it(Px(it(T.add(y),S.add(g),x.add(p)))).toVar();N.subAssign(.5),N.mulAssign(f),N.addAssign(.5);const v=it(it(k(T),k(S),k(x)).add(N)).toVar(),A=it(v.sub(M)).toVar();return re(d.equal(J(2)),()=>xn(A.x).add(xn(A.y)).add(xn(A.z))),re(d.equal(J(3)),()=>qn(xn(A.x),xn(A.y),xn(A.z))),to(A,A)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Fd=ri([T7,_7]),M7=ut(([r,t,e])=>{const n=J(e).toVar(),s=k(t).toVar(),i=It(r).toVar(),a=J().toVar(),c=J().toVar(),u=It(Pn(i.x,a),Pn(i.y,c)).toVar(),d=k(1e6).toVar();return on({start:-1,end:J(1),name:"x",condition:"<="},({x:f})=>{on({start:-1,end:J(1),name:"y",condition:"<="},({y:p})=>{const g=k(Fd(u,f,p,a,c,s,n)).toVar();d.assign(er(d,g))})}),re(n.equal(J(0)),()=>{d.assign(Di(d))}),d}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),v7=ut(([r,t,e])=>{const n=J(e).toVar(),s=k(t).toVar(),i=It(r).toVar(),a=J().toVar(),c=J().toVar(),u=It(Pn(i.x,a),Pn(i.y,c)).toVar(),d=It(1e6,1e6).toVar();return on({start:-1,end:J(1),name:"x",condition:"<="},({x:f})=>{on({start:-1,end:J(1),name:"y",condition:"<="},({y:p})=>{const g=k(Fd(u,f,p,a,c,s,n)).toVar();re(g.lessThan(d.x),()=>{d.y.assign(d.x),d.x.assign(g)}).ElseIf(g.lessThan(d.y),()=>{d.y.assign(g)})})}),re(n.equal(J(0)),()=>{d.assign(Di(d))}),d}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),A7=ut(([r,t,e])=>{const n=J(e).toVar(),s=k(t).toVar(),i=It(r).toVar(),a=J().toVar(),c=J().toVar(),u=It(Pn(i.x,a),Pn(i.y,c)).toVar(),d=it(1e6,1e6,1e6).toVar();return on({start:-1,end:J(1),name:"x",condition:"<="},({x:f})=>{on({start:-1,end:J(1),name:"y",condition:"<="},({y:p})=>{const g=k(Fd(u,f,p,a,c,s,n)).toVar();re(g.lessThan(d.x),()=>{d.z.assign(d.y),d.y.assign(d.x),d.x.assign(g)}).ElseIf(g.lessThan(d.y),()=>{d.z.assign(d.y),d.y.assign(g)}).ElseIf(g.lessThan(d.z),()=>{d.z.assign(g)})})}),re(n.equal(J(0)),()=>{d.assign(Di(d))}),d}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),N7=ut(([r,t,e])=>{const n=J(e).toVar(),s=k(t).toVar(),i=it(r).toVar(),a=J().toVar(),c=J().toVar(),u=J().toVar(),d=it(Pn(i.x,a),Pn(i.y,c),Pn(i.z,u)).toVar(),f=k(1e6).toVar();return on({start:-1,end:J(1),name:"x",condition:"<="},({x:p})=>{on({start:-1,end:J(1),name:"y",condition:"<="},({y:g})=>{on({start:-1,end:J(1),name:"z",condition:"<="},({z:y})=>{const x=k(Fd(d,p,g,y,a,c,u,s,n)).toVar();f.assign(er(f,x))})})}),re(n.equal(J(0)),()=>{f.assign(Di(f))}),f}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),R7=ri([M7,N7]),E7=ut(([r,t,e])=>{const n=J(e).toVar(),s=k(t).toVar(),i=it(r).toVar(),a=J().toVar(),c=J().toVar(),u=J().toVar(),d=it(Pn(i.x,a),Pn(i.y,c),Pn(i.z,u)).toVar(),f=It(1e6,1e6).toVar();return on({start:-1,end:J(1),name:"x",condition:"<="},({x:p})=>{on({start:-1,end:J(1),name:"y",condition:"<="},({y:g})=>{on({start:-1,end:J(1),name:"z",condition:"<="},({z:y})=>{const x=k(Fd(d,p,g,y,a,c,u,s,n)).toVar();re(x.lessThan(f.x),()=>{f.y.assign(f.x),f.x.assign(x)}).ElseIf(x.lessThan(f.y),()=>{f.y.assign(x)})})})}),re(n.equal(J(0)),()=>{f.assign(Di(f))}),f}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),C7=ri([v7,E7]),B7=ut(([r,t,e])=>{const n=J(e).toVar(),s=k(t).toVar(),i=it(r).toVar(),a=J().toVar(),c=J().toVar(),u=J().toVar(),d=it(Pn(i.x,a),Pn(i.y,c),Pn(i.z,u)).toVar(),f=it(1e6,1e6,1e6).toVar();return on({start:-1,end:J(1),name:"x",condition:"<="},({x:p})=>{on({start:-1,end:J(1),name:"y",condition:"<="},({y:g})=>{on({start:-1,end:J(1),name:"z",condition:"<="},({z:y})=>{const x=k(Fd(d,p,g,y,a,c,u,s,n)).toVar();re(x.lessThan(f.x),()=>{f.z.assign(f.y),f.y.assign(f.x),f.x.assign(x)}).ElseIf(x.lessThan(f.y),()=>{f.z.assign(f.y),f.y.assign(x)}).ElseIf(x.lessThan(f.z),()=>{f.z.assign(x)})})})}),re(n.equal(J(0)),()=>{f.assign(Di(f))}),f}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),m_=ri([A7,B7]),D7=ut(([r,t,e,n,s,i,a,c,u,d,f])=>{const p=J(r).toVar(),g=It(t).toVar(),y=It(e).toVar(),x=It(n).toVar(),S=k(s).toVar(),T=k(i).toVar(),M=k(a).toVar(),N=Jr(c).toVar(),v=J(u).toVar(),A=k(d).toVar(),R=k(f).toVar(),F=g.mul(y).add(x),D=k(0).toVar();return re(p.equal(J(0)),()=>{D.assign(t0(F))}),re(p.equal(J(1)),()=>{D.assign(Px(F))}),re(p.equal(J(2)),()=>{D.assign(m_(F,S,J(0)))}),re(p.equal(J(3)),()=>{D.assign(zx(it(F,0),v,A,R))}),D.assign(D.mul(M.sub(T)).add(T)),re(N,()=>{D.assign(Ao(D,T,M))}),D}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),L7=ut(([r,t,e,n,s,i,a,c,u,d,f])=>{const p=J(r).toVar(),g=it(t).toVar(),y=it(e).toVar(),x=it(n).toVar(),S=k(s).toVar(),T=k(i).toVar(),M=k(a).toVar(),N=Jr(c).toVar(),v=J(u).toVar(),A=k(d).toVar(),R=k(f).toVar(),F=g.mul(y).add(x),D=k(0).toVar();return re(p.equal(J(0)),()=>{D.assign(t0(F))}),re(p.equal(J(1)),()=>{D.assign(Px(F))}),re(p.equal(J(2)),()=>{D.assign(m_(F,S,J(0)))}),re(p.equal(J(3)),()=>{D.assign(zx(F,v,A,R))}),D.assign(D.mul(M.sub(T)).add(T)),re(N,()=>{D.assign(Ao(D,T,M))}),D}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),O7=ut(([r])=>{const t=r.y,e=r.z,n=it().toVar();return re(t.lessThan(1e-4),()=>{n.assign(it(e,e,e))}).Else(()=>{let s=r.x;s=s.sub(na(s)).mul(6).toVar();const i=J(gT(s)),a=s.sub(k(i)),c=e.mul(t.oneMinus()),u=e.mul(t.mul(a).oneMinus()),d=e.mul(t.mul(a.oneMinus()).oneMinus());re(i.equal(J(0)),()=>{n.assign(it(e,d,c))}).ElseIf(i.equal(J(1)),()=>{n.assign(it(u,e,c))}).ElseIf(i.equal(J(2)),()=>{n.assign(it(c,e,d))}).ElseIf(i.equal(J(3)),()=>{n.assign(it(c,u,e))}).ElseIf(i.equal(J(4)),()=>{n.assign(it(d,c,e))}).Else(()=>{n.assign(it(e,c,u))})}),n}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),F7=ut(([r])=>{const t=it(r).toVar(),e=k(t.x).toVar(),n=k(t.y).toVar(),s=k(t.z).toVar(),i=k(er(e,er(n,s))).toVar(),a=k(qn(e,qn(n,s))).toVar(),c=k(a.sub(i)).toVar(),u=k().toVar(),d=k().toVar(),f=k().toVar();return f.assign(a),re(a.greaterThan(0),()=>{d.assign(c.div(a))}).Else(()=>{d.assign(0)}),re(d.lessThanEqual(0),()=>{u.assign(0)}).Else(()=>{re(e.greaterThanEqual(a),()=>{u.assign(n.sub(s).div(c))}).ElseIf(n.greaterThanEqual(a),()=>{u.assign(xs(2,s.sub(e).div(c)))}).Else(()=>{u.assign(xs(4,e.sub(n).div(c)))}),u.mulAssign(1/6),re(u.lessThan(0),()=>{u.addAssign(1)})}),it(u,d,f)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),U7=ut(([r])=>{const t=it(r).toVar(),e=Qw(oT(t,it(.04045))).toVar(),n=it(t.div(12.92)).toVar(),s=it($r(qn(t.add(it(.055)),it(0)).div(1.055),it(2.4))).toVar();return Ce(n,s,e)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),LD=(r,t)=>{r=k(r),t=k(t);const e=It(t.dFdx(),t.dFdy()).length().mul(.7071067811865476);return No(r.sub(e),r.add(e),t)},OD=(r,t,e,n)=>Ce(r,t,e[n].clamp()),P7=(r,t,e=cn())=>OD(r,t,e,"x"),z7=(r,t,e=cn())=>OD(r,t,e,"y"),I7=(r,t,e,n,s=cn())=>{const i=s.x.clamp(),a=s.y.clamp(),c=Ce(r,t,i),u=Ce(e,n,i);return Ce(c,u,a)},FD=(r,t,e,n,s)=>Ce(r,t,LD(e,n[s])),V7=(r,t,e,n=cn())=>FD(r,t,e,n,"x"),G7=(r,t,e,n=cn())=>FD(r,t,e,n,"y"),k7=(r=1,t=0,e=cn())=>e.mul(r).add(t),H7=(r,t=1)=>(r=k(r),r.abs().pow(t).mul(r.sign())),W7=(r,t=1,e=.5)=>k(r).sub(e).mul(t).add(e),q7=(r=cn(),t=1,e=0)=>p_(r.convert("vec2|vec3")).mul(t).add(e),$7=(r=cn(),t=1,e=0)=>t0(r.convert("vec2|vec3")).mul(t).add(e),X7=(r=cn(),t=1,e=0)=>(r=r.convert("vec2|vec3"),se(t0(r),p_(r.add(It(19,73)))).mul(t).add(e)),j7=(r,t=cn(),e=It(1,1),n=It(0,0),s=1,i=0,a=1,c=!1,u=1,d=2,f=.5)=>D7(r,t.convert("vec2|vec3"),e,n,s,i,a,c,u,d,f),Y7=(r,t=cn(),e=It(1,1),n=It(0,0),s=1,i=0,a=1,c=!1,u=1,d=2,f=.5)=>L7(r,t.convert("vec2|vec3"),e,n,s,i,a,c,u,d,f),K7=(r=cn(),t=1)=>R7(r.convert("vec2|vec3"),t,J(1)),Z7=(r=cn(),t=1)=>C7(r.convert("vec2|vec3"),t,J(1)),Q7=(r=cn(),t=1)=>m_(r.convert("vec2|vec3"),t,J(1)),J7=(r=cn())=>m7(r.convert("vec2|vec3")),tH=(r=cn(),t=3,e=2,n=.5,s=1)=>Hy(r,J(t),e,n).mul(s),eH=(r=cn(),t=3,e=2,n=.5,s=1)=>S7(r,J(t),e,n).mul(s),nH=(r=cn(),t=3,e=2,n=.5,s=1)=>zx(r,J(t),e,n).mul(s),sH=(r=cn(),t=3,e=2,n=.5,s=1)=>w7(r,J(t),e,n).mul(s),iH=(r,t=k(0))=>xs(r,t),rH=(r,t=k(0))=>De(r,t),oH=(r,t=k(1))=>fe(r,t),aH=(r,t=k(1))=>vr(r,t),lH=(r,t=k(1))=>Xp(r,t),cH=(r,t=k(1))=>$r(r,t),uH=(r=k(0),t=k(1))=>hT(r,t),hH=()=>Od,dH=()=>YB,fH=(r,t=k(1))=>De(t,r),pH=(r,t,e,n)=>r.greaterThan(t).mix(e,n),mH=(r,t,e,n)=>r.greaterThanEqual(t).mix(e,n),gH=(r,t,e,n)=>r.equal(t).mix(e,n),yH=(r,t=null)=>{if(typeof t=="string"){const e={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3},n=t.replace(/^out/,"").toLowerCase();if(e[n]!==void 0)return r.element(e[n])}if(typeof t=="number")return r.element(t);if(typeof t=="string"&&t.length===1){const e={x:0,r:0,y:1,g:1,z:2,b:2,w:3,a:3};if(e[t]!==void 0)return r.element(e[t])}return r},xH=(r,t=It(.5,.5),e=It(1,1),n=k(0),s=It(0,0))=>{let i=r;if(t&&(i=i.sub(t)),e&&(i=i.mul(e)),n){const a=n.mul(Math.PI/180),c=a.cos(),u=a.sin();i=It(i.x.mul(c).sub(i.y.mul(u)),i.x.mul(u).add(i.y.mul(c)))}return t&&(i=i.add(t)),s&&(i=i.add(s)),i},bH=(r,t)=>{r=It(r),t=k(t);const e=t.mul(Math.PI/180);return Kp(r,e)},SH=(r,t,e)=>{r=it(r),t=k(t),e=it(e);const n=t.mul(Math.PI/180),s=e.normalize(),i=n.cos(),a=n.sin(),c=k(1).sub(i);return r.mul(i).add(s.cross(r).mul(a)).add(s.mul(s.dot(r)).mul(c))},wH=(r,t)=>(r=it(r),t=k(t),IT(r,t)),TH=ut(([r,t,e])=>{const n=Qi(r).toVar(),s=De(k(.5).mul(t.sub(e)),ra).div(n).toVar(),i=De(k(-.5).mul(t.sub(e)),ra).div(n).toVar(),a=it().toVar();a.x=n.x.greaterThan(k(0)).select(s.x,i.x),a.y=n.y.greaterThan(k(0)).select(s.y,i.y),a.z=n.z.greaterThan(k(0)).select(s.z,i.z);const c=er(a.x,a.y,a.z).toVar();return ra.add(n.mul(c)).toVar().sub(e)}),UD=ut(([r,t])=>{const e=r.x,n=r.y,s=r.z;let i=t.element(0).mul(.886227);return i=i.add(t.element(1).mul(2*.511664).mul(n)),i=i.add(t.element(2).mul(2*.511664).mul(s)),i=i.add(t.element(3).mul(2*.511664).mul(e)),i=i.add(t.element(4).mul(2*.429043).mul(e).mul(n)),i=i.add(t.element(5).mul(2*.429043).mul(n).mul(s)),i=i.add(t.element(6).mul(s.mul(s).mul(.743125).sub(.247708))),i=i.add(t.element(7).mul(2*.429043).mul(e).mul(s)),i=i.add(t.element(8).mul(.429043).mul(fe(e,e).sub(fe(n,n)))),i});var _=Object.freeze({__proto__:null,BRDF_GGX:ZT,BRDF_Lambert:Pu,BasicPointShadowFilter:MD,BasicShadowFilter:mD,Break:dB,Const:E5,Continue:g6,DFGLUT:Ip,D_GGX:NB,Discard:q5,EPSILON:aT,F_Schlick:Ed,Fn:ut,HALF_PI:HP,INFINITY:VP,If:re,Loop:on,NodeAccess:si,NodeShaderStage:sp,NodeType:cP,NodeUpdateType:de,OnBeforeMaterialUpdate:FG,OnBeforeObjectUpdate:OG,OnMaterialUpdate:LG,OnObjectUpdate:DG,PCFShadowFilter:gD,PCFSoftShadowFilter:yD,PI:Uy,PI2:GP,PointShadowFilter:vD,Return:rz,Schlick_to_F0:ew,ShaderNode:od,Stack:dx,Switch:BP,TBNViewMatrix:Ru,TWO_PI:kP,VSMShadowFilter:xD,V_GGX_SmithCorrelated:AB,Var:R5,VarIntent:C5,abs:xn,acesFilmicToneMapping:oD,acos:uT,add:xs,addMethodChaining:Ct,addNodeElement:cz,agxToneMapping:aD,all:e5,alphaT:Ly,and:VC,anisotropy:oc,anisotropyB:Bu,anisotropyT:wp,any:n5,append:FP,array:DC,arrayBuffer:LP,asin:o5,assign:LC,atan:hT,atomicAdd:Ik,atomicAnd:Hk,atomicFunc:fa,atomicLoad:Pk,atomicMax:Gk,atomicMin:kk,atomicOr:Wk,atomicStore:zk,atomicSub:Vk,atomicXor:qk,attenuationColor:sT,attenuationDistance:nT,attribute:al,attributeArray:zG,backgroundBlurriness:QB,backgroundIntensity:ow,backgroundRotation:JB,batch:cB,bentNormalView:v4,billboarding:gG,bitAnd:WC,bitNot:qC,bitOr:$C,bitXor:XC,bitangentGeometry:Yz,bitangentLocal:Kz,bitangentView:_4,bitangentWorld:Zz,bitcast:XB,blendBurn:F6,blendColor:I6,blendDodge:U6,blendOverlay:z6,blendScreen:P6,blur:OB,bool:Jr,buffer:jp,bufferAttribute:NT,builtin:hl,builtinAOContext:A5,builtinShadowContext:v5,bumpMap:IT,bvec2:vC,bvec3:Qw,bvec4:AC,bypass:G5,cache:V5,call:OC,cameraFar:uc,cameraIndex:Bc,cameraNear:cc,cameraNormalMatrix:_z,cameraPosition:e4,cameraProjectionMatrix:rl,cameraProjectionMatrixInverse:t4,cameraViewMatrix:so,cameraViewport:Mz,cameraWorldMatrix:Tz,cbrt:x5,cdl:nk,ceil:yx,checker:V9,cineonToneMapping:rD,clamp:Ao,clearcoat:Cy,clearcoatNormalView:hc,clearcoatRoughness:dd,clipSpace:i4,code:Ox,color:MC,colorSpaceToWorking:bx,colorToDirection:Jz,compute:I5,computeKernel:RT,computeSkinning:p6,context:ul,convert:RC,convertColorSpace:KP,convertToTexture:NG,cos:bo,countLeadingZeros:$V,countOneBits:XV,countTrailingZeros:qV,cross:ol,cubeTexture:Ci,cubeTextureBase:zT,dFdx:pT,dFdy:mT,dashSize:Ug,debug:X5,decrement:JC,decrementBefore:ZC,defaultBuildStages:V2,defaultShaderStages:xC,defined:Up,degrees:i5,deltaTime:lG,densityFogFactor:dD,depth:XT,depthPass:lk,determinant:h5,difference:m5,diffuseColor:sn,diffuseContribution:wu,directPointLight:ND,directionToColor:A4,directionToFaceDirection:Dd,dispersion:iT,disposeShadowMaterial:SD,distance:p5,div:vr,dot:to,drawIndex:oB,dynamicBufferAttribute:ez,element:NC,emissive:W2,equal:FC,equirectUV:jT,exp:lT,exp2:Md,exponentialHeightFogFactor:Sk,expression:_o,faceDirection:FT,faceForward:TT,faceforward:WP,float:k,floatBitsToInt:kV,floatBitsToUint:jB,floor:na,fog:aw,fract:vo,frameGroup:BC,frameId:YB,frontFacing:r4,fwidth:yT,gain:YV,gapSize:q2,getConstNodeType:_C,getCurrentStack:Yw,getDirection:DB,getDistanceAttenuation:f_,getGeometryRoughness:vB,getNormalFromDepth:EG,getParallaxCorrectNormal:TH,getRoughness:KT,getScreenPosition:RG,getShIrradianceAt:UD,getShadowMaterial:bD,getShadowRenderObjectFunction:wD,getTextureIndex:qB,getViewPosition:nd,ggxConvolution:FB,globalId:Ak,glsl:yk,glslFn:xk,grayscale:QG,greaterThan:oT,greaterThanEqual:IC,hash:jV,highpModelNormalViewMatrix:j2,highpModelViewMatrix:X2,hue:ek,increment:QC,incrementBefore:KC,inspector:Y5,instance:h6,instanceIndex:oa,instancedArray:IG,instancedBufferAttribute:Py,instancedDynamicBufferAttribute:$2,instancedMesh:lB,int:J,intBitsToFloat:HV,interleavedGradientNoise:i_,inverse:d5,inverseSqrt:cT,inversesqrt:qP,invocationLocalIndex:u6,invocationSubgroupIndex:c6,ior:Tp,iridescence:px,iridescenceIOR:By,iridescenceThickness:Dy,isolate:pd,ivec2:Rs,ivec3:Zw,ivec4:Jw,js:mk,label:N5,length:sa,lengthSq:ST,lessThan:PC,lessThanEqual:zC,lightPosition:l_,lightProjectionUV:fD,lightShadowMatrix:Ux,lightTargetDirection:u_,lightTargetPosition:pD,lightViewPosition:c_,lightingContext:pB,lights:b9,linearDepth:zy,linearToneMapping:sD,localId:Nk,log:gx,log2:ea,logarithmicDepthToViewZ:N6,luminance:r_,mat2:fx,mat3:Ws,mat4:Sc,matcapUV:UB,materialAO:sB,materialAlphaTest:N4,materialAnisotropy:k4,materialAnisotropyVector:ed,materialAttenuationColor:K4,materialAttenuationDistance:Y4,materialClearcoat:U4,materialClearcoatNormal:z4,materialClearcoatRoughness:P4,materialColor:R4,materialDispersion:nB,materialEmissive:C4,materialEnvIntensity:Ig,materialEnvRotation:PT,materialIOR:j4,materialIridescence:H4,materialIridescenceIOR:W4,materialIridescenceThickness:q4,materialLightMap:GT,materialLineDashOffset:tB,materialLineDashSize:Q4,materialLineGapSize:J4,materialLineScale:Z4,materialLineWidth:i6,materialMetalness:O4,materialNormal:F4,materialOpacity:VT,materialPointSize:eB,materialReference:Ka,materialReflectivity:Vg,materialRefractionRatio:c4,materialRotation:I4,materialRoughness:L4,materialSheen:V4,materialSheenRoughness:G4,materialShininess:E4,materialSpecular:B4,materialSpecularColor:D4,materialSpecularIntensity:tw,materialSpecularStrength:_p,materialThickness:X4,materialTransmission:$4,max:qn,maxMipLevel:ET,mediumpModelViewMatrix:s4,metalness:Ja,min:er,mix:Ce,mixElement:S5,mod:Xp,modInt:t5,modelDirection:Bz,modelNormalMatrix:n4,modelPosition:Dz,modelRadius:Fz,modelScale:Lz,modelViewMatrix:Dc,modelViewPosition:Oz,modelViewProjection:iB,modelWorldMatrix:Xr,modelWorldMatrixInverse:Uz,morphReference:fB,mrt:$B,mul:fe,mx_aastep:LD,mx_add:iH,mx_atan2:uH,mx_cell_noise_float:J7,mx_contrast:W7,mx_divide:aH,mx_fractal_noise_float:tH,mx_fractal_noise_vec2:eH,mx_fractal_noise_vec3:nH,mx_fractal_noise_vec4:sH,mx_frame:dH,mx_heighttonormal:wH,mx_hsvtorgb:O7,mx_ifequal:gH,mx_ifgreater:pH,mx_ifgreatereq:mH,mx_invert:fH,mx_modulo:lH,mx_multiply:oH,mx_noise_float:q7,mx_noise_vec3:$7,mx_noise_vec4:X7,mx_place2d:xH,mx_power:cH,mx_ramp4:I7,mx_ramplr:P7,mx_ramptb:z7,mx_rgbtohsv:F7,mx_rotate2d:bH,mx_rotate3d:SH,mx_safepower:H7,mx_separate:yH,mx_splitlr:V7,mx_splittb:G7,mx_srgb_texture_to_lin_rec709:U7,mx_subtract:rH,mx_timer:hH,mx_transform_uv:k7,mx_unifiednoise2d:j7,mx_unifiednoise3d:Y7,mx_worley_noise_float:K7,mx_worley_noise_vec2:Z7,mx_worley_noise_vec3:Q7,negate:fT,neutralToneMapping:lD,nodeArray:Cu,nodeImmutable:Xt,nodeObject:Kt,nodeObjectIntent:ip,nodeObjects:hx,nodeProxy:xe,nodeProxyIntent:Gt,normalFlat:o4,normalGeometry:wx,normalLocal:nr,normalMap:J2,normalView:Ie,normalViewGeometry:Nd,normalWorld:Lc,normalWorldGeometry:a4,normalize:Qi,not:kC,notEqual:UC,numWorkgroups:Mk,objectDirection:vz,objectGroup:rT,objectPosition:Nz,objectRadius:Cz,objectScale:Rz,objectViewPosition:Ez,objectWorldMatrix:Az,oneMinus:a5,or:GC,orthographicDepthToViewZ:A6,oscSawtooth:dG,oscSine:cG,oscSquare:uG,oscTriangle:hG,output:fd,outputStruct:zV,overloadingFn:ri,packHalf2x16:tG,packSnorm2x16:QV,packUnorm2x16:JV,parabola:rw,parallaxDirection:M4,parallaxUV:Qz,parameter:DV,pass:ok,passTexture:ak,pcurve:KV,perspectiveDepthToViewZ:qT,pmremTexture:JT,pointShadow:AD,pointUV:GG,pointWidth:UP,positionGeometry:Yp,positionLocal:kn,positionPrevious:Ad,positionView:cs,positionViewDirection:dn,positionWorld:ra,positionWorldDirection:OT,posterize:sk,pow:$r,pow2:xT,pow3:g5,pow4:bT,premultiplyAlpha:bB,property:il,quadBroadcast:g9,quadSwapDiagonal:u9,quadSwapX:l9,quadSwapY:c9,radians:s5,rand:b5,range:Tk,rangeFogFactor:hD,reciprocal:c5,reference:Nn,referenceBuffer:Y2,reflect:f5,reflectVector:d4,reflectView:u4,reflector:TG,refract:wT,refractVector:f4,refractView:h4,reinhardToneMapping:iD,remap:H5,remapClamp:W5,renderGroup:ee,renderOutput:$5,rendererReference:U5,replaceDefaultUV:fG,rotate:Kp,rotateUV:pG,roughness:Xo,round:l5,rtt:ZB,sRGBTransferEOTF:D5,sRGBTransferOETF:L5,sample:BG,sampler:mz,samplerComparison:gz,saturate:xx,saturation:JG,screenCoordinate:Wu,screenDPR:Q5,screenSize:Uu,screenUV:ia,select:yi,setCurrentStack:Pp,setName:_T,shaderStages:G2,shadow:_D,shadowPositionWorld:d_,shapeCircle:G9,sharedUniformGroup:mx,sheen:yr,sheenRoughness:lc,shiftLeft:jC,shiftRight:YC,shininess:Oy,sign:dT,sin:Ni,sinc:ZV,skinning:hB,smoothstep:No,smoothstepElement:w5,specularColor:vc,specularColorBlended:Au,specularF90:Nu,spherizeUV:mG,split:OP,spritesheetUV:xG,sqrt:Di,stack:Gg,step:vd,stepElement:T5,storage:Tc,storageBarrier:Bk,storageTexture:tD,string:DP,struct:PV,sub:De,subBuild:Du,subgroupAdd:jk,subgroupAll:r9,subgroupAnd:t9,subgroupAny:o9,subgroupBallot:Xk,subgroupBroadcast:h9,subgroupBroadcastFirst:a9,subgroupElect:$k,subgroupExclusiveAdd:Kk,subgroupExclusiveMul:Jk,subgroupInclusiveAdd:Yk,subgroupInclusiveMul:Qk,subgroupIndex:l6,subgroupMax:i9,subgroupMin:s9,subgroupMul:Zk,subgroupOr:e9,subgroupShuffle:d9,subgroupShuffleDown:m9,subgroupShuffleUp:p9,subgroupShuffleXor:f9,subgroupSize:Rk,subgroupXor:n9,tan:r5,tangentGeometry:_x,tangentLocal:Rd,tangentView:Mx,tangentWorld:T4,texture:He,texture3D:Lx,texture3DLevel:XG,texture3DLoad:$G,textureBarrier:Dk,textureBicubic:fI,textureBicubicLevel:QT,textureCubeUV:LB,textureLevel:pz,textureLoad:Zn,textureSize:wc,textureStore:HG,thickness:eT,time:Od,toneMapping:P5,toneMappingExposure:z5,toonOutlinePass:uk,transformDirection:y5,transformNormal:l4,transformNormalToView:UT,transformedClearcoatNormalView:Vz,transformedNormalView:zz,transformedNormalWorld:Iz,transmission:Fy,transpose:u5,triNoise3D:rG,triplanarTexture:bG,triplanarTextures:KB,trunc:gT,uint:Ut,uintBitsToFloat:WV,uniform:Jt,uniformArray:mi,uniformCubeTexture:kz,uniformFlow:M5,uniformGroup:CC,uniformTexture:fz,unpackHalf2x16:sG,unpackNormal:Q2,unpackSnorm2x16:eG,unpackUnorm2x16:nG,unpremultiplyAlpha:V6,userData:YG,uv:cn,uvec2:Kw,uvec3:Hu,uvec4:tT,varying:Cc,varyingProperty:zp,vec2:It,vec3:it,vec4:se,vectorComponents:Gu,velocity:ZG,vertexColor:xB,vertexIndex:rB,vertexStage:B5,vibrance:tk,viewZToLogarithmicDepth:$T,viewZToOrthographicDepth:md,viewZToPerspectiveDepth:WT,viewZToReversedOrthographicDepth:v6,viewZToReversedPerspectiveDepth:gB,viewport:DT,viewportCoordinate:J5,viewportDepthTexture:HT,viewportLinearDepth:R6,viewportMipTexture:kT,viewportOpaqueMipTexture:mB,viewportResolution:wz,viewportSafeUV:yG,viewportSharedTexture:rk,viewportSize:LT,viewportTexture:T6,viewportUV:Sz,vogelDiskSample:wo,wgsl:gk,wgslFn:bk,workgroupArray:Fk,workgroupBarrier:Ck,workgroupId:vk,workingToColorSpace:O5,xor:HC});const go=new t_;class _H extends Oc{constructor(t,e){super(),this.renderer=t,this.nodes=e}update(t,e,n){const s=this.renderer,i=this.nodes.getBackgroundNode(t)||t.background;let a=!1;if(i===null)s._clearColor.getRGB(go),go.a=s._clearColor.a;else if(i.isColor===!0)i.getRGB(go),go.a=1,a=!0;else if(i.isNode===!0){const d=this.get(t),f=i;go.copy(s._clearColor);let p=d.backgroundMesh;if(p===void 0){let A=function(){i.removeEventListener("dispose",A),p.material.dispose(),p.geometry.dispose()};var u=A;const y=se(f).mul(ow).context({getUV:()=>JB.mul(a4),getTextureLevel:()=>QB}),x=rl.element(3).element(3).equal(1),S=vr(1,rl.element(1).element(1)).mul(3),T=x.select(kn.mul(S),kn),M=Dc.mul(se(T,0));let N=rl.mul(se(M.xyz,1));N=N.setZ(N.w);const v=new ss;v.name="Background.material",v.side=us,v.depthTest=!1,v.depthWrite=!1,v.allowOverride=!1,v.fog=!1,v.lights=!1,v.vertexNode=N,v.colorNode=y,d.backgroundMeshNode=y,d.backgroundMesh=p=new C(new ke(1,32,32),v),p.frustumCulled=!1,p.name="Background.mesh",i.addEventListener("dispose",A)}const g=f.getCacheKey();d.backgroundCacheKey!==g&&(d.backgroundMeshNode.node=se(f).mul(ow),d.backgroundMeshNode.needsUpdate=!0,p.material.needsUpdate=!0,d.backgroundCacheKey=g),e.unshift(p,p.geometry,p.material,0,0,null,null)}else Ht("Renderer: Unsupported background configuration.",i);const c=s.xr.getEnvironmentBlendMode();if(c==="additive"?go.set(0,0,0,1):c==="alpha-blend"&&go.set(0,0,0,0),s.autoClear===!0||a===!0){const d=n.clearColorValue;d.r=go.r,d.g=go.g,d.b=go.b,d.a=go.a,(s.backend.isWebGLBackend===!0||s.alpha===!0)&&(d.r*=d.a,d.g*=d.a,d.b*=d.a),n.depthClearValue=s.getClearDepth(),n.stencilClearValue=s.getClearStencil(),n.clearColor=s.autoClearColor===!0,n.clearDepth=s.autoClearDepth===!0,n.clearStencil=s.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let MH=0;class lw{constructor(t="",e=[],n=0){this.name=t,this.bindings=e,this.index=n,this.id=MH++}}class vH{constructor(t,e,n,s,i,a,c,u,d,f=[]){this.vertexShader=t,this.fragmentShader=e,this.computeShader=n,this.transforms=f,this.nodeAttributes=s,this.bindings=i,this.updateNodes=a,this.updateBeforeNodes=c,this.updateAfterNodes=u,this.observer=d,this.usedTimes=0}createBindings(){const t=[];for(const e of this.bindings)if(e.bindings[0].groupNode.shared!==!0){const s=new lw(e.name,[],e.index);t.push(s);for(const i of e.bindings)s.bindings.push(i.clone())}else t.push(e);return t}}class HR{constructor(t,e,n=null){this.isNodeAttribute=!0,this.name=t,this.type=e,this.node=n}}class AH{constructor(t,e,n){this.isNodeUniform=!0,this.name=t,this.type=e,this.node=n}get value(){return this.node.value}set value(t){this.node.value=t}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class PD{constructor(t,e,n=!1,s=null){this.isNodeVar=!0,this.name=t,this.type=e,this.readOnly=n,this.count=s}}class NH extends PD{constructor(t,e,n=null,s=null){super(t,e),this.needsInterpolation=!1,this.isNodeVarying=!0,this.interpolationType=n,this.interpolationSampling=s}}class RH{constructor(t,e,n=""){this.name=t,this.type=e,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let EH=0;class JS{constructor(t=null){this.id=EH++,this.nodesData=new WeakMap,this.parent=t}getData(t){let e=this.nodesData.get(t);return e===void 0&&this.parent!==null&&(e=this.parent.getData(t)),e}setData(t,e){this.nodesData.set(t,e)}}class CH{constructor(t,e){this.name=t,this.members=e,this.output=!1}}class Fc{constructor(t,e){this.name=t,this.value=e,this.boundary=0,this.itemSize=0,this.offset=0,this.index=-1}setValue(t){this.value=t}getValue(){return this.value}}class BH extends Fc{constructor(t,e=0){super(t,e),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class DH extends Fc{constructor(t,e=new Ot){super(t,e),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class LH extends Fc{constructor(t,e=new G){super(t,e),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class OH extends Fc{constructor(t,e=new je){super(t,e),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class FH extends Fc{constructor(t,e=new qt){super(t,e),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class UH extends Fc{constructor(t,e=new lx){super(t,e),this.isMatrix2Uniform=!0,this.boundary=8,this.itemSize=4}}class PH extends Fc{constructor(t,e=new sr){super(t,e),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class zH extends Fc{constructor(t,e=new Te){super(t,e),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class IH extends BH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class VH extends DH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class GH extends LH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class kH extends OH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class HH extends FH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class WH extends UH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class qH extends PH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class $H extends zH{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}let XH=0;const WR=new WeakMap,jH=new WeakMap,YH=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),lg=r=>/e/g.test(r)?String(r).replace(/\+/g,""):(r=Number(r),r+(r%1?"":".0"));class zD{constructor(t,e,n){this.object=t,this.material=t&&t.material||null,this.geometry=t&&t.geometry||null,this.renderer=e,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.types={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=Gg(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new JS,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.subBuildLayers=[],this.activeStacks=[],this.subBuildFn=null,this.fnCall=null,Object.defineProperty(this,"id",{value:XH++})}isFlatShading(){return this.material.flatShading===!0||this.geometry.hasAttribute("normal")===!1}isOpaque(){const t=this.material;return t.transparent===!1&&t.blending===fi&&t.alphaToCoverage===!1}createRenderTarget(t,e,n){return new cl(t,e,n)}createCubeRenderTarget(t,e){return new SB(t,e)}includes(t){return this.nodes.includes(t)}getOutputStructName(){}_getBindGroup(t,e){const n=e[0].groupNode;let s=n.shared;if(s)for(let a=1;a<e.length;a++)n!==e[a].groupNode&&(s=!1);let i;if(s){let a="";for(const f of e)if(f.isNodeUniformsGroup){f.uniforms.sort((p,g)=>p.nodeUniform.node.id-g.nodeUniform.node.id);for(const p of f.uniforms)a+=p.nodeUniform.node.id}else a+=f.nodeUniform.id;const c=this.renderer._currentRenderContext||this.renderer;let u=WR.get(c);u===void 0&&(u=new Map,WR.set(c,u));const d=Bd(a);i=u.get(d),i===void 0&&(i=new lw(t,e,this.bindingsIndexes[t].group),u.set(d,i))}else i=new lw(t,e,this.bindingsIndexes[t].group);return i}getBindGroupArray(t,e){const n=this.bindings[e];let s=n[t];return s===void 0&&(this.bindingsIndexes[t]===void 0&&(this.bindingsIndexes[t]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[t]=s=[]),s}getBindings(){let t=this.bindGroups;if(t===null){const e={},n=this.bindings;for(const s of G2)for(const i in n[s]){const a=n[s][i],c=e[i]||(e[i]=[]);for(const u of a)c.includes(u)===!1&&c.push(u)}t=[];for(const s in e){const i=e[s],a=this._getBindGroup(s,i);t.push(a)}this.bindGroups=t}return t}sortBindingGroups(){const t=this.getBindings();t.sort((e,n)=>e.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let e=0;e<t.length;e++){const n=t[e];this.bindingsIndexes[n.name].group=e,n.index=e}}setHashNode(t,e){this.hashNodes[e]=t}addNode(t){this.nodes.includes(t)===!1&&(this.nodes.push(t),this.setHashNode(t,t.getHash(this)))}addSequentialNode(t){const e=t.getUpdateBeforeType(),n=t.getUpdateAfterType();(e!==de.NONE||n!==de.NONE)&&this.sequentialNodes.includes(t)===!1&&this.sequentialNodes.push(t)}buildUpdateNodes(){for(const t of this.nodes)t.getUpdateType()!==de.NONE&&this.updateNodes.push(t);for(const t of this.sequentialNodes){const e=t.getUpdateBeforeType(),n=t.getUpdateAfterType();e!==de.NONE&&this.updateBeforeNodes.push(t),n!==de.NONE&&this.updateAfterNodes.push(t)}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(t){return t.magFilter===qs||t.magFilter===E2||t.magFilter===Ep||t.magFilter===Jo||t.minFilter===qs||t.minFilter===E2||t.minFilter===Ep||t.minFilter===Jo}getUniformBufferLimit(){return 16384}addChain(t){this.chaining.push(t)}removeChain(t){if(this.chaining.pop()!==t)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(t){return t}getTernary(){return null}getNodeFromHash(t){return this.hashNodes[t]}addFlow(t,e){return this.flowNodes[t].push(e),e}setContext(t){this.context=t}getContext(){return this.context}addContext(t){const e=this.getContext();return this.setContext({...this.context,...t}),e}getSharedContext(){const t={...this.context};return delete t.material,delete t.getUV,delete t.getOutput,delete t.getTextureLevel,delete t.getAO,delete t.getShadow,t}setCache(t){this.cache=t}getCache(){return this.cache}getCacheFromNode(t,e=!0){const n=this.getDataFromNode(t);return n.cache===void 0&&(n.cache=new JS(e?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){Wt("Abstract function.")}getInstanceIndex(){Wt("Abstract function.")}getDrawIndex(){Wt("Abstract function.")}getFrontFacing(){Wt("Abstract function.")}getFragCoord(){Wt("Abstract function.")}isFlipY(){return!1}increaseUsage(t){const e=this.getDataFromNode(t);return e.usageCount=e.usageCount===void 0?1:e.usageCount+1,e.usageCount}generateTexture(){Wt("Abstract function.")}generateTextureLod(){Wt("Abstract function.")}generateArrayDeclaration(t,e){return this.getType(t)+"[ "+e+" ]"}generateArray(t,e,n=null){let s=this.generateArrayDeclaration(t,e)+"( ";for(let i=0;i<e;i++){const a=n?n[i]:null;a!==null?s+=a.build(this,t):s+=this.generateConst(t),i<e-1&&(s+=", ")}return s+=" )",s}generateStruct(t,e,n=null){const s=[];for(const i of e){const{name:a,type:c}=i;n&&n[a]&&n[a].isNode?s.push(n[a].build(this,c)):s.push(this.generateConst(c))}return t+"( "+s.join(", ")+" )"}generateConst(t,e=null){if(e===null&&(t==="float"||t==="int"||t==="uint"?e=0:t==="bool"?e=!1:t==="color"?e=new qt:t==="vec2"||t==="uvec2"||t==="ivec2"?e=new Ot:t==="vec3"||t==="uvec3"||t==="ivec3"?e=new G:(t==="vec4"||t==="uvec4"||t==="ivec4")&&(e=new je)),t==="float")return lg(e);if(t==="int")return`${Math.round(e)}`;if(t==="uint")return e>=0?`${Math.round(e)}u`:"0u";if(t==="bool")return e?"true":"false";if(t==="color")return`${this.getType("vec3")}( ${lg(e.r)}, ${lg(e.g)}, ${lg(e.b)} )`;const n=this.getTypeLength(t),s=this.getComponentType(t),i=a=>this.generateConst(s,a);if(n===2)return`${this.getType(t)}( ${i(e.x)}, ${i(e.y)} )`;if(n===3)return`${this.getType(t)}( ${i(e.x)}, ${i(e.y)}, ${i(e.z)} )`;if(n===4&&t!=="mat2")return`${this.getType(t)}( ${i(e.x)}, ${i(e.y)}, ${i(e.z)}, ${i(e.w)} )`;if(n>=4&&e&&(e.isMatrix2||e.isMatrix3||e.isMatrix4))return`${this.getType(t)}( ${e.elements.map(i).join(", ")} )`;if(n>4)return`${this.getType(t)}()`;throw new Error(`NodeBuilder: Type '${t}' not found in generate constant attempt.`)}getType(t){return t==="color"?"vec3":t}hasGeometryAttribute(t){return this.geometry&&this.geometry.getAttribute(t)!==void 0}getAttribute(t,e){const n=this.attributes;for(const i of n)if(i.name===t)return i;const s=new HR(t,e);return this.registerDeclaration(s),n.push(s),s}getPropertyName(t){return t.name}isVector(t){return/vec\d/.test(t)}isMatrix(t){return/mat\d/.test(t)}isReference(t){return t==="void"||t==="property"||t==="sampler"||t==="samplerComparison"||t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="depthTexture"||t==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(t){const e=t.type;if(t.isDataTexture){if(e===di)return"int";if(e===Qn)return"uint"}return"float"}getElementType(t){return t==="mat2"?"vec2":t==="mat3"?"vec3":t==="mat4"?"vec4":this.getComponentType(t)}getComponentType(t){if(t=this.getVectorType(t),t==="float"||t==="bool"||t==="int"||t==="uint")return t;const e=/(b|i|u|)(vec|mat)([2-4])/.exec(t);return e===null?null:e[1]==="b"?"bool":e[1]==="i"?"int":e[1]==="u"?"uint":"float"}getVectorType(t){return t==="color"?"vec3":t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"?"vec4":t}getTypeFromLength(t,e="float"){if(t===1)return e;let n=mC(t);const s=e==="float"?"":e[0];return/mat2/.test(e)===!0&&(n=n.replace("vec","mat")),s+n}getTypeFromArray(t){return YH.get(t.constructor)}isInteger(t){return/int|uint|(i|u)vec/.test(t)}getTypeFromAttribute(t){let e=t;t.isInterleavedBufferAttribute&&(e=t.data);const n=e.array,s=t.itemSize,i=t.normalized;let a;return!(t instanceof tC)&&i!==!0&&(a=this.getTypeFromArray(n)),this.getTypeFromLength(s,a)}getTypeLength(t){const e=this.getVectorType(t),n=/vec([2-4])/.exec(e);return n!==null?Number(n[1]):e==="float"||e==="bool"||e==="int"||e==="uint"?1:/mat2/.test(t)===!0?4:/mat3/.test(t)===!0?9:/mat4/.test(t)===!0?16:0}getVectorFromMatrix(t){return t.replace("mat","vec")}changeComponentType(t,e){return this.getTypeFromLength(this.getTypeLength(t),e)}getIntegerType(t){const e=this.getComponentType(t);return e==="int"||e==="uint"?t:this.changeComponentType(t,"int")}setActiveStack(t){this.activeStacks.push(t)}removeActiveStack(t){if(this.activeStacks[this.activeStacks.length-1]===t)this.activeStacks.pop();else throw new Error("NodeBuilder: Invalid active stack removal.")}getActiveStack(){return this.activeStacks[this.activeStacks.length-1]}getBaseStack(){return this.activeStacks[0]}addStack(){this.stack=Gg(this.stack);const t=Yw();return this.stacks.push(t),Pp(this.stack),this.stack}removeStack(){const t=this.stack;for(const e of t.nodes){const n=this.getDataFromNode(e);n.stack=t}return this.stack=t.parent,Pp(this.stacks.pop()),t}getDataFromNode(t,e=this.shaderStage,n=null){n=n===null?t.isGlobal(this)?this.globalCache:this.cache:n;let s=n.getData(t);s===void 0&&(s={},n.setData(t,s)),s[e]===void 0&&(s[e]={});let i=s[e];const a=s.any?s.any.subBuilds:null,c=this.getClosestSubBuild(a);return c&&(i.subBuildsCache===void 0&&(i.subBuildsCache={}),i=i.subBuildsCache[c]||(i.subBuildsCache[c]={}),i.subBuilds=a),i}getNodeProperties(t,e="any"){const n=this.getDataFromNode(t,e);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(t,e){const n=this.getDataFromNode(t,"vertex");let s=n.bufferAttribute;if(s===void 0){const i=this.uniforms.index++;s=new HR("nodeAttribute"+i,e,t),this.bufferAttributes.push(s),n.bufferAttribute=s}return s}getStructTypeNode(t,e=this.shaderStage){return this.types[e][t]||null}getStructTypeFromNode(t,e,n=null,s=this.shaderStage){const i=this.getDataFromNode(t,s,this.globalCache);let a=i.structType;if(a===void 0){const c=this.structs.index++;n===null&&(n="StructType"+c),a=new CH(n,e),this.structs[s].push(a),this.types[s][n]=t,i.structType=a}return a}getOutputStructTypeFromNode(t,e){const n=this.getStructTypeFromNode(t,e,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(t,e,n=this.shaderStage,s=null){const i=this.getDataFromNode(t,n,this.globalCache);let a=i.uniform;if(a===void 0){const c=this.uniforms.index++;a=new AH(s||"nodeUniform"+c,e,t),this.uniforms[n].push(a),this.registerDeclaration(a),i.uniform=a}return a}getVarFromNode(t,e=null,n=t.getNodeType(this),s=this.shaderStage,i=!1){const a=this.getDataFromNode(t,s),c=this.getSubBuildProperty("variable",a.subBuilds);let u=a[c];if(u===void 0){const d=i?"_const":"_var",f=this.vars[s]||(this.vars[s]=[]),p=this.vars[d]||(this.vars[d]=0);e===null&&(e=(i?"nodeConst":"nodeVar")+p,this.vars[d]++),c!=="variable"&&(e=this.getSubBuildProperty(e,a.subBuilds));const g=t.getArrayCount(this);u=new PD(e,n,i,g),i||f.push(u),this.registerDeclaration(u),a[c]=u}return u}isDeterministic(t){if(t.isMathNode)return this.isDeterministic(t.aNode)&&(t.bNode?this.isDeterministic(t.bNode):!0)&&(t.cNode?this.isDeterministic(t.cNode):!0);if(t.isOperatorNode)return this.isDeterministic(t.aNode)&&(t.bNode?this.isDeterministic(t.bNode):!0);if(t.isArrayNode){if(t.values!==null){for(const e of t.values)if(!this.isDeterministic(e))return!1}return!0}else if(t.isConstNode)return!0;return!1}getVaryingFromNode(t,e=null,n=t.getNodeType(this),s=null,i=null){const a=this.getDataFromNode(t,"any"),c=this.getSubBuildProperty("varying",a.subBuilds);let u=a[c];if(u===void 0){const d=this.varyings,f=d.length;e===null&&(e="nodeVarying"+f),c!=="varying"&&(e=this.getSubBuildProperty(e,a.subBuilds)),u=new NH(e,n,s,i),d.push(u),this.registerDeclaration(u),a[c]=u}return u}registerDeclaration(t){const e=this.shaderStage,n=this.declarations[e]||(this.declarations[e]={}),s=this.getPropertyName(t);let i=1,a=s;for(;n[a]!==void 0;)a=s+"_"+i++;i>1&&(t.name=a,Wt(`TSL: Declaration name '${s}' of '${t.type}' already in use. Renamed to '${a}'.`)),n[a]=t}getCodeFromNode(t,e,n=this.shaderStage){const s=this.getDataFromNode(t);let i=s.code;if(i===void 0){const a=this.codes[n]||(this.codes[n]=[]),c=a.length;i=new RH("nodeCode"+c,e),a.push(i),s.code=i}return i}addFlowCodeHierarchy(t,e){const{flowCodes:n,flowCodeBlock:s}=this.getDataFromNode(t);let i=!0,a=e;for(;a;){if(s.get(a)===!0){i=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(i)for(const c of n)this.addLineFlowCode(c)}addLineFlowCodeBlock(t,e,n){const s=this.getDataFromNode(t),i=s.flowCodes||(s.flowCodes=[]),a=s.flowCodeBlock||(s.flowCodeBlock=new WeakMap);i.push(e),a.set(n,!0)}addLineFlowCode(t,e=null){return t===""?this:(e!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(e,t,this.context.nodeBlock),t=this.tab+t,/;\s*$/.test(t)||(t=t+`;
`),this.flow.code+=t,this)}addFlowCode(t){return this.flow.code+=t,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(t){return this.flowsData.get(t)}flowNode(t){const e=t.getNodeType(this),n=this.flowChildNode(t,e);return this.flowsData.set(t,n),n}addInclude(t){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(t)}buildFunctionNode(t){const e=new cD,n=this.currentFunctionNode;return this.currentFunctionNode=e,e.code=this.buildFunctionCode(t),this.currentFunctionNode=n,e}flowShaderNode(t){const e=t.layout,n={[Symbol.iterator](){let a=0;const c=Object.values(this);return{next:()=>({value:c[a],done:a++>=c.length})}}};for(const a of e.inputs)n[a.name]=new kB(a.type,a.name);t.layout=null;const s=t.call(n),i=this.flowStagesNode(s,e.type);return t.layout=e,i}flowBuildStage(t,e,n=null){const s=this.getBuildStage();this.setBuildStage(e);const i=t.build(this,n);return this.setBuildStage(s),i}flowStagesNode(t,e=null){const n=this.flow,s=this.vars,i=this.declarations,a=this.cache,c=this.buildStage,u=this.stack,d={code:""};this.flow=d,this.vars={},this.declarations={},this.cache=new JS,this.stack=Gg();for(const f of V2)this.setBuildStage(f),d.result=t.build(this,e);return d.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=s,this.declarations=i,this.cache=a,this.stack=u,this.setBuildStage(c),d}getFunctionOperator(){return null}buildFunctionCode(){Wt("Abstract function.")}flowChildNode(t,e=null){const n=this.flow,s={code:""};return this.flow=s,s.result=t.build(this,e),this.flow=n,s}flowNodeFromShaderStage(t,e,n=null,s=null){const i=this.tab,a=this.cache,c=this.shaderStage,u=this.context;this.setShaderStage(t);const d={...this.context};delete d.nodeBlock,this.cache=this.globalCache,this.tab="	",this.context=d;let f=null;if(this.buildStage==="generate"){const p=this.flowChildNode(e,n);s!==null&&(p.code+=`${this.tab+s} = ${p.result};
`),this.flowCode[t]=this.flowCode[t]+p.code,f=p}else f=e.build(this);return this.setShaderStage(c),this.cache=a,this.tab=i,this.context=u,f}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){Wt("Abstract function.")}getVaryings(){Wt("Abstract function.")}getVar(t,e,n=null){return`${n!==null?this.generateArrayDeclaration(t,n):this.getType(t)} ${e}`}getVars(t){let e="";const n=this.vars[t];if(n!==void 0)for(const s of n)e+=`${this.getVar(s.type,s.name)}; `;return e}getUniforms(){Wt("Abstract function.")}getCodes(t){const e=this.codes[t];let n="";if(e!==void 0)for(const s of e)n+=s.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(t){this.shaderStage=t}getShaderStage(){return this.shaderStage}setBuildStage(t){this.buildStage=t}getBuildStage(){return this.buildStage}buildCode(){Wt("Abstract function.")}get subBuild(){return this.subBuildLayers[this.subBuildLayers.length-1]||null}addSubBuild(t){this.subBuildLayers.push(t)}removeSubBuild(){return this.subBuildLayers.pop()}getClosestSubBuild(t){let e;if(t&&t.isNode?t.isShaderCallNodeInternal?e=t.shaderNode.subBuilds:t.isStackNode?e=[t.subBuild]:e=this.getDataFromNode(t,"any").subBuilds:t instanceof Set?e=[...t]:e=t,!e)return null;const n=this.subBuildLayers;for(let s=e.length-1;s>=0;s--){const i=e[s];if(n.includes(i))return i}return null}getSubBuildOutput(t){return this.getSubBuildProperty("outputNode",t)}getSubBuildProperty(t="",e=null){let n;e!==null?n=this.getClosestSubBuild(e):n=this.subBuildFn;let s;return n?s=t?n+"_"+t:n:s=t,s}build(){const{object:t,material:e,renderer:n}=this;if(e!==null){let s=n.library.fromMaterial(e);s===null&&(Ht(`NodeMaterial: Material "${e.type}" is not compatible.`),s=new ss),s.build(this)}else this.addFlow("compute",t);for(const s of V2){this.setBuildStage(s),this.context.position&&this.context.position.isNode&&this.flowNodeFromShaderStage("vertex",this.context.position);for(const i of G2){this.setShaderStage(i);const a=this.flowNodes[i];for(const c of a)s==="generate"?this.flowNode(c):c.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getSharedDataFromNode(t){let e=jH.get(t);return e===void 0&&(e={}),e}getNodeUniform(t,e){const n=this.getSharedDataFromNode(t);let s=n.cache;if(s===void 0){if(e==="float"||e==="int"||e==="uint")s=new IH(t);else if(e==="vec2"||e==="ivec2"||e==="uvec2")s=new VH(t);else if(e==="vec3"||e==="ivec3"||e==="uvec3")s=new GH(t);else if(e==="vec4"||e==="ivec4"||e==="uvec4")s=new kH(t);else if(e==="color")s=new HH(t);else if(e==="mat2")s=new WH(t);else if(e==="mat3")s=new qH(t);else if(e==="mat4")s=new $H(t);else throw new Error(`Uniform "${e}" not implemented.`);n.cache=s}return s}format(t,e,n){if(e=this.getVectorType(e),n=this.getVectorType(n),e===n||n===null||this.isReference(n))return t;const s=this.getTypeLength(e),i=this.getTypeLength(n);return s===16&&i===9?`${this.getType(n)}( ${t}[ 0 ].xyz, ${t}[ 1 ].xyz, ${t}[ 2 ].xyz )`:s===9&&i===4?`${this.getType(n)}( ${t}[ 0 ].xy, ${t}[ 1 ].xy )`:s>4||i>4||i===0?t:s===i?`${this.getType(n)}( ${t} )`:s>i?(t=n==="bool"?`all( ${t} )`:`${t}.${"xyz".slice(0,i)}`,this.format(t,this.getTypeFromLength(i,this.getComponentType(e)),n)):i===4&&s>1?`${this.getType(n)}( ${this.format(t,e,"vec3")}, 1.0 )`:s===2?`${this.getType(n)}( ${this.format(t,e,"vec2")}, 0.0 )`:(s===1&&i>1&&e!==this.getComponentType(n)&&(t=`${this.getType(this.getComponentType(n))}( ${t} )`),`${this.getType(n)}( ${t} )`)}getSignature(){return`// Three.js r${kp} - Node System
`}needsPreviousData(){const t=this.renderer.getMRT();return t&&t.has("velocity")||yC(this.object).useVelocity===!0}}class qR{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(t,e){let n=t.get(e);return n===void 0&&(n={renderId:0,frameId:0},t.set(e,n)),n}updateBeforeNode(t){const e=t.getUpdateBeforeType(),n=t.updateReference(this);if(e===de.FRAME){const s=this._getMaps(this.updateBeforeMap,n);if(s.frameId!==this.frameId){const i=s.frameId;s.frameId=this.frameId,t.updateBefore(this)===!1&&(s.frameId=i)}}else if(e===de.RENDER){const s=this._getMaps(this.updateBeforeMap,n);if(s.renderId!==this.renderId){const i=s.renderId;s.renderId=this.renderId,t.updateBefore(this)===!1&&(s.renderId=i)}}else e===de.OBJECT&&t.updateBefore(this)}updateAfterNode(t){const e=t.getUpdateAfterType(),n=t.updateReference(this);if(e===de.FRAME){const s=this._getMaps(this.updateAfterMap,n);s.frameId!==this.frameId&&t.updateAfter(this)!==!1&&(s.frameId=this.frameId)}else if(e===de.RENDER){const s=this._getMaps(this.updateAfterMap,n);s.renderId!==this.renderId&&t.updateAfter(this)!==!1&&(s.renderId=this.renderId)}else e===de.OBJECT&&t.updateAfter(this)}updateNode(t){const e=t.getUpdateType(),n=t.updateReference(this);if(e===de.FRAME){const s=this._getMaps(this.updateMap,n);s.frameId!==this.frameId&&t.update(this)!==!1&&(s.frameId=this.frameId)}else if(e===de.RENDER){const s=this._getMaps(this.updateMap,n);s.renderId!==this.renderId&&t.update(this)!==!1&&(s.renderId=this.renderId)}else e===de.OBJECT&&t.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class g_{constructor(t,e,n=null,s="",i=!1){this.type=t,this.name=e,this.count=n,this.qualifier=s,this.isConst=i}}g_.isNodeFunctionInput=!0;class KH extends qu{static get type(){return"AmbientLightNode"}constructor(t=null){super(t)}setup({context:t}){t.irradiance.addAssign(this.colorNode)}}class ZH extends qu{static get type(){return"DirectionalLightNode"}constructor(t=null){super(t)}setupDirect(){const t=this.colorNode;return{lightDirection:u_(this.light),lightColor:t}}}class QH extends qu{static get type(){return"HemisphereLightNode"}constructor(t=null){super(t),this.lightPositionNode=l_(t),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Jt(new qt).setGroup(ee)}update(t){const{light:e}=this;super.update(t),this.lightPositionNode.object3d=e,this.groundColorNode.value.copy(e.groundColor).multiplyScalar(e.intensity)}setup(t){const{colorNode:e,groundColorNode:n,lightDirectionNode:s}=this,a=Lc.dot(s).mul(.5).add(.5),c=Ce(n,e,a);t.context.irradiance.addAssign(c)}}class y_ extends qu{static get type(){return"SpotLightNode"}constructor(t=null){super(t),this.coneCosNode=Jt(0).setGroup(ee),this.penumbraCosNode=Jt(0).setGroup(ee),this.cutoffDistanceNode=Jt(0).setGroup(ee),this.decayExponentNode=Jt(0).setGroup(ee),this.colorNode=Jt(this.color).setGroup(ee)}update(t){super.update(t);const{light:e}=this;this.coneCosNode.value=Math.cos(e.angle),this.penumbraCosNode.value=Math.cos(e.angle*(1-e.penumbra)),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}getSpotAttenuation(t,e){const{coneCosNode:n,penumbraCosNode:s}=this;return No(n,s,e)}getLightCoord(t){const e=t.getNodeProperties(this);let n=e.projectionUV;return n===void 0&&(n=fD(this.light,t.context.positionWorld),e.projectionUV=n),n}setupDirect(t){const{colorNode:e,cutoffDistanceNode:n,decayExponentNode:s,light:i}=this,a=this.getLightVector(t),c=a.normalize(),u=c.dot(u_(i)),d=this.getSpotAttenuation(t,u),f=a.length(),p=f_({lightDistance:f,cutoffDistance:n,decayExponent:s});let g=e.mul(d).mul(p),y,x;return i.colorNode?(x=this.getLightCoord(t),y=i.colorNode(x)):i.map&&(x=this.getLightCoord(t),y=He(i.map,x.xy).onRenderUpdate(()=>i.map)),y&&(g=x.mul(2).sub(1).abs().lessThan(1).all().select(g.mul(y),g)),{lightColor:g,lightDirection:c}}}class JH extends y_{static get type(){return"IESSpotLightNode"}getSpotAttenuation(t,e){const n=this.light.iesMap;let s=null;if(n&&n.isTexture===!0){const i=e.acos().mul(1/Math.PI);s=He(n,It(i,0),0).r}else s=super.getSpotAttenuation(e);return s}}class tW extends qu{static get type(){return"LightProbeNode"}constructor(t=null){super(t);const e=[];for(let n=0;n<9;n++)e.push(new G);this.lightProbe=mi(e)}update(t){const{light:e}=this;super.update(t);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(e.sh.coefficients[n]).multiplyScalar(e.intensity)}setup(t){const e=UD(Lc,this.lightProbe);t.context.irradiance.addAssign(e)}}const eW=ut(([r,t])=>{const e=r.abs().sub(t);return sa(qn(e,0)).add(er(qn(e.x,e.y),0))});class nW extends y_{static get type(){return"ProjectorLightNode"}update(t){super.update(t);const e=this.light;if(this.penumbraCosNode.value=Math.min(Math.cos(e.angle*(1-e.penumbra)),.99999),e.aspect===null){let n=1;e.map!==null&&(n=e.map.width/e.map.height),e.shadow.aspect=n}else e.shadow.aspect=e.aspect}getSpotAttenuation(t){const e=k(0),n=this.penumbraCosNode,s=Ux(this.light).mul(t.context.positionWorld||ra);return re(s.w.greaterThan(0),()=>{const i=s.xyz.div(s.w),a=eW(i.xy.sub(It(.5)),It(.5)),c=vr(-1,De(1,uT(n)).sub(1));e.assign(xx(a.mul(-2).mul(c)))}),e}}const t2=new Te,cg=new Te;let qf=null;class sW extends qu{static get type(){return"RectAreaLightNode"}constructor(t=null){super(t),this.halfHeight=Jt(new G).setGroup(ee),this.halfWidth=Jt(new G).setGroup(ee),this.updateType=de.RENDER}update(t){super.update(t);const{light:e}=this,n=t.camera.matrixWorldInverse;cg.identity(),t2.copy(e.matrixWorld),t2.premultiply(n),cg.extractRotation(t2),this.halfWidth.value.set(e.width*.5,0,0),this.halfHeight.value.set(0,e.height*.5,0),this.halfWidth.value.applyMatrix4(cg),this.halfHeight.value.applyMatrix4(cg)}setupDirectRectArea(t){let e,n;t.isAvailable("float32Filterable")?(e=He(qf.LTC_FLOAT_1),n=He(qf.LTC_FLOAT_2)):(e=He(qf.LTC_HALF_1),n=He(qf.LTC_HALF_2));const{colorNode:s,light:i}=this,a=c_(i);return{lightColor:s,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:e,ltc_2:n}}static setLTC(t){qf=t}}class ID{parseFunction(){Wt("Abstract function.")}}class x_{constructor(t,e,n="",s=""){this.type=t,this.inputs=e,this.name=n,this.precision=s}getCode(){Wt("Abstract function.")}}x_.isNodeFunction=!0;const iW=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,rW=/[a-z_0-9]+/ig,$R="#pragma main",oW=r=>{r=r.trim();const t=r.indexOf($R),e=t!==-1?r.slice(t+$R.length):r,n=e.match(iW);if(n!==null&&n.length===5){const s=n[4],i=[];let a=null;for(;(a=rW.exec(s))!==null;)i.push(a);const c=[];let u=0;for(;u<i.length;){const x=i[u][0]==="const";x===!0&&u++;let S=i[u][0];S==="in"||S==="out"||S==="inout"?u++:S="";const T=i[u++][0];let M=Number.parseInt(i[u][0]);Number.isNaN(M)===!1?u++:M=null;const N=i[u++][0];c.push(new g_(T,N,M,S,x))}const d=e.substring(n[0].length),f=n[3]!==void 0?n[3]:"",p=n[2],g=n[1]!==void 0?n[1]:"",y=t!==-1?r.slice(0,t):"";return{type:p,inputs:c,name:f,precision:g,inputsCode:s,blockCode:d,headerCode:y}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class aW extends x_{constructor(t){const{type:e,inputs:n,name:s,precision:i,inputsCode:a,blockCode:c,headerCode:u}=oW(t);super(e,n,s,i),this.inputsCode=a,this.blockCode=c,this.headerCode=u}getCode(t=this.name){let e;const n=this.blockCode;if(n!==""){const{type:s,inputsCode:i,headerCode:a,precision:c}=this;let u=`${s} ${t} ( ${i.trim()} )`;c!==""&&(u=`${c} ${u}`),e=a+u+n}else e="";return e}}class lW extends ID{parseFunction(t){return new aW(t)}}const XR=new WeakMap,kr=[],ql=[];class cW extends Oc{constructor(t,e){super(),this.renderer=t,this.backend=e,this.nodeFrame=new qR,this.nodeBuilderCache=new Map,this.callHashCache=new Nc,this.groupsData=new Nc,this.cacheLib={}}updateGroup(t){const e=t.groupNode,n=e.name;if(n===rT.name)return!0;if(n===ee.name){const i=this.get(t),a=this.nodeFrame.renderId;return i.renderId!==a?(i.renderId=a,!0):!1}if(n===BC.name){const i=this.get(t),a=this.nodeFrame.frameId;return i.frameId!==a?(i.frameId=a,!0):!1}kr[0]=e,kr[1]=t;let s=this.groupsData.get(kr);return s===void 0&&this.groupsData.set(kr,s={}),kr[0]=null,kr[1]=null,s.version!==e.version?(s.version=e.version,!0):!1}getForRenderCacheKey(t){return t.initialCacheKey}getForRender(t){const e=this.get(t);let n=e.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:s}=this,i=this.getForRenderCacheKey(t);if(n=s.get(i),n===void 0){const a=u=>{const d=this.backend.createNodeBuilder(t.object,this.renderer);return d.scene=t.scene,d.material=u,d.camera=t.camera,d.context.material=u,d.lightsNode=t.lightsNode,d.environmentNode=this.getEnvironmentNode(t.scene),d.fogNode=this.getFogNode(t.scene),d.clippingContext=t.clippingContext,this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview&&d.enableMultiview(),d};let c=a(t.material);try{c.build()}catch(u){c=a(new ss),c.build();let d=u.stackTrace;!d&&u.stack&&(d=new ds(u.stack)),Ht("TSL: "+u,d)}n=this._createNodeBuilderState(c),s.set(i,n)}n.usedTimes++,e.nodeBuilderState=n}return n}delete(t){if(t.isRenderObject){const e=this.get(t).nodeBuilderState;e.usedTimes--,e.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(t))}return super.delete(t)}getForCompute(t){const e=this.get(t);let n=e.nodeBuilderState;if(n===void 0){const s=this.backend.createNodeBuilder(t,this.renderer);s.build(),n=this._createNodeBuilderState(s),e.nodeBuilderState=n}return n}_createNodeBuilderState(t){return new vH(t.vertexShader,t.fragmentShader,t.computeShader,t.getAttributesArray(),t.getBindings(),t.updateNodes,t.updateBeforeNodes,t.updateAfterNodes,t.observer,t.transforms)}getEnvironmentNode(t){this.updateEnvironment(t);let e=null;if(t.environmentNode&&t.environmentNode.isNode)e=t.environmentNode;else{const n=this.get(t);n.environmentNode&&(e=n.environmentNode)}return e}getBackgroundNode(t){this.updateBackground(t);let e=null;if(t.backgroundNode&&t.backgroundNode.isNode)e=t.backgroundNode;else{const n=this.get(t);n.backgroundNode&&(e=n.backgroundNode)}return e}getFogNode(t){return this.updateFog(t),t.fogNode||this.get(t).fogNode||null}getCacheKey(t,e){kr[0]=t,kr[1]=e;const n=this.renderer.info.calls,s=this.callHashCache.get(kr)||{};if(s.callId!==n){const i=this.getEnvironmentNode(t),a=this.getFogNode(t);e&&ql.push(e.getCacheKey(!0)),i&&ql.push(i.getCacheKey()),a&&ql.push(a.getCacheKey()),ql.push(this.renderer.getOutputRenderTarget()&&this.renderer.getOutputRenderTarget().multiview?1:0),ql.push(this.renderer.shadowMap.enabled?1:0),ql.push(this.renderer.shadowMap.type),s.callId=n,s.cacheKey=qp(ql),this.callHashCache.set(kr,s),ql.length=0}return kr[0]=null,kr[1]=null,s.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(t){const e=this.get(t),n=t.background;if(n){const s=t.backgroundBlurriness===0&&e.backgroundBlurriness>0||t.backgroundBlurriness>0&&e.backgroundBlurriness===0;if(e.background!==n||s){const i=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===Ky||n.mapping===_w||n.mapping===R2){if(t.backgroundBlurriness>0||n.mapping===R2)return JT(n);{let a;return n.isCubeTexture===!0?a=Ci(n):a=He(n),TB(a)}}else{if(n.isTexture===!0)return He(n,ia.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&Ht("WebGPUNodes: Unsupported background configuration.",n)}},s);e.backgroundNode=i,e.background=n,e.backgroundBlurriness=t.backgroundBlurriness}}else e.backgroundNode&&(delete e.backgroundNode,delete e.background)}getCacheNode(t,e,n,s=!1){const i=this.cacheLib[t]||(this.cacheLib[t]=new WeakMap);let a=i.get(e);return(a===void 0||s)&&(a=n(),i.set(e,a)),a}updateFog(t){const e=this.get(t),n=t.fog;if(n){if(e.fog!==n){const s=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const i=Nn("color","color",n).setGroup(ee),a=Nn("density","float",n).setGroup(ee);return aw(i,dD(a))}else if(n.isFog){const i=Nn("color","color",n).setGroup(ee),a=Nn("near","float",n).setGroup(ee),c=Nn("far","float",n).setGroup(ee);return aw(i,hD(a,c))}else Ht("Renderer: Unsupported fog configuration.",n)});e.fogNode=s,e.fog=n}}else delete e.fogNode,delete e.fog}updateEnvironment(t){const e=this.get(t),n=t.environment;if(n){if(e.environment!==n){const s=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return Ci(n);if(n.isTexture===!0)return He(n);Ht("Nodes: Unsupported environment configuration.",n)});e.environmentNode=s,e.environment=n}}else e.environmentNode&&(delete e.environmentNode,delete e.environment)}getNodeFrame(t=this.renderer,e=null,n=null,s=null,i=null){const a=this.nodeFrame;return a.renderer=t,a.scene=e,a.object=n,a.camera=s,a.material=i,a}getNodeFrameForRender(t){return this.getNodeFrame(t.renderer,t.scene,t.object,t.camera,t.material)}getOutputCacheKey(){const t=this.renderer;return t.toneMapping+","+t.currentColorSpace+","+t.xr.isPresenting}hasOutputChange(t){return XR.get(t)!==this.getOutputCacheKey()}getOutputNode(t){const e=this.renderer,n=this.getOutputCacheKey(),s=t.isArrayTexture?Lx(t,it(ia,hl("gl_ViewID_OVR"))).renderOutput(e.toneMapping,e.currentColorSpace):He(t,ia).renderOutput(e.toneMapping,e.currentColorSpace);return XR.set(t,n),s}updateBefore(t){const e=t.getNodeBuilderState();for(const n of e.updateBeforeNodes)this.getNodeFrameForRender(t).updateBeforeNode(n)}updateAfter(t){const e=t.getNodeBuilderState();for(const n of e.updateAfterNodes)this.getNodeFrameForRender(t).updateAfterNode(n)}updateForCompute(t){const e=this.getNodeFrame(),n=this.getForCompute(t);for(const s of n.updateNodes)e.updateNode(s)}updateForRender(t){const e=this.getNodeFrameForRender(t),n=t.getNodeBuilderState();for(const s of n.updateNodes)e.updateNode(s)}needsRefresh(t){const e=this.getNodeFrameForRender(t);return t.getMonitor().needsRefresh(t,e)}dispose(){super.dispose(),this.nodeFrame=new qR,this.nodeBuilderCache=new Map,this.cacheLib={}}}const e2=new rc;class Wy{constructor(t=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new sr,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,t!==null&&(this.viewNormalMatrix=t.viewNormalMatrix,this.clippingGroupContexts=t.clippingGroupContexts,this.shadowPass=t.shadowPass,this.viewMatrix=t.viewMatrix)}projectPlanes(t,e,n){const s=t.length;for(let i=0;i<s;i++){e2.copy(t[i]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const a=e[n+i],c=e2.normal;a.x=-c.x,a.y=-c.y,a.z=-c.z,a.w=e2.constant}}updateGlobal(t,e){this.shadowPass=t.overrideMaterial!==null&&t.overrideMaterial.isShadowPassMaterial,this.viewMatrix=e.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(t,e){let n=!1;t.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(t.intersectionPlanes),this.unionPlanes=Array.from(t.unionPlanes),this.parentVersion=t.version),this.clipIntersection!==e.clipIntersection&&(this.clipIntersection=e.clipIntersection,this.clipIntersection?this.unionPlanes.length=t.unionPlanes.length:this.intersectionPlanes.length=t.intersectionPlanes.length);const s=e.clippingPlanes,i=s.length;let a,c;if(this.clipIntersection?(a=this.intersectionPlanes,c=t.intersectionPlanes.length):(a=this.unionPlanes,c=t.unionPlanes.length),a.length!==c+i){a.length=c+i;for(let u=0;u<i;u++)a[c+u]=new je;n=!0}this.projectPlanes(s,a,c),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(t){if(this.shadowPass&&!t.clipShadows)return this;let e=this.clippingGroupContexts.get(t);return e===void 0&&(e=new Wy(this),this.clippingGroupContexts.set(t,e)),e.update(this,t),e}get unionClippingCount(){return this.unionPlanes.length}}class uW{constructor(t,e){this.bundleGroup=t,this.camera=e}}const $h=[];class hW{constructor(){this.bundles=new Nc}get(t,e){const n=this.bundles;$h[0]=t,$h[1]=e;let s=n.get($h);return s===void 0&&(s=new uW(t,e),n.set($h,s)),$h[0]=null,$h[1]=null,s}dispose(){this.bundles=new Nc}}class VD{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(t){if(t.isNodeMaterial)return t;let e=null;const n=this.getMaterialNodeClass(t.type);if(n!==null){e=new n;for(const s in t)e[s]=t[s]}return e}addToneMapping(t,e){this.addType(t,e,this.toneMappingNodes)}getToneMappingFunction(t){return this.toneMappingNodes.get(t)||null}getMaterialNodeClass(t){return this.materialNodes.get(t)||null}addMaterial(t,e){this.addType(t,e,this.materialNodes)}getLightNodeClass(t){return this.lightNodes.get(t)||null}addLight(t,e){this.addClass(t,e,this.lightNodes)}addType(t,e,n){if(n.has(e)){Wt(`Redefinition of node ${e}`);return}if(typeof t!="function")throw new Error(`Node class ${t.name} is not a class.`);if(typeof e=="function"||typeof e=="object")throw new Error(`Base class ${e} is not a class.`);n.set(e,t)}addClass(t,e,n){if(n.has(e)){Wt(`Redefinition of node ${e.name}`);return}if(typeof t!="function")throw new Error(`Node class ${t.name} is not a class.`);if(typeof e!="function")throw new Error(`Base class ${e.name} is not a class.`);n.set(e,t)}}const dW=new h_,jR=new WeakMap;class fW{createNode(t=[]){return new h_().setLights(t)}getNode(t){if(t.isQuadMesh)return dW;let e=jR.get(t);return e===void 0&&(e=this.createNode(),jR.set(t,e)),e}}class rp extends cl{constructor(t=1,e=1,n={}){super(t,e,n),this.isXRRenderTarget=!0,this._hasExternalTextures=!1,this._autoAllocateDepthBuffer=!0,this._isOpaqueFramebuffer=!1}copy(t){return super.copy(t),this._hasExternalTextures=t._hasExternalTextures,this._autoAllocateDepthBuffer=t._autoAllocateDepthBuffer,this._isOpaqueFramebuffer=t._isOpaqueFramebuffer,this}}const YR=new G,KR=new G;class pW extends Rc{constructor(t,e=!1){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=t,this._cameraL=new $i,this._cameraL.viewport=new je,this._cameraR=new $i,this._cameraR.viewport=new je,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new Y8,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._sessionUsesLayers=!1,this._supportsGlBinding=typeof XRWebGLBinding<"u",this._frameBufferTargets=null,this._createXRLayer=SW.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Ot,this._onSessionEvent=yW.bind(this),this._onSessionEnd=xW.bind(this),this._onInputSourcesChange=bW.bind(this),this._onAnimationFrame=wW.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._supportsLayers=this._supportsGlBinding&&"createProjectionLayer"in XRWebGLBinding.prototype,this._useMultiviewIfPossible=e,this._useMultiview=!1}getController(t){return this._getController(t).getTargetRaySpace()}getControllerGrip(t){return this._getController(t).getGripSpace()}getHand(t){return this._getController(t).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(t){this._foveation=t,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=t),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=t)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(t){this._framebufferScaleFactor=t,this.isPresenting===!0&&Wt("XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(t){this._referenceSpaceType=t,this.isPresenting===!0&&Wt("XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(t){this._customReferenceSpace=t}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getBinding(){return this._glBinding===null&&this._supportsGlBinding&&(this._glBinding=new XRWebGLBinding(this._session,this._gl)),this._glBinding}getFrame(){return this._xrFrame}useMultiview(){return this._useMultiview}createQuadLayer(t,e,n,s,i,a,c,u={}){const d=new Rn(t,e),f=new rp(i,a,{format:Yi,type:gi,depthTexture:new Yr(i,a,u.stencil?yc:Qn,void 0,void 0,void 0,void 0,void 0,void 0,u.stencil?el:To),stencilBuffer:u.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});f._autoAllocateDepthBuffer=!0;const p=new $e({color:16777215,side:Qo});p.map=f.texture,p.map.offset.y=1,p.map.repeat.y=-1;const g=new C(d,p);g.position.copy(n),g.quaternion.copy(s);const y={type:"quad",width:t,height:e,translation:n,quaternion:s,pixelwidth:i,pixelheight:a,plane:g,material:p,rendercall:c,renderTarget:f};if(this._layers.push(y),this._session!==null){y.plane.material=new $e({color:16777215,side:Qo}),y.plane.material.blending=ld,y.plane.material.blendEquation=qr,y.plane.material.blendSrc=ic,y.plane.material.blendDst=ic,y.xrlayer=this._createXRLayer(y);const x=this._session.renderState.layers;x.unshift(y.xrlayer),this._session.updateRenderState({layers:x})}else f.isXRRenderTarget=!1;return g}createCylinderLayer(t,e,n,s,i,a,c,u,d={}){const f=new $t(t,t,t*e/n,64,64,!0,Math.PI-e/2,e),p=new rp(a,c,{format:Yi,type:gi,depthTexture:new Yr(a,c,d.stencil?yc:Qn,void 0,void 0,void 0,void 0,void 0,void 0,d.stencil?el:To),stencilBuffer:d.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1});p._autoAllocateDepthBuffer=!0;const g=new $e({color:16777215,side:us});g.map=p.texture,g.map.offset.y=1,g.map.repeat.y=-1;const y=new C(f,g);y.position.copy(s),y.quaternion.copy(i);const x={type:"cylinder",radius:t,centralAngle:e,aspectratio:n,translation:s,quaternion:i,pixelwidth:a,pixelheight:c,plane:y,material:g,rendercall:u,renderTarget:p};if(this._layers.push(x),this._session!==null){x.plane.material=new $e({color:16777215,side:us}),x.plane.material.blending=ld,x.plane.material.blendEquation=qr,x.plane.material.blendSrc=ic,x.plane.material.blendDst=ic,x.xrlayer=this._createXRLayer(x);const S=this._session.renderState.layers;S.unshift(x.xrlayer),this._session.updateRenderState({layers:S})}else p.isXRRenderTarget=!1;return y}renderLayers(){const t=new G,e=new Us,n=this._renderer,s=this.isPresenting,i=n.getOutputRenderTarget(),a=n._frameBufferTarget;this.isPresenting=!1;const c=new Ot;n.getSize(c);const u=n._quad;for(const d of this._layers)if(d.renderTarget.isXRRenderTarget=this._session!==null,d.renderTarget._hasExternalTextures=d.renderTarget.isXRRenderTarget,d.renderTarget.isXRRenderTarget&&this._sessionUsesLayers){d.xrlayer.transform=new XRRigidTransform(d.plane.getWorldPosition(t),d.plane.getWorldQuaternion(e));const f=this._glBinding.getSubImage(d.xrlayer,this._xrFrame);n.backend.setXRRenderTargetTextures(d.renderTarget,f.colorTexture,void 0),n._setXRLayerSize(d.renderTarget.width,d.renderTarget.height),n.setOutputRenderTarget(d.renderTarget),n.setRenderTarget(null),n._frameBufferTarget=null,this._frameBufferTargets||(this._frameBufferTargets=new WeakMap);const{frameBufferTarget:p,quad:g}=this._frameBufferTargets.get(d.renderTarget)||{frameBufferTarget:null,quad:null};p?(n._frameBufferTarget=p,n._quad=g):(n._quad=new Bx(new ss),this._frameBufferTargets.set(d.renderTarget,{frameBufferTarget:n._getFrameBufferTarget(),quad:n._quad})),d.rendercall(),n._frameBufferTarget=null}else n.setRenderTarget(d.renderTarget),d.rendercall();n.setRenderTarget(null),n.setOutputRenderTarget(i),n._frameBufferTarget=a,n._setXRLayerSize(c.x,c.y),n._quad=u,this.isPresenting=s}getSession(){return this._session}async setSession(t){const e=this._renderer,n=e.backend;this._gl=e.getContext();const s=this._gl,i=s.getContextAttributes();if(this._session=t,t!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(t.addEventListener("select",this._onSessionEvent),t.addEventListener("selectstart",this._onSessionEvent),t.addEventListener("selectend",this._onSessionEvent),t.addEventListener("squeeze",this._onSessionEvent),t.addEventListener("squeezestart",this._onSessionEvent),t.addEventListener("squeezeend",this._onSessionEvent),t.addEventListener("end",this._onSessionEnd),t.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=e.getPixelRatio(),e.getSize(this._currentSize),this._currentAnimationContext=e._animation.getContext(),this._currentAnimationLoop=e._animation.getAnimationLoop(),e._animation.stop(),this._supportsLayers===!0){let a=null,c=null,u=null;e.depth&&(u=e.stencil?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24,a=e.stencil?el:To,c=e.stencil?yc:Qn);const d={colorFormat:s.RGBA8,depthFormat:u,scaleFactor:this._framebufferScaleFactor,clearOnAccess:!1};this._useMultiviewIfPossible&&e.hasFeature("OVR_multiview2")&&(d.textureType="texture-array",this._useMultiview=!0),this._glBinding=this.getBinding();const f=this._glBinding.createProjectionLayer(d),p=[f];this._glProjLayer=f,e.setPixelRatio(1),e._setXRLayerSize(f.textureWidth,f.textureHeight);const g=this._useMultiview?2:1,y=new Yr(f.textureWidth,f.textureHeight,c,void 0,void 0,void 0,void 0,void 0,void 0,a,g);if(this._xrRenderTarget=new rp(f.textureWidth,f.textureHeight,{format:Yi,type:gi,colorSpace:e.outputColorSpace,depthTexture:y,stencilBuffer:e.stencil,samples:i.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1,depth:this._useMultiview?2:1,multiview:this._useMultiview}),this._xrRenderTarget._hasExternalTextures=!0,this._xrRenderTarget.depth=this._useMultiview?2:1,this._sessionUsesLayers=t.enabledFeatures.includes("layers"),this._referenceSpace=await t.requestReferenceSpace(this.getReferenceSpaceType()),this._sessionUsesLayers)for(const x of this._layers)x.plane.material=new $e({color:16777215,side:x.type==="cylinder"?us:Qo}),x.plane.material.blending=ld,x.plane.material.blendEquation=qr,x.plane.material.blendSrc=ic,x.plane.material.blendDst=ic,x.xrlayer=this._createXRLayer(x),p.unshift(x.xrlayer);t.updateRenderState({layers:p})}else{const a={antialias:e.currentSamples>0,alpha:!0,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},c=new XRWebGLLayer(t,s,a);this._glBaseLayer=c,t.updateRenderState({baseLayer:c}),e.setPixelRatio(1),e._setXRLayerSize(c.framebufferWidth,c.framebufferHeight),this._xrRenderTarget=new rp(c.framebufferWidth,c.framebufferHeight,{format:Yi,type:gi,colorSpace:e.outputColorSpace,stencilBuffer:e.stencil,resolveDepthBuffer:c.ignoreDepthValues===!1,resolveStencilBuffer:c.ignoreDepthValues===!1}),this._xrRenderTarget._isOpaqueFramebuffer=!0,this._referenceSpace=await t.requestReferenceSpace(this.getReferenceSpaceType())}this.setFoveation(this.getFoveation()),e._animation.setAnimationLoop(this._onAnimationFrame),e._animation.setContext(t),e._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(t){const e=this._session;if(e===null)return;const n=t.near,s=t.far,i=this._cameraXR,a=this._cameraL,c=this._cameraR;i.near=c.near=a.near=n,i.far=c.far=a.far=s,i.isMultiViewCamera=this._useMultiview,(this._currentDepthNear!==i.near||this._currentDepthFar!==i.far)&&(e.updateRenderState({depthNear:i.near,depthFar:i.far}),this._currentDepthNear=i.near,this._currentDepthFar=i.far),i.layers.mask=t.layers.mask|6,a.layers.mask=i.layers.mask&-5,c.layers.mask=i.layers.mask&-3;const u=t.parent,d=i.cameras;ZR(i,u);for(let f=0;f<d.length;f++)ZR(d[f],u);d.length===2?mW(i,a,c):i.projectionMatrix.copy(a.projectionMatrix),gW(t,i,u)}_getController(t){let e=this._controllers[t];return e===void 0&&(e=new GU,this._controllers[t]=e),e}}function mW(r,t,e){YR.setFromMatrixPosition(t.matrixWorld),KR.setFromMatrixPosition(e.matrixWorld);const n=YR.distanceTo(KR),s=t.projectionMatrix.elements,i=e.projectionMatrix.elements,a=s[14]/(s[10]-1),c=s[14]/(s[10]+1),u=(s[9]+1)/s[5],d=(s[9]-1)/s[5],f=(s[8]-1)/s[0],p=(i[8]+1)/i[0],g=a*f,y=a*p,x=n/(-f+p),S=x*-f;if(t.matrixWorld.decompose(r.position,r.quaternion,r.scale),r.translateX(S),r.translateZ(x),r.matrixWorld.compose(r.position,r.quaternion,r.scale),r.matrixWorldInverse.copy(r.matrixWorld).invert(),s[10]===-1)r.projectionMatrix.copy(t.projectionMatrix),r.projectionMatrixInverse.copy(t.projectionMatrixInverse);else{const T=a+x,M=c+x,N=g-S,v=y+(n-S),A=u*c/M*T,R=d*c/M*T;r.projectionMatrix.makePerspective(N,v,A,R,T,M),r.projectionMatrixInverse.copy(r.projectionMatrix).invert()}}function ZR(r,t){t===null?r.matrixWorld.copy(r.matrix):r.matrixWorld.multiplyMatrices(t.matrixWorld,r.matrix),r.matrixWorldInverse.copy(r.matrixWorld).invert()}function gW(r,t,e){e===null?r.matrix.copy(t.matrixWorld):(r.matrix.copy(e.matrixWorld),r.matrix.invert(),r.matrix.multiply(t.matrixWorld)),r.matrix.decompose(r.position,r.quaternion,r.scale),r.updateMatrixWorld(!0),r.projectionMatrix.copy(t.projectionMatrix),r.projectionMatrixInverse.copy(t.projectionMatrixInverse),r.isPerspectiveCamera&&(r.fov=Td*2*Math.atan(1/r.projectionMatrix.elements[5]),r.zoom=1)}function yW(r){const t=this._controllerInputSources.indexOf(r.inputSource);if(t===-1)return;const e=this._controllers[t];if(e!==void 0){const n=this.getReferenceSpace();e.update(r.inputSource,r.frame,n),e.dispatchEvent({type:r.type,data:r.inputSource})}}function xW(){const r=this._session,t=this._renderer;r.removeEventListener("select",this._onSessionEvent),r.removeEventListener("selectstart",this._onSessionEvent),r.removeEventListener("selectend",this._onSessionEvent),r.removeEventListener("squeeze",this._onSessionEvent),r.removeEventListener("squeezestart",this._onSessionEvent),r.removeEventListener("squeezeend",this._onSessionEvent),r.removeEventListener("end",this._onSessionEnd),r.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let e=0;e<this._controllers.length;e++){const n=this._controllerInputSources[e];n!==null&&(this._controllerInputSources[e]=null,this._controllers[e].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,t._resetXRState(),this._session=null,this._xrRenderTarget=null,this._glBinding=null,this._glBaseLayer=null,this._glProjLayer=null,this._sessionUsesLayers===!0)for(const e of this._layers)e.renderTarget=new rp(e.pixelwidth,e.pixelheight,{format:Yi,type:gi,depthTexture:new Yr(e.pixelwidth,e.pixelheight,e.stencilBuffer?yc:Qn,void 0,void 0,void 0,void 0,void 0,void 0,e.stencilBuffer?el:To),stencilBuffer:e.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),e.renderTarget.isXRRenderTarget=!1,e.plane.material=e.material,e.material.map=e.renderTarget.texture,e.material.map.offset.y=1,e.material.map.repeat.y=-1,delete e.xrlayer;this.isPresenting=!1,this._useMultiview=!1,t._animation.stop(),t._animation.setAnimationLoop(this._currentAnimationLoop),t._animation.setContext(this._currentAnimationContext),t._animation.start(),t.setPixelRatio(this._currentPixelRatio),t.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function bW(r){const t=this._controllers,e=this._controllerInputSources;for(let n=0;n<r.removed.length;n++){const s=r.removed[n],i=e.indexOf(s);i>=0&&(e[i]=null,t[i].disconnect(s))}for(let n=0;n<r.added.length;n++){const s=r.added[n];let i=e.indexOf(s);if(i===-1){for(let c=0;c<t.length;c++)if(c>=e.length){e.push(s),i=c;break}else if(e[c]===null){e[c]=s,i=c;break}if(i===-1)break}const a=t[i];a&&a.connect(s)}}function SW(r){return r.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(r.translation,r.quaternion),width:r.width/2,height:r.height/2,space:this._referenceSpace,viewPixelWidth:r.pixelwidth,viewPixelHeight:r.pixelheight,clearOnAccess:!1}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(r.translation,r.quaternion),radius:r.radius,centralAngle:r.centralAngle,aspectRatio:r.aspectRatio,space:this._referenceSpace,viewPixelWidth:r.pixelwidth,viewPixelHeight:r.pixelheight,clearOnAccess:!1})}function wW(r,t){if(t===void 0)return;const e=this._cameraXR,n=this._renderer,s=n.backend,i=this._glBaseLayer,a=this.getReferenceSpace(),c=t.getViewerPose(a);if(this._xrFrame=t,c!==null){const u=c.views;this._glBaseLayer!==null&&s.setXRTarget(i.framebuffer);let d=!1;u.length!==e.cameras.length&&(e.cameras.length=0,d=!0);for(let f=0;f<u.length;f++){const p=u[f];let g;if(this._supportsLayers===!0){const x=this._glBinding.getViewSubImage(this._glProjLayer,p);g=x.viewport,f===0&&s.setXRRenderTargetTextures(this._xrRenderTarget,x.colorTexture,this._glProjLayer.ignoreDepthValues&&!this._useMultiview?void 0:x.depthStencilTexture)}else g=i.getViewport(p);let y=this._cameras[f];y===void 0&&(y=new $i,y.layers.enable(f),y.viewport=new je,this._cameras[f]=y),y.matrix.fromArray(p.transform.matrix),y.matrix.decompose(y.position,y.quaternion,y.scale),y.projectionMatrix.fromArray(p.projectionMatrix),y.projectionMatrixInverse.copy(y.projectionMatrix).invert(),y.viewport.set(g.x,g.y,g.width,g.height),f===0&&(e.matrix.copy(y.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale)),d===!0&&e.cameras.push(y)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let u=0;u<this._controllers.length;u++){const d=this._controllerInputSources[u],f=this._controllers[u];d!==null&&f!==void 0&&f.update(d,t,a)}this._currentAnimationLoop&&this._currentAnimationLoop(r,t),t.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:t}),this._xrFrame=null}class TW extends Rc{constructor(t){super(),this.domElement=t,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new je(0,0,this._width,this._height),this._scissor=new je(0,0,this._width,this._height),this._scissorTest=!1,this.colorTexture=new Dw,this.depthTexture=new Yr}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(t){return t.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(t){return t.set(this._width,this._height)}setPixelRatio(t=1){this._pixelRatio!==t&&(this._pixelRatio=t,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(t,e,n){this.xr&&this.xr.isPresenting||(this._width=t,this._height=e,this._pixelRatio=n,this.domElement.width=Math.floor(t*n),this.domElement.height=Math.floor(e*n),this.setViewport(0,0,t,e),this._dispatchResize())}setSize(t,e,n=!0){this.xr&&this.xr.isPresenting||(this._width=t,this._height=e,this.domElement.width=Math.floor(t*this._pixelRatio),this.domElement.height=Math.floor(e*this._pixelRatio),n===!0&&(this.domElement.style.width=t+"px",this.domElement.style.height=e+"px"),this.setViewport(0,0,t,e),this._dispatchResize())}getScissor(t){const e=this._scissor;return t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t}setScissor(t,e,n,s){const i=this._scissor;t.isVector4?i.copy(t):i.set(t,e,n,s)}getScissorTest(){return this._scissorTest}setScissorTest(t){this._scissorTest=t}getViewport(t){return t.copy(this._viewport)}setViewport(t,e,n,s,i=0,a=1){const c=this._viewport;t.isVector4?c.copy(t):c.set(t,e,n,s),c.minDepth=i,c.maxDepth=a}_dispatchResize(){this.dispatchEvent({type:"resize"})}dispose(){this.dispatchEvent({type:"dispose"})}}const QR=new Ew,Xh=new Ot,n2=new je,s2=new ix,i2=new Bw,ug=new Te,Ia=new je,_W={[Qo]:us,[us]:Qo,[En]:En};class MW{constructor(t,e={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,reversedDepthBuffer:s=!1,alpha:i=!0,depth:a=!0,stencil:c=!1,antialias:u=!1,samples:d=0,getFallback:f=null,outputBufferType:p=ni,multiview:g=!1}=e;this.backend=t,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=n,this.reversedDepthBuffer=s,this.outputColorSpace=fn,this.toneMapping=_u,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=a,this.stencil=c,this.info=new xV,this.contextNode=ul(),this.library=new VD,this.lighting=new fW,this._samples=d||u===!0?4:0,this._onCanvasTargetResize=this._onCanvasTargetResize.bind(this),this._canvasTarget=new TW(t.getDomElement()),this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize),this._canvasTarget.isDefaultCanvasTarget=!0,this._inspector=new j5,this._inspector.setRenderer(this),this._getFallback=f,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new Bx(new ss),this._quad.name="Output Color Transform",this._quad.material.name="outputColorTransform",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const y=this.alpha===!0?0:1;this._clearColor=new t_(0,0,0,y),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._outputBufferType=p,this._cacheShadowNodes=new WeakMap,this._initialized=!1,this._callDepth=-1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,transmitted:!1,type:R3},this.xr=new pW(this,g),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(x,S,T)=>{await this.compileAsync(x,S);const M=this._renderLists.get(x,S),N=this._renderContexts.get(this._renderTarget,this._mrt),v=x.overrideMaterial||T.material,A=this._objects.get(T,v,x,S,M.lightsNode,N,N.clippingContext),{fragmentShader:R,vertexShader:F}=A.getNodeBuilderState();return{fragmentShader:R,vertexShader:F}}}}async init(){return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(t,e)=>{let n=this.backend;try{await n.init(this)}catch(s){if(this._getFallback!==null)try{this.backend=n=this._getFallback(s),await n.init(this)}catch(i){e(i);return}else{e(s);return}}this._nodes=new cW(this,n),this._animation=new cV(this,this._nodes,this.info),this._attributes=new gV(n),this._background=new _H(this,this._nodes),this._geometries=new yV(this._attributes,this.info),this._textures=new BV(this,n,this.info),this._pipelines=new TV(n,this._nodes),this._bindings=new _V(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new fV(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new AV(this.lighting),this._bundles=new hW,this._renderContexts=new EV(this),this._animation.start(),this._initialized=!0,this._inspector.init(),t(this)}),this._initPromise)}get domElement(){return this._canvasTarget.domElement}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(t,e,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const s=this._nodes.nodeFrame,i=s.renderId,a=this._currentRenderContext,c=this._currentRenderObjectFunction,u=this._handleObjectFunction,d=this._compilationPromises,f=t.isScene===!0?t:QR;n===null&&(n=t);const p=this._renderTarget,g=this._renderContexts.get(p,this._mrt),y=this._activeMipmapLevel,x=[];this._currentRenderContext=g,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=x,s.renderId++,s.update(),g.depth=this.depth,g.stencil=this.stencil,g.clippingContext||(g.clippingContext=new Wy),g.clippingContext.updateGlobal(f,e),f.onBeforeRender(this,t,e,p);const S=this._renderLists.get(t,e);if(S.begin(),this._projectObject(t,e,0,S,g.clippingContext),n!==t&&n.traverseVisible(function(A){A.isLight&&A.layers.test(e.layers)&&S.pushLight(A)}),S.finish(),p!==null){this._textures.updateRenderTarget(p,y);const A=this._textures.get(p);g.textures=A.textures,g.depthTexture=A.depthTexture}else g.textures=null,g.depthTexture=null;n!==t?this._background.update(n,S,g):this._background.update(f,S,g);const T=S.opaque,M=S.transparent,N=S.transparentDoublePass,v=S.lightsNode;this.opaque===!0&&T.length>0&&this._renderObjects(T,e,f,v),this.transparent===!0&&M.length>0&&this._renderTransparents(M,N,e,f,v),s.renderId=i,this._currentRenderContext=a,this._currentRenderObjectFunction=c,this._handleObjectFunction=u,this._compilationPromises=d,await Promise.all(x)}async renderAsync(t,e){rn('Renderer: "renderAsync()" has been deprecated. Use "render()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.render(t,e)}async waitForGPU(){Ht("Renderer: waitForGPU() has been removed. Read https://github.com/mrdoob/three.js/issues/32012 for more information.")}set inspector(t){this._inspector!==null&&this._inspector.setRenderer(null),this._inspector=t,this._inspector.setRenderer(this)}get inspector(){return this._inspector}set highPrecision(t){const e=this.contextNode.value;t===!0?(e.modelViewMatrix=X2,e.modelNormalViewMatrix=j2):this.highPrecision&&(delete e.modelViewMatrix,delete e.modelNormalViewMatrix)}get highPrecision(){const t=this.contextNode.value;return t.modelViewMatrix===X2&&t.modelNormalViewMatrix===j2}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}getOutputBufferType(){return this._outputBufferType}getColorBufferType(){return rn('Renderer: ".getColorBufferType()" has been renamed to ".getOutputBufferType()".'),this.getOutputBufferType()}_onDeviceLost(t){let e=`THREE.WebGPURenderer: ${t.api} Device Lost:

Message: ${t.message}`;t.reason&&(e+=`
Reason: ${t.reason}`),Ht(e),this._isDeviceLost=!0}_renderBundle(t,e,n){const{bundleGroup:s,camera:i,renderList:a}=t,c=this._currentRenderContext,u=this._bundles.get(s,i),d=this.backend.get(u);d.renderContexts===void 0&&(d.renderContexts=new Set);const f=s.version!==d.version,p=d.renderContexts.has(c)===!1||f;if(d.renderContexts.add(c),p){this.backend.beginBundle(c),(d.renderObjects===void 0||f)&&(d.renderObjects=[]),this._currentRenderBundle=u;const{transparentDoublePass:g,transparent:y,opaque:x}=a;this.opaque===!0&&x.length>0&&this._renderObjects(x,i,e,n),this.transparent===!0&&y.length>0&&this._renderTransparents(y,g,i,e,n),this._currentRenderBundle=null,this.backend.finishBundle(c,u),d.version=s.version}else{const{renderObjects:g}=d;for(let y=0,x=g.length;y<x;y++){const S=g[y];this._nodes.needsRefresh(S)&&(this._nodes.updateBefore(S),this._nodes.updateForRender(S),this._bindings.updateForRender(S),this._nodes.updateAfter(S))}}this.backend.addBundle(c,u)}render(t,e){if(this._initialized===!1)throw new Error('Renderer: .render() called before the backend is initialized. Use "await renderer.init();" before rendering.');this._renderScene(t,e)}get initialized(){return this._initialized}_getFrameBufferTarget(){const{currentToneMapping:t,currentColorSpace:e}=this,n=t!==_u,s=e!==qe.workingColorSpace;if(n===!1&&s===!1)return null;const{width:i,height:a}=this.getDrawingBufferSize(Xh),{depth:c,stencil:u}=this;let d=this._frameBufferTarget;d===null&&(d=new cl(i,a,{depthBuffer:c,stencilBuffer:u,type:this._outputBufferType,format:Yi,colorSpace:qe.workingColorSpace,generateMipmaps:!1,minFilter:qs,magFilter:qs,samples:this.samples}),d.isPostProcessingRenderTarget=!0,this._frameBufferTarget=d);const f=this.getOutputRenderTarget();d.depthBuffer=c,d.stencilBuffer=u,f!==null?d.setSize(f.width,f.height,f.depth):d.setSize(i,a,1);const p=this._canvasTarget;return d.viewport.copy(p._viewport),d.scissor.copy(p._scissor),d.viewport.multiplyScalar(p._pixelRatio),d.scissor.multiplyScalar(p._pixelRatio),d.scissorTest=p._scissorTest,d.multiview=f!==null?f.multiview:!1,d.resolveDepthBuffer=f!==null?f.resolveDepthBuffer:!0,d._autoAllocateDepthBuffer=f!==null?f._autoAllocateDepthBuffer:!1,d}_renderScene(t,e,n=!0){if(this._isDeviceLost===!0)return;const s=n?this._getFrameBufferTarget():null,i=this._nodes.nodeFrame,a=i.renderId,c=this._currentRenderContext,u=this._currentRenderObjectFunction,d=this._handleObjectFunction;this._callDepth++;const f=t.isScene===!0?t:QR,p=this._renderTarget||this._outputRenderTarget,g=this._activeCubeFace,y=this._activeMipmapLevel;let x;s!==null?(x=s,this.setRenderTarget(x)):x=p;const S=this._renderContexts.get(x,this._mrt,this._callDepth);this._currentRenderContext=S,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this._handleObjectFunction=this._renderObjectDirect,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,i.renderId=this.info.calls,this.backend.updateTimeStampUID(S),this.inspector.beginRender(this.backend.getTimestampUID(S),t,e,x);const T=this.xr;if(T.isPresenting===!1){let wt=!1;if(this.reversedDepthBuffer===!0&&e.reversedDepth!==!0){if(e._reversedDepth=!0,e.isArrayCamera)for(const U of e.cameras)U._reversedDepth=!0;wt=!0}const ft=this.coordinateSystem;if(e.coordinateSystem!==ft){if(e.coordinateSystem=ft,e.isArrayCamera)for(const U of e.cameras)U.coordinateSystem=ft;wt=!0}if(wt===!0&&(e.updateProjectionMatrix(),e.isArrayCamera))for(const U of e.cameras)U.updateProjectionMatrix()}t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),e.parent===null&&e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),T.enabled===!0&&T.isPresenting===!0&&(T.cameraAutoUpdate===!0&&T.updateCamera(e),e=T.getCamera());const M=this._canvasTarget;let N=M._viewport,v=M._scissor,A=M._pixelRatio;x!==null&&(N=x.viewport,v=x.scissor,A=1),this.getDrawingBufferSize(Xh),n2.set(0,0,Xh.width,Xh.height);const R=N.minDepth===void 0?0:N.minDepth,F=N.maxDepth===void 0?1:N.maxDepth;S.viewportValue.copy(N).multiplyScalar(A).floor(),S.viewportValue.width>>=y,S.viewportValue.height>>=y,S.viewportValue.minDepth=R,S.viewportValue.maxDepth=F,S.viewport=S.viewportValue.equals(n2)===!1,S.scissorValue.copy(v).multiplyScalar(A).floor(),S.scissor=M._scissorTest&&S.scissorValue.equals(n2)===!1,S.scissorValue.width>>=y,S.scissorValue.height>>=y,S.clippingContext||(S.clippingContext=new Wy),S.clippingContext.updateGlobal(f,e),f.onBeforeRender(this,t,e,x);const D=e.isArrayCamera?i2:s2;e.isArrayCamera||(ug.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),D.setFromProjectionMatrix(ug,e.coordinateSystem,e.reversedDepth));const O=this._renderLists.get(t,e);if(O.begin(),this._projectObject(t,e,0,O,S.clippingContext),O.finish(),this.sortObjects===!0&&O.sort(this._opaqueSort,this._transparentSort),x!==null){this._textures.updateRenderTarget(x,y);const wt=this._textures.get(x);S.textures=wt.textures,S.depthTexture=wt.depthTexture,S.width=wt.width,S.height=wt.height,S.renderTarget=x,S.depth=x.depthBuffer,S.stencil=x.stencilBuffer}else S.textures=null,S.depthTexture=null,S.width=Xh.width,S.height=Xh.height,S.depth=this.depth,S.stencil=this.stencil;S.width>>=y,S.height>>=y,S.activeCubeFace=g,S.activeMipmapLevel=y,S.occlusionQueryCount=O.occlusionQueryCount,S.scissorValue.max(Ia.set(0,0,0,0)),S.scissorValue.x+S.scissorValue.width>S.width&&(S.scissorValue.width=Math.max(S.width-S.scissorValue.x,0)),S.scissorValue.y+S.scissorValue.height>S.height&&(S.scissorValue.height=Math.max(S.height-S.scissorValue.y,0)),this._background.update(f,O,S),S.camera=e,this.backend.beginRender(S);const{bundles:B,lightsNode:z,transparentDoublePass:tt,transparent:j,opaque:dt}=O;return B.length>0&&this._renderBundles(B,f,z),this.opaque===!0&&dt.length>0&&this._renderObjects(dt,e,f,z),this.transparent===!0&&j.length>0&&this._renderTransparents(j,tt,e,f,z),this.backend.finishRender(S),i.renderId=a,this._currentRenderContext=c,this._currentRenderObjectFunction=u,this._handleObjectFunction=d,this._callDepth--,s!==null&&(this.setRenderTarget(p,g,y),this._renderOutput(x)),f.onAfterRender(this,t,e,x),this.inspector.finishRender(this.backend.getTimestampUID(S)),S}_setXRLayerSize(t,e){this._canvasTarget._width=t,this._canvasTarget._height=e,this.setViewport(0,0,t,e)}_renderOutput(t){const e=this._quad;this._nodes.hasOutputChange(t.texture)&&(e.material.fragmentNode=this._nodes.getOutputNode(t.texture),e.material.needsUpdate=!0);const n=this.autoClear,s=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(e,e.camera,!1),this.autoClear=n,this.xr.enabled=s}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(t){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(t)}getAnimationLoop(){return this._animation.getAnimationLoop()}async getArrayBufferAsync(t){return await this.backend.getArrayBufferAsync(t)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._canvasTarget.getPixelRatio()}getDrawingBufferSize(t){return this._canvasTarget.getDrawingBufferSize(t)}getSize(t){return this._canvasTarget.getSize(t)}setPixelRatio(t=1){this._canvasTarget.setPixelRatio(t)}setDrawingBufferSize(t,e,n){this.xr&&this.xr.isPresenting||this._canvasTarget.setDrawingBufferSize(t,e,n)}setSize(t,e,n=!0){this.xr&&this.xr.isPresenting||this._canvasTarget.setSize(t,e,n)}setOpaqueSort(t){this._opaqueSort=t}setTransparentSort(t){this._transparentSort=t}getScissor(t){return this._canvasTarget.getScissor(t)}setScissor(t,e,n,s){this._canvasTarget.setScissor(t,e,n,s)}getScissorTest(){return this._canvasTarget.getScissorTest()}setScissorTest(t){this._canvasTarget.setScissorTest(t),this.backend.setScissorTest(t)}getViewport(t){return this._canvasTarget.getViewport(t)}setViewport(t,e,n,s,i=0,a=1){this._canvasTarget.setViewport(t,e,n,s,i,a)}getClearColor(t){return t.copy(this._clearColor)}setClearColor(t,e=1){this._clearColor.set(t),this._clearColor.a=e}getClearAlpha(){return this._clearColor.a}setClearAlpha(t){this._clearColor.a=t}getClearDepth(){return this.reversedDepthBuffer===!0?1-this._clearDepth:this._clearDepth}setClearDepth(t){this._clearDepth=t}getClearStencil(){return this._clearStencil}setClearStencil(t){this._clearStencil=t}isOccluded(t){const e=this._currentRenderContext;return e&&this.backend.isOccluded(e,t)}clear(t=!0,e=!0,n=!0){if(this._initialized===!1)throw new Error('Renderer: .clear() called before the backend is initialized. Use "await renderer.init();" before before using this method.');const s=this._renderTarget||this._getFrameBufferTarget();let i=null;if(s!==null){this._textures.updateRenderTarget(s);const a=this._textures.get(s);i=this._renderContexts.get(s),i.textures=a.textures,i.depthTexture=a.depthTexture,i.width=a.width,i.height=a.height,i.renderTarget=s,i.depth=s.depthBuffer,i.stencil=s.stencilBuffer;const c=this.backend.getClearColor();i.clearColorValue.r=c.r,i.clearColorValue.g=c.g,i.clearColorValue.b=c.b,i.clearColorValue.a=c.a,i.clearDepthValue=this.getClearDepth(),i.clearStencilValue=this.getClearStencil(),i.activeCubeFace=this.getActiveCubeFace(),i.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(t,e,n,i),s!==null&&this._renderTarget===null&&this._renderOutput(s)}clearColor(){this.clear(!0,!1,!1)}clearDepth(){this.clear(!1,!0,!1)}clearStencil(){this.clear(!1,!1,!0)}async clearAsync(t=!0,e=!0,n=!0){rn('Renderer: "clearAsync()" has been deprecated. Use "clear()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.clear(t,e,n)}async clearColorAsync(){rn('Renderer: "clearColorAsync()" has been deprecated. Use "clearColor()" and "await renderer.init();" when creating the renderer.'),this.clear(!0,!1,!1)}async clearDepthAsync(){rn('Renderer: "clearDepthAsync()" has been deprecated. Use "clearDepth()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!0,!1)}async clearStencilAsync(){rn('Renderer: "clearStencilAsync()" has been deprecated. Use "clearStencil()" and "await renderer.init();" when creating the renderer.'),this.clear(!1,!1,!0)}get needsFrameBufferTarget(){const t=this.currentToneMapping!==_u,e=this.currentColorSpace!==qe.workingColorSpace;return t||e}get samples(){return this._samples}get currentSamples(){let t=this._samples;return this._renderTarget!==null?t=this._renderTarget.samples:this.needsFrameBufferTarget&&(t=0),t}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:_u}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:qe.workingColorSpace}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this._initialized===!0&&(this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._geometries.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(t=>{t!==null&&t.dispose()})),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(t,e=0,n=0){this._renderTarget=t,this._activeCubeFace=e,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(t){this._outputRenderTarget=t}getOutputRenderTarget(){return this._outputRenderTarget}setCanvasTarget(t){this._canvasTarget.removeEventListener("resize",this._onCanvasTargetResize),this._canvasTarget=t,this._canvasTarget.addEventListener("resize",this._onCanvasTargetResize)}getCanvasTarget(){return this._canvasTarget}_resetXRState(){this.backend.setXRTarget(null),this.setOutputRenderTarget(null),this.setRenderTarget(null),this._frameBufferTarget.dispose(),this._frameBufferTarget=null}setRenderObjectFunction(t){this._renderObjectFunction=t}getRenderObjectFunction(){return this._renderObjectFunction}compute(t,e=null){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return Wt("Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(t,e);const n=this._nodes.nodeFrame,s=n.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,n.renderId=this.info.calls,this.backend.updateTimeStampUID(t),this.inspector.beginCompute(this.backend.getTimestampUID(t),t);const i=this.backend,a=this._pipelines,c=this._bindings,u=this._nodes,d=Array.isArray(t)?t:[t];if(d[0]===void 0||d[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");i.beginCompute(t);for(const f of d){if(a.has(f)===!1){const y=()=>{f.removeEventListener("dispose",y),a.delete(f),c.deleteForCompute(f),u.delete(f)};f.addEventListener("dispose",y);const x=f.onInitFunction;x!==null&&x.call(f,{renderer:this})}u.updateForCompute(f),c.updateForCompute(f);const p=c.getForCompute(f),g=a.getForCompute(f,p);i.compute(t,f,p,g,e)}i.finishCompute(t),n.renderId=s,this.inspector.finishCompute(this.backend.getTimestampUID(t))}async computeAsync(t,e=null){this._initialized===!1&&await this.init(),this.compute(t,e)}async hasFeatureAsync(t){return rn('Renderer: "hasFeatureAsync()" has been deprecated. Use "hasFeature()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.hasFeature(t)}async resolveTimestampsAsync(t="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(t)}hasFeature(t){if(this._initialized===!1)throw new Error('Renderer: .hasFeature() called before the backend is initialized. Use "await renderer.init();" before before using this method.');return this.backend.hasFeature(t)}hasInitialized(){return this._initialized}async initTextureAsync(t){rn('Renderer: "initTextureAsync()" has been deprecated. Use "initTexture()" and "await renderer.init();" when creating the renderer.'),await this.init(),this.initTexture(t)}initTexture(t){if(this._initialized===!1)throw new Error('Renderer: .initTexture() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateTexture(t)}initRenderTarget(t){if(this._initialized===!1)throw new Error('Renderer: .initRenderTarget() called before the backend is initialized. Use "await renderer.init();" before before using this method.');this._textures.updateRenderTarget(t);const e=this._textures.get(t),n=this._renderContexts.get(t);n.textures=e.textures,n.depthTexture=e.depthTexture,n.width=e.width,n.height=e.height,n.renderTarget=t,n.depth=t.depthBuffer,n.stencil=t.stencilBuffer,this.backend.initRenderTarget(n)}copyFramebufferToTexture(t,e=null){if(e!==null)if(e.isVector2)e=Ia.set(e.x,e.y,t.image.width,t.image.height).floor();else if(e.isVector4)e=Ia.copy(e).floor();else{Ht("Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else e=Ia.set(0,0,t.image.width,t.image.height);let n=this._currentRenderContext,s;n!==null?s=n.renderTarget:(s=this._renderTarget||this._getFrameBufferTarget(),s!==null&&(this._textures.updateRenderTarget(s),n=this._textures.get(s))),this._textures.updateTexture(t,{renderTarget:s}),this.backend.copyFramebufferToTexture(t,n,e),this._inspector.copyFramebufferToTexture(t)}copyTextureToTexture(t,e,n=null,s=null,i=0,a=0){this._textures.updateTexture(t),this._textures.updateTexture(e),this.backend.copyTextureToTexture(t,e,n,s,i,a),this._inspector.copyTextureToTexture(t,e)}async readRenderTargetPixelsAsync(t,e,n,s,i,a=0,c=0){return this.backend.copyTextureToBuffer(t.textures[a],e,n,s,i,c)}_projectObject(t,e,n,s,i){if(t.visible===!1)return;if(t.layers.test(e.layers)){if(t.isGroup)n=t.renderOrder,t.isClippingGroup&&t.enabled&&(i=i.getGroupContext(t));else if(t.isLOD)t.autoUpdate===!0&&t.update(e);else if(t.isLight)s.pushLight(t);else if(t.isSprite){const u=e.isArrayCamera?i2:s2;if(!t.frustumCulled||u.intersectsSprite(t,e)){this.sortObjects===!0&&Ia.setFromMatrixPosition(t.matrixWorld).applyMatrix4(ug);const{geometry:d,material:f}=t;f.visible&&s.push(t,d,f,n,Ia.z,null,i)}}else if(t.isLineLoop)Ht("Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if(t.isMesh||t.isLine||t.isPoints){const u=e.isArrayCamera?i2:s2;if(!t.frustumCulled||u.intersectsObject(t,e)){const{geometry:d,material:f}=t;if(this.sortObjects===!0&&(d.boundingSphere===null&&d.computeBoundingSphere(),Ia.copy(d.boundingSphere.center).applyMatrix4(t.matrixWorld).applyMatrix4(ug)),Array.isArray(f)){const p=d.groups;for(let g=0,y=p.length;g<y;g++){const x=p[g],S=f[x.materialIndex];S&&S.visible&&s.push(t,d,S,n,Ia.z,x,i)}}else f.visible&&s.push(t,d,f,n,Ia.z,null,i)}}}if(t.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const u=s;s=this._renderLists.get(t,e),s.begin(),u.pushBundle({bundleGroup:t,camera:e,renderList:s}),s.finish()}const c=t.children;for(let u=0,d=c.length;u<d;u++)this._projectObject(c[u],e,n,s,i)}_renderBundles(t,e,n){for(const s of t)this._renderBundle(s,e,n)}_renderTransparents(t,e,n,s,i){if(e.length>0){for(const{material:a}of e)a.side=us;this._renderObjects(e,n,s,i,"backSide");for(const{material:a}of e)a.side=Qo;this._renderObjects(t,n,s,i);for(const{material:a}of e)a.side=En}else this._renderObjects(t,n,s,i)}_renderObjects(t,e,n,s,i=null){for(let a=0,c=t.length;a<c;a++){const{object:u,geometry:d,material:f,group:p,clippingContext:g}=t[a];this._currentRenderObjectFunction(u,n,e,d,f,p,s,g,i)}}_getShadowNodes(t){const e=t.version;let n=this._cacheShadowNodes.get(t);if(n===void 0||n.version!==e){const s=t.map!==null,i=t.colorNode&&t.colorNode.isNode,a=t.castShadowNode&&t.castShadowNode.isNode,c=t.maskShadowNode&&t.maskShadowNode.isNode||t.maskNode&&t.maskNode.isNode;let u=null,d=null,f=null;if(s||i||a||c){let p,g;if(a?(p=t.castShadowNode.rgb,g=t.castShadowNode.a,this.shadowMap.transmitted!==!0&&rn("Renderer: `shadowMap.transmitted` needs to be set to `true` when using `material.castShadowNode`.")):(p=it(0),g=k(1)),s&&(g=g.mul(Nn("map","texture",t).a)),i&&(g=g.mul(t.colorNode.a)),d=se(p,g),c){const y=t.maskShadowNode||t.maskNode;d=ut(([x])=>(y.not().discard(),x))(d)}}t.depthNode&&t.depthNode.isNode&&(f=t.depthNode),t.castShadowPositionNode&&t.castShadowPositionNode.isNode?u=t.castShadowPositionNode:t.positionNode&&t.positionNode.isNode&&(u=t.positionNode),n={version:e,colorNode:d,depthNode:f,positionNode:u},this._cacheShadowNodes.set(t,n)}return n}renderObject(t,e,n,s,i,a,c,u=null,d=null){let f=!1,p,g,y,x;if(t.onBeforeRender(this,e,n,s,i,a),i.allowOverride===!0&&e.overrideMaterial!==null){const S=e.overrideMaterial;if(f=!0,p=S.isNodeMaterial?S.colorNode:null,g=S.isNodeMaterial?S.depthNode:null,y=S.isNodeMaterial?S.positionNode:null,x=e.overrideMaterial.side,i.positionNode&&i.positionNode.isNode&&(S.positionNode=i.positionNode),S.alphaTest=i.alphaTest,S.alphaMap=i.alphaMap,S.transparent=i.transparent||i.transmission>0||i.transmissionNode&&i.transmissionNode.isNode||i.backdropNode&&i.backdropNode.isNode,S.isShadowPassMaterial){const{colorNode:T,depthNode:M,positionNode:N}=this._getShadowNodes(i);this.shadowMap.type===cp?S.side=i.shadowSide!==null?i.shadowSide:i.side:S.side=i.shadowSide!==null?i.shadowSide:_W[i.side],T!==null&&(S.colorNode=T),M!==null&&(S.depthNode=M),N!==null&&(S.positionNode=N)}i=S}i.transparent===!0&&i.side===En&&i.forceSinglePass===!1?(i.side=us,this._handleObjectFunction(t,i,e,n,c,a,u,"backSide"),i.side=Qo,this._handleObjectFunction(t,i,e,n,c,a,u,d),i.side=En):this._handleObjectFunction(t,i,e,n,c,a,u,d),f&&(e.overrideMaterial.colorNode=p,e.overrideMaterial.depthNode=g,e.overrideMaterial.positionNode=y,e.overrideMaterial.side=x),t.onAfterRender(this,e,n,s,i,a)}hasCompatibility(t){return this.backend.hasCompatibility(t)}_renderObjectDirect(t,e,n,s,i,a,c,u){const d=this._objects.get(t,e,n,s,i,this._currentRenderContext,c,u);d.drawRange=t.geometry.drawRange,d.group=a,this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(d),d.bundle=this._currentRenderBundle.bundleGroup);const f=this._nodes.needsRefresh(d);f&&(this._nodes.updateBefore(d),this._geometries.updateForRender(d),this._nodes.updateForRender(d),this._bindings.updateForRender(d)),this._pipelines.updateForRender(d),this.backend.draw(d,this.info),f&&this._nodes.updateAfter(d)}_createObjectPipeline(t,e,n,s,i,a,c,u){const d=this._objects.get(t,e,n,s,i,this._currentRenderContext,c,u);d.drawRange=t.geometry.drawRange,d.group=a,this._nodes.updateBefore(d),this._geometries.updateForRender(d),this._nodes.updateForRender(d),this._bindings.updateForRender(d),this._pipelines.getForRender(d,this._compilationPromises),this._nodes.updateAfter(d)}_onCanvasTargetResize(){this._initialized&&this.backend.updateSize()}get compile(){return this.compileAsync}}class GD{constructor(t=""){this.name=t,this.visibility=0}setVisibility(t){this.visibility|=t}getVisibility(){return this.visibility}clone(){return Object.assign(new this.constructor,this)}}function vW(r){return r+(dc-r%dc)%dc}class kD extends GD{constructor(t,e=null){super(t),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=e,this._updateRanges=[]}get updateRanges(){return this._updateRanges}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}get byteLength(){return vW(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class HD extends kD{constructor(t,e=null){super(t,e),this.isUniformBuffer=!0}}let AW=0;class WD extends HD{constructor(t,e){super("UniformBuffer_"+AW++,t?t.value:null),this.nodeUniform=t,this.groupNode=e,this.isNodeUniformBuffer=!0}set updateRanges(t){this.nodeUniform.updateRanges=t}get updateRanges(){return this.nodeUniform.updateRanges}addUpdateRange(t,e){this.nodeUniform.addUpdateRange(t,e)}clearUpdateRanges(){this.nodeUniform.clearUpdateRanges()}get buffer(){return this.nodeUniform.value}}class NW extends HD{constructor(t){super(t),this.isUniformsGroup=!0,this._values=null,this.uniforms=[],this._updateRangeCache=new Map}addUniformUpdateRange(t){const e=t.index;if(this._updateRangeCache.has(e)!==!0){const n=this.updateRanges,s=t.offset,i=t.itemSize,a={start:s,count:i};n.push(a),this._updateRangeCache.set(e,a)}}clearUpdateRanges(){this._updateRangeCache.clear(),super.clearUpdateRanges()}addUniform(t){return this.uniforms.push(t),this}removeUniform(t){const e=this.uniforms.indexOf(t);return e!==-1&&this.uniforms.splice(e,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let t=this._buffer;if(t===null){const e=this.byteLength;t=new Float32Array(new ArrayBuffer(e)),this._buffer=t}return t}get byteLength(){const t=this.bytesPerElement;let e=0;for(let n=0,s=this.uniforms.length;n<s;n++){const i=this.uniforms[n],a=i.boundary,c=i.itemSize*t,u=e%dc,d=u%a,f=u+d;e+=d,f!==0&&dc-f<c&&(e+=dc-f),i.offset=e/t,i.index=n,e+=c}return Math.ceil(e/dc)*dc}update(){let t=!1;for(const e of this.uniforms)this.updateByType(e)===!0&&(t=!0);return t}updateByType(t){if(t.isNumberUniform)return this.updateNumber(t);if(t.isVector2Uniform)return this.updateVector2(t);if(t.isVector3Uniform)return this.updateVector3(t);if(t.isVector4Uniform)return this.updateVector4(t);if(t.isColorUniform)return this.updateColor(t);if(t.isMatrix3Uniform)return this.updateMatrix3(t);if(t.isMatrix4Uniform)return this.updateMatrix4(t);Ht("WebGPUUniformsGroup: Unsupported uniform type.",t)}updateNumber(t){let e=!1;const n=this.values,s=t.getValue(),i=t.offset,a=t.getType();if(n[i]!==s){const c=this._getBufferForType(a);c[i]=n[i]=s,e=!0,this.addUniformUpdateRange(t)}return e}updateVector2(t){let e=!1;const n=this.values,s=t.getValue(),i=t.offset,a=t.getType();if(n[i+0]!==s.x||n[i+1]!==s.y){const c=this._getBufferForType(a);c[i+0]=n[i+0]=s.x,c[i+1]=n[i+1]=s.y,e=!0,this.addUniformUpdateRange(t)}return e}updateVector3(t){let e=!1;const n=this.values,s=t.getValue(),i=t.offset,a=t.getType();if(n[i+0]!==s.x||n[i+1]!==s.y||n[i+2]!==s.z){const c=this._getBufferForType(a);c[i+0]=n[i+0]=s.x,c[i+1]=n[i+1]=s.y,c[i+2]=n[i+2]=s.z,e=!0,this.addUniformUpdateRange(t)}return e}updateVector4(t){let e=!1;const n=this.values,s=t.getValue(),i=t.offset,a=t.getType();if(n[i+0]!==s.x||n[i+1]!==s.y||n[i+2]!==s.z||n[i+4]!==s.w){const c=this._getBufferForType(a);c[i+0]=n[i+0]=s.x,c[i+1]=n[i+1]=s.y,c[i+2]=n[i+2]=s.z,c[i+3]=n[i+3]=s.w,e=!0,this.addUniformUpdateRange(t)}return e}updateColor(t){let e=!1;const n=this.values,s=t.getValue(),i=t.offset;if(n[i+0]!==s.r||n[i+1]!==s.g||n[i+2]!==s.b){const a=this.buffer;a[i+0]=n[i+0]=s.r,a[i+1]=n[i+1]=s.g,a[i+2]=n[i+2]=s.b,e=!0,this.addUniformUpdateRange(t)}return e}updateMatrix3(t){let e=!1;const n=this.values,s=t.getValue().elements,i=t.offset;if(n[i+0]!==s[0]||n[i+1]!==s[1]||n[i+2]!==s[2]||n[i+4]!==s[3]||n[i+5]!==s[4]||n[i+6]!==s[5]||n[i+8]!==s[6]||n[i+9]!==s[7]||n[i+10]!==s[8]){const a=this.buffer;a[i+0]=n[i+0]=s[0],a[i+1]=n[i+1]=s[1],a[i+2]=n[i+2]=s[2],a[i+4]=n[i+4]=s[3],a[i+5]=n[i+5]=s[4],a[i+6]=n[i+6]=s[5],a[i+8]=n[i+8]=s[6],a[i+9]=n[i+9]=s[7],a[i+10]=n[i+10]=s[8],e=!0,this.addUniformUpdateRange(t)}return e}updateMatrix4(t){let e=!1;const n=this.values,s=t.getValue().elements,i=t.offset;return EW(n,s,i)===!1&&(this.buffer.set(s,i),RW(n,s,i),e=!0,this.addUniformUpdateRange(t)),e}_getBufferForType(t){return t==="int"||t==="ivec2"||t==="ivec3"||t==="ivec4"?new Int32Array(this.buffer.buffer):t==="uint"||t==="uvec2"||t==="uvec3"||t==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function RW(r,t,e){for(let n=0,s=t.length;n<s;n++)r[e+n]=t[n]}function EW(r,t,e){for(let n=0,s=t.length;n<s;n++)if(r[e+n]!==t[n])return!1;return!0}let CW=0;class qD extends NW{constructor(t,e){super(t),this.id=CW++,this.groupNode=e,this.isNodeUniformsGroup=!0}}class $D extends GD{constructor(t,e){super(t),this._texture=null,this._onTextureDispose=()=>{this.generation=null,this.version=0},this.texture=e,this.version=e?e.version:0,this.generation=null,this.samplerKey="",this.isSampler=!0}set texture(t){this._texture!==t&&(this._texture&&this._texture.removeEventListener("dispose",this._onTextureDispose),this._texture=t,this.generation=null,this.version=0,this._texture&&this._texture.addEventListener("dispose",this._onTextureDispose))}get texture(){return this._texture}update(){const{texture:t,version:e}=this;return e!==t.version?(this.version=t.version,!0):!1}clone(){const t=super.clone();return t._texture=null,t._onTextureDispose=()=>{t.generation=null,t.version=0},t.texture=this.texture,t}}let BW=0;class DW extends $D{constructor(t,e){super(t,e),this.id=BW++,this.store=!1,this.mipLevel=0,this.isSampledTexture=!0}}class Ix extends DW{constructor(t,e,n,s=null){super(t,e?e.value:null),this.textureNode=e,this.groupNode=n,this.access=s}update(){const{textureNode:t}=this;return this.texture!==t.value?(this.texture=t.value,!0):super.update()}}class XD extends Ix{constructor(t,e,n,s=null){super(t,e,n,s),this.isSampledCubeTexture=!0}}class cw extends Ix{constructor(t,e,n,s=null){super(t,e,n,s),this.isSampledTexture3D=!0}}const JR={bitcast_int_uint:new Os("uint tsl_bitcast_int_to_uint ( int x ) { return floatBitsToUint( intBitsToFloat ( x ) ); }"),bitcast_uint_int:new Os("uint tsl_bitcast_uint_to_int ( uint x ) { return floatBitsToInt( uintBitsToFloat ( x ) ); }")},LW={textureDimensions:"textureSize",equals:"equal",bitcast_float_int:"floatBitsToInt",bitcast_int_float:"intBitsToFloat",bitcast_uint_float:"uintBitsToFloat",bitcast_float_uint:"floatBitsToUint",bitcast_uint_int:"tsl_bitcast_uint_to_int",bitcast_int_uint:"tsl_bitcast_int_to_uint",floatpack_snorm_2x16:"packSnorm2x16",floatpack_unorm_2x16:"packUnorm2x16",floatpack_float16_2x16:"packHalf2x16",floatunpack_snorm_2x16:"unpackSnorm2x16",floatunpack_unorm_2x16:"unpackUnorm2x16",floatunpack_float16_2x16:"unpackHalf2x16"},tE={low:"lowp",medium:"mediump",high:"highp"},eE={swizzleAssign:!0,storageBuffer:!1},nE={perspective:"smooth",linear:"noperspective"},sE={centroid:"centroid"},iE=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision highp sampler2DShadow;
precision highp sampler2DArrayShadow;
precision highp samplerCubeShadow;
`;class OW extends zD{constructor(t,e){super(t,e,new lW),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(t){return t.isVideoTexture===!0&&t.colorSpace!==_c}_include(t){const e=JR[t];return e.build(this),this.addInclude(e),e}getMethod(t){return JR[t]!==void 0&&this._include(t),LW[t]||t}getBitcastMethod(t,e){return this.getMethod(`bitcast_${e}_${t}`)}getFloatPackingMethod(t){return this.getMethod(`floatpack_${t}_2x16`)}getFloatUnpackingMethod(t){return this.getMethod(`floatunpack_${t}_2x16`)}getTernary(t,e,n){return`${t} ? ${e} : ${n}`}getOutputStructName(){return""}buildFunctionCode(t){const e=t.layout,n=this.flowShaderNode(t),s=[];for(const a of e.inputs)s.push(this.getType(a.type)+" "+a.name);return`${this.getType(e.type)} ${e.name}( ${s.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(t){const e=t.value;if(e.pbo===void 0){const n=e.array,s=e.count*e.itemSize,{itemSize:i}=e,a=e.array.constructor.name.toLowerCase().includes("int");let c=a?Qy:Hp;i===2?c=a?Jy:jo:i===3?c=a?qF:Zy:i===4&&(c=a?tx:Yi);const u={Float32Array:Ri,Uint8Array:gi,Uint16Array:Mu,Uint32Array:Qn,Int8Array:cd,Int16Array:ud,Int32Array:di,Uint8ClampedArray:gi},d=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(s/i))));let f=Math.ceil(s/i/d);d*f*i<s&&f++;const p=d*f*i,g=new n.constructor(p);g.set(n,0),e.array=g;const y=new sx(e.array,d,f,c,u[e.array.constructor.name]||Ri);y.needsUpdate=!0,y.isPBOTexture=!0;const x=new ca(y,null,null);x.setPrecision("high"),e.pboNode=x,e.pbo=x.value,this.getUniformFromNode(e.pboNode,"texture",this.shaderStage,this.context.nodeName)}}getPropertyName(t,e=this.shaderStage){return t.isNodeUniform&&t.node.isTextureNode!==!0&&t.node.isBufferNode!==!0?t.name:super.getPropertyName(t,e)}generatePBO(t){const{node:e,indexNode:n}=t,s=e.value;if(this.renderer.backend.has(s)){const f=this.renderer.backend.get(s);f.pbo=s.pbo}const i=this.getUniformFromNode(s.pboNode,"texture",this.shaderStage,this.context.nodeName),a=this.getPropertyName(i);this.increaseUsage(n);const c=n.build(this,"uint"),u=this.getDataFromNode(t);let d=u.propertyName;if(d===void 0){const f=this.getVarFromNode(t);d=this.getPropertyName(f);const p=this.getDataFromNode(e);let g=p.propertySizeName;g===void 0&&(g=d+"Size",this.getVarFromNode(e,g,"uint"),this.addLineFlowCode(`${g} = uint( textureSize( ${a}, 0 ).x )`,t),p.propertySizeName=g);const{itemSize:y}=s,x="."+Gu.join("").slice(0,y),S=`ivec2(${c} % ${g}, ${c} / ${g})`,T=this.generateTextureLoad(null,a,S,"0",null,null);let M="vec4";s.pbo.type===Qn?M="uvec4":s.pbo.type===di&&(M="ivec4"),this.addLineFlowCode(`${d} = ${M}(${T})${x}`,t),u.propertyName=d}return d}generateTextureLoad(t,e,n,s,i,a){s===null&&(s="0");let c;return i?a?c=`texelFetchOffset( ${e}, ivec3( ${n}, ${i} ), ${s}, ${a} )`:c=`texelFetch( ${e}, ivec3( ${n}, ${i} ), ${s} )`:a?c=`texelFetchOffset( ${e}, ${n}, ${s}, ${a} )`:c=`texelFetch( ${e}, ${n}, ${s} )`,t!==null&&t.isDepthTexture&&(c+=".x"),c}generateTexture(t,e,n,s,i){return s&&(n=`vec3( ${n}, ${s} )`),t.isDepthTexture?i?`textureOffset( ${e}, ${n}, ${i} ).x`:`texture( ${e}, ${n} ).x`:i?`textureOffset( ${e}, ${n}, ${i} )`:`texture( ${e}, ${n} )`}generateTextureLevel(t,e,n,s,i,a){return i&&(n=`vec3( ${n}, ${i} )`),a?`textureLodOffset( ${e}, ${n}, ${s}, ${a} )`:`textureLod( ${e}, ${n}, ${s} )`}generateTextureBias(t,e,n,s,i,a){return i&&(n=`vec3( ${n}, ${i} )`),a?`textureOffset( ${e}, ${n}, ${a}, ${s} )`:`texture( ${e}, ${n}, ${s} )`}generateTextureGrad(t,e,n,s,i,a){return i&&(n=`vec3( ${n}, ${i} )`),a?`textureGradOffset( ${e}, ${n}, ${s[0]}, ${s[1]}, ${a} )`:`textureGrad( ${e}, ${n}, ${s[0]}, ${s[1]} )`}generateTextureCompare(t,e,n,s,i,a,c=this.shaderStage){if(c==="fragment")return t.isCubeTexture?`texture( ${e}, vec4( ${n}, ${s} ) )`:i?a?`textureOffset( ${e}, vec4( ${n}, ${i}, ${s} ), ${a} )`:`texture( ${e}, vec4( ${n}, ${i}, ${s} ) )`:a?`textureOffset( ${e}, vec3( ${n}, ${s} ), ${a} )`:`texture( ${e}, vec3( ${n}, ${s} ) )`;Ht(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${c} shader.`)}getVars(t){const e=[],n=this.vars[t];if(n!==void 0)for(const s of n)e.push(`${this.getVar(s.type,s.name,s.count)};`);return e.join(`
	`)}getUniforms(t){const e=this.uniforms[t],n=[],s={};for(const a of e){let c=null,u=!1;if(a.type==="texture"||a.type==="texture3D"){const d=a.node.value;let f="";(d.isDataTexture===!0||d.isData3DTexture===!0)&&(d.type===Qn?f="u":d.type===di&&(f="i")),a.type==="texture3D"&&d.isArrayTexture===!1?c=`${f}sampler3D ${a.name};`:d.compareFunction?d.isArrayTexture===!0?c=`sampler2DArrayShadow ${a.name};`:c=`sampler2DShadow ${a.name};`:d.isArrayTexture===!0||d.isDataArrayTexture===!0||d.isCompressedArrayTexture===!0?c=`${f}sampler2DArray ${a.name};`:c=`${f}sampler2D ${a.name};`}else if(a.type==="cubeTexture")c=`samplerCube ${a.name};`;else if(a.type==="cubeDepthTexture")a.node.value.compareFunction?c=`samplerCubeShadow ${a.name};`:c=`samplerCube ${a.name};`;else if(a.type==="buffer"){const d=a.node,f=this.getType(d.bufferType),p=d.bufferCount,g=p>0?p:"";c=`${d.name} {
	${f} ${a.name}[${g}];
};
`}else{const d=a.groupNode.name;if(s[d]===void 0){const f=this.uniformGroups[d];if(f!==void 0){const p=[];for(const g of f.uniforms){const y=g.getType(),x=this.getVectorType(y),S=g.nodeUniform.node.precision;let T=`${x} ${g.name};`;S!==null&&(T=tE[S]+" "+T),p.push("	"+T)}s[d]=p}}u=!0}if(!u){const d=a.node.precision;d!==null&&(c=tE[d]+" "+c),c="uniform "+c,n.push(c)}}let i="";for(const a in s){const c=s[a];i+=this._getGLSLUniformStruct(a,c.join(`
`))+`
`}return i+=n.join(`
`),i}getTypeFromAttribute(t){let e=super.getTypeFromAttribute(t);if(/^[iu]/.test(e)&&t.gpuType!==di){let n=t;t.isInterleavedBufferAttribute&&(n=t.data);const s=n.array;s instanceof Uint32Array||s instanceof Int32Array||(e=e.slice(1))}return e}getAttributes(t){let e="";if(t==="vertex"||t==="compute"){const n=this.getAttributesArray();let s=0;for(const i of n)e+=`layout( location = ${s++} ) in ${i.type} ${i.name};
`}return e}getStructMembers(t){const e=[];for(const n of t.members)e.push(`	${n.type} ${n.name};`);return e.join(`
`)}getStructs(t){const e=[],n=this.structs[t],s=[];for(const i of n)if(i.output)for(const a of i.members)s.push(`layout( location = ${a.index} ) out ${a.type} ${a.name};`);else{let a="struct "+i.name+` {
`;a+=this.getStructMembers(i),a+=`
};
`,e.push(a)}return s.length===0&&s.push("layout( location = 0 ) out vec4 fragColor;"),`
`+s.join(`
`)+`

`+e.join(`
`)}getVaryings(t){let e="";const n=this.varyings;if(t==="vertex"||t==="compute")for(const s of n){t==="compute"&&(s.needsInterpolation=!0);const i=this.getType(s.type);if(s.needsInterpolation)if(s.interpolationType){const a=nE[s.interpolationType]||s.interpolationType,c=sE[s.interpolationSampling]||"";e+=`${a} ${c} out ${i} ${s.name};
`}else{const a=i.includes("int")||i.includes("uv")||i.includes("iv")?"flat ":"";e+=`${a}out ${i} ${s.name};
`}else e+=`${i} ${s.name};
`}else if(t==="fragment"){for(const s of n)if(s.needsInterpolation){const i=this.getType(s.type);if(s.interpolationType){const a=nE[s.interpolationType]||s.interpolationType,c=sE[s.interpolationSampling]||"";e+=`${a} ${c} in ${i} ${s.name};
`}else{const a=i.includes("int")||i.includes("uv")||i.includes("iv")?"flat ":"";e+=`${a}in ${i} ${s.name};
`}}}for(const s of this.builtins[t])e+=`${s};
`;return e}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,s)=>n*s,1)}u`}getSubgroupSize(){Ht("GLSLNodeBuilder: WebGLBackend does not support the subgroupSize node")}getInvocationSubgroupIndex(){Ht("GLSLNodeBuilder: WebGLBackend does not support the invocationSubgroupIndex node")}getSubgroupIndex(){Ht("GLSLNodeBuilder: WebGLBackend does not support the subgroupIndex node")}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(t,e,n=this.shaderStage){const s=this.extensions[n]||(this.extensions[n]=new Map);s.has(t)===!1&&s.set(t,{name:t,behavior:e})}getExtensions(t){const e=[];if(t==="vertex"){const s=this.renderer.backend.extensions;this.object.isBatchedMesh&&s.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",t)}const n=this.extensions[t];if(n!==void 0)for(const{name:s,behavior:i}of n.values())e.push(`#extension ${s} : ${i}`);return e.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(t){let e=eE[t];if(e===void 0){let n;switch(e=!1,t){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const s=this.renderer.backend.extensions;s.has(n)&&(s.get(n),e=!0)}eE[t]=e}return e}isFlipY(){return!0}getUniformBufferLimit(){const t=this.renderer.backend.gl;return t.getParameter(t.MAX_UNIFORM_BLOCK_SIZE)}enableHardwareClipping(t){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${t} ]`)}enableMultiview(){this.enableExtension("GL_OVR_multiview2","require","fragment"),this.enableExtension("GL_OVR_multiview2","require","vertex"),this.builtins.vertex.push("layout(num_views = 2) in")}registerTransform(t,e){this.transforms.push({varyingName:t,attributeNode:e})}getTransforms(){const t=this.transforms;let e="";for(let n=0;n<t.length;n++){const s=t[n],i=this.getPropertyName(s.attributeNode);i&&(e+=`${s.varyingName} = ${i};
	`)}return e}_getGLSLUniformStruct(t,e){return`
layout( std140 ) uniform ${t} {
${e}
};`}_getGLSLVertexCode(t){return`#version 300 es

${this.getSignature()}

// extensions
${t.extensions}

// precision
${iE}

// uniforms
${t.uniforms}

// varyings
${t.varyings}

// attributes
${t.attributes}

// codes
${t.codes}

void main() {

	// vars
	${t.vars}

	// transforms
	${t.transforms}

	// flow
	${t.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(t){return`#version 300 es

${this.getSignature()}

// extensions
${t.extensions}

// precision
${iE}

// structs
${t.structs}

// uniforms
${t.uniforms}

// varyings
${t.varyings}

// codes
${t.codes}

void main() {

	// vars
	${t.vars}

	// flow
	${t.flow}

}
`}buildCode(){const t=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const e in t){let n=`// code

`;n+=this.flowCode[e];const s=this.flowNodes[e],i=s[s.length-1];for(const c of s){const u=this.getFlowData(c),d=c.name;d&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${d}
	`),n+=`${u.code}
	`,c===i&&e!=="compute"&&(n+=`// result
	`,e==="vertex"?(n+="gl_Position = ",n+=`${u.result};`):e==="fragment"&&(c.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${u.result};`)))}const a=t[e];a.extensions=this.getExtensions(e),a.uniforms=this.getUniforms(e),a.attributes=this.getAttributes(e),a.varyings=this.getVaryings(e),a.vars=this.getVars(e),a.structs=this.getStructs(e),a.codes=this.getCodes(e),a.transforms=this.getTransforms(e),a.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(t.vertex),this.fragmentShader=this._getGLSLFragmentCode(t.fragment)):this.computeShader=this._getGLSLVertexCode(t.compute)}getUniformFromNode(t,e,n,s=null){const i=super.getUniformFromNode(t,e,n,s),a=this.getDataFromNode(t,n,this.globalCache);let c=a.uniformGPU;if(c===void 0){const u=t.groupNode,d=u.name,f=this.getBindGroupArray(d,n);if(e==="texture")c=new Ix(i.name,i.node,u),f.push(c);else if(e==="cubeTexture"||e==="cubeDepthTexture")c=new XD(i.name,i.node,u),f.push(c);else if(e==="texture3D")c=new cw(i.name,i.node,u),f.push(c);else if(e==="buffer"){i.name=`buffer${t.id}`;const p=this.getSharedDataFromNode(t);let g=p.buffer;g===void 0&&(t.name=`NodeBuffer_${t.id}`,g=new WD(t,u),g.name=t.name,p.buffer=g),f.push(g),c=g}else{let p=this.uniformGroups[d];p===void 0?(p=new qD(d,u),this.uniformGroups[d]=p,f.push(p)):f.indexOf(p)===-1&&f.push(p),c=this.getNodeUniform(i,e);const g=c.name;p.uniforms.some(x=>x.name===g)||p.addUniform(c)}a.uniformGPU=c}return i}}let r2=null,jh=null;class jD{constructor(t={}){this.parameters=Object.assign({},t),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={[Yo.RENDER]:null,[Yo.COMPUTE]:null},this.trackTimestamp=t.trackTimestamp===!0}async init(t){this.renderer=t}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}updateSampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}updateTimeStampUID(t){const e=this.get(t),n=this.renderer.info.frame;let s;t.isComputeNode===!0?s="c:"+this.renderer.info.compute.frameCalls:s="r:"+this.renderer.info.render.frameCalls,e.timestampUID=s+":"+t.id+":f"+n}getTimestampUID(t){return this.get(t).timestampUID}getTimestampFrames(t){const e=this.timestampQueryPool[t];return e?e.getTimestampFrames():[]}_getQueryPool(t){const e=t.startsWith("c:")?Yo.COMPUTE:Yo.RENDER;return this.timestampQueryPool[e]}getTimestamp(t){return this._getQueryPool(t).getTimestamp(t)}hasTimestamp(t){return this._getQueryPool(t).hasTimestamp(t)}isOccluded(){}async resolveTimestampsAsync(t="render"){if(!this.trackTimestamp){rn("WebGPURenderer: Timestamp tracking is disabled.");return}const e=this.timestampQueryPool[t];if(!e)return;const n=await e.resolveQueriesAsync();return this.renderer.info[t].timestamp=n,n}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return r2=r2||new Ot,this.renderer.getDrawingBufferSize(r2)}setScissorTest(){}getClearColor(){const t=this.renderer;return jh=jh||new t_,t.getClearColor(jh),jh.getRGB(jh),jh}getDomElement(){let t=this.domElement;return t===null&&(t=this.parameters.canvas!==void 0?this.parameters.canvas:hU(),"setAttribute"in t&&t.setAttribute("data-engine",`three.js r${kp} webgpu`),this.domElement=t),t}hasCompatibility(){return!1}initRenderTarget(){}set(t,e){this.data.set(t,e)}get(t){let e=this.data.get(t);return e===void 0&&(e={},this.data.set(t,e)),e}has(t){return this.data.has(t)}delete(t){this.data.delete(t)}deleteBindGroupData(){}dispose(){}}let FW=0;class UW{constructor(t,e){this.buffers=[t.bufferGPU,e],this.type=t.type,this.bufferType=t.bufferType,this.pbo=t.pbo,this.byteLength=t.byteLength,this.bytesPerElement=t.BYTES_PER_ELEMENT,this.version=t.version,this.isInteger=t.isInteger,this.activeBufferIndex=0,this.baseId=t.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class PW{constructor(t){this.backend=t}createAttribute(t,e){const n=this.backend,{gl:s}=n,i=t.array,a=t.usage||s.STATIC_DRAW,c=t.isInterleavedBufferAttribute?t.data:t,u=n.get(c);let d=u.bufferGPU;d===void 0&&(d=this._createBuffer(s,e,i,a),u.bufferGPU=d,u.bufferType=e,u.version=c.version);let f;if(i instanceof Float32Array)f=s.FLOAT;else if(typeof Float16Array<"u"&&i instanceof Float16Array)f=s.HALF_FLOAT;else if(i instanceof Uint16Array)t.isFloat16BufferAttribute?f=s.HALF_FLOAT:f=s.UNSIGNED_SHORT;else if(i instanceof Int16Array)f=s.SHORT;else if(i instanceof Uint32Array)f=s.UNSIGNED_INT;else if(i instanceof Int32Array)f=s.INT;else if(i instanceof Int8Array)f=s.BYTE;else if(i instanceof Uint8Array)f=s.UNSIGNED_BYTE;else if(i instanceof Uint8ClampedArray)f=s.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+i);let p={bufferGPU:d,bufferType:e,type:f,byteLength:i.byteLength,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version,pbo:t.pbo,isInteger:f===s.INT||f===s.UNSIGNED_INT||t.gpuType===di,id:FW++};if(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute){const g=this._createBuffer(s,e,i,a);p=new UW(p,g)}n.set(t,p)}updateAttribute(t){const e=this.backend,{gl:n}=e,s=t.array,i=t.isInterleavedBufferAttribute?t.data:t,a=e.get(i),c=a.bufferType,u=t.isInterleavedBufferAttribute?t.data.updateRanges:t.updateRanges;if(n.bindBuffer(c,a.bufferGPU),u.length===0)n.bufferSubData(c,0,s);else{for(let d=0,f=u.length;d<f;d++){const p=u[d];n.bufferSubData(c,p.start*s.BYTES_PER_ELEMENT,s,p.start,p.count)}i.clearUpdateRanges()}n.bindBuffer(c,null),a.version=i.version}destroyAttribute(t){const e=this.backend,{gl:n}=e;t.isInterleavedBufferAttribute&&e.delete(t.data);const s=e.get(t);n.deleteBuffer(s.bufferGPU),e.delete(t)}async getArrayBufferAsync(t){const e=this.backend,{gl:n}=e,s=t.isInterleavedBufferAttribute?t.data:t,{bufferGPU:i}=e.get(s),a=t.array,c=a.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,i);const u=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,u),n.bufferData(n.COPY_WRITE_BUFFER,c,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,c),await e.utils._clientWaitAsync();const d=new t.array.constructor(a.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,u),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,d),n.deleteBuffer(u),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),d.buffer}_createBuffer(t,e,n,s){const i=t.createBuffer();return t.bindBuffer(e,i),t.bufferData(e,n,s),t.bindBuffer(e,null),i}}let $f,Va;class zW{constructor(t){this.backend=t,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthReversed=!1,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const t=this.gl;$f={[qr]:t.FUNC_ADD,[E3]:t.FUNC_SUBTRACT,[C3]:t.FUNC_REVERSE_SUBTRACT},Va={[ic]:t.ZERO,[B3]:t.ONE,[D3]:t.SRC_COLOR,[Np]:t.SRC_ALPHA,[z3]:t.SRC_ALPHA_SATURATE,[U3]:t.DST_COLOR,[O3]:t.DST_ALPHA,[L3]:t.ONE_MINUS_SRC_COLOR,[Rp]:t.ONE_MINUS_SRC_ALPHA,[P3]:t.ONE_MINUS_DST_COLOR,[F3]:t.ONE_MINUS_DST_ALPHA};const e=t.getParameter(t.SCISSOR_BOX),n=t.getParameter(t.VIEWPORT);this.currentScissor=new je().fromArray(e),this.currentViewport=new je().fromArray(n),this._tempVec4=new je}enable(t){const{enabled:e}=this;e[t]!==!0&&(this.gl.enable(t),e[t]=!0)}disable(t){const{enabled:e}=this;e[t]!==!1&&(this.gl.disable(t),e[t]=!1)}setFlipSided(t){if(this.currentFlipSided!==t){const{gl:e}=this;t?e.frontFace(e.CW):e.frontFace(e.CCW),this.currentFlipSided=t}}setCullFace(t){const{gl:e}=this;t!==CF?(this.enable(e.CULL_FACE),t!==this.currentCullFace&&(t===BF?e.cullFace(e.BACK):t===DF?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this.disable(e.CULL_FACE),this.currentCullFace=t}setLineWidth(t){const{currentLineWidth:e,gl:n}=this;t!==e&&(n.lineWidth(t),this.currentLineWidth=t)}setMRTBlending(t,e,n){const s=this.gl,i=this.backend.drawBuffersIndexedExt;if(!i){rn("WebGPURenderer: Multiple Render Targets (MRT) blending configuration is not fully supported in compatibility mode. The material blending will be used for all render targets.");return}for(let a=0;a<t.length;a++){const c=t[a];let u=null;if(e!==null){const d=e.getBlendMode(c.name);d.blending===Sw?u=n:d.blending!==tl&&(u=d)}else u=n;u!==null?this._setMRTBlendingIndex(a,u):i.blendFuncSeparateiOES(a,s.ONE,s.ZERO,s.ONE,s.ZERO)}}_setMRTBlendingIndex(t,e){const{gl:n}=this,s=this.backend.drawBuffersIndexedExt,i=e.blending,a=e.blendSrc,c=e.blendDst,u=e.blendEquation,d=e.premultipliedAlpha;if(i===ld){const f=e.blendSrcAlpha!==null?e.blendSrcAlpha:a,p=e.blendDstAlpha!==null?e.blendDstAlpha:c,g=e.blendEquationAlpha!==null?e.blendEquationAlpha:u;s.blendEquationSeparateiOES(t,$f[u],$f[g]),s.blendFuncSeparateiOES(t,Va[a],Va[c],Va[f],Va[p])}else if(s.blendEquationSeparateiOES(t,n.FUNC_ADD,n.FUNC_ADD),d)switch(i){case fi:s.blendFuncSeparateiOES(t,n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Sr:s.blendFuncSeparateiOES(t,n.ONE,n.ONE,n.ONE,n.ONE);break;case sd:s.blendFuncSeparateiOES(t,n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case id:s.blendFuncSeparateiOES(t,n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:s.blendFuncSeparateiOES(t,n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break}else switch(i){case fi:s.blendFuncSeparateiOES(t,n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case Sr:s.blendFuncSeparateiOES(t,n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case sd:s.blendFuncSeparateiOES(t,n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case id:s.blendFuncSeparateiOES(t,n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:s.blendFuncSeparateiOES(t,n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break}}setBlending(t,e,n,s,i,a,c,u){const{gl:d}=this;if(t===tl){this.currentBlendingEnabled===!0&&(this.disable(d.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(d.BLEND),this.currentBlendingEnabled=!0),t!==ld){if(t!==this.currentBlending||u!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==qr||this.currentBlendEquationAlpha!==qr)&&(d.blendEquation(d.FUNC_ADD),this.currentBlendEquation=qr,this.currentBlendEquationAlpha=qr),u)switch(t){case fi:d.blendFuncSeparate(d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case Sr:d.blendFunc(d.ONE,d.ONE);break;case sd:d.blendFuncSeparate(d.ZERO,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);break;case id:d.blendFuncSeparate(d.DST_COLOR,d.ONE_MINUS_SRC_ALPHA,d.ZERO,d.ONE);break;default:Ht("WebGLState: Invalid blending: ",t);break}else switch(t){case fi:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case Sr:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE,d.ONE,d.ONE);break;case sd:Ht("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case id:Ht("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Ht("WebGLState: Invalid blending: ",t);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=t,this.currentPremultipledAlpha=u}return}i=i||e,a=a||n,c=c||s,(e!==this.currentBlendEquation||i!==this.currentBlendEquationAlpha)&&(d.blendEquationSeparate($f[e],$f[i]),this.currentBlendEquation=e,this.currentBlendEquationAlpha=i),(n!==this.currentBlendSrc||s!==this.currentBlendDst||a!==this.currentBlendSrcAlpha||c!==this.currentBlendDstAlpha)&&(d.blendFuncSeparate(Va[n],Va[s],Va[a],Va[c]),this.currentBlendSrc=n,this.currentBlendDst=s,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=c),this.currentBlending=t,this.currentPremultipledAlpha=!1}setColorMask(t){this.currentColorMask!==t&&(this.gl.colorMask(t,t,t,t),this.currentColorMask=t)}setDepthTest(t){const{gl:e}=this;t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)}setReversedDepth(t){if(this.currentDepthReversed!==t){const e=this.backend.extensions.get("EXT_clip_control");t?e.clipControlEXT(e.LOWER_LEFT_EXT,e.ZERO_TO_ONE_EXT):e.clipControlEXT(e.LOWER_LEFT_EXT,e.NEGATIVE_ONE_TO_ONE_EXT),this.currentDepthReversed=t}}setDepthMask(t){this.currentDepthMask!==t&&(this.gl.depthMask(t),this.currentDepthMask=t)}setDepthFunc(t){if(this.currentDepthReversed&&(t=K3[t]),this.currentDepthFunc!==t){const{gl:e}=this;switch(t){case qg:e.depthFunc(e.NEVER);break;case $g:e.depthFunc(e.ALWAYS);break;case Xg:e.depthFunc(e.LESS);break;case xd:e.depthFunc(e.LEQUAL);break;case jg:e.depthFunc(e.EQUAL);break;case Yg:e.depthFunc(e.GEQUAL);break;case Kg:e.depthFunc(e.GREATER);break;case Zg:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}this.currentDepthFunc=t}}scissor(t,e,n,s){const i=this._tempVec4.set(t,e,n,s);if(this.currentScissor.equals(i)===!1){const{gl:a}=this;a.scissor(i.x,i.y,i.z,i.w),this.currentScissor.copy(i)}}viewport(t,e,n,s){const i=this._tempVec4.set(t,e,n,s);if(this.currentViewport.equals(i)===!1){const{gl:a}=this;a.viewport(i.x,i.y,i.z,i.w),this.currentViewport.copy(i)}}setScissorTest(t){const e=this.gl;t?this.enable(e.SCISSOR_TEST):this.disable(e.SCISSOR_TEST)}setStencilTest(t){const{gl:e}=this;t?this.enable(e.STENCIL_TEST):this.disable(e.STENCIL_TEST)}setStencilMask(t){this.currentStencilMask!==t&&(this.gl.stencilMask(t),this.currentStencilMask=t)}setStencilFunc(t,e,n){(this.currentStencilFunc!==t||this.currentStencilRef!==e||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(t,e,n),this.currentStencilFunc=t,this.currentStencilRef=e,this.currentStencilFuncMask=n)}setStencilOp(t,e,n){(this.currentStencilFail!==t||this.currentStencilZFail!==e||this.currentStencilZPass!==n)&&(this.gl.stencilOp(t,e,n),this.currentStencilFail=t,this.currentStencilZFail=e,this.currentStencilZPass=n)}setMaterial(t,e,n){const{gl:s}=this;t.side===En?this.disable(s.CULL_FACE):this.enable(s.CULL_FACE);let i=t.side===us;e&&(i=!i),this.setFlipSided(i),t.blending===fi&&t.transparent===!1?this.setBlending(tl):this.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),this.setDepthFunc(t.depthFunc),this.setDepthTest(t.depthTest),this.setDepthMask(t.depthWrite),this.setColorMask(t.colorWrite);const a=t.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(t.stencilWriteMask),this.setStencilFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),this.setStencilOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),this.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),t.alphaToCoverage===!0&&this.backend.renderer.currentSamples>0?this.enable(s.SAMPLE_ALPHA_TO_COVERAGE):this.disable(s.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let u=0;u<8;u++)u<n?this.enable(12288+u):this.disable(12288+u)}setPolygonOffset(t,e,n){const{gl:s}=this;t?(this.enable(s.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==e||this.currentPolygonOffsetUnits!==n)&&(s.polygonOffset(e,n),this.currentPolygonOffsetFactor=e,this.currentPolygonOffsetUnits=n)):this.disable(s.POLYGON_OFFSET_FILL)}useProgram(t){return this.currentProgram!==t?(this.gl.useProgram(t),this.currentProgram=t,!0):!1}setVertexState(t,e=null){const n=this.gl;return this.currentVAO!==t||this.currentIndex!==e?(n.bindVertexArray(t),e!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.currentVAO=t,this.currentIndex=e,!0):!1}resetVertexState(){const t=this.gl;t.bindVertexArray(null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(t,e){const{gl:n,currentBoundFramebuffers:s}=this;return s[t]!==e?(n.bindFramebuffer(t,e),s[t]=e,t===n.DRAW_FRAMEBUFFER&&(s[n.FRAMEBUFFER]=e),t===n.FRAMEBUFFER&&(s[n.DRAW_FRAMEBUFFER]=e),!0):!1}drawBuffers(t,e){const{gl:n}=this;let s=[],i=!1;if(t.textures!==null){s=this.currentDrawbuffers.get(e),s===void 0&&(s=[],this.currentDrawbuffers.set(e,s));const a=t.textures;if(s.length!==a.length||s[0]!==n.COLOR_ATTACHMENT0){for(let c=0,u=a.length;c<u;c++)s[c]=n.COLOR_ATTACHMENT0+c;s.length=a.length,i=!0}}else s[0]!==n.BACK&&(s[0]=n.BACK,i=!0);i&&n.drawBuffers(s)}activeTexture(t){const{gl:e,currentTextureSlot:n,maxTextures:s}=this;t===void 0&&(t=e.TEXTURE0+s-1),n!==t&&(e.activeTexture(t),this.currentTextureSlot=t)}bindTexture(t,e,n){const{gl:s,currentTextureSlot:i,currentBoundTextures:a,maxTextures:c}=this;n===void 0&&(i===null?n=s.TEXTURE0+c-1:n=i);let u=a[n];u===void 0&&(u={type:void 0,texture:void 0},a[n]=u),(u.type!==t||u.texture!==e)&&(i!==n&&(s.activeTexture(n),this.currentTextureSlot=n),s.bindTexture(t,e),u.type=t,u.texture=e)}bindBufferBase(t,e,n){const{gl:s}=this,i=`${t}-${e}`;return this.currentBoundBufferBases[i]!==n?(s.bindBufferBase(t,e,n),this.currentBoundBufferBases[i]=n,!0):!1}unbindTexture(){const{gl:t,currentTextureSlot:e,currentBoundTextures:n}=this,s=n[e];s!==void 0&&s.type!==void 0&&(t.bindTexture(s.type,null),s.type=void 0,s.texture=void 0)}}class IW{constructor(t){this.backend=t,this.gl=this.backend.gl,this.extensions=t.extensions}convert(t,e=_c){const{gl:n,extensions:s}=this;let i;const a=qe.getTransfer(e);if(t===gi)return n.UNSIGNED_BYTE;if(t===V3)return n.UNSIGNED_SHORT_4_4_4_4;if(t===G3)return n.UNSIGNED_SHORT_5_5_5_1;if(t===Mw)return n.UNSIGNED_INT_5_9_9_9_REV;if(t===vw)return n.UNSIGNED_INT_10F_11F_11F_REV;if(t===cd)return n.BYTE;if(t===ud)return n.SHORT;if(t===Mu)return n.UNSIGNED_SHORT;if(t===di)return n.INT;if(t===Qn)return n.UNSIGNED_INT;if(t===Ri)return n.FLOAT;if(t===ni)return n.HALF_FLOAT;if(t===k3)return n.ALPHA;if(t===Zy)return n.RGB;if(t===Yi)return n.RGBA;if(t===To)return n.DEPTH_COMPONENT;if(t===el)return n.DEPTH_STENCIL;if(t===Hp)return n.RED;if(t===Qy)return n.RED_INTEGER;if(t===jo)return n.RG;if(t===Jy)return n.RG_INTEGER;if(t===tx)return n.RGBA_INTEGER;if(t===up||t===hp||t===dp||t===fp)if(a===ye)if(i=s.get("WEBGL_compressed_texture_s3tc_srgb"),i!==null){if(t===up)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===hp)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===dp)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===fp)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(i=s.get("WEBGL_compressed_texture_s3tc"),i!==null){if(t===up)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===hp)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===dp)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===fp)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(t===C2||t===B2||t===D2||t===L2)if(i=s.get("WEBGL_compressed_texture_pvrtc"),i!==null){if(t===C2)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===B2)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===D2)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===L2)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(t===Jg||t===ty||t===ey||t===ny||t===sy||t===Cp||t===iy)if(i=s.get("WEBGL_compressed_texture_etc"),i!==null){if(t===Jg||t===ty)return a===ye?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(t===ey)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC;if(t===ny)return i.COMPRESSED_R11_EAC;if(t===sy)return i.COMPRESSED_SIGNED_R11_EAC;if(t===Cp)return i.COMPRESSED_RG11_EAC;if(t===iy)return i.COMPRESSED_SIGNED_RG11_EAC}else return null;if(t===ry||t===oy||t===ay||t===ly||t===cy||t===uy||t===hy||t===dy||t===fy||t===py||t===my||t===gy||t===yy||t===xy)if(i=s.get("WEBGL_compressed_texture_astc"),i!==null){if(t===ry)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===oy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===ay)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===ly)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===cy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===uy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===hy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===dy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===fy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===py)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===my)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===gy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===yy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===xy)return a===ye?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(t===by)if(i=s.get("EXT_texture_compression_bptc"),i!==null){if(t===by)return a===ye?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(t===Sy||t===wy||t===Bp||t===Ty)if(i=s.get("EXT_texture_compression_rgtc"),i!==null){if(t===Sy)return i.COMPRESSED_RED_RGTC1_EXT;if(t===wy)return i.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(t===Bp)return i.COMPRESSED_RED_GREEN_RGTC2_EXT;if(t===Ty)return i.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return t===yc?n.UNSIGNED_INT_24_8:n[t]!==void 0?n[t]:null}_clientWaitAsync(){const{gl:t}=this,e=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0);return t.flush(),new Promise((n,s)=>{function i(){const a=t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0);if(a===t.WAIT_FAILED){t.deleteSync(e),s();return}if(a===t.TIMEOUT_EXPIRED){requestAnimationFrame(i);return}t.deleteSync(e),n()}i()})}}let rE=!1,hg,o2,oE;class VW{constructor(t){this.backend=t,this.gl=t.gl,this.extensions=t.extensions,this.defaultTextures={},this._srcFramebuffer=null,this._dstFramebuffer=null,rE===!1&&(this._init(),rE=!0)}_init(){const t=this.gl;hg={[Bn]:t.REPEAT,[ji]:t.CLAMP_TO_EDGE,[Sd]:t.MIRRORED_REPEAT},o2={[ts]:t.NEAREST,[I3]:t.NEAREST_MIPMAP_NEAREST,[Ep]:t.NEAREST_MIPMAP_LINEAR,[qs]:t.LINEAR,[E2]:t.LINEAR_MIPMAP_NEAREST,[Jo]:t.LINEAR_MIPMAP_LINEAR},oE={[W3]:t.NEVER,[j3]:t.ALWAYS,[Aw]:t.LESS,[ex]:t.LEQUAL,[q3]:t.EQUAL,[nx]:t.GEQUAL,[$3]:t.GREATER,[X3]:t.NOTEQUAL}}getGLTextureType(t){const{gl:e}=this;let n;return t.isCubeTexture===!0?n=e.TEXTURE_CUBE_MAP:t.isArrayTexture===!0||t.isDataArrayTexture===!0||t.isCompressedArrayTexture===!0?n=e.TEXTURE_2D_ARRAY:t.isData3DTexture===!0?n=e.TEXTURE_3D:n=e.TEXTURE_2D,n}getInternalFormat(t,e,n,s,i=!1){const{gl:a,extensions:c}=this;if(t!==null){if(a[t]!==void 0)return a[t];Wt("WebGLBackend: Attempt to use non-existing WebGL internal format '"+t+"'")}let u=e;if(e===a.RED&&(n===a.FLOAT&&(u=a.R32F),n===a.HALF_FLOAT&&(u=a.R16F),n===a.UNSIGNED_BYTE&&(u=a.R8),n===a.UNSIGNED_SHORT&&(u=a.R16),n===a.UNSIGNED_INT&&(u=a.R32UI),n===a.BYTE&&(u=a.R8I),n===a.SHORT&&(u=a.R16I),n===a.INT&&(u=a.R32I)),e===a.RED_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.R8UI),n===a.UNSIGNED_SHORT&&(u=a.R16UI),n===a.UNSIGNED_INT&&(u=a.R32UI),n===a.BYTE&&(u=a.R8I),n===a.SHORT&&(u=a.R16I),n===a.INT&&(u=a.R32I)),e===a.RG&&(n===a.FLOAT&&(u=a.RG32F),n===a.HALF_FLOAT&&(u=a.RG16F),n===a.UNSIGNED_BYTE&&(u=a.RG8),n===a.UNSIGNED_SHORT&&(u=a.RG16),n===a.UNSIGNED_INT&&(u=a.RG32UI),n===a.BYTE&&(u=a.RG8I),n===a.SHORT&&(u=a.RG16I),n===a.INT&&(u=a.RG32I)),e===a.RG_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.RG8UI),n===a.UNSIGNED_SHORT&&(u=a.RG16UI),n===a.UNSIGNED_INT&&(u=a.RG32UI),n===a.BYTE&&(u=a.RG8I),n===a.SHORT&&(u=a.RG16I),n===a.INT&&(u=a.RG32I)),e===a.RGB){const d=i?My:qe.getTransfer(s);n===a.FLOAT&&(u=a.RGB32F),n===a.HALF_FLOAT&&(u=a.RGB16F),n===a.UNSIGNED_BYTE&&(u=a.RGB8),n===a.UNSIGNED_SHORT&&(u=a.RGB16),n===a.UNSIGNED_INT&&(u=a.RGB32UI),n===a.BYTE&&(u=a.RGB8I),n===a.SHORT&&(u=a.RGB16I),n===a.INT&&(u=a.RGB32I),n===a.UNSIGNED_BYTE&&(u=d===ye?a.SRGB8:a.RGB8),n===a.UNSIGNED_SHORT_5_6_5&&(u=a.RGB565),n===a.UNSIGNED_SHORT_5_5_5_1&&(u=a.RGB5_A1),n===a.UNSIGNED_SHORT_4_4_4_4&&(u=a.RGB4),n===a.UNSIGNED_INT_5_9_9_9_REV&&(u=a.RGB9_E5),n===a.UNSIGNED_INT_10F_11F_11F_REV&&(u=a.R11F_G11F_B10F)}if(e===a.RGB_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.RGB8UI),n===a.UNSIGNED_SHORT&&(u=a.RGB16UI),n===a.UNSIGNED_INT&&(u=a.RGB32UI),n===a.BYTE&&(u=a.RGB8I),n===a.SHORT&&(u=a.RGB16I),n===a.INT&&(u=a.RGB32I)),e===a.RGBA){const d=i?My:qe.getTransfer(s);n===a.FLOAT&&(u=a.RGBA32F),n===a.HALF_FLOAT&&(u=a.RGBA16F),n===a.UNSIGNED_BYTE&&(u=a.RGBA8),n===a.UNSIGNED_SHORT&&(u=a.RGBA16),n===a.UNSIGNED_INT&&(u=a.RGBA32UI),n===a.BYTE&&(u=a.RGBA8I),n===a.SHORT&&(u=a.RGBA16I),n===a.INT&&(u=a.RGBA32I),n===a.UNSIGNED_BYTE&&(u=d===ye?a.SRGB8_ALPHA8:a.RGBA8),n===a.UNSIGNED_SHORT_4_4_4_4&&(u=a.RGBA4),n===a.UNSIGNED_SHORT_5_5_5_1&&(u=a.RGB5_A1)}return e===a.RGBA_INTEGER&&(n===a.UNSIGNED_BYTE&&(u=a.RGBA8UI),n===a.UNSIGNED_SHORT&&(u=a.RGBA16UI),n===a.UNSIGNED_INT&&(u=a.RGBA32UI),n===a.BYTE&&(u=a.RGBA8I),n===a.SHORT&&(u=a.RGBA16I),n===a.INT&&(u=a.RGBA32I)),e===a.DEPTH_COMPONENT&&(n===a.UNSIGNED_SHORT&&(u=a.DEPTH_COMPONENT16),n===a.UNSIGNED_INT&&(u=a.DEPTH_COMPONENT24),n===a.FLOAT&&(u=a.DEPTH_COMPONENT32F)),e===a.DEPTH_STENCIL&&n===a.UNSIGNED_INT_24_8&&(u=a.DEPTH24_STENCIL8),(u===a.R16F||u===a.R32F||u===a.RG16F||u===a.RG32F||u===a.RGBA16F||u===a.RGBA32F)&&c.get("EXT_color_buffer_float"),u}setTextureParameters(t,e){const{gl:n,extensions:s,backend:i}=this,a=qe.getPrimaries(qe.workingColorSpace),c=e.colorSpace===_c?null:qe.getPrimaries(e.colorSpace),u=e.colorSpace===_c||a===c?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,e.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,u),n.texParameteri(t,n.TEXTURE_WRAP_S,hg[e.wrapS]),n.texParameteri(t,n.TEXTURE_WRAP_T,hg[e.wrapT]),(t===n.TEXTURE_3D||t===n.TEXTURE_2D_ARRAY)&&(e.isArrayTexture||n.texParameteri(t,n.TEXTURE_WRAP_R,hg[e.wrapR])),n.texParameteri(t,n.TEXTURE_MAG_FILTER,o2[e.magFilter]);const d=e.mipmaps!==void 0&&e.mipmaps.length>0,f=e.minFilter===qs&&d?Jo:e.minFilter;if(n.texParameteri(t,n.TEXTURE_MIN_FILTER,o2[f]),e.compareFunction&&(n.texParameteri(t,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(t,n.TEXTURE_COMPARE_FUNC,oE[e.compareFunction])),s.has("EXT_texture_filter_anisotropic")===!0){if(e.magFilter===ts||e.minFilter!==Ep&&e.minFilter!==Jo||e.type===Ri&&s.has("OES_texture_float_linear")===!1)return;if(e.anisotropy>1){const p=s.get("EXT_texture_filter_anisotropic");n.texParameterf(t,p.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,i.getMaxAnisotropy()))}}}createDefaultTexture(t){const{gl:e,backend:n,defaultTextures:s}=this,i=this.getGLTextureType(t);let a=s[i];a===void 0&&(a=e.createTexture(),n.state.bindTexture(i,a),e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(i,e.TEXTURE_MAG_FILTER,e.NEAREST),s[i]=a),n.set(t,{textureGPU:a,glTextureType:i})}createTexture(t,e){const{gl:n,backend:s}=this,{levels:i,width:a,height:c,depth:u}=e,d=s.utils.convert(t.format,t.colorSpace),f=s.utils.convert(t.type),p=this.getInternalFormat(t.internalFormat,d,f,t.colorSpace,t.isVideoTexture),g=n.createTexture(),y=this.getGLTextureType(t);s.state.bindTexture(y,g),this.setTextureParameters(y,t),t.isArrayTexture||t.isDataArrayTexture||t.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,i,p,a,c,u):t.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,i,p,a,c,u):t.isVideoTexture||n.texStorage2D(y,i,p,a,c),s.set(t,{textureGPU:g,glTextureType:y,glFormat:d,glType:f,glInternalFormat:p})}copyBufferToTexture(t,e){const{gl:n,backend:s}=this,{textureGPU:i,glTextureType:a,glFormat:c,glType:u}=s.get(e),{width:d,height:f}=e.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,t),s.state.bindTexture(a,i),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(a,0,0,0,d,f,c,u,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),s.state.unbindTexture()}updateTexture(t,e){const{gl:n}=this,{width:s,height:i}=e,{textureGPU:a,glTextureType:c,glFormat:u,glType:d,glInternalFormat:f}=this.backend.get(t);if(!(t.isRenderTargetTexture||a===void 0))if(this.backend.state.bindTexture(c,a),this.setTextureParameters(c,t),t.isCompressedTexture){const p=t.mipmaps,g=e.image;for(let y=0;y<p.length;y++){const x=p[y];t.isCompressedArrayTexture?t.format!==n.RGBA?u!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,x.width,x.height,g.depth,u,x.data):Wt("WebGLBackend: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,y,0,0,0,x.width,x.height,g.depth,u,d,x.data):u!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,y,0,0,x.width,x.height,u,x.data):Wt("WebGLBackend: Unsupported compressed texture format")}}else if(t.isCubeTexture){const p=e.images,g=t.mipmaps;for(let y=0;y<6;y++){const x=dg(p[y]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+y,0,0,0,s,i,u,d,x);for(let S=0;S<g.length;S++){const T=g[S],M=dg(T.images[y]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+y,S+1,0,0,M.width,M.height,u,d,M)}}}else if(t.isDataArrayTexture||t.isArrayTexture){const p=e.image;if(t.layerUpdates.size>0){const g=Q8(p.width,p.height,t.format,t.type);for(const y of t.layerUpdates){const x=p.data.subarray(y*g/p.data.BYTES_PER_ELEMENT,(y+1)*g/p.data.BYTES_PER_ELEMENT);n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,y,p.width,p.height,1,u,d,x)}t.clearLayerUpdates()}else n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,p.width,p.height,p.depth,u,d,p.data)}else if(t.isData3DTexture){const p=e.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,p.width,p.height,p.depth,u,d,p.data)}else if(t.isVideoTexture)t.update(),n.texImage2D(c,0,f,u,d,e.image);else{const p=t.mipmaps;if(p.length>0)for(let g=0,y=p.length;g<y;g++){const x=p[g],S=dg(x);n.texSubImage2D(c,g,0,0,x.width,x.height,u,d,S)}else{const g=dg(e.image);n.texSubImage2D(c,0,0,0,s,i,u,d,g)}}}generateMipmaps(t){const{gl:e,backend:n}=this,{textureGPU:s,glTextureType:i}=n.get(t);n.state.bindTexture(i,s),e.generateMipmap(i)}deallocateRenderBuffers(t){const{gl:e,backend:n}=this;if(t){const s=n.get(t);if(s.renderBufferStorageSetup=void 0,s.framebuffers){for(const i in s.framebuffers)e.deleteFramebuffer(s.framebuffers[i]);delete s.framebuffers}if(s.depthRenderbuffer&&(e.deleteRenderbuffer(s.depthRenderbuffer),delete s.depthRenderbuffer),s.stencilRenderbuffer&&(e.deleteRenderbuffer(s.stencilRenderbuffer),delete s.stencilRenderbuffer),s.msaaFrameBuffer&&(e.deleteFramebuffer(s.msaaFrameBuffer),delete s.msaaFrameBuffer),s.msaaRenderbuffers){for(let i=0;i<s.msaaRenderbuffers.length;i++)e.deleteRenderbuffer(s.msaaRenderbuffers[i]);delete s.msaaRenderbuffers}}}destroyTexture(t,e=!1){const{gl:n,backend:s}=this,{textureGPU:i,renderTarget:a}=s.get(t);this.deallocateRenderBuffers(a),e===!1&&n.deleteTexture(i),s.delete(t)}copyTextureToTexture(t,e,n=null,s=null,i=0,a=0){const{gl:c,backend:u}=this,{state:d}=this.backend,{textureGPU:f,glTextureType:p,glType:g,glFormat:y}=u.get(e);d.bindTexture(p,f);let x,S,T,M,N,v,A,R,F;const D=t.isCompressedTexture?t.mipmaps[a]:t.image;if(n!==null)x=n.max.x-n.min.x,S=n.max.y-n.min.y,T=n.isBox3?n.max.z-n.min.z:1,M=n.min.x,N=n.min.y,v=n.isBox3?n.min.z:0;else{const ft=Math.pow(2,-i);x=Math.floor(D.width*ft),S=Math.floor(D.height*ft),t.isDataArrayTexture||t.isArrayTexture?T=D.depth:t.isData3DTexture?T=Math.floor(D.depth*ft):T=1,M=0,N=0,v=0}s!==null?(A=s.x,R=s.y,F=s.z):(A=0,R=0,F=0),c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,e.flipY),c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),c.pixelStorei(c.UNPACK_ALIGNMENT,e.unpackAlignment);const O=c.getParameter(c.UNPACK_ROW_LENGTH),B=c.getParameter(c.UNPACK_IMAGE_HEIGHT),z=c.getParameter(c.UNPACK_SKIP_PIXELS),tt=c.getParameter(c.UNPACK_SKIP_ROWS),j=c.getParameter(c.UNPACK_SKIP_IMAGES);c.pixelStorei(c.UNPACK_ROW_LENGTH,D.width),c.pixelStorei(c.UNPACK_IMAGE_HEIGHT,D.height),c.pixelStorei(c.UNPACK_SKIP_PIXELS,M),c.pixelStorei(c.UNPACK_SKIP_ROWS,N),c.pixelStorei(c.UNPACK_SKIP_IMAGES,v);const dt=t.isDataArrayTexture||t.isData3DTexture||e.isArrayTexture,wt=e.isDataArrayTexture||e.isData3DTexture||e.isArrayTexture;if(t.isDepthTexture){const ft=u.get(t),U=u.get(e),K=u.get(ft.renderTarget),nt=u.get(U.renderTarget),ht=K.framebuffers[ft.cacheKey],_t=nt.framebuffers[U.cacheKey];d.bindFramebuffer(c.READ_FRAMEBUFFER,ht),d.bindFramebuffer(c.DRAW_FRAMEBUFFER,_t);for(let P=0;P<T;P++)dt&&(c.framebufferTextureLayer(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,ft.textureGPU,i,v+P),c.framebufferTextureLayer(c.DRAW_FRAMEBUFFER,c.COLOR_ATTACHMENT0,f,a,F+P)),c.blitFramebuffer(M,N,x,S,A,R,x,S,c.DEPTH_BUFFER_BIT,c.NEAREST);d.bindFramebuffer(c.READ_FRAMEBUFFER,null),d.bindFramebuffer(c.DRAW_FRAMEBUFFER,null)}else if(i!==0||t.isRenderTargetTexture||u.has(t)){const ft=u.get(t);this._srcFramebuffer===null&&(this._srcFramebuffer=c.createFramebuffer()),this._dstFramebuffer===null&&(this._dstFramebuffer=c.createFramebuffer()),d.bindFramebuffer(c.READ_FRAMEBUFFER,this._srcFramebuffer),d.bindFramebuffer(c.DRAW_FRAMEBUFFER,this._dstFramebuffer);for(let U=0;U<T;U++)dt?c.framebufferTextureLayer(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,ft.textureGPU,i,v+U):c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,ft.textureGPU,i),wt?c.framebufferTextureLayer(c.DRAW_FRAMEBUFFER,c.COLOR_ATTACHMENT0,f,a,F+U):c.framebufferTexture2D(c.DRAW_FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,f,a),i!==0?c.blitFramebuffer(M,N,x,S,A,R,x,S,c.COLOR_BUFFER_BIT,c.NEAREST):wt?c.copyTexSubImage3D(p,a,A,R,F+U,M,N,x,S):c.copyTexSubImage2D(p,a,A,R,M,N,x,S);d.bindFramebuffer(c.READ_FRAMEBUFFER,null),d.bindFramebuffer(c.DRAW_FRAMEBUFFER,null)}else wt?t.isDataTexture||t.isData3DTexture?c.texSubImage3D(p,a,A,R,F,x,S,T,y,g,D.data):e.isCompressedArrayTexture?c.compressedTexSubImage3D(p,a,A,R,F,x,S,T,y,D.data):c.texSubImage3D(p,a,A,R,F,x,S,T,y,g,D):t.isDataTexture?c.texSubImage2D(c.TEXTURE_2D,a,A,R,x,S,y,g,D.data):t.isCompressedTexture?c.compressedTexSubImage2D(c.TEXTURE_2D,a,A,R,D.width,D.height,y,D.data):c.texSubImage2D(c.TEXTURE_2D,a,A,R,x,S,y,g,D);c.pixelStorei(c.UNPACK_ROW_LENGTH,O),c.pixelStorei(c.UNPACK_IMAGE_HEIGHT,B),c.pixelStorei(c.UNPACK_SKIP_PIXELS,z),c.pixelStorei(c.UNPACK_SKIP_ROWS,tt),c.pixelStorei(c.UNPACK_SKIP_IMAGES,j),a===0&&e.generateMipmaps&&c.generateMipmap(p),d.unbindTexture()}copyFramebufferToTexture(t,e,n){const{gl:s}=this,{state:i}=this.backend,{textureGPU:a}=this.backend.get(t),{x:c,y:u,z:d,w:f}=n,p=t.isDepthTexture===!0||e.renderTarget&&e.renderTarget.samples>0,g=e.renderTarget?e.renderTarget.height:this.backend.getDrawingBufferSize().y;if(p){const y=c!==0||u!==0;let x,S;if(t.isDepthTexture===!0?(x=s.DEPTH_BUFFER_BIT,S=s.DEPTH_ATTACHMENT,e.stencil&&(x|=s.STENCIL_BUFFER_BIT)):(x=s.COLOR_BUFFER_BIT,S=s.COLOR_ATTACHMENT0),y){const T=this.backend.get(e.renderTarget),M=T.framebuffers[e.getCacheKey()],N=T.msaaFrameBuffer;i.bindFramebuffer(s.DRAW_FRAMEBUFFER,M),i.bindFramebuffer(s.READ_FRAMEBUFFER,N);const v=g-u-f;s.blitFramebuffer(c,v,c+d,v+f,c,v,c+d,v+f,x,s.NEAREST),i.bindFramebuffer(s.READ_FRAMEBUFFER,M),i.bindTexture(s.TEXTURE_2D,a),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,c,v,d,f),i.unbindTexture()}else{const T=s.createFramebuffer();i.bindFramebuffer(s.DRAW_FRAMEBUFFER,T),s.framebufferTexture2D(s.DRAW_FRAMEBUFFER,S,s.TEXTURE_2D,a,0),s.blitFramebuffer(0,0,d,f,0,0,d,f,x,s.NEAREST),s.deleteFramebuffer(T)}}else i.bindTexture(s.TEXTURE_2D,a),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,c,g-f-u,d,f),i.unbindTexture();t.generateMipmaps&&this.generateMipmaps(t),this.backend._setFramebuffer(e)}setupRenderBufferStorage(t,e,n,s=!1){const{gl:i}=this,a=e.renderTarget,{depthTexture:c,depthBuffer:u,stencilBuffer:d,width:f,height:p}=a;if(i.bindRenderbuffer(i.RENDERBUFFER,t),u&&!d){let g=i.DEPTH_COMPONENT24;s===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(i.RENDERBUFFER,a.samples,g,f,p):n>0?(c&&c.isDepthTexture&&c.type===i.FLOAT&&(g=i.DEPTH_COMPONENT32F),i.renderbufferStorageMultisample(i.RENDERBUFFER,n,g,f,p)):i.renderbufferStorage(i.RENDERBUFFER,g,f,p),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,t)}else u&&d&&(n>0?i.renderbufferStorageMultisample(i.RENDERBUFFER,n,i.DEPTH24_STENCIL8,f,p):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,f,p),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,t));i.bindRenderbuffer(i.RENDERBUFFER,null)}async copyTextureToBuffer(t,e,n,s,i,a){const{backend:c,gl:u}=this,{textureGPU:d,glFormat:f,glType:p}=this.backend.get(t),g=u.createFramebuffer();c.state.bindFramebuffer(u.READ_FRAMEBUFFER,g);const y=t.isCubeTexture?u.TEXTURE_CUBE_MAP_POSITIVE_X+a:u.TEXTURE_2D;u.framebufferTexture2D(u.READ_FRAMEBUFFER,u.COLOR_ATTACHMENT0,y,d,0);const x=this._getTypedArrayType(p),S=this._getBytesPerTexel(p,f),M=s*i*S,N=u.createBuffer();u.bindBuffer(u.PIXEL_PACK_BUFFER,N),u.bufferData(u.PIXEL_PACK_BUFFER,M,u.STREAM_READ),u.readPixels(e,n,s,i,f,p,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),await c.utils._clientWaitAsync();const v=new x(M/x.BYTES_PER_ELEMENT);return u.bindBuffer(u.PIXEL_PACK_BUFFER,N),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,v),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c.state.bindFramebuffer(u.READ_FRAMEBUFFER,null),u.deleteFramebuffer(g),v}_getTypedArrayType(t){const{gl:e}=this;if(t===e.UNSIGNED_BYTE)return Uint8Array;if(t===e.UNSIGNED_SHORT_4_4_4_4||t===e.UNSIGNED_SHORT_5_5_5_1||t===e.UNSIGNED_SHORT_5_6_5||t===e.UNSIGNED_SHORT)return Uint16Array;if(t===e.UNSIGNED_INT)return Uint32Array;if(t===e.HALF_FLOAT)return Uint16Array;if(t===e.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${t}`)}_getBytesPerTexel(t,e){const{gl:n}=this;let s=0;if(t===n.UNSIGNED_BYTE&&(s=1),(t===n.UNSIGNED_SHORT_4_4_4_4||t===n.UNSIGNED_SHORT_5_5_5_1||t===n.UNSIGNED_SHORT_5_6_5||t===n.UNSIGNED_SHORT||t===n.HALF_FLOAT)&&(s=2),(t===n.UNSIGNED_INT||t===n.FLOAT)&&(s=4),e===n.RGBA)return s*4;if(e===n.RGB)return s*3;if(e===n.ALPHA)return s}dispose(){const{gl:t}=this;this._srcFramebuffer!==null&&t.deleteFramebuffer(this._srcFramebuffer),this._dstFramebuffer!==null&&t.deleteFramebuffer(this._dstFramebuffer)}}function dg(r){return r.isDataTexture?r.image.data:typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas?r:r.data}class GW{constructor(t){this.backend=t,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(t){let e=this.extensions[t];return e===void 0&&(e=this.gl.getExtension(t),this.extensions[t]=e),e}has(t){return this.availableExtensions.includes(t)}}class kW{constructor(t){this.backend=t,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const t=this.backend.gl,e=this.backend.extensions;if(e.has("EXT_texture_filter_anisotropic")===!0){const n=e.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const aE={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-s3tc",EXT_texture_compression_bptc:"texture-compression-bc",EXT_disjoint_timer_query_webgl2:"timestamp-query",OVR_multiview2:"OVR_multiview2"};class HW{constructor(t){this.gl=t.gl,this.extensions=t.extensions,this.info=t.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(t,e){const{gl:n,mode:s,object:i,type:a,info:c,index:u}=this;u!==0?n.drawElements(s,e,a,t):n.drawArrays(s,t,e),c.update(i,e,1)}renderInstances(t,e,n){const{gl:s,mode:i,type:a,index:c,object:u,info:d}=this;n!==0&&(c!==0?s.drawElementsInstanced(i,e,a,t,n):s.drawArraysInstanced(i,t,e,n),d.update(u,e,n))}renderMultiDraw(t,e,n){const{extensions:s,mode:i,object:a,info:c}=this;if(n===0)return;const u=s.get("WEBGL_multi_draw");if(u===null)for(let d=0;d<n;d++)this.render(t[d],e[d]);else{this.index!==0?u.multiDrawElementsWEBGL(i,e,0,this.type,t,0,n):u.multiDrawArraysWEBGL(i,t,0,e,0,n);let d=0;for(let f=0;f<n;f++)d+=e[f];c.update(a,d,1)}}renderMultiDrawInstances(t,e,n,s){const{extensions:i,mode:a,object:c,info:u}=this;if(n===0)return;const d=i.get("WEBGL_multi_draw");if(d===null)for(let f=0;f<n;f++)this.renderInstances(t[f],e[f],s[f]);else{this.index!==0?d.multiDrawElementsInstancedWEBGL(a,e,0,this.type,t,0,s,0,n):d.multiDrawArraysInstancedWEBGL(a,t,0,e,0,s,0,n);let f=0;for(let p=0;p<n;p++)f+=e[p]*s[p];u.update(c,f,1)}}}class YD{constructor(t=256){this.trackTimestamp=!0,this.maxQueries=t,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.frames=[],this.pendingResolve=!1,this.timestamps=new Map}getTimestampFrames(){return this.frames}getTimestamp(t){let e=this.timestamps.get(t);return e===void 0&&(Wt(`TimestampQueryPool: No timestamp available for uid ${t}.`),e=0),e}hasTimestamp(t){return this.timestamps.has(t)}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class WW extends YD{constructor(t,e,n=2048){if(super(n),this.gl=t,this.type=e,this.ext=t.getExtension("EXT_disjoint_timer_query_webgl2")||t.getExtension("EXT_disjoint_timer_query"),!this.ext){Wt("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let s=0;s<this.maxQueries;s++)this.queries.push(t.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(t){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return rn(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const e=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(e,"inactive"),this.queryOffsets.set(t,e),e}beginQuery(t){if(!this.trackTimestamp||this.isDisposed)return;const e=this.queryOffsets.get(t);if(e==null||this.activeQuery!==null)return;const n=this.queries[e];if(n)try{this.queryStates.get(e)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=e,this.queryStates.set(e,"started"))}catch(s){Ht("Error in beginQuery:",s),this.activeQuery=null,this.queryStates.set(e,"inactive")}}endQuery(t){if(!this.trackTimestamp||this.isDisposed)return;const e=this.queryOffsets.get(t);if(e!=null&&this.activeQuery===e)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(e,"ended"),this.activeQuery=null}catch(n){Ht("Error in endQuery:",n),this.queryStates.set(e,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const t=new Map;for(const[i,a]of this.queryOffsets)if(this.queryStates.get(a)==="ended"){const u=this.queries[a];t.set(i,this.resolveQuery(u))}if(t.size===0)return this.lastValue;const e={},n=[];for(const[i,a]of t){const c=i.match(/^(.*):f(\d+)$/),u=parseInt(c[2]);n.includes(u)===!1&&n.push(u),e[u]===void 0&&(e[u]=0);const d=await a;this.timestamps.set(i,d),e[u]+=d}const s=e[n[n.length-1]];return this.lastValue=s,this.frames=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,s}catch(t){return Ht("Error resolving queries:",t),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(t){return new Promise(e=>{if(this.isDisposed){e(this.lastValue);return}let n,s=!1;const i=()=>{n&&(clearTimeout(n),n=null)},a=u=>{s||(s=!0,i(),e(u))},c=()=>{if(this.isDisposed){a(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){a(this.lastValue);return}if(!this.gl.getQueryParameter(t,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(c,1);return}const f=this.gl.getQueryParameter(t,this.gl.QUERY_RESULT);e(Number(f)/1e6)}catch(u){Ht("Error checking query:",u),e(this.lastValue)}};c()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const t of this.queries)this.gl.deleteQuery(t);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class lE extends jD{constructor(t={}){super(t),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(t){super.init(t);const e=this.parameters,n={antialias:t.currentSamples>0,alpha:!0,depth:t.depth,stencil:t.stencil},s=e.context!==void 0?e.context:t.domElement.getContext("webgl2",n);function i(a){a.preventDefault();const c={api:"WebGL",message:a.statusMessage||"Unknown reason",reason:null,originalEvent:a};t.onDeviceLost(c)}this._onContextLost=i,t.domElement.addEventListener("webglcontextlost",i,!1),this.gl=s,this.extensions=new GW(this),this.capabilities=new kW(this),this.attributeUtils=new PW(this),this.textureUtils=new VW(this),this.bufferRenderer=new HW(this),this.state=new zW(this),this.utils=new IW(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.extensions.get("OVR_multiview2"),this.extensions.get("EXT_clip_control"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this.drawBuffersIndexedExt=this.extensions.get("OES_draw_buffers_indexed"),e.reversedDepthBuffer===!0&&this.extensions.has("EXT_clip_control")&&this.state.setReversedDepth(!0)}get coordinateSystem(){return wr}async getArrayBufferAsync(t){return await this.attributeUtils.getArrayBufferAsync(t)}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(t){this._xrFramebuffer=t}setXRRenderTargetTextures(t,e,n=null){const s=this.gl;if(this.set(t.texture,{textureGPU:e,glInternalFormat:s.RGBA8}),n!==null){const i=t.stencilBuffer?s.DEPTH24_STENCIL8:s.DEPTH_COMPONENT24;this.set(t.depthTexture,{textureGPU:n,glInternalFormat:i}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&t._autoAllocateDepthBuffer===!0&&t.multiview===!1&&Wt("WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),t._autoAllocateDepthBuffer=!1}}initTimestampQuery(t,e){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new WW(this.gl,t,2048));const n=this.timestampQueryPool[t];n.allocateQueriesForContext(e)!==null&&n.beginQuery(e)}prepareTimestampBuffer(t,e){if(!this.disjoint||!this.trackTimestamp)return;this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(t){const{state:e}=this,n=this.get(t);if(t.viewport)this.updateViewport(t);else{const{width:i,height:a}=this.getDrawingBufferSize();e.viewport(0,0,i,a)}if(t.scissor)this.updateScissor(t);else{const{width:i,height:a}=this.getDrawingBufferSize();e.scissor(0,0,i,a)}this.initTimestampQuery(Yo.RENDER,this.getTimestampUID(t)),n.previousContext=this._currentContext,this._currentContext=t,this._setFramebuffer(t),this.clear(t.clearColor,t.clearDepth,t.clearStencil,t,!1);const s=t.occlusionQueryCount;s>0&&(n.currentOcclusionQueries=n.occlusionQueries,n.currentOcclusionQueryObjects=n.occlusionQueryObjects,n.lastOcclusionObject=null,n.occlusionQueries=new Array(s),n.occlusionQueryObjects=new Array(s),n.occlusionQueryIndex=0)}finishRender(t){const{gl:e,state:n}=this,s=this.get(t),i=s.previousContext;n.resetVertexState();const a=t.occlusionQueryCount;a>0&&(a>s.occlusionQueryIndex&&e.endQuery(e.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(t));const c=t.textures;if(c!==null)for(let u=0;u<c.length;u++){const d=c[u];d.generateMipmaps&&this.generateMipmaps(d)}if(this._currentContext=i,this._resolveRenderTarget(t),i!==null){if(this._setFramebuffer(i),i.viewport)this.updateViewport(i);else{const{width:u,height:d}=this.getDrawingBufferSize();n.viewport(0,0,u,d)}if(i.scissor)this.updateScissor(i);else{const{width:u,height:d}=this.getDrawingBufferSize();n.scissor(0,0,u,d)}}this.prepareTimestampBuffer(Yo.RENDER,this.getTimestampUID(t))}resolveOccludedAsync(t){const e=this.get(t),{currentOcclusionQueries:n,currentOcclusionQueryObjects:s}=e;if(n&&s){const i=new WeakSet,{gl:a}=this;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueries=null;const c=()=>{let u=0;for(let d=0;d<n.length;d++){const f=n[d];f!==null&&a.getQueryParameter(f,a.QUERY_RESULT_AVAILABLE)&&(a.getQueryParameter(f,a.QUERY_RESULT)===0&&i.add(s[d]),n[d]=null,a.deleteQuery(f),u++)}u<n.length?requestAnimationFrame(c):e.occluded=i};c()}}isOccluded(t,e){const n=this.get(t);return n.occluded&&n.occluded.has(e)}updateViewport(t){const{state:e}=this,{x:n,y:s,width:i,height:a}=t.viewportValue;e.viewport(n,t.height-a-s,i,a)}updateScissor(t){const{state:e}=this,{x:n,y:s,width:i,height:a}=t.scissorValue;e.scissor(n,t.height-a-s,i,a)}setScissorTest(t){this.state.setScissorTest(t)}getClearColor(){const t=super.getClearColor();return t.r*=t.a,t.g*=t.a,t.b*=t.a,t}clear(t,e,n,s=null,i=!0,a=!0){const{gl:c,renderer:u}=this;s===null&&(s={textures:null,clearColorValue:this.getClearColor()});let d=0;if(t&&(d|=c.COLOR_BUFFER_BIT),e&&(d|=c.DEPTH_BUFFER_BIT),n&&(d|=c.STENCIL_BUFFER_BIT),d!==0){let f;s.clearColorValue?f=s.clearColorValue:f=this.getClearColor();const p=u.getClearDepth(),g=u.getClearStencil();if(e&&this.state.setDepthMask(!0),s.textures===null)c.clearColor(f.r,f.g,f.b,f.a),c.clear(d);else{if(i&&this._setFramebuffer(s),t)for(let y=0;y<s.textures.length;y++)y===0?c.clearBufferfv(c.COLOR,y,[f.r,f.g,f.b,f.a]):c.clearBufferfv(c.COLOR,y,[0,0,0,1]);e&&n?c.clearBufferfi(c.DEPTH_STENCIL,0,p,g):e?c.clearBufferfv(c.DEPTH,0,[p]):n&&c.clearBufferiv(c.STENCIL,0,[g]),i&&a&&this._resolveRenderTarget(s)}}}beginCompute(t){const{state:e,gl:n}=this;e.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(Yo.COMPUTE,this.getTimestampUID(t))}compute(t,e,n,s,i=null){const{state:a,gl:c}=this;this.discard===!1&&(a.enable(c.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:u,transformBuffers:d,attributes:f}=this.get(s),p=this._getVaoKey(f),g=this.vaoCache[p];g===void 0?this.vaoCache[p]=this._createVao(f):a.setVertexState(g),a.useProgram(u),this._bindUniforms(n);const y=this._getTransformFeedback(d);c.bindTransformFeedback(c.TRANSFORM_FEEDBACK,y),c.beginTransformFeedback(c.POINTS),i=i!==null?i:e.count,Array.isArray(i)?(rn("WebGLBackend.compute(): The count parameter must be a single number, not an array."),i=i[0]):i&&typeof i=="object"&&i.isIndirectStorageBufferAttribute&&(rn("WebGLBackend.compute(): The count parameter must be a single number, not IndirectStorageBufferAttribute"),i=e.count),f[0].isStorageInstancedBufferAttribute?c.drawArraysInstanced(c.POINTS,0,1,i):c.drawArrays(c.POINTS,0,i),c.endTransformFeedback(),c.bindTransformFeedback(c.TRANSFORM_FEEDBACK,null);for(let x=0;x<d.length;x++){const S=d[x];S.pbo&&this.has(S.pbo)&&this.textureUtils.copyBufferToTexture(S.transformBuffer,S.pbo),S.switchBuffers()}}finishCompute(t){const{state:e,gl:n}=this;this.discard=!1,e.disable(n.RASTERIZER_DISCARD),this.prepareTimestampBuffer(Yo.COMPUTE,this.getTimestampUID(t)),this._currentContext&&this._setFramebuffer(this._currentContext)}_isRenderCameraDepthArray(t){return t.depthTexture&&t.depthTexture.isArrayTexture&&t.camera.isArrayCamera}draw(t){const{object:e,pipeline:n,material:s,context:i,hardwareClippingPlanes:a}=t,{programGPU:c}=this.get(n),{gl:u,state:d}=this,f=this.get(i),p=t.getDrawParameters();if(p===null)return;this._bindUniforms(t.getBindings());const g=e.isMesh&&e.matrixWorld.determinant()<0;d.setMaterial(s,g,a),i.mrt!==null&&i.textures!==null&&d.setMRTBlending(i.textures,i.mrt,s),d.useProgram(c);const y=t.getAttributes(),x=this.get(y);let S=x.vaoGPU;if(S===void 0){const O=this._getVaoKey(y);S=this.vaoCache[O],S===void 0&&(S=this._createVao(y),this.vaoCache[O]=S,x.vaoGPU=S)}const T=t.getIndex(),M=T!==null?this.get(T).bufferGPU:null;d.setVertexState(S,M);const N=f.lastOcclusionObject;if(N!==e&&N!==void 0){if(N!==null&&N.occlusionTest===!0&&(u.endQuery(u.ANY_SAMPLES_PASSED),f.occlusionQueryIndex++),e.occlusionTest===!0){const O=u.createQuery();u.beginQuery(u.ANY_SAMPLES_PASSED,O),f.occlusionQueries[f.occlusionQueryIndex]=O,f.occlusionQueryObjects[f.occlusionQueryIndex]=e}f.lastOcclusionObject=e}const v=this.bufferRenderer;e.isPoints?v.mode=u.POINTS:e.isLineSegments?v.mode=u.LINES:e.isLine?v.mode=u.LINE_STRIP:e.isLineLoop?v.mode=u.LINE_LOOP:s.wireframe===!0?(d.setLineWidth(s.wireframeLinewidth*this.renderer.getPixelRatio()),v.mode=u.LINES):v.mode=u.TRIANGLES;const{vertexCount:A,instanceCount:R}=p;let{firstVertex:F}=p;if(v.object=e,T!==null){F*=T.array.BYTES_PER_ELEMENT;const O=this.get(T);v.index=T.count,v.type=O.type}else v.index=0;const D=()=>{e.isBatchedMesh?e._multiDrawInstances!==null?(rn("WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),v.renderMultiDrawInstances(e._multiDrawStarts,e._multiDrawCounts,e._multiDrawCount,e._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?v.renderMultiDraw(e._multiDrawStarts,e._multiDrawCounts,e._multiDrawCount):rn("WebGLBackend: WEBGL_multi_draw not supported."):R>1?v.renderInstances(F,A,R):v.render(F,A)};if(t.camera.isArrayCamera===!0&&t.camera.cameras.length>0&&t.camera.isMultiViewCamera===!1){const O=this.get(t.camera),B=t.camera.cameras,z=t.getBindingGroup("cameraIndex").bindings[0];if(O.indexesGPU===void 0||O.indexesGPU.length!==B.length){const U=new Uint32Array([0,0,0,0]),K=[];for(let nt=0,ht=B.length;nt<ht;nt++){const _t=u.createBuffer();U[0]=nt,u.bindBuffer(u.UNIFORM_BUFFER,_t),u.bufferData(u.UNIFORM_BUFFER,U,u.STATIC_DRAW),K.push(_t)}O.indexesGPU=K}const tt=this.get(z),j=this.renderer.getPixelRatio(),dt=this._currentContext.renderTarget,wt=this._isRenderCameraDepthArray(this._currentContext),ft=this._currentContext.activeCubeFace;if(wt){const U=this.get(dt.depthTexture);if(U.clearedRenderId!==this.renderer._nodes.nodeFrame.renderId){U.clearedRenderId=this.renderer._nodes.nodeFrame.renderId;const{stencilBuffer:K}=dt;for(let nt=0,ht=B.length;nt<ht;nt++)this.renderer._activeCubeFace=nt,this._currentContext.activeCubeFace=nt,this._setFramebuffer(this._currentContext),this.clear(!1,!0,K,this._currentContext,!1,!1);this.renderer._activeCubeFace=ft,this._currentContext.activeCubeFace=ft}}for(let U=0,K=B.length;U<K;U++){const nt=B[U];if(e.layers.test(nt.layers)){wt&&(this.renderer._activeCubeFace=U,this._currentContext.activeCubeFace=U,this._setFramebuffer(this._currentContext));const ht=nt.viewport;if(ht!==void 0){const _t=ht.x*j,P=ht.y*j,q=ht.width*j,L=ht.height*j;d.viewport(Math.floor(_t),Math.floor(t.context.height-L-P),Math.floor(q),Math.floor(L))}d.bindBufferBase(u.UNIFORM_BUFFER,tt.index,O.indexesGPU[U]),D()}this._currentContext.activeCubeFace=ft,this.renderer._activeCubeFace=ft}}else D()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(t){this.textureUtils.createDefaultTexture(t)}createTexture(t,e){this.textureUtils.createTexture(t,e)}updateTexture(t,e){this.textureUtils.updateTexture(t,e)}generateMipmaps(t){this.textureUtils.generateMipmaps(t)}destroyTexture(t,e=!1){this.textureUtils.destroyTexture(t,e)}async copyTextureToBuffer(t,e,n,s,i,a){return this.textureUtils.copyTextureToBuffer(t,e,n,s,i,a)}updateSampler(){return""}createNodeBuilder(t,e){return new OW(t,e)}createProgram(t){const e=this.gl,{stage:n,code:s}=t,i=n==="fragment"?e.createShader(e.FRAGMENT_SHADER):e.createShader(e.VERTEX_SHADER);e.shaderSource(i,s),e.compileShader(i),this.set(t,{shaderGPU:i})}destroyProgram(t){this.delete(t)}createRenderPipeline(t,e){const n=this.gl,s=t.pipeline,{fragmentProgram:i,vertexProgram:a}=s,c=n.createProgram(),u=this.get(i).shaderGPU,d=this.get(a).shaderGPU;if(n.attachShader(c,u),n.attachShader(c,d),n.linkProgram(c),this.set(s,{programGPU:c,fragmentShader:u,vertexShader:d}),e!==null&&this.parallel){const f=new Promise(p=>{const g=this.parallel,y=()=>{n.getProgramParameter(c,g.COMPLETION_STATUS_KHR)?(this._completeCompile(t,s),p()):requestAnimationFrame(y)};y()});e.push(f);return}this._completeCompile(t,s)}_handleSource(t,e){const n=t.split(`
`),s=[],i=Math.max(e-6,0),a=Math.min(e+6,n.length);for(let c=i;c<a;c++){const u=c+1;s.push(`${u===e?">":" "} ${u}: ${n[c]}`)}return s.join(`
`)}_getShaderErrors(t,e,n){const s=t.getShaderParameter(e,t.COMPILE_STATUS),a=(t.getShaderInfoLog(e)||"").trim();if(s&&a==="")return"";const c=/ERROR: 0:(\d+)/.exec(a);if(c){const u=parseInt(c[1]);return n.toUpperCase()+`

`+a+`

`+this._handleSource(t.getShaderSource(e),u)}else return a}_logProgramError(t,e,n){if(this.renderer.debug.checkShaderErrors){const s=this.gl,a=(s.getProgramInfoLog(t)||"").trim();if(s.getProgramParameter(t,s.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(s,t,n,e);else{const c=this._getShaderErrors(s,n,"vertex"),u=this._getShaderErrors(s,e,"fragment");Ht("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(t,s.VALIDATE_STATUS)+`

Program Info Log: `+a+`
`+c+`
`+u)}else a!==""&&Wt("WebGLProgram: Program Info Log:",a)}}_completeCompile(t,e){const{state:n,gl:s}=this,i=this.get(e),{programGPU:a,fragmentShader:c,vertexShader:u}=i;s.getProgramParameter(a,s.LINK_STATUS)===!1&&this._logProgramError(a,c,u),n.useProgram(a);const d=t.getBindings();this._setupBindings(d,a),this.set(e,{programGPU:a})}createComputePipeline(t,e){const{state:n,gl:s}=this,i={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(i);const{computeProgram:a}=t,c=s.createProgram(),u=this.get(i).shaderGPU,d=this.get(a).shaderGPU,f=a.transforms,p=[],g=[];for(let T=0;T<f.length;T++){const M=f[T];p.push(M.varyingName),g.push(M.attributeNode)}s.attachShader(c,u),s.attachShader(c,d),s.transformFeedbackVaryings(c,p,s.SEPARATE_ATTRIBS),s.linkProgram(c),s.getProgramParameter(c,s.LINK_STATUS)===!1&&this._logProgramError(c,u,d),n.useProgram(c),this._setupBindings(e,c);const y=a.attributes,x=[],S=[];for(let T=0;T<y.length;T++){const M=y[T].node.attribute;x.push(M),this.has(M)||this.attributeUtils.createAttribute(M,s.ARRAY_BUFFER)}for(let T=0;T<g.length;T++){const M=g[T].attribute;this.has(M)||this.attributeUtils.createAttribute(M,s.ARRAY_BUFFER);const N=this.get(M);S.push(N)}this.set(t,{programGPU:c,transformBuffers:S,attributes:x})}createBindings(t,e){if(this._knownBindings.has(e)===!1){this._knownBindings.add(e);let n=0,s=0;for(const i of e){this.set(i,{textures:s,uniformBuffers:n});for(const a of i.bindings)a.isUniformBuffer&&n++,a.isSampledTexture&&s++}}this.updateBindings(t,e)}updateBindings(t){const{gl:e}=this,n=this.get(t);let s=n.uniformBuffers,i=n.textures;for(const a of t.bindings){const c=this.get(a);if(a.isUniformsGroup||a.isUniformBuffer){const u=a.buffer;let{bufferGPU:d}=this.get(u);d===void 0?(d=e.createBuffer(),e.bindBuffer(e.UNIFORM_BUFFER,d),e.bufferData(e.UNIFORM_BUFFER,u.byteLength,e.DYNAMIC_DRAW),this.set(u,{bufferGPU:d})):e.bindBuffer(e.UNIFORM_BUFFER,d);const f=a.updateRanges;if(e.bindBuffer(e.UNIFORM_BUFFER,d),f.length===0)e.bufferData(e.UNIFORM_BUFFER,u,e.DYNAMIC_DRAW);else{const p=vy(u),g=p?1:u.BYTES_PER_ELEMENT;for(let y=0,x=f.length;y<x;y++){const S=f[y],T=S.start*g,M=S.count*g,N=T*(p?u.BYTES_PER_ELEMENT:1);e.bufferSubData(e.UNIFORM_BUFFER,N,u,T,M)}}c.index=s++,c.bufferGPU=d,this.set(a,c)}else if(a.isSampledTexture){const{textureGPU:u,glTextureType:d}=this.get(a.texture);c.index=i++,c.textureGPU=u,c.glTextureType=d,this.set(a,c)}}}updateBinding(t){const e=this.gl;if(t.isUniformsGroup||t.isUniformBuffer){const s=this.get(t).bufferGPU,i=t.buffer,a=t.updateRanges;if(e.bindBuffer(e.UNIFORM_BUFFER,s),a.length===0)e.bufferData(e.UNIFORM_BUFFER,i,e.DYNAMIC_DRAW);else{const c=vy(i),u=c?1:i.BYTES_PER_ELEMENT;for(let d=0,f=a.length;d<f;d++){const p=a[d],g=p.start*u,y=p.count*u,x=g*(c?i.BYTES_PER_ELEMENT:1);e.bufferSubData(e.UNIFORM_BUFFER,x,i,g,y)}}}}createIndexAttribute(t){const e=this.gl;this.attributeUtils.createAttribute(t,e.ELEMENT_ARRAY_BUFFER)}createAttribute(t){if(this.has(t))return;const e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}createStorageAttribute(t){if(this.has(t))return;const e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}updateAttribute(t){this.attributeUtils.updateAttribute(t)}destroyAttribute(t){this.attributeUtils.destroyAttribute(t)}hasFeature(t){const e=Object.keys(aE).filter(s=>aE[s]===t),n=this.extensions;for(let s=0;s<e.length;s++)if(n.has(e[s]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(t,e,n=null,s=null,i=0,a=0){this.textureUtils.copyTextureToTexture(t,e,n,s,i,a)}copyFramebufferToTexture(t,e,n){this.textureUtils.copyFramebufferToTexture(t,e,n)}hasCompatibility(t){return t===xc.TEXTURE_COMPARE?!0:super.hasCompatibility(t)}initRenderTarget(t){const{gl:e,state:n}=this;this._setFramebuffer(t),n.bindFramebuffer(e.FRAMEBUFFER,null)}_setFramebuffer(t){const{gl:e,state:n}=this;let s=null;if(t.textures!==null){const i=t.renderTarget,a=this.get(i),{samples:c,depthBuffer:u,stencilBuffer:d}=i,f=i.isCubeRenderTarget===!0,p=i.isRenderTarget3D===!0,g=i.depth>1,y=i.isXRRenderTarget===!0,x=y===!0&&i._hasExternalTextures===!0;let S=a.msaaFrameBuffer,T=a.depthRenderbuffer;const M=this.extensions.get("WEBGL_multisampled_render_to_texture"),N=this.extensions.get("OVR_multiview2"),v=this._useMultisampledExtension(i),A=GB(t);let R;if(f?(a.cubeFramebuffers||(a.cubeFramebuffers={}),R=a.cubeFramebuffers[A]):y&&x===!1?R=this._xrFramebuffer:(a.framebuffers||(a.framebuffers={}),R=a.framebuffers[A]),R===void 0){R=e.createFramebuffer(),n.bindFramebuffer(e.FRAMEBUFFER,R);const F=t.textures,D=[];if(f){a.cubeFramebuffers[A]=R;const{textureGPU:B}=this.get(F[0]),z=this.renderer._activeCubeFace,tt=this.renderer._activeMipmapLevel;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+z,B,tt)}else{a.framebuffers[A]=R;for(let B=0;B<F.length;B++){const z=F[B],tt=this.get(z);tt.renderTarget=t.renderTarget,tt.cacheKey=A;const j=e.COLOR_ATTACHMENT0+B;if(i.multiview)N.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,j,tt.textureGPU,0,c,0,2);else if(p||g){const dt=this.renderer._activeCubeFace,wt=this.renderer._activeMipmapLevel;e.framebufferTextureLayer(e.FRAMEBUFFER,j,tt.textureGPU,wt,dt)}else if(v)M.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,j,e.TEXTURE_2D,tt.textureGPU,0,c);else{const dt=this.renderer._activeMipmapLevel;e.framebufferTexture2D(e.FRAMEBUFFER,j,e.TEXTURE_2D,tt.textureGPU,dt)}}}const O=d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;if(i._autoAllocateDepthBuffer===!0){const B=e.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(B,t,0,v),a.xrDepthRenderbuffer=B,D.push(d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT),e.bindRenderbuffer(e.RENDERBUFFER,B),e.framebufferRenderbuffer(e.FRAMEBUFFER,O,e.RENDERBUFFER,B)}else if(t.depthTexture!==null){D.push(d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT);const B=this.get(t.depthTexture);if(B.renderTarget=t.renderTarget,B.cacheKey=A,i.multiview)N.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,O,B.textureGPU,0,c,0,2);else if(x&&v)M.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,O,e.TEXTURE_2D,B.textureGPU,0,c);else if(t.depthTexture.isArrayTexture){const z=this.renderer._activeCubeFace;e.framebufferTextureLayer(e.FRAMEBUFFER,O,B.textureGPU,0,z)}else if(t.depthTexture.isCubeTexture){const z=this.renderer._activeCubeFace;e.framebufferTexture2D(e.FRAMEBUFFER,O,e.TEXTURE_CUBE_MAP_POSITIVE_X+z,B.textureGPU,0)}else e.framebufferTexture2D(e.FRAMEBUFFER,O,e.TEXTURE_2D,B.textureGPU,0)}a.depthInvalidationArray=D}else{if(this._isRenderCameraDepthArray(t)){n.bindFramebuffer(e.FRAMEBUFFER,R);const D=this.renderer._activeCubeFace,O=this.get(t.depthTexture),B=d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;e.framebufferTextureLayer(e.FRAMEBUFFER,B,O.textureGPU,0,D)}if((y||v||i.multiview)&&i._isOpaqueFramebuffer!==!0){n.bindFramebuffer(e.FRAMEBUFFER,R);const D=this.get(t.textures[0]);i.multiview?N.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,D.textureGPU,0,c,0,2):v?M.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,D.textureGPU,0,c):e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,D.textureGPU,0);const O=d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;if(i._autoAllocateDepthBuffer===!0){const B=a.xrDepthRenderbuffer;e.bindRenderbuffer(e.RENDERBUFFER,B),e.framebufferRenderbuffer(e.FRAMEBUFFER,O,e.RENDERBUFFER,B)}else{const B=this.get(t.depthTexture);i.multiview?N.framebufferTextureMultisampleMultiviewOVR(e.FRAMEBUFFER,O,B.textureGPU,0,c,0,2):v?M.framebufferTexture2DMultisampleEXT(e.FRAMEBUFFER,O,e.TEXTURE_2D,B.textureGPU,0,c):e.framebufferTexture2D(e.FRAMEBUFFER,O,e.TEXTURE_2D,B.textureGPU,0)}}}if(c>0&&v===!1&&!i.multiview){if(S===void 0){const F=[];S=e.createFramebuffer(),n.bindFramebuffer(e.FRAMEBUFFER,S);const D=[],O=t.textures;for(let B=0;B<O.length;B++){D[B]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,D[B]),F.push(e.COLOR_ATTACHMENT0+B);const z=t.textures[B],tt=this.get(z);e.renderbufferStorageMultisample(e.RENDERBUFFER,c,tt.glInternalFormat,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+B,e.RENDERBUFFER,D[B])}if(e.bindRenderbuffer(e.RENDERBUFFER,null),a.msaaFrameBuffer=S,a.msaaRenderbuffers=D,u&&T===void 0){T=e.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(T,t,c),a.depthRenderbuffer=T;const B=d?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;F.push(B)}a.invalidationArray=F}s=a.msaaFrameBuffer}else s=R;n.drawBuffers(t,R)}n.bindFramebuffer(e.FRAMEBUFFER,s)}_getVaoKey(t){let e="";for(let n=0;n<t.length;n++){const s=this.get(t[n]);e+=":"+s.id}return e}_createVao(t){const{gl:e}=this,n=e.createVertexArray();e.bindVertexArray(n);for(let s=0;s<t.length;s++){const i=t[s],a=this.get(i);e.bindBuffer(e.ARRAY_BUFFER,a.bufferGPU),e.enableVertexAttribArray(s);let c,u;i.isInterleavedBufferAttribute===!0?(c=i.data.stride*a.bytesPerElement,u=i.offset*a.bytesPerElement):(c=0,u=0),a.isInteger?e.vertexAttribIPointer(s,i.itemSize,a.type,c,u):e.vertexAttribPointer(s,i.itemSize,a.type,i.normalized,c,u),i.isInstancedBufferAttribute&&!i.isInterleavedBufferAttribute?e.vertexAttribDivisor(s,i.meshPerAttribute):i.isInterleavedBufferAttribute&&i.data.isInstancedInterleavedBuffer&&e.vertexAttribDivisor(s,i.data.meshPerAttribute)}return e.bindBuffer(e.ARRAY_BUFFER,null),n}_getTransformFeedback(t){let e="";for(let i=0;i<t.length;i++)e+=":"+t[i].id;let n=this.transformFeedbackCache[e];if(n!==void 0)return n;const{gl:s}=this;n=s.createTransformFeedback(),s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,n);for(let i=0;i<t.length;i++){const a=t[i];s.bindBufferBase(s.TRANSFORM_FEEDBACK_BUFFER,i,a.transformBuffer)}return s.bindTransformFeedback(s.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[e]=n,n}_setupBindings(t,e){const n=this.gl;for(const s of t)for(const i of s.bindings){const c=this.get(i).index;if(i.isUniformsGroup||i.isUniformBuffer){const u=n.getUniformBlockIndex(e,i.name);n.uniformBlockBinding(e,u,c)}else if(i.isSampledTexture){const u=n.getUniformLocation(e,i.name);n.uniform1i(u,c)}}}_bindUniforms(t){const{gl:e,state:n}=this;for(const s of t)for(const i of s.bindings){const a=this.get(i),c=a.index;i.isUniformsGroup||i.isUniformBuffer?n.bindBufferBase(e.UNIFORM_BUFFER,c,a.bufferGPU):i.isSampledTexture&&n.bindTexture(a.glTextureType,a.textureGPU,e.TEXTURE0+c)}}_resolveRenderTarget(t){const{gl:e,state:n}=this,s=t.renderTarget;if(t.textures!==null&&s){const i=this.get(s);if(s.samples>0&&this._useMultisampledExtension(s)===!1){const a=i.framebuffers[t.getCacheKey()];let c=e.COLOR_BUFFER_BIT;s.resolveDepthBuffer&&(s.depthBuffer&&(c|=e.DEPTH_BUFFER_BIT),s.stencilBuffer&&s.resolveStencilBuffer&&(c|=e.STENCIL_BUFFER_BIT));const u=i.msaaFrameBuffer,d=i.msaaRenderbuffers,f=t.textures,p=f.length>1;if(n.bindFramebuffer(e.READ_FRAMEBUFFER,u),n.bindFramebuffer(e.DRAW_FRAMEBUFFER,a),p)for(let g=0;g<f.length;g++)e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0+g,e.RENDERBUFFER,null),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+g,e.TEXTURE_2D,null,0);for(let g=0;g<f.length;g++){if(p){const{textureGPU:y}=this.get(f[g]);e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.RENDERBUFFER,d[g]),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,y,0)}if(t.scissor){const{x:y,y:x,width:S,height:T}=t.scissorValue,M=t.height-T-x;e.blitFramebuffer(y,M,y+S,M+T,y,M,y+S,M+T,c,e.NEAREST)}else e.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,c,e.NEAREST)}if(p)for(let g=0;g<f.length;g++){const{textureGPU:y}=this.get(f[g]);e.framebufferRenderbuffer(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0+g,e.RENDERBUFFER,d[g]),e.framebufferTexture2D(e.DRAW_FRAMEBUFFER,e.COLOR_ATTACHMENT0+g,e.TEXTURE_2D,y,0)}this._supportsInvalidateFramebuffer===!0&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,i.invalidationArray)}else if(s.resolveDepthBuffer===!1&&i.framebuffers){const a=i.framebuffers[t.getCacheKey()];n.bindFramebuffer(e.DRAW_FRAMEBUFFER,a),e.invalidateFramebuffer(e.DRAW_FRAMEBUFFER,i.depthInvalidationArray)}}}_useMultisampledExtension(t){return t.multiview===!0?!0:t.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&t._autoAllocateDepthBuffer!==!1}dispose(){this.textureUtils!==null&&this.textureUtils.dispose();const t=this.extensions.get("WEBGL_lose_context");t&&t.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const fg={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list"},Ko=typeof self<"u"&&self.GPUShaderStage?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},Js={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},Ai={Store:"store"},nn={Load:"load",Clear:"clear"},cE={CCW:"ccw",CW:"cw"},uE={None:"none",Back:"back"},qy={Uint16:"uint16",Uint32:"uint32"},lt={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rg11b10ufloat",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-unorm-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},a2={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},qo={Linear:"linear",Nearest:"nearest"},Fe={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDst:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},lu={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},hE={None:0,All:15},$l={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},l2={Storage:"storage",ReadOnlyStorage:"read-only-storage"},c2={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},dE={NonFiltering:"non-filtering",Comparison:"comparison"},cu={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},fE={TwoD:"2d",ThreeD:"3d"},hi={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},qW={All:"all"},pg={Vertex:"vertex",Instance:"instance"},uw={CoreFeaturesAndLimits:"core-features-and-limits",DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionBCSliced3D:"texture-compression-bc-sliced-3d",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TextureCompressionASTCSliced3D:"texture-compression-astc-sliced-3d",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",Float32Blendable:"float32-blendable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups",TextureFormatsTier1:"texture-formats-tier1",TextureFormatsTier2:"texture-formats-tier2"},pE={"texture-compression-s3tc":"texture-compression-bc","texture-compression-etc1":"texture-compression-etc2"};class $W extends $D{constructor(t,e,n){super(t,e?e.value:null),this.textureNode=e,this.groupNode=n}update(){const{textureNode:t}=this;return this.texture!==t.value?(this.texture=t.value,!0):super.update()}}class XW extends kD{constructor(t,e){super(t,e?e.array:null),this._attribute=e,this.isStorageBuffer=!0}get attribute(){return this._attribute}}let jW=0;class YW extends XW{constructor(t,e){super("StorageBuffer_"+jW++,t?t.value:null),this.nodeUniform=t,this.access=t?t.access:si.READ_WRITE,this.groupNode=e}get attribute(){return this.nodeUniform.value}get buffer(){return this.nodeUniform.value.array}}class KW extends Oc{constructor(t){super(),this.device=t;const e=`
struct VarysStruct {
	@builtin( position ) Position: vec4f,
	@location( 0 ) vTex : vec2f,
	@location( 1 ) @interpolate(flat, either) vBaseArrayLayer: u32,
};

@group( 0 ) @binding ( 2 )
var<uniform> flipY: u32;

@vertex
fn mainVS(
		@builtin( vertex_index ) vertexIndex : u32,
		@builtin( instance_index ) instanceIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array(
		vec2f( -1, -1 ),
		vec2f( -1,  3 ),
		vec2f(  3, -1 ),
	);

	let p = pos[ vertexIndex ];
	let mult = select( vec2f( 0.5, -0.5 ), vec2f( 0.5, 0.5 ), flipY != 0 );
	Varys.vTex = p * mult + vec2f( 0.5 );
	Varys.Position = vec4f( p, 0, 1 );
	Varys.vBaseArrayLayer = instanceIndex;

	return Varys;

}

@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img2d : texture_2d<f32>;

@fragment
fn main_2d( Varys: VarysStruct ) -> @location( 0 ) vec4<f32> {

	return textureSample( img2d, imgSampler, Varys.vTex );

}

@group( 0 ) @binding( 1 )
var img2dArray : texture_2d_array<f32>;

@fragment
fn main_2d_array( Varys: VarysStruct ) -> @location( 0 ) vec4<f32> {

	return textureSample( img2dArray, imgSampler, Varys.vTex, Varys.vBaseArrayLayer );

}

const faceMat = array(
  mat3x3f(  0,  0,  -2,  0, -2,   0,  1,  1,   1 ),   // pos-x
  mat3x3f(  0,  0,   2,  0, -2,   0, -1,  1,  -1 ),   // neg-x
  mat3x3f(  2,  0,   0,  0,  0,   2, -1,  1,  -1 ),   // pos-y
  mat3x3f(  2,  0,   0,  0,  0,  -2, -1, -1,   1 ),   // neg-y
  mat3x3f(  2,  0,   0,  0, -2,   0, -1,  1,   1 ),   // pos-z
  mat3x3f( -2,  0,   0,  0, -2,   0,  1,  1,  -1 ),   // neg-z
);

@group( 0 ) @binding( 1 )
var imgCube : texture_cube<f32>;

@fragment
fn main_cube( Varys: VarysStruct ) -> @location( 0 ) vec4<f32> {

	return textureSample( imgCube, imgSampler, faceMat[ Varys.vBaseArrayLayer ] * vec3f( fract( Varys.vTex ), 1 ) );

}
`;this.mipmapSampler=t.createSampler({minFilter:qo.Linear}),this.flipYSampler=t.createSampler({minFilter:qo.Nearest}),this.flipUniformBuffer=t.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),t.queue.writeBuffer(this.flipUniformBuffer,0,new Uint32Array([1])),this.noFlipUniformBuffer=t.createBuffer({size:4,usage:GPUBufferUsage.UNIFORM}),this.transferPipelines={},this.mipmapShaderModule=t.createShaderModule({label:"mipmap",code:e})}getTransferPipeline(t,e){e=e||"2d-array";const n=`${t}-${e}`;let s=this.transferPipelines[n];return s===void 0&&(s=this.device.createRenderPipeline({label:`mipmap-${t}-${e}`,vertex:{module:this.mipmapShaderModule},fragment:{module:this.mipmapShaderModule,entryPoint:`main_${e.replace("-","_")}`,targets:[{format:t}]},layout:"auto"}),this.transferPipelines[n]=s),s}flipY(t,e,n=0){const s=e.format,{width:i,height:a}=e.size,c=this.device.createTexture({size:{width:i,height:a},format:s,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=this.getTransferPipeline(s,t.textureBindingViewDimension),d=this.getTransferPipeline(s,c.textureBindingViewDimension),f=this.device.createCommandEncoder({}),p=(g,y,x,S,T,M)=>{const N=g.getBindGroupLayout(0),v=this.device.createBindGroup({layout:N,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:y.createView({dimension:y.textureBindingViewDimension||"2d-array",baseMipLevel:0,mipLevelCount:1})},{binding:2,resource:{buffer:M?this.flipUniformBuffer:this.noFlipUniformBuffer}}]}),A=f.beginRenderPass({colorAttachments:[{view:S.createView({dimension:"2d",baseMipLevel:0,mipLevelCount:1,baseArrayLayer:T,arrayLayerCount:1}),loadOp:nn.Clear,storeOp:Ai.Store}]});A.setPipeline(g),A.setBindGroup(0,v),A.draw(3,1,0,x),A.end()};p(u,t,n,c,0,!1),p(d,c,0,t,n,!0),this.device.queue.submit([f.finish()]),c.destroy()}generateMipmaps(t,e=null){const n=this.get(t),s=n.layers||this._mipmapCreateBundles(t),i=e||this.device.createCommandEncoder({label:"mipmapEncoder"});this._mipmapRunBundles(i,s),e===null&&this.device.queue.submit([i.finish()]),n.layers=s}_mipmapCreateBundles(t){const e=t.textureBindingViewDimension||"2d-array",n=this.getTransferPipeline(t.format,e),s=n.getBindGroupLayout(0),i=[];for(let a=1;a<t.mipLevelCount;a++)for(let c=0;c<t.depthOrArrayLayers;c++){const u=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:t.createView({dimension:e,baseMipLevel:a-1,mipLevelCount:1})},{binding:2,resource:{buffer:this.noFlipUniformBuffer}}]}),d={colorAttachments:[{view:t.createView({dimension:"2d",baseMipLevel:a,mipLevelCount:1,baseArrayLayer:c,arrayLayerCount:1}),loadOp:nn.Clear,storeOp:Ai.Store}]},f=this.device.createRenderBundleEncoder({colorFormats:[t.format]});f.setPipeline(n),f.setBindGroup(0,u),f.draw(3,1,0,c),i.push({renderBundles:[f.finish()],passDescriptor:d})}return i}_mipmapRunBundles(t,e){const n=e.length;for(let s=0;s<n;s++){const i=e[s],a=t.beginRenderPass(i.passDescriptor);a.executeBundles(i.renderBundles),a.end()}}}const ZW={[W3]:"never",[Aw]:"less",[q3]:"equal",[ex]:"less-equal",[$3]:"greater",[nx]:"greater-equal",[j3]:"always",[X3]:"not-equal"},QW=[0,1,3,2,4,5];class JW{constructor(t){this.backend=t,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this._samplerCache=new Map}updateSampler(t){const e=this.backend,n=t.minFilter+"-"+t.magFilter+"-"+t.wrapS+"-"+t.wrapT+"-"+(t.wrapR||"0")+"-"+t.anisotropy+"-"+(t.compareFunction||0);let s=this._samplerCache.get(n);if(s===void 0){const a={addressModeU:this._convertAddressMode(t.wrapS),addressModeV:this._convertAddressMode(t.wrapT),addressModeW:this._convertAddressMode(t.wrapR),magFilter:this._convertFilterMode(t.magFilter),minFilter:this._convertFilterMode(t.minFilter),mipmapFilter:this._convertFilterMode(t.minFilter),maxAnisotropy:1};t.isDepthTexture&&t.compareFunction===null&&(a.magFilter=qo.Nearest,a.minFilter=qo.Nearest,a.mipmapFilter=qo.Nearest),a.magFilter===qo.Linear&&a.minFilter===qo.Linear&&a.mipmapFilter===qo.Linear&&(a.maxAnisotropy=t.anisotropy),t.isDepthTexture&&t.compareFunction!==null&&e.hasCompatibility(xc.TEXTURE_COMPARE)&&(a.compare=ZW[t.compareFunction]),s={sampler:e.device.createSampler(a),usedTimes:0},this._samplerCache.set(n,s)}const i=e.get(t);if(i.sampler!==s.sampler){if(i.sampler!==void 0){const a=this._samplerCache.get(i.samplerKey);a.usedTimes--,a.usedTimes===0&&this._samplerCache.delete(i.samplerKey)}i.samplerKey=n,i.sampler=s.sampler,s.usedTimes++}return n}createDefaultTexture(t){let e;const n=hw(t);t.isCubeTexture?e=this._getDefaultCubeTextureGPU(n):e=this._getDefaultTextureGPU(n),this.backend.get(t).texture=e}createTexture(t,e={}){const n=this.backend,s=n.get(t);if(s.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");if(t.isExternalTexture){s.texture=t.sourceTexture,s.initialized=!0;return}e.needsMipmaps===void 0&&(e.needsMipmaps=!1),e.levels===void 0&&(e.levels=1),e.depth===void 0&&(e.depth=1);const{width:i,height:a,depth:c,levels:u}=e;t.isFramebufferTexture&&(e.renderTarget?e.format=this.backend.utils.getCurrentColorFormat(e.renderTarget):e.format=this.backend.utils.getPreferredCanvasFormat());const d=this._getDimension(t),f=t.internalFormat||e.format||hw(t,n.device);s.format=f;const{samples:p,primarySamples:g,isMSAA:y}=n.utils.getTextureSampleData(t);let x=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;t.isStorageTexture===!0&&(x|=GPUTextureUsage.STORAGE_BINDING),t.isCompressedTexture!==!0&&t.isCompressedArrayTexture!==!0&&f!==lt.RGB9E5UFloat&&(x|=GPUTextureUsage.RENDER_ATTACHMENT);const S={label:t.name,size:{width:i,height:a,depthOrArrayLayers:c},mipLevelCount:u,sampleCount:g,dimension:d,format:f,usage:x};if(f===void 0){Wt("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(t);return}t.isCubeTexture&&(S.textureBindingViewDimension=hi.Cube);try{s.texture=n.device.createTexture(S)}catch{Wt("WebGPURenderer: Failed to create texture with descriptor:",S),this.createDefaultTexture(t);return}if(y){const T=Object.assign({},S);T.label=T.label+"-msaa",T.sampleCount=p,T.mipLevelCount=1,s.msaaTexture=n.device.createTexture(T)}s.initialized=!0,s.textureDescriptorGPU=S}destroyTexture(t,e=!1){const n=this.backend,s=n.get(t);s.texture!==void 0&&e===!1&&s.texture.destroy(),s.msaaTexture!==void 0&&s.msaaTexture.destroy(),n.delete(t)}generateMipmaps(t,e=null){const n=this.backend.get(t);this._generateMipmaps(n.texture,e)}getColorBuffer(){const t=this.backend,e=t.renderer.getCanvasTarget(),{width:n,height:s}=t.getDrawingBufferSize(),i=t.renderer.currentSamples,a=e.colorTexture,c=t.get(a);if(a.width===n&&a.height===s&&a.samples===i)return c.texture;let u=c.texture;return u&&u.destroy(),u=t.device.createTexture({label:"colorBuffer",size:{width:n,height:s,depthOrArrayLayers:1},sampleCount:t.utils.getSampleCount(t.renderer.currentSamples),format:t.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),a.source.width=n,a.source.height=s,a.samples=i,c.texture=u,u}getDepthBuffer(t=!0,e=!1){const n=this.backend,s=n.renderer.getCanvasTarget(),{width:i,height:a}=n.getDrawingBufferSize(),c=n.renderer.currentSamples,u=s.depthTexture;if(u.width===i&&u.height===a&&u.samples===c&&u.depth===t&&u.stencil===e)return n.get(u).texture;const d=n.get(u).texture;let f,p;if(e?(f=el,p=yc):t&&(f=To,p=Qn),d!==void 0){if(u.image.width===i&&u.image.height===a&&u.format===f&&u.type===p&&u.samples===c)return d;this.destroyTexture(u)}return u.name="depthBuffer",u.format=f,u.type=p,u.image.width=i,u.image.height=a,u.samples=c,this.createTexture(u,{width:i,height:a}),n.get(u).texture}updateTexture(t,e){const n=this.backend.get(t),s=t.mipmaps,{textureDescriptorGPU:i}=n;if(!(t.isRenderTargetTexture||i===void 0)){if(t.isDataTexture)if(s.length>0)for(let a=0,c=s.length;a<c;a++){const u=s[a];this._copyBufferToTexture(u,n.texture,i,0,t.flipY,0,a)}else this._copyBufferToTexture(e.image,n.texture,i,0,t.flipY);else if(t.isArrayTexture||t.isDataArrayTexture||t.isData3DTexture)for(let a=0;a<e.image.depth;a++)this._copyBufferToTexture(e.image,n.texture,i,a,t.flipY,a);else if(t.isCompressedTexture||t.isCompressedArrayTexture)this._copyCompressedBufferToTexture(t.mipmaps,n.texture,i);else if(t.isCubeTexture)this._copyCubeMapToTexture(t,n.texture,i);else if(s.length>0)for(let a=0,c=s.length;a<c;a++){const u=s[a];this._copyImageToTexture(u,n.texture,i,0,t.flipY,t.premultiplyAlpha,a)}else this._copyImageToTexture(e.image,n.texture,i,0,t.flipY,t.premultiplyAlpha);n.version=t.version}}async copyTextureToBuffer(t,e,n,s,i,a){const c=this.backend.device,u=this.backend.get(t),d=u.texture,f=u.textureDescriptorGPU.format,p=this._getBytesPerTexel(f);let g=s*p;g=Math.ceil(g/256)*256;const y=c.createBuffer({size:(i-1)*g+s*p,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),x=c.createCommandEncoder();x.copyTextureToBuffer({texture:d,origin:{x:e,y:n,z:a}},{buffer:y,bytesPerRow:g},{width:s,height:i});const S=this._getTypedArrayType(f);c.queue.submit([x.finish()]),await y.mapAsync(GPUMapMode.READ);const T=y.getMappedRange();return new S(T)}dispose(){this._samplerCache.clear()}_getDefaultTextureGPU(t){let e=this.defaultTexture[t];if(e===void 0){const n=new ns;n.minFilter=ts,n.magFilter=ts,this.createTexture(n,{width:1,height:1,format:t}),this.defaultTexture[t]=e=n}return this.backend.get(e).texture}_getDefaultCubeTextureGPU(t){let e=this.defaultCubeTexture[t];if(e===void 0){const n=new rx;n.minFilter=ts,n.magFilter=ts,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[t]=e=n}return this.backend.get(e).texture}_copyCubeMapToTexture(t,e,n){const s=t.images,i=t.mipmaps;for(let a=0;a<6;a++){const c=s[a],u=t.flipY===!0?QW[a]:a;c.isDataTexture?this._copyBufferToTexture(c.image,e,n,u,t.flipY):this._copyImageToTexture(c,e,n,u,t.flipY,t.premultiplyAlpha);for(let d=0;d<i.length;d++){const p=i[d].images[a];p.isDataTexture?this._copyBufferToTexture(p.image,e,n,u,t.flipY,0,d+1):this._copyImageToTexture(p,e,n,u,t.flipY,t.premultiplyAlpha,d+1)}}}_copyImageToTexture(t,e,n,s,i,a,c=0){const u=this.backend.device,d=c>0?t.width:n.size.width,f=c>0?t.height:n.size.height;try{u.queue.copyExternalImageToTexture({source:t,flipY:i},{texture:e,mipLevel:c,origin:{x:0,y:0,z:s},premultipliedAlpha:a},{width:d,height:f,depthOrArrayLayers:1})}catch{}}_getPassUtils(){let t=this._passUtils;return t===null&&(this._passUtils=t=new KW(this.backend.device)),t}_generateMipmaps(t,e=null){this._getPassUtils().generateMipmaps(t,e)}_flipY(t,e,n=0){this._getPassUtils().flipY(t,e,n)}_copyBufferToTexture(t,e,n,s,i,a=0,c=0){const u=this.backend.device,d=t.data,f=this._getBytesPerTexel(n.format),p=t.width*f;u.queue.writeTexture({texture:e,mipLevel:c,origin:{x:0,y:0,z:s}},d,{offset:t.width*t.height*f*a,bytesPerRow:p},{width:t.width,height:t.height,depthOrArrayLayers:1}),i===!0&&this._flipY(e,n,s)}_copyCompressedBufferToTexture(t,e,n){const s=this.backend.device,i=this._getBlockData(n.format),a=n.size.depthOrArrayLayers>1;for(let c=0;c<t.length;c++){const u=t[c],d=u.width,f=u.height,p=a?n.size.depthOrArrayLayers:1,g=Math.ceil(d/i.width)*i.byteLength,y=g*Math.ceil(f/i.height);for(let x=0;x<p;x++)s.queue.writeTexture({texture:e,mipLevel:c,origin:{x:0,y:0,z:x}},u.data,{offset:x*y,bytesPerRow:g,rowsPerImage:Math.ceil(f/i.height)},{width:Math.ceil(d/i.width)*i.width,height:Math.ceil(f/i.height)*i.height,depthOrArrayLayers:1})}}_getBlockData(t){if(t===lt.BC1RGBAUnorm||t===lt.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(t===lt.BC2RGBAUnorm||t===lt.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(t===lt.BC3RGBAUnorm||t===lt.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(t===lt.BC4RUnorm||t===lt.BC4RSnorm)return{byteLength:8,width:4,height:4};if(t===lt.BC5RGUnorm||t===lt.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(t===lt.BC6HRGBUFloat||t===lt.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(t===lt.BC7RGBAUnorm||t===lt.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(t===lt.ETC2RGB8Unorm||t===lt.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(t===lt.ETC2RGB8A1Unorm||t===lt.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(t===lt.ETC2RGBA8Unorm||t===lt.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(t===lt.EACR11Unorm)return{byteLength:8,width:4,height:4};if(t===lt.EACR11Snorm)return{byteLength:8,width:4,height:4};if(t===lt.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(t===lt.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(t===lt.ASTC4x4Unorm||t===lt.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(t===lt.ASTC5x4Unorm||t===lt.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(t===lt.ASTC5x5Unorm||t===lt.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(t===lt.ASTC6x5Unorm||t===lt.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(t===lt.ASTC6x6Unorm||t===lt.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(t===lt.ASTC8x5Unorm||t===lt.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(t===lt.ASTC8x6Unorm||t===lt.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(t===lt.ASTC8x8Unorm||t===lt.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(t===lt.ASTC10x5Unorm||t===lt.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(t===lt.ASTC10x6Unorm||t===lt.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(t===lt.ASTC10x8Unorm||t===lt.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(t===lt.ASTC10x10Unorm||t===lt.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(t===lt.ASTC12x10Unorm||t===lt.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(t===lt.ASTC12x12Unorm||t===lt.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(t){let e=a2.ClampToEdge;return t===Bn?e=a2.Repeat:t===Sd&&(e=a2.MirrorRepeat),e}_convertFilterMode(t){let e=qo.Linear;return(t===ts||t===I3||t===Ep)&&(e=qo.Nearest),e}_getBytesPerTexel(t){if(t===lt.R8Unorm||t===lt.R8Snorm||t===lt.R8Uint||t===lt.R8Sint)return 1;if(t===lt.R16Uint||t===lt.R16Sint||t===lt.R16Float||t===lt.RG8Unorm||t===lt.RG8Snorm||t===lt.RG8Uint||t===lt.RG8Sint)return 2;if(t===lt.R32Uint||t===lt.R32Sint||t===lt.R32Float||t===lt.RG16Uint||t===lt.RG16Sint||t===lt.RG16Float||t===lt.RGBA8Unorm||t===lt.RGBA8UnormSRGB||t===lt.RGBA8Snorm||t===lt.RGBA8Uint||t===lt.RGBA8Sint||t===lt.BGRA8Unorm||t===lt.BGRA8UnormSRGB||t===lt.RGB9E5UFloat||t===lt.RGB10A2Unorm||t===lt.RG11B10UFloat||t===lt.Depth32Float||t===lt.Depth24Plus||t===lt.Depth24PlusStencil8||t===lt.Depth32FloatStencil8)return 4;if(t===lt.RG32Uint||t===lt.RG32Sint||t===lt.RG32Float||t===lt.RGBA16Uint||t===lt.RGBA16Sint||t===lt.RGBA16Float)return 8;if(t===lt.RGBA32Uint||t===lt.RGBA32Sint||t===lt.RGBA32Float)return 16}_getTypedArrayType(t){if(t===lt.R8Uint)return Uint8Array;if(t===lt.R8Sint)return Int8Array;if(t===lt.R8Unorm)return Uint8Array;if(t===lt.R8Snorm)return Int8Array;if(t===lt.RG8Uint)return Uint8Array;if(t===lt.RG8Sint)return Int8Array;if(t===lt.RG8Unorm)return Uint8Array;if(t===lt.RG8Snorm)return Int8Array;if(t===lt.RGBA8Uint)return Uint8Array;if(t===lt.RGBA8Sint)return Int8Array;if(t===lt.RGBA8Unorm||t===lt.RGBA8UnormSRGB)return Uint8Array;if(t===lt.RGBA8Snorm)return Int8Array;if(t===lt.R16Uint)return Uint16Array;if(t===lt.R16Sint)return Int16Array;if(t===lt.RG16Uint)return Uint16Array;if(t===lt.RG16Sint)return Int16Array;if(t===lt.RGBA16Uint)return Uint16Array;if(t===lt.RGBA16Sint)return Int16Array;if(t===lt.R16Float||t===lt.RG16Float||t===lt.RGBA16Float)return Uint16Array;if(t===lt.R32Uint)return Uint32Array;if(t===lt.R32Sint)return Int32Array;if(t===lt.R32Float)return Float32Array;if(t===lt.RG32Uint)return Uint32Array;if(t===lt.RG32Sint)return Int32Array;if(t===lt.RG32Float)return Float32Array;if(t===lt.RGBA32Uint)return Uint32Array;if(t===lt.RGBA32Sint)return Int32Array;if(t===lt.RGBA32Float)return Float32Array;if(t===lt.BGRA8Unorm||t===lt.BGRA8UnormSRGB)return Uint8Array;if(t===lt.RGB10A2Unorm||t===lt.RGB9E5UFloat||t===lt.RG11B10UFloat)return Uint32Array;if(t===lt.Depth32Float)return Float32Array;if(t===lt.Depth24Plus||t===lt.Depth24PlusStencil8)return Uint32Array;if(t===lt.Depth32FloatStencil8)return Float32Array}_getDimension(t){let e;return t.is3DTexture||t.isData3DTexture?e=fE.ThreeD:e=fE.TwoD,e}}function hw(r,t=null){const e=r.format,n=r.type,s=r.colorSpace,i=qe.getTransfer(s);let a;if(r.isCompressedTexture===!0||r.isCompressedArrayTexture===!0)switch(e){case up:case hp:a=i===ye?lt.BC1RGBAUnormSRGB:lt.BC1RGBAUnorm;break;case dp:a=i===ye?lt.BC2RGBAUnormSRGB:lt.BC2RGBAUnorm;break;case fp:a=i===ye?lt.BC3RGBAUnormSRGB:lt.BC3RGBAUnorm;break;case Sy:a=lt.BC4RUnorm;break;case wy:a=lt.BC4RSnorm;break;case Bp:a=lt.BC5RGUnorm;break;case Ty:a=lt.BC5RGSnorm;break;case by:a=i===ye?lt.BC7RGBAUnormSRGB:lt.BC7RGBAUnorm;break;case ty:case Jg:a=i===ye?lt.ETC2RGB8UnormSRGB:lt.ETC2RGB8Unorm;break;case ey:a=i===ye?lt.ETC2RGBA8UnormSRGB:lt.ETC2RGBA8Unorm;break;case ny:a=lt.EACR11Unorm;break;case sy:a=lt.EACR11Snorm;break;case Cp:a=lt.EACRG11Unorm;break;case iy:a=lt.EACRG11Snorm;break;case ry:a=i===ye?lt.ASTC4x4UnormSRGB:lt.ASTC4x4Unorm;break;case oy:a=i===ye?lt.ASTC5x4UnormSRGB:lt.ASTC5x4Unorm;break;case ay:a=i===ye?lt.ASTC5x5UnormSRGB:lt.ASTC5x5Unorm;break;case ly:a=i===ye?lt.ASTC6x5UnormSRGB:lt.ASTC6x5Unorm;break;case cy:a=i===ye?lt.ASTC6x6UnormSRGB:lt.ASTC6x6Unorm;break;case uy:a=i===ye?lt.ASTC8x5UnormSRGB:lt.ASTC8x5Unorm;break;case hy:a=i===ye?lt.ASTC8x6UnormSRGB:lt.ASTC8x6Unorm;break;case dy:a=i===ye?lt.ASTC8x8UnormSRGB:lt.ASTC8x8Unorm;break;case fy:a=i===ye?lt.ASTC10x5UnormSRGB:lt.ASTC10x5Unorm;break;case py:a=i===ye?lt.ASTC10x6UnormSRGB:lt.ASTC10x6Unorm;break;case my:a=i===ye?lt.ASTC10x8UnormSRGB:lt.ASTC10x8Unorm;break;case gy:a=i===ye?lt.ASTC10x10UnormSRGB:lt.ASTC10x10Unorm;break;case yy:a=i===ye?lt.ASTC12x10UnormSRGB:lt.ASTC12x10Unorm;break;case xy:a=i===ye?lt.ASTC12x12UnormSRGB:lt.ASTC12x12Unorm;break;case Yi:a=i===ye?lt.RGBA8UnormSRGB:lt.RGBA8Unorm;break;default:Ht("WebGPURenderer: Unsupported texture format.",e)}else switch(e){case Yi:switch(n){case cd:a=lt.RGBA8Snorm;break;case ud:a=lt.RGBA16Sint;break;case Mu:a=lt.RGBA16Uint;break;case Qn:a=lt.RGBA32Uint;break;case di:a=lt.RGBA32Sint;break;case gi:a=i===ye?lt.RGBA8UnormSRGB:lt.RGBA8Unorm;break;case ni:a=lt.RGBA16Float;break;case Ri:a=lt.RGBA32Float;break;default:Ht("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case Zy:switch(n){case Mw:a=lt.RGB9E5UFloat;break;case vw:a=lt.RG11B10UFloat;break;default:Ht("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case Hp:switch(n){case cd:a=lt.R8Snorm;break;case ud:a=lt.R16Sint;break;case Mu:a=lt.R16Uint;break;case Qn:a=lt.R32Uint;break;case di:a=lt.R32Sint;break;case gi:a=lt.R8Unorm;break;case ni:a=lt.R16Float;break;case Ri:a=lt.R32Float;break;default:Ht("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case jo:switch(n){case cd:a=lt.RG8Snorm;break;case ud:a=lt.RG16Sint;break;case Mu:a=lt.RG16Uint;break;case Qn:a=lt.RG32Uint;break;case di:a=lt.RG32Sint;break;case gi:a=lt.RG8Unorm;break;case ni:a=lt.RG16Float;break;case Ri:a=lt.RG32Float;break;default:Ht("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case To:switch(n){case Mu:a=lt.Depth16Unorm;break;case Qn:a=lt.Depth24Plus;break;case Ri:a=lt.Depth32Float;break;default:Ht("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case el:switch(n){case yc:a=lt.Depth24PlusStencil8;break;case Ri:t&&t.features.has(uw.Depth32FloatStencil8)===!1&&Ht('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),a=lt.Depth32FloatStencil8;break;default:Ht("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case Qy:switch(n){case di:a=lt.R32Sint;break;case Qn:a=lt.R32Uint;break;default:Ht("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case Jy:switch(n){case di:a=lt.RG32Sint;break;case Qn:a=lt.RG32Uint;break;default:Ht("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case tx:switch(n){case di:a=lt.RGBA32Sint;break;case Qn:a=lt.RGBA32Uint;break;default:Ht("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:Ht("WebGPURenderer: Unsupported texture format.",e)}return a}const tq=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,eq=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,mE={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_2d_array:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_depth_cube:"depthTexture",texture_depth_cube_array:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},nq=r=>{r=r.trim();const t=r.match(tq);if(t!==null&&t.length===4){const e=t[2],n=[];let s=null;for(;(s=eq.exec(e))!==null;)n.push({name:s[1],type:s[2]});const i=[];for(let f=0;f<n.length;f++){const{name:p,type:g}=n[f];let y=g;y.startsWith("ptr")?y="pointer":(y.startsWith("texture")&&(y=g.split("<")[0]),y=mE[y]),i.push(new g_(y,p))}const a=r.substring(t[0].length),c=t[3]||"void",u=t[1]!==void 0?t[1]:"";return{type:mE[c]||c,inputs:i,name:u,inputsCode:e,blockCode:a,outputType:c}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class sq extends x_{constructor(t){const{type:e,inputs:n,name:s,inputsCode:i,blockCode:a,outputType:c}=nq(t);super(e,n,s),this.inputsCode=i,this.blockCode=a,this.outputType=c}getCode(t=this.name){const e=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${t} ( ${this.inputsCode.trim()} ) ${e}`+this.blockCode}}class iq extends ID{parseFunction(t){return new sq(t)}}const rq={[si.READ_ONLY]:"read",[si.WRITE_ONLY]:"write",[si.READ_WRITE]:"read_write"},gE={[Bn]:"repeat",[ji]:"clamp",[Sd]:"mirror"},u2={vertex:Ko.VERTEX,fragment:Ko.FRAGMENT,compute:Ko.COMPUTE},yE={instance:!0,swizzleAssign:!1,storageBuffer:!0},oq={"^^":"tsl_xor"},aq={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},xE={},Xf={tsl_xor:new Os("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Os("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Os("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Os("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Os("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Os("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Os("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Os("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Os("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Os("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Os("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Os("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Os(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`),biquadraticTextureArray:new Os(`
fn tsl_biquadraticTexture_array( map : texture_2d_array<f32>, coord : vec2f, iRes : vec2u, layer : u32, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, layer, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, layer, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, layer, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, layer, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},lq={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>",floatpack_snorm_2x16:"pack2x16snorm",floatpack_unorm_2x16:"pack2x16unorm",floatpack_float16_2x16:"pack2x16float",floatunpack_snorm_2x16:"unpack2x16snorm",floatunpack_unorm_2x16:"unpack2x16unorm",floatunpack_float16_2x16:"unpack2x16float"};let KD="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(KD+=`diagnostic( off, derivative_uniformity );
`);class cq extends zD{constructor(t,e){super(t,e,new iq),this.uniformGroups={},this.uniformGroupsBindings={},this.builtins={},this.directives={},this.scopedArrays=new Map}_generateTextureSample(t,e,n,s,i,a=this.shaderStage){return a==="fragment"?s?i?`textureSample( ${e}, ${e}_sampler, ${n}, ${s}, ${i} )`:`textureSample( ${e}, ${e}_sampler, ${n}, ${s} )`:i?`textureSample( ${e}, ${e}_sampler, ${n}, ${i} )`:`textureSample( ${e}, ${e}_sampler, ${n} )`:this.generateTextureSampleLevel(t,e,n,"0",s)}generateTextureSampleLevel(t,e,n,s,i,a){return this.isUnfilterable(t)===!1?i?a?`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${i}, ${s}, ${a} )`:`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${i}, ${s} )`:a?`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${s}, ${a} )`:`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${s} )`:this.isFilteredTexture(t)?this.generateFilteredTexture(t,e,n,a,s,i):this.generateTextureLod(t,e,n,i,a,s)}generateWrapFunction(t){const e=`tsl_coord_${gE[t.wrapS]}S_${gE[t.wrapT]}_${t.is3DTexture||t.isData3DTexture?"3d":"2d"}T`;let n=xE[e];if(n===void 0){const s=[],i=t.is3DTexture||t.isData3DTexture?"vec3f":"vec2f";let a=`fn ${e}( coord : ${i} ) -> ${i} {

	return ${i}(
`;const c=(u,d)=>{u===Bn?(s.push(Xf.repeatWrapping_float),a+=`		tsl_repeatWrapping_float( coord.${d} )`):u===ji?(s.push(Xf.clampWrapping_float),a+=`		tsl_clampWrapping_float( coord.${d} )`):u===Sd?(s.push(Xf.mirrorWrapping_float),a+=`		tsl_mirrorWrapping_float( coord.${d} )`):(a+=`		coord.${d}`,Wt(`WebGPURenderer: Unsupported texture wrap type "${u}" for vertex shader.`))};c(t.wrapS,"x"),a+=`,
`,c(t.wrapT,"y"),(t.is3DTexture||t.isData3DTexture)&&(a+=`,
`,c(t.wrapR,"z")),a+=`
	);

}
`,xE[e]=n=new Os(a,s)}return n.build(this),e}generateArrayDeclaration(t,e){return`array< ${this.getType(t)}, ${e} >`}generateTextureDimension(t,e,n){const s=this.getDataFromNode(t,this.shaderStage,this.globalCache);s.dimensionsSnippet===void 0&&(s.dimensionsSnippet={});let i=s.dimensionsSnippet[n];if(s.dimensionsSnippet[n]===void 0){let a,c;const{primarySamples:u}=this.renderer.backend.utils.getTextureSampleData(t),d=u>1;t.is3DTexture||t.isData3DTexture?c="vec3<u32>":c="vec2<u32>",d||t.isStorageTexture?a=e:a=`${e}${n?`, u32( ${n} )`:""}`,i=new Pg(new zg(`textureDimensions( ${a} )`,c)),s.dimensionsSnippet[n]=i,(t.isArrayTexture||t.isDataArrayTexture||t.is3DTexture||t.isData3DTexture)&&(s.arrayLayerCount=new Pg(new zg(`textureNumLayers(${e})`,"u32"))),t.isTextureCube&&(s.cubeFaceCount=new Pg(new zg("6u","u32")))}return i.build(this)}generateFilteredTexture(t,e,n,s,i="0u",a){const c=this.generateWrapFunction(t),u=this.generateTextureDimension(t,e,i);return s&&(n=`${n} + vec2<f32>(${s}) / ${u}`),a?(this._include("biquadraticTextureArray"),`tsl_biquadraticTexture_array( ${e}, ${c}( ${n} ), ${u}, u32( ${a} ), u32( ${i} ) )`):(this._include("biquadraticTexture"),`tsl_biquadraticTexture( ${e}, ${c}( ${n} ), ${u}, u32( ${i} ) )`)}generateTextureLod(t,e,n,s,i,a="0u"){if(t.isCubeTexture===!0){i&&(n=`${n} + vec3<f32>(${i})`);const y=t.isDepthTexture?"u32":"f32";return`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${y}( ${a} ) )`}const c=this.generateWrapFunction(t),u=this.generateTextureDimension(t,e,a),d=t.is3DTexture||t.isData3DTexture?"vec3":"vec2",f=d==="vec3"?"vec3<u32>( 1, 1, 1 )":"vec2<u32>( 1, 1 )";i&&(n=`${n} + ${d}<f32>(${i}) / ${d}<f32>( ${u} )`);const p=`${d}<f32>( 0 )`,g=`${d}<f32>( ${u} - ${f} )`;return n=`${d}<u32>( clamp( floor( ${c}( ${n} ) * ${d}<f32>( ${u} ) ), ${p}, ${g} ) )`,this.generateTextureLoad(t,e,n,a,s,null)}generateTextureLoad(t,e,n,s,i,a){const c=t.isStorageTexture===!0;s===null&&!c&&(s="0u"),a&&(n=`${n} + ${a}`);let u;return i?c?u=`textureLoad( ${e}, ${n}, ${i} )`:u=`textureLoad( ${e}, ${n}, ${i}, u32( ${s} ) )`:c?u=`textureLoad( ${e}, ${n} )`:(u=`textureLoad( ${e}, ${n}, u32( ${s} ) )`,this.renderer.backend.compatibilityMode&&t.isDepthTexture&&(u+=".x")),u}generateTextureStore(t,e,n,s,i){let a;return s?a=`textureStore( ${e}, ${n}, ${s}, ${i} )`:a=`textureStore( ${e}, ${n}, ${i} )`,a}isSampleCompare(t){return t.isDepthTexture===!0&&t.compareFunction!==null&&this.renderer.hasCompatibility(xc.TEXTURE_COMPARE)}isUnfilterable(t){return this.getComponentTypeFromTexture(t)!=="float"||!this.isAvailable("float32Filterable")&&t.isDataTexture===!0&&t.type===Ri||this.isSampleCompare(t)===!1&&t.minFilter===ts&&t.magFilter===ts||this.renderer.backend.utils.getTextureSampleData(t).primarySamples>1}generateTexture(t,e,n,s,i,a=this.shaderStage){let c=null;return this.isUnfilterable(t)?c=this.generateTextureLod(t,e,n,s,i,"0",a):c=this._generateTextureSample(t,e,n,s,i,a),c}generateTextureGrad(t,e,n,s,i,a,c=this.shaderStage){if(c==="fragment")return i?a?`textureSampleGrad( ${e}, ${e}_sampler, ${n}, ${i}, ${s[0]}, ${s[1]}, ${a} )`:`textureSampleGrad( ${e}, ${e}_sampler, ${n}, ${i}, ${s[0]}, ${s[1]} )`:a?`textureSampleGrad( ${e}, ${e}_sampler, ${n}, ${s[0]}, ${s[1]}, ${a} )`:`textureSampleGrad( ${e}, ${e}_sampler, ${n}, ${s[0]}, ${s[1]} )`;Ht(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${c} shader.`)}generateTextureCompare(t,e,n,s,i,a,c=this.shaderStage){if(c==="fragment")return t.isDepthTexture===!0&&t.isArrayTexture===!0?a?`textureSampleCompare( ${e}, ${e}_sampler, ${n}, ${i}, ${s}, ${a} )`:`textureSampleCompare( ${e}, ${e}_sampler, ${n}, ${i}, ${s} )`:a?`textureSampleCompare( ${e}, ${e}_sampler, ${n}, ${s}, ${a} )`:`textureSampleCompare( ${e}, ${e}_sampler, ${n}, ${s} )`;Ht(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${c} shader.`)}generateTextureLevel(t,e,n,s,i,a){return this.isUnfilterable(t)===!1?i?a?`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${i}, ${s}, ${a} )`:`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${i}, ${s} )`:a?`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${s}, ${a} )`:`textureSampleLevel( ${e}, ${e}_sampler, ${n}, ${s} )`:this.isFilteredTexture(t)?this.generateFilteredTexture(t,e,n,a,s,i):this.generateTextureLod(t,e,n,i,a,s)}generateTextureBias(t,e,n,s,i,a,c=this.shaderStage){if(c==="fragment")return i?a?`textureSampleBias( ${e}, ${e}_sampler, ${n}, ${i}, ${s}, ${a} )`:`textureSampleBias( ${e}, ${e}_sampler, ${n}, ${i}, ${s} )`:a?`textureSampleBias( ${e}, ${e}_sampler, ${n}, ${s}, ${a} )`:`textureSampleBias( ${e}, ${e}_sampler, ${n}, ${s} )`;Ht(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${c} shader.`)}getPropertyName(t,e=this.shaderStage){if(t.isNodeVarying===!0&&t.needsInterpolation===!0){if(e==="vertex")return`varyings.${t.name}`}else if(t.isNodeUniform===!0){const n=t.name,s=t.type;return s==="texture"||s==="cubeTexture"||s==="cubeDepthTexture"||s==="storageTexture"||s==="texture3D"?n:s==="buffer"||s==="storageBuffer"||s==="indirectStorageBuffer"?this.isCustomStruct(t)?n:n+".value":t.groupNode.name+"."+n}return super.getPropertyName(t)}getOutputStructName(){return"output"}getFunctionOperator(t){const e=oq[t];return e!==void 0?(this._include(e),e):null}getNodeAccess(t,e){return e!=="compute"?t.isAtomic===!0?(Wt("WebGPURenderer: Atomic operations are only supported in compute shaders."),si.READ_WRITE):si.READ_ONLY:t.access}getStorageAccess(t,e){return rq[this.getNodeAccess(t,e)]}getUniformFromNode(t,e,n,s=null){const i=super.getUniformFromNode(t,e,n,s),a=this.getDataFromNode(t,n,this.globalCache);if(a.uniformGPU===void 0){let c;const u=t.groupNode,d=u.name,f=this.getBindGroupArray(d,n);if(e==="texture"||e==="cubeTexture"||e==="cubeDepthTexture"||e==="storageTexture"||e==="texture3D"){let p=null;const g=this.getNodeAccess(t,n);if(e==="texture"||e==="storageTexture"?t.value.is3DTexture===!0?p=new cw(i.name,i.node,u,g):p=new Ix(i.name,i.node,u,g):e==="cubeTexture"||e==="cubeDepthTexture"?p=new XD(i.name,i.node,u,g):e==="texture3D"&&(p=new cw(i.name,i.node,u,g)),p.store=t.isStorageTextureNode===!0,p.mipLevel=p.store?t.mipLevel:0,p.setVisibility(u2[n]),t.value.isCubeTexture===!0||this.isUnfilterable(t.value)===!1&&p.store===!1){const x=new $W(`${i.name}_sampler`,i.node,u);x.setVisibility(u2[n]),f.push(x,p),c=[x,p]}else f.push(p),c=[p]}else if(e==="buffer"||e==="storageBuffer"||e==="indirectStorageBuffer"){const p=this.getSharedDataFromNode(t);let g=p.buffer;if(g===void 0){const y=e==="buffer"?WD:YW;g=new y(t,u),p.buffer=g}g.setVisibility(g.getVisibility()|u2[n]),f.push(g),c=g,i.name=s||"NodeBuffer_"+i.id}else{let p=this.uniformGroups[d];p===void 0&&(p=new qD(d,u),p.setVisibility(Ko.VERTEX|Ko.FRAGMENT|Ko.COMPUTE),this.uniformGroups[d]=p),f.indexOf(p)===-1&&f.push(p),c=this.getNodeUniform(i,e);const g=c.name;p.uniforms.some(x=>x.name===g)||p.addUniform(c)}a.uniformGPU=c}return i}getBuiltin(t,e,n,s=this.shaderStage){const i=this.builtins[s]||(this.builtins[s]=new Map);return i.has(t)===!1&&i.set(t,{name:t,property:e,type:n}),e}hasBuiltin(t,e=this.shaderStage){return this.builtins[e]!==void 0&&this.builtins[e].has(t)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(t){const e=t.layout,n=this.flowShaderNode(t),s=[];for(const a of e.inputs)s.push(a.name+" : "+this.getType(a.type));let i=`fn ${e.name}( ${s.join(", ")} ) -> ${this.getType(e.type)} {
${n.vars}
${n.code}
`;return n.result&&(i+=`	return ${n.result};
`),i+=`
}
`,i}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(t,e=this.shaderStage){(this.directives[e]||(this.directives[e]=new Set)).add(t)}getDirectives(t){const e=[],n=this.directives[t];if(n!==void 0)for(const s of n)e.push(`enable ${s};`);return e.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(t){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${t} >`,"vertex")}getBuiltins(t){const e=[],n=this.builtins[t];if(n!==void 0)for(const{name:s,property:i,type:a}of n.values())e.push(`@builtin( ${s} ) ${i} : ${a}`);return e.join(`,
	`)}getScopedArray(t,e,n,s){return this.scopedArrays.has(t)===!1&&this.scopedArrays.set(t,{name:t,scope:e,bufferType:n,bufferCount:s}),t}getScopedArrays(t){if(t!=="compute")return;const e=[];for(const{name:n,scope:s,bufferType:i,bufferCount:a}of this.scopedArrays.values()){const c=this.getType(i);e.push(`var<${s}> ${n}: array< ${c}, ${a} >;`)}return e.join(`
`)}getAttributes(t){const e=[];if(t==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",t),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),t==="vertex"||t==="compute"){const n=this.getBuiltins("attribute");n&&e.push(n);const s=this.getAttributesArray();for(let i=0,a=s.length;i<a;i++){const c=s[i],u=c.name,d=this.getType(c.type);e.push(`@location( ${i} ) ${u} : ${d}`)}}return e.join(`,
	`)}getStructMembers(t){const e=[];for(const n of t.members){const s=t.output?"@location( "+n.index+" ) ":"";let i=this.getType(n.type);n.atomic&&(i="atomic< "+i+" >"),e.push(`	${s+n.name} : ${i}`)}return t.output&&e.push(`	${this.getBuiltins("output")}`),e.join(`,
`)}getStructs(t){let e="";const n=this.structs[t];if(n.length>0){const s=[];for(const i of n){let a=`struct ${i.name} {
`;a+=this.getStructMembers(i),a+=`
};`,s.push(a)}e=`
`+s.join(`

`)+`
`}return e}getVar(t,e,n=null){let s=`var ${e} : `;return n!==null?s+=this.generateArrayDeclaration(t,n):s+=this.getType(t),s}getVars(t){const e=[],n=this.vars[t];if(n!==void 0)for(const s of n)e.push(`	${this.getVar(s.type,s.name,s.count)};`);return`
${e.join(`
`)}
`}getVaryings(t){const e=[];if(t==="vertex"&&this.getBuiltin("position","builtinClipSpace","vec4<f32>","vertex"),t==="vertex"||t==="fragment"){const i=this.varyings,a=this.vars[t];for(let c=0;c<i.length;c++){const u=i[c];if(u.needsInterpolation){let d=`@location( ${c} )`;if(u.interpolationType){const f=u.interpolationSampling!==null?`, ${u.interpolationSampling} )`:" )";d+=` @interpolate( ${u.interpolationType}${f}`}else/^(int|uint|ivec|uvec)/.test(u.type)&&(d+=" @interpolate(flat, either)");e.push(`${d} ${u.name} : ${this.getType(u.type)}`)}else t==="vertex"&&a.includes(u)===!1&&a.push(u)}}const n=this.getBuiltins(t);n&&e.push(n);const s=e.join(`,
	`);return t==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+s):s}isCustomStruct(t){const e=t.value,n=t.node,s=(e.isBufferAttribute||e.isInstancedBufferAttribute)&&n.structTypeNode!==null,i=n.value&&n.value.array&&typeof n.value.itemSize=="number"&&n.value.array.length>n.value.itemSize;return s&&!i}getUniforms(t){const e=this.uniforms[t],n=[],s=[],i=[],a={};for(const u of e){const d=u.groupNode.name,f=this.bindingsIndexes[d];if(u.type==="texture"||u.type==="cubeTexture"||u.type==="cubeDepthTexture"||u.type==="storageTexture"||u.type==="texture3D"){const p=u.node.value;(p.isCubeTexture===!0||this.isUnfilterable(p)===!1&&u.node.isStorageTextureNode!==!0)&&(this.isSampleCompare(p)?n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${u.name}_sampler : sampler_comparison;`):n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${u.name}_sampler : sampler;`));let y,x="";const{primarySamples:S}=this.renderer.backend.utils.getTextureSampleData(p);if(S>1&&(x="_multisampled"),p.isCubeTexture===!0&&p.isDepthTexture===!0)y="texture_depth_cube";else if(p.isCubeTexture===!0)y="texture_cube<f32>";else if(p.isDepthTexture===!0)this.renderer.backend.compatibilityMode&&p.compareFunction===null?y=`texture${x}_2d<f32>`:y=`texture_depth${x}_2d${p.isArrayTexture===!0?"_array":""}`;else if(u.node.isStorageTextureNode===!0){const T=hw(p),M=this.getStorageAccess(u.node,t),N=u.node.value.is3DTexture,v=u.node.value.isArrayTexture;y=`texture_storage_${N?"3d":`2d${v?"_array":""}`}<${T}, ${M}>`}else if(p.isArrayTexture===!0||p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0)y="texture_2d_array<f32>";else if(p.is3DTexture===!0||p.isData3DTexture===!0)y="texture_3d<f32>";else{const T=this.getComponentTypeFromTexture(p).charAt(0);y=`texture${x}_2d<${T}32>`}n.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var ${u.name} : ${y};`)}else if(u.type==="buffer"||u.type==="storageBuffer"||u.type==="indirectStorageBuffer"){const p=u.node,g=this.getType(p.getNodeType(this)),y=p.bufferCount,x=y>0&&u.type==="buffer"?", "+y:"",S=p.isStorageBufferNode?`storage, ${this.getStorageAccess(p,t)}`:"uniform";if(this.isCustomStruct(u))s.push(`@binding( ${f.binding++} ) @group( ${f.group} ) var<${S}> ${u.name} : ${g};`);else{const M=`	value : array< ${p.isAtomic?`atomic<${g}>`:`${g}`}${x} >`;s.push(this._getWGSLStructBinding(u.name,M,S,f.binding++,f.group))}}else{const p=u.groupNode.name;if(a[p]===void 0){const g=this.uniformGroups[p];if(g!==void 0){const y=[];for(const S of g.uniforms){const T=S.getType(),M=this.getType(this.getVectorType(T));y.push(`	${S.name} : ${M}`)}let x=this.uniformGroupsBindings[p];x===void 0&&(x={index:f.binding++,id:f.group},this.uniformGroupsBindings[p]=x),a[p]={index:x.index,id:x.id,snippets:y}}}}}for(const u in a){const d=a[u];i.push(this._getWGSLStructBinding(u,d.snippets.join(`,
`),"uniform",d.index,d.id))}return[...n,...s,...i].join(`
`)}buildCode(){const t=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const e in t){this.shaderStage=e;const n=t[e];n.uniforms=this.getUniforms(e),n.attributes=this.getAttributes(e),n.varyings=this.getVaryings(e),n.structs=this.getStructs(e),n.vars=this.getVars(e),n.codes=this.getCodes(e),n.directives=this.getDirectives(e),n.scopedArrays=this.getScopedArrays(e);let s=`// code

`;s+=this.flowCode[e];const i=this.flowNodes[e],a=i[i.length-1],c=a.outputNode,u=c!==void 0&&c.isOutputStructNode===!0;for(const d of i){const f=this.getFlowData(d),p=d.name;if(p&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${p}
`),s+=`${f.code}
	`,d===a&&e!=="compute"){if(s+=`// result

	`,e==="vertex")s+=`varyings.builtinClipSpace = ${f.result};`;else if(e==="fragment")if(u)n.returnType=c.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",s+=`return ${f.result};`;else{let g="	@location(0) color: vec4<f32>";const y=this.getBuiltins("output");y&&(g+=`,
	`+y),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",g),n.structs+=`
var<private> output : OutputStruct;`,s+=`output.color = ${f.result};

	return output;`}}}n.flow=s}if(this.shaderStage=null,this.material!==null)this.vertexShader=this._getWGSLVertexCode(t.vertex),this.fragmentShader=this._getWGSLFragmentCode(t.fragment);else{const e=this.object.workgroupSize;this.computeShader=this._getWGSLComputeCode(t.compute,e)}}getMethod(t,e=null){let n;return e!==null&&(n=this._getWGSLMethod(t+"_"+e)),n===void 0&&(n=this._getWGSLMethod(t)),n||t}getBitcastMethod(t){return`bitcast<${this.getType(t)}>`}getFloatPackingMethod(t){return this.getMethod(`floatpack_${t}_2x16`)}getFloatUnpackingMethod(t){return this.getMethod(`floatunpack_${t}_2x16`)}getTernary(t,e,n){return`select( ${n}, ${e}, ${t} )`}getType(t){return aq[t]||t}isAvailable(t){let e=yE[t];return e===void 0&&(t==="float32Filterable"?e=this.renderer.hasFeature("float32-filterable"):t==="clipDistance"&&(e=this.renderer.hasFeature("clip-distances")),yE[t]=e),e}getUniformBufferLimit(){return this.renderer.backend.device.limits.maxUniformBufferBindingSize}_getWGSLMethod(t){return Xf[t]!==void 0&&this._include(t),lq[t]}_include(t){const e=Xf[t];return e.build(this),this.addInclude(e),e}_getWGSLVertexCode(t){return`${this.getSignature()}
// directives
${t.directives}

// structs
${t.structs}

// uniforms
${t.uniforms}

// varyings
${t.varyings}
var<private> varyings : VaryingsStruct;

// codes
${t.codes}

@vertex
fn main( ${t.attributes} ) -> VaryingsStruct {

	// vars
	${t.vars}

	// flow
	${t.flow}

	return varyings;

}
`}_getWGSLFragmentCode(t){return`${this.getSignature()}
// global
${KD}

// structs
${t.structs}

// uniforms
${t.uniforms}

// codes
${t.codes}

@fragment
fn main( ${t.varyings} ) -> ${t.returnType} {

	// vars
	${t.vars}

	// flow
	${t.flow}

}
`}_getWGSLComputeCode(t,e){const[n,s,i]=e;return`${this.getSignature()}
// directives
${t.directives}

// system
var<private> instanceIndex : u32;

// locals
${t.scopedArrays}

// structs
${t.structs}

// uniforms
${t.uniforms}

// codes
${t.codes}

@compute @workgroup_size( ${n}, ${s}, ${i} )
fn main( ${t.attributes} ) {

	// system
	instanceIndex = globalId.x
		+ globalId.y * ( ${n} * numWorkgroups.x )
		+ globalId.z * ( ${n} * numWorkgroups.x ) * ( ${s} * numWorkgroups.y );

	// vars
	${t.vars}

	// flow
	${t.flow}

}
`}_getWGSLStruct(t,e){return`
struct ${t} {
${e}
};`}_getWGSLStructBinding(t,e,n,s=0,i=0){const a=t+"Struct";return`${this._getWGSLStruct(a,e)}
@binding( ${s} ) @group( ${i} )
var<${n}> ${t} : ${a};`}}class uq{constructor(t){this.backend=t}getCurrentDepthStencilFormat(t){let e;return t.depth&&(t.depthTexture!==null?e=this.getTextureFormatGPU(t.depthTexture):t.stencil?e=lt.Depth24PlusStencil8:e=lt.Depth24Plus),e}getTextureFormatGPU(t){return this.backend.get(t).format}getTextureSampleData(t){let e;if(t.isFramebufferTexture)e=1;else if(t.isDepthTexture&&!t.renderTarget){const i=this.backend.renderer,a=i.getRenderTarget();e=a?a.samples:i.currentSamples}else t.renderTarget&&(e=t.renderTarget.samples);e=e||1;const n=e>1&&t.renderTarget!==null&&t.isDepthTexture!==!0&&t.isFramebufferTexture!==!0;return{samples:e,primarySamples:n?1:e,isMSAA:n}}getCurrentColorFormat(t){let e;return t.textures!==null?e=this.getTextureFormatGPU(t.textures[0]):e=this.getPreferredCanvasFormat(),e}getCurrentColorFormats(t){return t.textures!==null?t.textures.map(e=>this.getTextureFormatGPU(e)):[this.getPreferredCanvasFormat()]}getCurrentColorSpace(t){return t.textures!==null?t.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(t,e){if(t.isPoints)return fg.PointList;if(t.isLineSegments||t.isMesh&&e.wireframe===!0)return fg.LineList;if(t.isLine)return fg.LineStrip;if(t.isMesh)return fg.TriangleList}getSampleCount(t){return t>=4?4:1}getSampleCountRenderContext(t){return t.textures!==null?this.getSampleCount(t.sampleCount):this.getSampleCount(this.backend.renderer.currentSamples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===gi)return lt.BGRA8Unorm;if(e===ni)return lt.RGBA16Float;throw new Error("Unsupported output buffer type.")}}const ZD=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&ZD.set(Float16Array,["float16"]);const hq=new Map([[tC,["float16"]]]),dq=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class fq{constructor(t){this.backend=t}createAttribute(t,e){const n=this._getBufferAttribute(t),s=this.backend,i=s.get(n);let a=i.buffer;if(a===void 0){const c=s.device;let u=n.array;if(t.normalized===!1){if(u.constructor===Int16Array||u.constructor===Int8Array)u=new Int32Array(u);else if((u.constructor===Uint16Array||u.constructor===Uint8Array)&&(u=new Uint32Array(u),e&GPUBufferUsage.INDEX))for(let p=0;p<u.length;p++)u[p]===65535&&(u[p]=4294967295)}if(n.array=u,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){u=new u.constructor(n.count*4);for(let p=0;p<n.count;p++)u.set(n.array.subarray(p*3,p*3+3),p*4);n.itemSize=4,n.array=u,i._force3to4BytesAlignment=!0}const d=u.byteLength,f=d+(4-d%4)%4;a=c.createBuffer({label:n.name,size:f,usage:e,mappedAtCreation:!0}),new u.constructor(a.getMappedRange()).set(u),a.unmap(),i.buffer=a}}updateAttribute(t){const e=this._getBufferAttribute(t),n=this.backend,s=n.device,i=n.get(e),a=n.get(e).buffer;let c=e.array;if(i._force3to4BytesAlignment===!0){c=new c.constructor(e.count*4);for(let d=0;d<e.count;d++)c.set(e.array.subarray(d*3,d*3+3),d*4);e.array=c}const u=e.updateRanges;if(u.length===0)s.queue.writeBuffer(a,0,c,0);else{const d=vy(c),f=d?1:c.BYTES_PER_ELEMENT;for(let p=0,g=u.length;p<g;p++){const y=u[p];let x,S;if(i._force3to4BytesAlignment===!0){const M=Math.floor(y.start/3),N=Math.ceil(y.count/3);x=M*4*f,S=N*4*f}else x=y.start*f,S=y.count*f;const T=x*(d?c.BYTES_PER_ELEMENT:1);s.queue.writeBuffer(a,T,c,x,S)}e.clearUpdateRanges()}}createShaderVertexBuffers(t){const e=t.getAttributes(),n=new Map;for(let s=0;s<e.length;s++){const i=e[s],a=i.array.BYTES_PER_ELEMENT,c=this._getBufferAttribute(i);let u=n.get(c);if(u===void 0){let p,g;i.isInterleavedBufferAttribute===!0?(p=i.data.stride*a,g=i.data.isInstancedInterleavedBuffer?pg.Instance:pg.Vertex):(p=i.itemSize*a,g=i.isInstancedBufferAttribute?pg.Instance:pg.Vertex),i.normalized===!1&&(i.array.constructor===Int16Array||i.array.constructor===Uint16Array)&&(p=4),u={arrayStride:p,attributes:[],stepMode:g},n.set(c,u)}const d=this._getVertexFormat(i),f=i.isInterleavedBufferAttribute===!0?i.offset*a:0;u.attributes.push({shaderLocation:s,offset:f,format:d})}return Array.from(n.values())}destroyAttribute(t){const e=this.backend;e.get(this._getBufferAttribute(t)).buffer.destroy(),e.delete(t)}async getArrayBufferAsync(t){const e=this.backend,n=e.device,i=e.get(this._getBufferAttribute(t)).buffer,a=i.size,c=n.createBuffer({label:`${t.name}_readback`,size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),u=n.createCommandEncoder({label:`readback_encoder_${t.name}`});u.copyBufferToBuffer(i,0,c,0,a);const d=u.finish();n.queue.submit([d]),await c.mapAsync(GPUMapMode.READ);const f=c.getMappedRange(),p=new t.array.constructor(f.slice(0));return c.unmap(),p.buffer}_getVertexFormat(t){const{itemSize:e,normalized:n}=t,s=t.array.constructor,i=t.constructor;let a;if(e===1)a=dq.get(s);else{const u=(hq.get(i)||ZD.get(s))[n?1:0];if(u){const d=s.BYTES_PER_ELEMENT*e,p=Math.floor((d+3)/4)*4/s.BYTES_PER_ELEMENT;if(p%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");a=`${u}x${p}`}}return a||Ht("WebGPUAttributeUtils: Vertex format not supported yet."),a}_getBufferAttribute(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}class pq{constructor(t){this.layoutGPU=t,this.usedTimes=0}}class mq{constructor(t){this.backend=t,this._bindGroupLayoutCache=new Map}createBindingsLayout(t){const e=this.backend,n=e.device,s=e.get(t);if(s.layout)return s.layout.layoutGPU;const i=this._createLayoutEntries(t),a=Bd(JSON.stringify(i));let c=this._bindGroupLayoutCache.get(a);return c===void 0&&(c=new pq(n.createBindGroupLayout({entries:i})),this._bindGroupLayoutCache.set(a,c)),c.usedTimes++,s.layout=c,s.layoutKey=a,c.layoutGPU}createBindings(t,e,n,s=0){const{backend:i}=this,a=i.get(t),c=this.createBindingsLayout(t);let u;n>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[n]===s&&(u=a.groups[n])),u===void 0&&(u=this.createBindGroup(t,c),n>0&&(a.groups[n]=u,a.versions[n]=s)),a.group=u}updateBinding(t){const e=this.backend,n=e.device,s=t.buffer,i=e.get(t).buffer,a=t.updateRanges;if(a.length===0)n.queue.writeBuffer(i,0,s,0);else{const c=vy(s),u=c?1:s.BYTES_PER_ELEMENT;for(let d=0,f=a.length;d<f;d++){const p=a[d],g=p.start*u,y=p.count*u,x=g*(c?s.BYTES_PER_ELEMENT:1);n.queue.writeBuffer(i,x,s,g,y)}}}createBindGroupIndex(t,e){const s=this.backend.device,i=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a=t[0],c=s.createBuffer({label:"bindingCameraIndex_"+a,size:16,usage:i});s.queue.writeBuffer(c,0,t,0);const u=[{binding:0,resource:{buffer:c}}];return s.createBindGroup({label:"bindGroupCameraIndex_"+a,layout:e,entries:u})}createBindGroup(t,e){const n=this.backend,s=n.device;let i=0;const a=[];for(const c of t.bindings){if(c.isUniformBuffer){const u=n.get(c);if(u.buffer===void 0){const d=c.byteLength,f=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,p=[];c.visibility&Ko.VERTEX&&p.push("vertex"),c.visibility&Ko.FRAGMENT&&p.push("fragment"),c.visibility&Ko.COMPUTE&&p.push("compute");const g=`(${p.join(",")})`,y=s.createBuffer({label:`bindingBuffer${c.id}_${c.name}_${g}`,size:d,usage:f});u.buffer=y}a.push({binding:i,resource:{buffer:u.buffer}})}else if(c.isStorageBuffer){const u=n.get(c.attribute).buffer;a.push({binding:i,resource:{buffer:u}})}else if(c.isSampledTexture){const u=n.get(c.texture);let d;if(u.externalTexture!==void 0)d=s.importExternalTexture({source:u.externalTexture});else{const f=c.store?1:u.texture.mipLevelCount,p=c.store?c.mipLevel:0;let g=`view-${u.texture.width}-${u.texture.height}`;if(u.texture.depthOrArrayLayers>1&&(g+=`-${u.texture.depthOrArrayLayers}`),g+=`-${f}-${p}`,d=u[g],d===void 0){const y=qW.All;let x;c.isSampledCubeTexture?x=hi.Cube:c.isSampledTexture3D?x=hi.ThreeD:c.texture.isArrayTexture||c.texture.isDataArrayTexture||c.texture.isCompressedArrayTexture?x=hi.TwoDArray:x=hi.TwoD,d=u[g]=u.texture.createView({aspect:y,dimension:x,mipLevelCount:f,baseMipLevel:p})}}a.push({binding:i,resource:d})}else if(c.isSampler){const u=n.get(c.texture);a.push({binding:i,resource:u.sampler})}i++}return s.createBindGroup({label:"bindGroup_"+t.name,layout:e,entries:a})}_createLayoutEntries(t){const e=[];let n=0;for(const s of t.bindings){const i=this.backend,a={binding:n,visibility:s.visibility};if(s.isUniformBuffer||s.isStorageBuffer){const c={};s.isStorageBuffer&&(s.visibility&Ko.COMPUTE&&(s.access===si.READ_WRITE||s.access===si.WRITE_ONLY)?c.type=l2.Storage:c.type=l2.ReadOnlyStorage),a.buffer=c}else if(s.isSampledTexture&&s.store){const c={};c.format=this.backend.get(s.texture).texture.format;const u=s.access;u===si.READ_WRITE?c.access=c2.ReadWrite:u===si.WRITE_ONLY?c.access=c2.WriteOnly:c.access=c2.ReadOnly,s.texture.isArrayTexture?c.viewDimension=hi.TwoDArray:s.texture.is3DTexture&&(c.viewDimension=hi.ThreeD),a.storageTexture=c}else if(s.isSampledTexture){const c={},{primarySamples:u}=i.utils.getTextureSampleData(s.texture);if(u>1&&(c.multisampled=!0,s.texture.isDepthTexture||(c.sampleType=cu.UnfilterableFloat)),s.texture.isDepthTexture)i.compatibilityMode&&s.texture.compareFunction===null?c.sampleType=cu.UnfilterableFloat:c.sampleType=cu.Depth;else if(s.texture.isDataTexture||s.texture.isDataArrayTexture||s.texture.isData3DTexture){const d=s.texture.type;d===di?c.sampleType=cu.SInt:d===Qn?c.sampleType=cu.UInt:d===Ri&&(this.backend.hasFeature("float32-filterable")?c.sampleType=cu.Float:c.sampleType=cu.UnfilterableFloat)}s.isSampledCubeTexture?c.viewDimension=hi.Cube:s.texture.isArrayTexture||s.texture.isDataArrayTexture||s.texture.isCompressedArrayTexture?c.viewDimension=hi.TwoDArray:s.isSampledTexture3D&&(c.viewDimension=hi.ThreeD),a.texture=c}else if(s.isSampler){const c={};s.texture.isDepthTexture&&(s.texture.compareFunction!==null&&i.hasCompatibility(xc.TEXTURE_COMPARE)?c.type=dE.Comparison:c.type=dE.NonFiltering),a.sampler=c}else Ht(`WebGPUBindingUtils: Unsupported binding "${s}".`);e.push(a),n++}return e}deleteBindGroupData(t){const{backend:e}=this,n=e.get(t);n.layout&&(n.layout.usedTimes--,n.layout.usedTimes===0&&this._bindGroupLayoutCache.delete(n.layoutKey),n.layout=void 0,n.layoutKey=void 0)}dispose(){this._bindGroupLayoutCache.clear()}}class gq{constructor(t){this.backend=t,this._activePipelines=new WeakMap}setPipeline(t,e){this._activePipelines.get(t)!==e&&(t.setPipeline(e),this._activePipelines.set(t,e))}_getSampleCount(t){return this.backend.utils.getSampleCountRenderContext(t)}createRenderPipeline(t,e){const{object:n,material:s,geometry:i,pipeline:a}=t,{vertexProgram:c,fragmentProgram:u}=a,d=this.backend,f=d.device,p=d.utils,g=d.get(a),y=[];for(const dt of t.getBindings()){const wt=d.get(dt),{layoutGPU:ft}=wt.layout;y.push(ft)}const x=d.attributeUtils.createShaderVertexBuffers(t);let S;s.blending!==tl&&(s.blending!==fi||s.transparent!==!1)&&(S=this._getBlending(s));let T={};s.stencilWrite===!0&&(T={compare:this._getStencilCompare(s),failOp:this._getStencilOperation(s.stencilFail),depthFailOp:this._getStencilOperation(s.stencilZFail),passOp:this._getStencilOperation(s.stencilZPass)});const M=this._getColorWriteMask(s),N=[];if(t.context.textures!==null){const dt=t.context.textures,wt=t.context.mrt;for(let ft=0;ft<dt.length;ft++){const U=dt[ft],K=p.getTextureFormatGPU(U);let nt;if(wt!==null)if(this.backend.compatibilityMode!==!0){const ht=wt.getBlendMode(U.name);ht.blending===Sw?nt=S:ht.blending!==tl&&(nt=this._getBlending(ht))}else rn("WebGPURenderer: Multiple Render Targets (MRT) blending configuration is not fully supported in compatibility mode. The material blending will be used for all render targets."),nt=S;else nt=S;N.push({format:K,blend:nt,writeMask:M})}}else{const dt=p.getCurrentColorFormat(t.context);N.push({format:dt,blend:S,writeMask:M})}const v=d.get(c).module,A=d.get(u).module,R=this._getPrimitiveState(n,i,s),F=this._getDepthCompare(s),D=p.getCurrentDepthStencilFormat(t.context),O=this._getSampleCount(t.context),B={label:`renderPipeline_${s.name||s.type}_${s.id}`,vertex:Object.assign({},v,{buffers:x}),fragment:Object.assign({},A,{targets:N}),primitive:R,multisample:{count:O,alphaToCoverageEnabled:s.alphaToCoverage&&O>1},layout:f.createPipelineLayout({bindGroupLayouts:y})},z={},tt=t.context.depth,j=t.context.stencil;if((tt===!0||j===!0)&&(tt===!0&&(z.format=D,z.depthWriteEnabled=s.depthWrite,z.depthCompare=F),j===!0&&(z.stencilFront=T,z.stencilBack=T,z.stencilReadMask=s.stencilFuncMask,z.stencilWriteMask=s.stencilWriteMask),s.polygonOffset===!0&&(z.depthBias=s.polygonOffsetUnits,z.depthBiasSlopeScale=s.polygonOffsetFactor,z.depthBiasClamp=0),B.depthStencil=z),f.pushErrorScope("validation"),e===null)g.pipeline=f.createRenderPipeline(B),f.popErrorScope().then(dt=>{dt!==null&&(g.error=!0,Ht(dt.message))});else{const dt=new Promise(async wt=>{try{g.pipeline=await f.createRenderPipelineAsync(B)}catch{}const ft=await f.popErrorScope();ft!==null&&(g.error=!0,Ht(ft.message)),wt()});e.push(dt)}}createBundleEncoder(t,e="renderBundleEncoder"){const n=this.backend,{utils:s,device:i}=n,a=s.getCurrentDepthStencilFormat(t),c=s.getCurrentColorFormats(t),u=this._getSampleCount(t),d={label:e,colorFormats:c,depthStencilFormat:a,sampleCount:u};return i.createRenderBundleEncoder(d)}createComputePipeline(t,e){const n=this.backend,s=n.device,i=n.get(t.computeProgram).module,a=n.get(t),c=[];for(const u of e){const d=n.get(u),{layoutGPU:f}=d.layout;c.push(f)}a.pipeline=s.createComputePipeline({compute:i,layout:s.createPipelineLayout({bindGroupLayouts:c})})}_getBlending(t){let e,n;const s=t.blending,i=t.blendSrc,a=t.blendDst,c=t.blendEquation;if(s===ld){const u=t.blendSrcAlpha!==null?t.blendSrcAlpha:i,d=t.blendDstAlpha!==null?t.blendDstAlpha:a,f=t.blendEquationAlpha!==null?t.blendEquationAlpha:c;e={srcFactor:this._getBlendFactor(i),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(c)},n={srcFactor:this._getBlendFactor(u),dstFactor:this._getBlendFactor(d),operation:this._getBlendOperation(f)}}else{const u=t.premultipliedAlpha,d=(f,p,g,y)=>{e={srcFactor:f,dstFactor:p,operation:lu.Add},n={srcFactor:g,dstFactor:y,operation:lu.Add}};if(u)switch(s){case fi:d(Fe.One,Fe.OneMinusSrcAlpha,Fe.One,Fe.OneMinusSrcAlpha);break;case Sr:d(Fe.One,Fe.One,Fe.One,Fe.One);break;case sd:d(Fe.Zero,Fe.OneMinusSrc,Fe.Zero,Fe.One);break;case id:d(Fe.Dst,Fe.OneMinusSrcAlpha,Fe.Zero,Fe.One);break}else switch(s){case fi:d(Fe.SrcAlpha,Fe.OneMinusSrcAlpha,Fe.One,Fe.OneMinusSrcAlpha);break;case Sr:d(Fe.SrcAlpha,Fe.One,Fe.One,Fe.One);break;case sd:Ht(`WebGPURenderer: "SubtractiveBlending" requires "${t.isMaterial?"material":"blendMode"}.premultipliedAlpha = true".`);break;case id:Ht(`WebGPURenderer: "MultiplyBlending" requires "${t.isMaterial?"material":"blendMode"}.premultipliedAlpha = true".`);break}}if(e!==void 0&&n!==void 0)return{color:e,alpha:n};Ht("WebGPURenderer: Invalid blending: ",s)}_getBlendFactor(t){let e;switch(t){case ic:e=Fe.Zero;break;case B3:e=Fe.One;break;case D3:e=Fe.Src;break;case L3:e=Fe.OneMinusSrc;break;case Np:e=Fe.SrcAlpha;break;case Rp:e=Fe.OneMinusSrcAlpha;break;case U3:e=Fe.Dst;break;case P3:e=Fe.OneMinusDst;break;case O3:e=Fe.DstAlpha;break;case F3:e=Fe.OneMinusDstAlpha;break;case z3:e=Fe.SrcAlphaSaturated;break;case pV:e=Fe.Constant;break;case mV:e=Fe.OneMinusConstant;break;default:Ht("WebGPURenderer: Blend factor not supported.",t)}return e}_getStencilCompare(t){let e;const n=t.stencilFunc;switch(n){case sU:e=Js.Never;break;case O2:e=Js.Always;break;case iU:e=Js.Less;break;case oU:e=Js.LessEqual;break;case rU:e=Js.Equal;break;case cU:e=Js.GreaterEqual;break;case aU:e=Js.Greater;break;case lU:e=Js.NotEqual;break;default:Ht("WebGPURenderer: Invalid stencil function.",n)}return e}_getStencilOperation(t){let e;switch(t){case bu:e=$l.Keep;break;case KF:e=$l.Zero;break;case ZF:e=$l.Replace;break;case nU:e=$l.Invert;break;case QF:e=$l.IncrementClamp;break;case JF:e=$l.DecrementClamp;break;case tU:e=$l.IncrementWrap;break;case eU:e=$l.DecrementWrap;break;default:Ht("WebGPURenderer: Invalid stencil operation.",e)}return e}_getBlendOperation(t){let e;switch(t){case qr:e=lu.Add;break;case E3:e=lu.Subtract;break;case C3:e=lu.ReverseSubtract;break;case FF:e=lu.Min;break;case UF:e=lu.Max;break;default:Ht("WebGPUPipelineUtils: Blend equation not supported.",t)}return e}_getPrimitiveState(t,e,n){const s={},i=this.backend.utils;s.topology=i.getPrimitiveTopology(t,n),e.index!==null&&t.isLine===!0&&t.isLineSegments!==!0&&(s.stripIndexFormat=e.index.array instanceof Uint16Array?qy.Uint16:qy.Uint32);let a=n.side===us;return t.isMesh&&t.matrixWorld.determinant()<0&&(a=!a),s.frontFace=a===!0?cE.CW:cE.CCW,s.cullMode=n.side===En?uE.None:uE.Back,s}_getColorWriteMask(t){return t.colorWrite===!0?hE.All:hE.None}_getDepthCompare(t){let e;if(t.depthTest===!1)e=Js.Always;else{const n=this.backend.parameters.reversedDepthBuffer?K3[t.depthFunc]:t.depthFunc;switch(n){case qg:e=Js.Never;break;case $g:e=Js.Always;break;case Xg:e=Js.Less;break;case xd:e=Js.LessEqual;break;case jg:e=Js.Equal;break;case Yg:e=Js.GreaterEqual;break;case Kg:e=Js.Greater;break;case Zg:e=Js.NotEqual;break;default:Ht("WebGPUPipelineUtils: Invalid depth function.",n)}}return e}}class yq extends YD{constructor(t,e,n=2048){super(n),this.device=t,this.type=e,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${e}`});const s=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${e}`,size:s,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${e}`,size:s,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(t){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return rn(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const e=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(t,e),e}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const t=new Map(this.queryOffsets),e=this.currentQueryIndex,n=e*8;this.currentQueryIndex=0,this.queryOffsets.clear();const s=this.device.createCommandEncoder();s.resolveQuerySet(this.querySet,0,e,this.resolveBuffer,0),s.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const i=s.finish();if(this.device.queue.submit([i]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const a=new BigUint64Array(this.resultBuffer.getMappedRange(0,n)),c={},u=[];for(const[f,p]of t){const g=f.match(/^(.*):f(\d+)$/),y=parseInt(g[2]);u.includes(y)===!1&&u.push(y),c[y]===void 0&&(c[y]=0);const x=a[p],S=a[p+1],T=Number(S-x)/1e6;this.timestamps.set(f,T),c[y]+=T}const d=c[u[u.length-1]];return this.resultBuffer.unmap(),this.lastValue=d,this.frames=u,d}catch(t){return Ht("Error resolving queries:",t),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(t){Ht("Error waiting for pending resolve:",t)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(t){Ht("Error unmapping buffer:",t)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class xq extends jD{constructor(t={}){super(t),this.isWebGPUBackend=!0,this.parameters.alpha=t.alpha===void 0?!0:t.alpha,this.parameters.requiredLimits=t.requiredLimits===void 0?{}:t.requiredLimits,this.compatibilityMode=null,this.device=null,this.defaultRenderPassdescriptor=null,this.utils=new uq(this),this.attributeUtils=new fq(this),this.bindingUtils=new mq(this),this.pipelineUtils=new gq(this),this.textureUtils=new JW(this),this.occludedResolveCache=new Map;const e=typeof navigator>"u"?!0:/Android/.test(navigator.userAgent)===!1;this._compatibility={[xc.TEXTURE_COMPARE]:e}}async init(t){await super.init(t);const e=this.parameters;let n;if(e.device===void 0){const s={powerPreference:e.powerPreference,featureLevel:"compatibility"},i=typeof navigator<"u"?await navigator.gpu.requestAdapter(s):null;if(i===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const a=Object.values(uw),c=[];for(const d of a)i.features.has(d)&&c.push(d);const u={requiredFeatures:c,requiredLimits:e.requiredLimits};n=await i.requestDevice(u)}else n=e.device;this.compatibilityMode=!n.features.has("core-features-and-limits"),this.compatibilityMode&&(t._samples=0),n.lost.then(s=>{if(s.reason==="destroyed")return;const i={api:"WebGPU",message:s.message||"Unknown reason",reason:s.reason||null,originalEvent:s};t.onDeviceLost(i)}),this.device=n,this.trackTimestamp=this.trackTimestamp&&this.hasFeature(uw.TimestampQuery),this.updateSize()}get context(){const t=this.renderer.getCanvasTarget(),e=this.get(t);let n=e.context;if(n===void 0){const s=this.parameters;t.isDefaultCanvasTarget===!0&&s.context!==void 0?n=s.context:n=t.domElement.getContext("webgpu"),"setAttribute"in t.domElement&&t.domElement.setAttribute("data-engine",`three.js r${kp} webgpu`);const i=s.alpha?"premultiplied":"opaque",a=s.outputType===ni?"extended":"standard";n.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:i,toneMapping:{mode:a}}),e.context=n}return n}get coordinateSystem(){return Zr}async getArrayBufferAsync(t){return await this.attributeUtils.getArrayBufferAsync(t)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){const t=this.renderer,e=t.getCanvasTarget(),n=this.get(e),s=t.currentSamples;let i=n.descriptor;if(i===void 0||n.samples!==s){i={colorAttachments:[{view:null}]},(t.depth===!0||t.stencil===!0)&&(i.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(t.depth,t.stencil).createView()});const c=i.colorAttachments[0];s>0?c.view=this.textureUtils.getColorBuffer().createView():c.resolveTarget=void 0,n.descriptor=i,n.samples=s}const a=i.colorAttachments[0];return s>0?a.resolveTarget=this.context.getCurrentTexture().createView():a.view=this.context.getCurrentTexture().createView(),i}_isRenderCameraDepthArray(t){return t.depthTexture&&t.depthTexture.image.depth>1&&t.camera.isArrayCamera}_getRenderPassDescriptor(t,e={}){const n=t.renderTarget,s=this.get(n);let i=s.descriptors;(i===void 0||s.width!==n.width||s.height!==n.height||s.samples!==n.samples)&&(i={},s.descriptors=i);const a=t.getCacheKey();let c=i[a];if(c===void 0){const d=t.textures,f=[];let p;const g=this._isRenderCameraDepthArray(t);for(let y=0;y<d.length;y++){const x=this.get(d[y]),S={label:`colorAttachment_${y}`,baseMipLevel:t.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:t.activeCubeFace,arrayLayerCount:1,dimension:hi.TwoD};if(n.isRenderTarget3D)p=t.activeCubeFace,S.baseArrayLayer=0,S.dimension=hi.ThreeD,S.depthOrArrayLayers=d[y].image.depth;else if(n.isRenderTarget&&d[y].image.depth>1)if(g===!0){const T=t.camera.cameras;for(let M=0;M<T.length;M++){const N={...S,baseArrayLayer:M,arrayLayerCount:1,dimension:hi.TwoD},v=x.texture.createView(N);f.push({view:v,resolveTarget:void 0,depthSlice:void 0})}}else S.dimension=hi.TwoDArray,S.depthOrArrayLayers=d[y].image.depth;if(g!==!0){const T=x.texture.createView(S);let M,N;x.msaaTexture!==void 0?(M=x.msaaTexture.createView(),N=T):(M=T,N=void 0),f.push({view:M,resolveTarget:N,depthSlice:p})}}if(c={textureViews:f},t.depth){const y=this.get(t.depthTexture),x={};(t.depthTexture.isArrayTexture||t.depthTexture.isCubeTexture)&&(x.dimension=hi.TwoD,x.arrayLayerCount=1,x.baseArrayLayer=t.activeCubeFace),c.depthStencilView=y.texture.createView(x)}i[a]=c,s.width=n.width,s.height=n.height,s.samples=n.samples,s.activeMipmapLevel=t.activeMipmapLevel,s.activeCubeFace=t.activeCubeFace}const u={colorAttachments:[]};for(let d=0;d<c.textureViews.length;d++){const f=c.textureViews[d];let p={r:0,g:0,b:0,a:1};d===0&&e.clearValue&&(p=e.clearValue),u.colorAttachments.push({view:f.view,depthSlice:f.depthSlice,resolveTarget:f.resolveTarget,loadOp:e.loadOp||nn.Load,storeOp:e.storeOp||Ai.Store,clearValue:p})}return c.depthStencilView&&(u.depthStencilAttachment={view:c.depthStencilView}),u}beginRender(t){const e=this.get(t),n=this.device,s=t.occlusionQueryCount;let i;s>0&&(e.currentOcclusionQuerySet&&e.currentOcclusionQuerySet.destroy(),e.currentOcclusionQueryBuffer&&e.currentOcclusionQueryBuffer.destroy(),e.currentOcclusionQuerySet=e.occlusionQuerySet,e.currentOcclusionQueryBuffer=e.occlusionQueryBuffer,e.currentOcclusionQueryObjects=e.occlusionQueryObjects,i=n.createQuerySet({type:"occlusion",count:s,label:`occlusionQuerySet_${t.id}`}),e.occlusionQuerySet=i,e.occlusionQueryIndex=0,e.occlusionQueryObjects=new Array(s),e.lastOcclusionObject=null);let a;t.textures===null?a=this._getDefaultRenderPassDescriptor():a=this._getRenderPassDescriptor(t,{loadOp:nn.Load}),this.initTimestampQuery(Yo.RENDER,this.getTimestampUID(t),a),a.occlusionQuerySet=i;const c=a.depthStencilAttachment;if(t.textures!==null){const d=a.colorAttachments;for(let f=0;f<d.length;f++){const p=d[f];t.clearColor?(p.clearValue=f===0?t.clearColorValue:{r:0,g:0,b:0,a:1},p.loadOp=nn.Clear):p.loadOp=nn.Load,p.storeOp=Ai.Store}}else{const d=a.colorAttachments[0];t.clearColor?(d.clearValue=t.clearColorValue,d.loadOp=nn.Clear):d.loadOp=nn.Load,d.storeOp=Ai.Store}t.depth&&(t.clearDepth?(c.depthClearValue=t.clearDepthValue,c.depthLoadOp=nn.Clear):c.depthLoadOp=nn.Load,c.depthStoreOp=Ai.Store),t.stencil&&(t.clearStencil?(c.stencilClearValue=t.clearStencilValue,c.stencilLoadOp=nn.Clear):c.stencilLoadOp=nn.Load,c.stencilStoreOp=Ai.Store);const u=n.createCommandEncoder({label:"renderContext_"+t.id});if(this._isRenderCameraDepthArray(t)===!0){const d=t.camera.cameras;!e.layerDescriptors||e.layerDescriptors.length!==d.length?this._createDepthLayerDescriptors(t,e,a,d):this._updateDepthLayerDescriptors(t,e,d),e.bundleEncoders=[],e.bundleSets=[];for(let f=0;f<d.length;f++){const p=this.pipelineUtils.createBundleEncoder(t,"renderBundleArrayCamera_"+f),g={attributes:{},bindingGroups:[],pipeline:null,index:null};e.bundleEncoders.push(p),e.bundleSets.push(g)}e.currentPass=null}else{const d=u.beginRenderPass(a);e.currentPass=d,t.viewport&&this.updateViewport(t),t.scissor&&this.updateScissor(t)}e.descriptor=a,e.encoder=u,e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.renderBundles=[]}_createDepthLayerDescriptors(t,e,n,s){const i=n.depthStencilAttachment;e.layerDescriptors=[];const a=this.get(t.depthTexture);a.viewCache||(a.viewCache=[]);for(let c=0;c<s.length;c++){const u={...n,colorAttachments:[{...n.colorAttachments[0],view:n.colorAttachments[c].view}]};if(n.depthStencilAttachment){const d=c;a.viewCache[d]||(a.viewCache[d]=a.texture.createView({dimension:hi.TwoD,baseArrayLayer:c,arrayLayerCount:1})),u.depthStencilAttachment={view:a.viewCache[d],depthLoadOp:i.depthLoadOp||nn.Clear,depthStoreOp:i.depthStoreOp||Ai.Store,depthClearValue:i.depthClearValue||1},t.stencil&&(u.depthStencilAttachment.stencilLoadOp=i.stencilLoadOp,u.depthStencilAttachment.stencilStoreOp=i.stencilStoreOp,u.depthStencilAttachment.stencilClearValue=i.stencilClearValue)}else u.depthStencilAttachment={...i};e.layerDescriptors.push(u)}}_updateDepthLayerDescriptors(t,e,n){for(let s=0;s<n.length;s++){const i=e.layerDescriptors[s];if(i.depthStencilAttachment){const a=i.depthStencilAttachment;t.depth&&(t.clearDepth?(a.depthClearValue=t.clearDepthValue,a.depthLoadOp=nn.Clear):a.depthLoadOp=nn.Load),t.stencil&&(t.clearStencil?(a.stencilClearValue=t.clearStencilValue,a.stencilLoadOp=nn.Clear):a.stencilLoadOp=nn.Load)}}}finishRender(t){const e=this.get(t),n=t.occlusionQueryCount;e.renderBundles.length>0&&e.currentPass.executeBundles(e.renderBundles),n>e.occlusionQueryIndex&&e.currentPass.endOcclusionQuery();const s=e.encoder;if(this._isRenderCameraDepthArray(t)===!0){const i=[];for(let a=0;a<e.bundleEncoders.length;a++){const c=e.bundleEncoders[a];i.push(c.finish())}for(let a=0;a<e.layerDescriptors.length;a++)if(a<i.length){const c=e.layerDescriptors[a],u=s.beginRenderPass(c);if(t.viewport){const{x:d,y:f,width:p,height:g,minDepth:y,maxDepth:x}=t.viewportValue;u.setViewport(d,f,p,g,y,x)}if(t.scissor){const{x:d,y:f,width:p,height:g}=t.scissorValue;u.setScissorRect(d,f,p,g)}u.executeBundles([i[a]]),u.end()}}else e.currentPass&&e.currentPass.end();if(n>0){const i=n*8;let a=this.occludedResolveCache.get(i);a===void 0&&(a=this.device.createBuffer({size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(i,a));const c=this.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});e.encoder.resolveQuerySet(e.occlusionQuerySet,0,n,a,0),e.encoder.copyBufferToBuffer(a,0,c,0,i),e.occlusionQueryBuffer=c,this.resolveOccludedAsync(t)}if(this.device.queue.submit([e.encoder.finish()]),t.textures!==null){const i=t.textures;for(let a=0;a<i.length;a++){const c=i[a];c.generateMipmaps===!0&&this.textureUtils.generateMipmaps(c)}}}isOccluded(t,e){const n=this.get(t);return n.occluded&&n.occluded.has(e)}async resolveOccludedAsync(t){const e=this.get(t),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:s}=e;if(n&&s){const i=new WeakSet;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const a=n.getMappedRange(),c=new BigUint64Array(a);for(let u=0;u<s.length;u++)c[u]===BigInt(0)&&i.add(s[u]);n.destroy(),e.occluded=i}}updateViewport(t){const{currentPass:e}=this.get(t),{x:n,y:s,width:i,height:a,minDepth:c,maxDepth:u}=t.viewportValue;e.setViewport(n,s,i,a,c,u)}updateScissor(t){const{currentPass:e}=this.get(t),{x:n,y:s,width:i,height:a}=t.scissorValue;e.setScissorRect(n,s,i,a)}getClearColor(){const t=super.getClearColor();return this.renderer.alpha===!0&&(t.r*=t.a,t.g*=t.a,t.b*=t.a),t}clear(t,e,n,s=null){const i=this.device,a=this.renderer;let c=[],u,d,f,p;if(t){const x=this.getClearColor();d={r:x.r,g:x.g,b:x.b,a:x.a}}if(s===null){f=a.depth,p=a.stencil;const x=this._getDefaultRenderPassDescriptor();if(t){c=x.colorAttachments;const S=c[0];S.clearValue=d,S.loadOp=nn.Clear,S.storeOp=Ai.Store}(f||p)&&(u=x.depthStencilAttachment)}else{f=s.depth,p=s.stencil;const x={loadOp:t?nn.Clear:nn.Load,clearValue:t?d:void 0};f&&(x.depthLoadOp=e?nn.Clear:nn.Load,x.depthClearValue=e?a.getClearDepth():void 0,x.depthStoreOp=Ai.Store),p&&(x.stencilLoadOp=n?nn.Clear:nn.Load,x.stencilClearValue=n?a.getClearStencil():void 0,x.stencilStoreOp=Ai.Store);const S=this._getRenderPassDescriptor(s,x);c=S.colorAttachments,u=S.depthStencilAttachment}f&&u&&(e?(u.depthLoadOp=nn.Clear,u.depthClearValue=a.getClearDepth(),u.depthStoreOp=Ai.Store):(u.depthLoadOp=nn.Load,u.depthStoreOp=Ai.Store)),p&&u&&(n?(u.stencilLoadOp=nn.Clear,u.stencilClearValue=a.getClearStencil(),u.stencilStoreOp=Ai.Store):(u.stencilLoadOp=nn.Load,u.stencilStoreOp=Ai.Store));const g=i.createCommandEncoder({label:"clear"});g.beginRenderPass({colorAttachments:c,depthStencilAttachment:u}).end(),i.queue.submit([g.finish()])}beginCompute(t){const e=this.get(t),n={label:"computeGroup_"+t.id};this.initTimestampQuery(Yo.COMPUTE,this.getTimestampUID(t),n),e.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+t.id}),e.passEncoderGPU=e.cmdEncoderGPU.beginComputePass(n)}compute(t,e,n,s,i=null){const a=this.get(e),{passEncoderGPU:c}=this.get(t),u=this.get(s).pipeline;this.pipelineUtils.setPipeline(c,u);for(let d=0,f=n.length;d<f;d++){const p=n[d],g=this.get(p);c.setBindGroup(d,g.group)}if(i===null&&(i=e.count),i&&typeof i=="object"&&i.isIndirectStorageBufferAttribute){const d=this.get(i).buffer;c.dispatchWorkgroupsIndirect(d,0);return}if(typeof i=="number"){const d=i;if(a.dispatchSize===void 0||a.count!==d){a.dispatchSize=[0,1,1],a.count=d;const f=e.workgroupSize;let p=f[0];for(let x=1;x<f.length;x++)p*=f[x];const g=Math.ceil(d/p),y=this.device.limits.maxComputeWorkgroupsPerDimension;i=[g,1,1],g>y&&(i[0]=Math.min(g,y),i[1]=Math.ceil(g/y)),a.dispatchSize=i}i=a.dispatchSize}c.dispatchWorkgroups(i[0],i[1]||1,i[2]||1)}finishCompute(t){const e=this.get(t);e.passEncoderGPU.end(),this.device.queue.submit([e.cmdEncoderGPU.finish()])}draw(t,e){const{object:n,material:s,context:i,pipeline:a}=t,c=t.getBindings(),u=this.get(i),d=this.get(a),f=d.pipeline;if(d.error===!0)return;const p=t.getIndex(),g=p!==null,y=t.getDrawParameters();if(y===null)return;const x=(T,M)=>{this.pipelineUtils.setPipeline(T,f),M.pipeline=f;const N=M.bindingGroups;for(let A=0,R=c.length;A<R;A++){const F=c[A],D=this.get(F);N[F.index]!==F.id&&(T.setBindGroup(F.index,D.group),N[F.index]=F.id)}if(g===!0&&M.index!==p){const A=this.get(p).buffer,R=p.array instanceof Uint16Array?qy.Uint16:qy.Uint32;T.setIndexBuffer(A,R),M.index=p}const v=t.getVertexBuffers();for(let A=0,R=v.length;A<R;A++){const F=v[A];if(M.attributes[A]!==F){const D=this.get(F).buffer;T.setVertexBuffer(A,D),M.attributes[A]=F}}i.stencil===!0&&s.stencilWrite===!0&&u.currentStencilRef!==s.stencilRef&&(T.setStencilReference(s.stencilRef),u.currentStencilRef=s.stencilRef)},S=(T,M)=>{if(x(T,M),n.isBatchedMesh===!0){const N=n._multiDrawStarts,v=n._multiDrawCounts,A=n._multiDrawCount,R=n._multiDrawInstances;R!==null&&rn("WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");let F=g===!0?p.array.BYTES_PER_ELEMENT:1;s.wireframe&&(F=n.geometry.attributes.position.count>65535?4:2);for(let D=0;D<A;D++){const O=R?R[D]:1,B=O>1?0:D;g===!0?T.drawIndexed(v[D],O,N[D]/F,0,B):T.draw(v[D],O,N[D],B),e.update(n,v[D],O)}}else if(g===!0){const{vertexCount:N,instanceCount:v,firstVertex:A}=y,R=t.getIndirect();if(R!==null){const F=this.get(R).buffer,D=t.getIndirectOffset(),O=Array.isArray(D)?D:[D];for(let B=0;B<O.length;B++)T.drawIndexedIndirect(F,O[B])}else T.drawIndexed(N,v,A,0,0);e.update(n,N,v)}else{const{vertexCount:N,instanceCount:v,firstVertex:A}=y,R=t.getIndirect();if(R!==null){const F=this.get(R).buffer,D=t.getIndirectOffset(),O=Array.isArray(D)?D:[D];for(let B=0;B<O.length;B++)T.drawIndirect(F,O[B])}else T.draw(N,v,A,0);e.update(n,N,v)}};if(t.camera.isArrayCamera&&t.camera.cameras.length>0){const T=this.get(t.camera),M=t.camera.cameras,N=t.getBindingGroup("cameraIndex");if(T.indexesGPU===void 0||T.indexesGPU.length!==M.length){const A=this.get(N),R=[],F=new Uint32Array([0,0,0,0]);for(let D=0,O=M.length;D<O;D++){F[0]=D;const{layoutGPU:B}=A.layout,z=this.bindingUtils.createBindGroupIndex(F,B);R.push(z)}T.indexesGPU=R}const v=this.renderer.getPixelRatio();for(let A=0,R=M.length;A<R;A++){const F=M[A];if(n.layers.test(F.layers)){const D=F.viewport;let O=u.currentPass,B=u.currentSets;if(u.bundleEncoders){const z=u.bundleEncoders[A],tt=u.bundleSets[A];O=z,B=tt}D&&O.setViewport(Math.floor(D.x*v),Math.floor(D.y*v),Math.floor(D.width*v),Math.floor(D.height*v),i.viewportValue.minDepth,i.viewportValue.maxDepth),N&&T.indexesGPU&&(O.setBindGroup(N.index,T.indexesGPU[A]),B.bindingGroups[N.index]=N.id),S(O,B)}}}else if(u.currentPass){if(u.occlusionQuerySet!==void 0){const T=u.lastOcclusionObject;T!==n&&(T!==null&&T.occlusionTest===!0&&(u.currentPass.endOcclusionQuery(),u.occlusionQueryIndex++),n.occlusionTest===!0&&(u.currentPass.beginOcclusionQuery(u.occlusionQueryIndex),u.occlusionQueryObjects[u.occlusionQueryIndex]=n),u.lastOcclusionObject=n)}S(u.currentPass,u.currentSets)}}needsRenderUpdate(t){const e=this.get(t),{object:n,material:s}=t,i=this.utils,a=i.getSampleCountRenderContext(t.context),c=i.getCurrentColorSpace(t.context),u=i.getCurrentColorFormat(t.context),d=i.getCurrentDepthStencilFormat(t.context),f=i.getPrimitiveTopology(n,s);let p=!1;return(e.material!==s||e.materialVersion!==s.version||e.transparent!==s.transparent||e.blending!==s.blending||e.premultipliedAlpha!==s.premultipliedAlpha||e.blendSrc!==s.blendSrc||e.blendDst!==s.blendDst||e.blendEquation!==s.blendEquation||e.blendSrcAlpha!==s.blendSrcAlpha||e.blendDstAlpha!==s.blendDstAlpha||e.blendEquationAlpha!==s.blendEquationAlpha||e.colorWrite!==s.colorWrite||e.depthWrite!==s.depthWrite||e.depthTest!==s.depthTest||e.depthFunc!==s.depthFunc||e.stencilWrite!==s.stencilWrite||e.stencilFunc!==s.stencilFunc||e.stencilFail!==s.stencilFail||e.stencilZFail!==s.stencilZFail||e.stencilZPass!==s.stencilZPass||e.stencilFuncMask!==s.stencilFuncMask||e.stencilWriteMask!==s.stencilWriteMask||e.side!==s.side||e.alphaToCoverage!==s.alphaToCoverage||e.sampleCount!==a||e.colorSpace!==c||e.colorFormat!==u||e.depthStencilFormat!==d||e.primitiveTopology!==f||e.clippingContextCacheKey!==t.clippingContextCacheKey)&&(e.material=s,e.materialVersion=s.version,e.transparent=s.transparent,e.blending=s.blending,e.premultipliedAlpha=s.premultipliedAlpha,e.blendSrc=s.blendSrc,e.blendDst=s.blendDst,e.blendEquation=s.blendEquation,e.blendSrcAlpha=s.blendSrcAlpha,e.blendDstAlpha=s.blendDstAlpha,e.blendEquationAlpha=s.blendEquationAlpha,e.colorWrite=s.colorWrite,e.depthWrite=s.depthWrite,e.depthTest=s.depthTest,e.depthFunc=s.depthFunc,e.stencilWrite=s.stencilWrite,e.stencilFunc=s.stencilFunc,e.stencilFail=s.stencilFail,e.stencilZFail=s.stencilZFail,e.stencilZPass=s.stencilZPass,e.stencilFuncMask=s.stencilFuncMask,e.stencilWriteMask=s.stencilWriteMask,e.side=s.side,e.alphaToCoverage=s.alphaToCoverage,e.sampleCount=a,e.colorSpace=c,e.colorFormat=u,e.depthStencilFormat=d,e.primitiveTopology=f,e.clippingContextCacheKey=t.clippingContextCacheKey,p=!0),p}getRenderCacheKey(t){const{object:e,material:n}=t,s=this.utils,i=t.context,a=e.isMesh&&e.matrixWorld.determinant()<0;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,a,s.getSampleCountRenderContext(i),s.getCurrentColorSpace(i),s.getCurrentColorFormat(i),s.getCurrentDepthStencilFormat(i),s.getPrimitiveTopology(e,n),t.getGeometryCacheKey(),t.clippingContextCacheKey].join()}updateSampler(t){return this.textureUtils.updateSampler(t)}createDefaultTexture(t){return this.textureUtils.createDefaultTexture(t)}createTexture(t,e){this.textureUtils.createTexture(t,e)}updateTexture(t,e){this.textureUtils.updateTexture(t,e)}generateMipmaps(t){this.textureUtils.generateMipmaps(t)}destroyTexture(t,e=!1){this.textureUtils.destroyTexture(t,e)}async copyTextureToBuffer(t,e,n,s,i,a){return this.textureUtils.copyTextureToBuffer(t,e,n,s,i,a)}initTimestampQuery(t,e,n){if(!this.trackTimestamp)return;this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new yq(this.device,t,2048));const s=this.timestampQueryPool[t],i=s.allocateQueriesForContext(e);n.timestampWrites={querySet:s.querySet,beginningOfPassWriteIndex:i,endOfPassWriteIndex:i+1}}createNodeBuilder(t,e){return new cq(t,e)}createProgram(t){const e=this.get(t);e.module={module:this.device.createShaderModule({code:t.code,label:t.stage+(t.name!==""?`_${t.name}`:"")}),entryPoint:"main"}}destroyProgram(t){this.delete(t)}createRenderPipeline(t,e){this.pipelineUtils.createRenderPipeline(t,e)}createComputePipeline(t,e){this.pipelineUtils.createComputePipeline(t,e)}beginBundle(t){const e=this.get(t);e._currentPass=e.currentPass,e._currentSets=e.currentSets,e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.currentPass=this.pipelineUtils.createBundleEncoder(t)}finishBundle(t,e){const n=this.get(t),i=n.currentPass.finish();this.get(e).bundleGPU=i,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(t,e){this.get(t).renderBundles.push(this.get(e).bundleGPU)}createBindings(t,e,n,s){this.bindingUtils.createBindings(t,e,n,s)}updateBindings(t,e,n,s){this.bindingUtils.createBindings(t,e,n,s)}updateBinding(t){this.bindingUtils.updateBinding(t)}deleteBindGroupData(t){this.bindingUtils.deleteBindGroupData(t)}createIndexAttribute(t){let e=GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST;(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute)&&(e|=GPUBufferUsage.STORAGE),this.attributeUtils.createAttribute(t,e)}createAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(t){this.attributeUtils.updateAttribute(t)}destroyAttribute(t){this.attributeUtils.destroyAttribute(t)}updateSize(){this.delete(this.renderer.getCanvasTarget())}getMaxAnisotropy(){return 16}hasFeature(t){return pE[t]!==void 0&&(t=pE[t]),this.device.features.has(t)}copyTextureToTexture(t,e,n=null,s=null,i=0,a=0){let c=0,u=0,d=0,f=0,p=0,g=0,y=t.image.width,x=t.image.height,S=1;n!==null&&(n.isBox3===!0?(f=n.min.x,p=n.min.y,g=n.min.z,y=n.max.x-n.min.x,x=n.max.y-n.min.y,S=n.max.z-n.min.z):(f=n.min.x,p=n.min.y,y=n.max.x-n.min.x,x=n.max.y-n.min.y,S=1)),s!==null&&(c=s.x,u=s.y,d=s.z||0);const T=this.device.createCommandEncoder({label:"copyTextureToTexture_"+t.id+"_"+e.id}),M=this.get(t).texture,N=this.get(e).texture;T.copyTextureToTexture({texture:M,mipLevel:i,origin:{x:f,y:p,z:g}},{texture:N,mipLevel:a,origin:{x:c,y:u,z:d}},[y,x,S]),this.device.queue.submit([T.finish()]),a===0&&e.generateMipmaps&&this.textureUtils.generateMipmaps(e)}copyFramebufferToTexture(t,e,n){const s=this.get(e);let i=null;e.renderTarget?t.isDepthTexture?i=this.get(e.depthTexture).texture:i=this.get(e.textures[0]).texture:t.isDepthTexture?i=this.textureUtils.getDepthBuffer(e.depth,e.stencil):i=this.context.getCurrentTexture();const a=this.get(t).texture;if(i.format!==a.format){Ht("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",i.format,a.format);return}let c;if(s.currentPass?(s.currentPass.end(),c=s.encoder):c=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+t.id}),c.copyTextureToTexture({texture:i,origin:[n.x,n.y,0]},{texture:a},[n.z,n.w]),t.generateMipmaps&&this.textureUtils.generateMipmaps(t,c),s.currentPass){const{descriptor:u}=s;for(let d=0;d<u.colorAttachments.length;d++)u.colorAttachments[d].loadOp=nn.Load;e.depth&&(u.depthStencilAttachment.depthLoadOp=nn.Load),e.stencil&&(u.depthStencilAttachment.stencilLoadOp=nn.Load),s.currentPass=c.beginRenderPass(u),s.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.viewport&&this.updateViewport(e),e.scissor&&this.updateScissor(e)}else this.device.queue.submit([c.finish()])}hasCompatibility(t){return this._compatibility[xc.TEXTURE_COMPARE]!==void 0?this._compatibility[xc.TEXTURE_COMPARE]:super.hasCompatibility(t)}dispose(){if(this.bindingUtils.dispose(),this.textureUtils.dispose(),this.occludedResolveCache){for(const t of this.occludedResolveCache.values())t.destroy();this.occludedResolveCache.clear()}if(this.timestampQueryPool)for(const t of Object.values(this.timestampQueryPool))t!==null&&t.dispose();this.parameters.device===void 0&&this.device!==null&&this.device.destroy()}}class bq extends ax{constructor(t,e,n,s,i,a){super(t,e,n,s,i,a),this.iesMap=null}copy(t,e){return super.copy(t,e),this.iesMap=t.iesMap,this}}class Sq extends ax{constructor(t,e,n,s,i,a){super(t,e,n,s,i,a),this.aspect=null}copy(t,e){return super.copy(t,e),this.aspect=t.aspect,this}}class wq extends VD{constructor(){super(),this.addMaterial(sI,"MeshPhongMaterial"),this.addMaterial($s,"MeshStandardMaterial"),this.addMaterial(XI,"MeshPhysicalMaterial"),this.addMaterial(ZI,"MeshToonMaterial"),this.addMaterial(Ac,"MeshBasicMaterial"),this.addMaterial(eI,"MeshLambertMaterial"),this.addMaterial($6,"MeshNormalMaterial"),this.addMaterial(JI,"MeshMatcapMaterial"),this.addMaterial(k6,"LineBasicMaterial"),this.addMaterial(W6,"LineDashedMaterial"),this.addMaterial(iV,"PointsMaterial"),this.addMaterial(PB,"SpriteMaterial"),this.addMaterial(lV,"ShadowMaterial"),this.addLight(I9,ls),this.addLight(ZH,Fs),this.addLight(sW,q8),this.addLight(y_,ax),this.addLight(KH,Ro),this.addLight(QH,Vu),this.addLight(tW,X8),this.addLight(JH,bq),this.addLight(nW,Sq),this.addToneMapping(sD,IF),this.addToneMapping(iD,VF),this.addToneMapping(rD,GF),this.addToneMapping(oD,ww),this.addToneMapping(aD,kF),this.addToneMapping(lD,HF)}}class Tq extends MW{constructor(t={}){let e;t.forceWebGL?e=lE:(e=xq,t.getFallback=()=>(Wt("WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new lE(t)));const n=new e(t);super(n,t),this.library=new wq,this.isWebGPURenderer=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}}const mg=Math.PI/2-.01,bE=new G(0,1,0),h2=new G,SE=new G,jf=new Ji(0,0,0,"YXZ");class _q{constructor(t,e,n={}){this.camera=t,this.domElement=e,this.movementSpeed=n.movementSpeed??9,this.lookSensitivity=n.lookSensitivity??.0023,this.activeKeys=new Set,this.yaw=0,this.pitch=0,this.moveForward=0,this.moveStrafe=0,this.moveVertical=0,this.handleClick=this.handleClick.bind(this),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handlePointerLockChange=this.handlePointerLockChange.bind(this),this.handleWindowBlur=this.handleWindowBlur.bind(this),this.syncAnglesFromCamera(),this.domElement.addEventListener("click",this.handleClick),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("keydown",this.handleKeyDown),window.addEventListener("keyup",this.handleKeyUp),document.addEventListener("pointerlockchange",this.handlePointerLockChange),window.addEventListener("blur",this.handleWindowBlur)}isPointerLocked(){return document.pointerLockElement===this.domElement}syncAnglesFromCamera(){jf.setFromQuaternion(this.camera.quaternion,"YXZ"),this.pitch=jf.x,this.yaw=jf.y}handleClick(){this.isPointerLocked()||this.domElement.requestPointerLock()}handleMouseMove(t){this.isPointerLocked()&&(this.yaw-=t.movementX*this.lookSensitivity,this.pitch-=t.movementY*this.lookSensitivity,this.pitch>mg&&(this.pitch=mg),this.pitch<-mg&&(this.pitch=-mg),jf.set(this.pitch,this.yaw,0),this.camera.quaternion.setFromEuler(jf))}handleKeyDown(t){this.isPointerLocked()&&this.activeKeys.add(t.code)}handleKeyUp(t){this.isPointerLocked()&&this.activeKeys.delete(t.code)}handlePointerLockChange(){this.isPointerLocked()?this.syncAnglesFromCamera():this.activeKeys.clear()}handleWindowBlur(){this.activeKeys.clear()}update(t){if(!this.isPointerLocked()){this.activeKeys.clear();return}if(this.moveForward=0,this.moveStrafe=0,this.moveVertical=0,this.activeKeys.has("KeyW")&&(this.moveForward+=1),this.activeKeys.has("KeyS")&&(this.moveForward-=1),this.activeKeys.has("KeyA")&&(this.moveStrafe-=1),this.activeKeys.has("KeyD")&&(this.moveStrafe+=1),this.activeKeys.has("Space")&&(this.moveVertical+=1),(this.activeKeys.has("ShiftLeft")||this.activeKeys.has("ShiftRight"))&&(this.moveVertical-=1),this.moveForward===0&&this.moveStrafe===0&&this.moveVertical===0)return;this.camera.getWorldDirection(h2).normalize(),SE.crossVectors(h2,bE).normalize();const e=this.movementSpeed*t;this.moveForward!==0&&this.camera.position.addScaledVector(h2,this.moveForward*e),this.moveStrafe!==0&&this.camera.position.addScaledVector(SE,this.moveStrafe*e),this.moveVertical!==0&&this.camera.position.addScaledVector(bE,this.moveVertical*e)}dispose(){this.domElement.removeEventListener("click",this.handleClick),window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("keydown",this.handleKeyDown),window.removeEventListener("keyup",this.handleKeyUp),document.removeEventListener("pointerlockchange",this.handlePointerLockChange),window.removeEventListener("blur",this.handleWindowBlur)}}function wE(r){for(const t of Object.keys(r)){const e=r[t];e&&typeof e=="object"&&e.isTexture&&e.dispose()}typeof r.dispose=="function"&&r.dispose()}function Li(r){r.traverse(t=>{if(t.geometry&&typeof t.geometry.dispose=="function"&&t.geometry.dispose(),t.material)if(Array.isArray(t.material))for(const e of t.material)wE(e);else wE(t.material)}),r.parent&&r.parent.remove(r)}function Mq(r){const t=[...r.children];for(const e of t)Li(e)}class vq{constructor({manifest:t,root:e,scene:n,camera:s,renderer:i}){this.manifest=t,this.root=e,this.scene=n,this.camera=s,this.renderer=i,this.activeSceneIndex=-1,this.activeSceneInstance=null}getContext(){return{camera:this.camera,renderer:this.renderer,root:this.root,scene:this.scene}}async load(t){if(t<0||t>=this.manifest.length)throw new Error(`Scene index out of range: ${t}`);this.unloadCurrent();const n=this.manifest[t].create();this.activeSceneInstance=n,this.activeSceneIndex=t,typeof n.init=="function"&&await n.init(this.getContext())}async goTo(t){return t===this.activeSceneIndex?!1:(await this.load(t),!0)}update(t,e){!this.activeSceneInstance||typeof this.activeSceneInstance.update!="function"||this.activeSceneInstance.update({...this.getContext(),delta:t,elapsed:e})}resize(t,e){!this.activeSceneInstance||typeof this.activeSceneInstance.resize!="function"||this.activeSceneInstance.resize({...this.getContext(),height:e,width:t})}hasNext(){return this.activeSceneIndex<this.manifest.length-1}hasPrevious(){return this.activeSceneIndex>0}async next(){return this.hasNext()?(await this.load(this.activeSceneIndex+1),!0):!1}async previous(){return this.hasPrevious()?(await this.load(this.activeSceneIndex-1),!0):!1}getSceneList(){return this.manifest.map((t,e)=>({id:t.id,index:e,title:t.title}))}getCurrentSceneInfo(){if(this.activeSceneIndex<0)return null;const t=this.manifest[this.activeSceneIndex];return{id:t.id,index:this.activeSceneIndex,title:t.title,total:this.manifest.length}}unloadCurrent(){this.activeSceneInstance&&typeof this.activeSceneInstance.dispose=="function"&&this.activeSceneInstance.dispose(this.getContext()),this.activeSceneInstance=null,this.activeSceneIndex=-1,Mq(this.root)}dispose(){this.unloadCurrent()}}const TE="cooper-farmhouse-intro",Aq="Cooper Farmhouse and Cornfield Intro",Cd=Math.PI*2,Nq=.7,Rq=5.9,Eq=-196,Cq=28,Xl=new Cn,Yh=new G,d2=new G,Yf=new G;function Bq(r){let t=r>>>0;return()=>(t=1664525*t+1013904223>>>0,t/4294967296)}function Dq(r,t){const e=Math.sin(t*.055)*1.55,n=Math.max(0,1-Math.abs(t+84)/290),s=Math.exp(-Math.pow((r-e)/8.1,2))*.34*n,i=Math.sin((r+28)*.024)*.68+Math.cos((t-36)*.019)*.54,a=Math.sin((r-170)*.0048)*.34+Math.cos((t+120)*.0052)*.32,c=Math.sin((r*.9+t*.24)*.14)*.1;return i+a+c-s-.45}function Lq(r,t){if(t<Eq||t>Cq)return-1/0;const e=Math.sin(t*.055)*1.55,n=r-e;if(Math.abs(n)>Rq)return-1/0;const s=Math.cos(n*.7)*.06,i=Math.exp(-Math.pow((Math.abs(n)-2.05)/.55,2))*-.045;return .08+s+i}function _E(r){if(!r)return;const t=r.position.x,e=r.position.z,n=Dq(t,e),s=Lq(t,e),a=Math.max(n,s)+Nq;r.position.y<a&&(r.position.y=a,r.updateMatrixWorld())}function b_(r,t){const e=document.createElement("canvas");e.width=r,e.height=r;const n=e.getContext("2d");if(!n)throw new Error("Could not create canvas context for procedural scene texture.");t(n,r);const s=new bi(e);return s.colorSpace=fn,s.generateMipmaps=!0,s.minFilter=Jo,s.magFilter=qs,s.wrapS=Bn,s.wrapT=Bn,s.needsUpdate=!0,s}function Oq(r){const t=b_(512,(e,n)=>{e.fillStyle="#8f7652",e.fillRect(0,0,n,n);for(let s=0;s<42e3;s+=1){const i=Math.floor(r()*n),a=Math.floor(r()*n),c=92+Math.floor(r()*58),u=.03+r()*.13;e.fillStyle=`rgba(${c}, ${66+Math.floor(r()*24)}, ${42+Math.floor(r()*20)}, ${u})`,e.fillRect(i,a,1,1)}e.globalAlpha=.16,e.strokeStyle="#705737",e.lineWidth=1;for(let s=0;s<120;s+=1){const i=s/120*n;e.beginPath(),e.moveTo(0,i+Math.sin(s*.53)*5.5),e.bezierCurveTo(n*.24,i+7,n*.62,i-7,n,i+Math.cos(s*.7)*6),e.stroke()}e.globalAlpha=1});return t.repeat.set(86,86),t}function Fq(r){const t=b_(512,(e,n)=>{e.fillStyle="#7a5f43",e.fillRect(0,0,n,n);for(let s=0;s<28e3;s+=1){const i=Math.floor(r()*n),a=Math.floor(r()*n),c=84+Math.floor(r()*44),u=.05+r()*.15;e.fillStyle=`rgba(${c}, ${56+Math.floor(r()*18)}, ${38+Math.floor(r()*16)}, ${u})`,e.fillRect(i,a,1,1)}e.fillStyle="rgba(62, 48, 36, 0.5)",e.fillRect(n*.29,0,n*.11,n),e.fillRect(n*.61,0,n*.11,n),e.strokeStyle="rgba(188, 153, 108, 0.3)",e.lineWidth=2;for(let s=0;s<35;s+=1){const i=s/35*n;e.beginPath(),e.moveTo(n*.22,i),e.lineTo(n*.76,i+(r()-.5)*8),e.stroke()}});return t.repeat.set(1,8),t}function Uq(r){const t=b_(1024,(e,n)=>{const s=e.createLinearGradient(0,0,0,n);s.addColorStop(0,"#e4d7c2"),s.addColorStop(.52,"#dacbb3"),s.addColorStop(1,"#b1946f"),e.fillStyle=s,e.fillRect(0,0,n,n);for(let i=0;i<46e3;i+=1){const a=Math.floor(r()*n),c=Math.floor(r()*n),u=.008+r()*.024,d=220+Math.floor(r()*20);e.fillStyle=`rgba(${d}, ${d-6}, ${d-18}, ${u})`,e.fillRect(a,c,2,2)}e.globalAlpha=.11,e.fillStyle="#e8ddcb";for(let i=0;i<18;i+=1){const a=r()*n,c=n*(.24+r()*.34),u=n*(.08+r()*.2);e.beginPath(),e.ellipse(a,c,u,u*.3,r()*Cd,0,Cd),e.fill()}e.globalAlpha=1});return t.repeat.set(1,1),t}function Pq(r){const t=new vt,e=new C(new ke(520,48,28),new $e({side:us,map:Uq(r),depthWrite:!1,fog:!1}));e.position.y=-76,t.add(e);const n=new $e({color:15259325,depthWrite:!1,fog:!1,transparent:!0,opacity:.16});for(let s=0;s<6;s+=1){const i=new C(new Rn(300,24),n);i.position.set(0,12+s*4.6,-196+s*8.5),i.rotation.x=-.05+s*.004,t.add(i)}return t}function zq(){const r=new vt,t=new Vu(16114888,6706499,.74),e=new Fs(16771523,1.7),n=new Fs(11968388,.52),s=new Ro(9466974,.23);e.position.set(112,68,24),n.position.set(-58,24,-74);const i=new C(new qi(10,48),new $e({color:16244646,depthWrite:!1,opacity:.52,transparent:!0}));return i.position.set(128,58,-212),i.lookAt(0,0,0),r.add(t,e,n,s,i),r}function Iq(r){const t=new vt,e=Oq(r),n=Fq(r),s=new Rn(1800,1800,220,220);s.rotateX(-Math.PI/2);const i=s.attributes.position;for(let f=0;f<i.count;f+=1){const p=i.getX(f),g=i.getZ(f),y=Math.sin(g*.055)*1.55,x=Math.max(0,1-Math.abs(g+84)/290),S=Math.exp(-Math.pow((p-y)/8.1,2))*.34*x,T=Math.sin((p+28)*.024)*.68+Math.cos((g-36)*.019)*.54,M=Math.sin((p-170)*.0048)*.34+Math.cos((g+120)*.0052)*.32,N=Math.sin((p*.9+g*.24)*.14)*.1,v=(r()-.5)*.1;i.setY(f,T+M+N+v-S-.45)}i.needsUpdate=!0,s.computeVertexNormals();const a=new C(s,new gt({color:9402965,map:e,metalness:.03,roughness:.96}));t.add(a);const c=new Rn(11.8,224,18,180);c.rotateX(-Math.PI/2),c.translate(0,.08,-84);const u=c.attributes.position;for(let f=0;f<u.count;f+=1){const p=u.getZ(f),g=u.getX(f),y=Math.sin(p*.055)*1.55,x=Math.cos(g*.7)*.06,S=Math.exp(-Math.pow((Math.abs(g)-2.05)/.55,2))*-.045;u.setX(f,g+y),u.setY(f,u.getY(f)+x+S)}u.needsUpdate=!0,c.computeVertexNormals();const d=new C(c,new gt({color:7691844,map:n,metalness:.01,roughness:.97}));t.add(d);for(const f of[-1,1]){const p=new Rn(2.3,224,3,180);p.rotateX(-Math.PI/2),p.translate(f*6.75,.04,-84);const g=p.attributes.position;for(let x=0;x<g.count;x+=1){const S=g.getZ(x),T=g.getX(x),M=Math.sin(S*.055)*1.55,N=Math.cos((T+f*3)*2.1)*.03;g.setX(x,T+M),g.setY(x,g.getY(x)+N)}g.needsUpdate=!0,p.computeVertexNormals();const y=new C(p,new gt({color:8283464,metalness:.01,roughness:.95}));t.add(y)}return t}function Vq(){const r=new vt,t=new gt({color:6639932,metalness:.04,roughness:.9}),e=new $e({color:2893345,depthWrite:!1,fog:!0,transparent:!0,opacity:.8}),n=[];for(let s=4;s>-180;s-=19){const i=12+Math.sin(s*.04)*.8,a=new C(new $t(.19,.27,9.4,8),t);a.position.set(i,4.75,s),r.add(a);const c=new C(new Y(2.5,.14,.14),t);c.position.set(i,8.3,s),r.add(c);for(const u of[-.9,0,.9]){const d=new C(new ke(.08,10,10),new gt({color:9867402,metalness:.03,roughness:.76}));d.position.set(i+u,8.2,s),r.add(d)}n.push(new G(i,8.3,s))}for(let s=0;s<3;s+=1){const i=-.82+s*.82,a=n.map((u,d)=>{const f=n.length>1?d/(n.length-1):0;return new G(u.x+i,u.y-.32-s*.12-Math.sin(f*Math.PI)*.42,u.z)}),c=new C(new zw(new iC(a),Math.max(a.length*8,24),.026,6,!1),e);r.add(c)}return r}function gg(r,t){const e=new C(new Y(t.width,t.height,.1),t.frameMaterial);e.position.set(t.x,t.y,t.z),e.rotation.y=t.rotationY??0,r.add(e);const n=new C(new Rn(t.width*.74,t.height*.68),t.paneMaterial);n.position.set(t.x+Math.sin(t.rotationY??0)*.055,t.y,t.z+Math.cos(t.rotationY??0)*.055),n.rotation.y=t.rotationY??0,r.add(n)}function Gq(r){const t=new vt;t.position.set(-30,0,-72),t.scale.setScalar(1.08);const e=new gt({color:13814203,metalness:.02,roughness:.88}),n=new gt({color:7889998,metalness:.02,roughness:.86}),s=new gt({color:7101004,metalness:.04,roughness:.93}),i=new gt({color:10135731,emissive:7228722,emissiveIntensity:.08,metalness:0,roughness:.38,transparent:!0,opacity:.84}),a=new gt({color:8350030,metalness:.01,roughness:.91}),c=new C(new Y(14,.75,10.5),n);c.position.y=.35,t.add(c);const u=new C(new Y(12.5,4.9,9.6),e);u.position.y=2.95,t.add(u);const d=new C(new Y(9.1,3.8,8.2),e);d.position.y=6.8,t.add(d);const f=new C(new Y(7,.34,10.4),s);f.position.set(-3,8.7,0),f.rotation.z=.62,t.add(f);const p=new C(new Y(7,.34,10.4),s);p.position.set(2.5,8.7,0),p.rotation.z=-.62,t.add(p);const g=new C(new Y(.36,.3,10.1),n);g.position.set(-.25,10.4,0),t.add(g);for(const nt of[-1,1]){const ht=new C(new Y(.18,.2,10.5),n);ht.position.set(nt*3.65,8.08,0),t.add(ht)}const y=new C(new Y(5.6,.22,3.1),a);y.position.set(0,.62,6.15),t.add(y);const x=new C(new Y(6.4,.22,3.5),e);x.position.set(0,3.6,6.15),t.add(x);for(let nt=-2;nt<=2;nt+=1){const ht=new C(new Y(.2,2.9,.2),n);ht.position.set(nt*1.2,2.05,7.15),t.add(ht)}for(let nt=-2;nt<=1;nt+=1){const ht=new C(new Y(1.02,.11,.1),n);ht.position.set(nt*1.2+.6,1.24,7.15),t.add(ht)}const S=new C(new Y(1.35,2.4,.12),n);S.position.set(0,1.85,4.95),t.add(S);const T=new C(new Y(.96,1.86,.08),e);T.position.set(0,1.84,5.02),t.add(T);const M=new C(new Y(2.4,.42,1.4),a);M.position.set(0,.3,7.1),t.add(M);const N=[-4.1,-2.25,2.25,4.1];for(const nt of N)gg(t,{frameMaterial:n,height:1.45,paneMaterial:i,width:1.1,x:nt,y:3,z:4.95});const v=[-2.45,0,2.45];for(const nt of v)gg(t,{frameMaterial:n,height:1.3,paneMaterial:i,width:1.02,x:nt,y:6.7,z:4.2});const A=[2.4,5.6];for(const nt of A)gg(t,{frameMaterial:n,height:1.35,paneMaterial:i,rotationY:Math.PI/2,width:1.05,x:6.25,y:nt,z:-1.2}),gg(t,{frameMaterial:n,height:1.35,paneMaterial:i,rotationY:-Math.PI/2,width:1.05,x:-6.25,y:nt,z:1.1});const R=new C(new Y(1.05,3,1.05),n);R.position.set(3.2,9.3,-2.6),t.add(R);const F=new vt;F.position.set(14,0,-6);const D=new C(new Y(11.8,7.3,10.4),new gt({color:9133893,metalness:.02,roughness:.91}));D.position.y=3.75,F.add(D);const O=new C(new Y(6.6,.35,11.2),s);O.position.set(-2.7,8.3,0),O.rotation.z=.58,F.add(O);const B=new C(new Y(6.6,.35,11.2),s);B.position.set(2.6,8.3,0),B.rotation.z=-.58,F.add(B);const z=new C(new Y(3.1,3.9,.2),n);z.position.set(0,2.05,5.2),F.add(z);const tt=new C(new Y(3.5,.24,.22),n);tt.position.set(0,4.25,5.18),F.add(tt),t.add(F);const j=new vt;j.position.set(21,0,-8.8);const dt=new C(new $t(1.8,2.1,10.6,14),new gt({color:10193526,metalness:.05,roughness:.87}));dt.position.y=5.4,j.add(dt);const wt=new C(new pi(2.2,2.2,14),new gt({color:7626828,metalness:.04,roughness:.86}));wt.position.y=11.8,j.add(wt),t.add(j);const ft=new gt({color:7363911,metalness:.01,roughness:.93});for(let nt=0;nt<22;nt+=1){const ht=new C(new Y(.18,1.3,.18),ft);if(ht.position.set(-16+nt*2,.65,11.5+Math.sin(nt*.36)*.35),t.add(ht),nt<21){const _t=new C(new Y(1.85,.12,.1),ft);_t.position.set(-15.05+nt*2,1.02,11.5+Math.sin(nt*.36+.18)*.35),t.add(_t)}}const U=new C(new Y(.14,1.2,.14),ft);U.position.set(-8.4,.61,9.4),t.add(U);const K=new C(new Y(.66,.42,.45),new gt({color:4404779,metalness:.16,roughness:.62}));return K.position.set(-8.1,1.16,9.4),t.add(K),t.rotation.y=-.08+(r()-.5)*.03,t}function kq(r,t=null){const e=new vt,n=[],i=1/Math.sqrt(2),a=520,c=560;for(let j=a;j>=-a;){const wt=(3.5+Math.min(1,Math.abs(j)/a)*3.1)*i,ft=Math.round(Math.abs(j)*1.2)%2===0?0:1;for(let U=-a;U<=a;){const K=Math.min(1,Math.hypot(U,j)/a),nt=(2.9+K*3.6)*i,ht=(r()-.5)*(.62+K*1.25)+ft,_t=(r()-.5)*(.52+K*1.05),P=U+ht,q=j+_t;if(Math.hypot(P,q)>c){U+=nt;continue}if(q>86&&Math.abs(P)<330){U+=nt;continue}const I=Math.sin(q*.055)*1.55,H=Math.max(0,1-Math.abs(q+84)/290),W=(7+Math.max(0,5.2-Math.abs(q+72)*.036))*H;if(H>.001&&Math.abs(P-I)<W){U+=nt;continue}if(P>-40&&P<44&&q>-95&&q<-40){U+=nt;continue}const rt=1-K*.68;if(r()>rt){U+=nt;continue}n.push({amp:.06+r()*.11,height:.9+r()*.75,lean:(r()-.5)*.08,phase:r()*Cd,x:P,yaw:r()*Cd,z:q}),U+=nt}j-=wt}const u=104,d=new Map;for(const j of n){const dt=Math.floor(j.x/u),wt=Math.floor(j.z/u),ft=`${dt}|${wt}`;d.has(ft)||d.set(ft,[]),d.get(ft).push(j)}const f=new $t(.03,.06,2.2,7);f.translate(0,1.1,0);const p=new Y(1.05,.05,.14);p.translate(.33,1.02,0),p.rotateZ(.58);const g=new Y(.92,.045,.12);g.translate(-.3,1.34,0),g.rotateZ(-.52);const y=new pi(.08,.34,6);y.translate(0,2.22,0);const x=new gt({color:9082944,metalness:.01,roughness:.92,vertexColors:!0}),S=new gt({color:10267467,metalness:.01,roughness:.9,vertexColors:!0}),T=new gt({color:11508311,metalness:.01,roughness:.88,vertexColors:!0}),M=[],N=new qt,v=new qt,A=new qt;for(const j of d.values()){let dt=0,wt=0;for(const ct of j)dt+=ct.x,wt+=ct.z;dt/=j.length,wt/=j.length;const ft=Math.hypot(dt,wt);let U=1;ft>470?U=5:ft>390?U=4:ft>310?U=3:ft>230&&(U=2);const K=U===1?j:j.filter((ct,st)=>st%U===0),nt=K.length;if(nt===0)continue;const ht=ft<320,_t=ft<240,P=new vt,q=new vu(f,x,nt),L=ht?new vu(p,S,nt):null,I=ht?new vu(g,S,nt):null,H=_t?new vu(y,T,nt):null;q.frustumCulled=!1,L&&(L.frustumCulled=!1),I&&(I.frustumCulled=!1),H&&(H.frustumCulled=!1);let W=0,at=0;for(let ct=0;ct<nt;ct+=1){const st=K[ct];W+=st.x,at+=st.z,N.setHSL(.17+r()*.05,.44,.34+r()*.11),v.copy(N).offsetHSL(-.01,.06,.04),A.copy(N).offsetHSL(-.03,-.1,.2),q.setColorAt(ct,N),L&&L.setColorAt(ct,v),I&&I.setColorAt(ct,v),H&&H.setColorAt(ct,A)}q.instanceColor&&(q.instanceColor.needsUpdate=!0),L&&L.instanceColor&&(L.instanceColor.needsUpdate=!0),I&&I.instanceColor&&(I.instanceColor.needsUpdate=!0),H&&H.instanceColor&&(H.instanceColor.needsUpdate=!0),W/=nt,at/=nt;const rt=new G(W,2.2,at);let et=16;for(let ct=0;ct<nt;ct+=1){const st=K[ct],Z=st.x-rt.x,Q=st.z-rt.z;et=Math.max(et,Math.hypot(Z,Q)+4.5)}P.add(q),L&&P.add(L),I&&P.add(I),H&&P.add(H),e.add(P),M.push({bounds:new Ec(rt.clone(),et),center:rt,group:P,leafLower:I,leafUpper:L,lodStride:U,plants:K,stalks:q,tassels:H})}const R=new ix,F=new Te,D=330*330,O=36100;let B=0;const z=(j,dt,wt,ft,U)=>{const K=j.plants.length;for(let nt=0;nt<K;nt+=1){const ht=j.plants[nt],_t=Math.sin(dt*1.9+ht.phase+ht.z*.04+ht.x*.03)*.36,P=(wt+ft+U+_t)*ht.amp;Xl.position.set(ht.x,0,ht.z),Xl.rotation.set(P*.4,ht.yaw+P*.28,P+ht.lean),Xl.scale.set(1,ht.height,1),Xl.updateMatrix(),j.stalks.setMatrixAt(nt,Xl.matrix),j.leafUpper&&j.leafUpper.setMatrixAt(nt,Xl.matrix),j.leafLower&&j.leafLower.setMatrixAt(nt,Xl.matrix),j.tassels&&j.tassels.setMatrixAt(nt,Xl.matrix)}j.stalks.instanceMatrix.needsUpdate=!0,j.leafUpper&&(j.leafUpper.instanceMatrix.needsUpdate=!0),j.leafLower&&(j.leafLower.instanceMatrix.needsUpdate=!0),j.tassels&&(j.tassels.instanceMatrix.needsUpdate=!0)},tt=(j,dt)=>{const wt=Math.sin(j*.42)*.78,ft=Math.sin(j*1.06+.6)*.34,U=Math.sin(j*.19+1.7)*.22,K=!!(dt&&B%4===0);B+=1,K&&dt&&(F.multiplyMatrices(dt.projectionMatrix,dt.matrixWorldInverse),R.setFromProjectionMatrix(F));for(const nt of M){if(K&&dt){const ht=nt.center.x-dt.position.x,_t=nt.center.z-dt.position.z,P=ht*ht+_t*_t,q=P<=D,L=P<=O;nt.group.visible=q&&R.intersectsSphere(nt.bounds),nt.leafUpper&&(nt.leafUpper.visible=L),nt.leafLower&&(nt.leafLower.visible=L),nt.tassels&&(nt.tassels.visible=L)}nt.group.visible&&z(nt,j,wt,ft,U)}};return tt(0,t),{group:e,update:tt}}function Hq(r){const e=new Array(940),n=new Float32Array(940*3),s=new Ye;for(let c=0;c<940;c+=1)e[c]={baseX:-130+r()*260,baseY:.3+r()*22,baseZ:-206+r()*236,phase:r(),speed:.03+r()*.11,swirl:.4+r()*1.1};s.setAttribute("position",new hs(n,3));const i=new Qr(s,new tr({color:13611142,depthWrite:!1,opacity:.28,size:.7,sizeAttenuation:!0,transparent:!0})),a=c=>{const u=s.attributes.position,d=Math.sin(c*.21)*11;for(let f=0;f<940;f+=1){const p=e[f],g=f*3,y=(c*p.speed+p.phase)%1*260-130;n[g]=p.baseX+y*.14+d+Math.sin(c*.4+p.phase*Cd)*2.4,n[g+1]=p.baseY+Math.sin(c*(.62+p.swirl*.18)+p.phase*11)*(.3+p.swirl*.2),n[g+2]=p.baseZ+Math.cos(c*(.39+p.swirl*.1)+p.phase*9)*(1+p.swirl)}u.needsUpdate=!0};return a(0),{points:i,update:a}}function Wq(r){const t=new vt,e=new vt,n=new vt,s=[],i=.42,a=new gt({color:7034439,metalness:.1,roughness:.7}),c=new gt({color:2762017,metalness:.24,roughness:.58}),u=new gt({color:10137018,metalness:0,roughness:.25,transparent:!0,opacity:.7}),d=new gt({color:1775896,metalness:.03,roughness:.86}),f=new gt({color:9407880,metalness:.55,roughness:.28});e.add(n);const p=new C(new Y(4.15,.42,1.84),c);p.position.y=.68,n.add(p);const g=new C(new Y(2.15,.88,1.82),a);g.position.set(-1.05,1.1,0),n.add(g);const y=new C(new Y(1.75,1.16,1.52),a);y.position.set(1.12,1.28,0),n.add(y);const x=new C(new Y(1.28,.58,1.42),a);x.position.set(2.02,1.08,0),n.add(x);const S=new C(new Y(1.35,.18,1.24),a);S.position.set(1.16,1.92,0),n.add(S);const T=new C(new Rn(1.26,.74),u);T.position.set(1.84,1.45,0),T.rotation.y=Math.PI/2,n.add(T);for(const U of[-1,1]){const K=new C(new Rn(.62,.52),u);K.position.set(1.08,1.52,U*.77),K.rotation.y=U*Math.PI*.5,n.add(K)}const M=new C(new Y(.16,.28,1.86),c);M.position.set(2.72,.68,0),n.add(M);const N=new C(new Y(.2,.28,1.86),c);N.position.set(-2.14,.68,0),n.add(N);const v=new C(new Y(.08,.42,1.2),new gt({color:6511958,metalness:.47,roughness:.33}));v.position.set(2.66,1.12,0),n.add(v);for(const U of[-1,1]){const K=new C(new Y(.08,.16,.28),new gt({color:13086857,emissive:9137984,emissiveIntensity:.1,roughness:.4,metalness:.1}));K.position.set(2.71,1.06,U*.58),n.add(K)}const A=new C(new Y(2.18,.12,.14),c);A.position.set(-1.06,1.58,.88),n.add(A);const R=A.clone();R.position.z=-.88,n.add(R);const F=new $t(i,i,.34,20);F.rotateX(Math.PI/2);const D=new $t(.2,.2,.35,18);D.rotateX(Math.PI/2);const O=[[-1.22,.42,-.93],[-1.22,.42,.93],[1.46,.42,-.93],[1.46,.42,.93]];for(const[U,K,nt]of O){const ht=new vt;ht.position.set(U,K,nt),n.add(ht);const _t=new C(F,d);ht.add(_t);const P=new C(D,f);ht.add(P);const q=new C(new $t(.06,.06,.38,10),new gt({color:7366752,metalness:.45,roughness:.42}));q.rotation.x=Math.PI/2,ht.add(q),s.push(ht)}t.add(e);const B=320,z=new Array(B),tt=new Float32Array(B*3),j=new Ye;for(let U=0;U<B;U+=1)z[U]={lateral:(r()-.5)*3.8,rise:1.2+r()*1.8,seed:r(),speed:.7+r()*.95};j.setAttribute("position",new hs(tt,3));const dt=new Qr(j,new tr({color:12951925,depthWrite:!1,opacity:.34,size:.98,sizeAttenuation:!0,transparent:!0}));t.add(dt);let wt=0;const ft=(U,K)=>{const ht=-82+Math.sin(U*.23)*92,_t=Math.cos(U*.23)*21.16,P=Math.sin(ht*.055)*1.55,q=Math.cos(ht*.055)*.08525,L=Math.sin(U*.8)*.26,I=Math.cos(U*.8)*.208,H=P+L,W=q*_t+I,at=.44+Math.sin(U*10.2)*.03+Math.cos(U*2.3)*.015,et=Math.atan2(_t,W)+Math.PI;e.position.set(H,at,ht),e.rotation.y=et,n.rotation.x=Math.sin(U*11.3)*.012,n.rotation.z=Math.sin(U*7.2)*.018;const ct=Math.hypot(W,_t);wt-=ct/i*K;for(const Z of s)Z.rotation.z=wt;Yh.set(Math.cos(et),0,Math.sin(et)),d2.set(-Yh.z,0,Yh.x),Yf.copy(e.position).addScaledVector(Yh,-2.75),Yf.y=e.position.y+.08;const st=j.attributes.position;for(let Z=0;Z<B;Z+=1){const Q=z[Z],$=(U*(.75+Q.speed*.48)+Q.seed*2.6)%1,mt=1.2+$*(8.2+Q.speed*3.7),yt=Q.lateral*(.45+$*1.8),Tt=Z*3;tt[Tt]=Yf.x-Yh.x*mt+d2.x*yt,tt[Tt+1]=Yf.y+$*Q.rise+Math.sin(U*4.4+Q.seed*Cd)*.14,tt[Tt+2]=Yf.z-Yh.z*mt+d2.z*yt}st.needsUpdate=!0};return ft(0,0),{group:t,update:ft}}const qq={id:TE,title:Aq,create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null;return{init({root:c,camera:u,scene:d}){r=c,e=d.background,n=d.fog,d.background=new qt(13812392),d.fog=new Wp(12955789,34,272),t=new vt,t.name=`${TE}-group`,c.add(t);const f=Bq(114721);t.add(zq()),t.add(Pq(f)),t.add(Iq(f)),t.add(Vq()),t.add(Gq(f)),s=kq(f,u),t.add(s.group),i=Wq(f),t.add(i.group),a=Hq(f),t.add(a.points),u.position.set(-40,5.1,-30),u.lookAt(-4,4.2,-78),_E(u)},update({delta:c,elapsed:u,camera:d}){t&&(_E(d),s&&s.update(u,d),i&&i.update(u,c),a&&a.update(u))},resize(){},dispose({scene:c}){t&&(c.background=e,c.fog=n,r&&t.parent!==r&&r.add(t),Li(t),r=null,t=null,e=null,n=null,s=null,i=null,a=null)}}}},$q=.75;function Xq(r,t){return Math.sin(r*.015+t*.01)*.5+Math.sin(r*.04)*.15+Math.cos(t*.03)*.2}function ME(r){if(!r)return;const e=Xq(r.position.x,r.position.z)+$q;r.position.y<e&&(r.position.y=e,r.updateMatrixWorld())}const jq={id:"cornfield-drone-chase",title:"Cornfield Drone Chase",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null;const f=[],p=300;let g=0;const y=.04,x=4e5,S=220,T=220,M=-30,N=25,v=N*N,A=[],R=[],F=18,D=.025;return{init({root:q,scene:L,camera:I}){r=new vt,r.name="cornfield-drone-group",q.add(r),t=L.background,e=L.fog,L.background=new qt(6991574),L.fog=new Wp(11061469,30,260),I.position.set(20,10,60),I.lookAt(0,2,-20),ME(I),tt(),j(),dt(),wt(),ft(),U(),K(),nt()},update({delta:q,elapsed:L,camera:I}){if(!r)return;ME(I);const H=g;g=(g+y*q)%1,g<H&&O();const W=ht(g),at=ht(g+.002),rt=P(at,W),et=Math.atan2(rt.x,rt.z);if(n){const ct=Math.sin(L*14)*.06+Math.sin(L*9.3)*.04;n.position.set(W.x,.55+ct,W.z),n.rotation.y=et+Math.PI,n.userData.wheels?.forEach(st=>{st.rotation.x+=q*28})}if(s){const ct=(g+D)%1,st=ht(ct),Z=ht(ct+.002),Q=P(Z,st);s.position.set(st.x+Math.sin(L*.6)*2.5,F+Math.sin(L*.9)*1.2,st.z+Math.cos(L*.45)*1.5),s.rotation.y=Math.atan2(Q.x,Q.z)+Math.PI,s.rotation.z=Math.sin(L*1.1)*.04,s.rotation.x=Math.sin(L*.7)*.02}if(i&&B(W,q,L),d&&z(W,et,q),u){const ct=u.geometry.attributes.position.array,st=u.userData.count;for(let Z=0;Z<st;Z++){const Q=Z*3;ct[Q]+=Math.sin(L*.25+Z*1.3)*q*.5,ct[Q+1]+=Math.sin(L*.4+Z*.9)*q*.12,ct[Q+2]+=Math.cos(L*.18+Z*.6)*q*.4}u.geometry.attributes.position.needsUpdate=!0}},resize(){},dispose({scene:q}){q&&(q.background=t,q.fog=e),r&&Li(r),r=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null}};function O(){const q=new Cn;for(let L=0;L<x;L++){if(R[L]===0)continue;R[L]=0;const I=A[L];q.position.set(I.x,I.y,I.z),q.rotation.set(0,I.ry,0),q.scale.set(I.sx,I.sy,I.sx),q.updateMatrix(),i.setMatrixAt(L,q.matrix),a&&(q.position.set(I.x,I.sy*2.8,I.z),q.scale.set(.2,.35,.2),q.updateMatrix(),a.setMatrixAt(L,q.matrix))}i&&(i.instanceMatrix.needsUpdate=!0),a&&(a.instanceMatrix.needsUpdate=!0)}function B(q,L,I){const H=new Cn,W=3.2,at=W*W,rt=5;let et=!1,ct=!1;for(let st=0;st<x;st++){const Z=A[st],Q=Z.x-q.x,$=Z.z-q.z,mt=Q*Q+$*$;if(mt>v&&R[st]===0)continue;mt<at&&(R[st]=Math.min(R[st]+L*rt,1));const yt=R[st],Tt=Math.sin(I*2.8+Z.x*.5+Z.z*.35)*.07*(1-yt*.8);if(H.position.set(Z.x,Z.y,Z.z),H.rotation.set(0,Z.ry,0),yt>.005){const Mt=Math.sqrt(mt)+.001,Vt=Q/Mt,zt=$/Mt,kt=yt*1.4;H.rotation.x=kt*zt+Tt,H.rotation.z=-kt*Vt,H.scale.set(Z.sx,Z.sy*(1-yt*.4),Z.sx)}else H.rotation.x=Tt,H.rotation.z=0,H.scale.set(Z.sx,Z.sy,Z.sx);if(H.updateMatrix(),i.setMatrixAt(st,H.matrix),et=!0,a&&yt>.005){i.getMatrixAt(st,H.matrix),H.matrix.decompose(H.position,H.quaternion,H.scale);const Mt=Z.sy*2.8,Vt=new G(0,Mt,0).applyQuaternion(H.quaternion);H.position.add(Vt),H.scale.set(.2,.35,.2),H.updateMatrix(),a.setMatrixAt(st,H.matrix),ct=!0}}et&&(i.instanceMatrix.needsUpdate=!0),ct&&(a.instanceMatrix.needsUpdate=!0)}function z(q,L,I){const H=d.geometry.attributes.position.array,W=d.geometry.attributes.size.array,at=d.userData.velocities,rt=d.userData.ages,et=d.userData.maxAge,ct=d.userData.count,st=q.x-Math.sin(L)*3.5,Z=q.z-Math.cos(L)*3.5;for(let Q=0;Q<ct;Q++){rt[Q]+=I,rt[Q]>et&&(H[Q*3]=st+(Math.random()-.5)*2.5,H[Q*3+1]=.2+Math.random()*.4,H[Q*3+2]=Z+(Math.random()-.5)*2.5,at[Q*3]=(Math.random()-.5)*3.5,at[Q*3+1]=2+Math.random()*3.5,at[Q*3+2]=(Math.random()-.5)*3.5,rt[Q]=0);const $=rt[Q]/et,mt=1-$*.6;H[Q*3]+=at[Q*3]*I*mt,H[Q*3+1]+=at[Q*3+1]*I*(1-$*.8),H[Q*3+2]+=at[Q*3+2]*I*mt,W[Q]=($<.3?$/.3:1)*(1-$*.5)*2.5}d.geometry.attributes.position.needsUpdate=!0,d.geometry.attributes.size.needsUpdate=!0}function tt(){for(let q=0;q<p;q++){const L=q/p,I=M+(.5-L)*180,H=Math.sin(L*Math.PI*3)*20;f.push({x:H,z:I})}}function j(){const q=new ke(480,32,24),L=new Float32Array(q.attributes.position.count*3),I=new qt(3832767),H=new qt(12901871),W=new qt(10127978);for(let Q=0;Q<q.attributes.position.count;Q++){const mt=(q.attributes.position.getY(Q)/480+1)*.5,yt=new qt;mt>.5?yt.lerpColors(H,I,(mt-.5)*2):yt.lerpColors(W,H,mt*2),L[Q*3]=yt.r,L[Q*3+1]=yt.g,L[Q*3+2]=yt.b}q.setAttribute("color",new ge(L,3));const at=new $e({vertexColors:!0,side:us}),rt=new C(q,at);r.add(rt);const et=new G(80,100,-180);for(let Q=0;Q<3;Q++){const $=[12,28,55][Q],mt=[.95,.25,.08][Q],yt=[16774358,16771242,16772795][Q],Tt=new qi($,32),Mt=new $e({color:yt,transparent:!0,opacity:mt,depthWrite:!1}),Vt=new C(Tt,Mt);Vt.position.copy(et),Vt.lookAt(0,0,0),r.add(Vt)}const ct=new Rn(1200,60),st=new $e({color:13945e3,transparent:!0,opacity:.18,depthWrite:!1,side:En}),Z=new C(ct,st);Z.position.set(0,8,-300),r.add(Z)}function dt(){const q=document.createElement("canvas");q.width=1024,q.height=1024;const L=q.getContext("2d");L.fillStyle="#7a6543",L.fillRect(0,0,1024,1024);for(let et=0;et<3e4;et++){const ct=Math.random()*1024,st=Math.random()*1024,Z=1+Math.random()*3,Q=80+Math.floor(Math.random()*80),$=Math.floor(Math.random()*30);L.fillStyle=`rgb(${Q+$+20},${Q+$},${Q-10})`,L.fillRect(ct,st,Z,Z)}L.strokeStyle="rgba(60,45,25,0.12)",L.lineWidth=1;for(let et=0;et<1024;et+=12+Math.random()*6)L.beginPath(),L.moveTo(0,et),L.lineTo(1024,et+(Math.random()-.5)*4),L.stroke();const I=new bi(q);I.wrapS=Bn,I.wrapT=Bn,I.repeat.set(30,30),I.anisotropy=4;const H=new Rn(600,600,80,80);H.rotateX(-Math.PI/2);const W=H.attributes.position.array;for(let et=0;et<W.length;et+=3){const ct=W[et],st=W[et+2];W[et+1]+=Math.sin(ct*.015+st*.01)*.5+Math.sin(ct*.04)*.15+Math.cos(st*.03)*.2}H.computeVertexNormals();const at=new gt({map:I,color:11573360,roughness:.92,metalness:0}),rt=new C(H,at);rt.name="ground",r.add(rt)}function wt(){const q=new $t(.03,.065,3,4,3);q.translate(0,1.5,0);const L=new gt({color:4880434,roughness:.75,metalness:.02,side:En});i=new vu(q,L,x),i.name="corn-stalks";const I=new pi(.1,.4,5),H=new gt({color:12886083,roughness:.65,metalness:.05});a=new vu(I,H,x),a.name="corn-tassels";const W=3,at=x*W,rt=new Rn(.8,.12,3,1),et=rt.attributes.position.array;for(let Q=0;Q<et.length;Q+=3){const $=(et[Q]+.4)/.8;et[Q+1]-=$*$*.08}rt.translate(.4,0,0),rt.computeVertexNormals();const ct=new gt({color:5934648,roughness:.7,metalness:.02,side:En});c=new vu(rt,ct,at),c.name="corn-leaves";const st=new Cn,Z=new qt;for(let Q=0;Q<x;Q++){const $=(Math.random()-.5)*S*2,mt=M+(Math.random()-.5)*T*2,yt=.85+Math.random()*.4,Tt=.8+Math.random()*.35,Mt=Math.random()*Math.PI*2;if(st.position.set($,0,mt),st.rotation.set(0,Mt,0),st.scale.set(Tt,yt,Tt),st.updateMatrix(),i.setMatrixAt(Q,st.matrix),Math.random()<.65){const Qt=.24+Math.random()*.08,ie=.5+Math.random()*.25,Yt=.28+Math.random()*.12;Z.setHSL(Qt,ie,Yt)}else{const Qt=.13+Math.random()*.06,ie=.45+Math.random()*.2,Yt=.35+Math.random()*.1;Z.setHSL(Qt,ie,Yt)}i.setColorAt(Q,Z),A.push({x:$,y:0,z:mt,ry:Mt,sx:Tt,sy:yt}),R.push(0);const zt=yt*2.8;st.position.set($,zt,mt),st.scale.set(.2,.35,.2),st.updateMatrix(),a.setMatrixAt(Q,st.matrix);const kt=new qt().setHSL(.11+Math.random()*.05,.55,.42+Math.random()*.1);a.setColorAt(Q,kt);for(let Qt=0;Qt<W;Qt++){const ie=Q*W+Qt,Yt=(Qt+1)*.48;st.position.set($,Yt,mt),st.rotation.set(.25+Qt*.1,Mt+Qt*(Math.PI*2/W)+(Math.random()-.5)*.3,0),st.scale.set(Tt*(.9+Math.random()*.3),1,1),st.updateMatrix(),c.setMatrixAt(ie,st.matrix)}}i.instanceMatrix.needsUpdate=!0,i.instanceColor.needsUpdate=!0,a.instanceMatrix.needsUpdate=!0,a.instanceColor.needsUpdate=!0,c.instanceMatrix.needsUpdate=!0,r.add(i),r.add(a),r.add(c)}function ft(){n=new vt,n.name="pickup-truck";const q=new gt({color:8150586,roughness:.78,metalness:.18}),L=new gt({color:3814704,roughness:.6,metalness:.35}),I=new gt({color:13421772,roughness:.15,metalness:.85}),H=new Y(2,.25,5),W=new C(H,L);W.position.set(0,.25,0),n.add(W);const at=new Y(2.15,1,4.8),rt=new C(at,q);rt.position.set(0,.85,0),n.add(rt);const et=new Y(2,.95,2.2),ct=new gt({color:7163440,roughness:.72,metalness:.15}),st=new C(et,ct);st.position.set(0,1.85,-.7),n.add(st);const Z=new Y(2.1,.08,2.3),Q=new C(Z,q);Q.position.set(0,2.35,-.7),n.add(Q);const $=new Rn(1.85,.8),mt=new gt({color:9090252,roughness:.05,metalness:.4,transparent:!0,opacity:.45}),yt=new C($,mt);yt.position.set(0,2,.42),yt.rotation.x=-.2,n.add(yt);const Tt=new Rn(1.7,.6),Mt=new C(Tt,mt);Mt.position.set(0,2,-1.82),Mt.rotation.x=.15,n.add(Mt);for(const le of[-1,1]){const oe=new Rn(1.6,.55),Ve=new C(oe,mt);Ve.position.set(le*1.01,2,-.7),Ve.rotation.y=le*Math.PI/2,n.add(Ve)}const Vt=new C(new Y(2,.1,2.3),L);Vt.position.set(0,1.4,1.55),n.add(Vt);const zt=new Y(.08,.65,2.3);for(const le of[-1,1]){const oe=new C(zt,q);oe.position.set(le*1,1.75,1.55),n.add(oe)}const kt=new C(new Y(2,.65,.08),q);kt.position.set(0,1.75,2.7),n.add(kt);for(const[le,oe]of[[-2.45,"front"],[2.72,"rear"]]){const Ve=new Y(2.3,.18,.12),pn=new C(Ve,I);pn.position.set(0,.45,le),pn.name=`bumper-${oe}`,n.add(pn)}const Qt=new Y(1.6,.5,.06),ie=new gt({color:5592405,roughness:.3,metalness:.7}),Yt=new C(Qt,ie);Yt.position.set(0,.75,-2.42),n.add(Yt);const Ne=new qi(.14,10),ce=new gt({color:16777200,emissive:16777160,emissiveIntensity:.6,roughness:.1});for(const le of[-.7,.7]){const oe=new C(Ne,ce);oe.position.set(le,.9,-2.43),n.add(oe)}const We=new qi(.1,8),Sn=new gt({color:16719904,emissive:13369344,emissiveIntensity:.5,roughness:.3});for(const le of[-.8,.8]){const oe=new C(We,Sn);oe.position.set(le,.8,2.73),oe.rotation.y=Math.PI,n.add(oe)}for(const le of[-1,1]){const oe=new C(new Y(.4,.04,.04),L);oe.position.set(le*1.25,1.9,.1),n.add(oe);const Ve=new C(new Y(.18,.14,.04),I);Ve.position.set(le*1.45,1.9,.1),n.add(Ve)}const vn=new $t(.42,.42,.28,14);vn.rotateZ(Math.PI/2);const rs=new gt({color:1710618,roughness:.95,metalness:0}),zn=new $t(.18,.18,.3,8);zn.rotateZ(Math.PI/2),n.userData.wheels=[];const $n=[[-1.15,.42,-1.4],[1.15,.42,-1.4],[-1.15,.42,1.6],[1.15,.42,1.6]];for(const[le,oe,Ve]of $n){const pn=new vt;pn.position.set(le,oe,Ve),pn.add(new C(vn,rs)),pn.add(new C(zn,I)),n.add(pn),n.userData.wheels.push(pn)}const be=new Y(.12,.2,1);for(const le of[-1,1])for(const[oe]of[[-1.4],[1.6]]){const Ve=new C(be,q);Ve.position.set(le*1.12,.65,oe),n.add(Ve)}const Ze=new $t(.01,.015,1.5,4),An=new gt({color:3355443,metalness:.6,roughness:.3}),Ue=new C(Ze,An);Ue.position.set(-.8,3.1,-.9),Ue.rotation.z=.08,n.add(Ue);const Xn=f[0];n.position.set(Xn.x,.55,Xn.z),r.add(n)}function U(){s=new vt,s.name="surveillance-drone";const q=new gt({color:14212322,roughness:.25,metalness:.55}),L=new gt({color:657960,roughness:.05,metalness:.85}),I=new gt({color:2763317,roughness:.3,metalness:.6}),H=new $t(.25,.45,4.5,8);H.rotateX(Math.PI/2);const W=new C(H,q);s.add(W);const at=new pi(.25,1.2,8);at.rotateX(-Math.PI/2);const rt=new C(at,q);rt.position.set(0,0,-2.85),s.add(rt);const et=new ke(.2,10,10,0,Math.PI*2,0,Math.PI*.6),ct=new gt({color:328965,roughness:.05,metalness:.9}),st=new C(et,ct);st.position.set(0,-.3,-2.4),st.rotation.x=Math.PI,s.add(st);const Z=new Y(14,.06,2),Q=new C(Z,I);Q.position.set(0,.05,-.3),s.add(Q);const $=new Y(13.5,.02,1.7),mt=new C($,L);mt.position.set(0,.12,-.3),s.add(mt);const yt=new $e({color:2236996});for(let kt=-6;kt<=6;kt++){const Qt=new C(new Y(.015,.025,1.7),yt);Qt.position.set(kt*1,.14,-.3),s.add(Qt)}const Tt=new $t(.08,.12,2.5,6);Tt.rotateX(Math.PI/2);const Mt=new C(Tt,q);Mt.position.set(0,.05,3.4),s.add(Mt);const Vt=new Y(4,.04,.7),zt=new C(Vt,I);zt.position.set(0,.1,4.5),s.add(zt);for(const kt of[-1,1]){const Qt=new Y(.04,1,.5),ie=new C(Qt,q);ie.position.set(kt*.3,.6,4.5),ie.rotation.z=kt*.3,s.add(ie)}s.position.set(0,F,0),s.scale.set(.55,.55,.55),r.add(s)}function K(){const L=new Ye,I=new Float32Array(500*3),H=new Float32Array(500),W=new Float32Array(500*3),at=new Float32Array(500),rt=4;for(let $=0;$<500;$++)I[$*3]=9999,I[$*3+1]=-10,I[$*3+2]=9999,H[$]=0,at[$]=rt*Math.random();L.setAttribute("position",new ge(I,3)),L.setAttribute("size",new ge(H,1));const et=new tr({color:13150330,size:1.8,sizeAttenuation:!0,transparent:!0,opacity:.5,depthWrite:!1});d=new Qr(L,et),d.name="truck-dust",d.userData={count:500,velocities:W,ages:at,maxAge:rt},r.add(d);const ct=800,st=new Ye,Z=new Float32Array(ct*3);for(let $=0;$<ct;$++)Z[$*3]=(Math.random()-.5)*160,Z[$*3+1]=.3+Math.random()*12,Z[$*3+2]=M+(Math.random()-.5)*200;st.setAttribute("position",new ge(Z,3));const Q=new tr({color:13942938,size:.35,sizeAttenuation:!0,transparent:!0,opacity:.25,depthWrite:!1});u=new Qr(st,Q),u.name="ambient-dust",u.userData={count:ct},r.add(u)}function nt(){const q=new Fs(16770229,2.5);q.position.set(80,100,-180),r.add(q);const L=new Fs(16767134,.6);L.position.set(-40,30,60),r.add(L);const I=new Vu(8239320,9138240,.7);r.add(I);const H=new Ro(16509128,.25);r.add(H);const W=new Fs(14544639,.4);W.position.set(-30,60,120),r.add(W)}function ht(q){const I=(q%1+1)%1*(p-1),H=Math.floor(I),W=Math.min(H+1,p-1),at=I-H;return _t(f[H],f[W],at)}function _t(q,L,I){return{x:q.x+(L.x-q.x)*I,z:q.z+(L.z-q.z)*I}}function P(q,L){return{x:q.x-L.x,z:q.z-L.z}}}},ac=15,Kh=12,uu=6,op=1600,kg=900,$y=8;function Hg(r){return xt.clamp(r,0,1)}function vE(r,t,e){if(r===t)return e<r?0:1;const n=Hg((e-r)/(t-r));return n*n*(3-2*n)}function Yq(r){let t=r>>>0;return()=>(t=t*1664525+1013904223>>>0,t/4294967296)}function AE(){const t=document.createElement("canvas");t.width=128,t.height=128;const e=t.getContext("2d");if(!e){const i=new ns;return i.needsUpdate=!0,i}const n=e.createRadialGradient(128*.5,128*.5,0,128*.5,128*.5,128*.5);n.addColorStop(0,"rgba(255, 252, 242, 1)"),n.addColorStop(.2,"rgba(255, 232, 198, 0.9)"),n.addColorStop(.65,"rgba(220, 166, 103, 0.25)"),n.addColorStop(1,"rgba(220, 166, 103, 0)"),e.fillStyle=n,e.fillRect(0,0,128,128);const s=new bi(t);return s.needsUpdate=!0,s}function Kq(r){const e=document.createElement("canvas");e.width=512,e.height=512;const n=e.getContext("2d");if(!n){const i=new ns;return i.needsUpdate=!0,i}n.fillStyle="#4d3020",n.fillRect(0,0,512,512);for(let i=0;i<48;i+=1){const a=i*10.666666666666666,c=.08+r()*.1;n.fillStyle=`rgba(29, 18, 12, ${c})`,n.fillRect(0,a,512,2)}for(let i=0;i<30;i+=1){const a=i*17.066666666666666+r()*6;n.fillStyle="rgba(22, 12, 8, 0.16)",n.fillRect(a,0,2+r()*2,512)}for(let i=0;i<6500;i+=1){const a=Math.floor(r()*512),c=Math.floor(r()*512),u=.04+r()*.18;n.fillStyle=`rgba(190, 127, 77, ${u})`,n.fillRect(a,c,1,1)}const s=new bi(e);return s.colorSpace=fn,s.wrapS=Bn,s.wrapT=Bn,s.repeat.set(3.8,2.4),s.needsUpdate=!0,s}function Zq(r){const n=document.createElement("canvas");n.width=256,n.height=384;const s=n.getContext("2d");if(!s){const c=new ns;return c.needsUpdate=!0,c}const i=s.createLinearGradient(0,0,0,384);i.addColorStop(0,"rgba(252, 235, 204, 0.55)"),i.addColorStop(1,"rgba(212, 180, 142, 0.1)"),s.fillStyle=i,s.fillRect(0,0,256,384);for(let c=0;c<20;c+=1){const u=c/19*256,d=4+r()*8,f=.06+r()*.09;s.fillStyle=`rgba(255, 241, 218, ${f})`,s.fillRect(u,0,d,384)}for(let c=0;c<1200;c+=1){const u=Math.floor(r()*256),d=Math.floor(r()*384),f=.03+r()*.08;s.fillStyle=`rgba(255, 244, 228, ${f})`,s.fillRect(u,d,1,1)}const a=new bi(n);return a.colorSpace=fn,a.needsUpdate=!0,a}function Qq(r){const t=new vt,e=new C(new Y(ac,.24,Kh),new gt({color:6175272,map:r,roughness:.95,metalness:.02}));e.position.set(0,-.12,-1),t.add(e);const n=new gt({color:6044201,roughness:.94,metalness:.02}),s=new gt({color:4927266,roughness:.94,metalness:.02}),i=new gt({color:3022359,roughness:.96,metalness:0}),a=new C(new Y(ac,uu,.22),n);a.position.set(0,uu*.5,-Kh*.5-1),t.add(a);const c=new C(new Y(.22,uu,Kh),s);c.position.set(-ac*.5,uu*.5,-1),t.add(c);const u=new C(new Y(.22,uu,Kh),s);u.position.set(ac*.5,uu*.5,-1),t.add(u);const d=new C(new Y(ac,.2,Kh),i);d.position.set(0,uu+.1,-1),t.add(d);const f=new C(new Y(ac,.14,.3),new gt({color:2890259,roughness:.9,metalness:.02}));return f.position.set(0,.05,-Kh*.5-.89),t.add(f),t}function Jq(r){const t=new vt;t.position.set(-ac*.5+.02,3.15,-4),t.rotation.y=Math.PI*.5;const e=new gt({color:2890258,roughness:.88,metalness:.02}),n=new C(new Rn(3.3,4.4),new $e({color:16171915,transparent:!0,opacity:.62,side:En}));n.position.set(-.07,0,0),t.add(n);const s=new C(new Y(3.65,.16,.2),e);s.position.set(0,2.25,.06),t.add(s);const i=new C(new Y(3.65,.16,.2),e);i.position.set(0,-2.25,.06),t.add(i);const a=new C(new Y(.16,4.64,.2),e);a.position.set(-1.8,0,.06),t.add(a);const c=new C(new Y(.16,4.64,.2),e);c.position.set(1.8,0,.06),t.add(c);const u=new C(new Y(.1,4.4,.16),e);u.position.set(0,0,.06),t.add(u);const d=new C(new Rn(5.7,4.7,18,14),new gt({color:16113857,map:r,roughness:1,metalness:0,transparent:!0,opacity:.45,side:En,depthWrite:!1}));return d.position.set(.68,-.18,.22),t.add(d),{curtain:d,glowMaterial:n.material,group:t}}function t$(r){const t=new vt,e=new gt({color:4007193,roughness:.87,metalness:.03}),n=new gt({color:2824978,roughness:.9,metalness:.02}),s=new C(new Y(.22,4.6,.62),e);s.position.set(-1.82,0,.05),t.add(s);const i=new C(new Y(.22,4.6,.62),e);i.position.set(1.82,0,.05),t.add(i);const a=new C(new Y(3.86,.22,.62),e);a.position.set(0,2.2,.05),t.add(a);const c=new C(new Y(3.86,.22,.62),e);c.position.set(0,-2.2,.05),t.add(c);const u=new C(new Y(3.42,4.16,.06),new gt({color:3022100,roughness:.94,metalness:.02}));u.position.set(0,0,-.21),t.add(u);const d=new C(new Y(.08,4.16,.58),n);d.position.set(-1.65,0,.05),t.add(d);const f=new C(new Y(.08,4.16,.58),n);f.position.set(1.65,0,.05),t.add(f);for(let p=0;p<4;p+=1){const g=new C(new Y(3.35,.12,.58),new gt({color:4861215,roughness:.9,metalness:.02}));g.position.set(0,-1.7+p*1.13,.07),t.add(g);let y=-1.48;for(;y<1.34;){const S=.1+r()*.14,T=.56+r()*.46,M=.14+r()*.1,N=.32+r()*.2,v=.34+r()*.2,A=new qt().setHSL(.02+r()*.12,N,v),R=new C(new Y(S,T,M),new gt({color:A,roughness:.88,metalness:.02}));if(R.position.set(y+S*.5,-2+p*1.13+T*.5,.17+(r()-.5)*.06),R.rotation.z=(r()-.5)*.06,t.add(R),y+=S+.035+r()*.03,r()>.74&&y<1.16){const F=.22+r()*.24,D=.14+r()*.1,O=.1+r()*.12,B=new qt().setHSL(.03+r()*.1,.22+r()*.2,.26+r()*.16),z=new C(new Y(F,O,D),new gt({color:B,roughness:.9,metalness:.02}));z.position.set(y+F*.5,-2+p*1.13+O*.5+.03,.2),z.rotation.z=(r()-.5)*.08,t.add(z),y+=F+.04}}const x=new C(new Y(.2,.86,.2),new gt({color:new qt().setHSL(.04+r()*.08,.3+r()*.2,.24+r()*.2),roughness:.9,metalness:.02}));if(x.position.set(1.34-r()*.24,-1.58+p*1.13,.2),x.rotation.z=-.32-r()*.15,t.add(x),r()>.4){const S=new C(new Y(.46+r()*.24,.14+r()*.08,.22),new gt({color:new qt().setHSL(.03+r()*.1,.26+r()*.2,.22+r()*.14),roughness:.9,metalness:.02}));S.position.set(-1.2+r()*1.8,-1.92+p*1.13,.21),S.rotation.z=(r()-.5)*.06,t.add(S)}}return t.position.set(.6,2.26,-6.63),t}function e$(){const r=new vt,t=new gt({color:2759187,roughness:.89,metalness:.03}),e=new gt({color:9137495,roughness:.97,metalness:0}),n=new gt({color:5061166,roughness:.98,metalness:0}),s=new C(new Y(3.1,.48,5.8),t);s.position.y=.23,r.add(s);const i=new C(new Y(2.92,.34,5.58),e);i.position.y=.64,r.add(i);const a=new C(new Y(2.84,.25,3.86),n);a.position.set(0,.9,.46),r.add(a);const c=new C(new Y(1.35,.2,.72),new gt({color:10586226,roughness:.95,metalness:0}));c.position.set(0,.93,-2.1),r.add(c);const u=new $t(.07,.07,2,14),d=[[-1.45,1,-2.8],[1.45,1,-2.8],[-1.45,1,2.8],[1.45,1,2.8]];for(const[f,p,g]of d){const y=new C(u,t);y.position.set(f,p,g),r.add(y);const x=new C(new ke(.14,12,10),new gt({color:3679001,roughness:.85,metalness:.04}));x.position.set(f,2.03,g),r.add(x)}return r.position.set(5.15,0,-1.9),r.rotation.y=-.02,r}function n$(){const r=new vt,t=new gt({color:3812644,roughness:.88,metalness:.02}),e=new gt({color:7032380,roughness:.86,metalness:.01}),n=new gt({color:5200754,roughness:.84,metalness:.02}),s=new gt({color:3615267,roughness:.8,metalness:.06}),i=new gt({color:9137497,roughness:.8,metalness:0}),a=new gt({color:4337703,roughness:.74,metalness:.03}),c=new C(new Y(.86,1.32,.5),t);c.position.y=1.14,r.add(c);const u=new C(new Y(.28,.78,.06),e);u.position.set(0,1.18,.28),r.add(u);const d=new C(new Y(.44,.42,.42),i);d.position.set(.02,2.02,.04),r.add(d);const f=new C(new Y(.46,.12,.44),a);f.position.set(.02,2.24,.04),r.add(f);const p=new C(new Y(.46,.24,.1),a);p.position.set(.02,2.03,-.16),r.add(p);const g=new C(new Y(.08,.22,.34),a);g.position.set(-.21,2.02,.04),r.add(g);const y=new C(new Y(.08,.22,.34),a);y.position.set(.25,2.02,.04),r.add(y);const x=new C(new Y(.24,.1,.16),a);x.position.set(.02,1.86,.14),r.add(x);const S=new C(new Y(.22,.9,.22),t);S.position.set(-.55,1.1,.03),S.rotation.z=.14,r.add(S);const T=new C(new Y(.22,.9,.22),t);T.position.set(.59,1.06,-.02),T.rotation.z=-.16,r.add(T);const M=new C(new Y(.26,.9,.26),n);M.position.set(-.16,.11,.03),r.add(M);const N=new C(new Y(.26,.9,.26),n);N.position.set(.16,.11,-.01),r.add(N);const v=new C(new Y(.26,.16,.3),s);v.position.set(-.16,-.42,.06),r.add(v);const A=new C(new Y(.26,.16,.3),s);return A.position.set(.16,-.42,.04),r.add(A),r.position.set(-3,0,3),r.rotation.y=Math.PI*.38,r}function s$(){const r=new vt,t=new gt({color:3418919,roughness:.9,metalness:.01}),e=new gt({color:7692626,roughness:.88,metalness:.01}),n=new gt({color:5266804,roughness:.86,metalness:.01}),s=new gt({color:3615782,roughness:.82,metalness:.05}),i=new gt({color:10585199,roughness:.8,metalness:0}),a=new gt({color:4600876,roughness:.74,metalness:.02}),c=new C(new Y(.78,1.24,.44),t);c.position.y=1.1,r.add(c);const u=new C(new Y(.26,.66,.06),e);u.position.set(.03,1.12,.25),r.add(u);const d=new C(new Y(.38,.36,.38),i);d.position.set(.06,1.94,.05),r.add(d);const f=new C(new Y(.4,.1,.4),a);f.position.set(.06,2.14,.05),r.add(f);const p=new C(new Y(.4,.28,.1),a);p.position.set(.06,1.96,-.15),r.add(p);const g=new C(new Y(.07,.2,.3),a);g.position.set(-.13,1.95,.05),r.add(g);const y=new C(new Y(.07,.2,.3),a);y.position.set(.25,1.95,.05),r.add(y);const x=new C(new Y(.1,.24,.1),a);x.position.set(.06,1.75,-.18),r.add(x);const S=new C(new Y(.46,.14,.34),t);S.position.set(.05,1.72,-.02),r.add(S);const T=new C(new Y(.2,.84,.2),t);T.position.set(-.48,1.06,-.02),T.rotation.z=.12,r.add(T);const M=new C(new Y(.2,.84,.2),t);M.position.set(.56,1.04,-.03),M.rotation.z=-.14,r.add(M);const N=new C(new Y(.23,.84,.23),n);N.position.set(-.12,.08,.03),r.add(N);const v=new C(new Y(.23,.84,.23),n);v.position.set(.16,.08,-.02),r.add(v);const A=new C(new Y(.23,.14,.28),s);A.position.set(-.12,-.41,.05),r.add(A);const R=new C(new Y(.23,.14,.28),s);return R.position.set(.16,-.41,.03),r.add(R),r.position.set(2,0,3),r.rotation.y=-Math.PI*.9,r}function i$(){const r=new vt,t=[],e=-1.42,n=1.42;for(let s=0;s<$y;s+=1){const i=s/($y-1),a=xt.lerp(e,n,i),c=new C(new Y(.2,.02,5.1),new gt({color:12024646,roughness:.96,metalness:.01,transparent:!0,opacity:.08}));c.position.set(a,.03,-.24+(s%2===0?.06:-.04)),c.scale.y=.2,r.add(c),t.push({baseY:c.position.y,mesh:c,phase:i*Math.PI*2})}return{group:r,lines:t}}function r$(r,t){const e=new Float32Array(op*3),n=new Float32Array(op*5),s=new Float32Array(op*3);for(let u=0;u<op;u+=1){const d=u*3,f=u*5,p=(t()-.5)*(ac-1.4),g=.35+t()*4.6,y=-5.6+t()*8.6;e[d]=p,e[d+1]=g,e[d+2]=y,n[f]=t()*Math.PI*2,n[f+1]=.5+t()*1.2,n[f+2]=.22+t()*.45,n[f+3]=p,n[f+4]=y;const S=Math.floor(t()*$y)/($y-1);s[d]=xt.lerp(-1.42,1.42,S)+(t()-.5)*.05,s[d+1]=.03+t()*.03,s[d+2]=-2.5+t()*4.9}const i=new Ye;i.setAttribute("position",new hs(e,3));const a=new tr({color:13339735,size:.085,transparent:!0,opacity:.48,map:r,alphaTest:.01,blending:fi,depthWrite:!1,sizeAttenuation:!0}),c=new Qr(i,a);return{geometry:i,points:c,positions:e,seeds:n,settleTargets:s}}function o$(r,t){const e=new Float32Array(kg*3),n=new Float32Array(kg*6);for(let c=0;c<kg;c+=1){const u=c*3,d=c*6,f=-8.6-t()*2.9,p=.2+t()*6.2,g=-8+t()*7.6;e[u]=f,e[u+1]=p,e[u+2]=g,n[d]=f,n[d+1]=p,n[d+2]=g,n[d+3]=t()*Math.PI*2,n[d+4]=.4+t()*1.6,n[d+5]=.14+t()*.35}const s=new Ye;s.setAttribute("position",new hs(e,3));const i=new tr({color:11756852,size:.16,transparent:!0,opacity:.42,map:r,alphaTest:.02,depthWrite:!1,blending:Sr,sizeAttenuation:!0}),a=new Qr(s,i);return{geometry:s,points:a,positions:e,seeds:n}}function a$(r,t,e,n){const{geometry:s,positions:i,seeds:a,settleTargets:c}=r;for(let u=0;u<op;u+=1){const d=u*3,f=u*5,p=a[f],g=a[f+1],y=a[f+2],x=a[f+3],S=a[f+4],T=x+n*.8+Math.sin(t*g+p)*y,M=.55+(Math.sin(t*(g*1.25)+p*1.33)*.5+.5)*4.1+Math.cos(t*.45+p*.7)*.18,N=S+Math.cos(t*(g*.86)+p*.78)*(y*1.1),v=e*(.88+.12*Math.sin(p));i[d]=xt.lerp(T,c[d],v),i[d+1]=xt.lerp(M,c[d+1],v),i[d+2]=xt.lerp(N,c[d+2]+Math.sin(t*.82+p)*.02,v)}s.attributes.position.needsUpdate=!0}function l$(r,t,e){const{geometry:n,positions:s,seeds:i}=r;for(let a=0;a<kg;a+=1){const c=a*3,u=a*6,d=i[u],f=i[u+1],p=i[u+2],g=i[u+3],y=i[u+4],x=i[u+5];s[c]=d+Math.sin(t*(y*.9)+g)*(.35+x),s[c+1]=f+Math.sin(t*(y*1.7)+g*1.3)*(.32+x*.5),s[c+2]=p+Math.cos(t*(y*1.25)+g)*(.95+x*.6)+e*.7}n.attributes.position.needsUpdate=!0}const c$={id:"dust-storm-murph-anomaly",title:"Dust Storm and Murph's Anomaly",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=[],d=null,f=null,p=null,g=null,y=null,x=null,S=null,T=null,M=null,N=null,v=0;return{init({root:A,camera:R,scene:F}){t=A,e=F,n=F.background,s=F.fog,F.background=new qt(2826523),F.fog=new zu(4863014,.012),r=new vt,r.name="scene-03-dust-storm-murph",A.add(r),R.position.set(.45,2.2,8),R.lookAt(-.15,1.35,-2.7);const D=Yq(302031),O=Kq(D),B=Zq(D),z=Qq(O);r.add(z);const tt=Jq(B);z.add(tt.group),i=tt.curtain,a=Float32Array.from(i.geometry.attributes.position.array),c=tt.glowMaterial;const j=t$(D);z.add(j);const dt=e$();z.add(dt);const wt=n$();z.add(wt);const ft=s$();z.add(ft);const U=i$();z.add(U.group),u=U.lines;const K=new Ro(9336162,1.25);r.add(K),p=new ls(16764309,7.4,32,1.48),p.position.set(-7.55,3.4,-3.85),r.add(p);const nt=new Vu(12753531,3811099,1.55);r.add(nt),g=new ls(16767410,4.8,24,1.62),g.position.set(.8,5.35,-1.1),r.add(g),y=new ls(12882534,3.6,22,1.72),y.position.set(.4,1.2,1.8),r.add(y),x=new ls(14725251,2.9,24,1.74),x.position.set(-.2,2,6.3),r.add(x),S=new ls(14790527,3,14,1.82),S.position.set(.7,2.7,-5.4),r.add(S),T=new ls(16763034,2.4,5.6,1.95),T.position.set(-.26,1.88,.7),wt.add(T),M=new ls(16763034,2.25,5.4,1.95),M.position.set(.18,1.8,.68),ft.add(M);const ht=new C(new ke(.15,12,10),new gt({color:3812643,emissive:new qt(16764574),emissiveIntensity:.38,roughness:.82,metalness:.08}));ht.position.set(.8,5.15,-1.1),r.add(ht),N=new ls(16754782,.28,4.5,2.3),N.position.set(.1,.24,-1.05),r.add(N);const _t=AE(),P=AE();f=r$(_t,D),d=o$(P,D),r.add(d.points),r.add(f.points)},update({delta:A,elapsed:R}){if(!r||!i)return;v+=A;const F=R%15.5/15.5,D=vE(.45,.62,F),O=1-vE(.88,.98,F),B=Hg(D*O),z=Math.sin(v*.8)*.55+Math.sin(v*1.95)*.28;p&&(p.intensity=6.8+(1-B)*2.2+Math.sin(v*1.1)*.35,p.position.y=3.35+Math.sin(v*.45)*.12),g&&(g.intensity=4.1+B*1.2+Math.sin(v*.65)*.16),y&&(y.intensity=3+B*.9+Math.sin(v*.8)*.12),x&&(x.intensity=2.4+B*.72+Math.sin(v*.72)*.1),S&&(S.intensity=2.45+(1-B)*.7+Math.sin(v*.6)*.12),T&&(T.intensity=2+B*.6+Math.sin(v*.9)*.08),M&&(M.intensity=1.85+B*.56+Math.sin(v*.94+1.1)*.08),N&&(N.intensity=.2+B*.34+Math.sin(v*6.4)*.02),c&&(c.opacity=.96+(1-B)*.08+Math.sin(v*.9)*.03);for(const tt of u){const j=Math.sin(v*2.4+tt.phase)*.03;tt.mesh.material.opacity=.08+B*.84+j*B,tt.mesh.scale.y=.2+B*2.8,tt.mesh.position.y=tt.baseY+B*.01}if(i&&a){const tt=i.geometry.attributes.position,j=tt.array;for(let dt=0;dt<j.length;dt+=3){const wt=a[dt],ft=a[dt+1],U=Hg((2.35-ft)/4.7),K=Math.pow(U,1.7),nt=Hg(.5+.5*Math.sin(v*2.6+wt*1.3+ft*.4)),ht=Math.sin(v*2.3+ft*2.6+wt*1.6)*.022*U,_t=(.2+nt*1.35+Math.max(0,z)*.42)*K,P=Math.sin(v*6+wt*3.4+ft*1.2)*.12*U,q=_t+P,L=(.14+nt*.5+Math.sin(v*1.8+ft*1.5)*.12)*Math.pow(U,1.35);j[dt]=a[dt]+ht,j[dt+1]=a[dt+1]+q,j[dt+2]=a[dt+2]+Math.max(.04*U,L)}tt.needsUpdate=!0}f&&(a$(f,v,B,z),f.points.material&&(f.points.material.opacity=.44+(1-B)*.18)),d&&(l$(d,v,z),d.points.material&&(d.points.material.opacity=.33+(1-B)*.23))},resize(){},dispose(){e&&(e.background=n,e.fog=s),r&&(t&&r.parent!==t&&t.add(r),Li(r)),r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=[],d=null,f=null,p=null,g=null,y=null,x=null,S=null,T=null,M=null,N=null,v=0}}}},ci=38,Wi=28,nc=10.5,xo=.45,u$=.35,h$=.35,yg=.12;function NE(r){if(!r)return;const t=-ci*.5+xo*.5+yg,e=ci*.5-xo*.5-yg,n=-Wi*.5+xo*.5+yg,s=Wi*.5-xo*.5-yg,i=u$,a=nc-h$,c=xt.clamp(r.position.x,t,e),u=xt.clamp(r.position.y,i,a),d=xt.clamp(r.position.z,n,s);(c!==r.position.x||u!==r.position.y||d!==r.position.z)&&(r.position.set(c,u,d),r.updateMatrixWorld())}function Vx(r){let t=r>>>0;return()=>(t=t*1664525+1013904223>>>0,t/4294967296)}function d$(){const r=document.createElement("canvas");r.width=1024,r.height=1024;const t=r.getContext("2d"),e=Vx(404);t.fillStyle="#5a5b60",t.fillRect(0,0,r.width,r.height);for(let c=0;c<2400;c+=1){const u=e()*r.width,d=e()*r.height,f=88+Math.floor(e()*26);t.fillStyle=`rgba(${f}, ${f}, ${f+4}, 0.11)`,t.fillRect(u,d,1.2,1.2)}t.strokeStyle="rgba(150, 153, 162, 0.42)",t.lineWidth=2;const n=-120,s=r.height+130;for(let c=180;c<1900;c+=38)t.beginPath(),t.arc(n,s,c,-Math.PI*.04,-Math.PI*.95,!0),t.stroke();const i=t.createRadialGradient(r.width*.5,r.height*.2,140,r.width*.5,r.height*.4,900);i.addColorStop(0,"rgba(255, 255, 255, 0.03)"),i.addColorStop(1,"rgba(0, 0, 0, 0.2)"),t.fillStyle=i,t.fillRect(0,0,r.width,r.height);const a=new bi(r);return a.colorSpace=fn,a.wrapS=Bn,a.wrapT=Bn,a.repeat.set(1.15,1.05),a}function f$(){const r=document.createElement("canvas");r.width=512,r.height=512;const t=r.getContext("2d"),e=Vx(2001);t.fillStyle="#6a412d",t.fillRect(0,0,r.width,r.height);for(let s=0;s<r.width;s+=5){const i=Math.floor(e()*28)-14;t.strokeStyle=`rgba(${130+i}, ${84+i*.42}, ${58+i*.3}, 0.3)`,t.lineWidth=1+e()*1.5,t.beginPath(),t.moveTo(s+e()*2,0),t.bezierCurveTo(s+8+e()*6,r.height*.28,s-9+e()*7,r.height*.72,s+e()*2,r.height),t.stroke()}for(let s=0;s<7;s+=1){const i=28+s*72+e()*10;t.strokeStyle="rgba(62, 39, 26, 0.32)",t.lineWidth=2,t.beginPath(),t.moveTo(i,0),t.lineTo(i,r.height),t.stroke()}const n=new bi(r);return n.colorSpace=fn,n.wrapS=Bn,n.wrapT=Bn,n.repeat.set(4.6,1.5),n}function p$(r){const t=document.createElement("canvas");t.width=180,t.height=260;const e=t.getContext("2d"),n=Vx(140+r*19),s=e.createLinearGradient(0,0,0,t.height);s.addColorStop(0,"#1e1d1f"),s.addColorStop(1,"#2a2321"),e.fillStyle=s,e.fillRect(0,0,t.width,t.height);const i=110+Math.floor(n()*80),a=40+Math.floor(n()*70);e.fillStyle=`rgba(${a}, ${a+6}, ${a+14}, 0.95)`,e.fillRect(56,164,68,62),e.fillStyle=`rgba(${i}, ${Math.max(90,i-15)}, ${Math.max(80,i-32)}, 0.95)`,e.beginPath(),e.arc(90,124,24,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(${35+Math.floor(n()*40)}, ${26+Math.floor(n()*30)}, ${22+Math.floor(n()*30)}, 0.95)`,e.beginPath(),e.moveTo(67,120),e.quadraticCurveTo(90,70+n()*12,113,120),e.lineTo(113,106),e.quadraticCurveTo(90,56+n()*8,67,106),e.closePath(),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.2)",e.lineWidth=2,e.strokeRect(8,8,t.width-16,t.height-16);const c=new bi(t);return c.colorSpace=fn,c}function m$(){const r=document.createElement("canvas");r.width=1024,r.height=320;const t=r.getContext("2d");t.clearRect(0,0,r.width,r.height),t.fillStyle="#8f8f90",t.font='700 148px "Avenir Next", "Segoe UI", sans-serif',t.textAlign="center",t.textBaseline="middle",t.fillText("LAZARUS",r.width*.5,138),t.strokeStyle="#8f8f90",t.lineWidth=10,t.beginPath(),t.arc(r.width*.5,230,38,Math.PI*.15,Math.PI*.85,!1),t.stroke(),t.fillStyle="#8f8f90",t.beginPath(),t.moveTo(r.width*.5-54,226),t.lineTo(r.width*.5+54,226),t.lineTo(r.width*.5,272),t.closePath(),t.fill();const e=new bi(r);return e.colorSpace=fn,e}function g$(){const r=document.createElement("canvas");r.width=1024,r.height=560;const t=r.getContext("2d"),e=new bi(r);return e.colorSpace=fn,{canvas:r,ctx:t,texture:e}}function RE(r,t,e){r.fillStyle="#060f1c",r.fillRect(0,0,t.width,t.height);const n={x:t.width*(.32+Math.sin(e*.27)*.08),y:t.height*(.45+Math.cos(e*.19)*.12)},s={x:t.width*(.67+Math.cos(e*.33)*.06),y:t.height*(.53+Math.sin(e*.24)*.1)},i=r.createRadialGradient(n.x,n.y,14,n.x,n.y,210);i.addColorStop(0,"rgba(255, 175, 214, 0.9)"),i.addColorStop(.35,"rgba(208, 125, 221, 0.55)"),i.addColorStop(1,"rgba(28, 46, 95, 0)"),r.fillStyle=i,r.fillRect(0,0,t.width,t.height);const a=r.createRadialGradient(s.x,s.y,10,s.x,s.y,180);a.addColorStop(0,"rgba(242, 167, 202, 0.88)"),a.addColorStop(.3,"rgba(182, 101, 209, 0.52)"),a.addColorStop(1,"rgba(18, 26, 70, 0)"),r.fillStyle=a,r.fillRect(0,0,t.width,t.height),r.strokeStyle="rgba(194, 236, 255, 0.16)",r.lineWidth=1.6;for(let u=0;u<56;u+=1){const d=u/56*t.height+Math.sin(e*1.8+u*.35)*1.3;r.beginPath(),r.moveTo(0,d),r.lineTo(t.width,d),r.stroke()}const c=170;for(let u=0;u<c;u+=1){const d=u*13.173,f=(Math.sin(d)+1)*.5*t.width,p=(Math.cos(d*1.29)+1)*.5*t.height,g=.22+Math.abs(Math.sin(e*2.5+u*.4))*.6;r.fillStyle=`rgba(215, 235, 255, ${g})`,r.fillRect(f,p,1.4,1.4)}}function f2(){const r=new vt,t=new gt({color:1382171,roughness:.65,metalness:.1}),e=new gt({color:9278105,roughness:.32,metalness:.85}),n=new C(new Y(1.3,.16,1.36),t);n.position.set(0,.98,0),r.add(n);const s=new C(new Y(1.28,1.62,.15),t);s.position.set(0,1.73,-.58),r.add(s);const i=new C(new Y(1.34,1.7,.05),e);i.position.set(0,1.73,-.67),r.add(i);const a=new C(new $t(.05,.05,1.3,12),e);a.rotation.x=Math.PI*.5,a.position.set(-.73,1.33,.08),r.add(a);const c=a.clone();c.position.x=.73,r.add(c);const u=new C(new $t(.05,.05,.58,10),e);u.position.set(-.68,1.05,.05),r.add(u);const d=u.clone();d.position.x=.68,r.add(d);const f=new C(new $t(.12,.14,.44,16),e);f.position.set(0,.56,0),r.add(f);const p=new C(new $t(.22,.25,.07,12),e);p.position.set(0,.28,0),r.add(p);const g=new ke(.08,8,8);for(let y=0;y<5;y+=1){const x=y/5*Math.PI*2,S=new C(new Y(.55,.045,.07),e);S.position.set(Math.cos(x)*.36,.19,Math.sin(x)*.36),S.rotation.y=x,r.add(S);const T=new C(g,e);T.position.set(Math.cos(x)*.64,.08,Math.sin(x)*.64),r.add(T)}return r}function y$({jacketColor:r,shirtColor:t,skinColor:e,hairColor:n}){const s=new vt,i=new gt({color:r,roughness:.75,metalness:.05}),a=new gt({color:t,roughness:.68,metalness:.03}),c=new gt({color:e,roughness:.72,metalness:.02}),u=new gt({color:n,roughness:.75,metalness:.08}),d=new C(new Y(.92,1.28,.52),i);d.position.set(0,1.9,-.1),s.add(d);const f=new C(new Y(1.04,.26,.56),i);f.position.set(0,2.53,-.12),s.add(f);const p=new C(new Y(.32,.72,.57),a);p.position.set(0,1.95,.03),s.add(p);const g=new C(new ke(.31,16,16),c);g.position.set(0,2.77,-.18),s.add(g);const y=new C(new ke(.33,16,16,0,Math.PI*2,0,Math.PI*.68),u);y.position.set(0,2.9,-.2),s.add(y);const x=new C(new ke(.2,14,14),u);x.scale.set(1.1,.78,.58),x.position.set(0,2.79,-.33),s.add(x);const S=new C(new ke(.085,10,10),u);S.position.set(-.23,2.74,-.2),s.add(S);const T=S.clone();T.position.x=.23,s.add(T);const M=new qt(r).multiplyScalar(.72),N=new gt({color:M,roughness:.78,metalness:.03}),v=new C(new Eu(.12,.64,4,8),N);v.position.set(-.2,1.13,.25),v.rotation.x=Math.PI*.5,v.rotation.z=Math.PI*.04,s.add(v);const A=v.clone();A.position.x=.2,A.rotation.z=-Math.PI*.04,s.add(A);const R=new C(new ke(.12,12,12),N);R.position.set(-.2,1.11,.76),s.add(R);const F=R.clone();F.position.x=.2,s.add(F);const D=new C(new Eu(.095,.78,4,8),N);D.position.set(-.2,.62,.76),s.add(D);const O=D.clone();O.position.x=.2,s.add(O);const B=new gt({color:1447704,roughness:.62,metalness:.08}),z=new C(new Y(.26,.14,.46),B);z.position.set(-.2,.09,.99),s.add(z);const tt=z.clone();tt.position.x=.2,s.add(tt);const j=new C(new Eu(.11,.62,4,8),i);j.rotation.z=-Math.PI*.21,j.rotation.x=Math.PI*.08,j.position.set(-.57,2.3,-.05),s.add(j);const dt=j.clone();return dt.position.x=.57,dt.rotation.z=Math.PI*.21,s.add(dt),s}function x$(){const r=new vt,t=new gt({color:12038312,roughness:.85,metalness:.03}),e=new gt({color:8825019,roughness:.72,metalness:.02}),n=new gt({color:13873814,roughness:.72,metalness:.02}),s=new gt({color:9338216,roughness:.8,metalness:.05}),i=new C(new Y(.95,1.5,.52),e);i.position.set(0,3.35,0),r.add(i);const a=new C(new Eu(.13,1.1,4,10),t);a.position.set(-.2,2.05,0),r.add(a);const c=a.clone();c.position.x=.2,r.add(c);const u=new C(new ke(.32,16,16),n);u.position.set(0,4.35,-.06),r.add(u);const d=new C(new ke(.34,16,16,0,Math.PI*2,0,Math.PI*.67),s);d.position.set(0,4.5,-.08),r.add(d);const f=new C(new ke(.21,14,14),s);f.position.set(0,4.34,-.26),f.scale.set(1.08,.74,.55),r.add(f);const p=new C(new ke(.09,10,10),s);p.position.set(-.24,4.32,-.09),r.add(p);const g=p.clone();g.position.x=.24,r.add(g);const y=new C(new Eu(.095,1.04,4,8),e);y.position.set(-.56,3.5,-.02),y.rotation.z=-Math.PI*.12,y.rotation.y=Math.PI*.08,r.add(y);const x=y.clone();return x.position.x=.56,x.rotation.z=Math.PI*.12,x.rotation.y=-Math.PI*.08,r.add(x),r}const b$={id:"nasa-facility-reveal",title:"Secret NASA Facility Reveal",create(){const r={group:null,root:null,scene:null,previousBackground:null,previousFog:null,fluorescents:[],dust:null,monitor:null,monitorLight:null,timeOffset:Math.PI*.25};return{init({root:t,camera:e,scene:n}){r.root=t,r.scene=n,r.previousBackground=n.background,r.previousFog=n.fog,n.background=new qt(920072),n.fog=new Wp(1642766,34,105),e.position.set(6,3.45,9),e.lookAt(2.5,2.2,-2.6),NE(e);const s=new vt;s.name="nasa-meeting-room",t.add(s),r.group=s;const i=d$(),a=new gt({color:9408406,map:i,roughness:.96,metalness:.02}),c=new C(new Rn(ci,Wi),a);c.rotation.x=-Math.PI*.5,s.add(c);const u=new gt({color:3025709,roughness:.84,metalness:.08}),d=new C(new Rn(ci,Wi),u);d.position.y=nc,d.rotation.x=Math.PI*.5,s.add(d);const f=f$(),p=new gt({color:9656378,map:f,emissive:2232585,emissiveIntensity:.08,roughness:.62,metalness:.06}),g=new gt({color:14537157,roughness:.88,metalness:.02}),y=new gt({color:3875092,roughness:.68,metalness:.12}),x=7,S=nc-x,T=new C(new Y(ci,x,xo),p);T.position.set(0,x*.5,-Wi*.5),s.add(T);const M=new C(new Y(ci,S,xo),g);M.position.set(0,x+S*.5,-Wi*.5+.02),s.add(M);const N=new C(new Y(ci,x,xo),p);N.position.set(0,x*.5,Wi*.5),s.add(N);const v=new C(new Y(ci,S,xo),g);v.position.set(0,x+S*.5,Wi*.5-.02),s.add(v);const A=new Y(xo,x,Wi),R=new Y(xo,S,Wi),F=new C(A,p);F.position.set(-ci*.5,x*.5,0),s.add(F);const D=new C(A,p);D.position.set(ci*.5,x*.5,0),s.add(D);const O=new C(R,g);O.position.set(-ci*.5+.02,x+S*.5,0),s.add(O);const B=new C(R,g);B.position.set(ci*.5-.02,x+S*.5,0),s.add(B);for(let le=0;le<12;le+=1){const oe=new C(new Y(.06,x,xo+.02),y);oe.position.set(-ci*.5+le*3.3+1.4,x*.5,-Wi*.5+.02),s.add(oe)}const z=new Ro(14071445,1.05);s.add(z);const tt=new Fs(16770504,1.02);tt.position.set(7.5,nc-.8,5.8),s.add(tt);const j=new Fs(14596504,.52);j.position.set(-8,4.2,-7.2),s.add(j);const dt=new ls(16238494,1.35,34,1.6);dt.position.set(0,5.2,-11.1),s.add(dt);const wt=new ls(15317908,1,32,1.75);wt.position.set(0,4.1,10.5),s.add(wt);const ft=[[-12.5,-10.8],[-6.8,-10.6],[-.2,-10.3],[6.8,-10.5],[13.4,-10.6],[-3.2,-6.5],[3.1,-6.3],[10.2,-6.8],[-9.6,-3.2],[-2.1,-2.7],[5.8,-2.1],[13.1,-1.4]];for(let le=0;le<ft.length;le+=1){const[oe,Ve]=ft[le],pn=new gt({color:16052713,emissive:16773839,emissiveIntensity:1.35,roughness:.4,metalness:.05}),jn=new C(new Y(3.8,.14,.88),pn);jn.position.set(oe,nc-.1,Ve),s.add(jn);const Yn=new ls(16773073,2.95,36,1.45);Yn.position.set(oe,nc-.42,Ve),s.add(Yn);const Oi=new ls(16769720,2.15,24,1.7);Oi.position.set(oe,nc-.9,Ve),s.add(Oi),r.fluorescents.push({baseIntensity:2.78+le%3*.18,baseBoostIntensity:2.02+le%3*.16,baseEmissive:1.3+le%3*.08,light:Yn,boostLight:Oi,material:pn,phase:le*.87})}const U=new vt;U.position.set(1.4,0,-.85),s.add(U);const K=new gt({color:8732702,roughness:.38,metalness:.18}),nt=new gt({color:6105877,roughness:.42,metalness:.14}),ht=new C(new Y(13.4,.3,4.7),K);ht.position.set(0,1.2,0),U.add(ht);const _t=new C(new Y(13.2,.12,4.4),nt);_t.position.set(0,1.03,0),U.add(_t);const P=new gt({color:1973536,roughness:.58,metalness:.22}),q=[[-4.8,-1.45],[4.8,-1.45],[-4.8,1.45],[4.8,1.45]];for(const[le,oe]of q){const Ve=new C(new Y(.66,1.02,.66),P);Ve.position.set(le,.52,oe),U.add(Ve)}const L=new gt({color:14933458,roughness:.93,metalness:0}),I=new gt({color:5200230,roughness:.82,metalness:.1}),H=[{x:-2.4,z:-1.3,r:.08},{x:2.8,z:-1.1,r:-.11},{x:-.7,z:.9,r:.04},{x:4.2,z:1.3,r:-.07}];for(const le of H){const oe=new C(new Y(1.3,.03,.88),L);oe.position.set(le.x,1.36,le.z),oe.rotation.y=le.r,U.add(oe)}const W=new C(new Y(1.28,.11,.92),I);W.position.set(-5.3,1.39,-.1),W.rotation.y=.2,U.add(W);const at=new G(U.position.x,0,U.position.z),rt=[[-4.9,-4.32,.02],[-1.65,-4.36,-.03],[1.65,-4.32,0],[4.92,-4.26,.04],[-4.85,4.3,Math.PI-.03],[-1.6,4.35,Math.PI+.02],[1.62,4.35,Math.PI-.05],[4.88,4.26,Math.PI+.04],[-9.35,.05,Math.PI*.5+.08],[9.4,-.1,-Math.PI*.5-.05]],et=[];for(let le=0;le<rt.length;le+=1){const[oe,Ve,pn]=rt[le],jn=f2();jn.position.set(at.x+oe,0,at.z+Ve),jn.rotation.y=pn,s.add(jn),et.push(jn)}const ct=[{anchor:0,jacketColor:2040619,shirtColor:14539215,skinColor:12950137,hairColor:3092271},{anchor:3,jacketColor:4010026,shirtColor:13618630,skinColor:13740932,hairColor:5190954},{anchor:4,jacketColor:4930868,shirtColor:14013647,skinColor:9069647,hairColor:2956826},{anchor:7,jacketColor:2438215,shirtColor:13685979,skinColor:12424563,hairColor:2829357},{anchor:8,jacketColor:1645085,shirtColor:13620438,skinColor:11041631,hairColor:2039585}];for(const le of ct){const oe=y$(le);oe.position.copy(et[le.anchor].position),oe.rotation.y=et[le.anchor].rotation.y,s.add(oe)}const st=x$();st.position.set(-3,-1.38,-9),st.rotation.y=.5,s.add(st);const Z=[-15.4,-12.2,-9.1,-5.9,-2.8,2.8,5.9,9.1,12.2,15.4];for(let le=0;le<Z.length;le+=1){const oe=new vt;oe.position.set(Z[le],5.66,-Wi*.5+.26),s.add(oe);const Ve=new C(new Y(1.28,1.58,.1),new gt({color:987153,roughness:.54,metalness:.28}));oe.add(Ve);const pn=new C(new Y(.92,1.2,.05),new gt({color:15065817,roughness:.92,metalness:.02}));pn.position.z=.05,oe.add(pn);const jn=p$(le),Yn=new C(new Rn(.66,.88),new gt({map:jn,roughness:.82,metalness:.02}));Yn.position.z=.09,oe.add(Yn)}const Q=m$(),$=new C(new Rn(6.2,1.95),new gt({map:Q,transparent:!0,roughness:.88,metalness:.04}));$.position.set(0,6,-Wi*.5+.25),s.add($);const mt=new gt({color:2763309,roughness:.5,metalness:.36}),yt=new gt({color:3158068,roughness:.42,metalness:.62}),Tt=0,Mt=-12.45,Vt=new C(new $t(.82,.9,3.2,20),mt);Vt.position.set(Tt,1.6,Mt),s.add(Vt);const zt=new C(new $t(.08,.14,1.24,14),yt);zt.position.set(Tt,3.6,Mt),s.add(zt);const kt=new C(new la(.72,.06,12,40,Math.PI*.78),yt);kt.position.set(Tt-.31,3.92,Mt+.04),kt.rotation.set(Math.PI*.56,-Math.PI*.05,Math.PI*.28),s.add(kt);const Qt=kt.clone();Qt.position.x=Tt+.31,Qt.rotation.z=-Math.PI*.28,s.add(Qt);const ie=g$();RE(ie.ctx,ie.canvas,0),ie.texture.needsUpdate=!0,r.monitor=ie;const Yt=new vt;Yt.position.set(ci*.5-.28,4.5,-1.5),Yt.rotation.y=-Math.PI*.5,s.add(Yt);const Ne=new C(new Y(5.75,3.55,.18),new gt({color:1184534,roughness:.42,metalness:.6}));Yt.add(Ne);const ce=new C(new Rn(5.28,3.04),new gt({color:16777215,map:ie.texture,emissive:7906776,emissiveIntensity:.86,roughness:.36,metalness:.08}));ce.position.z=.11,Yt.add(ce);const We=new C(new $t(.17,.22,2.8,12),new gt({color:4804439,roughness:.36,metalness:.76}));We.position.set(0,-3.08,-.02),Yt.add(We);const Sn=new C(new $t(.65,.82,.22,20),new gt({color:2501169,roughness:.42,metalness:.66}));Sn.position.set(0,-4.55,-.02),Yt.add(Sn);const vn=new ls(11188681,.24,10,2);vn.position.set(ci*.5-1.9,4.38,-1.5),s.add(vn),r.monitorLight=vn;const rs=f2();rs.position.set(-17,.02,3.8),rs.rotation.y=Math.PI*.5,s.add(rs);const zn=f2();zn.scale.set(.95,.95,.95),zn.position.set(-17.02,1.16,3.8),zn.rotation.y=Math.PI*.5,s.add(zn);const $n=680,be=new Float32Array($n*3),Ze=Vx(904);for(let le=0;le<$n;le+=1){const oe=le*3;be[oe]=(Ze()-.5)*(ci-2.4),be[oe+1]=.6+Ze()*(nc-1.3),be[oe+2]=(Ze()-.5)*(Wi-2)}const An=new Ye;An.setAttribute("position",new hs(be,3));const Ue=new tr({color:14932168,size:.055,transparent:!0,opacity:.26,depthWrite:!1,sizeAttenuation:!0}),Xn=new Qr(An,Ue);Xn.position.y=.15,s.add(Xn),r.dust=Xn},update({delta:t,elapsed:e,camera:n}){if(r.group){NE(n);for(const s of r.fluorescents){const i=.985+Math.sin(e*.62+s.phase+r.timeOffset)*.025,a=Math.sin(e*9+s.phase*1.6)*.004,c=i+a;s.light.intensity=s.baseIntensity*c,s.boostLight.intensity=s.baseBoostIntensity*c,s.material.emissiveIntensity=s.baseEmissive*c}r.monitor&&(RE(r.monitor.ctx,r.monitor.canvas,e),r.monitor.texture.needsUpdate=!0),r.monitorLight&&(r.monitorLight.intensity=.22+Math.sin(e*2.2)*.04),r.dust&&(r.dust.rotation.y+=t*.028,r.dust.position.y=.15+Math.sin(e*.26)*.06,r.dust.material.opacity=.24+Math.sin(e*.8)*.04)}},resize(){},dispose(){r.scene&&(r.scene.background=r.previousBackground,r.scene.fog=r.previousFog),r.group&&(r.root&&r.group.parent!==r.root&&r.root.add(r.group),Li(r.group)),r.group=null,r.root=null,r.scene=null,r.previousBackground=null,r.previousFog=null,r.fluorescents.length=0,r.dust=null,r.monitor=null,r.monitorLight=null}}}};_.BRDF_GGX;_.BRDF_Lambert;_.BasicPointShadowFilter;_.BasicShadowFilter;const S$=_.Break;_.Const;_.Continue;_.DFGLUT;_.D_GGX;_.Discard;_.EPSILON;_.F_Schlick;const Jn=_.Fn;_.INFINITY;const ad=_.If,ll=_.Loop;_.NodeAccess;_.NodeShaderStage;_.NodeType;_.NodeUpdateType;_.PCFShadowFilter;_.PCFSoftShadowFilter;_.PI;_.PI2;_.TWO_PI;_.HALF_PI;_.PointShadowFilter;_.Return;_.Schlick_to_F0;_.ShaderNode;_.Stack;_.Switch;_.TBNViewMatrix;_.VSMShadowFilter;_.V_GGX_SmithCorrelated;_.Var;_.VarIntent;const ii=_.abs;_.acesFilmicToneMapping;_.acos;const w$=_.add;_.addMethodChaining;_.addNodeElement;_.agxToneMapping;_.all;_.alphaT;_.and;_.anisotropy;_.anisotropyB;_.anisotropyT;_.any;_.append;_.array;_.arrayBuffer;_.asin;_.assign;_.atan;_.atomicAdd;_.atomicAnd;_.atomicFunc;_.atomicLoad;_.atomicMax;_.atomicMin;_.atomicOr;_.atomicStore;_.atomicSub;_.atomicXor;_.attenuationColor;_.attenuationDistance;_.attribute;_.attributeArray;_.backgroundBlurriness;_.backgroundIntensity;_.backgroundRotation;_.batch;_.bentNormalView;_.billboarding;_.bitAnd;_.bitNot;_.bitOr;_.bitXor;_.bitangentGeometry;_.bitangentLocal;_.bitangentView;_.bitangentWorld;_.bitcast;_.blendBurn;_.blendColor;_.blendDodge;_.blendOverlay;_.blendScreen;_.blur;_.bool;_.buffer;_.bufferAttribute;_.bumpMap;_.builtin;_.builtinAOContext;_.builtinShadowContext;_.bvec2;_.bvec3;_.bvec4;_.bypass;_.cache;_.call;_.cameraFar;_.cameraIndex;_.cameraNear;_.cameraNormalMatrix;const Ar=_.cameraPosition;_.cameraProjectionMatrix;_.cameraProjectionMatrixInverse;_.cameraViewMatrix;_.cameraViewport;_.cameraWorldMatrix;_.cbrt;_.cdl;_.ceil;_.checker;_.cineonToneMapping;const $o=_.clamp;_.clearcoat;_.clearcoatNormalView;_.clearcoatRoughness;_.clipSpace;_.code;const Xe=_.color;_.colorSpaceToWorking;_.colorToDirection;_.compute;_.computeKernel;_.computeSkinning;_.context;_.convert;_.convertColorSpace;_.convertToTexture;_.countLeadingZeros;_.countOneBits;_.countTrailingZeros;const Xa=_.cos,xg=_.cross;_.cubeTexture;_.cubeTextureBase;_.dFdx;_.dFdy;_.dashSize;_.debug;_.decrement;_.decrementBefore;_.defaultBuildStages;_.defaultShaderStages;_.defined;_.degrees;_.deltaTime;_.densityFog;_.densityFogFactor;_.depth;_.depthPass;_.determinant;_.difference;_.diffuseColor;_.directPointLight;_.directionToColor;_.directionToFaceDirection;_.dispersion;_.distance;_.div;const Ae=_.dot;_.drawIndex;_.dynamicBufferAttribute;_.element;_.emissive;_.equal;const T$=_.equirectUV,On=_.exp;_.exp2;_.exponentialHeightFogFactor;_.expression;const _$=_.faceDirection;_.faceForward;_.faceforward;const X=_.float;_.floatBitsToInt;_.floatBitsToUint;const M$=_.floor;_.fog;const Bi=_.fract;_.frameGroup;_.frameId;const S_=_.frontFacing;_.fwidth;_.gain;_.gapSize;_.getConstNodeType;_.getCurrentStack;_.getDirection;_.getDistanceAttenuation;_.getGeometryRoughness;_.getNormalFromDepth;_.interleavedGradientNoise;_.vogelDiskSample;_.getParallaxCorrectNormal;_.getRoughness;_.getScreenPosition;_.getShIrradianceAt;_.getShadowMaterial;_.getShadowRenderObjectFunction;_.getTextureIndex;_.getViewPosition;_.globalId;_.glsl;_.glslFn;_.grayscale;_.greaterThan;_.greaterThanEqual;_.hash;_.highpModelNormalViewMatrix;_.highpModelViewMatrix;_.hue;_.increment;_.incrementBefore;_.instance;_.instanceIndex;_.instancedArray;_.instancedBufferAttribute;_.instancedDynamicBufferAttribute;_.instancedMesh;_.int;_.intBitsToFloat;_.inverse;_.inverseSqrt;_.inversesqrt;_.invocationLocalIndex;_.invocationSubgroupIndex;_.ior;_.iridescence;_.iridescenceIOR;_.iridescenceThickness;_.ivec2;_.ivec3;_.ivec4;_.js;_.label;const Mo=_.length;_.lengthSq;_.lessThan;_.lessThanEqual;_.lightPosition;_.lightProjectionUV;_.lightShadowMatrix;_.lightTargetDirection;_.lightTargetPosition;_.lightViewPosition;_.lightingContext;_.lights;_.linearDepth;_.linearToneMapping;_.localId;_.log;_.log2;_.logarithmicDepthToViewZ;_.luminance;_.mat2;const v$=_.mat3;_.mat4;_.matcapUV;_.materialAO;_.materialAlphaTest;_.materialAnisotropy;_.materialAnisotropyVector;_.materialAttenuationColor;_.materialAttenuationDistance;_.materialClearcoat;_.materialClearcoatNormal;_.materialClearcoatRoughness;_.materialColor;_.materialDispersion;_.materialEmissive;_.materialEnvIntensity;_.materialEnvRotation;_.materialIOR;_.materialIridescence;_.materialIridescenceIOR;_.materialIridescenceThickness;_.materialLightMap;_.materialLineDashOffset;_.materialLineDashSize;_.materialLineGapSize;_.materialLineScale;_.materialLineWidth;_.materialMetalness;_.materialNormal;_.materialOpacity;_.materialPointSize;_.materialReference;_.materialReflectivity;_.materialRefractionRatio;_.materialRotation;_.materialRoughness;_.materialSheen;_.materialSheenRoughness;_.materialShininess;_.materialSpecular;_.materialSpecularColor;_.materialSpecularIntensity;_.materialSpecularStrength;_.materialThickness;_.materialTransmission;const ue=_.max;_.maxMipLevel;_.mediumpModelViewMatrix;_.metalness;const w_=_.min,te=_.mix;_.mixElement;_.mod;_.modInt;_.modelDirection;_.modelNormalMatrix;_.modelPosition;_.modelRadius;_.modelScale;_.modelViewMatrix;_.modelViewPosition;_.modelViewProjection;const A$=_.modelWorldMatrix;_.modelWorldMatrixInverse;_.morphReference;_.mrt;const hu=_.mul;_.mx_aastep;_.mx_add;_.mx_atan2;_.mx_cell_noise_float;_.mx_contrast;_.mx_divide;const Kf=_.mx_fractal_noise_float;_.mx_fractal_noise_vec2;_.mx_fractal_noise_vec3;_.mx_fractal_noise_vec4;_.mx_frame;_.mx_heighttonormal;_.mx_hsvtorgb;_.mx_ifequal;_.mx_ifgreater;_.mx_ifgreatereq;_.mx_invert;_.mx_modulo;_.mx_multiply;const ui=_.mx_noise_float;_.mx_noise_vec3;_.mx_noise_vec4;_.mx_place2d;_.mx_power;_.mx_ramp4;_.mx_ramplr;_.mx_ramptb;_.mx_rgbtohsv;_.mx_rotate2d;_.mx_rotate3d;_.mx_safepower;_.mx_separate;_.mx_splitlr;_.mx_splittb;_.mx_srgb_texture_to_lin_rec709;_.mx_subtract;_.mx_timer;_.mx_transform_uv;_.mx_unifiednoise2d;_.mx_unifiednoise3d;_.mx_worley_noise_float;_.mx_worley_noise_vec2;_.mx_worley_noise_vec3;_.negate;_.neutralToneMapping;_.nodeArray;_.nodeImmutable;_.nodeObject;_.nodeObjectIntent;_.nodeObjects;_.nodeProxy;_.nodeProxyIntent;_.normalFlat;_.normalGeometry;const ap=_.normalLocal;_.normalMap;_.normalView;_.normalViewGeometry;const N$=_.normalWorld;_.normalWorldGeometry;const Fn=_.normalize;_.not;_.notEqual;_.numWorkgroups;_.objectDirection;_.objectGroup;_.objectPosition;_.objectRadius;_.objectScale;_.objectViewPosition;_.objectWorldMatrix;_.OnBeforeObjectUpdate;_.OnBeforeMaterialUpdate;_.OnObjectUpdate;_.OnMaterialUpdate;_.oneMinus;_.or;_.orthographicDepthToViewZ;_.oscSawtooth;_.oscSine;_.oscSquare;_.oscTriangle;_.output;_.outputStruct;_.overloadingFn;_.packHalf2x16;_.packSnorm2x16;_.packUnorm2x16;_.parabola;_.parallaxDirection;_.parallaxUV;_.parameter;_.pass;_.passTexture;_.pcurve;_.perspectiveDepthToViewZ;_.pmremTexture;_.pointShadow;_.pointUV;_.pointWidth;const R$=_.positionGeometry,Xi=_.positionLocal;_.positionPrevious;_.positionView;_.positionViewDirection;const $u=_.positionWorld;_.positionWorldDirection;_.posterize;const ei=_.pow;_.pow2;_.pow3;_.pow4;_.premultiplyAlpha;_.property;_.radians;_.rand;_.range;_.rangeFog;_.rangeFogFactor;_.reciprocal;_.reference;_.referenceBuffer;const E$=_.reflect;_.reflectVector;_.reflectView;_.reflector;_.refract;_.refractVector;_.refractView;_.reinhardToneMapping;_.remap;const EE=_.remapClamp;_.renderGroup;_.renderOutput;_.rendererReference;_.replaceDefaultUV;_.rotate;_.rotateUV;_.roughness;_.round;_.rtt;_.sRGBTransferEOTF;_.sRGBTransferOETF;_.sample;_.sampler;_.samplerComparison;_.saturate;_.saturation;_.screen;_.screenCoordinate;_.screenDPR;_.screenSize;_.screenUV;_.select;_.setCurrentStack;_.setName;_.shaderStages;_.shadow;_.shadowPositionWorld;_.shapeCircle;_.sharedUniformGroup;_.sheen;_.sheenRoughness;_.shiftLeft;_.shiftRight;_.shininess;_.sign;const br=_.sin;_.sinc;_.skinning;const bn=_.smoothstep;_.smoothstepElement;_.specularColor;_.specularF90;_.spherizeUV;_.split;_.spritesheetUV;const Tr=_.sqrt;_.stack;const me=_.step;_.stepElement;_.storage;_.storageBarrier;_.storageTexture;_.string;_.struct;const Xy=_.sub;_.subgroupAdd;_.subgroupAll;_.subgroupAnd;_.subgroupAny;_.subgroupBallot;_.subgroupBroadcast;_.subgroupBroadcastFirst;_.subBuild;_.subgroupElect;_.subgroupExclusiveAdd;_.subgroupExclusiveMul;_.subgroupInclusiveAdd;_.subgroupInclusiveMul;_.subgroupIndex;_.subgroupMax;_.subgroupMin;_.subgroupMul;_.subgroupOr;_.subgroupShuffle;_.subgroupShuffleDown;_.subgroupShuffleUp;_.subgroupShuffleXor;_.subgroupSize;_.subgroupXor;_.tan;_.tangentGeometry;_.tangentLocal;_.tangentView;_.tangentWorld;const Ap=_.texture;_.texture3D;_.textureBarrier;_.textureBicubic;_.textureBicubicLevel;_.textureCubeUV;_.textureLoad;_.textureSize;_.textureLevel;_.textureStore;_.thickness;const Lu=_.time;_.toneMapping;_.toneMappingExposure;_.toonOutlinePass;_.transformDirection;_.transformNormal;_.transformNormalToView;_.transformedClearcoatNormalView;_.transformedNormalView;_.transformedNormalWorld;_.transmission;_.transpose;_.triNoise3D;_.triplanarTexture;_.triplanarTextures;_.trunc;_.uint;_.uintBitsToFloat;const Me=_.uniform;_.uniformArray;_.uniformCubeTexture;_.uniformGroup;_.uniformFlow;_.uniformTexture;_.unpackHalf2x16;_.unpackSnorm2x16;_.unpackUnorm2x16;_.unpremultiplyAlpha;_.userData;const C$=_.uv;_.uvec2;_.uvec3;_.uvec4;const B$=_.varying;_.varyingProperty;const Hn=_.vec2,Dt=_.vec3,gd=_.vec4;_.vectorComponents;_.velocity;_.vertexColor;_.vertexIndex;_.vertexStage;_.vibrance;_.viewZToLogarithmicDepth;_.viewZToOrthographicDepth;_.viewZToPerspectiveDepth;_.viewZToReversedOrthographicDepth;_.viewZToReversedPerspectiveDepth;_.viewport;_.viewportCoordinate;_.viewportDepthTexture;_.viewportLinearDepth;_.viewportMipTexture;_.viewportOpaqueMipTexture;_.viewportResolution;_.viewportSafeUV;_.viewportSharedTexture;_.viewportSize;_.viewportTexture;_.viewportUV;_.wgsl;_.wgslFn;_.workgroupArray;_.workgroupBarrier;_.workgroupId;_.workingToColorSpace;_.xor;const ir=1,zs=ir/1e3,QD=6371,JD=110,Zo=QD*ir,Gp=(QD+JD)*ir,sc=Gp-Zo,D$=420*ir,L$=D$,O$=.6*ir,F$=2200*ir,U$=4.2*ir,P$=26*ir,z$=.14*ir,I$=.62*ir,V$=1.35,G$=.12*ir,k$=.08*ir,lp=5,H$=11,W$=8,q$=35e-5,$$=.35,bg=.14,X$=32,j$=.34,Y$=sc,CE=1,p2=new qt(8366292),BE=new G(.83,.34,-.45).normalize(),K$=28.573,Z$=-80.649,Q$=0,J$=0,tX=.2,jl=1.2,mc=24,m2=13.2,dw=1.2,Wg=4,g2=mc+dw+Wg,eX=0,nX=6.2,sX=5.4,iX=2,rX=.85,DE=.7,oX=10,aX=5.2,lX=1.9,cX=.72,uX=.65,hX=-3.4*zs,dX=4.2*zs,fX=1.2*zs,pX=-5.2*zs,mX=5.8*zs,gX=4.2*zs,yX=-18*zs,xX=12*zs,bX=10*zs,SX=6.2,wX=-2.2*zs,TX=-38*zs,_X=1.4*zs,MX=12*zs,vX=1.8*zs,AX=30*zs,LE=2,NX=10,RX=30,EX=.06,CX=.15,T_=0,BX=T_-Zo,OE=18,FE=10,DX=1.7,UE=new qt(8300498),LX=new qt(132106),an=new G,ti=new G,ks=new G,Bs=new G,Ga=new G,Sg=new G,Zf=new G,Yl=new Us,Zh=new Us,y2=new G,PE=new G,du=new G,x2=new G,zE=new G,IE=new G,VE=new G,GE=new qt,kE=new qt,ka=new qt,Kl=new G(1,1,1),HE=new G,fw=new G(0,1,0),OX=new G(0,58.5,0),FX=new G(0,104,0),UX=new Set(["KeyW","KeyA","KeyS","KeyD","Space","ShiftLeft","ShiftRight"]);function Ou(r){return xt.clamp(r,0,1)}function Ls(r,t,e){if(r===t)return e<r?0:1;const n=Ou((e-r)/(t-r));return n*n*(3-2*n)}function vi(r){return(Math.random()*2-1)*r}function As(r){return r*zs}function PX(r,t){const e=xt.degToRad(r),n=xt.degToRad(t),s=Math.cos(e);return new G(Math.sin(n)*s,Math.sin(e),Math.cos(n)*s).normalize()}function zX(r){const t=xt.clamp(r,0,mc),e=Math.min(lp,mc),n=Math.min(H$,Math.max(mc-e,0)),s=Math.max(Math.min(W$,mc-e-n),1e-6),i=e,a=i+n,c=xt.clamp(q$,1e-4,.15),u=c/Math.max(e,1e-6),f=Math.max(1-c,1e-6)-u*(n+s*.5),p=.5*n*(n+s),g=Math.max(f/Math.max(p,1e-6),1e-6),y=u+g*n,x=y/s,S=u*n+.5*g*n*n;if(t<=i)return{distance:u*t,phaseOneEnd:i,phaseTwoEnd:a,speed:u,totalDistance:1,velocity01:xt.clamp(u/Math.max(y,1e-6),0,1)};if(t<=a){const v=t-i,A=u+g*v,R=c+u*v+.5*g*v*v;return{distance:xt.clamp(R,0,1),phaseOneEnd:i,phaseTwoEnd:a,speed:A,totalDistance:1,velocity01:xt.clamp(A/Math.max(y,1e-6),0,1)}}const T=Math.min(t-a,s),M=Math.max(0,y-x*T),N=c+S+y*T-.5*x*T*T;return{distance:xt.clamp(N,0,1),phaseOneEnd:i,phaseTwoEnd:a,speed:M,totalDistance:1,velocity01:xt.clamp(M/Math.max(y,1e-6),0,1)}}function Zl(r,t){return[r[0]*t,r[1]*t,r[2]*t]}function IX(r){let t=1;switch(r){case"terrestrial":t=2.15;break;case"rocky":t=2;break;case"gasGiant":case"iceGiant":t=1.35;break;default:t=1;break}return t*DX}function VX(r,t){const e=Math.max(r.atmosphereHeightKm,1),n=xt.clamp(r.atmosphereDensity,.15,1.8),s=xt.clamp((n-.25)/1.35,0,1),i=IX(r.kind);let a={rayleighScatteringKm:[.0058,.0135,.0331],mieScatteringKm:[.0022,.0022,.0022],mieExtinctionKm:[.0032,.0032,.0032],rayleighScaleHeightKm:xt.lerp(7.2,10.8,s),upperRayleighScaleHeightKm:Math.max(36,e*.36*i),upperRayleighStrength:.04,mieScaleHeightKm:xt.lerp(.9,1.7,s),miePhaseG:.76,ozoneExtinctionKm:[65e-5,.001881,85e-6],ozoneCenterHeightKm:Math.min(e*.42,26),ozoneWidthKm:Math.max(6,Math.min(e*.18,14)),solarIntensity:13.8};const c=n,u=n*1.02,d=Zl(a.rayleighScatteringKm,c),f=Zl(a.mieScatteringKm,u),p=Zl(a.mieExtinctionKm,u),g=[Math.max(p[0],f[0]+1e-4),Math.max(p[1],f[1]+1e-4),Math.max(p[2],f[2]+1e-4)],y=Zl(a.ozoneExtinctionKm??[0,0,0],n),x=t,S=1/Math.max(x,1e-6);return{rayleighScatteringWorld:Zl(d,S),mieScatteringWorld:Zl(f,S),mieExtinctionWorld:Zl(g,S),ozoneExtinctionWorld:Zl(y,S),rayleighScaleHeightWorld:Math.max(a.rayleighScaleHeightKm*x,1e-5),upperRayleighScaleHeightWorld:Math.max((a.upperRayleighScaleHeightKm??a.rayleighScaleHeightKm*2.6)*x,1e-5),upperRayleighStrength:xt.clamp(a.upperRayleighStrength,0,.24),mieScaleHeightWorld:Math.max(a.mieScaleHeightKm*x,1e-5),ozoneCenterHeightWorld:Math.max((a.ozoneCenterHeightKm??0)*x,0),ozoneWidthWorld:Math.max((a.ozoneWidthKm??1)*x,1e-5),miePhaseG:xt.clamp(a.miePhaseG,0,.92),solarIntensity:a.solarIntensity??18}}function GX(r,t,e,n,s,i,a,c){const u=Dt(c.rayleighScatteringWorld[0],c.rayleighScatteringWorld[1],c.rayleighScatteringWorld[2]),d=Dt(c.mieScatteringWorld[0],c.mieScatteringWorld[1],c.mieScatteringWorld[2]),f=Dt(c.mieExtinctionWorld[0],c.mieExtinctionWorld[1],c.mieExtinctionWorld[2]),p=Dt(c.ozoneExtinctionWorld[0],c.ozoneExtinctionWorld[1],c.ozoneExtinctionWorld[2]),g=X(c.rayleighScaleHeightWorld),y=X(c.upperRayleighScaleHeightWorld),x=X(c.upperRayleighStrength),S=X(c.mieScaleHeightWorld),T=X(c.ozoneCenterHeightWorld),M=X(c.ozoneWidthWorld),N=X(c.miePhaseG),v=X(c.solarIntensity),A=Jn(()=>{const F=Ar,D=Fn($u.sub(Ar)),O=Fn(r),B=t,z=e,tt=n,j=ue(tt.sub(z),z.mul(.005)),dt=j.mul(.24),wt=j.mul(.16),ft=F.sub(B),U=Ae(ft,D),K=Ae(ft,ft).sub(tt.mul(tt)),nt=U.mul(U).sub(K),ht=me(0,nt),_t=Tr(ue(nt,0)),P=Hn(U.negate().sub(_t),U.negate().add(_t)),q=Ae(ft,D),L=Ae(ft,ft).sub(z.mul(z)),I=q.mul(q).sub(L),H=me(0,I),W=Tr(ue(I,0)),at=Hn(q.negate().sub(W),q.negate().add(W)),rt=me(0,at.x).mul(H),et=ue(P.x,0).mul(ht),ct=ue(te(P.y,w_(P.y,at.x),rt),0).mul(ht),st=ue(ct.sub(et),0),Z=st.div(X(OE)),Q=bn(0,wt,st),$=Ae(D,O),mt=X(.05968310365946075).mul(X(1).add($.mul($))),yt=N.mul(N),Tt=X(.07957747154594767).mul(X(1).sub(yt)).div(ei(X(1).add(yt).sub(X(2).mul(N).mul($)),1.5)),Mt=X(0).toVar(),Vt=X(0).toVar(),zt=X(0).toVar(),kt=Dt(0,0,0).toVar();ll(OE,({i:rs})=>{const zn=et.add(Z.mul(X(rs).add(.5))),$n=F.add(D.mul(zn)),be=$n.sub(B),Ze=Mo(be),An=Ze.sub(z),Ue=me(0,An),Xn=ue(An,0),le=ue(tt.sub(Ze),0),oe=bn(0,dt,le),Ve=On(Xn.negate().div(g)),pn=On(Xn.negate().div(y)).mul(x),jn=Ve.add(pn).mul(Ue).mul(oe),Yn=On(Xn.negate().div(S)).mul(Ue).mul(oe),Oi=ue(X(1).sub(ii(Xn.sub(T)).div(M)),0).mul(Ue).mul(oe);Mt.addAssign(jn.mul(Z)),Vt.addAssign(Yn.mul(Z)),zt.addAssign(Oi.mul(Z));const bs=Ae(be,O),Uc=Ae(be,be).sub(tt.mul(tt)),io=bs.mul(bs).sub(Uc),Nr=me(0,io),Fi=Tr(ue(io,0)),Eo=Hn(bs.negate().sub(Fi),bs.negate().add(Fi)),ro=ue(Eo.x,0).mul(Nr),Xs=ue(Eo.y.sub(ro),0).mul(Nr).div(X(FE)),Si=Ae(be,O),pa=Ae(be,be).sub(z.mul(z)),oo=Si.mul(Si).sub(pa),dl=me(0,oo),Ui=Tr(ue(oo,0)),Kn=Si.negate().sub(Ui),Ss=X(1).sub(me(0,Kn).mul(dl)),wi=X(0).toVar(),Rr=X(0).toVar(),Co=X(0).toVar();ll(FE,({i:Er})=>{const Cr=ro.add(Xs.mul(X(Er).add(.5))),lo=$n.add(O.mul(Cr)),Ti=Mo(lo.sub(B)),wn=Ti.sub(z),Pi=me(0,wn),js=ue(wn,0),rr=ue(tt.sub(Ti),0),Is=bn(0,dt,rr),zc=On(js.negate().div(g)),pl=On(js.negate().div(y)).mul(x);wi.addAssign(zc.add(pl).mul(Xs).mul(Pi).mul(Is)),Rr.addAssign(On(js.negate().div(S)).mul(Xs).mul(Pi).mul(Is)),Co.addAssign(ue(X(1).sub(ii(js.sub(T)).div(M)),0).mul(Xs).mul(Pi).mul(Is))});const Pc=u.mul(Mt).add(f.mul(Vt)).add(p.mul(zt)),fl=u.mul(wi).add(f.mul(Rr)).add(p.mul(Co)),ao=On(Pc.add(fl).negate()).mul(Ss),ma=u.mul(jn.mul(mt)).add(d.mul(Yn.mul(Tt)));kt.addAssign(ma.mul(ao).mul(Z))});const Qt=u.mul(Mt).add(f.mul(Vt)).add(p.mul(zt)),ie=On(Qt.negate()),Yt=Dt(1,1,1).sub(ie).mul(u.mul(.018).add(d.mul(.0035))).mul(v.mul(.38)),Ne=kt.mul(v).add(Yt).mul(Q),ce=Ne.div(Ne.mul(.22).add(Dt(1,1,1))),We=Ae(ie,Dt(.2126,.7152,.0722)).clamp(0,1),Sn=S_.select(i,a),vn=ei(X(1).sub(We),1.15).mul(Q).mul(s).mul(Sn).clamp(0,1);return gd(ce,vn)}),R=new Ac;return R.outputNode=A(),R.transparent=!0,R.premultipliedAlpha=!1,R.depthWrite=!1,R.depthTest=!0,R.side=En,R.blending=fi,R}function kX({atmosphereCenter:r,bodyRadius:t,cameraPosition:e,model:n,sunDirection:s,targetPosition:i,topRadius:a}){du.copy(i).sub(e);const c=du.length();if(c<1e-5)return{airlight:p2,effectWeight:0,transLuma:1,transmittance:Kl.set(1,1,1)};du.multiplyScalar(1/c),x2.copy(e).sub(r);const u=x2.dot(du),d=x2.lengthSq()-a*a,f=u*u-d;if(f<=0)return{airlight:p2,effectWeight:0,transLuma:1,transmittance:Kl.set(1,1,1)};const p=Math.sqrt(Math.max(f,0)),g=-u-p,y=-u+p,x=Math.max(g,0),S=Math.min(c,y),T=Math.max(S-x,0);if(T<=1e-5)return{airlight:p2,effectWeight:0,transLuma:1,transmittance:Kl.set(1,1,1)};zE.copy(e).addScaledVector(du,x).sub(r),IE.copy(e).addScaledVector(du,S).sub(r);const M=zE.length(),N=IE.length(),v=Math.max(M-t,0),A=Math.max(N-t,0),R=Math.max(a-t,1e-5),F=Ls($$,R*.72,T),D=Math.max(n.rayleighScaleHeightWorld,R*.16),O=Math.max(n.mieScaleHeightWorld,R*.08),B=Math.exp(-v/D),z=Math.exp(-A/D),tt=Math.exp(-v/O),j=Math.exp(-A/O),dt=(B+z)*T*.5,wt=(tt+j)*T*.5,ft=new G(n.rayleighScatteringWorld[0]*dt,n.rayleighScatteringWorld[1]*dt,n.rayleighScatteringWorld[2]*dt),U=new G(n.mieExtinctionWorld[0]*wt,n.mieExtinctionWorld[1]*wt,n.mieExtinctionWorld[2]*wt);Kl.set(Math.exp(-(ft.x+U.x)*bg),Math.exp(-(ft.y+U.y)*bg),Math.exp(-(ft.z+U.z)*bg)),VE.copy(s).normalize();const K=xt.clamp(du.dot(VE),-1,1),nt=.05968310365946075*(1+K*K),ht=n.miePhaseG,_t=ht*ht,P=.07957747154594767*(1-_t)/Math.pow(1+_t-2*ht*K,1.5),q=new G(n.rayleighScatteringWorld[0]*dt*nt,n.rayleighScatteringWorld[1]*dt*nt,n.rayleighScatteringWorld[2]*dt*nt),L=new G(n.mieScatteringWorld[0]*wt*P,n.mieScatteringWorld[1]*wt*P,n.mieScatteringWorld[2]*wt*P),I=n.solarIntensity*bg*.34;ka.setRGB((q.x+L.x)*I,(q.y+L.y)*I,(q.z+L.z)*I),ka.setRGB(ka.r/(ka.r*.24+1),ka.g/(ka.g*.24+1),ka.b/(ka.b*.24+1));const H=xt.clamp(Kl.x*.2126+Kl.y*.7152+Kl.z*.0722,0,1);return{airlight:ka,effectWeight:xt.clamp(F,0,1),transLuma:H,transmittance:Kl}}function HX(r){const t=new vt;t.name="scene05-earth-system";const e=N$.normalize(),n=Fn(Ar.sub($u)),s=new gt({color:16777215,map:r,metalness:0,roughness:.96}),i=new C(new ke(Zo,144,96),s);i.name="scene05-earth",i.receiveShadow=!0,i.castShadow=!1,t.add(i);const a=new $s({transparent:!0,depthWrite:!1,roughness:.94,metalness:0}),c=e.mul(18).add(Dt(Lu.mul(.016),Lu.mul(-.011),Lu.mul(.007))),u=ui(c),d=ui(c.mul(2.5).add(Dt(-3.6,5.2,7.1))),f=bn(.56,.88,u.mul(.7).add(d.mul(.3))),p=X(1).sub(ii(Ae(e,n))).pow(3.1);a.colorNode=te(Xe(9481160),Xe(16777215),f),a.opacityNode=f.mul(.2).add(p.mul(.1)).clamp(0,.28);const g=new C(new ke(Zo*1.008,120,72),a);g.name="scene05-earth-clouds",g.castShadow=!1,g.receiveShadow=!1,g.visible=!1,t.add(g);const y=new G(0,-Zo+T_,0),x=VX({atmosphereDensity:1,atmosphereHeightKm:JD,kind:"terrestrial"},ir),S=Me(1),T=Me(1),M=Me(0),N=GX(Me(BE.clone()),Me(y.clone()),Me(Zo),Me(Gp),S,T,M,x),v=new C(new ke(Gp,128,80),N);v.name="scene05-earth-atmosphere",t.add(v),t.position.copy(y);const A=PX(K$,Z$),R=new Us().setFromUnitVectors(A,fw);return t.quaternion.copy(R),t.rotateY(xt.degToRad(Q$)),{atmosphereCenter:y,atmosphereModel:x,atmosphere:v,atmosphereBackFaceOpacity:M,clouds:g,earth:i,group:t,atmosphereFrontFaceOpacity:T,atmosphereShellOpacity:S,sunDirection:BE.clone()}}function WX(){const r=new vt;r.name="scene05-nasa-launch-facility";const t=new gt({color:6251629,metalness:.08,roughness:.92}),e=new gt({color:12107464,metalness:.72,roughness:.36}),n=new gt({color:3620166,metalness:.66,roughness:.44}),s=new C(new $t(102,118,14,72),t);s.position.y=1,s.receiveShadow=!0,r.add(s);const i=new C(new $t(24,28,28,40),n);i.position.y=-10,r.add(i);const a=new C(new $t(30,34,126,64,1,!0),e);a.position.y=63,r.add(a);const c=new C(new $t(41,45,132,64,1,!0),n);c.position.y=66,c.material=c.material.clone(),c.material.opacity=.92,c.material.transparent=!0,r.add(c);const u=new C(new la(36,1.8,18,64),n);u.position.y=127,u.rotation.x=Math.PI/2,r.add(u);const d=new C(new la(34,1.3,14,48),e);d.position.y=20,d.rotation.x=Math.PI/2,r.add(d);for(let p=0;p<18;p+=1){const g=p/18*Math.PI*2,y=36.2,x=new C(new Y(1.2,124,2.4),e);x.position.set(Math.cos(g)*y,63,Math.sin(g)*y),x.castShadow=!0,r.add(x)}const f=[];for(let p=0;p<3;p+=1){const g=48+p*24;for(let y=0;y<3;y+=1){const x=y/3*Math.PI*2+p*.17,S=new vt;S.position.set(Math.cos(x)*31,g,Math.sin(x)*31),S.rotation.y=x+Math.PI;const T=new C(new Y(20,1.4,2.2),e);T.position.z=10,T.castShadow=!0,S.add(T);const M=new C(new Y(3.4,3.4,3.4),n);M.position.z=20.5,S.add(M),S.userData.retractAngle=-.78-p*.08,f.push(S),r.add(S)}}return r.scale.setScalar(zs),{group:r,serviceArms:f}}function wg({boostOuterColor:r,boostTint:t=.4,flickerScale:e=8.5,flickerSpeed:n=3.2,height:s,innerColor:i,intensityGain:a=2.2,outerColor:c,radiusBottom:u,radiusTop:d}){const f=new $t(d,u,s,28,1,!0);f.translate(0,-s*.5,0);const p=Me(0),g=Me(0),y=Xi.y.negate().div(s).clamp(0,1),x=X(1).sub(y).pow(2.1),S=Xi.xz.length(),M=X(1).sub(S.div(u)).clamp(0,1).pow(1.35+e*.012),N=Lu.mul(n).sin().mul(.045).add(.955),v=x.mul(M).mul(N).mul(p).mul(a),A=te(X(1),X(1.54),g),R=te(Xe(i),Xe(r),g.mul(t)),F=te(Xe(c),Xe(r),g),D=te(R,F,y).mul(v).mul(A),O=new Ac;O.colorNode=D,O.opacityNode=v,O.transparent=!0,O.depthWrite=!1,O.blending=Sr;const B=new C(f,O);return B.visible=!1,{mesh:B,setPower:(z,tt=!1)=>{const j=Ou(z);p.value=j,g.value=tt?1:0,B.visible=j>.003,B.scale.set(1+j*.1,.85+j*.65,1+j*.1)}}}function qX(){const r=new vt;r.name="scene05-launch-rocket";const t=new gt({color:15856888,metalness:.26,roughness:.43}),e=new gt({color:3093825,metalness:.44,roughness:.38}),n=new gt({color:10265519,metalness:.74,roughness:.28}),s=new vt;s.name="scene05-stage-one",r.add(s);const i=new C(new $t(4.2,4.8,62,32),t);i.position.y=31,i.castShadow=!0,s.add(i);const a=new C(new $t(4.35,4.6,4.8,32),e);a.position.y=17,s.add(a);const c=new C(new $t(6.2,5.2,8,28),n);c.position.y=4,s.add(c);for(let Yt=0;Yt<4;Yt+=1){const Ne=Yt/4*Math.PI*2,ce=new C(new $t(1.28,1.44,44,16),t);ce.position.set(Math.cos(Ne)*7.1,24,Math.sin(Ne)*7.1),ce.castShadow=!0,s.add(ce)}const u=new vt;u.name="scene05-upper-stage",u.position.y=62,r.add(u);const d=new vt;d.name="scene05-ranger-payload",d.position.y=41,d.visible=!1;const f=t.clone();f.metalness=.22,f.roughness=.5;const p=e.clone();p.metalness=.38,p.roughness=.42;const g=new gt({color:2372169,metalness:.35,roughness:.18,transparent:!0,opacity:.82});g.depthWrite=!1,g.polygonOffset=!0,g.polygonOffsetFactor=-2,g.polygonOffsetUnits=-2;const y=[new Ot(0,5),new Ot(.65,4.25),new Ot(2.3,2.85),new Ot(3.7,-.6),new Ot(3.1,-2.3),new Ot(1.55,-5.05),new Ot(.7,-4.55),new Ot(0,-4.2),new Ot(-.7,-4.55),new Ot(-1.55,-5.05),new Ot(-3.1,-2.3),new Ot(-3.7,-.6),new Ot(-2.3,2.85),new Ot(-.65,4.25)],x=.58,S=new rd(y),T=new xp(S,{depth:x,bevelEnabled:!1});T.translate(0,0,-x*.5);const M=new C(T,f);M.castShadow=!0,d.add(M);const N=y.map(Yt=>new Ot(Yt.x*1.07,Yt.y*1.03)),v=y.map(Yt=>new Ot(Yt.x*.91,Yt.y*.95)),A=new rd(N);A.holes.push(new P2(v));const R=.1,F=.05,D=new xp(A,{depth:R,bevelEnabled:!1});D.translate(0,0,-R*.5);const O=x*.5+R*.5+F,B=new C(D,p);B.position.z=O,B.castShadow=!0,d.add(B);const z=new C(D,p);z.position.z=-O,z.castShadow=!0,d.add(z);const tt=[new Ot(0,3.85),new Ot(.95,3.3),new Ot(1.2,2.05),new Ot(.75,.85),new Ot(0,.5),new Ot(-.75,.85),new Ot(-1.2,2.05),new Ot(-.95,3.3)],j=.22,dt=new rd(tt),wt=new xp(dt,{depth:j,bevelEnabled:!1});wt.translate(0,0,-j*.5);const ft=new C(wt,f);ft.position.set(0,.2,x*.5+j*.5+.05),ft.castShadow=!0,d.add(ft);const U=x*.5+j+.11,K=[new Ot(0,1.45),new Ot(.95,1.12),new Ot(1.25,.25),new Ot(1.02,-.9),new Ot(0,-1.25),new Ot(-1.02,-.9),new Ot(-1.25,.25),new Ot(-.95,1.12)],nt=new rd(K),ht=new Uw(nt,8),_t=new C(ht,g);_t.position.set(0,2.35,U),_t.renderOrder=10,d.add(_t);const P=new C(new Y(.18,5.9,.22),p);P.position.set(2.8,-.8,O+R*.5+.11+.03),P.rotation.z=xt.degToRad(-14),d.add(P);const q=new C(new Y(.18,5.9,.22),p);q.position.set(-2.8,-.8,O+R*.5+.11+.03),q.rotation.z=xt.degToRad(14),d.add(q);const L=new C(new Y(1.6,1.35,.6),p);L.position.set(0,-4.25,-.73),d.add(L);const I=new C(new Y(.48,.9,.45),n);I.position.set(.65,-4.95,-.675),d.add(I);const H=new C(new Y(.48,.9,.45),n);H.position.set(-.65,-4.95,-.675),d.add(H),d.rotation.set(xt.degToRad(4),0,0),u.add(d);const W=t.clone();W.side=En;const at=e.clone();at.side=En;const rt=n.clone();rt.side=En;const et=new vt;et.name="scene05-stage-two-fairing-fragments",u.add(et);const ct=[];for(let Yt=0;Yt<2;Yt+=1){const Ne=Yt===0?-1:1,ce=Ne>0?-Math.PI*.5:Math.PI*.5,We=new vt;We.userData.sideSign=Ne;const Sn=new C(new $t(3,3.4,31,28,1,!0,ce,Math.PI),W);Sn.position.y=15.5,Sn.castShadow=!0,We.add(Sn);const vn=new C(new $t(3.15,3.15,3.2,24,1,!0,ce,Math.PI),at);vn.position.y=8,vn.castShadow=!0,We.add(vn);const rs=new C(new $t(2.55,3,6.2,24,1,!0,ce,Math.PI),rt);rs.position.y=34,rs.castShadow=!0,We.add(rs);const zn=new C(new $t(2.06,2.06,9.3,24,1,!0,ce,Math.PI),W);zn.position.y=40.5,zn.castShadow=!0,We.add(zn);const $n=new C(new pi(2.5,12.5,24,1,!0,ce,Math.PI),W);$n.position.y=49.2,$n.castShadow=!0,We.add($n);const be=new C(new $t(.95,1.5,3.8,18,1,!1,ce,Math.PI),rt);be.position.y=-.25,be.castShadow=!0,We.add(be);const Ze=3.42,An=1.32,Ue=new C(new ox(An,Ze,36,1,ce,Math.PI),W);Ue.rotation.x=-Math.PI/2,Ue.position.y=0,Ue.castShadow=!0,We.add(Ue),We.position.set(0,0,0),We.rotation.set(0,0,0),ct.push(We),et.add(We)}const st=[],Z=new $t(1.35,2.1,4.8,20);for(let Yt=0;Yt<5;Yt+=1){const Ne=Yt/4*Math.PI*2,ce=Yt===4,We=ce?0:Math.cos(Ne)*2.5,Sn=ce?0:Math.sin(Ne)*2.5,vn=new C(Z,n);vn.position.set(We,.8,Sn),s.add(vn),st.push(new G(We,-1.4,Sn))}const Q=[new G(0,60.25,0)],$=new vt;$.position.y=-.8,s.add($);const mt=wg({boostOuterColor:8378879,boostTint:.35,flickerScale:9.8,flickerSpeed:3.7,height:52,innerColor:16774090,intensityGain:2.3,outerColor:16749635,radiusBottom:6.6,radiusTop:2.5}),yt=wg({boostOuterColor:11135231,boostTint:.25,flickerScale:11.4,flickerSpeed:4.5,height:37,innerColor:16777215,intensityGain:2.85,outerColor:16764276,radiusBottom:3.15,radiusTop:.9});$.add(mt.mesh,yt.mesh);const Tt=new C(new ke(3.6,20,14),new $e({color:16767130,transparent:!0,opacity:.56,blending:Sr,depthWrite:!1}));Tt.scale.set(1.2,.66,1.2),Tt.position.y=-2.2,$.add(Tt);const Mt=new vt;Mt.position.y=-1.4,Mt.visible=!1,u.add(Mt);const Vt=wg({boostOuterColor:8707327,flickerScale:10.3,flickerSpeed:3.9,height:20,innerColor:16775124,intensityGain:2.4,outerColor:16755542,radiusBottom:2.65,radiusTop:.82}),zt=wg({boostOuterColor:11923199,boostTint:.2,flickerScale:12.2,flickerSpeed:4.7,height:13.5,innerColor:16777215,intensityGain:3,outerColor:16766867,radiusBottom:1.25,radiusTop:.4});Mt.add(Vt.mesh,zt.mesh);const kt=new C(new ke(1.7,16,12),new $e({color:16770750,transparent:!0,opacity:.62,blending:Sr,depthWrite:!1}));kt.scale.set(1.16,.54,1.16),kt.position.y=-.95,Mt.add(kt);function Qt(Yt,Ne=!1){const ce=Ou(Yt);mt.setPower(ce,Ne),yt.setPower(ce,Ne),$.visible=ce>.003,Tt.visible=$.visible,Tt.material.opacity=xt.lerp(.2,.6,ce),Tt.scale.setScalar(xt.lerp(.72,1.34,ce)),Tt.scale.y*=.56}function ie(Yt,Ne=!1){const ce=Ou(Yt);Vt.setPower(ce,Ne),zt.setPower(ce,Ne),Mt.visible=ce>.003,kt.visible=Mt.visible,kt.material.opacity=xt.lerp(.22,.64,ce),kt.scale.setScalar(xt.lerp(.76,1.26,ce)),kt.scale.y*=.54}return r.scale.setScalar(zs),{group:r,stageOne:s,stageOneNozzles:st,setStageOnePlume:Qt,setStageTwoPlume:ie,stageTwoNozzles:Q,upperStage:u,rangerPayload:d,stageTwoFragments:ct}}function $X(){const r=new vt;r.name="scene05-endurance";const t=new gt({color:14540253,roughness:.4,metalness:.6}),e=new gt({color:3355443,roughness:.5,metalness:.7}),n=new gt({color:1118481,roughness:.15,metalness:.9}),s=new gt({color:328965,roughness:.05,metalness:.8}),i=[t,e,n,s],a=i.map(B=>B.color.clone());for(const B of i)B.transparent=!0,B.opacity=1;const c=32,u=12;for(let B=0;B<u;B+=1){const z=B/u*Math.PI*2,tt=new vt,j=new C(new Y(8,7,10),t);j.castShadow=!0,j.receiveShadow=!0,tt.add(j);const dt=new C(new Y(7.5,6.5,1),n);dt.position.set(0,0,-4.6),dt.castShadow=!0,dt.receiveShadow=!0,tt.add(dt);const wt=new C(new Y(8.2,2,4),e);wt.position.set(0,0,1),tt.add(wt),tt.position.set(Math.cos(z)*c,Math.sin(z)*c,0),tt.rotation.z=z+Math.PI/2,tt.lookAt(0,0,0),r.add(tt);const ft=z+Math.PI/u,U=new vt;U.position.set(Math.cos(ft)*c,Math.sin(ft)*c,0),U.rotation.z=ft;const K=new C(new $t(2,2,9,32),t);K.castShadow=!0,K.receiveShadow=!0,U.add(K);const nt=new C(new $t(2.8,2.8,2.5,32),t);U.add(nt);const ht=new C(new $t(1.2,1.2,3.5,32),s);ht.rotation.z=Math.PI/2,U.add(ht);const _t=new C(new $t(1.5,1.5,3.2,32),e);_t.rotation.z=Math.PI/2,U.add(_t),r.add(U)}const d=c-5,f=new vt;f.position.set(0,d/2+2,0);const p=new C(new $t(2.5,2.5,d,32),t);p.castShadow=!0,p.receiveShadow=!0,f.add(p);for(let B=-1;B<=1;B+=1){const z=new C(new $t(3,3,2,32),e);z.position.y=B*(d/3),f.add(z)}r.add(f);const g=new C(new $t(4,4,3,32),t);g.rotation.x=Math.PI/2,g.castShadow=!0,g.receiveShadow=!0,r.add(g);const y=new C(new la(3,.5,16,64),e);y.position.z=1.5,r.add(y);const x=new vt,S=new pi(4.5,10,4);S.rotateY(Math.PI/4),S.rotateX(Math.PI/2),S.scale(1.1,.2,1);const T=new C(S,t);T.castShadow=!0,T.receiveShadow=!0,x.add(T);const M=S.clone();M.scale(.98,.5,.98),M.translate(0,-.15,0);const N=new C(M,e);N.castShadow=!0,x.add(N);const v=new C(new Y(2.2,.8,3.5),t);v.position.set(0,.4,0),v.rotation.x=Math.PI/16,v.castShadow=!0,x.add(v);const A=new C(new Y(1.8,.6,1.5),s);A.position.set(0,.7,1.2),A.rotation.x=Math.PI/6,x.add(A);const R=new Y(3.5,.2,4),F=new C(R,t);F.position.set(-2.8,0,-2.5),F.rotation.y=Math.PI/8,F.castShadow=!0,x.add(F);const D=new C(R,t);D.position.set(2.8,0,-2.5),D.rotation.y=-Math.PI/8,D.castShadow=!0,x.add(D);const O=new C(new Y(3,1,1.5),e);return O.position.set(0,-.1,-4.8),x.add(O),x.position.set(0,0,7.5),x.rotation.set(0,0,0),r.add(x),r.scale.setScalar(zs*V$),{baseColors:a,group:r,materials:i}}function XX(){const t=new Float32Array(15600),e=new Float32Array(5200*3),n=Zo*180,s=new G;for(let u=0;u<5200;u+=1){const d=u*3,f=Math.acos(xt.randFloatSpread(2)),p=Math.random()*Math.PI*2,g=Math.sin(f);s.set(g*Math.cos(p),Math.cos(f),g*Math.sin(p)),t[d]=s.x*n,t[d+1]=s.y*n,t[d+2]=s.z*n;const y=xt.randFloat(.14,.98),x=Math.pow(Math.random(),1.1),S=xt.clamp(y*(.58+x*.72),.06,1),T=xt.randFloat(-.08,.08);e[d]=xt.clamp(S+T*.5,.04,1),e[d+1]=xt.clamp(S+T*.15,.04,1),e[d+2]=xt.clamp(S-T*.45,.04,1)}const i=new Ye;i.setAttribute("position",new ge(t,3)),i.setAttribute("color",new ge(e,3));const a=new tr({color:16777215,size:1.38,sizeAttenuation:!1,transparent:!0,opacity:0,depthWrite:!1,vertexColors:!0}),c=new Qr(i,a);return c.name="scene05-space-stars",c}function jX(){const r=new vt;return r.name="scene05-exhaust-particles-disabled",r.visible=!1,{clear(){},points:r,update(){}}}const YX={id:"endurance-launch",title:"Endurance Launch from Earth",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,g=0,y=0,x=0,S=null,T=null,M=null,N=[],v=[];const A=new qt,R={elapsed:0,orbitPitch:0,orbitYaw:0,previousRocketPosition:new G,rocketVelocity:new G,rocketAcceleration:new G,sequenceComplete:!1,stageOneDetached:!1,detachedAlongOffset:0,detachedAlongSpeed:0,detachedSideOffset:0,detachedSideSpeed:0,detachedEarthOffset:0,detachedEarthSpeed:0,detachedSideSign:1,detachedSideDirection:new G(1,0,0),detachedTiltBaseQuaternion:new Us,detachedTiltTargetQuaternion:new Us,detachedSpinAxis:new G(0,1,0),detachedSpinRate:0,separationShock:0,detachedTimer:0,centerTransition01:0,enduranceSpinAngle:0,stageTwoSeparated:!1,stageTwoSeparationTimer:0};function F(U,K){R.stageOneDetached&&R.detachedTimer>=cX?R.centerTransition01=Math.min(1,R.centerTransition01+K*.5):R.centerTransition01=0;const nt=R.centerTransition01*R.centerTransition01*(3-2*R.centerTransition01);return Sg.copy(OX).lerp(FX,nt),U.copy(Sg).applyMatrix4(s.group.matrixWorld),U}function D(U){const K=Math.max(U-jl,0),nt=zX(K),ht=Ou(nt.distance/nt.totalDistance),_t=Math.max(K-mc,0),P=Math.min(_t,dw),q=xt.clamp(_t-dw,0,Wg),L=Ou(q/Math.max(Wg,1e-6)),I=q-q*q/(2*Math.max(Wg,1e-6)),H=P+I,W=ht*L$+H*O$,at=Ls(lp,mc*.86,K),et=(Math.pow(ht,1.22)*F$*at+H*U$)/Zo,ct=Math.sin(ht*Math.PI*.82)*P$*at+H*z$,st=Zo+W,Z=Math.cos(et),Q=-Math.sin(et);an.set(0,Z,Q).normalize(),ti.set(0,-Math.sin(et),-Math.cos(et)).normalize(),s.group.position.set(ct,BX+an.y*st,an.z*st);const $=Ls(lp+.3,mc*.9,K);Bs.copy(an).lerp(ti,$*.9).normalize();const mt=1-Ls(.05,.9,ht),yt=(Math.sin(U*52)+Math.sin(U*31+.7))*.0024*mt,Tt=Math.sin(U*2.5)*.008*mt+yt;return s.group.quaternion.setFromUnitVectors(fw,Bs),Zh.setFromAxisAngle(Bs,Tt),s.group.quaternion.multiply(Zh),s.group.updateMatrixWorld(!0),{ascentProgress:ht,altitude:W,coastProgress:L,launchTime:K,velocity01:nt.velocity01}}function O(U){R.stageOneDetached||(R.stageOneDetached=!0,R.detachedTimer=0,R.separationShock=0,R.centerTransition01=0,s.stageOne.getWorldPosition(an),s.stageOne.getWorldQuaternion(Yl),s.stageOne.getWorldScale(ks),s.group.remove(s.stageOne),t.add(s.stageOne),s.stageOne.position.copy(an),s.stageOne.quaternion.copy(Yl),s.stageOne.scale.copy(ks),s.stageOne.frustumCulled=!1,ti.set(0,1,0).applyQuaternion(s.group.quaternion).normalize(),Bs.set(1,0,0).applyQuaternion(s.group.quaternion).normalize(),Ga.copy(e.atmosphereCenter).sub(s.group.position).normalize(),ks.copy(s.stageOne.position).sub(s.group.position),R.detachedAlongOffset=ks.dot(ti),R.detachedSideOffset=ks.dot(Bs),R.detachedEarthOffset=ks.dot(Ga),U?(Zf.copy(U.position).sub(s.group.position),R.detachedSideSign=Bs.dot(Zf)>=0?1:-1):R.detachedSideSign=Math.abs(R.detachedSideOffset)>As(.01)?Math.sign(R.detachedSideOffset):Math.random()<.5?-1:1,R.detachedSideDirection.copy(Bs).multiplyScalar(R.detachedSideSign),R.detachedAlongOffset=hX,R.detachedSideOffset=dX,R.detachedEarthOffset=fX,R.detachedAlongSpeed=pX,R.detachedSideSpeed=mX,R.detachedEarthSpeed=gX,s.stageOne.position.copy(s.group.position),s.stageOne.position.addScaledVector(ti,R.detachedAlongOffset),s.stageOne.position.addScaledVector(R.detachedSideDirection,R.detachedSideOffset),s.stageOne.position.addScaledVector(Ga,R.detachedEarthOffset),R.detachedTiltBaseQuaternion.copy(s.stageOne.quaternion),an.set(vi(.65),vi(.25),vi(.65)),an.lengthSq()<1e-6&&an.set(0,0,1),an.applyQuaternion(s.group.quaternion).normalize(),Zh.setFromAxisAngle(an,xt.degToRad(xt.randFloat(NX,RX))),R.detachedTiltTargetQuaternion.copy(R.detachedTiltBaseQuaternion).multiply(Zh),R.detachedSpinAxis.copy(R.detachedSideDirection).addScaledVector(ti,.55).add(new G(vi(.12),vi(.12),vi(.12))).normalize(),R.detachedSpinRate=xt.randFloat(EX,CX)*(Math.random()<.5?-1:1),s.setStageOnePlume(0),s.setStageTwoPlume(.15))}function B(U){if(!R.stageOneDetached)return;R.detachedTimer+=U;const K=Ls(0,SX,R.detachedTimer),nt=1-Ls(0,uX,R.detachedTimer);an.set(0,1,0).applyQuaternion(s.group.quaternion).normalize(),ti.set(1,0,0).applyQuaternion(s.group.quaternion).normalize().multiplyScalar(R.detachedSideSign),R.detachedSideDirection.lerp(ti,xt.clamp(U*1.3,0,1)).normalize(),ks.copy(e.atmosphereCenter).sub(s.group.position).normalize();const ht=xt.lerp(wX,TX,K)+yX*nt,_t=xt.lerp(_X,MX,K)+xX*nt,P=xt.lerp(vX,AX,K)+bX*nt;if(R.detachedAlongSpeed+=ht*U,R.detachedAlongOffset+=R.detachedAlongSpeed*U,R.detachedSideSpeed+=_t*U,R.detachedSideOffset+=R.detachedSideSpeed*U,R.detachedEarthSpeed+=P*U,R.detachedEarthOffset+=R.detachedEarthSpeed*U,Bs.copy(s.group.position),Bs.addScaledVector(an,R.detachedAlongOffset),Bs.addScaledVector(R.detachedSideDirection,R.detachedSideOffset),Bs.addScaledVector(ks,R.detachedEarthOffset),s.stageOne.position.copy(Bs),R.detachedTimer<=LE){const q=Ls(0,LE,R.detachedTimer);s.stageOne.quaternion.copy(R.detachedTiltBaseQuaternion).slerp(R.detachedTiltTargetQuaternion,q)}else Zh.setFromAxisAngle(R.detachedSpinAxis,R.detachedSpinRate*U),s.stageOne.quaternion.multiply(Zh)}function z(){if(R.stageTwoSeparated||!s?.stageTwoFragments?.length)return;R.stageTwoSeparated=!0,v=[],s.rangerPayload.visible=!0,an.set(0,1,0).applyQuaternion(s.group.quaternion).normalize(),ti.set(1,0,0).applyQuaternion(s.group.quaternion).normalize(),ks.copy(e.atmosphereCenter).sub(s.group.position).normalize();const U=As(nX),K=As(sX),nt=As(iX);for(let ht=0;ht<s.stageTwoFragments.length;ht+=1){const _t=s.stageTwoFragments[ht],P=_t.userData.sideSign??(ht===0?-1:1);_t.getWorldPosition(Bs),_t.getWorldQuaternion(Yl),_t.getWorldScale(Ga),_t.parent&&_t.parent.remove(_t),t.add(_t),_t.position.copy(Bs),_t.quaternion.copy(Yl),_t.scale.copy(Ga),_t.frustumCulled=!1;const q=new G;q.addScaledVector(ti,P*U*xt.randFloat(.9,1.2)),q.addScaledVector(an,-K*xt.randFloat(.92,1.15)),q.addScaledVector(ks,nt*xt.randFloat(.85,1.25)),q.add(new G(vi(As(.9)),vi(As(.5)),vi(As(.9))));const L=new G;L.addScaledVector(an,P*rX),L.x+=vi(.45),L.y+=vi(.25),L.z+=vi(.45),v.push({object:_t,velocity:q,angularVelocity:L,springTimer:DE,springLateralDir:ti.clone().multiplyScalar(P),springBackDir:an.clone().negate(),springSpinDir:an.clone().multiplyScalar(P)})}}function tt(U){if(!R.stageTwoSeparated||v.length===0)return;const K=xt.clamp(U,0,.05);if(K<=0)return;const nt=Math.exp(-.02*K),ht=Math.exp(-.035*K),_t=As(oX),P=As(aX),q=lX;for(let L=0;L<v.length;L+=1){const I=v[L],H=I.object;if(I.springTimer>0){const rt=Ou(I.springTimer/DE),et=rt*rt;I.velocity.addScaledVector(I.springLateralDir,_t*et*K),I.velocity.addScaledVector(I.springBackDir,P*et*K),I.angularVelocity.addScaledVector(I.springSpinDir,q*et*K),I.springTimer=Math.max(0,I.springTimer-K)}y2.copy(H.position).sub(e.atmosphereCenter);const W=y2.lengthSq();if(W>1e-5){const rt=1/Math.sqrt(W),ct=-398600.4418*(rt*rt*rt);I.velocity.addScaledVector(y2,ct*K)}I.velocity.multiplyScalar(nt),H.position.addScaledVector(I.velocity,K),I.angularVelocity.multiplyScalar(ht);const at=I.angularVelocity.length();at>1e-6&&(PE.copy(I.angularVelocity).multiplyScalar(1/at),Yl.setFromAxisAngle(PE,at*K),H.quaternion.multiply(Yl))}}function j(){const U=R.stageOneDetached?s.stageTwoNozzles:s.stageOneNozzles,K=[];for(let nt=0;nt<U.length;nt+=1)an.copy(U[nt]).applyMatrix4(s.group.matrixWorld),K.push(an.clone());return K}function dt(U,K,nt,ht,_t){F(an,K),ti.copy(an).sub(e.atmosphereCenter).normalize();const P=Ls(lp,lp+7,_t),q=xt.lerp(As(16),As(96),P),L=xt.lerp(.22,.88,P),I=xt.lerp(.12,.28,P),H=L+R.orbitYaw,W=xt.clamp(I+R.orbitPitch,-.72,1.08);ks.set(Math.sin(H)*Math.cos(W)*q,Math.sin(W)*q,Math.cos(H)*Math.cos(W)*q),Yl.setFromUnitVectors(fw,ti),ks.applyQuaternion(Yl),Bs.copy(an).add(ks);const at=Ls(0,.35,_t),rt=1-Ls(.8,3.2,_t),ct=at*rt*As(.18);Ga.set(vi(ct),vi(ct*.6),vi(ct)),Bs.add(Ga),U.position.copy(Bs),U.lookAt(an);const st=xt.lerp(43,57,Ls(.18,.78,ht));Math.abs(U.fov-st)>.02&&(U.fov=st,U.updateProjectionMatrix()),nt<jl+.2&&(U.position.y+=Math.sin(nt*88)*As(.08))}function wt(U,K){if(!e||!e.atmosphereShellOpacity||!e.atmosphereFrontFaceOpacity||!e.atmosphereBackFaceOpacity)return;const nt=U.position.distanceTo(e.atmosphereCenter),ht=Math.max(0,K??0),_t=nt-Gp,q=Math.max(X$*ir,sc*j$),L=1-xt.smoothstep(_t,-q,q),I=xt.clamp(Ls(0,Y$,ht)*CE,0,CE);e.atmosphereFrontFaceOpacity.value=xt.clamp(1-L,0,1),e.atmosphereBackFaceOpacity.value=xt.clamp(L,0,1),e.atmosphereShellOpacity.value=I}function ft(U){if(!e||!i||!i.materials||!i.baseColors)return;i.group.getWorldPosition(HE);const K=kX({atmosphereCenter:e.atmosphereCenter,bodyRadius:Zo,cameraPosition:U.position,model:e.atmosphereModel,sunDirection:e.sunDirection,targetPosition:HE,topRadius:Gp}),nt=K.transmittance;for(let ht=0;ht<i.materials.length;ht+=1){const _t=i.materials[ht],P=i.baseColors[ht];GE.setRGB(P.r*nt.x+K.airlight.r*(1-nt.x),P.g*nt.y+K.airlight.g*(1-nt.y),P.b*nt.z+K.airlight.b*(1-nt.z)),kE.copy(P).lerp(GE,K.effectWeight),_t.color.copy(kE);const q=xt.clamp(1-K.effectWeight*(1-K.transLuma)*1.2,.03,1);_t.opacity=q}}return{async init({root:U,camera:K,renderer:nt,scene:ht}){r=U,t=new vt,t.name="scene05-root",U.add(t),g=K.near,y=K.far,x=K.fov,K.near=As(5),K.far=24e4,K.fov=45,K.updateProjectionMatrix(),ht.background&&ht.background.isColor?S=ht.background.clone():S=null,ht.background=UE.clone(),d=new Vu(14018559,3089945,.72),u=new Fs(16773336,2.05),f=new Fs(8103935,.55),p=new ls(16752199,0,As(340),1.9),u.position.set(760,1140,580),f.position.set(-980,340,-920),t.add(d,u,f,p);const P=await new Vw().loadAsync("/textures/earth_texture.jpg");P.colorSpace=fn,P.wrapS=Bn,P.wrapT=ji,P.center.set(.5,.5),P.offset.set(tX,0),P.rotation=xt.degToRad(J$),P.generateMipmaps=!0,nt?.capabilities&&typeof nt.capabilities.getMaxAnisotropy=="function"&&(P.anisotropy=Math.min(8,nt.capabilities.getMaxAnisotropy())),P.needsUpdate=!0,e=HX(P),n=WX(),s=qX(),i=$X(),a=XX(),c=jX(),t.add(e.group),t.add(n.group),t.add(s.group),t.add(c.points),t.add(i.group),t.add(a),N=[],ht.traverse(L=>{L?.isPoints&&(L===a||L.name==="scene05-space-stars"||(N.push({object:L,visible:L.visible}),L.visible=!1))}),D(0),R.previousRocketPosition.copy(s.group.position),s.setStageOnePlume(0),s.setStageTwoPlume(0);const q=jl+g2;D(q),Ga.copy(s.group.position),D(q+.12),Sg.copy(s.group.position),ks.copy(Sg).sub(Ga),ks.lengthSq()<1e-8&&ks.set(0,0,-1),ks.normalize(),D(q),F(an,0),ti.set(0,1,0).applyQuaternion(s.group.quaternion).normalize(),Bs.copy(an).sub(e.atmosphereCenter).normalize(),i.group.position.copy(an),i.group.position.addScaledVector(ks,I$),i.group.position.addScaledVector(ti,G$),i.group.position.addScaledVector(Bs,k$),i.group.rotation.set(.46,-.12,.9),D(0),R.previousRocketPosition.copy(s.group.position),K.position.set(As(10.5),As(68),As(18.5)),K.lookAt(0,T_+As(66),0),T=L=>{UX.has(L.code)&&document.pointerLockElement&&(L.preventDefault(),L.stopPropagation(),typeof L.stopImmediatePropagation=="function"&&L.stopImmediatePropagation())},window.addEventListener("keydown",T,!0),M=L=>{document.pointerLockElement&&(R.orbitYaw-=L.movementX*.0022,R.orbitPitch=xt.clamp(R.orbitPitch+L.movementY*.0018,-.85,.95))},window.addEventListener("mousemove",M,!0)},update({delta:U,camera:K,scene:nt}){if(!t||!s||!e||!n||!i||!a||!c)return;const ht=Math.min(U,.05);R.sequenceComplete||(R.elapsed+=ht);const _t=R.elapsed;let P=D(_t),q=P.ascentProgress,L=P.altitude,I=P.coastProgress,H=P.velocity01;!R.sequenceComplete&&P.launchTime>=g2&&(R.sequenceComplete=!0,R.elapsed=jl+g2,P=D(R.elapsed),q=P.ascentProgress,L=P.altitude,I=P.coastProgress,H=P.velocity01,R.separationShock=0,c.clear(),c.points.visible=!1,s.setStageOnePlume(0),s.setStageTwoPlume(0),R.stageTwoSeparationTimer=0),R.sequenceComplete&&!R.stageTwoSeparated&&(R.stageTwoSeparationTimer+=ht,R.stageTwoSeparationTimer>=eX&&z()),R.stageTwoSeparated&&tt(ht),R.sequenceComplete?(R.rocketVelocity.set(0,0,0),R.rocketAcceleration.set(0,0,0)):(Zf.copy(s.group.position).sub(R.previousRocketPosition).multiplyScalar(1/Math.max(ht,1e-4)),R.rocketAcceleration.copy(Zf).sub(R.rocketVelocity).multiplyScalar(1/Math.max(ht,1e-4)),R.rocketVelocity.copy(Zf)),R.previousRocketPosition.copy(s.group.position);const W=Ls(jl-.5,jl+.45,_t);!R.stageOneDetached&&P.launchTime>=m2&&O(K),R.sequenceComplete||B(ht),R.separationShock=Math.max(0,R.separationShock-ht*1.85),wt(K,L);const at=Ls(m2,m2+2.5,P.launchTime),rt=xt.lerp(.8,1.2,H),et=R.stageOneDetached?xt.lerp(.52,.86,at)*rt:W*xt.lerp(.75,1.05,H),ct=1-Ls(0,1,I),st=R.sequenceComplete?0:et*ct;if(R.sequenceComplete)s.setStageOnePlume(0),s.setStageTwoPlume(0);else if(R.stageOneDetached){const Tt=.9+Math.sin(_t*28)*.1;s.setStageOnePlume(0),s.setStageTwoPlume(st*Tt,!0)}else{const Tt=.9+Math.sin(_t*36)*.1;s.setStageOnePlume(st*Tt,!1),s.setStageTwoPlume(0)}const Z=j();an.set(0,-1,0).applyQuaternion(s.group.quaternion).normalize();const Q=1-Ls(sc*.1,sc*.95,L),$=Q>.45&&st>.02;R.sequenceComplete?c.points.visible=!1:$?(c.points.visible=!0,c.update(ht,Z,an,R.rocketVelocity,st,Q)):(c.clear(),c.points.visible=!1);const mt=Ls(jl-.32,jl+1.15,_t);for(let Tt=0;Tt<n.serviceArms.length;Tt+=1){const Mt=n.serviceArms[Tt],Vt=Mt.userData.retractAngle??-.8;Mt.rotation.x=Vt*mt}const yt=Ls(sc*.1,sc*.5,L);A.copy(UE).lerp(LX,yt),nt.background=A,d.intensity=xt.lerp(.72,.22,yt),u.intensity=xt.lerp(2.05,2.4,yt),f.intensity=xt.lerp(.55,.9,yt),p.intensity=R.sequenceComplete?0:xt.lerp(0,9.4,st),ti.copy(Z[0]??s.group.position).add(an.clone().multiplyScalar(As(8))),p.position.copy(ti),R.sequenceComplete||(e.earth.rotation.y+=ht*.012,e.clouds.rotation.y+=ht*.018,e.atmosphere.rotation.y+=ht*.004),R.enduranceSpinAngle+=ht*.12,i.group.rotation.set(.46,-.12,.9+R.enduranceSpinAngle),ft(K),a.material.opacity=xt.lerp(0,.86,Ls(sc*.2,sc*.65,L)),dt(K,ht,_t,q,P.launchTime)},resize(){},dispose({camera:U,scene:K}){U&&(U.near=g||U.near,U.far=y||U.far,U.fov=x||U.fov,U.updateProjectionMatrix()),T&&(window.removeEventListener("keydown",T,!0),T=null),M&&(window.removeEventListener("mousemove",M,!0),M=null),K&&(K.background=S??new qt(132106));for(let nt=0;nt<N.length;nt+=1){const ht=N[nt];ht?.object&&(ht.object.visible=ht.visible)}N=[],t&&(r&&t.parent!==r&&r.add(t),Li(t)),r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,S=null}}}},Ud=1,tL=Ud/1e3,eL=58232,nL=2500,pw=eL*Ud,WE=(eL+nL)*Ud,KX=7e4,ZX=14e4,qE=KX*Ud,jy=ZX*Ud,QX=new qt(132106),JX=new qt(16777215),$E=18,XE=10,tj=1.7,ej=40,nj=12,sL=36e4,sj=500,iL=14e3,mw=iL/sj,rL=new G(-.86,.18,.47).normalize(),ij=new Set(["KeyW","KeyA","KeyS","KeyD","Space","ShiftLeft","ShiftRight"]),Qh=new G,jE=new G,Tg=new G,YE=new G,rj=new G(0,0,0),KE=new G(0,1,0);function Jh(r){return r*tL}function oj(r){return xt.clamp(r,0,1)}function Ha(r,t,e){if(r===t)return e<r?0:1;const n=oj((e-r)/(t-r));return n*n*(3-2*n)}function aj(r){let t=r>>>0;return()=>(t=1664525*t+1013904223>>>0,t/4294967296)}function lj({width:r,height:t},e){const n=document.createElement("canvas");n.width=r,n.height=t;const s=n.getContext("2d");if(!s)throw new Error("Could not create canvas context for procedural texture.");e(s,r,t);const i=new bi(n);return i.colorSpace=fn,i.generateMipmaps=!0,i.minFilter=Jo,i.magFilter=qs,i.wrapS=ji,i.wrapT=Bn,i.needsUpdate=!0,i}function cj(){const r=aj(607);return lj({width:2048,height:256},(t,e,n)=>{t.clearRect(0,0,e,n);for(let s=0;s<e;s+=1){const i=s/(e-1),a=Ha(.01,.06,i),c=1-Ha(.94,.99,i),u=a*c,d=.52+.22*Math.sin(i*82+.7)+.18*Math.sin(i*193+1.9)+.08*Math.sin(i*421+.4),f=.12*Math.sin(i*1600+8.2)+.06*Math.sin(i*2400+1.1),p=(r()-.5)*.1+f,g=1-Ha(.615,.64,i)*(1-Ha(.64,.675,i)),y=1-Ha(.23,.255,i)*(1-Ha(.255,.275,i));let x=u*g*y;x*=xt.clamp(d+p,.06,1.1),x*=xt.lerp(.52,1,Ha(.12,.42,i)),x*=xt.lerp(1,1.15,Ha(.72,.92,i)),x=xt.clamp(x,0,1);const S=xt.lerp(.92,1.06,Ha(.12,.9,i)),T=xt.lerp(.22,.98,x),M=Math.floor(238*T*S),N=Math.floor(220*T),v=Math.floor(186*T*.98);t.fillStyle=`rgba(${M}, ${N}, ${v}, ${x})`,t.fillRect(s,0,1,n)}t.globalAlpha=.08,t.fillStyle="#000000";for(let s=0;s<1200;s+=1){const i=Math.floor(r()*e),a=Math.floor(r()*n),c=1+Math.floor(r()*2);t.fillRect(i,a,c,1)}t.globalAlpha=1})}function uj(r,t,e){const n=r.attributes.position,s=new Float32Array(n.count*2),i=Math.max(e-t,1e-6);for(let a=0;a<n.count;a+=1){const c=n.getX(a),u=n.getY(a),f=(Math.atan2(u,c)+Math.PI)/(Math.PI*2),p=Math.sqrt(c*c+u*u),g=xt.clamp((p-t)/i,0,1),y=a*2;s[y]=g,s[y+1]=f}r.setAttribute("uv",new hs(s,2)),r.attributes.uv.needsUpdate=!0}function hj(){const t=new Float32Array(21e3),e=new Float32Array(7e3*3),n=sL*.86,s=new G;for(let u=0;u<7e3;u+=1){const d=u*3,f=Math.acos(xt.randFloatSpread(2)),p=Math.random()*Math.PI*2,g=Math.sin(f);s.set(g*Math.cos(p),Math.cos(f),g*Math.sin(p)),t[d]=s.x*n,t[d+1]=s.y*n,t[d+2]=s.z*n;const y=xt.randFloat(.12,1.05),x=Math.pow(Math.random(),1.05),S=xt.clamp(y*(.5+x*.8),.04,1),T=xt.randFloat(-.09,.1);e[d]=xt.clamp(S+T*.5,.02,1),e[d+1]=xt.clamp(S+T*.15,.02,1),e[d+2]=xt.clamp(S-T*.45,.02,1)}const i=new Ye;i.setAttribute("position",new ge(t,3)),i.setAttribute("color",new ge(e,3));const a=new tr({color:JX,size:1.15,sizeAttenuation:!1,transparent:!0,opacity:1,depthWrite:!1,vertexColors:!0}),c=new Qr(i,a);return c.name="scene06-space-stars",c}function Ql(r,t){return[r[0]*t,r[1]*t,r[2]*t]}function dj(r){let t=1;switch(r){case"terrestrial":t=2.15;break;case"rocky":t=2;break;case"gasGiant":case"iceGiant":t=1.35;break;default:t=1;break}return t*tj}function fj(r,t){const e=Math.max(r.atmosphereHeightKm,1),n=xt.clamp(r.atmosphereDensity,.15,1.8),s=xt.clamp((n-.25)/1.35,0,1),i=dj(r.kind);let a={rayleighScatteringKm:[.0058,.0135,.0331],mieScatteringKm:[.0022,.0022,.0022],mieExtinctionKm:[.0032,.0032,.0032],rayleighScaleHeightKm:xt.lerp(7.2,10.8,s),upperRayleighScaleHeightKm:Math.max(36,e*.36*i),upperRayleighStrength:.04,mieScaleHeightKm:xt.lerp(.9,1.7,s),miePhaseG:.76,ozoneExtinctionKm:[65e-5,.001881,85e-6],ozoneCenterHeightKm:Math.min(e*.42,26),ozoneWidthKm:Math.max(6,Math.min(e*.18,14)),solarIntensity:13.8};a={rayleighScatteringKm:[.0016,.0031,.0058],mieScatteringKm:[.0022,.0022,.0022],mieExtinctionKm:[.0032,.0032,.0032],rayleighScaleHeightKm:Math.max(20,e*.09),upperRayleighScaleHeightKm:Math.max(64,e*.26*i),upperRayleighStrength:.02,mieScaleHeightKm:Math.max(6,e*.026),miePhaseG:.82,ozoneExtinctionKm:[0,0,0],ozoneCenterHeightKm:e*.65,ozoneWidthKm:Math.max(12,e*.22),solarIntensity:10};const c=n,u=n*.9,d=Ql(a.rayleighScatteringKm,c),f=Ql(a.mieScatteringKm,u),p=Ql(a.mieExtinctionKm,u),g=[Math.max(p[0],f[0]+1e-4),Math.max(p[1],f[1]+1e-4),Math.max(p[2],f[2]+1e-4)],y=Ql(a.ozoneExtinctionKm??[0,0,0],1),x=t,S=1/Math.max(x,1e-6);return{rayleighScatteringWorld:Ql(d,S),mieScatteringWorld:Ql(f,S),mieExtinctionWorld:Ql(g,S),ozoneExtinctionWorld:Ql(y,S),rayleighScaleHeightWorld:Math.max(a.rayleighScaleHeightKm*x,1e-5),upperRayleighScaleHeightWorld:Math.max((a.upperRayleighScaleHeightKm??a.rayleighScaleHeightKm*2.6)*x,1e-5),upperRayleighStrength:xt.clamp(a.upperRayleighStrength??.05,0,.24),mieScaleHeightWorld:Math.max(a.mieScaleHeightKm*x,1e-5),ozoneCenterHeightWorld:Math.max((a.ozoneCenterHeightKm??0)*x,0),ozoneWidthWorld:Math.max((a.ozoneWidthKm??1)*x,1e-5),miePhaseG:xt.clamp(a.miePhaseG,0,.92),solarIntensity:a.solarIntensity??18}}function pj(r,t,e,n,s,i,a,c){const u=Dt(c.rayleighScatteringWorld[0],c.rayleighScatteringWorld[1],c.rayleighScatteringWorld[2]),d=Dt(c.mieScatteringWorld[0],c.mieScatteringWorld[1],c.mieScatteringWorld[2]),f=Dt(c.mieExtinctionWorld[0],c.mieExtinctionWorld[1],c.mieExtinctionWorld[2]),p=Dt(c.ozoneExtinctionWorld[0],c.ozoneExtinctionWorld[1],c.ozoneExtinctionWorld[2]),g=X(c.rayleighScaleHeightWorld),y=X(c.upperRayleighScaleHeightWorld),x=X(c.upperRayleighStrength),S=X(c.mieScaleHeightWorld),T=X(c.ozoneCenterHeightWorld),M=X(c.ozoneWidthWorld),N=X(c.miePhaseG),v=X(c.solarIntensity),A=Jn(()=>{const F=Ar,D=Fn($u.sub(Ar)),O=Fn(r),B=t,z=e,tt=n,j=ue(tt.sub(z),z.mul(.005)),dt=j.mul(.24),wt=j.mul(.16),ft=F.sub(B),U=Ae(ft,D),K=Ae(ft,ft).sub(tt.mul(tt)),nt=U.mul(U).sub(K),ht=me(0,nt),_t=Tr(ue(nt,0)),P=Hn(U.negate().sub(_t),U.negate().add(_t)),q=Ae(ft,D),L=Ae(ft,ft).sub(z.mul(z)),I=q.mul(q).sub(L),H=me(0,I),W=Tr(ue(I,0)),at=Hn(q.negate().sub(W),q.negate().add(W)),rt=me(0,at.x).mul(H),et=ue(P.x,0).mul(ht),ct=ue(te(P.y,w_(P.y,at.x),rt),0).mul(ht),st=ue(ct.sub(et),0),Z=st.div(X($E)),Q=bn(0,wt,st),$=Ae(D,O),mt=X(.05968310365946075).mul(X(1).add($.mul($))),yt=N.mul(N),Tt=X(.07957747154594767).mul(X(1).sub(yt)).div(ei(X(1).add(yt).sub(X(2).mul(N).mul($)),1.5)),Mt=X(0).toVar(),Vt=X(0).toVar(),zt=X(0).toVar(),kt=Dt(0,0,0).toVar();ll($E,({i:rs})=>{const zn=et.add(Z.mul(X(rs).add(.5))),$n=F.add(D.mul(zn)),be=$n.sub(B),Ze=Mo(be),An=Ze.sub(z),Ue=me(0,An),Xn=ue(An,0),le=ue(tt.sub(Ze),0),oe=bn(0,dt,le),Ve=On(Xn.negate().div(g)),pn=On(Xn.negate().div(y)).mul(x),jn=Ve.add(pn).mul(Ue).mul(oe),Yn=On(Xn.negate().div(S)).mul(Ue).mul(oe),Oi=ue(X(1).sub(ii(Xn.sub(T)).div(M)),0).mul(Ue).mul(oe);Mt.addAssign(jn.mul(Z)),Vt.addAssign(Yn.mul(Z)),zt.addAssign(Oi.mul(Z));const bs=Ae(be,O),Uc=Ae(be,be).sub(tt.mul(tt)),io=bs.mul(bs).sub(Uc),Nr=me(0,io),Fi=Tr(ue(io,0)),Eo=Hn(bs.negate().sub(Fi),bs.negate().add(Fi)),ro=ue(Eo.x,0).mul(Nr),Xs=ue(Eo.y.sub(ro),0).mul(Nr).div(X(XE)),Si=Ae(be,O),pa=Ae(be,be).sub(z.mul(z)),oo=Si.mul(Si).sub(pa),dl=me(0,oo),Ui=Tr(ue(oo,0)),Kn=Si.negate().sub(Ui),Ss=X(1).sub(me(0,Kn).mul(dl)),wi=X(0).toVar(),Rr=X(0).toVar(),Co=X(0).toVar();ll(XE,({i:Er})=>{const Cr=ro.add(Xs.mul(X(Er).add(.5))),lo=$n.add(O.mul(Cr)),Ti=Mo(lo.sub(B)),wn=Ti.sub(z),Pi=me(0,wn),js=ue(wn,0),rr=ue(tt.sub(Ti),0),Is=bn(0,dt,rr),zc=On(js.negate().div(g)),pl=On(js.negate().div(y)).mul(x);wi.addAssign(zc.add(pl).mul(Xs).mul(Pi).mul(Is)),Rr.addAssign(On(js.negate().div(S)).mul(Xs).mul(Pi).mul(Is)),Co.addAssign(ue(X(1).sub(ii(js.sub(T)).div(M)),0).mul(Xs).mul(Pi).mul(Is))});const Pc=u.mul(Mt).add(f.mul(Vt)).add(p.mul(zt)),fl=u.mul(wi).add(f.mul(Rr)).add(p.mul(Co)),ao=On(Pc.add(fl).negate()).mul(Ss),ma=u.mul(jn.mul(mt)).add(d.mul(Yn.mul(Tt)));kt.addAssign(ma.mul(ao).mul(Z))});const Qt=u.mul(Mt).add(f.mul(Vt)).add(p.mul(zt)),ie=On(Qt.negate()),Yt=Dt(1,1,1).sub(ie).mul(u.mul(.018).add(d.mul(.0035))).mul(v.mul(.38)),Ne=kt.mul(v).add(Yt).mul(Q),ce=Ne.div(Ne.mul(.22).add(Dt(1,1,1))),We=Ae(ie,Dt(.2126,.7152,.0722)).clamp(0,1),Sn=S_.select(i,a),vn=ei(X(1).sub(We),1.15).mul(Q).mul(s).mul(Sn).clamp(0,1);return gd(ce,vn)}),R=new Ac;return R.outputNode=A(),R.transparent=!0,R.premultipliedAlpha=!1,R.depthWrite=!1,R.depthTest=!0,R.side=En,R.blending=fi,R}function mj({ringTexture:r,saturnTexture:t}){const e=new vt;e.name="scene06-saturn-system";const n=new $s({metalness:0,roughness:.98}),s=Ap(t),i=bn(.9,.975,ii(ap.y));n.colorNode=te(s.rgb,Xe(13221545),i);const a=new C(new ke(pw,168,112),n);a.name="scene06-saturn",a.receiveShadow=!0,e.add(a);const c=new gt({color:16777215,map:r,metalness:.08,roughness:.88,transparent:!0,depthWrite:!1,side:En});c.alphaTest=.01;const u=new ox(qE,jy,420,1);uj(u,qE,jy);const d=new C(u,c);d.name="scene06-saturn-rings",d.rotation.x=Math.PI/2,d.renderOrder=20,e.add(d);const f=fj({atmosphereDensity:.72,atmosphereHeightKm:nL,kind:"gasGiant"},Ud),p=Me(1),g=Me(1),y=Me(0),x=Me(new G(0,0,0)),S=pj(Me(rL.clone()),x,Me(pw),Me(WE),p,g,y,f),T=new C(new ke(WE,128,88),S);return T.name="scene06-saturn-atmosphere",T.renderOrder=10,e.add(T),e.rotation.x=xt.degToRad(26.7),e.rotation.z=xt.degToRad(12),{atmosphere:T,group:e,rings:d,saturn:a,atmosphereCenterWorld:x}}function _g(r,t,e){const n=new $s;return n.colorNode=Xe(r),n.roughnessNode=X(t),n.metalnessNode=X(e),n}function gj(){const r=new vt;r.name="scene06-docked-endurance";const t=new vt;t.name="scene06-endurance";const e=_g(14540253,.4,.6),n=_g(3355443,.5,.7),s=_g(1118481,.15,.9),i=_g(328965,.05,.8),a=32,c=12;for(let O=0;O<c;O+=1){const B=O/c*Math.PI*2,z=new vt,tt=new Y(8,7,10),j=new C(tt,e);j.castShadow=!0,j.receiveShadow=!0,z.add(j);const dt=new C(new Y(7.5,6.5,1),s);dt.position.set(0,0,-4.6),dt.castShadow=!0,dt.receiveShadow=!0,z.add(dt);const wt=new C(new Y(8.2,2,4),n);wt.position.set(0,0,1),z.add(wt),z.position.set(Math.cos(B)*a,Math.sin(B)*a,0),z.rotation.z=B+Math.PI/2,z.lookAt(0,0,0),t.add(z);const ft=B+Math.PI/c,U=new vt;U.position.set(Math.cos(ft)*a,Math.sin(ft)*a,0),U.rotation.z=ft;const K=new C(new $t(2,2,9,32),e);K.castShadow=!0,K.receiveShadow=!0,U.add(K);const nt=new C(new $t(2.8,2.8,2.5,32),e);U.add(nt);const ht=new $t(1.2,1.2,3.5,32),_t=new C(ht,i);_t.rotation.z=Math.PI/2,U.add(_t);const P=new C(new $t(1.5,1.5,3.2,32),n);P.rotation.z=Math.PI/2,U.add(P),t.add(U)}const u=a-5,d=new vt;d.position.set(0,u/2+2,0);const f=new C(new $t(2.5,2.5,u,32),e);f.castShadow=!0,f.receiveShadow=!0,d.add(f);for(let O=-1;O<=1;O+=1){const B=new C(new $t(3,3,2,32),n);B.position.y=O*(u/3),d.add(B)}t.add(d);const p=new C(new $t(4,4,3,32),e);p.rotation.x=Math.PI/2,p.castShadow=!0,p.receiveShadow=!0,t.add(p);const g=new C(new la(3,.5,16,64),n);g.position.z=1.5,t.add(g);const y=new vt;y.name="scene06-ranger";const x=new pi(4.5,10,4);x.rotateY(Math.PI/4),x.rotateX(Math.PI/2),x.scale(1.1,.2,1);const S=new C(x,e);S.castShadow=!0,S.receiveShadow=!0,y.add(S);const T=x.clone();T.scale(.98,.5,.98),T.translate(0,-.15,0);const M=new C(T,n);M.castShadow=!0,y.add(M);const N=new C(new Y(2.2,.8,3.5),e);N.position.set(0,.4,0),N.rotation.x=Math.PI/16,N.castShadow=!0,y.add(N);const v=new C(new Y(1.8,.6,1.5),i);v.position.set(0,.7,1.2),v.rotation.x=Math.PI/6,y.add(v);const A=new Y(3.5,.2,4),R=new C(A,e);R.position.set(-2.8,0,-2.5),R.rotation.y=Math.PI/8,R.castShadow=!0,y.add(R);const F=new C(A,e);F.position.set(2.8,0,-2.5),F.rotation.y=-Math.PI/8,F.castShadow=!0,y.add(F);const D=new C(new Y(3,1,1.5),n);return D.position.set(0,-.1,-4.8),y.add(D),y.position.set(0,0,7.5),y.rotation.set(0,0,0),t.add(y),t.scale.setScalar(tL),r.add(t),r.scale.setScalar(mw),r.rotation.set(.62,-.12,.94),{docked:r}}const yj={id:"endurance-saturn-approach",title:"Endurance Near Saturn",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=0,u=0,d=0,f=null,p=null;const g={orbitAngle:-.5,shipSpinRate:.15,flybyProgress:.14,flybyDuration:22,cameraBasePosition:new G,cameraForward:new G,cameraRight:new G,cameraUp:new G,shipAnchorPosition:new G};function y(S){!s||!n||(Qh.copy(s.position).normalize(),jE.crossVectors(KE,Qh).normalize(),Tg.copy(Qh).multiplyScalar(Jh(1600)),Tg.addScaledVector(jE,Jh(-1250)),Tg.addScaledVector(KE,Jh(650)),S.position.copy(s.position).add(Tg),YE.copy(s.position).lerp(rj,.08),S.lookAt(YE))}function x(){!s||!n||(Qh.set(Math.cos(g.orbitAngle)*(jy*1.08),pw*.11,Math.sin(g.orbitAngle)*(jy*1.08)),n.group.localToWorld(Qh),g.shipAnchorPosition.copy(Qh))}return{async init({camera:S,renderer:T,root:M,scene:N}){r=M,t=new vt,t.name="scene06-group",M.add(t),c=S.near,u=S.far,d=S.fov,S.near=nj,S.far=sL,S.fov=ej,S.updateProjectionMatrix(),N.background&&N.background.isColor?f=N.background.clone():f=null,N.background=QX.clone(),a=new Ro(1909808,.18),i=new Fs(16773590,2.6),i.position.copy(rL).multiplyScalar(2e5),t.add(a,i,i.target);const A=await new Vw().loadAsync("/textures/saturn_texture.jpg");A.colorSpace=fn,A.wrapS=Bn,A.wrapT=ji,A.center.set(.5,.5),A.rotation=0,A.generateMipmaps=!0,T?.capabilities&&typeof T.capabilities.getMaxAnisotropy=="function"&&(A.anisotropy=Math.min(8,T.capabilities.getMaxAnisotropy())),A.needsUpdate=!0;const R=cj();T?.capabilities&&typeof T.capabilities.getMaxAnisotropy=="function"&&(R.anisotropy=Math.min(8,T.capabilities.getMaxAnisotropy())),R.needsUpdate=!0,n=mj({ringTexture:R,saturnTexture:A}),t.add(n.group),n.group.updateMatrixWorld(!0),e=hj(),t.add(e),s=gj().docked,t.add(s),x(),s.position.copy(g.shipAnchorPosition),y(S);const F=S.position.clone();g.cameraBasePosition.set(0,0,0),g.cameraForward.set(0,0,-1).applyQuaternion(S.quaternion).normalize(),g.cameraRight.set(1,0,0).applyQuaternion(S.quaternion).normalize(),g.cameraUp.set(0,1,0).applyQuaternion(S.quaternion).normalize(),S.position.set(0,0,0),n.group.position.copy(F).negate(),n.group.updateMatrixWorld(!0),n.atmosphereCenterWorld.value.copy(n.group.position),e.position.set(0,0,0),p=D=>{ij.has(D.code)&&(D.preventDefault(),D.stopPropagation(),typeof D.stopImmediatePropagation=="function"&&D.stopImmediatePropagation())},window.addEventListener("keydown",p,!0)},update({delta:S,camera:T}){if(!t||!n||!e||!s)return;g.flybyProgress=(g.flybyProgress+S/g.flybyDuration)%1,T.position.copy(g.cameraBasePosition);const N=(g.flybyProgress*2-1)*Jh(1700*mw),v=Jh(-40*mw),A=Jh(iL);s.position.copy(g.cameraBasePosition),s.position.addScaledVector(g.cameraForward,A),s.position.addScaledVector(g.cameraRight,N),s.position.addScaledVector(g.cameraUp,v),s.rotation.z+=S*g.shipSpinRate*5,s.rotation.y+=S*g.shipSpinRate*.25,e.position.copy(T.position)},resize(){},dispose({camera:S,scene:T}){p&&(window.removeEventListener("keydown",p,!0),p=null),S.near=c,S.far=u,S.fov=d,S.updateProjectionMatrix(),T.background=f?f.clone():null,t&&(r&&t.parent!==r&&r.add(t),Li(t),t=null,e=null,n=null,s=null,i=null,a=null,r=null)}}}},xj=.07,bj=new G(0,0,0),Sj=new Set(["KeyW","KeyA","KeyS","KeyD","Space","ShiftLeft","ShiftRight"]);function wj(){const r=Jn(([f])=>{const p=Dt(f).toVar(),g=Bi(p.mul(.1031)).toVar();return g.addAssign(Ae(g,g.zyx.add(31.32))),Bi(g.x.add(g.y).mul(g.z))}),t=Jn(([f])=>{const p=Dt(f).toVar(),g=M$(p).toVar(),y=Bi(p).toVar(),x=y.mul(y).mul(X(3).sub(y.mul(2))).toVar();return te(te(te(r(g.add(Dt(0,0,0))),r(g.add(Dt(1,0,0))),x.x),te(r(g.add(Dt(0,1,0))),r(g.add(Dt(1,1,0))),x.x),x.y),te(te(r(g.add(Dt(0,0,1))),r(g.add(Dt(1,0,1))),x.x),te(r(g.add(Dt(0,1,1))),r(g.add(Dt(1,1,1))),x.x),x.y),x.z)}),e=Jn(([f])=>{const p=Dt(f).toVar(),g=X(0).toVar(),y=X(.5).toVar(),x=Dt(p).toVar();return ll(5,()=>{g.addAssign(y.mul(t(x))),x.mulAssign(2),y.mulAssign(.5)}),g}),n=Jn(([f])=>{const p=Dt(f).toVar(),g=Lu.mul(.055).toVar(),y=Dt(g,g.mul(.36),g.mul(-.24)).toVar(),x=Dt(g.mul(-.17),g.mul(.43),g.mul(.31)).toVar(),S=e(p.mul(2.4).add(Dt(13.1,-4.2,7.7)).add(y)).sub(.5).mul(.34).toVar(),T=Fn(Dt(p.x.add(S),p.y.add(S.mul(.28)),p.z.sub(S.mul(.52)))).toVar(),M=e(T.mul(2.9)).toVar(),N=e(T.mul(6.2).add(Dt(7,1,11)).add(x)).toVar(),v=X(1).sub(bn(.06,.78,ii(T.y.add(N.sub(.5).mul(.2))))),A=bn(.28,.75,M).mul(v),R=bn(.54,.88,N).mul(v).mul(.42);return te(Dt(.03,.06,.12),Dt(.16,.27,.46),N).toVar().mul(A.add(R))}),s=Jn(([f])=>{const p=Dt(f).toVar(),g=Lu.mul(.048).toVar(),y=Dt(g.mul(-.22),g.mul(.49),g.mul(.27)).toVar(),x=Dt(g.mul(.32),g.mul(-.18),g.mul(.44)).toVar(),S=Dt(p.x,p.y.mul(.8).add(p.z.mul(.6)),p.z.mul(.8).sub(p.y.mul(.6))).toVar(),T=e(S.mul(2).add(Dt(2,5,8)).add(y)).sub(.5).mul(.3).toVar(),M=Dt(S.x.add(T.mul(.4)),S.y,S.z.sub(T.mul(.45))).toVar(),N=e(M.mul(2.8).add(Dt(1,2,3)).add(x)).toVar(),v=e(M.mul(6).add(Dt(9,3,1)).add(x.mul(1.6))).toVar(),A=X(1).sub(bn(0,.2,ii(M.y.add(v.sub(.5).mul(.12))))),R=X(1).sub(bn(0,.9,ii(M.y))),F=te(Dt(.09,.14,.28),Dt(.32,.5,.78),N).toVar();return F.mulAssign(A.mul(1.45).add(R.mul(.22))),F}),i=Jn(([f,p,g])=>{const y=Hn(f).toVar(),x=X(p).toVar(),S=X(g).toVar(),T=y.x.toVar(),M=y.y.toVar(),N=T.mul(T).add(S.mul(S)).toVar();return Hn(N.mul(M),x.mul(x).mul(T).div(N))}),a=Jn(([f,p])=>{const g=Dt(f).toVar(),y=Fn(p).toVar(),x=X(1.2),S=X(40),T=Mo(g).toVar(),M=Tr(ue(T.mul(T).sub(x.mul(x)),.001)).toVar(),N=Ae(Fn(g),y).toVar(),v=xg(g,y).toVar(),A=Mo(v).toVar(),R=Dt(0).toVar();ad(A.lessThan(1e-4),()=>{R.assign(Fn(xg(g,Dt(0,1,0)))),ad(Mo(R).lessThan(1e-4),()=>{R.assign(Fn(xg(g,Dt(1,0,0))))})}).Else(()=>{R.assign(Fn(v))});const F=Fn(g).toVar(),D=xg(R,F).toVar(),O=X(0).toVar(),B=Hn(M,N).toVar(),z=X(.0042).add(r(y.mul(331.7)).sub(.5).mul(9e-4)).toVar(),tt=X(0).toVar();ll(920,()=>{const ft=i(B,A,x).toVar(),U=i(B.add(ft.mul(z).mul(.5)),A,x).toVar(),K=i(B.add(U.mul(z).mul(.5)),A,x).toVar(),nt=i(B.add(K.mul(z)),A,x).toVar();B.addAssign(ft.add(U.mul(2)).add(K.mul(2)).add(nt).mul(z.div(6))),O.addAssign(z.mul(A)),ad(ii(B.x).greaterThan(S),()=>{tt.assign(1),S$()})});const j=Fn(F.mul(Xa(O)).add(D.mul(br(O)))).toVar(),dt=Dt(0).toVar();ad(tt.equal(0),()=>{dt.assign(Dt(1,.8,.4).mul(2))}).ElseIf(B.x.lessThan(0),()=>{dt.assign(s(j))}).Else(()=>{dt.assign(n(j))});const wt=r(j.mul(700)).sub(.5).mul(.01);return dt.addAssign(Dt(wt)),dt}),c=new ke(500,320,320),u=new Ac({side:us});u.colorNode=a(Ar,$u.sub(Ar).normalize()),u.depthWrite=!1;const d=new C(c,u);return d.name="scene07-wormhole-sky",d.renderOrder=-100,d}function Tj(){const t=new Float32Array(4200),e=new Float32Array(1400*3);for(let a=0;a<1400;a+=1){const c=Math.random()*2-1,u=Math.random()*Math.PI*2,d=xt.lerp(230,470,Math.pow(Math.random(),.6)),f=Math.sqrt(1-c*c),p=d*f*Math.cos(u),g=d*c,y=d*f*Math.sin(u);t[a*3]=p,t[a*3+1]=g,t[a*3+2]=y;const x=xt.lerp(.65,1,Math.pow(Math.random(),1.5)),S=xt.lerp(.96,1,Math.random()),T=xt.lerp(.88,.99,Math.random());e[a*3]=x*S,e[a*3+1]=x*.97,e[a*3+2]=x*T}const n=new Ye;n.setAttribute("position",new hs(t,3)),n.setAttribute("color",new hs(e,3));const s=new tr({size:1.05,sizeAttenuation:!0,vertexColors:!0,transparent:!0,opacity:.94,depthWrite:!1}),i=new Qr(n,s);return i.name="scene07-starfield",i.renderOrder=-95,i}function _j(){const r=new vt;r.name="scene07-endurance";function t(B,z,tt){const j=new $s;return j.colorNode=Xe(B),j.roughnessNode=X(z),j.metalnessNode=X(tt),j}const e=t(14540253,.4,.6),n=t(3355443,.5,.7),s=t(1118481,.15,.9),i=t(328965,.05,.8),a=[e,n,s,i],c=32,u=12;for(let B=0;B<u;B+=1){const z=B/u*Math.PI*2,tt=new vt,j=new Y(8,7,10),dt=new C(j,e);dt.castShadow=!0,dt.receiveShadow=!0,tt.add(dt);const wt=new C(new Y(7.5,6.5,1),s);wt.position.set(0,0,-4.6),wt.castShadow=!0,wt.receiveShadow=!0,tt.add(wt);const ft=new C(new Y(8.2,2,4),n);ft.position.set(0,0,1),tt.add(ft),tt.position.set(Math.cos(z)*c,Math.sin(z)*c,0),tt.rotation.z=z+Math.PI/2,tt.lookAt(0,0,0),r.add(tt);const U=z+Math.PI/u,K=new vt;K.position.set(Math.cos(U)*c,Math.sin(U)*c,0),K.rotation.z=U;const nt=new C(new $t(2,2,9,32),e);nt.castShadow=!0,nt.receiveShadow=!0,K.add(nt);const ht=new C(new $t(2.8,2.8,2.5,32),e);K.add(ht);const _t=new $t(1.2,1.2,3.5,32),P=new C(_t,i);P.rotation.z=Math.PI/2,K.add(P);const q=new C(new $t(1.5,1.5,3.2,32),n);q.rotation.z=Math.PI/2,K.add(q),r.add(K)}const d=c-5,f=new vt;f.position.set(0,d/2+2,0);const p=new C(new $t(2.5,2.5,d,32),e);p.castShadow=!0,p.receiveShadow=!0,f.add(p);for(let B=-1;B<=1;B+=1){const z=new C(new $t(3,3,2,32),n);z.position.y=B*(d/3),f.add(z)}r.add(f);const g=new C(new $t(4,4,3,32),e);g.rotation.x=Math.PI/2,g.castShadow=!0,g.receiveShadow=!0,r.add(g);const y=new C(new la(3,.5,16,64),n);y.position.z=1.5,r.add(y);const x=new vt,S=new pi(4.5,10,4);S.rotateY(Math.PI/4),S.rotateX(Math.PI/2),S.scale(1.1,.2,1);const T=new C(S,e);T.castShadow=!0,T.receiveShadow=!0,x.add(T);const M=S.clone();M.scale(.98,.5,.98),M.translate(0,-.15,0);const N=new C(M,n);N.castShadow=!0,x.add(N);const v=new C(new Y(2.2,.8,3.5),e);v.position.set(0,.4,0),v.rotation.x=Math.PI/16,v.castShadow=!0,x.add(v);const A=new C(new Y(1.8,.6,1.5),i);A.position.set(0,.7,1.2),A.rotation.x=Math.PI/6,x.add(A);const R=new Y(3.5,.2,4),F=new C(R,e);F.position.set(-2.8,0,-2.5),F.rotation.y=Math.PI/8,F.castShadow=!0,x.add(F);const D=new C(R,e);D.position.set(2.8,0,-2.5),D.rotation.y=-Math.PI/8,D.castShadow=!0,x.add(D);const O=new C(new Y(3,1,1.5),n);return O.position.set(0,-.1,-4.8),x.add(O),x.position.set(0,0,7.5),x.rotation.set(0,0,0),r.add(x),{group:r,materials:a}}const Mj={id:"wormhole-crossing",title:"Wormhole Crossing Sequence",create(){let r=null,t=null,e=null,n=0,s=0,i=0,a=null,c=null,u=null;const d={elapsed:0,spinAngle:0},f=new G(-9.4,1.25,11.8),g=new G(0,-25,-170).clone().sub(f);function y(x){const S=Math.max(x,0);t.position.copy(f).addScaledVector(g,S);const T=Math.exp(-S*2.4);t.position.x+=Math.sin(S*Math.PI*1.2)*.2*T,t.position.y+=Math.sin(S*Math.PI*.9)*.1*T}return{init({root:x,camera:S,renderer:T,scene:M}){r=new vt,r.name="scene07-wormhole-crossing",r.add(wj()),r.add(Tj());const N=new Ro(16777215,.42);N.name="scene07-ambient",r.add(N);const v=new Fs(16777215,2.3);v.name="scene07-sun",v.position.set(7.5,5.2,8.5),r.add(v),e=_j(),t=new vt,t.name="scene07-ship-rig",t.scale.setScalar(xj),t.add(e.group),r.add(t),x.add(r),M&&(a=M.background,M.background=new qt(0)),S&&(n=S.near,s=S.far,i=S.fov,S.near=.05,S.far=1200,S.fov=55,S.updateProjectionMatrix(),S.position.set(0,1.8,14),S.lookAt(bj),c=S.position.clone()),u=A=>{Sj.has(A.code)&&document.pointerLockElement===T?.domElement&&(A.preventDefault(),A.stopPropagation(),typeof A.stopImmediatePropagation=="function"&&A.stopImmediatePropagation())},window.addEventListener("keydown",u,!0),window.addEventListener("keyup",u,!0),d.elapsed=0,d.spinAngle=0,y(0),e.group.rotation.set(.46,-.12,.9)},update({delta:x,camera:S}){if(!t||!e||!S||!c)return;S.position.copy(c);const T=Math.min(Math.max(x,0),.05);d.elapsed+=T;const N=d.elapsed/13;y(N),d.spinAngle+=T*.78,e.group.rotation.set(.46,-.12,.9+d.spinAngle)},resize(){},dispose({camera:x,scene:S}){u&&(window.removeEventListener("keydown",u,!0),window.removeEventListener("keyup",u,!0),u=null),x&&(x.near=n||x.near,x.far=s||x.far,x.fov=i||x.fov,x.updateProjectionMatrix()),S&&(S.background=a??S.background),r&&(Li(r),r=null),t=null,e=null,c=null}}}},vj=200,Aj=100,gw=[[.94,.32,.38,28,.5],[-.42,.91,.24,18,.46],[.78,-.52,.16,12,.42],[-.35,-.78,.1,10,.35],[.55,.62,.06,9.5,.28]],Nj=.38;function Rj(){const r=Me(0),t=Me(new G(-.28,.62,-.73).normalize()),e=Jn(([g])=>{const y=g.y,x=Dt(.52,.68,.88),S=Dt(.76,.87,.99),T=Dt(.5,.72,.95),M=Dt(.19,.44,.83),N=Dt(.04,.13,.52),v=bn(X(-.1),X(0),y),A=bn(X(0),X(.28),y),R=bn(X(.28),X(.85),y),F=te(te(x,S,v),te(T,te(M,N,R),A),A),D=$o(Ae(g,t),X(0),X(1)),O=ei(D,X(5e3)).mul(50),B=ei(D,X(20)).mul(2.8),z=ei(D,X(4)).mul(.5);return F.add(Dt(1,.95,.75).mul(O)).add(Dt(1,.72,.32).mul(B)).add(Dt(1,.8,.5).mul(z))}),n=new Ac({side:us});n.colorNode=e(Fn(Xi.xyz));const s=new C(new ke(1500,32,16),n);s.name="miller-ocean-sky-dome";const i=Jn(([g,y])=>{let x=X(0),S=X(0),T=X(0);for(const[M,N,v,A,R]of gw){const F=2*Math.PI/A,D=Math.sqrt(9.81*F),O=R*v,B=X(F).mul(X(M).mul(g).add(X(N).mul(y))).sub(X(D).mul(r));x=x.add(X(M*O).mul(Xa(B))),S=S.add(X(v).mul(br(B))),T=T.add(X(N*O).mul(Xa(B)))}return Dt(g.add(x),S,y.add(T))}),a=Jn(([g,y])=>{let x=X(0),S=X(0),T=X(0);for(const[M,N,v,A,R]of gw){const F=2*Math.PI/A,D=Math.sqrt(9.81*F),O=F*v,B=X(F).mul(X(M).mul(g).add(X(N).mul(y))).sub(X(D).mul(r));x=x.add(X(M*O).mul(br(B))),S=S.add(X(R*O).mul(Xa(B))),T=T.add(X(N*O).mul(br(B)))}return Fn(Dt(x.negate(),X(1).sub(S),T.negate()))}),c=B$(a(Xi.x,Xi.z)),u=Jn(()=>{const g=$u.xyz,y=Fn(c),x=r,S=X(Math.PI*2),T=g.xz.mul(.44).add(Hn(x.mul(.023),x.mul(.016))),M=g.xz.mul(.8).add(Hn(x.mul(-.016),x.mul(.03))),N=g.xz.mul(1.55).add(Hn(x.mul(.011),x.mul(-.021))),v=g.xz.mul(2.8).add(Hn(x.mul(-.008),x.mul(.014))),A=Dt(br(T.x.mul(S)).mul(.06),X(1),Xa(T.y.mul(S)).mul(.06)),R=Dt(br(M.x.mul(S)).mul(.04),X(1),Xa(M.y.mul(S)).mul(.04)),F=Dt(br(N.x.mul(S)).mul(.022),X(1),Xa(N.y.mul(S)).mul(.022)),D=Dt(br(v.x.mul(S)).mul(.01),X(1),Xa(v.y.mul(S)).mul(.01)),O=Fn(y.add(A.mul(X(.32))).add(R.mul(X(.22))).add(F.mul(X(.13))).add(D.mul(X(.07)))),B=Fn(Ar.sub(g)),z=$o(Ae(O,B),X(.001),X(1)),tt=X(.02),j=tt.add(X(1).sub(tt).mul(ei(X(1).sub(z),X(5)))),dt=E$(B.negate(),O),wt=e(dt),ft=$o(Ae(dt,t),X(0),X(1)),U=ei(ft,X(2500)).mul(22),K=ei(ft,X(14)).mul(1.5),nt=Dt(1,.95,.72).mul(U).add(Dt(1,.7,.36).mul(K)),ht=wt.add(nt),_t=Dt(.005,.042,.115),P=Dt(.022,.15,.268),q=te(_t,P,X(1).sub(j).mul(.3)),L=ei($o(Ae(B,t.negate()),X(0),X(1)),X(4)),I=Dt(0,.27,.19).mul(L.mul(.42)).mul(X(1).sub(j)),H=ei($o(X(1).sub(O.y).mul(5),X(0),X(1)),X(2)),W=Dt(.9,.95,1).mul(H.mul(.28)),at=Fn(B.add(t)),rt=$o(Ae(O,at),X(0),X(1)),et=ei(rt,X(1200)).mul(22),ct=Dt(1,.96,.8).mul(et),st=te(q.add(I),ht,j).add(ct).add(W),Z=Mo(g.sub(Ar)),Q=$o(X(1).sub(On(Z.negate().mul(.0026))),X(0),X(1)),$=Dt(.76,.87,.99);return te(st,$,Q)}),d=new Rn(1200,1200,256,256);d.rotateX(-Math.PI/2);const f=new Ac;f.positionNode=i(Xi.x,Xi.z),f.colorNode=u();const p=new C(d,f);return p.name="miller-ocean-surface",{oceanMesh:p,skyMesh:s,timeU:r}}function Ej(r,t,e){let n=0;for(const[s,i,a,c]of gw){const u=2*Math.PI/c,d=Math.sqrt(9.81*u),f=u*(s*r+i*t)-d*e;n+=a*Math.sin(f)}return n}function ZE(){const r=new vt;r.name="miller-astronaut";const t=new Ry({color:15921902,roughness:.78,metalness:.08,sheen:.22,sheenColor:13489631}),e=new gt({color:7305608,roughness:.58,metalness:.26}),n=new Ry({color:1448740,roughness:.1,metalness:.9,clearcoat:1,clearcoatRoughness:.12}),s=new C(new Y(1.05,1.28,.62),t);s.position.y=2.42,r.add(s);const i=new C(new Y(.42,.26,.12),e);i.position.set(0,2.23,.37),r.add(i);const a=new vt;a.position.set(0,3.52,0),a.rotation.y=Math.PI,r.add(a);const c=new C(new Y(.92,.86,.8),t);a.add(c);const u=new C(new Y(.56,.44,.1),n);u.position.set(0,.03,.45),a.add(u);const d=new C(new Y(.56,.82,.24),e);d.position.set(0,2.41,-.42),r.add(d);const f=new vt,p=new C(new Y(.26,.56,.26),t);p.position.y=-.16,f.add(p);const g=new C(new Y(.24,.5,.24),t);g.position.y=-.72,f.add(g),f.position.set(-.66,2.58,.02),r.add(f);const y=f.clone(!0);y.position.x=.66,r.add(y);const x=new vt,S=new C(new Y(.34,.72,.34),t);S.position.y=-.2,x.add(S);const T=new C(new Y(.31,.68,.31),t);T.position.y=-.9,x.add(T);const M=new C(new Y(.42,.22,.65),e);M.position.set(0,-1.34,-.12),x.add(M),x.position.set(-.24,1.74,0),r.add(x);const N=x.clone(!0);N.position.x=.24,r.add(N);const v=new C(new Y(.22,.22,.22),e);v.position.set(-.66,2.92,0),r.add(v);const A=v.clone();return A.position.x=.66,r.add(A),r.userData.pose={leftArm:f,rightArm:y,leftLeg:x,rightLeg:N,neutralY:r.position.y},r}function Cj(){const r=document.createElement("canvas");r.width=1024,r.height=4096;const t=r.getContext("2d");if(!t){const i=new sx(new Uint8Array([0,0,0,255]),1,1,Yi);return i.colorSpace=fn,i.needsUpdate=!0,i}t.clearRect(0,0,r.width,r.height);const e=r.width,n=r.height;t.fillStyle="#050505",t.fillRect(e*.1,n*.28,e*.8,n*.08),t.fillRect(e*.1,n*.72,e*.38,n*.12),t.fillRect(e*.52,n*.72,e*.38,n*.12),t.fillStyle="#a55a30",t.textAlign="center",t.textBaseline="middle",t.font="bold 40px sans-serif",t.fillText("MARINE CORPS",e*.5,n*.43),t.font="bold 240px sans-serif",t.scale(1,1.2),t.fillText("CASE",e*.5,n*.48/1.2),t.scale(1,1/1.2),t.font="bold 40px sans-serif",t.fillText("U.S.M.C.",e*.5,n*.53);const s=new bi(r);return s.colorSpace=fn,s.anisotropy=16,s.needsUpdate=!0,s}function b2(r,t={}){const e=new $s,n=Xe(.55,.55,.55),s=Xe(.1,.1,.1),i=X(.85),a=C$(),c=Bi(br(a.x.mul(800).add(a.y.mul(20))).mul(43758.5453)),u=te(X(.3),X(.45),c),d=Hn(3,30),f=a.mul(d),p=X(.08),g=me(p,Bi(f.x)).mul(me(p,X(1).sub(Bi(f.x)))),y=me(p,Bi(f.y)).mul(me(p,X(1).sub(Bi(f.y)))),x=g.mul(y),S=X(1).sub(x),T=ue(me(X(.88),a.y),me(a.y,X(.12))),M=me(X(.5),ap.x.abs().add(ap.z.abs())),N=S.mul(T).mul(M);let v=te(n,s,N.mul(X(.8))),A=te(u,X(.9),N);if(t.hasDecals){const R=Ap(r),F=me(X(.9),ap.z),D=me(X(.1),R.a).mul(F),O=me(R.r,X(.1)).mul(D);v=te(v,R,D),A=te(A,X(.05),O),e.metalnessNode=te(i,X(0),O)}else e.metalnessNode=i;if(t.hasCircle){const R=me(X(.9),ap.x),F=Mo(a.sub(Hn(.5,.65))),D=me(F,X(.15)),O=me(F,X(.13)),B=me(F,X(.05)),z=ue(D.sub(O),B).mul(R);v=te(v,s,z),A=te(A,X(.8),z)}return e.colorNode=v,e.roughnessNode=A,e}function Bj(r){const i=new Y(.65,5,.65),a=b2(r),c=b2(r,{hasDecals:!0}),u=b2(r,{hasCircle:!0}),d=new vt;d.name="miller-tars";const f=.25,p=-.25,g=new C(i,a);g.position.x=-.65*1.5-.02*1.5,g.rotation.x=f,d.add(g);const y=new C(i,c);y.position.x=-.65*.5-.02*.5,y.rotation.x=p,d.add(y);const x=new C(i,a);x.position.x=.65*.5+.02*.5,x.rotation.x=p,d.add(x);const S=new C(i,u);return S.position.x=.65*1.5+.02*1.5,S.rotation.x=f,d.add(S),d.position.y=5/2,d}function yw(r,t){const e=r.mul(t);return Bi(br(Ae(e,Dt(12.9898,78.233,37.719))).mul(43758.5453))}function Dj(){const r=new $s,t=Xi,e=.8,n=.5,s=me(.96,Bi(t.x.mul(e))),i=me(.96,Bi(t.z.mul(n))),a=ue(s,i),c=yw(t,X(15)).mul(.1),u=Xe(15527664),d=Xe(13686234),f=Xe(6316128);let p=te(u,d,c);p=te(p,f,a);const g=me(X(8.2),t.z),y=me(t.z,X(-4)).mul(me(X(.8),t.y)),x=ue(g,y.mul(yw(t,X(5)).mul(.5)));return p=te(p,Xe(2236962),x),r.colorNode=p,r.roughnessNode=X(.4).add(c).add(a.mul(.4)),r.metalnessNode=X(.15),r}function Lj(){const r=new $s,t=yw(Xi,X(25)).mul(.08);return r.colorNode=Xe(1381912).add(t),r.roughnessNode=X(.85).sub(t),r.metalnessNode=X(.3),r}function Oj(){const r=new $s;return r.colorNode=Xe(66051),r.roughnessNode=X(.02),r.metalnessNode=X(.95),r}function Fj(){const e=new Y(1,1,1,16,4,32),n=e.attributes.position;for(let s=0;s<n.count;s+=1){const i=n.getX(s)*2,a=n.getY(s)*2,c=n.getZ(s)*2,u=c*(18/2);let d=0;u<-3?d=8.5/2:u<6?d=xt.lerp(8.5/2,1.2,(u+3)/9):d=xt.lerp(1.2,.3,(u-6)/3),d*=1-Math.pow(Math.abs(c),4)*.05;const f=i*d;let p=0;if(a>0){u<-4?p=1:u<1?p=xt.lerp(1,2.2,(u+4)/5):u<7?p=xt.lerp(2.2,.4,(u-1)/6):p=xt.lerp(.4,.1,(u-7)/2);const g=Math.pow(Math.abs(i),1.5),y=xt.lerp(.8,.1,(u+9)/18);p=xt.lerp(p,y,g)}else p=-.1+(u+9)/18*.2;n.setXYZ(s,f,p,u)}return e.computeVertexNormals(),e}function Uj(){const r=new vt;r.name="miller-ranger";const t=new vt,e=Dj(),n=Lj(),s=Oj();t.add(new C(Fj(),e));const i=R=>{const F=new vt,D=R?1:-1,O=new C(new Y(1.5,.8,6),n);O.position.set(4*D,.3,-5),O.rotation.y=.05*D,F.add(O);const B=new C(new Y(1,.5,6.5),n);B.position.set(3*D,.2,.5),B.rotation.y=-.28*D,F.add(B);const z=new C(new Y(.5,.3,4),n);return z.position.set(1.4*D,.1,5),z.rotation.y=-.45*D,F.add(z),F};t.add(i(!0)),t.add(i(!1));const a=new C(new Y(8.2,1.4,1.2),n);a.position.set(0,.4,-8.6),t.add(a);const c=Math.atan2(1.8,6),u=(R,F,D,O,B,z=0)=>{const tt=B/9;let j=xt.lerp(4.25,1.2,(B+3)/9);j*=1-Math.pow(Math.abs(tt),4)*.05;const dt=Math.min(Math.abs(O)/j,1),wt=xt.lerp(2.2,.4,(B-1)/6),ft=Math.pow(dt,1.5),U=xt.lerp(.8,.1,(B+9)/18),K=xt.lerp(wt,U,ft),nt=Math.min((Math.abs(O)+.1)/j,1),ht=xt.lerp(wt,U,Math.pow(nt,1.5)),_t=Math.atan2(ht-K,.1)*Math.sign(-O),P=new C(new Y(R,F,D),s);P.position.set(O,K-F/2+.02,B),P.rotation.set(c,z,_t),t.add(P)};u(.7,.1,.8,-.8,1.8,-.1),u(.7,.1,.8,0,1.8,0),u(.7,.1,.8,.8,1.8,.1),u(.9,.1,.9,-1,3,-.15),u(.9,.1,.9,0,3,0),u(.9,.1,.9,1,3,.15),u(1,.1,1,-1.2,4.2,-.2),u(1,.1,1,0,4.2,0),u(1,.1,1,1.2,4.2,.2);const d=-Math.atan2(1.2,5),f=(R,F)=>{const D=new C(new Y(.8,.1,1),s);D.position.set(R,1.95,F),D.rotation.set(d,0,R>0?-.1:.1),t.add(D)};f(-.7,.2),f(.7,.2);const p=new vt,g=new C(new $t(.06,.05,1.8,8),e);g.position.set(0,-1.5,0),p.add(g);const y=new C(new $t(.05,.05,1.8,8),n);y.rotation.x=-Math.PI/4,y.position.set(0,-.8,-.6),p.add(y);const x=new C(new Y(.3,.4,.4),n);x.position.set(0,-.6,0),p.add(x);const S=new C(new Y(.8,.15,2.2),n);S.position.set(0,-2.4,0),p.add(S),p.position.set(3.2,.2,-4.5),t.add(p);const T=p.clone();T.position.set(-3.2,.2,-4.5),t.add(T);const M=new vt,N=new C(new $t(.05,.04,1.6,8),e);N.position.set(0,-1.4,0),M.add(N);const v=new C(new $t(.04,.04,1.2,8),n);v.rotation.x=Math.PI/4,v.position.set(0,-.8,.4),M.add(v);const A=new C(new Y(.6,.15,1.5),n);return A.position.set(0,-2.2,0),M.add(A),M.position.set(0,.6,5.5),t.add(M),t.rotation.x=-.04,t.position.y=2.22,r.add(t),r}function Pj(){const r=new Rn(420,152,vj,Aj),t=r.attributes.position,e=t.count,n=new Float32Array(t.array.length);n.set(t.array);for(let d=0;d<e;d+=1){const f=t.getX(d),p=t.getY(d),g=Math.sin(f*.021)*2.8,y=Math.max(0,p-24)*.56,x=Math.sin(f*.17+p*.11)*2.35+Math.cos(f*.12-p*.05)*1.4;t.setZ(d,g+y+x)}t.needsUpdate=!0,r.computeVertexNormals();const s=new Ry({color:2438721,roughness:.14,metalness:.05,transmission:.07,thickness:1.2,clearcoat:.9,clearcoatRoughness:.26,reflectivity:.88,ior:1.33,transparent:!0,opacity:.94}),i=new C(r,s);i.position.set(0,46,232);const a=r.clone(),c=new gt({color:15003123,roughness:.46,metalness:.05,transparent:!0,opacity:.26}),u=new C(a,c);return u.position.set(0,90.5,227.5),u.scale.set(1,.18,1),{basePositions:n,wave:i,foam:u}}function QE(r,t,e,n=0){if(!r?.userData?.pose)return;const s=Math.sin(t*1.6+e)*.33,i=Math.sin(t*3.8+e*2.6)*.045;r.position.y=r.userData.pose.neutralY+i,r.rotation.y=n+Math.sin(t*.27+e)*.05,r.userData.pose.leftArm.rotation.x=-.25+s*.45,r.userData.pose.rightArm.rotation.x=.22-s*.42,r.userData.pose.leftLeg.rotation.x=.18-s*.58,r.userData.pose.rightLeg.rotation.x=-.16+s*.52}function JE(r,t,e,n=1){if(!r||!t?.geometry?.attributes?.position)return;const s=t.geometry.attributes.position,i=s.count,a=e*.62;for(let c=0;c<i;c+=1){const u=r[c*3],d=r[c*3+1],f=r[c*3+2],p=Math.sin(u*.086+a+d*.17)*2.6*n,g=Math.cos(u*.042-a*.42+d*.14)*2.9*n,y=Math.max(0,d-23)*.11*(1+Math.sin(a*.8)*.3);s.setZ(c,f+p+g+y)}s.needsUpdate=!0,t.geometry.computeVertexNormals()}const zj={id:"millers-planet-wave",title:"Miller's Planet and Wave",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,g=null,y=null,x=null,S=null;return{init({root:T,camera:M,scene:N}){t=T,r=new vt,r.name="scene-millers-planet-wave",T.add(r),x=N.fog,S=N.background,N.background=new qt(134168),N.fog=new zu(12108232,.0068);const v=new Vu(15002350,5005421,1);r.add(v);const A=new Fs(16118507,1.95);A.position.set(-18,27,11),r.add(A);const R=new Fs(12242393,.68);R.position.set(10,7,-8),r.add(R);const F=Rj();e=F.skyMesh,n=F.oceanMesh,s=F.timeU,r.add(e),r.add(n);const D=Pj();i=D.wave,a=D.foam,c=D.basePositions,u=new Float32Array(a.geometry.attributes.position.array),r.add(i),r.add(a),d=ZE(),d.position.set(-1.9,-.54,2.8),d.rotation.y=-.12,d.userData.pose.neutralY=d.position.y,r.add(d),f=ZE(),f.scale.setScalar(.96),f.position.set(1.85,-.78,6.15),f.rotation.y=.34,f.userData.pose.neutralY=f.position.y,r.add(f),y=Cj(),g=Bj(y),g.position.set(6.35,2.05,5.15),g.rotation.y=4,r.add(g),p=Uj(),p.scale.setScalar(2),p.position.set(.8,-2,22.6),p.rotation.y=-Math.PI/2,r.add(p),M.position.set(1.8,3.2,-5.6),M.lookAt(.2,1.5,10.8)},update({elapsed:T,camera:M}){if(s&&(s.value=T*.55),M){const v=Ej(M.position.x,M.position.z,T*.55)+Nj;M.position.y<v&&(M.position.y=v)}if(i){const N=(Math.sin(T*.16)*.5+.5)*1;i.position.z=xt.lerp(238,118,N),i.position.x=Math.sin(T*.05)*7.8,i.rotation.y=Math.sin(T*.07)*.055,JE(c,i,T,1)}a&&(a.position.z=i?i.position.z-4.2:a.position.z,a.position.x=i?i.position.x:a.position.x,a.rotation.y=i?i.rotation.y:a.rotation.y,JE(u,a,T+.85,.8)),QE(d,T,0,-.12),QE(f,T,1.6,.34)},resize(){},dispose({scene:T}){T.fog=x,T.background=S,y&&(y.dispose(),y=null),r&&(t&&r.parent!==t&&t.add(r),Li(r)),r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,g=null,x=null,S=null}}}};function Ij(){const r=new $s,t=Xi.xz,e=et=>{let ct=X(0);ct=ct.add(ui(Dt(et.x.mul(4e-4),X(0),et.y.mul(4e-4))).mul(350));const st=ui(Dt(et.x.mul(.002),X(100),et.y.mul(.002))),Z=X(1).sub(ii(st));return ct=ct.add(Z.mul(Z).mul(150)),ct=ct.add(ui(Dt(et.x.mul(.01),X(200),et.y.mul(.01))).mul(25)),ct},n=e(t),s=e(Hn(0,0)),i=n.sub(s);r.positionNode=Xi.add(Dt(0,i,0));const a=X(.5),c=e(t.add(Hn(a.negate(),X(0)))),u=e(t.add(Hn(a,X(0)))),d=e(t.add(Hn(X(0),a.negate()))),f=e(t.add(Hn(X(0),a))),p=u.sub(c).div(a.mul(2)),g=f.sub(d).div(a.mul(2)),y=Fn(Dt(p.negate(),X(1),g.negate())),x=Ae(y,Dt(0,1,0)),S=ui(Dt(t.x.mul(.01),X(5),t.y.mul(.01))).mul(.1),T=bn(X(.75),X(.65),x.add(S)),M=ui(Dt(t.x.mul(.003),X(10),t.y.mul(.001))),N=bn(X(-.2),X(.3),M),v=ui(Dt(t.x.mul(.08),X(20),t.y.mul(.08))),A=bn(X(.3),X(.7),v),R=Xe("#e6ecf0"),F=X(.9),D=ui(Dt(t.x.mul(.8),X(30),t.y.mul(.8))),O=ui(Dt(t.x.mul(.8),X(31),t.y.mul(.8))),B=Dt(D.mul(.2),X(0),O.mul(.2)),z=Xe("#9ca7b0"),tt=X(.4),j=ui(Dt(t.x.mul(.2),X(40),t.y.mul(.05))),dt=ui(Dt(t.x.mul(.2),X(41),t.y.mul(.05))),wt=Dt(j.mul(.1),X(0),dt.mul(.1)),ft=Xe("#3c4245"),U=X(.95),K=ui(Dt(t.x.mul(.4),X(50),t.y.mul(.4))),nt=ui(Dt(t.x.mul(.4),X(51),t.y.mul(.4))),ht=Dt(K.mul(.4),X(0),nt.mul(.4)),_t=Xe("#2a2d2f"),P=X(.85),q=ui(Dt(t.x.mul(.1),X(60),t.y.mul(.1))),L=ui(Dt(t.x.mul(.1),X(61),t.y.mul(.1))),I=Dt(q.mul(.6),X(0),L.mul(.6));let H=te(R,z,N),W=te(F,tt,N),at=te(B,wt,N);H=te(H,ft,A),W=te(W,U,A),at=te(at,ht,A),r.colorNode=te(H,_t,T),r.roughnessNode=te(W,P,T);const rt=te(at,I,T);return r.normalNode=Fn(y.add(rt)),r.metalnessNode=X(0),r}const Vj=new G(0,1,0),Gj=10,t3=.02,e3=.5,n3=.2,s3=new G(506.728,-5.863,-342.568),kj=new G(1379.031,-192.585,-794.478);function i3(r,t){r.updateMatrixWorld(!0);const e=new ha().setFromObject(r);Number.isFinite(e.min.y)&&(r.position.y+=t-e.min.y)}function fu(r,t){return(r<<t|r>>>32-t)>>>0}function Hj(r,t,e){return e=(e^t)-fu(t,14)>>>0,r=(r^e)-fu(e,11)>>>0,t=(t^r)-fu(r,25)>>>0,e=(e^t)-fu(t,16)>>>0,r=(r^e)-fu(e,4)>>>0,t=(t^r)-fu(r,14)>>>0,e=(e^t)-fu(t,24)>>>0,e>>>0}function Jl(r,t,e){const i=3735928584+(r>>>0)>>>0,a=3735928584+(t>>>0)>>>0,c=3735928584+(e>>>0)>>>0;return Hj(i,a,c)}function S2(r){return r*r*r*(r*(r*6-15)+10)}function tc(r,t,e,n){const s=r&15,i=s<8?t:e,a=s<4?e:s===12||s===14?t:n,c=(s&1)===0?i:-i,u=(s&2)===0?a:-a;return c+u}function Wj(r,t,e,n,s,i,a,c,u,d,f){const p=1-u,g=1-d;return(1-f)*(g*(r*p+t*u)+d*(e*p+n*u))+f*(g*(s*p+i*u)+d*(a*p+c*u))}function w2(r,t,e){const n=Math.floor(r),s=Math.floor(t),i=Math.floor(e),a=r-n,c=t-s,u=e-i,d=S2(a),f=S2(c),p=S2(u),g=tc(Jl(n,s,i),a,c,u),y=tc(Jl(n+1,s,i),a-1,c,u),x=tc(Jl(n,s+1,i),a,c-1,u),S=tc(Jl(n+1,s+1,i),a-1,c-1,u),T=tc(Jl(n,s,i+1),a,c,u-1),M=tc(Jl(n+1,s,i+1),a-1,c,u-1),N=tc(Jl(n,s+1,i+1),a,c-1,u-1),v=tc(Jl(n+1,s+1,i+1),a-1,c-1,u-1);return .982*Wj(g,y,x,S,T,M,N,v,d,f,p)}function oL(r,t){let e=0;e+=w2(r*4e-4,0,t*4e-4)*350;const n=w2(r*.002,100,t*.002),s=1-Math.abs(n);return e+=s*s*150,e+=w2(r*.01,200,t*.01)*25,e}const qj=oL(0,0);function gc(r,t){return oL(r,t)-qj}function $j(r,t,e=.5){const n=gc(r-e,t),s=gc(r+e,t),i=gc(r,t-e),a=gc(r,t+e),c=(s-n)/(e*2),u=(a-i)/(e*2);return new G(-c,1,-u).normalize()}function Ds(r,t){const e=new C(new Y(t.size[0],t.size[1],t.size[2]),new gt({color:t.color,roughness:t.roughness??.78,metalness:t.metalness??.14}));return e.position.set(t.position[0],t.position[1],t.position[2]),t.rotation&&e.rotation.set(t.rotation[0],t.rotation[1],t.rotation[2]),t.name&&(e.name=t.name),r.add(e),e}function aL({name:r,accentColor:t}){const e=new vt;e.name=r;const n="#dfe4e8",s="#9ba4ac",i="#0f1822",a="#66727d",c="#5b6670",u=Ds(e,{name:`${r}-torso`,size:[1.18,1.6,.72],position:[0,2.08,0],color:n});Ds(e,{name:`${r}-chest-plate`,size:[.96,.8,.18],position:[0,2.18,.45],color:s,roughness:.66,metalness:.24}),Ds(e,{name:`${r}-backpack`,size:[.86,.95,.34],position:[0,2.08,-.53],color:s,roughness:.64,metalness:.26}),Ds(e,{name:`${r}-accent-collar`,size:[.52,.16,.22],position:[0,2.78,.42],color:t}),Ds(e,{name:`${r}-accent-stripe`,size:[.16,.64,.07],position:[.26,2.18,.53],color:t}),Ds(e,{name:`${r}-left-shoulder`,size:[.4,.22,.4],position:[-.78,2.72,0],color:t}),Ds(e,{name:`${r}-right-shoulder`,size:[.4,.22,.4],position:[.78,2.72,0],color:t});const d=Ds(e,{name:`${r}-helmet`,size:[.82,.82,.82],position:[0,3.34,0],color:n,roughness:.62,metalness:.3});Ds(e,{name:`${r}-visor`,size:[.58,.22,.16],position:[0,3.32,.46],color:i,roughness:.28,metalness:.08});const f=Ds(e,{name:`${r}-left-arm`,size:[.34,1.12,.34],position:[-.78,2.05,0],color:n}),p=Ds(e,{name:`${r}-right-arm`,size:[.34,1.12,.34],position:[.78,2.05,0],color:n}),g=Ds(e,{name:`${r}-left-forearm`,size:[.31,.74,.31],position:[-.78,1.34,.02],color:s}),y=Ds(e,{name:`${r}-right-forearm`,size:[.31,.74,.31],position:[.78,1.34,.02],color:s});Ds(e,{name:`${r}-left-glove`,size:[.31,.24,.36],position:[-.78,.9,.08],color:a}),Ds(e,{name:`${r}-right-glove`,size:[.31,.24,.36],position:[.78,.9,.08],color:a});const x=Ds(e,{name:`${r}-left-leg`,size:[.4,1.14,.4],position:[-.24,.84,0],color:n}),S=Ds(e,{name:`${r}-right-leg`,size:[.4,1.14,.4],position:[.24,.84,0],color:n});return Ds(e,{name:`${r}-left-boot`,size:[.44,.26,.58],position:[-.24,.16,.08],color:c}),Ds(e,{name:`${r}-right-boot`,size:[.44,.26,.58],position:[.24,.16,.08],color:c}),u.rotation.z=0,d.rotation.y=.16,f.rotation.z=.06,p.rotation.z=-.06,p.rotation.x=-.04,g.rotation.z=-.08,y.rotation.z=.08,y.rotation.x=-.08,x.rotation.x=0,S.rotation.x=0,e}function Xj({name:r}){return aL({name:r,accentColor:"#74808b"})}function jj({anchorPosition:r,forward:t}){const e=new vt;e.name="manns-planet-fight-characters";const n=new G().crossVectors(t,Vj).normalize(),s=r.clone().addScaledVector(t,Gj),i=aL({name:"dr-mann-blocky",accentColor:"#cc6f42"});i.scale.setScalar(e3);const a=.8;i.position.copy(s),i.position.addScaledVector(n,-1.9),i.position.addScaledVector(t,a),i3(i,gc(i.position.x,i.position.z)+t3);const c=Xj({name:"cooper-blocky"});c.scale.setScalar(e3);const u=-1.05;c.position.copy(s),c.position.addScaledVector(n,1.35),c.position.addScaledVector(t,u);const d=$j(c.position.x,c.position.z),f=new G(i.position.x-c.position.x,0,i.position.z-c.position.z);f.lengthSq()<1e-5&&f.copy(n),f.normalize();const p=f.sub(d.clone().multiplyScalar(f.dot(d)));p.lengthSq()<1e-5&&p.copy(n),p.normalize();const g=p.clone().negate(),y=new G().crossVectors(g,d);y.lengthSq()<1e-5&&y.set(1,0,0),y.normalize();const x=new G().crossVectors(d,y).normalize(),S=new Te().makeBasis(y,x,d);c.quaternion.setFromRotationMatrix(S),i3(c,gc(c.position.x,c.position.z)+t3);const T=new G().subVectors(c.position,i.position);return T.y=0,T.lengthSq()>1e-5&&(i.rotation.y=Math.atan2(T.x,T.z)),i.rotation.x=0,i.rotation.z=0,e.add(i),e.add(c),e}const Yj={id:"manns-planet",title:"Dr. Mann's Ice Planet",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null;const d=f=>{const p=gc(f.position.x,f.position.z)+n3;f.position.y<p&&(f.position.y=p,f.updateMatrixWorld())};return{init({root:f,camera:p,renderer:g,scene:y}){t=f,r=new vt,r.name="manns-planet-group",f.add(r),e=y.background,n=y.fog,s=g.toneMapping,i=g.toneMappingExposure,a=p.fov,c=p.near,u=p.far;const x=new qt("#d4cfcc");y.background=x,y.fog=new zu(x,.0018),g.toneMapping=ww,g.toneMappingExposure=1.1;const S=new Ro("#aab8c4",.8);r.add(S);const T=new Fs("#fff0e0",2);T.position.set(800,600,-1e3),r.add(T);const M=new Rn(8e3,8e3,1024,1024);M.rotateX(-Math.PI/2);const N=Ij(),v=new C(M,N);v.name="manns-planet-terrain",r.add(v),p.fov=45,p.near=.1,p.far=15e3,p.position.set(522.722,-15.244,-342.701),p.lookAt(-326.001,93.416,-860.256),p.updateProjectionMatrix(),p.updateMatrixWorld(),d(p);const A=s3.clone(),R=gc(A.x,A.z)+n3;A.y<R&&(A.y=R);const F=new G().subVectors(kj,s3).normalize(),D=jj({anchorPosition:A,forward:F});r.add(D)},update({camera:f}){f&&d(f)},resize(){},dispose({root:f,camera:p,renderer:g,scene:y}){y.background=e,y.fog=n,g.toneMapping=s,g.toneMappingExposure=i,a!==null&&c!==null&&u!==null&&(p.fov=a,p.near=c,p.far=u,p.updateProjectionMatrix()),r&&(f&&r.parent!==f&&t&&t.add(r),Li(r),r=null,t=null)}}}},__=1,lL=6120,cL=160,r3=lL*__,o3=(lL+cL)*__,Kj=new qt(132106),Zj=new qt(16777215),uL=new G(.88,.2,.43).normalize(),Qj=46,Jj=35,hL=9e4,a3=18,l3=10,tY=1.7,eY=340,c3=new G(6895.77,4931.842,6170.045),nY=new G(6480.178,4737.868,5281.418),sY=56,iY=-8,rY=-96,oY=6,aY=-188,T2=3.15,lY=6.5,_2=4,cY=14.5,uY=3,hY=3,u3=4.1,dY=.35,fY=new G(0,0,1.5),Mg=new G(0,0,1),pY=4.5/12*Math.PI*2,mY=24,gY=28,yY=37,xY=-2.6,bY=2.6,SY=.95,wY=.2,TY=8.8,_Y=.45,MY=1.25,vY=.9,AY=2.8,NY=2.2,RY=8.2,EY=1.8,CY=10.5,BY=18.5,DY=1.8,LY=5.4,h3=95,OY=new Set(["KeyW","KeyA","KeyS","KeyD","Space","ShiftLeft","ShiftRight"]),pu=new G,Wa=new G,mu=new G,gu=new G,yu=new G,yd=new G,vg=new G,d3=new G,f3=new G,M2=new G,v2=new G(0,1,0),p3=new Us,Ag=new Us,m3=new Us,Ng=new Us,g3=new Us;function Qf(r,t,e){if(r===t)return e<r?0:1;const n=xt.clamp((e-r)/(t-r),0,1);return n*n*(3-2*n)}function FY(r,t,e,n,s,i){yd.copy(e).sub(r).multiplyScalar(s),yd.addScaledVector(t,-i),t.addScaledVector(yd,n),r.addScaledVector(t,n)}function UY(r,t,e){r.traverse(n=>{if(!n.isMesh||!n.material)return;const s=i=>{i.polygonOffset=!0,i.polygonOffsetFactor=t,i.polygonOffsetUnits=e,i.needsUpdate=!0};if(Array.isArray(n.material))for(const i of n.material)s(i);else s(n.material)})}function PY(){const t=new Float32Array(21e3),e=new Float32Array(7e3*3),n=hL*.86,s=new G;for(let u=0;u<7e3;u+=1){const d=u*3,f=Math.acos(xt.randFloatSpread(2)),p=Math.random()*Math.PI*2,g=Math.sin(f);s.set(g*Math.cos(p),Math.cos(f),g*Math.sin(p)),t[d]=s.x*n,t[d+1]=s.y*n,t[d+2]=s.z*n;const y=xt.randFloat(.12,1.05),x=Math.pow(Math.random(),1.05),S=xt.clamp(y*(.5+x*.8),.04,1),T=xt.randFloat(-.09,.1);e[d]=xt.clamp(S+T*.5,.02,1),e[d+1]=xt.clamp(S+T*.15,.02,1),e[d+2]=xt.clamp(S-T*.45,.02,1)}const i=new Ye;i.setAttribute("position",new ge(t,3)),i.setAttribute("color",new ge(e,3));const a=new tr({color:Zj,size:1.15,sizeAttenuation:!1,transparent:!0,opacity:1,depthWrite:!1,vertexColors:!0}),c=new Qr(i,a);return c.name="scene10-space-stars",c}function Su(r,t,e){const n=new $s;return n.colorNode=Xe(r),n.roughnessNode=X(t),n.metalnessNode=X(e),n}function Za(r){const t=Math.sin(r+1)*43758.5453;return t-Math.floor(t)}function zY({matDarkHull:r,matSolarPanel:t,matTornFace:e,matWhiteHull:n}){const s=new vt,i=new C(new Y(8,7,5),n);i.position.set(0,0,-2.5),i.castShadow=!0,i.receiveShadow=!0,s.add(i);const a=new C(new Y(7.5,6.5,1),t);a.position.set(0,0,-4.6),a.castShadow=!0,s.add(a);const c=new C(new Y(8.2,2,2.5),r);c.position.set(0,0,-1.25),s.add(c);const u=16,d=14,f=-4,p=4,g=-3.5,y=3.5,x=[],S=[],T=(A,R)=>A*(d+1)+R;for(let A=0;A<=u;A+=1)for(let R=0;R<=d;R+=1){const F=f+A/u*(p-f),D=g+R/d*(y-g);let O=.05;if(A>0&&A<u&&R>0&&R<d){const B=A*31+R*17,z=Math.sin(A*2.1+R*1.3)*1.1+Math.cos(A*4.7-R*2.9)*.7+(Za(B)-.5)*1.2;O=.05+Math.abs(z)}x.push(F,D,O)}for(let A=0;A<u;A+=1)for(let R=0;R<d;R+=1){const F=T(A,R),D=T(A+1,R),O=T(A+1,R+1),B=T(A,R+1);S.push(F,D,O,F,O,B)}const M=new Ye;M.setAttribute("position",new ge(x,3)),M.setIndex(S),M.computeVertexNormals();const N=new C(M,e);N.castShadow=!0,s.add(N);const v=20;for(let A=0;A<v;A+=1){const F=A/(v-1)*Math.PI*2,D=Math.cos(F)*3.8,O=Math.sin(F)*3.3,B=Za(A*7),z=Za(A*7+1),tt=Za(A*7+2),j=Za(A*7+3),dt=.4+B*1.5,wt=.3+z*1.2,ft=.3+tt*1,U=.1+j*1.5,K=new C(new Y(dt,wt,ft),n);K.position.set(D,O,U),K.rotation.x=(B-.5)*1.5,K.rotation.y=(z-.5)*1.5,K.rotation.z=F+(tt-.5)*.5,K.castShadow=!0,s.add(K)}return s}function IY(){const r=new vt;r.name="scene10-endurance-damaged";const t=Su(14540253,.4,.6),e=Su(3355443,.5,.7),n=Su(1118481,.15,.9),s=Su(328965,.05,.8),i=Su(2236962,.9,.3),a=Su(1710618,.85,.45),c=32,u=12,d=4,f=5;for(let T=0;T<u;T+=1){const M=T/u*Math.PI*2,N=Math.cos(M)*c,v=Math.sin(M)*c;if(T===d){const j=new vt,dt=new C(new Y(8,7,1.2),i);dt.castShadow=!0,j.add(dt);const wt=[{w:.8,h:3,d:.35,x:2.4,y:1.8,z:.55,rx:.2,rz:.3},{w:.5,h:1.8,d:.3,x:-2.1,y:-2.2,z:.55,rx:-.1,rz:-.2},{w:.9,h:1.4,d:.35,x:2.7,y:-1.3,z:.5,rx:.25,rz:.35},{w:.4,h:2.3,d:.28,x:-2.9,y:1,z:.5,rx:-.15,rz:-.28},{w:.7,h:.9,d:.4,x:.3,y:2.7,z:.45,rx:.1,rz:.18}];for(const ft of wt){const U=new C(new Y(ft.w,ft.h,ft.d),i);U.position.set(ft.x,ft.y,ft.z),U.rotation.set(ft.rx,0,ft.rz),U.castShadow=!0,j.add(U)}j.position.set(N,v,0),j.rotation.z=M+Math.PI/2,j.lookAt(0,0,0),r.add(j)}else if(T===f){const j=zY({matDarkHull:e,matSolarPanel:n,matTornFace:a,matWhiteHull:t});j.position.set(N,v,0),j.rotation.z=M+Math.PI/2,j.lookAt(0,0,0),j.rotateY(Math.PI),r.add(j)}else{const j=new vt,dt=new C(new Y(8,7,10),t);dt.castShadow=!0,dt.receiveShadow=!0,j.add(dt);const wt=new C(new Y(7.5,6.5,1),n);wt.position.set(0,0,-4.6),wt.castShadow=!0,wt.receiveShadow=!0,j.add(wt);const ft=new C(new Y(8.2,2,4),e);ft.position.set(0,0,1),j.add(ft),j.position.set(N,v,0),j.rotation.z=M+Math.PI/2,j.lookAt(0,0,0),r.add(j)}const A=M+Math.PI/u,R=Math.cos(A)*c,F=Math.sin(A)*c,D=new vt;D.position.set(R,F,0),D.rotation.z=A;const O=new C(new $t(2,2,9,32),t);O.castShadow=!0,O.receiveShadow=!0,D.add(O);const B=new C(new $t(2.8,2.8,2.5,32),t);D.add(B);const z=new C(new $t(1.2,1.2,3.5,32),s);z.rotation.z=Math.PI/2,D.add(z);const tt=new C(new $t(1.5,1.5,3.2,32),e);tt.rotation.z=Math.PI/2,D.add(tt),r.add(D)}const p=c-5,g=new vt;g.position.set(0,p/2+2,0);const y=new C(new $t(2.5,2.5,p,32),t);y.castShadow=!0,y.receiveShadow=!0,g.add(y);for(let T=-1;T<=1;T+=1){const M=new C(new $t(3,3,2,32),e);M.position.y=T*(p/3),g.add(M)}r.add(g);const x=new C(new $t(4,4,3,32),t);x.rotation.x=Math.PI/2,x.castShadow=!0,x.receiveShadow=!0,r.add(x);const S=new C(new la(3,.5,16,64),e);return S.position.z=1.5,r.add(S),r.userData.hullMaterial=t,r}function VY(r){const t=new vt;t.name="scene10-endurance-peeling-debris";const e=r??Su(14540253,.4,.6),n=[];for(let s=0;s<mY;s+=1){const i=s*13,a=.45+Za(i+1)*1.25,c=.35+Za(i+2)*.9,u=.35+Za(i+3)*1.05,d=Za(i+4);let f=null;d<.58?f=new Y(a,c,u):d<.86?f=new $t(a*.28,a*.55,u,4,1):f=new Pw(a*.58,0);const p=new C(f,e);p.castShadow=!0,p.receiveShadow=!0,t.add(p),n.push({angularVelocity:new G,axialSpeed:0,detachTime:0,lifetime:0,localAnchor:new G,localBaseQuaternion:new Us,localOutward:new G,localTangent:new G,maxPeelDistance:0,mesh:p,outwardSpeed:0,peelStartTime:0,peelTwist:0,released:!1,releasedAge:0,rollRate:0,spinCarry:0,tumbleRate:0,velocity:new G})}return{group:t,pieces:n}}function xw(r,t){const e=r.mul(t);return Bi(br(Ae(e,Dt(12.9898,78.233,37.719))).mul(43758.5453))}function GY(){const r=new $s,t=Xi,e=.8,n=.5,s=me(.96,Bi(t.x.mul(e))),i=me(.96,Bi(t.z.mul(n))),a=ue(s,i),c=xw(t,X(15)).mul(.1),u=Xe(15527664),d=Xe(13686234),f=Xe(6316128);let p=te(u,d,c);p=te(p,f,a);const g=me(X(8.2),t.z),y=me(t.z,X(-4)).mul(me(X(.8),t.y)),x=ue(g,y.mul(xw(t,X(5)).mul(.5)));return p=te(p,Xe(2236962),x),r.colorNode=p,r.roughnessNode=X(.4).add(c).add(a.mul(.4)),r.metalnessNode=X(.15),r}function kY(){const r=new $s,t=xw(Xi,X(25)).mul(.08);return r.colorNode=Xe(1381912).add(t),r.roughnessNode=X(.85).sub(t),r.metalnessNode=X(.3),r}function HY(){const r=new $s;return r.colorNode=Xe(66051),r.roughnessNode=X(.02),r.metalnessNode=X(.95),r}function WY(){const e=new Y(1,1,1,16,4,32),n=e.attributes.position;for(let s=0;s<n.count;s+=1){const i=n.getX(s)*2,a=n.getY(s)*2,c=n.getZ(s)*2,u=c*(18/2);let d=0;u<-3?d=8.5/2:u<6?d=xt.lerp(8.5/2,1.2,(u+3)/9):d=xt.lerp(1.2,.3,(u-6)/3),d*=1-Math.pow(Math.abs(c),4)*.05;const f=i*d;let p=0;if(a>0){u<-4?p=1:u<1?p=xt.lerp(1,2.2,(u+4)/5):u<7?p=xt.lerp(2.2,.4,(u-1)/6):p=xt.lerp(.4,.1,(u-7)/2);const g=Math.pow(Math.abs(i),1.5),y=xt.lerp(.8,.1,(u+9)/18);p=xt.lerp(p,y,g)}else p=-.1+(u+9)/18*.2;n.setXYZ(s,f,p,u)}return e.computeVertexNormals(),e}function qY(){const r=new vt;r.name="scene10-ranger";const t=GY(),e=kY(),n=HY();r.add(new C(WY(),t));const s=p=>{const g=new vt,y=p?1:-1,x=new C(new Y(1.5,.8,6),e);x.position.set(4*y,.3,-5),x.rotation.y=.05*y,g.add(x);const S=new C(new Y(1,.5,6.5),e);S.position.set(3*y,.2,.5),S.rotation.y=-.28*y,g.add(S);const T=new C(new Y(.5,.3,4),e);return T.position.set(1.4*y,.1,5),T.rotation.y=-.45*y,g.add(T),g};r.add(s(!0)),r.add(s(!1));const i=new C(new Y(8.2,1.4,1.2),e);i.position.set(0,.4,-8.6),r.add(i);const a=Math.atan2(1.8,6),c=(p,g,y,x,S,T=0)=>{const M=S/9;let N=xt.lerp(4.25,1.2,(S+3)/9);N*=1-Math.pow(Math.abs(M),4)*.05;const v=Math.min(Math.abs(x)/N,1),A=xt.lerp(2.2,.4,(S-1)/6),R=Math.pow(v,1.5),F=xt.lerp(.8,.1,(S+9)/18),D=xt.lerp(A,F,R),O=Math.min((Math.abs(x)+.1)/N,1),B=xt.lerp(A,F,Math.pow(O,1.5)),z=Math.atan2(B-D,.1)*Math.sign(-x),tt=new C(new Y(p,g,y),n);tt.position.set(x,D-g/2+.02,S),tt.rotation.set(a,T,z),r.add(tt)};c(.7,.1,.8,-.8,1.8,-.1),c(.7,.1,.8,0,1.8,0),c(.7,.1,.8,.8,1.8,.1),c(.9,.1,.9,-1,3,-.15),c(.9,.1,.9,0,3,0),c(.9,.1,.9,1,3,.15),c(1,.1,1,-1.2,4.2,-.2),c(1,.1,1,0,4.2,0),c(1,.1,1,1.2,4.2,.2);const u=-Math.atan2(1.2,5),d=(p,g)=>{const y=new C(new Y(.8,.1,1),n);y.position.set(p,1.95,g),y.rotation.set(u,0,p>0?-.1:.1),r.add(y)};d(-.7,.2),d(.7,.2),r.updateMatrixWorld(!0);const f=new ha().setFromObject(r).getCenter(new G);for(const p of r.children)p.position.sub(f);return UY(r,-1,-2),r}function ec(r,t){return[r[0]*t,r[1]*t,r[2]*t]}function $Y(r){let t=1;switch(r){case"terrestrial":t=2.15;break;case"rocky":t=2;break;case"gasGiant":case"iceGiant":t=1.35;break;default:t=1;break}return t*tY}function XY(r,t){const e=Math.max(r.atmosphereHeightKm,1),n=xt.clamp(r.atmosphereDensity,.15,1.8),s=xt.clamp((n-.25)/1.35,0,1),i=$Y(r.kind);let a={rayleighScatteringKm:[.0058,.0135,.0331],mieScatteringKm:[.0022,.0022,.0022],mieExtinctionKm:[.0032,.0032,.0032],rayleighScaleHeightKm:xt.lerp(7.2,10.8,s),upperRayleighScaleHeightKm:Math.max(36,e*.36*i),upperRayleighStrength:.04,mieScaleHeightKm:xt.lerp(.9,1.7,s),miePhaseG:.76,ozoneExtinctionKm:[65e-5,.001881,85e-6],ozoneCenterHeightKm:Math.min(e*.42,26),ozoneWidthKm:Math.max(6,Math.min(e*.18,14)),solarIntensity:13.8};a={rayleighScatteringKm:[.0044,.0104,.024],mieScatteringKm:[.0015,.0015,.0015],mieExtinctionKm:[.0024,.0024,.0024],rayleighScaleHeightKm:Math.max(3.6,Math.min(e*.11,6.2)),upperRayleighScaleHeightKm:Math.max(16,e*.28*i),upperRayleighStrength:.032,mieScaleHeightKm:Math.max(.4,Math.min(e*.035,.95)),miePhaseG:.71,ozoneExtinctionKm:[0,0,0],ozoneCenterHeightKm:e*.45,ozoneWidthKm:Math.max(3.5,e*.14),solarIntensity:11.6};const c=n*.78,u=n*.9,d=ec(a.rayleighScatteringKm,c),f=ec(a.mieScatteringKm,u),p=ec(a.mieExtinctionKm,u),g=[Math.max(p[0],f[0]+1e-4),Math.max(p[1],f[1]+1e-4),Math.max(p[2],f[2]+1e-4)],y=ec(a.ozoneExtinctionKm??[0,0,0],1),x=t,S=1/Math.max(x,1e-6);return{rayleighScatteringWorld:ec(d,S),mieScatteringWorld:ec(f,S),mieExtinctionWorld:ec(g,S),ozoneExtinctionWorld:ec(y,S),rayleighScaleHeightWorld:Math.max(a.rayleighScaleHeightKm*x,1e-5),upperRayleighScaleHeightWorld:Math.max((a.upperRayleighScaleHeightKm??a.rayleighScaleHeightKm*2.6)*x,1e-5),upperRayleighStrength:xt.clamp(a.upperRayleighStrength??.05,0,.24),mieScaleHeightWorld:Math.max(a.mieScaleHeightKm*x,1e-5),ozoneCenterHeightWorld:Math.max((a.ozoneCenterHeightKm??0)*x,0),ozoneWidthWorld:Math.max((a.ozoneWidthKm??1)*x,1e-5),miePhaseG:xt.clamp(a.miePhaseG,0,.92),solarIntensity:a.solarIntensity??18}}function jY(r,t,e,n,s,i,a,c){const u=Dt(c.rayleighScatteringWorld[0],c.rayleighScatteringWorld[1],c.rayleighScatteringWorld[2]),d=Dt(c.mieScatteringWorld[0],c.mieScatteringWorld[1],c.mieScatteringWorld[2]),f=Dt(c.mieExtinctionWorld[0],c.mieExtinctionWorld[1],c.mieExtinctionWorld[2]),p=Dt(c.ozoneExtinctionWorld[0],c.ozoneExtinctionWorld[1],c.ozoneExtinctionWorld[2]),g=X(c.rayleighScaleHeightWorld),y=X(c.upperRayleighScaleHeightWorld),x=X(c.upperRayleighStrength),S=X(c.mieScaleHeightWorld),T=X(c.ozoneCenterHeightWorld),M=X(c.ozoneWidthWorld),N=X(c.miePhaseG),v=X(c.solarIntensity),A=Jn(()=>{const F=Ar,D=Fn($u.sub(Ar)),O=Fn(r),B=t,z=e,tt=n,j=ue(tt.sub(z),z.mul(.005)),dt=j.mul(.24),wt=j.mul(.16),ft=F.sub(B),U=Ae(ft,D),K=Ae(ft,ft).sub(tt.mul(tt)),nt=U.mul(U).sub(K),ht=me(0,nt),_t=Tr(ue(nt,0)),P=Hn(U.negate().sub(_t),U.negate().add(_t)),q=Ae(ft,D),L=Ae(ft,ft).sub(z.mul(z)),I=q.mul(q).sub(L),H=me(0,I),W=Tr(ue(I,0)),at=Hn(q.negate().sub(W),q.negate().add(W)),rt=me(0,at.x).mul(H),et=ue(P.x,0).mul(ht),ct=ue(te(P.y,w_(P.y,at.x),rt),0).mul(ht),st=ue(ct.sub(et),0),Z=st.div(X(a3)),Q=bn(0,wt,st),$=Ae(D,O),mt=X(.05968310365946075).mul(X(1).add($.mul($))),yt=N.mul(N),Tt=X(.07957747154594767).mul(X(1).sub(yt)).div(ei(X(1).add(yt).sub(X(2).mul(N).mul($)),1.5)),Mt=X(0).toVar(),Vt=X(0).toVar(),zt=X(0).toVar(),kt=Dt(0,0,0).toVar();ll(a3,({i:rs})=>{const zn=et.add(Z.mul(X(rs).add(.5))),$n=F.add(D.mul(zn)),be=$n.sub(B),Ze=Mo(be),An=Ze.sub(z),Ue=me(0,An),Xn=ue(An,0),le=ue(tt.sub(Ze),0),oe=bn(0,dt,le),Ve=On(Xn.negate().div(g)),pn=On(Xn.negate().div(y)).mul(x),jn=Ve.add(pn).mul(Ue).mul(oe),Yn=On(Xn.negate().div(S)).mul(Ue).mul(oe),Oi=ue(X(1).sub(ii(Xn.sub(T)).div(M)),0).mul(Ue).mul(oe);Mt.addAssign(jn.mul(Z)),Vt.addAssign(Yn.mul(Z)),zt.addAssign(Oi.mul(Z));const bs=Ae(be,O),Uc=Ae(be,be).sub(tt.mul(tt)),io=bs.mul(bs).sub(Uc),Nr=me(0,io),Fi=Tr(ue(io,0)),Eo=Hn(bs.negate().sub(Fi),bs.negate().add(Fi)),ro=ue(Eo.x,0).mul(Nr),Xs=ue(Eo.y.sub(ro),0).mul(Nr).div(X(l3)),Si=Ae(be,O),pa=Ae(be,be).sub(z.mul(z)),oo=Si.mul(Si).sub(pa),dl=me(0,oo),Ui=Tr(ue(oo,0)),Kn=Si.negate().sub(Ui),Ss=X(1).sub(me(0,Kn).mul(dl)),wi=X(0).toVar(),Rr=X(0).toVar(),Co=X(0).toVar();ll(l3,({i:Er})=>{const Cr=ro.add(Xs.mul(X(Er).add(.5))),lo=$n.add(O.mul(Cr)),Ti=Mo(lo.sub(B)),wn=Ti.sub(z),Pi=me(0,wn),js=ue(wn,0),rr=ue(tt.sub(Ti),0),Is=bn(0,dt,rr),zc=On(js.negate().div(g)),pl=On(js.negate().div(y)).mul(x);wi.addAssign(zc.add(pl).mul(Xs).mul(Pi).mul(Is)),Rr.addAssign(On(js.negate().div(S)).mul(Xs).mul(Pi).mul(Is)),Co.addAssign(ue(X(1).sub(ii(js.sub(T)).div(M)),0).mul(Xs).mul(Pi).mul(Is))});const Pc=u.mul(Mt).add(f.mul(Vt)).add(p.mul(zt)),fl=u.mul(wi).add(f.mul(Rr)).add(p.mul(Co)),ao=On(Pc.add(fl).negate()).mul(Ss),ma=u.mul(jn.mul(mt)).add(d.mul(Yn.mul(Tt)));kt.addAssign(ma.mul(ao).mul(Z))});const Qt=u.mul(Mt).add(f.mul(Vt)).add(p.mul(zt)),ie=On(Qt.negate()),Yt=Dt(1,1,1).sub(ie).mul(u.mul(.018).add(d.mul(.0035))).mul(v.mul(.38)),Ne=kt.mul(v).add(Yt).mul(Q),ce=Ne.div(Ne.mul(.22).add(Dt(1,1,1))),We=Ae(ie,Dt(.2126,.7152,.0722)).clamp(0,1),Sn=S_.select(i,a),vn=ei(X(1).sub(We),1.15).mul(Q).mul(s).mul(Sn).clamp(0,1);return gd(ce,vn)}),R=new Ac;return R.outputNode=A(),R.transparent=!0,R.premultipliedAlpha=!1,R.depthWrite=!1,R.depthTest=!0,R.side=En,R.blending=fi,R}function YY(){const r=new $s,t=U=>U.mul(.5).add(.5),e=Xi.normalize(),n=t(Kf(e.mul(1.8),4,2,.5)),s=t(Kf(e.mul(5.5),5,2.1,.48)),i=t(Kf(e.mul(14),4,2,.45)),a=t(Kf(e.mul(22),3,2.3,.5)),c=t(Kf(e.mul(40),2,2,.5)),u=ii(e.y),d=bn(.35,.75,u),f=$o(bn(.38,.62,n).add(d.mul(.5)),X(0),X(1)),p=ii(a.sub(.5)).mul(2),g=ii(c.sub(.5)).mul(2),y=bn(0,.12,p),x=bn(0,.06,g),S=f.mul(d.oneMinus().add(.3).clamp(0,1)),T=te(X(1),y,S.mul(.9)).mul(te(X(1),x,S.mul(.6))),M=Dt(.01,.06,.14),N=Dt(.08,.21,.42),v=Dt(.48,.76,.92),A=Dt(.88,.95,1),R=Dt(.96,.985,1),F=Dt(.82,.9,.97),D=Dt(.9,.96,1);let O=M.toVar();O=te(O,te(N,v,s),f);const B=bn(.52,.78,i).mul(f);O=te(O,A,B),O=te(O,R,d.mul(.85));const z=te(F,D,bn(0,.08,p));O=te(z,O,T);const tt=te(X(.85),X(.08),f),j=T.oneMinus().mul(.55),dt=B.mul(.35),wt=$o(tt.add(j).add(dt),X(.04),X(.95)),ft=te(X(0),X(.05),f.mul(T));return r.colorNode=O,r.roughnessNode=wt,r.metalnessNode=ft,r}function KY(){const r=new vt;r.name="scene10-manns-planet-system";const t=YY(),e=new C(new ke(r3,168,112),t);e.name="scene10-manns-planet",e.receiveShadow=!0,r.add(e);const n=XY({atmosphereDensity:.92,atmosphereHeightKm:cL,kind:"rocky"},__),s=Me(1),i=Me(1),a=Me(0),c=Me(new G(0,0,0)),u=jY(Me(uL.clone()),c,Me(r3),Me(o3),s,i,a,n),d=new C(new ke(o3,128,88),u);return d.name="scene10-manns-planet-atmosphere",d.renderOrder=10,r.add(d),r.rotation.x=xt.degToRad(23.5),r.rotation.z=xt.degToRad(-9.5),{atmosphere:d,atmosphereCenterWorld:c,group:r,planet:e}}const ZY={id:"endurance-spin-docking",title:"Endurance Spin-Docking Maneuver",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=0,g=0,y=0,x=null;const S={ready:!1,time:0,enduranceSpinAngle:0,rangerSpinAngle:0,currentEnduranceSpinRate:T2,baseEndurancePosition:new G,baseEnduranceQuaternion:new Us,rangerInitialPosition:new G,approachStarted:!1,dockPortWorld:new G,dockAxisWorld:new G,rangerStartParallel:0,rangerStartRadial:0,rangerStartRadialDir:new G(1,0,0),rangerVelocity:new G,rangerTargetPosition:new G};function T(B){B.position.set(6878.606,4914.173,6141.678),B.lookAt(6301.714,4779.175,5336.091)}function M(){n&&(n.group.getWorldPosition(pu),n.atmosphereCenterWorld.value.copy(pu))}function N(){s&&(S.dockAxisWorld.copy(Mg).applyQuaternion(s.quaternion).normalize(),S.dockPortWorld.copy(fY).applyQuaternion(s.quaternion),S.dockPortWorld.add(s.position))}function v(){!s||!i||(Wa.copy(nY).sub(c3).normalize(),mu.crossVectors(Wa,v2).normalize(),gu.crossVectors(mu,Wa).normalize(),yu.copy(c3).addScaledVector(Wa,eY),s.position.copy(yu),s.position.addScaledVector(mu,sY),s.position.addScaledVector(gu,iY),s.rotation.set(-.5,-.3,.84),i.position.copy(yu),i.position.addScaledVector(mu,rY),i.position.addScaledVector(gu,oY),i.position.addScaledVector(Wa,aY),i.scale.setScalar(1.35))}function A(){!s||!i||(S.time=0,S.enduranceSpinAngle=0,S.rangerSpinAngle=0,S.currentEnduranceSpinRate=T2,S.approachStarted=!1,S.baseEndurancePosition.copy(s.position),S.baseEnduranceQuaternion.copy(s.quaternion),S.rangerInitialPosition.copy(i.position),S.rangerVelocity.set(0,0,0),N(),Ag.setFromUnitVectors(v2,yu.copy(S.dockAxisWorld).negate()),i.quaternion.copy(Ag),S.rangerTargetPosition.copy(i.position),S.ready=!0)}function R(B,z){const tt=pY+xt.randFloatSpread(SY),j=xt.randFloat(gY,yY),dt=xt.randFloat(xY,bY);B.localAnchor.set(Math.cos(tt)*j,Math.sin(tt)*j,dt),B.localOutward.set(Math.cos(tt),Math.sin(tt),xt.randFloatSpread(.14)).normalize(),B.localTangent.crossVectors(Mg,B.localOutward),B.localTangent.lengthSq()<1e-6?B.localTangent.set(1,0,0):B.localTangent.normalize(),B.localBaseQuaternion.setFromEuler(new Ji(xt.randFloatSpread(1.15),xt.randFloatSpread(1.15),xt.randFloatSpread(1.15))),B.peelStartTime=z+xt.randFloat(wY,TY),B.detachTime=B.peelStartTime+xt.randFloat(_Y,MY),B.maxPeelDistance=xt.randFloat(vY,AY),B.peelTwist=xt.randFloatSpread(1.25),B.outwardSpeed=xt.randFloat(NY,RY),B.axialSpeed=xt.randFloatSpread(EY),B.spinCarry=xt.randFloat(.28,.82),B.rollRate=xt.randFloatSpread(2.3),B.tumbleRate=xt.randFloatSpread(1.7),B.lifetime=xt.randFloat(CY,BY),B.released=!1,B.releasedAge=0,B.velocity.set(0,0,0),B.angularVelocity.set(0,0,0)}function F(){if(a)for(const B of a.pieces){const z=-xt.randFloat(0,4.5);R(B,z)}}function D(B){if(!(!S.ready||!s||!a)){vg.copy(Mg).applyQuaternion(s.quaternion).normalize(),d3.copy(vg).multiplyScalar(S.currentEnduranceSpinRate);for(const z of a.pieces)if(z.released){z.releasedAge+=B,z.mesh.position.addScaledVector(z.velocity,B);const tt=z.angularVelocity.length();if(tt>1e-6&&(Wa.copy(z.angularVelocity).multiplyScalar(1/tt),Ng.setFromAxisAngle(Wa,tt*B),z.mesh.quaternion.premultiply(Ng).normalize()),z.releasedAge>=z.lifetime){const j=xt.randFloat(DY,LY);R(z,S.time+j)}}else{const tt=Qf(z.peelStartTime,z.detachTime,S.time),j=z.maxPeelDistance*tt*tt;f3.copy(z.localAnchor).addScaledVector(z.localOutward,j),M2.copy(f3).applyQuaternion(s.quaternion),z.mesh.position.copy(s.position).add(M2),Ng.copy(s.quaternion).multiply(z.localBaseQuaternion),g3.setFromAxisAngle(z.localTangent,z.peelTwist*tt),z.mesh.quaternion.copy(Ng).multiply(g3),S.time>=z.detachTime&&(z.released=!0,z.releasedAge=0,gu.copy(M2),yu.crossVectors(d3,gu),yd.copy(z.localOutward).applyQuaternion(s.quaternion).normalize(),z.velocity.copy(yu),z.velocity.addScaledVector(yd,z.outwardSpeed),z.velocity.addScaledVector(vg,z.axialSpeed),z.velocity.length()>h3&&z.velocity.setLength(h3),z.angularVelocity.copy(vg).multiplyScalar(S.currentEnduranceSpinRate*z.spinCarry),z.angularVelocity.addScaledVector(yd,z.rollRate),z.velocity.lengthSq()>1e-6&&(pu.copy(z.velocity).normalize(),z.angularVelocity.addScaledVector(pu,z.tumbleRate)))}}}function O(B){if(!S.ready||!s||!i)return;S.time+=B;const z=_2+cY,tt=z+uY,j=tt+hY,dt=Qf(0,lY,S.time),wt=Qf(_2,z,S.time),ft=Qf(z,tt,S.time),U=Qf(tt,j,S.time);S.currentEnduranceSpinRate=xt.lerp(T2,0,U),S.enduranceSpinAngle+=S.currentEnduranceSpinRate*B,p3.setFromAxisAngle(Mg,S.enduranceSpinAngle),s.quaternion.copy(S.baseEnduranceQuaternion).multiply(p3),s.position.copy(S.baseEndurancePosition),N();const K=xt.lerp(0,S.currentEnduranceSpinRate,dt);S.rangerSpinAngle+=K*B,!S.approachStarted&&S.time>=_2&&(S.approachStarted=!0,pu.copy(i.position).sub(S.dockPortWorld),S.rangerStartParallel=pu.dot(S.dockAxisWorld),Wa.copy(S.dockAxisWorld).multiplyScalar(S.rangerStartParallel),mu.copy(pu).sub(Wa),S.rangerStartRadial=mu.length(),S.rangerStartRadial>1e-4?S.rangerStartRadialDir.copy(mu).normalize():S.rangerStartRadialDir.set(1,0,0));const nt=S.approachStarted?wt:0,ht=S.approachStarted?ft:0;if(!S.approachStarted)S.rangerTargetPosition.copy(S.rangerInitialPosition);else{gu.copy(S.rangerStartRadialDir);const _t=xt.lerp(S.rangerStartParallel,u3,nt),P=xt.lerp(_t,u3,ht),q=xt.lerp(S.rangerStartRadial,dY,nt);let L=xt.lerp(q,0,ht);L=xt.lerp(L,0,U),S.rangerTargetPosition.copy(S.dockPortWorld),S.rangerTargetPosition.addScaledVector(S.dockAxisWorld,P),S.rangerTargetPosition.addScaledVector(gu,L)}if(!S.approachStarted)i.position.copy(S.rangerInitialPosition),S.rangerVelocity.set(0,0,0);else{const _t=xt.lerp(5,9.8,ht),P=xt.lerp(4.6,7.4,ht);FY(i.position,S.rangerVelocity,S.rangerTargetPosition,B,_t,P)}Ag.setFromUnitVectors(v2,yu.copy(S.dockAxisWorld).negate()),m3.setFromAxisAngle(S.dockAxisWorld,S.rangerSpinAngle),i.quaternion.copy(m3).multiply(Ag),ht>.995&&i.position.lerp(S.rangerTargetPosition,xt.clamp(B*6,0,1)),U>.995&&(i.position.copy(S.rangerTargetPosition),S.rangerVelocity.set(0,0,0))}return{init({camera:B,renderer:z,root:tt,scene:j}){r=tt,t=new vt,t.name="scene10-group",tt.add(t),p=B.near,g=B.far,y=B.fov,B.near=Jj,B.far=hL,B.fov=Qj,B.updateProjectionMatrix(),j.background&&j.background.isColor?x=j.background.clone():x=null,j.background=Kj.clone(),u=new Ro(1712432,.2),c=new Fs(16773854,2.6),c.position.copy(uL).multiplyScalar(2e5),t.add(u,c,c.target),n=KY(),t.add(n.group),M(),e=PY(),t.add(e),T(B),f=B.position.clone(),d=dt=>{OY.has(dt.code)&&document.pointerLockElement===z?.domElement&&(dt.preventDefault(),dt.stopPropagation(),typeof dt.stopImmediatePropagation=="function"&&dt.stopImmediatePropagation())},window.addEventListener("keydown",d,!0),window.addEventListener("keyup",d,!0),s=IY(),i=qY(),a=VY(s.userData?.hullMaterial),t.add(s,i,a.group),v(),A(),F(),D(0)},update({camera:B,delta:z}){!n||!e||!s||!i||(f&&B.position.copy(f),M(),O(z),D(z),e.position.copy(B.position))},resize(){},dispose({camera:B,scene:z}){d&&(window.removeEventListener("keydown",d,!0),window.removeEventListener("keyup",d,!0),d=null),B.near=p,B.far=g,B.fov=y,B.updateProjectionMatrix(),z.background=x?x.clone():null,t&&(r&&t.parent!==r&&r.add(t),Li(t),t=null,e=null,n=null,s=null,i=null,a=null,S.ready=!1,c=null,u=null,f=null,r=null)}}}},y3="gargantua-slingshot",QY="Slingshot Around Gargantua",JY=30,Rg=new G(0,1.2,-72),tK=new G(0,4,40),eK="/textures/noise_deep.png",nK=132106,sK=.02,x3=new G(-7.5,3,-43),iK=16769965,rK=2.4,Eg=1,oK=.2,aK=new Set(["KeyW","KeyA","KeyS","KeyD","Space","ShiftLeft","ShiftRight"]),lK=Jn(([r,t])=>{const e=X(t).toVar(),n=Dt(r).toVar(),s=X(br(e)).toVar(),i=X(Xa(e)).toVar(),a=X(Xy(1,i)).toVar();return v$(a.mul(n.x).mul(n.x).add(i),a.mul(n.x).mul(n.y).sub(n.z.mul(s)),a.mul(n.z).mul(n.x).add(n.y.mul(s)),a.mul(n.x).mul(n.y).add(n.z.mul(s)),a.mul(n.y).mul(n.y).add(i),a.mul(n.y).mul(n.z).sub(n.x.mul(s)),a.mul(n.z).mul(n.x).sub(n.y.mul(s)),a.mul(n.y).mul(n.z).add(n.x.mul(s)),a.mul(n.z).mul(n.z).add(i))}).setLayout({name:"rotateAxis",type:"mat3",inputs:[{name:"axis",type:"vec3"},{name:"angle",type:"float"}]}),cK=Jn(([r])=>te(r.div(12.92),ei(w$(r,.055).div(1.055),Dt(2.4)),me(.04045,r))),uK=Jn(([r])=>{const t=r.mul(12.92),e=ei(r,Dt(1/2.4)).mul(1.055).sub(.055);return te(t,e,me(.0031308,r))}),b3=Jn(([r])=>r.r.mul(.2126).add(r.g.mul(.7152)).add(r.b.mul(.0722)).toVar()),S3=Jn(([r,t,e,n,s])=>hu(.5,hu(2,n).add(s.negate().add(e).mul(r)).add(hu(2,s).sub(hu(5,n)).add(hu(4,e)).sub(t).mul(r).mul(r)).add(s.negate().add(hu(3,n)).sub(hu(3,e)).add(t).mul(r).mul(r).mul(r))),{T:"float",D:"vec3",C:"vec3",B:"vec3",A:"vec3",return:"vec3"}),hK=Jn(([r,t,e,n])=>{const s=e.w.sub(t.w),i=n.w.sub(e.w),a=r.sub(t.w).div(s).saturate(),c=r.sub(e.w).div(i).saturate(),u=Dt(Xy(1,a),a.sub(c),c),d=S3(u.x,t.xyz,t.xyz,e.xyz,n.xyz),f=S3(u.y,t.xyz,e.xyz,n.xyz,n.xyz),p=n.xyz;return ad(r.lessThan(e.w),()=>d.xyz),ad(r.lessThan(n.w),()=>f.xyz),p.xyz},{T:"float",A:"vec4",B:"vec4",C:"vec4",return:"vec3"}),dK=r=>Bi(br(Ae(r,Hn(12.9898,78.233))).mul(43758.5453)),Jf=Jn(([r])=>r.x.mul(r.x).add(r.y.mul(r.y)).add(r.z.mul(r.z)).sqrt()),w3=Jn(([r,t,e,n,s])=>{const i=$o(r.sub(t).div(e.sub(t)),0,1),a=i.mul(i).mul(X(3).sub(i.mul(2)));return te(n,s,a)},{value:"float",inMin:"float",inMax:"float",outMin:"float",outMax:"float",return:"float"});function fK({noiseTexture:r,starsTexture:t,scale:e=5}){const n=new vt,s=new ke(1,16,16),i=new $s({side:En}),a={iterations:Me(X(128)),stepSize:Me(X(.0071)),noiseFactor:Me(X(.01)),power:Me(X(.3)),clamp1:Me(X(.5)),clamp2:Me(X(1)),originRadius:Me(X(.13)),width:Me(X(.03)),uvMotion:Me(X(0)),rampCol1:Me(Xe(1,.99,.95)),rampPos1:Me(X(.06)),rampCol2:Me(Xe(1,.82,.34)),rampPos2:Me(X(.33)),rampCol3:Me(Xe(.42,.16,.02)),rampPos3:Me(X(1)),rampEmission:Me(X(1.95)),emissionColor:Me(Xe(1,.72,.26))};i.colorNode=Jn(()=>{const u=a.stepSize,d=a.noiseFactor,f=a.power,p=a.originRadius,g=a.width,y=a.iterations,x=R$.mul(Dt(1,1,-1)).xzy,S=me(0,_$.negate()),T=Ar.mul(A$).mul(Dt(1,1,-1)).xzy,M=te(x,T.xyz,S),v=Fn(Xy(Ar,$u)).mul(Dt(1,1,-1)).xzy.negate().toVar(),A=dK(x.xy).mul(d),R=v.mul(A),F=M.sub(R).toVar(),D=Dt(0).toVar(),O=X(0).toVar();ll(y,()=>{const dt=Fn(F),wt=Jf(F),ft=u.mul(f).div(wt.mul(wt)),U=EE(wt,1,.5,0,1),K=dt.mul(ft.mul(U)),nt=v.sub(K).normalize(),ht=v.mul(u);F.addAssign(ht);const _t=Jf(F.mul(Dt(1,1,0))),P=_t.mul(4.27).sub(Lu.mul(.1)),q=Dt(0,0,1),I=F.mul(lK(q,P)).mul(2),H=Ap(r,I),W=g.negate(),at=Dt(W,0,g),rt=Xy(at,Dt(F.z)),et=rt.mul(rt).div(g),ct=ue(g.sub(et).div(g),0),st=H.mul(ct),Z=Jf(st),Q=I.mul(1.002),$=Ap(r,Q).mul(ct),mt=Jf($),yt=_t.add(Z.sub(.78).mul(1.5)).add(Z.sub(mt).mul(19.75)),Tt=gd(a.rampCol1,a.rampPos1),Mt=gd(a.rampCol2,a.rampPos2),Vt=gd(a.rampCol3,a.rampPos3),zt=hK(yt.x,Tt,Mt,Vt),kt=EE(mt,.35,1.2,.75,1.15),Qt=zt.mul(a.rampEmission.mul(kt)).add(a.emissionColor),Yt=Jf(F).lessThan(p),Ne=te(Qt,Dt(0),Yt),ce=ii(F.z),We=Z.sub(.75).mul(-.6),Sn=ce.add(We),vn=w3(_t,1,0,0,1),rs=w3(Sn,g,0,0,vn),zn=te(rs,1,Yt),be=O.oneMinus().mul(b3(zn)),Ze=te(D,Ne,be),An=te(O,1,b3(zn));F.addAssign(ht),v.assign(nt),D.assign(Ze),O.assign(An)});const B=v.mul(Dt(1,-1,1)).xzy,z=uK(Ap(t,T$(B)).mul(X(1))),tt=X(1).sub(O),j=te(D,z,tt.mul(1));return cK(j)})(),i.emissiveNode=i.colorNode,i.needsUpdate=!0;const c=new C(s,i);return c.scale.setScalar(e),c.frustumCulled=!1,n.add(c),{group:n,material:i,uniforms:a}}async function pK(){const t=await new Vw().loadAsync(eK);return t.wrapS=Bn,t.wrapT=Bn,t.needsUpdate=!0,t}function mK(r){let t=r>>>0;return()=>{t+=1831565813;let e=t;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}function gK({starCount:r=5200,baseRadius:t=4200,seed:e=296379127}={}){const n=mK(e),s=new Float32Array(r*3),i=new Float32Array(r*3),a=new Float32Array(r*3),c=Math.PI*2;for(let u=0;u<r;u+=1){const d=u*3,f=n()*2-1,p=n()*c,g=Math.sqrt(Math.max(0,1-f*f)),y=g*Math.cos(p),x=g*Math.sin(p);a[d]=y,a[d+1]=f,a[d+2]=x,s[d]=y*t,s[d+1]=f*t,s[d+2]=x*t;const S=.14+n()*(.98-.14),T=Math.pow(n(),1.1),M=xt.clamp(S*(.58+T*.72),.06,1),N=-.08+n()*.16;i[d]=xt.clamp(M+N*.5,.04,1),i[d+1]=xt.clamp(M+N*.15,.04,1),i[d+2]=xt.clamp(M-N*.45,.04,1)}return{colors:i,directions:a,positions:s,starCount:r}}function yK(r,{width:t=2048,height:e=1024}={}){const n=document.createElement("canvas");n.width=t,n.height=e;const s=n.getContext("2d");if(!s)throw new Error("Failed to create 2D context for static starfield texture.");s.fillStyle="#02040a",s.fillRect(0,0,t,e);const i=Math.PI*2;for(let c=0;c<r.starCount;c+=1){const u=c*3,d=r.directions[u],f=r.directions[u+1],p=r.directions[u+2],g=Math.atan2(p,d)/i+.5,y=Math.acos(xt.clamp(f,-1,1))/Math.PI,x=Math.floor(g*t)%t,S=Math.floor(y*e),T=Math.floor(xt.clamp(r.colors[u],0,1)*255),M=Math.floor(xt.clamp(r.colors[u+1],0,1)*255),N=Math.floor(xt.clamp(r.colors[u+2],0,1)*255),v=(r.colors[u]+r.colors[u+1]+r.colors[u+2])/3,A=xt.clamp(.35+v*.6,.3,.95);s.fillStyle=`rgba(${T}, ${M}, ${N}, ${A.toFixed(3)})`,s.fillRect(x,S,1,1)}const a=new bi(n);return a.mapping=Ky,a.colorSpace=fn,a.flipY=!1,a.needsUpdate=!0,a}function xK(r,t){r.layers.set(t),r.traverse(e=>{e.layers.set(t)})}function td(r,t,e){const n=new $s;return n.colorNode=Xe(r),n.roughnessNode=X(t),n.metalnessNode=X(e),n}function tp(r){const t=Math.sin(r+1)*43758.5453;return t-Math.floor(t)}function bK({matDarkHull:r,matSolarPanel:t,matTornFace:e,matWhiteHull:n}){const s=new vt,i=new C(new Y(8,7,5),n);i.position.set(0,0,-2.5),i.castShadow=!0,i.receiveShadow=!0,s.add(i);const a=new C(new Y(7.5,6.5,1),t);a.position.set(0,0,-4.6),a.castShadow=!0,s.add(a);const c=new C(new Y(8.2,2,2.5),r);c.position.set(0,0,-1.25),s.add(c);{const S=[],T=[],M=(A,R)=>A*15+R;for(let A=0;A<=16;A+=1)for(let R=0;R<=14;R+=1){const F=-4+A/16*8,D=-3.5+R/14*(3.5- -3.5);let O=.05;if(A>0&&A<16&&R>0&&R<14){const B=A*31+R*17,z=Math.sin(A*2.1+R*1.3)*1.1+Math.cos(A*4.7-R*2.9)*.7+(tp(B)-.5)*1.2;O=.05+Math.abs(z)}S.push(F,D,O)}for(let A=0;A<16;A+=1)for(let R=0;R<14;R+=1){const F=M(A,R),D=M(A+1,R),O=M(A+1,R+1),B=M(A,R+1);T.push(F,D,O,F,O,B)}const N=new Ye;N.setAttribute("position",new ge(S,3)),N.setIndex(T),N.computeVertexNormals();const v=new C(N,e);v.castShadow=!0,s.add(v)}const u=20;for(let d=0;d<u;d+=1){const p=d/(u-1)*Math.PI*2,g=Math.cos(p)*3.8,y=Math.sin(p)*3.3,x=tp(d*7),S=tp(d*7+1),T=tp(d*7+2),M=tp(d*7+3),N=.4+x*1.5,v=.3+S*1.2,A=.3+T*1,R=.1+M*1.5,F=new Y(N,v,A),D=new C(F,n);D.position.set(g,y,R),D.rotation.x=(x-.5)*1.5,D.rotation.y=(S-.5)*1.5,D.rotation.z=p+(T-.5)*.5,D.castShadow=!0,s.add(D)}return s}function SK(){const r=td(14540253,.4,.6),t=td(3355443,.5,.7),e=td(1118481,.15,.9),n=td(328965,.05,.8),s=td(2236962,.9,.3),i=td(1710618,.85,.45),a=new vt,c=32,u=12,d=4,f=5;for(let B=0;B<u;B+=1){const z=B/u*Math.PI*2,tt=Math.cos(z)*c,j=Math.sin(z)*c;if(B===d){const P=new vt,q=new C(new Y(8,7,1.2),s);q.castShadow=!0,P.add(q),[{w:.8,h:3,d:.35,x:2.4,y:1.8,z:.55,rx:.2,rz:.3},{w:.5,h:1.8,d:.3,x:-2.1,y:-2.2,z:.55,rx:-.1,rz:-.2},{w:.9,h:1.4,d:.35,x:2.7,y:-1.3,z:.5,rx:.25,rz:.35},{w:.4,h:2.3,d:.28,x:-2.9,y:1,z:.5,rx:-.15,rz:-.28},{w:.7,h:.9,d:.4,x:.3,y:2.7,z:.45,rx:.1,rz:.18}].forEach(I=>{const H=new C(new Y(I.w,I.h,I.d),s);H.position.set(I.x,I.y,I.z),H.rotation.set(I.rx,0,I.rz),H.castShadow=!0,P.add(H)}),P.position.set(tt,j,0),P.rotation.z=z+Math.PI/2,P.lookAt(0,0,0),a.add(P)}else if(B===f){const P=bK({matDarkHull:t,matSolarPanel:e,matTornFace:i,matWhiteHull:r});P.position.set(tt,j,0),P.rotation.z=z+Math.PI/2,P.lookAt(0,0,0),P.rotateY(Math.PI),a.add(P)}else{const P=new vt,q=new C(new Y(8,7,10),r);q.castShadow=!0,q.receiveShadow=!0,P.add(q);const L=new C(new Y(7.5,6.5,1),e);L.position.set(0,0,-4.6),L.castShadow=!0,L.receiveShadow=!0,P.add(L);const I=new C(new Y(8.2,2,4),t);I.position.set(0,0,1),P.add(I),P.position.set(tt,j,0),P.rotation.z=z+Math.PI/2,P.lookAt(0,0,0),a.add(P)}const dt=z+Math.PI/u,wt=Math.cos(dt)*c,ft=Math.sin(dt)*c,U=new vt;U.position.set(wt,ft,0),U.rotation.z=dt;const K=new C(new $t(2,2,9,32),r);K.castShadow=!0,K.receiveShadow=!0,U.add(K);const nt=new C(new $t(2.8,2.8,2.5,32),r);U.add(nt);const ht=new C(new $t(1.2,1.2,3.5,32),n);ht.rotation.z=Math.PI/2,U.add(ht);const _t=new C(new $t(1.5,1.5,3.2,32),t);_t.rotation.z=Math.PI/2,U.add(_t),a.add(U)}const p=c-5,g=new vt;g.position.set(0,p/2+2,0);const y=new C(new $t(2.5,2.5,p,32),r);y.castShadow=!0,y.receiveShadow=!0,g.add(y);for(let B=-1;B<=1;B+=1){const z=new C(new $t(3,3,2,32),t);z.position.y=B*(p/3),g.add(z)}a.add(g);const x=new C(new $t(4,4,3,32),r);x.rotation.x=Math.PI/2,x.castShadow=!0,x.receiveShadow=!0,a.add(x);const S=new C(new la(3,.5,16,64),t);S.position.z=1.5,a.add(S);const T=new vt;T.scale.set(2,2,2);const M=new pi(4.5,10,4);M.rotateY(Math.PI/4),M.rotateX(Math.PI/2),M.scale(1.1,.2,1),T.add(new C(M,r));const N=M.clone();N.scale(.98,.5,.98),N.translate(0,-.15,0),T.add(new C(N,t));const v=new C(new Y(2.2,.8,3.5),r);v.position.set(0,.4,0),v.rotation.x=Math.PI/16,v.castShadow=!0,T.add(v);const A=new C(new Y(1.8,.6,1.5),n);A.position.set(0,.7,1.2),A.rotation.x=Math.PI/6,T.add(A);const R=new Y(3.5,.2,4),F=new C(R,r);F.position.set(-2.8,0,-2.5),F.rotation.y=Math.PI/8,F.castShadow=!0,T.add(F);const D=new C(R,r);D.position.set(2.8,0,-2.5),D.rotation.y=-Math.PI/8,D.castShadow=!0,T.add(D);const O=new C(new Y(3,1,1.5),t);return O.position.set(0,-.1,-4.8),T.add(O),T.position.set(0,-5,3),T.rotateX(-300),a.add(T),a.rotation.x=-.5,a.rotation.y=-.3,a}const wK={id:y3,title:QY,create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null,f=null,p=null,g=null,y=!1;return{async init({root:x,scene:S,camera:T,renderer:M}){if(y=!1,a=x,d=T??null,r=new vt,r.name=`${y3}-group`,x.add(r),T&&(f=T.layers.mask,T.layers.enable(Eg),T.position.copy(Rg).add(tK),T.lookAt(Rg),g=T.position.clone()),c=S.background,u=S.environment,s=gK(),n=yK(s),S.background=n,S.environment=n,e=await pK(),y){e&&(e.dispose(),e=null);return}t=fK({noiseTexture:e,starsTexture:n,scale:JY}),t.group.position.copy(Rg),t.group.rotation.z=xt.degToRad(6),r.add(t.group),i=SK(),i.scale.setScalar(sK),i.position.copy(x3),xK(i,Eg),r.add(i);const N=new Cn;N.position.copy(x3),N.layers.set(Eg);const v=new Fs(iK,rK);v.position.copy(Rg),v.layers.set(Eg),v.target=N,r.add(v,N),p=A=>{aK.has(A.code)&&document.pointerLockElement===M?.domElement&&(A.preventDefault(),A.stopPropagation(),typeof A.stopImmediatePropagation=="function"&&A.stopImmediatePropagation())},window.addEventListener("keydown",p,!0),window.addEventListener("keyup",p,!0)},update({delta:x,camera:S}){i&&(g&&S&&S.position.copy(g),i.rotation.z+=x*oK)},resize(){},dispose({scene:x}){y=!0,p&&(window.removeEventListener("keydown",p,!0),window.removeEventListener("keyup",p,!0),p=null),x&&(x.background=c??new qt(nK),x.environment=u??null),d&&f!==null&&(d.layers.mask=f),r&&(a&&r.parent!==a&&a.add(r),Li(r)),e&&(e.dispose(),e=null),n&&(n.dispose(),n=null),t=null,i=null,s=null,r=null,a=null,c=null,u=null,d=null,f=null,g=null}}}},Vn=5.5,_n=7,Ns=60,A2=2.1,TK=new Set(["KeyW","KeyA","KeyS","KeyD","Space","ShiftLeft","ShiftRight"]),Cg=Math.PI/2-.05,T3=.001,_3=20,M3=34,v3=22,yo=2,qa=1,Wo=0,_K=_3*_3,MK=M3*M3,vK=v3*v3,ep=new G,$a=new G,Bg=new G,Dg=new ha;function Lg(r){const t=document.createElement("canvas"),e=1024,n=256;t.width=e,t.height=n;const s=t.getContext("2d");if(!s)return new ns;s.fillStyle="#050302",s.fillRect(0,0,e,n);let i=r||1;const a=()=>(i=(i*16807+11)%2147483647,(i&2147483647)/2147483647);let c=0;for(;c<e;){const d=.5+a()*3,f=.5+a()*2.5,p=a();let g=0,y=0,x=0;p>.93?(g=55+Math.floor(a()*55),y=32+Math.floor(a()*22),x=12+Math.floor(a()*12)):p>.6?(g=16+Math.floor(a()*22),y=10+Math.floor(a()*14),x=4+Math.floor(a()*8)):(g=2+Math.floor(a()*7),y=1+Math.floor(a()*5),x=Math.floor(a()*3)),s.fillStyle=`rgb(${g},${y},${x})`,s.fillRect(Math.floor(c),0,Math.ceil(f),n),c+=f+d}const u=new bi(t);return u.wrapS=Bn,u.wrapT=Bn,u.repeat.set(3,1),u}function A3(r){const t=document.createElement("canvas"),e=256,n=512;t.width=e,t.height=n;const s=t.getContext("2d");if(!s)return new ns;s.fillStyle="#040302",s.fillRect(0,0,e,n);let i=r||77;const a=()=>(i=(i*16807+11)%2147483647,(i&2147483647)/2147483647);let c=0;for(;c<n;){const d=.5+a()*3,f=.5+a()*2,p=a();let g=0,y=0,x=0;p>.88?(g=40+Math.floor(a()*35),y=24+Math.floor(a()*16),x=8+Math.floor(a()*10)):p>.5?(g=10+Math.floor(a()*16),y=7+Math.floor(a()*10),x=3+Math.floor(a()*6)):(g=2+Math.floor(a()*5),y=1+Math.floor(a()*3),x=Math.floor(a()*2)),s.fillStyle=`rgb(${g},${y},${x})`,s.fillRect(0,Math.floor(c),e,Math.ceil(f)),c+=f+d}const u=new bi(t);return u.wrapS=Bn,u.wrapT=Bn,u.repeat.set(1,2),u}function xu(r){return new gt({color:r||1118481,metalness:.85,roughness:.4})}function AK(){const r=new vt,t=new gt({color:12369084,roughness:.5,metalness:.15}),e=new gt({color:8947848,roughness:.5,metalness:.2}),n=new gt({color:4473924,roughness:.6,metalness:.3}),s=new gt({color:1719644,roughness:.05,metalness:.9}),i=new gt({color:13404245,roughness:.9}),a=new gt({color:2763306,roughness:.7,metalness:.3}),c=new gt({color:3815994,roughness:.6,metalness:.4});function u(x,S,T,M,N,v,A,R,F,D){const O=new C(new Y(x,S,T),M);return O.position.set(N||0,v||0,A||0),O}const d=new vt;d.add(u(.52,.52,.52,t)),d.add(u(.42,.32,.06,s,0,.02,.28)),d.add(u(.38,.28,.04,i,0,.02,.24)),d.add(u(.54,.06,.06,e,0,.22,0)),d.add(u(.54,.06,.06,e,0,-.1,0)),d.position.set(0,1.82,0),r.add(d),r.add(u(.28,.1,.28,n,0,1.48,0)),r.add(u(.52,.8,.32,t,0,1.1,0)),r.add(u(.28,.22,.03,n,0,1.22,.18));for(let x=0;x<3;x+=1)r.add(u(.04,.04,.025,e,-.08+x*.08,1.28,.195));r.add(u(.54,.05,.34,n,0,1.4,0)),r.add(u(.54,.06,.34,n,0,.72,0)),r.add(u(.44,.65,.22,c,0,1.1,-.27)),r.add(u(.18,.45,.05,n,.06,1.15,-.4)),r.add(u(.06,.06,.06,n,.06,1.35,-.42));const f=new vt;f.add(u(.22,.68,.22,t)),f.add(u(.2,.18,.22,a,0,-.43,0)),f.position.set(-.42,1.18,0),f.rotation.z=.55,f.rotation.x=-.9,r.add(f);const p=new vt;p.add(u(.22,.68,.22,t)),p.add(u(.2,.18,.22,a,0,-.43,0)),p.position.set(.42,1.22,0),p.rotation.z=-.3,p.rotation.x=-.7,r.add(p);const g=new vt;g.add(u(.22,.72,.22,t)),g.add(u(.24,.18,.3,a,0,-.45,.03)),g.position.set(-.14,.34,0),g.rotation.x=.18,r.add(g);const y=new vt;return y.add(u(.22,.72,.22,t)),y.add(u(.24,.18,.3,a,0,-.45,.03)),y.position.set(.14,.34,0),y.rotation.x=-.12,r.add(y),r.scale.setScalar(1.3),r}const NK={id:"tesseract-bookshelf",title:"Tesseract Bookshelf Sequence",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=null;const f={pitch:0,radius:0,yaw:0};return{init({root:p,camera:g,renderer:y,scene:x}){i=x.background,a=x.fog,c=y.toneMappingExposure,x.background=new qt(0),x.fog=new zu(0,.018),y.toneMappingExposure=.55,g.fov=58,g.near=.05,g.far=300,g.position.set(0,5.5,6),g.lookAt(.5,3.5,0),g.updateProjectionMatrix(),r=new vt,r.name="scene-12-tesseract",p.add(r);const S=[Lg(1),Lg(42),Lg(137),Lg(999)],T=[A3(7),A3(53)],M=S.map(H=>new gt({map:H,emissiveMap:H,emissive:new qt(.7,.4,.18),roughness:.95,metalness:0})),N=S.map(H=>{const W=H.clone();return W.rotation=Math.PI/2,W.center.set(.5,.5),new gt({map:W,emissiveMap:W,emissive:new qt(.7,.4,.18),roughness:.95,metalness:0})}),v=T.map(H=>new gt({map:H,emissiveMap:H,emissive:new qt(.55,.3,.12),roughness:.9,metalness:.05})),A=new gt({color:3346944,emissive:new qt(.25,.09,.01),roughness:.9}),R=new $e({color:new qt(.35,.85,1.2)}),F=new $e({color:new qt(1.2,.45,.05)}),D=new $e({color:new qt(.6,.25,.02)}),O=g.position.clone(),B=(H,W,at)=>{Bg.set(H,W,at);const rt=O.distanceToSquared(Bg);return rt>MK?Wo:rt>_K?qa:yo},z=xu(592137),tt=xu(460551);let j=0;const dt=(H,W,at,rt="high")=>{const et=new vt,ct=rt==="low",st=.35,Z=at?N:M,Q=Z[j%Z.length],$=v[j%v.length];j+=1;const mt=new C(new Y(H,W,.04),Q);if(mt.position.z=st*.5,et.add(mt),!ct){const zt=new C(new Y(H*.96,W*.96,.005),A);zt.position.z=st*.5-.025,et.add(zt)}const yt=ct?Math.max(2,Math.round(W/1.35)):Math.max(3,Math.round(W/.45));for(let zt=0;zt<=yt;zt+=1){const kt=-W/2+W/yt*zt,Qt=new C(new Y(H,ct?.024:.028,st),$);Qt.position.set(0,kt,0),et.add(Qt)}const Tt=ct?Math.max(1,Math.round(H/2.25)):Math.max(2,Math.round(H/.75));for(let zt=0;zt<=Tt;zt+=1){const kt=-H/2+H/Tt*zt,Qt=new C(new Y(ct?.016:.02,W,st),z);Qt.position.set(kt,0,0),et.add(Qt)}if(!ct){const zt=new C(new Y(st,W,.025),$);zt.position.set(-H/2,0,0),et.add(zt);const kt=new C(new Y(st,W,.025),$);kt.position.set(H/2,0,0),et.add(kt)}const Mt=ct?.045:.055,Vt=ct?[[0,W/2+Mt/2,0,H+Mt*1.6,Mt,st+.02],[0,-W/2-Mt/2,0,H+Mt*1.6,Mt,st+.02]]:[[0,W/2+Mt/2,0,H+Mt*2,Mt,st+.04],[0,-W/2-Mt/2,0,H+Mt*2,Mt,st+.04],[-H/2-Mt/2,0,0,Mt,W,st+.04],[H/2+Mt/2,0,0,Mt,W,st+.04]];for(const[zt,kt,Qt,ie,Yt,Ne]of Vt){const ce=new C(new Y(ie,Yt,Ne),tt);ce.position.set(zt,kt,Qt),et.add(ce)}return et},wt=new vt;r.add(wt),t=new vt,t.name="scene-12-tesseract-static",wt.add(t);const ft=({width:H,height:W,rotated:at,x:rt,y:et,z:ct,rotationX:st,rotationY:Z})=>{const Q=B(rt,et,ct);if(Q===Wo)return;const $=dt(H,W,at,Q===yo?"high":"low");$.position.set(rt,et,ct),typeof st=="number"&&($.rotation.x=st),typeof Z=="number"&&($.rotation.y=Z),t.add($)};for(let H=-Ns;H<=Ns;H+=A2){const at=A2*.95,rt=[[-Vn,1.5,Math.PI/2],[Vn,1.5,-Math.PI/2]];for(const[ct,st,Z]of rt)ft({width:at,height:3.4,rotated:!0,x:ct,y:st,z:H,rotationY:Z});const et=[[0,_n,Math.PI/2],[0,-_n+2,-Math.PI/2]];for(const[ct,st,Z]of et)ft({width:at,height:3.4*.85,rotated:!1,x:ct,y:st,z:H,rotationX:Z})}for(let H=1;H<=4;H+=1){const W=H*2.8,at=A2*(1+H*.08);for(let rt=-Ns;rt<=Ns;rt+=at){const et=3.8+H*.3,ct=at*.93,st=[[-Vn-W,1.5,Math.PI/2],[Vn+W,1.5,-Math.PI/2]];for(const[Q,$,mt]of st)ft({width:ct,height:et,rotated:!0,x:Q,y:$,z:rt,rotationY:mt});const Z=[[0,_n+W,Math.PI/2],[0,-_n+2-W,-Math.PI/2]];for(const[Q,$,mt]of Z)ft({width:ct,height:et*.8,rotated:!1,x:Q,y:$,z:rt,rotationX:mt})}}const U=()=>{const H=new vt,W=xu(394756);for(let at=0;at<4;at+=1){const rt=at*2.8,ct=(at+1)*2.8-rt;let st=0;for(let Z=-Ns;Z<=Ns;Z+=1.6,st+=1){let Q=0;for(let $=-1.5;$<=1.8;$+=.7,Q+=1){const mt=1.5+$,yt=B(0,mt,Z);if(yt===Wo||yt===qa&&(st+Q+at)%2===1)continue;const Tt=yt===yo?.025:.018,Mt=new C(new Y(ct,Tt,Tt),W);Mt.position.set(-Vn-rt-ct/2,mt,Z),H.add(Mt);const Vt=new C(new Y(ct,Tt,Tt),W);Vt.position.set(Vn+rt+ct/2,mt,Z),H.add(Vt)}}st=0;for(let Z=-Ns;Z<=Ns;Z+=2,st+=1){let Q=0;for(let $=-2;$<=2;$+=.8,Q+=1){const mt=B($,_n+rt,Z);if(mt===Wo||mt===qa&&(st+Q+at)%2===1)continue;const yt=mt===yo?.025:.018,Tt=new C(new Y(yt,ct,yt),W);Tt.position.set($,_n+rt+ct/2,Z),H.add(Tt);const Mt=new C(new Y(yt,ct,yt),W);Mt.position.set($,-_n+2-rt-ct/2,Z),H.add(Mt)}}}return H};t.add(U());const K=()=>{const H=new vt,W=xu(394758),at=xu(526344),rt=xu(460551),et=xu(657930);let ct=0;for(let Z=-Ns;Z<=Ns;Z+=4.5,ct+=1)for(const Q of[-Vn-.2,Vn+.2]){const $=B(Q,1.5,Z);if($===Wo||$===qa&&ct%2===1)continue;const mt=new vt;if(mt.add(new C(new Y(.05,_n*2+4,$===yo?.15:.12),W)),$===yo)for(const yt of[-_n-1.5,_n+1.5]){const Tt=new C(new Y(.22,.05,.22),W);Tt.position.y=yt,mt.add(Tt)}mt.position.set(Q,1.5,Z),H.add(mt)}ct=0;for(let Z=-Ns;Z<=Ns;Z+=5.5,ct+=1){let Q=0;for(let $=-_n+2;$<=_n;$+=3.2,Q+=1){const mt=B(0,$,Z);if(mt===Wo||mt===qa&&(ct+Q)%2===1)continue;const yt=mt===yo?.045:.03,Tt=new C(new Y(Vn*2+1,yt,yt),at);Tt.position.set(0,$,Z),H.add(Tt)}}const st=[[-Vn,_n],[Vn,_n],[-Vn,-_n+2],[Vn,-_n+2]];for(const[Z,Q]of st){const $=new C(new Y(.06,.06,Ns*2),rt);$.position.set(Z,Q,0),H.add($)}ct=0;for(let Z=-Ns;Z<=Ns;Z+=4,ct+=1){const Q=B(Vn+4.5,2,Z);if(Q===Wo||Q===qa&&ct%2===1)continue;const $=new vt,mt=3.5,yt=5,Tt=[[0,yt/2,mt,.06],[0,-yt/2,mt,.06],[-mt/2,0,.06,yt],[mt/2,0,.06,yt]];for(const[Mt,Vt,zt,kt]of Tt){const Qt=new C(new Y(zt,kt,.06),et);Qt.position.set(Mt,Vt,0),$.add(Qt)}if(Q===yo){const Mt=new C(new Y(.04,Math.sqrt(mt*mt+yt*yt),.04),et);Mt.rotation.z=Math.atan2(yt,mt),$.add(Mt)}$.position.set(Vn+4.5,2,Z),$.rotation.y=-Math.PI/2,H.add($)}return H};t.add(K());const nt=()=>{const H=new vt,W=[new $e({color:new qt(.62,.2,.03)}),new $e({color:new qt(.88,.32,.06)}),new $e({color:new qt(1,.42,.09)})],at=[new $e({color:new qt(.08,.25,.52)}),new $e({color:new qt(.1,.38,.68)}),new $e({color:new qt(.15,.5,.82)})];let rt=0;for(let et=-Ns;et<=Ns;et+=.9,rt+=1){const ct=B(0,_n+.3,et);if(ct===Wo||ct===qa&&rt%3!==0)continue;const st=.78+Math.random()*.18,Z=ct===yo?.025:.018,Q=new C(new Y(st,Z,.02),R);Q.position.set(-Vn*.2,_n+.3,et),H.add(Q);const $=Q.clone();$.position.set(Vn*.15,_n+.28,et),H.add($)}rt=0;for(let et=-Ns;et<=Ns;et+=1.4,rt+=1){const ct=B(0,-_n+2.4,et);if(ct===Wo||ct===qa&&rt%2===1)continue;const st=ct===yo?.02:.016,Z=ct===yo?1.3:.95,Q=new C(new Y(st,st,Z),F);Q.position.set(-Vn+.2,-_n+2.4,et),H.add(Q);const $=new C(new Y(st,st,Z),D);$.position.set(Vn-.2,-_n+2.4,et),H.add($)}for(let et=0;et<72;et+=1){const st=Math.random()>.3?W:at,Z=st[Math.floor(Math.random()*st.length)],Q=Math.floor(Math.random()*4),$=(Math.random()-.5)*Ns*1.35,mt=.45+Math.random()*1.65;let yt=null;Q<2?(yt=new C(new Y(.01,mt,.01),Z),yt.position.set(Q===0?-Vn-Math.random()*10:Vn+Math.random()*10,Math.random()*(_n*2)-_n+2,$)):(yt=new C(new Y(mt,.01,.01),Z),yt.position.set((Math.random()-.5)*Vn*2,Q===2?_n+Math.random()*10:-_n+2-Math.random()*10,$));const Tt=B(yt.position.x,yt.position.y,yt.position.z);Tt!==Wo&&(Tt===qa&&et%2===1||H.add(yt))}return H};t.add(nt()),e=AK(),e.position.set(.4,2.5,2.5),e.rotation.y=-.35,e.rotation.z=.12,e.rotation.x=-.08,wt.add(e),Dg.setFromObject(e),Dg.getCenter(ep),$a.copy(g.position).sub(ep),f.radius=Math.max($a.length(),T3),f.yaw=Math.atan2($a.x,$a.z),f.pitch=xt.clamp(Math.atan2($a.y,Math.max(Math.hypot($a.x,$a.z),T3)),-Cg,Cg),u=H=>{TK.has(H.code)&&document.pointerLockElement===y?.domElement&&(H.preventDefault(),H.stopPropagation(),typeof H.stopImmediatePropagation=="function"&&H.stopImmediatePropagation())},window.addEventListener("keydown",u,!0),d=H=>{document.pointerLockElement===y?.domElement&&(H.preventDefault(),H.stopPropagation(),typeof H.stopImmediatePropagation=="function"&&H.stopImmediatePropagation(),f.yaw-=H.movementX*.0022,f.pitch=xt.clamp(f.pitch+H.movementY*.0018,-Cg,Cg))},window.addEventListener("mousemove",d,!0),t.add(new Ro(526360,.4)),n=new ls(16772829,12,22),n.position.set(.5,7,3),wt.add(n);const ht=new ls(3364266,5,18);ht.position.set(-5,-1,2),t.add(ht);const _t=new ls(16772795,8,15);_t.position.set(-1.5,4,-5),t.add(_t);const P=new ls(4500223,6,30);P.position.set(-1,_n+2,-3),t.add(P);const q=new ls(16742195,4,20);q.position.set(-Vn+1,2,3),t.add(q);const L=new ls(16737809,3,18);L.position.set(Vn-1,1,-2),t.add(L);const I=new ax(16777215,15,25,Math.PI/7,.6,1.5);I.position.set(.5,9,3),I.target=e,t.add(I);for(let H=0;H<20;H+=1){const W=Math.random()>.4,at=new ls(W?new qt(.9,.4+Math.random()*.3,.05):new qt(.1,.3+Math.random()*.3,.8),.8+Math.random()*2.5,10+Math.random()*12);at.position.set((Math.random()-.5)*22,Math.random()*14-3,(Math.random()-.5)*40),Bg.copy(at.position),!(O.distanceToSquared(Bg)>vK)&&t.add(at)}t.updateMatrixWorld(!0),t.traverse(H=>{H.matrixAutoUpdate=!1,H.updateMatrix()}),s=null},update({camera:p,elapsed:g}){if(!p||!e||!n)return;s===null&&(s=g);const y=g-s;e.position.y=2.5+Math.sin(y*.38)*.28,e.rotation.z=.12+Math.sin(y*.27)*.04,e.rotation.x=-.08+Math.cos(y*.22)*.025,n.position.x=.5+Math.sin(y*.17)*.6,Dg.setFromObject(e),Dg.getCenter(ep);const x=Math.cos(f.pitch)*f.radius;$a.set(Math.sin(f.yaw)*x,Math.sin(f.pitch)*f.radius,Math.cos(f.yaw)*x),p.position.copy(ep).add($a),p.lookAt(ep)},resize(){},dispose({scene:p,renderer:g}){u&&(window.removeEventListener("keydown",u,!0),u=null),d&&(window.removeEventListener("mousemove",d,!0),d=null),r&&Li(r),r=null,t=null,e=null,n=null,s=null,f.radius=0,f.yaw=0,f.pitch=0,p&&(p.background=i,p.fog=a),g&&c!==null&&(g.toneMappingExposure=c),i=null,a=null,c=null}}}},tn=800,M_=4e3,Gn=M_*2,RK=M_/2,EK=128,CK=64,BK=60,N2=13946557,DK=.03,N3=new G(0,-600,-M_*.35),LK=new G(0,-800,0);function gs(r){let t=r;return()=>(t=(t*16807+0)%2147483647,(t-1)/2147483646)}const OK={id:"cooper-station-reunion",title:"Cooper Station Reunion",create(){let r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=0;function f(L,I,H){const W=document.createElement("canvas");W.width=L,W.height=I;const at=W.getContext("2d");H(at,L,I);const rt=new bi(W);return rt.wrapS=rt.wrapT=Bn,rt}function p(){return f(2048,2048,(L,I,H)=>{const W=gs(123),at=8,rt=I/at,et=H/at;L.fillStyle="#4a7a2e",L.fillRect(0,0,I,H);for(let Z=0;Z<H;Z+=8)for(let Q=0;Q<I;Q+=8){const $=100+Math.sin(Q*.01)*10+(W()-.5)*20,mt=50+(W()-.5)*12;L.fillStyle=`rgb(${Math.floor(mt)},${Math.floor($)},${Math.floor(mt*.55)})`,L.fillRect(Q,Z,8,8)}const ct=["#5a8a3e","#3d6b22","#7a9a4e","#8b7d3a","#6b8a2e","#4e7528","#9a8844","#c4a94e","#6a9038","#557722","#b8a050","#7d8830","#a09040","#88a048"];for(let Z=0;Z<at;Z++)for(let Q=0;Q<at;Q++){const $=1+Math.floor(W()*3);for(let mt=0;mt<$;mt++){const yt=15+W()*10,Tt=Q*rt+yt+W()*(rt*.15),Mt=Z*et+yt+W()*(et*.15),Vt=rt*(.3+W()*.5)-yt,zt=et*(.3+W()*.5)-yt;if(L.fillStyle=ct[Math.floor(W()*ct.length)],L.beginPath(),L.moveTo(Tt+W()*8,Mt+W()*8),L.lineTo(Tt+Vt+W()*8-4,Mt+W()*8-4),L.lineTo(Tt+Vt+W()*8,Mt+zt+W()*8),L.lineTo(Tt+W()*8-4,Mt+zt+W()*8-4),L.closePath(),L.fill(),W()>.3){L.save(),L.clip(),L.strokeStyle="rgba(0,0,0,0.07)",L.lineWidth=1;const kt=W()>.5,Qt=3+W()*3;for(let ie=0;ie<Math.max(Vt,zt)*1.5;ie+=Qt)L.beginPath(),kt?(L.moveTo(Tt+ie+Math.sin(ie*.1)*2,Mt-10),L.lineTo(Tt+ie+Math.sin(ie*.1+1)*2,Mt+zt+10)):(L.moveTo(Tt-10,Mt+ie+Math.sin(ie*.1)*2),L.lineTo(Tt+Vt+10,Mt+ie+Math.sin(ie*.1+1)*2)),L.stroke();L.restore()}}}L.lineCap="round";for(let Z=1;Z<at;Z++){const Q=Z*rt;L.strokeStyle="#555555",L.lineWidth=6+W()*3,L.beginPath(),L.moveTo(Q+(W()-.5)*15,0);for(let $=0;$<=H;$+=H/8)L.lineTo(Q+(W()-.5)*20,$);L.stroke(),L.strokeStyle="#888877",L.lineWidth=1,L.setLineDash([5,7]),L.beginPath(),L.moveTo(Q+(W()-.5)*8,0);for(let $=0;$<=H;$+=H/8)L.lineTo(Q+(W()-.5)*10,$);L.stroke(),L.setLineDash([])}for(let Z=1;Z<at;Z++){const Q=Z*et;L.strokeStyle="#555555",L.lineWidth=5+W()*3,L.beginPath(),L.moveTo(0,Q+(W()-.5)*15);for(let $=0;$<=I;$+=I/8)L.lineTo($,Q+(W()-.5)*20);L.stroke()}for(let Z=0;Z<10;Z++){const Q=W()*I,$=W()*H,mt=Q+(W()-.5)*rt*2,yt=$+(W()-.5)*et*2;L.strokeStyle="#666",L.lineWidth=3+W()*2,L.beginPath(),L.moveTo(Q,$),L.quadraticCurveTo(Q+(W()-.5)*80,$+(W()-.5)*80,mt,yt),L.stroke()}const st=["#c8b898","#b8a888","#d4c4a4","#a89878","#e0d0b0","#988868","#fff8f0","#e8e0d0","#8b7355","#ccbbaa"];for(let Z=0;Z<at;Z++)for(let Q=0;Q<at;Q++){if(W()>.55)continue;const $=Q*rt+rt*(.3+W()*.4),mt=Z*et+et*(.3+W()*.4),yt=3+Math.floor(W()*12);for(let Tt=0;Tt<yt;Tt++){const Mt=$+(W()-.5)*rt*.5,Vt=mt+(W()-.5)*et*.5,zt=6+W()*10,kt=6+W()*10;L.save(),L.translate(Mt,Vt),L.rotate((W()-.5)*.25),L.fillStyle=st[Math.floor(W()*st.length)],L.fillRect(-zt/2,-kt/2,zt,kt),L.fillStyle="rgba(0,0,0,0.15)",L.fillRect(-zt/2,-kt/2,zt,3),L.restore()}}for(let Z=0;Z<12;Z++){const Q=(Math.floor(W()*at)+.5)*rt+(W()-.5)*30,$=(Math.floor(W()*at)+.5)*et+(W()-.5)*30,mt=15+W()*30;L.fillStyle=`rgba(${25+W()*15},${90+W()*50},${25+W()*15},0.75)`,L.beginPath();const yt=5+Math.floor(W()*4);for(let Tt=0;Tt<yt;Tt++){const Mt=Tt/yt*Math.PI*2,Vt=mt*(.7+W()*.5);Tt===0?L.moveTo(Q+Math.cos(Mt)*Vt,$+Math.sin(Mt)*Vt):L.lineTo(Q+Math.cos(Mt)*Vt,$+Math.sin(Mt)*Vt)}L.closePath(),L.fill()}for(let Z=0;Z<1e3;Z++){const Q=W()*I,$=W()*H,mt=1.5+W()*4;L.fillStyle=`rgb(${15+W()*35},${45+W()*65},${10+W()*25})`,L.beginPath(),L.arc(Q,$,mt,0,Math.PI*2),L.fill()}for(let Z=0;Z<6;Z++){const Q=W()*I,$=W()*H;L.fillStyle=`rgba(${30+W()*15},${65+W()*25},${115+W()*35},0.6)`,L.beginPath(),L.ellipse(Q,$,12+W()*25,8+W()*18,W()*Math.PI,0,Math.PI*2),L.fill()}for(let Z=0;Z<10;Z++){L.strokeStyle=`rgba(${135+W()*25},${115+W()*20},${75+W()*20},0.4)`,L.lineWidth=2+W()*1.5,L.beginPath();let Q=W()*I,$=W()*H;L.moveTo(Q,$);for(let mt=0;mt<3+W()*3;mt++)Q+=(W()-.5)*120,$+=(W()-.5)*120,L.lineTo(Q,$);L.stroke()}})}function g(){return f(1024,1024,(L,I,H)=>{L.fillStyle="#8080ff",L.fillRect(0,0,I,H);const W=gs(789);for(let at=0;at<2e3;at++){const rt=W()*I,et=W()*H,ct=1+W()*4,st=100+W()*60;L.fillStyle=`rgb(${st},${st},255)`,L.beginPath(),L.arc(rt,et,ct,0,Math.PI*2),L.fill()}})}function y(L,I,H){const W=f(L,L,(at,rt,et)=>{const ct=rt*.5,st=et*.5,Z=at.createRadialGradient(ct,st,0,ct,st,rt*.5);for(const[Q,$]of H)Z.addColorStop(Q,`rgba(${I.r}, ${I.g}, ${I.b}, ${$})`);at.fillStyle=Z,at.fillRect(0,0,rt,et)});return W.wrapS=W.wrapT=ji,W.colorSpace=fn,W}function x(){const L=new $t(tn,tn,Gn,EK,CK,!0),I=p();I.repeat.set(12,6),I.colorSpace=fn;const H=g();H.repeat.set(12,6);const W=new gt({map:I,normalMap:H,normalScale:new Ot(.3,.3),roughness:.85,metalness:0,side:us}),at=new C(L,W);return at.rotation.x=Math.PI/2,at.receiveShadow=!0,s.add(at),at}function S(){const L=new vt,I={r:255,g:247,b:232},H=y(1024,I,[[0,1],[.2,.92],[.5,.45],[.85,.08],[1,0]]),W=y(1024,I,[[0,.72],[.28,.42],[.65,.14],[1,0]]);for(let at=-1;at<=1;at+=2){const rt=at*Gn/2,et=new qi(tn*.75,96),ct=new $e({color:16777215,side:En,toneMapped:!1}),st=new C(et,ct);st.position.z=rt,L.add(st);const Z=new qi(tn*1.6,96),Q=new $e({map:H,color:16774888,transparent:!0,opacity:.95,side:En,depthWrite:!1,depthTest:!1,blending:Sr,toneMapped:!1}),$=new C(Z,Q);$.position.z=rt-at*20,L.add($);const mt=new qi(tn*2.3,96),yt=new $e({map:W,color:16049609,transparent:!0,opacity:.62,side:En,depthWrite:!1,depthTest:!1,blending:Sr,toneMapped:!1}),Tt=new C(mt,yt);Tt.position.z=rt-at*95,L.add(Tt);const Mt=new qi(tn*3.1,96),Vt=new $e({map:W,color:15653816,transparent:!0,opacity:.35,side:En,depthWrite:!1,depthTest:!1,blending:Sr,toneMapped:!1}),zt=new C(Mt,Vt);zt.position.z=rt-at*220,L.add(zt)}return s.add(L),L}function T(){const L=new vt,I=gs(555),H=[new gt({color:13154456,roughness:.8}),new gt({color:12101768,roughness:.8}),new gt({color:13943972,roughness:.8}),new gt({color:15260864,roughness:.8}),new gt({color:10522752,roughness:.8}),new gt({color:16777215,roughness:.7}),new gt({color:9127187,roughness:.9})],W=[new gt({color:6702131,roughness:.9}),new gt({color:5592405,roughness:.7,metalness:.2}),new gt({color:8930338,roughness:.85}),new gt({color:3355443,roughness:.6,metalness:.3})],at=[];for(let rt=0;rt<BK;rt++)at.push({angle:I()*Math.PI*2,z:(I()-.5)*Gn*.85,spread:50+I()*100,count:10+Math.floor(I()*25)});for(const rt of at)for(let et=0;et<rt.count;et++){const ct=rt.angle+(I()-.5)*rt.spread/tn,st=rt.z+(I()-.5)*rt.spread*2,Z=Math.cos(ct)*(tn-5),Q=Math.sin(ct)*(tn-5),$=12+I()*14,mt=7+I()*8,yt=12+I()*14,Tt=new Y($,mt,yt),Mt=new C(Tt,H[Math.floor(I()*H.length)]);Mt.castShadow=!0;const Vt=new pi(Math.max($,yt)*.7,4+I()*4,4),zt=new C(Vt,W[Math.floor(I()*W.length)]);zt.position.y=mt/2+2,zt.rotation.y=Math.PI/4;const kt=new vt;kt.add(Mt),kt.add(zt),kt.position.set(Z,Q,st),kt.lookAt(0,0,st),kt.rotateX(Math.PI/2),L.add(kt)}return s.add(L),L}function M(){const L=new vt,I=gs(777),H=new $t(.3,.5,4,5),W=new gt({color:7029286,roughness:.95}),at=[new gt({color:2976542,roughness:.9}),new gt({color:3832360,roughness:.9}),new gt({color:1989140,roughness:.9}),new gt({color:4885054,roughness:.9})];for(let rt=0;rt<600;rt++){const et=I()*Math.PI*2,ct=(I()-.5)*Gn*.85,st=Math.cos(et)*(tn-3),Z=Math.sin(et)*(tn-3),Q=new vt,$=new C(H,W);Q.add($);const mt=I();if(mt<.5){const Tt=2+I()*3,Mt=new ke(Tt,6,5),Vt=new C(Mt,at[Math.floor(I()*at.length)]);Vt.position.y=3+Tt*.6,Q.add(Vt)}else if(mt<.8){const Tt=2+I()*2,Mt=new pi(Tt,Tt*2.5,6),Vt=new C(Mt,at[Math.floor(I()*at.length)]);Vt.position.y=3+Tt,Q.add(Vt)}else for(let Tt=0;Tt<3;Tt++){const Mt=1.5+I()*1.5,Vt=new ke(Mt,5,4),zt=new C(Vt,at[Math.floor(I()*at.length)]);zt.position.set((I()-.5)*2,3+Tt*1.8,(I()-.5)*2),Q.add(zt)}Q.position.set(st,Z,ct),Q.lookAt(0,0,ct),Q.rotateX(Math.PI/2);const yt=.7+I()*.6;Q.scale.set(yt,yt,yt),L.add(Q)}return s.add(L),L}function N(){const L=new vt,I=new gt({color:9136970,roughness:.9}),H=gs(333);for(let W=0;W<40;W++){const at=H()*Math.PI*2,rt=(H()-.5)*Gn*.8,et=20+H()*60,ct=new Y(et,2,.3),st=new C(ct,I),Z=Math.cos(at)*(tn-2),Q=Math.sin(at)*(tn-2);st.position.set(Z,Q,rt),st.lookAt(0,0,rt),st.rotateX(Math.PI/2),L.add(st)}s.add(L)}function v(){const L=new vt,I=gs(999),H=new gt({color:13386820,metalness:.5,roughness:.4}),W=new gt({color:4491468,metalness:.5,roughness:.4}),at=new gt({color:4500036,roughness:.7});for(let rt=0;rt<10;rt++){const et=I()*Math.PI*2,ct=(I()-.5)*Gn*.7,st=new vt,Z=new Y(.3,5,8),Q=new C(Z,H);Q.position.set(-3,2.5,0);const $=new C(Z,H);$.position.set(3,2.5,0),st.add(Q,$);const mt=new C(new Y(6.5,.3,.3),H);mt.position.y=5,st.add(mt);const yt=new Y(2,.1,6),Tt=new C(yt,W);Tt.position.set(8,2,0),Tt.rotation.x=-.3,st.add(Tt);const Mt=new qi(12,16),Vt=new C(Mt,at);Vt.rotation.x=-Math.PI/2,Vt.position.y=-.1,st.add(Vt);const zt=Math.cos(et)*(tn-3),kt=Math.sin(et)*(tn-3);st.position.set(zt,kt,ct),st.lookAt(0,0,ct),st.rotateX(Math.PI/2),st.scale.setScalar(.8),L.add(st)}s.add(L)}function A(){const L=new vt,I=gs(1234),H=new gt({color:12096874,roughness:.95}),W=new gt({color:16777215,roughness:.6});for(let at=0;at<5;at++){const rt=I()*Math.PI*2,et=(I()-.5)*Gn*.7,ct=new vt,st=new qi(20,4),Z=new C(st,H);Z.rotation.x=-Math.PI/2,Z.rotation.z=Math.PI/4,ct.add(Z);for(let mt=0;mt<4;mt++){const yt=mt/4*Math.PI*2+Math.PI/4,Tt=new Y(.3,.05,20),Mt=new C(Tt,W);Mt.position.set(Math.cos(yt)*10,.05,Math.sin(yt)*10),Mt.rotation.y=yt,ct.add(Mt)}const Q=Math.cos(rt)*(tn-2),$=Math.sin(rt)*(tn-2);ct.position.set(Q,$,et),ct.lookAt(0,0,et),ct.rotateX(Math.PI/2),L.add(ct)}s.add(L)}function R(){const L=new Ye,I=2e3,H=new Float32Array(I*3),W=gs(8888);for(let et=0;et<I;et++){const ct=W()*Math.PI*2,st=100+W()*(tn-150);H[et*3]=Math.cos(ct)*st,H[et*3+1]=Math.sin(ct)*st,H[et*3+2]=(W()-.5)*Gn}L.setAttribute("position",new hs(H,3));const at=new tr({color:15853267,size:2,transparent:!0,opacity:.065,depthWrite:!1}),rt=new Qr(L,at);s.add(rt)}function F(){const L=new Fs(16772829,2.5);L.position.set(0,tn*.6,-Gn*.5),L.target.position.set(0,-tn,-100),s.add(L),s.add(L.target);const I=new Fs(16773853,1.8);I.position.set(0,tn*.6,Gn*.5),I.target.position.set(0,-tn,100),s.add(I),s.add(I.target);const H=new Ro(16774630,.45);s.add(H);const W=new Vu(16777215,4473924,.35);s.add(W)}function D(){t.background=new qt(N2)}function O(){const L=new vt,I=new gt({color:4473924,metalness:.7,roughness:.3}),H=new $e({color:16772812}),W=gs(4444);for(let at=0;at<120;at++){const rt=W()*Math.PI*2,et=(W()-.5)*Gn*.85,ct=new vt,st=new C(new $t(.15,.2,6,6),I);st.position.y=3,ct.add(st);const Z=new C(new ke(.4,6,4),H);Z.position.y=6.2,ct.add(Z);const Q=Math.cos(rt)*(tn-2),$=Math.sin(rt)*(tn-2);ct.position.set(Q,$,et),ct.lookAt(0,0,et),ct.rotateX(Math.PI/2),L.add(ct)}s.add(L)}function B(){const L=new vt,I=gs(5555),H=new gt({color:11184810,roughness:.8}),W=new gt({color:7838139,metalness:.4,roughness:.5});for(let at=0;at<4;at++){const rt=I()*Math.PI*2,et=(I()-.5)*Gn*.6,ct=new vt;for(let $=0;$<4;$++){const mt=$/4*Math.PI*2,yt=new C(new $t(.3,.3,15,6),H);yt.position.set(Math.cos(mt)*3,7.5,Math.sin(mt)*3),ct.add(yt)}const st=new C(new ke(5,8,6),W);st.position.y=17,st.scale.y=.7,ct.add(st);const Z=Math.cos(rt)*(tn-5),Q=Math.sin(rt)*(tn-5);ct.position.set(Z,Q,et),ct.lookAt(0,0,et),ct.rotateX(Math.PI/2),ct.scale.setScalar(1.2),L.add(ct)}for(let at=0;at<6;at++){const rt=I()*Math.PI*2,et=(I()-.5)*Gn*.7,ct=new vt,st=new C(new Y(25+I()*15,8+I()*6,20+I()*10),new gt({color:13417386,roughness:.8}));st.position.y=5,ct.add(st);const Z=new C(new Y(28+I()*15,1,23+I()*10),new gt({color:6710886,roughness:.7}));Z.position.y=10,ct.add(Z);const Q=Math.cos(rt)*(tn-6),$=Math.sin(rt)*(tn-6);ct.position.set(Q,$,et),ct.lookAt(0,0,et),ct.rotateX(Math.PI/2),L.add(ct)}s.add(L)}function z(L,I,H,W=3){const at=Math.cos(I)*(tn-W),rt=Math.sin(I)*(tn-W);L.position.set(at,rt,H),L.lookAt(0,0,H),L.rotateX(Math.PI/2)}function tt(){const L=new vt,I=gs(7001),H=new gt({color:15788248,roughness:.8}),W=new gt({color:5592405,roughness:.6,metalness:.2});for(let at=0;at<4;at++){const rt=new vt,et=new C(new Y(10,8,18),H);et.position.y=4,rt.add(et);const ct=new pi(9,4,4),st=new C(ct,W);st.position.y=10,st.rotation.y=Math.PI/4,rt.add(st);const Z=new C(new Y(3,12,3),H);Z.position.set(0,10,-7),rt.add(Z);const Q=new C(new pi(2.5,8,8),W);Q.position.set(0,20,-7),rt.add(Q),z(rt,I()*Math.PI*2,(I()-.5)*Gn*.7,5),L.add(rt)}s.add(L)}function j(){const L=new vt,I=gs(7101),H=new gt({color:15658734,roughness:.3,metalness:.4}),W=new gt({color:13382451,roughness:.6}),at=new gt({color:12303291,roughness:.9});for(let rt=0;rt<6;rt++){const et=new vt,ct=new C(new Y(20,.3,15),at);et.add(ct);const st=new C(new Y(18,.4,12),H);st.position.y=5,et.add(st);for(let Q=-7;Q<=7;Q+=14)for(let $=-4;$<=4;$+=8){const mt=new C(new $t(.3,.3,5,6),H);mt.position.set(Q,2.5,$),et.add(mt)}for(let Q=-4;Q<=4;Q+=4){const $=new C(new Y(.8,2.5,.8),W);$.position.set(Q,1.25,0),et.add($)}const Z=new C(new Y(8,4,6),new gt({color:14538952,roughness:.8}));Z.position.set(0,2,-9),et.add(Z),z(et,I()*Math.PI*2,(I()-.5)*Gn*.75,4),L.add(et)}s.add(L)}function dt(){const L=new vt,I=gs(7201),H=new gt({color:3815994,roughness:.95}),W=[13378082,2250188,15658734,2236962,8956484,14527010,6710886,11158562];for(let at=0;at<10;at++){const rt=new vt,et=20+I()*20,ct=15+I()*15,st=new C(new Y(et,.2,ct),H);rt.add(st);const Z=4+Math.floor(I()*10);for(let Q=0;Q<Z;Q++){const $=new gt({color:W[Math.floor(I()*W.length)],roughness:.4,metalness:.3}),mt=new vt,yt=new C(new Y(2.2,1.2,4.5),$);yt.position.y=.7,mt.add(yt);const Tt=new C(new Y(1.8,.9,2.2),new gt({color:3368601,roughness:.1,metalness:.3}));Tt.position.y=1.6,mt.add(Tt),mt.position.set((I()-.5)*(et-4),.1,(I()-.5)*(ct-5)),mt.rotation.y=I()>.5?0:Math.PI,rt.add(mt)}z(rt,I()*Math.PI*2,(I()-.5)*Gn*.75,3),L.add(rt)}s.add(L)}function wt(){const L=new vt,I=gs(7301),H=new gt({color:4500189,roughness:.1,metalness:.1}),W=new gt({color:13417386,roughness:.85});for(let at=0;at<5;at++){const rt=new vt,et=new C(new Y(18,.3,12),W);rt.add(et);const ct=new C(new Y(14,.1,8),H);ct.position.y=.05,rt.add(ct);const st=new gt({color:16777215,roughness:.6});for(let Z=-1;Z<=1;Z+=2){const Q=new C(new Y(.5,.5,8),st);Q.position.set(Z*7.25,.3,0),rt.add(Q)}for(let Z=-1;Z<=1;Z+=2){const Q=new C(new Y(15,.5,.5),st);Q.position.set(0,.3,Z*4.25),rt.add(Q)}z(rt,I()*Math.PI*2,(I()-.5)*Gn*.6,3),L.add(rt)}s.add(L)}function ft(){const L=new vt,I=gs(7401),H=[13378082,2250188,15658734,2236962,8956484,14527010,16777215,4473924];for(let W=0;W<80;W++){const at=new gt({color:H[Math.floor(I()*H.length)],roughness:.4,metalness:.3}),rt=new vt,et=new C(new Y(2,1.1,4),at);et.position.y=.6,rt.add(et);const ct=new C(new Y(1.6,.8,2),new gt({color:3368601,roughness:.1,metalness:.3}));ct.position.y=1.5,rt.add(ct);const st=I()*Math.PI*2,Z=(I()-.5)*Gn*.85;z(rt,st,Z,1.5),L.add(rt)}s.add(L)}function U(){const L=new vt,I=gs(7501),H=new gt({color:11197866,roughness:.05,metalness:.1,transparent:!0,opacity:.5});for(let W=0;W<8;W++){const at=new vt,rt=8+I()*6,et=15+I()*15,ct=new $t(rt/2,rt/2,et,12,1,!0,0,Math.PI),st=new C(ct,H);st.rotation.z=Math.PI/2,st.rotation.y=Math.PI/2,st.position.y=0,at.add(st);for(let Z=-1;Z<=1;Z+=2){const Q=new qi(rt/2,12,0,Math.PI),$=new C(Q,H);$.position.set(0,0,Z*et/2),$.rotation.x=Z>0?0:Math.PI,at.add($)}z(at,I()*Math.PI*2,(I()-.5)*Gn*.7,2),L.add(at)}s.add(L)}function K(){const L=new vt,I=gs(7601),H=new gt({color:12632256,roughness:.5,metalness:.4}),W=new gt({color:8947848,roughness:.5,metalness:.5});for(let at=0;at<12;at++){const rt=new vt,et=2+I()*2,ct=8+I()*10,st=new C(new $t(et,et,ct,12),H);st.position.y=ct/2,rt.add(st);const Z=new C(new pi(et+.3,3,12),W);Z.position.y=ct+1.5,rt.add(Z);const Q=new vt;Q.add(rt);const $=Math.floor(I()*3);for(let mt=0;mt<$;mt++){const yt=rt.clone();yt.position.set((I()-.5)*8,0,(I()-.5)*8);const Tt=.6+I()*.5;yt.scale.setScalar(Tt),Q.add(yt)}z(Q,I()*Math.PI*2,(I()-.5)*Gn*.8,4),L.add(Q)}s.add(L)}function nt(){const L=new vt,I=gs(7701),H=new gt({color:10066329,roughness:.8}),W=new gt({color:7829367,metalness:.5,roughness:.4});for(let at=0;at<8;at++){const rt=new vt,et=15+I()*10,ct=new C(new Y(et,.5,6),H);ct.position.y=6,rt.add(ct);for(let st=-et/2+2;st<=et/2-2;st+=et-4){const Z=new C(new Y(1.5,6,1.5),H);Z.position.set(st,3,0),rt.add(Z)}for(let st=-1;st<=1;st+=2){const Z=new C(new Y(et,1.2,.2),W);Z.position.set(0,7,st*2.8),rt.add(Z)}z(rt,I()*Math.PI*2,(I()-.5)*Gn*.7,4),L.add(rt)}s.add(L)}function ht(){const L=new vt,I=gs(7801),H=new gt({color:9136970,roughness:.9}),W=new gt({color:3836462,roughness:.95});for(let at=0;at<15;at++){const rt=new vt,et=new C(new qi(8,12),W);et.rotation.x=-Math.PI/2,rt.add(et);for(let ct=0;ct<2+Math.floor(I()*3);ct++){const st=new vt,Z=new C(new Y(2.5,.15,1.2),H);Z.position.y=1,st.add(Z);for(let Q=-1;Q<=1;Q+=2){const $=new C(new Y(2.5,.1,.5),H);$.position.set(0,.6,Q*.9),st.add($)}for(let Q=-1;Q<=1;Q+=2){const $=new C(new Y(.1,1,.1),H);$.position.set(Q*1,.5,0),st.add($)}st.position.set((I()-.5)*10,0,(I()-.5)*10),st.rotation.y=I()*Math.PI,rt.add(st)}z(rt,I()*Math.PI*2,(I()-.5)*Gn*.7,3),L.add(rt)}s.add(L)}function _t(){const L=new vt,I=gs(7901),H=new gt({color:7035722,roughness:.95});for(let W=0;W<50;W++){const at=new vt,rt=new C(new $t(.2,.25,10,5),H);rt.position.y=5,at.add(rt);const et=new C(new Y(4,.2,.2),H);et.position.y=9.5,at.add(et);for(let ct=-1.5;ct<=1.5;ct+=1.5){const st=new C(new $t(.08,.08,.5,4),new gt({color:8947848,metalness:.4,roughness:.3}));st.position.set(ct,9.8,0),at.add(st)}z(at,I()*Math.PI*2,(I()-.5)*Gn*.85,2),L.add(at)}s.add(L)}function P(){const L=new vt,I=gs(6789),H=new gt({color:9148740,roughness:.95}),W=new gt({color:12888398,roughness:.95});for(let at=0;at<30;at++){const rt=I()*Math.PI*2,et=(I()-.5)*Gn*.8,ct=I()>.5,st=30+I()*60,Z=30+I()*60,Q=new Y(st,1.5+I()*1.5,Z),$=new C(Q,ct?W:H),mt=Math.cos(rt)*(tn-2),yt=Math.sin(rt)*(tn-2);$.position.set(mt,yt,et),$.lookAt(0,0,et),$.rotateX(Math.PI/2),L.add($)}s.add(L)}function q(){D(),x(),S(),T(),M(),N(),v(),A(),R(),O(),B(),P(),tt(),j(),dt(),wt(),ft(),U(),K(),nt(),ht(),_t(),F()}return{init({root:L,camera:I,renderer:H,scene:W}){r=L,t=W,e=I,n=H,s=new vt,s.name="cooper-station-group",s.position.z=RK,s.rotation.z=d,r.add(s),i=t.fog,a=t.background,c=typeof n?.toneMappingExposure=="number"?n.toneMappingExposure:null,u={near:e.near,far:e.far,fov:e.fov},t.fog=new zu(N2,15e-5),t.background=new qt(N2),n&&(n.toneMappingExposure=1.1),e.near=1,e.far=12e3,e.fov=65,e.position.copy(N3),e.lookAt(LK),e.updateProjectionMatrix(),q()},update({delta:L}={}){if(!e)return;const I=Math.min(Math.max(L??1/60,0),.05);d=(d+I*DK)%(Math.PI*2),s&&(s.rotation.z=d),e.position.copy(N3)},resize(){},dispose(){s&&(r&&s.parent!==r&&r.add(s),Li(s)),t&&(t.fog=i,t.background=a),n&&c!==null&&(n.toneMappingExposure=c),e&&u&&(e.near=u.near,e.far=u.far,e.fov=u.fov,e.updateProjectionMatrix()),r=null,t=null,e=null,n=null,s=null,i=null,a=null,c=null,u=null,d=0}}}},FK=[qq,jq,c$,b$,YX,yj,Mj,zj,Yj,ZY,wK,NK,OK],UK=2;class PK{constructor(t){this.container=t,this.renderer=null,this.scene=null,this.camera=null,this.clock=new K8,this.sceneRoot=null,this.globalSet=null,this.controls=null,this.sceneManager=null,this.isRendering=!1,this.renderFrame=this.renderFrame.bind(this),this.handleResize=this.handleResize.bind(this)}async init(){if(!this.container)throw new Error("Missing viewport container element.");this.renderer=new Tq({antialias:!0});try{await this.renderer.init()}catch{throw this.renderer&&(this.renderer.dispose(),this.renderer=null),new Error("WebGPU initialization failed. This browser or device does not support WebGPU.")}this.renderer.setPixelRatio(Math.min(window.devicePixelRatio,UK)),this.renderer.toneMapping=ww,this.renderer.toneMappingExposure=.95,this.scene=new Ew,this.scene.background=new qt(132106);const t=Math.max(this.container.clientWidth,1),e=Math.max(this.container.clientHeight,1);this.camera=new $i(65,t/e,.1,5e3),this.camera.position.set(0,2.2,15),this.sceneRoot=new vt,this.scene.add(this.sceneRoot),this.globalSet=this.createGlobalSet(),this.scene.add(this.globalSet),this.renderer.setSize(t,e,!1),this.container.replaceChildren(this.renderer.domElement),this.controls=new _q(this.camera,this.renderer.domElement),this.sceneManager=new vq({camera:this.camera,manifest:FK,renderer:this.renderer,root:this.sceneRoot,scene:this.scene}),await this.sceneManager.load(0),window.addEventListener("resize",this.handleResize)}resumeRendering(){!this.renderer||this.isRendering||(this.clock.getDelta(),this.renderer.setAnimationLoop(this.renderFrame),this.isRendering=!0)}pauseRendering(){!this.renderer||!this.isRendering||(this.renderer.setAnimationLoop(null),this.isRendering=!1)}createGlobalSet(){const t=new vt;return t.name="app-global-placeholder",t}renderFrame(){const t=this.clock.getDelta(),e=this.clock.elapsedTime;this.controls&&this.controls.update(t),this.sceneManager&&this.sceneManager.update(t,e),this.renderer.render(this.scene,this.camera)}handleResize(){if(!this.renderer||!this.camera||!this.container)return;const t=Math.max(this.container.clientWidth,1),e=Math.max(this.container.clientHeight,1);this.camera.aspect=t/e,this.camera.updateProjectionMatrix(),this.renderer.setSize(t,e,!1),this.sceneManager&&this.sceneManager.resize(t,e)}async goToNextScene(){return this.sceneManager?this.sceneManager.next():!1}async goToPreviousScene(){return this.sceneManager?this.sceneManager.previous():!1}async goToScene(t){return this.sceneManager?this.sceneManager.goTo(t):!1}getCurrentSceneInfo(){return this.sceneManager?this.sceneManager.getCurrentSceneInfo():null}getSceneList(){return this.sceneManager?this.sceneManager.getSceneList():[]}hasNextScene(){return this.sceneManager?this.sceneManager.hasNext():!1}hasPreviousScene(){return this.sceneManager?this.sceneManager.hasPrevious():!1}dispose(){window.removeEventListener("resize",this.handleResize),this.pauseRendering(),this.controls&&(this.controls.dispose(),this.controls=null),this.sceneManager&&(this.sceneManager.dispose(),this.sceneManager=null),this.globalSet&&(Li(this.globalSet),this.globalSet=null),this.renderer&&(this.renderer.dispose(),this.renderer=null),this.scene=null,this.camera=null}}const Og=650;function Fg(r){return new Promise(t=>{window.setTimeout(t,r)})}function zK(r){return r instanceof Error?r.message.toLowerCase().includes("webgpu")?"This browser could not initialize WebGPU. Please switch to a WebGPU-capable browser/device.":r.message:"Failed to initialize the scene system."}function IK(){const r=ms.useRef(null),t=ms.useRef(null),e=ms.useRef(!1),n=ms.useRef(null),s=ms.useRef(!1),[i,a]=ms.useState("booting"),[c,u]=ms.useState(0),[d,f]=ms.useState(!0),[p,g]=ms.useState(null),[y,x]=ms.useState([]),[S,T]=ms.useState(!1),[M,N]=ms.useState("");ms.useEffect(()=>{let j=!0;return(async()=>{try{const wt=new PK(r.current);if(t.current=wt,await wt.init(),!j){wt.dispose();return}wt.pauseRendering(),g(wt.getCurrentSceneInfo()),x(wt.getSceneList()),a("idle")}catch(wt){if(!j)return;t.current&&t.current.pauseRendering(),N(zK(wt)),a("error")}})(),()=>{j=!1,t.current&&(t.current.dispose(),t.current=null)}},[]),ms.useEffect(()=>{const j=new Audio("/music.mp3");return j.loop=!0,j.preload="auto",n.current=j,()=>{j.pause(),j.currentTime=0,n.current=null}},[]);const v=ms.useMemo(()=>p?p.index<p.total-1:!1,[p]),A=ms.useMemo(()=>p?p.index>0:!1,[p]),R=i==="playing"||i==="transitioning",F=M.toLowerCase().includes("webgpu"),D=ms.useCallback(async j=>{if(i!=="playing"||e.current||!t.current)return!1;e.current=!0,a("transitioning"),u(1);let dt=!1;try{await Fg(Og),dt=await j(),dt&&g(t.current.getCurrentSceneInfo())}catch(wt){return N(wt instanceof Error?wt.message:"Navigation failed."),a("error"),t.current&&t.current.pauseRendering(),u(0),e.current=!1,!1}return u(0),await Fg(Og),a("playing"),e.current=!1,dt},[i]),O=ms.useCallback(async()=>{i!=="idle"||e.current||(e.current=!0,!s.current&&n.current&&(s.current=!0,n.current.play().catch(()=>{s.current=!1})),f(!1),u(1),await Fg(34),t.current&&t.current.resumeRendering(),a("transitioning"),f(!0),u(0),await Fg(Og),a("playing"),e.current=!1)},[i]),B=ms.useCallback(async()=>{!v||!t.current||await D(()=>t.current.goToNextScene())},[v,D]),z=ms.useCallback(async()=>{!A||!t.current||await D(()=>t.current.goToPreviousScene())},[A,D]),tt=ms.useCallback(async j=>{if(!p||j===p.index||!t.current){T(!1);return}await D(()=>t.current.goToScene(j))&&T(!1)},[D,p]);return we.jsxs("div",{className:"app-shell",children:[we.jsx("div",{className:"viewport",ref:r}),i==="booting"&&we.jsx("div",{className:"overlay status-overlay",children:we.jsxs("div",{className:"status-panel",children:[we.jsx("h2",{children:"Boot Sequence"}),we.jsx("p",{children:"Preparing renderer and loading scene modules."})]})}),i==="idle"&&we.jsx("div",{className:"overlay entrance-overlay",children:we.jsx("div",{className:"entrance-panel",children:we.jsxs("div",{className:"entrance-layout",children:[we.jsxs("div",{className:"entrance-copy-block",children:[we.jsx("p",{className:"entrance-kicker",children:"Three.js Recreation Of"}),we.jsx("h1",{children:"Interstellar"}),we.jsx("div",{className:"entrance-meta",children:we.jsx("span",{children:"13 Scenes"})}),we.jsx("button",{className:"primary-action",type:"button",onClick:O,children:"Enter"})]}),we.jsx("div",{className:"entrance-art-wrap",children:we.jsx("img",{className:"entrance-art",src:"/logo-tp.png",alt:"Endurance ring illustration"})})]})})}),i==="error"&&we.jsx("div",{className:"overlay status-overlay",children:we.jsxs("div",{className:"status-panel",children:[we.jsx("h2",{children:F?"WebGPU Unsupported":"Render System Error"}),we.jsx("p",{children:M})]})}),R&&p&&we.jsxs(we.Fragment,{children:[we.jsx("button",{className:`scene-menu-toggle ${S?"is-open":""}`,type:"button",onClick:()=>T(j=>!j),disabled:i!=="playing",children:"Scenes"}),we.jsxs("aside",{className:`scene-menu ${S?"is-open":""}`,children:[we.jsxs("div",{className:"scene-menu-header",children:[we.jsx("p",{children:"Scene Navigator"}),we.jsxs("span",{children:[p.total," Total"]})]}),we.jsx("div",{className:"scene-menu-list",children:y.map(j=>we.jsxs("button",{className:j.index===p.index?"is-active":"",type:"button",onClick:()=>tt(j.index),disabled:i!=="playing",children:[we.jsx("span",{children:String(j.index+1).padStart(2,"0")}),we.jsx("span",{children:j.title})]},j.id))})]}),we.jsxs("div",{className:"scene-hud",children:[we.jsxs("p",{className:"scene-counter",children:[String(p.index+1).padStart(2,"0")," / ",String(p.total).padStart(2,"0")]}),we.jsx("h3",{children:p.title})]}),we.jsxs("div",{className:"scene-controls",children:[p.index>0&&we.jsx("button",{type:"button",onClick:z,disabled:i!=="playing",children:"Previous Scene"}),we.jsx("button",{type:"button",onClick:B,disabled:i!=="playing"||!v,children:"Next Scene"})]}),we.jsxs("div",{className:"scene-input-hint",children:[we.jsx("p",{children:"WSAD for movement"}),we.jsx("p",{children:"Shift down, Space up"}),we.jsx("p",{children:"Mouse for view panning"})]})]}),we.jsx("div",{className:"fade-layer",style:{opacity:c,transition:`opacity ${d?Og:0}ms ease`}})]})}EF.createRoot(document.getElementById("root")).render(we.jsx(IK,{}));
